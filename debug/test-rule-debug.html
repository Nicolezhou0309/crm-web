<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>规则编辑调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .debug-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-clear {
            background: #6c757d;
        }
        .btn-clear:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>规则编辑调试工具</h1>
        <p>请打开浏览器控制台，然后在CRM系统中尝试编辑规则ID: <strong>094f8417-29f8-4f72-8219-ee3d6744ea3e</strong></p>
        
        <div class="debug-section">
            <div class="debug-title">调试步骤</div>
            <ol>
                <li>打开浏览器开发者工具 (F12)</li>
                <li>切换到 Console 标签</li>
                <li>在CRM系统中点击编辑规则按钮</li>
                <li>观察控制台输出的调试信息</li>
                <li>尝试选择销售组并保存</li>
                <li>查看所有相关的调试日志</li>
            </ol>
        </div>

        <div class="debug-section">
            <div class="debug-title">需要关注的日志标签</div>
            <ul>
                <li><code>[RuleEdit]</code> - 规则编辑开始时的日志</li>
                <li><code>[RuleModal]</code> - 弹窗相关的日志</li>
                <li><code>[RuleForm]</code> - 表单变化的日志</li>
                <li><code>[UserGroups]</code> - 销售组选择的日志</li>
                <li><code>[AllocationAPI]</code> - API调用的日志</li>
                <li><code>[LoadUserGroups]</code> - 销售组加载的日志</li>
            </ul>
        </div>

        <div class="debug-section">
            <div class="debug-title">常见问题排查</div>
            <ul>
                <li>检查 userGroups 数组是否为空</li>
                <li>检查 rule.user_groups 是否正确设置到表单</li>
                <li>检查表单提交时 user_groups 字段的值</li>
                <li>检查API调用时的参数格式</li>
                <li>检查数据库响应是否有错误</li>
            </ul>
        </div>

        <div class="debug-section">
            <div class="debug-title">控制台命令</div>
            <p>在控制台中可以运行以下命令来检查状态：</p>
            <div class="log-entry">
                // 检查当前销售组数据<br>
                console.log('当前销售组:', window.userGroups);<br><br>
                // 检查表单状态<br>
                console.log('表单值:', window.ruleForm?.getFieldsValue());<br><br>
                // 检查编辑中的规则<br>
                console.log('编辑规则:', window.editingRule);
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">操作按钮</div>
            <button class="btn" onclick="clearConsole()">清空控制台</button>
            <button class="btn btn-clear" onclick="showDebugInfo()">显示调试信息</button>
        </div>
    </div>

    <script>
        function clearConsole() {
            console.clear();
            console.log('控制台已清空，准备开始调试...');
        }

        function showDebugInfo() {
            console.log('=== 调试信息 ===');
            console.log('当前时间:', new Date().toLocaleString());
            console.log('用户代理:', navigator.userAgent);
            console.log('页面URL:', window.location.href);
            console.log('===============');
        }

        // 页面加载时显示调试信息
        window.onload = function() {
            console.log('调试页面已加载');
            showDebugInfo();
        };
    </script>
</body>
</html> 