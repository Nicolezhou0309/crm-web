# CRMå‰ç«¯åº”ç”¨ - Serverless Devs éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. å®‰è£… Serverless Devs

```bash
npm install -g @serverless-devs/s
```

### 2. é…ç½®é˜¿é‡Œäº‘å‡­è¯

```bash
s config add
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- AccessKey ID: `ä½ çš„AccessKey ID`
- AccessKey Secret: `ä½ çš„AccessKey Secret`
- é»˜è®¤åŒºåŸŸ: `cn-shanghai`

### 3. æ„å»ºå¹¶éƒ¨ç½²

```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬
./deploy-serverless.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
npm install
npm run build
cp -r dist/* fc-app/dist/
s deploy
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ s.yaml                    # Serverless Devs é…ç½®æ–‡ä»¶
â”œâ”€â”€ deploy-serverless.sh      # è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ fc-app/                   # å‡½æ•°è®¡ç®—åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ index.js             # å‡½æ•°å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json         # å‡½æ•°ä¾èµ–
â”‚   â”œâ”€â”€ dist/                # æ„å»ºåçš„å‰ç«¯æ–‡ä»¶
â”‚   â””â”€â”€ template.yml         # å‡½æ•°è®¡ç®—æ¨¡æ¿
â”œâ”€â”€ src/                     # å‰ç«¯æºç 
â””â”€â”€ dist/                    # æ„å»ºè¾“å‡º
```

## ğŸ”§ é…ç½®è¯´æ˜

### s.yaml é…ç½®

- **æœåŠ¡åç§°**: `crm-frontend`
- **å‡½æ•°åç§°**: `crm-frontend-app`
- **è¿è¡Œæ—¶**: Node.js 18
- **å†…å­˜**: 1024MB
- **è¶…æ—¶**: 60ç§’
- **åŒºåŸŸ**: cn-shanghai

### ç¯å¢ƒå˜é‡

- `VITE_SUPABASE_URL`: SupabaseæœåŠ¡åœ°å€
- `VITE_SUPABASE_ANON_KEY`: SupabaseåŒ¿åå¯†é’¥
- `VITE_APP_ENV`: åº”ç”¨ç¯å¢ƒ (production)
- `NODE_ENV`: Node.jsç¯å¢ƒ

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†è·å¾—ï¼š

- **HTTPè§¦å‘å™¨**: è‡ªåŠ¨åˆ†é…çš„è®¿é—®åœ°å€
- **APIç«¯ç‚¹**: 
  - `/api/health` - å¥åº·æ£€æŸ¥
  - `/api/config` - é…ç½®ä¿¡æ¯
- **é™æ€æ–‡ä»¶**: è‡ªåŠ¨æœåŠ¡å‰ç«¯èµ„æº

## ğŸ“Š ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹éƒ¨ç½²ä¿¡æ¯
s info

# æŸ¥çœ‹å‡½æ•°æ—¥å¿—
s logs -f

# é‡æ–°éƒ¨ç½²
s deploy

# åˆ é™¤æœåŠ¡
s remove
```

## ğŸ› æ•…éšœæ’é™¤

### 1. å·¥ä½œç›®å½•é”™è¯¯

å¦‚æœé‡åˆ° `Invalid working directory` é”™è¯¯ï¼š

1. ç¡®ä¿ `s.yaml` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
2. æ£€æŸ¥ `codeUri: ./fc-app` è·¯å¾„æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿ `fc-app` ç›®å½•å­˜åœ¨ä¸”åŒ…å«å¿…è¦æ–‡ä»¶

### 2. æ„å»ºå¤±è´¥

```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf node_modules dist
npm install
npm run build
```

### 3. æƒé™é—®é¢˜

```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x deploy-serverless.sh
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡éƒ¨ç½²**: å¯èƒ½éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿåˆ›å»ºæœåŠ¡
2. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ Supabase é…ç½®æ­£ç¡®
3. **CORS**: å·²é…ç½®å…è®¸æ‰€æœ‰æ¥æºè®¿é—®
4. **é™æ€æ–‡ä»¶**: è‡ªåŠ¨æœåŠ¡ `dist` ç›®å½•ä¸­çš„æ–‡ä»¶
5. **SPAè·¯ç”±**: æ”¯æŒå‰ç«¯è·¯ç”±å›é€€åˆ° `index.html`

## ğŸ¯ ç‰¹æ€§

- âœ… **è‡ªåŠ¨æ„å»º**: é›†æˆå‰ç«¯æ„å»ºæµç¨‹
- âœ… **ç¯å¢ƒå˜é‡**: è¿è¡Œæ—¶é…ç½®ç®¡ç†
- âœ… **é™æ€æœåŠ¡**: è‡ªåŠ¨æœåŠ¡å‰ç«¯èµ„æº
- âœ… **APIæ”¯æŒ**: å¥åº·æ£€æŸ¥å’Œé…ç½®ç«¯ç‚¹
- âœ… **CORSé…ç½®**: è·¨åŸŸè¯·æ±‚æ”¯æŒ
- âœ… **SPAè·¯ç”±**: å•é¡µåº”ç”¨è·¯ç”±æ”¯æŒ
- âœ… **æ—¥å¿—ç›‘æ§**: å®Œæ•´çš„æ—¥å¿—è®°å½•

äº«å— Serverless éƒ¨ç½²çš„ä¾¿åˆ©å§ï¼
