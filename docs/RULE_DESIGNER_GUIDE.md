# 画板式规则设计器使用指南

## 概述

画板式规则设计器是一个可视化的规则配置工具，采用Agent工作流的方式设计线索分配规则。通过拖拽卡片、连接节点的方式，直观地构建复杂的分配逻辑。

## 核心概念

### 🎯 Agent工作流模式

规则设计器采用 **触发条件 → 执行动作 → 输出结果** 的Agent工作流模式：

```
触发条件 → 执行动作1 → 执行动作2 → 执行动作3 → 输出结果
```

### 📦 节点类型

#### 1. **触发条件节点** (蓝色)
- **用途**：定义何时触发规则
- **类型**：渠道触发、社区触发、时间触发、用户触发、预算触发
- **特点**：规则流程的起点

#### 2. **执行动作节点** (绿色)
- **用途**：执行具体的分配动作
- **类型**：分配用户、角色分配、积分扣减、负载均衡、轮询分配
- **特点**：可以串联多个动作

#### 3. **输出结果节点** (紫色)
- **用途**：规则执行的结果
- **类型**：分配完成、分配失败、等待处理
- **特点**：规则流程的终点

## 界面操作

### 🎨 工具栏功能

#### **添加节点**
- **触发条件**：添加规则触发条件
- **执行动作**：添加分配执行动作
- **输出结果**：添加规则输出结果

#### **画布操作**
- **保存**：保存当前规则设计
- **预览**：预览规则流程
- **清空**：清空画布重新开始

### 🖱️ 节点操作

#### **拖拽移动**
- 点击并拖拽节点可以自由移动位置
- 节点会自动对齐网格

#### **调整大小**
- 拖拽节点边缘可以调整节点大小
- 支持等比例缩放

#### **编辑节点**
- **单击**：选中节点
- **双击**：打开节点编辑弹窗
- **右键**：显示上下文菜单

#### **删除节点**
- 选中节点后按Delete键
- 或通过右键菜单删除

### 🔗 连接操作

#### **创建连接**
- 从源节点拖拽到目标节点
- 或通过工具栏的连接工具

#### **编辑连接**
- 双击连接线编辑连接属性
- 可以添加连接标签

#### **删除连接**
- 选中连接线后按Delete键
- 或通过右键菜单删除

## 使用示例

### 📋 示例1：抖音渠道积分分配

#### **步骤1：添加触发条件**
1. 点击工具栏的"触发条件"按钮
2. 在画布上放置节点
3. 双击节点编辑：
   - 节点名称：抖音渠道触发
   - 触发类型：渠道触发
   - 配置：渠道选择"抖音"

#### **步骤2：添加执行动作**
1. 点击工具栏的"执行动作"按钮
2. 在触发条件右侧放置节点
3. 双击节点编辑：
   - 节点名称：积分分配
   - 动作类型：积分扣减
   - 配置：每条线索消耗15积分

#### **步骤3：添加输出结果**
1. 点击工具栏的"输出结果"按钮
2. 在执行动作右侧放置节点
3. 双击节点编辑：
   - 节点名称：分配完成
   - 描述：线索分配成功

#### **步骤4：创建连接**
1. 从触发条件拖拽到执行动作
2. 从执行动作拖拽到输出结果
3. 形成完整的流程：触发 → 执行 → 输出

### 📋 示例2：复杂分配流程

#### **触发条件**
- 渠道：抖音 + 小红书
- 社区：北虹桥
- 时间：工作时间

#### **执行动作链**
1. **积分检查**：检查用户积分是否充足
2. **负载均衡**：按工作量分配
3. **积分扣减**：扣减相应积分
4. **通知发送**：发送分配通知

#### **输出结果**
- 成功：分配完成
- 失败：分配失败，进入兜底流程

## 高级功能

### 🔄 条件分支

#### **并行分支**
```
触发条件
├── 分支1：积分分配 → 输出1
├── 分支2：角色分配 → 输出2
└── 分支3：负载均衡 → 输出3
```

#### **条件分支**
```
触发条件
├── 条件A满足 → 动作A → 输出A
├── 条件B满足 → 动作B → 输出B
└── 默认情况 → 动作C → 输出C
```

### ⚙️ 节点配置

#### **触发条件配置**
```json
{
  "triggerType": "channel",
  "channels": ["douyin", "xiaohongshu"],
  "operator": "in",
  "enabled": true
}
```

#### **执行动作配置**
```json
{
  "actionType": "deduct_points",
  "pointsPerLead": 15,
  "minPointsRequired": 10,
  "fallbackAction": "skip"
}
```

#### **输出结果配置**
```json
{
  "outputType": "success",
  "message": "线索分配成功",
  "nextAction": "notify_user"
}
```

### 🎨 自定义样式

#### **节点样式**
- 可以自定义节点颜色
- 支持不同的图标
- 可以调整节点大小

#### **连接线样式**
- 支持不同类型的连接线
- 可以添加连接标签
- 支持条件连接线

## 最佳实践

### 📐 设计原则

#### **1. 清晰性**
- 节点命名要清晰明确
- 避免过于复杂的流程
- 使用有意义的连接标签

#### **2. 可维护性**
- 模块化设计，便于修改
- 添加适当的注释
- 定期重构优化

#### **3. 性能考虑**
- 避免过多的节点
- 合理使用条件分支
- 优化连接逻辑

### 🔧 开发建议

#### **1. 渐进式设计**
- 先设计简单的流程
- 逐步添加复杂逻辑
- 充分测试后再部署

#### **2. 版本控制**
- 保存规则版本
- 支持规则回滚
- 记录修改历史

#### **3. 测试验证**
- 单元测试每个节点
- 集成测试完整流程
- 压力测试性能表现

## 常见问题

### Q1: 如何创建条件分支？

**A1**: 
1. 添加多个执行动作节点
2. 从触发条件连接到多个动作
3. 在每个连接上设置条件
4. 最后汇总到输出节点

### Q2: 如何实现循环逻辑？

**A2**: 
1. 使用条件节点判断是否需要循环
2. 从输出节点连接回执行动作
3. 设置循环次数限制
4. 添加退出条件

### Q3: 如何保存和加载规则？

**A3**: 
1. 点击工具栏的"保存"按钮
2. 规则会自动保存为JSON格式
3. 可以通过"加载"功能恢复规则
4. 支持规则模板的导入导出

### Q4: 如何优化规则性能？

**A4**: 
1. 减少不必要的节点
2. 使用缓存机制
3. 优化条件判断顺序
4. 定期清理无用连接

## 扩展功能（计划中）

### 🚀 高级特性

#### **1. 智能建议**
- 基于历史数据推荐规则
- 自动优化规则结构
- 提供最佳实践建议

#### **2. 协作功能**
- 多人同时编辑
- 版本冲突解决
- 实时同步更新

#### **3. 可视化增强**
- 3D视图展示
- 动画效果
- 主题切换

#### **4. 集成能力**
- 与外部系统集成
- API接口支持
- 插件扩展机制

## 总结

画板式规则设计器提供了一个直观、灵活的方式来设计复杂的线索分配规则。通过Agent工作流模式，可以轻松构建从简单到复杂的各种分配逻辑。建议从简单的规则开始，逐步掌握高级功能，最终构建出高效、可维护的分配系统。 