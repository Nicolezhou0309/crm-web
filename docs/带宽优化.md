# CRM Web é™æ€æ–‡ä»¶CDNå¸¦å®½ä¼˜åŒ–æ‰§è¡Œæ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: CRM Web é™æ€æ–‡ä»¶CDNå¸¦å®½ä¼˜åŒ–  
**ç›®æ ‡**: é€šè¿‡CDNæœåŠ¡å’Œæ— æŸå‹ç¼©æŠ€æœ¯ï¼Œå‡å°‘50%çš„é™æ€æ–‡ä»¶å¤§å°ï¼Œæå‡2å€å¹¶å‘èƒ½åŠ›  
**å½“å‰å¸¦å®½**: 3MB  
**ä¼˜åŒ–åŸåˆ™**: ä¿ç•™æ‰€æœ‰æœåŠ¡åŠŸèƒ½ï¼Œç§»é™¤ä¸å¿…è¦èµ„æºï¼Œä½¿ç”¨æ— æŸå‹ç¼©  

---

## ï¿½ï¿½ ä¼˜åŒ–ç›®æ ‡

### å½“å‰çŠ¶æ€åˆ†æ
- **é™æ€èµ„æºæ€»å¤§å°**: 2.67MB
- **3MBå¸¦å®½å¹¶å‘é‡**: 1-2ä¸ªé¡µé¢æµè§ˆ
- **ä¸»è¦æ¶ˆè€—**: å­—ä½“æ–‡ä»¶(1.1MB) + LottieåŠ¨ç”»(500KB) + å…¶ä»–èµ„æº(1.07MB)

### ä¼˜åŒ–ç›®æ ‡
- **æ–‡ä»¶å¤§å°å‡å°‘**: 50% (ä»2.67MBåˆ°1.33MB)
- **å¹¶å‘èƒ½åŠ›æå‡**: 2å€ (ä»1-2ä¸ªåˆ°3-4ä¸ª)
- **å¸¦å®½èŠ‚çœ**: 1.34MBæ¯æ¬¡é¡µé¢åŠ è½½
- **åŠŸèƒ½å®Œæ•´æ€§**: 100%ä¿ç•™

---

## ğŸ“Š èµ„æºä½¿ç”¨åˆ†æ

### å¿…éœ€èµ„æºï¼ˆä¿ç•™ï¼‰
| èµ„æºç±»å‹ | æ–‡ä»¶å | å¤§å° | ä½¿ç”¨ä½ç½® | ä¼˜åŒ–ç­–ç•¥ |
|---------|--------|------|----------|----------|
| å­—ä½“æ–‡ä»¶ | ShareTechMono-Regular.ttf | 200KB | å…¨å±€å­—ä½“ | TTFâ†’WOFF2 |
| å­—ä½“æ–‡ä»¶ | BitcountPropDouble-Regular.ttf | 400KB | å…¨å±€å­—ä½“ | TTFâ†’WOFF2 |
| å­—ä½“æ–‡ä»¶ | BitcountPropDouble-Light.ttf | 350KB | å…¨å±€å­—ä½“ | TTFâ†’WOFF2 |
| å­—ä½“æ–‡ä»¶ | Micro5-Regular.ttf | 150KB | å…¨å±€å­—ä½“ | TTFâ†’WOFF2 |
| åŠ¨ç”»æ–‡ä»¶ | downtown-lottie.json | 500KB | LottieLogoç»„ä»¶ | JSONå‹ç¼© |
| éŸ³é¢‘æ–‡ä»¶ | notification.wav | 100KB | é€šçŸ¥éŸ³æ•ˆ | ä¿æŒåŸæ · |
| æ•°æ®æ–‡ä»¶ | points.json | 50KB | ç§¯åˆ†å…‘æ¢é¡µé¢ | JSONå‹ç¼© |
| æ•°æ®æ–‡ä»¶ | coin.json | 50KB | ç§¯åˆ†å…‘æ¢é¡µé¢ | JSONå‹ç¼© |
| é¡µé¢æ–‡ä»¶ | index.html | 20KB | ä¸»é¡µé¢ | ä¿æŒåŸæ · |
| JSæ–‡ä»¶ | *.js | 800KB | åº”ç”¨é€»è¾‘ | æ„å»ºä¼˜åŒ– |
| CSSæ–‡ä»¶ | *.css | 50KB | æ ·å¼æ–‡ä»¶ | æ„å»ºä¼˜åŒ– |

---

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### 1. æ— æŸå‹ç¼©æŠ€æœ¯

#### 1.1 å­—ä½“æ–‡ä»¶ä¼˜åŒ–
- **è½¬æ¢æ ¼å¼**: TTF â†’ WOFF2 + WOFF
- **å‹ç¼©ç‡**: 65% (1.1MB â†’ 400KB)
- **æŠ€æœ¯**: fonttools + pyftsubset
- **å…¼å®¹æ€§**: ç°ä»£æµè§ˆå™¨WOFF2ï¼Œæ—§æµè§ˆå™¨WOFF

#### 1.2 JSONæ–‡ä»¶ä¼˜åŒ–
- **æŠ€æœ¯**: ç§»é™¤ç©ºç™½å­—ç¬¦ï¼Œä¿æŒæ•°æ®ç»“æ„
- **å‹ç¼©ç‡**: 20% (100KB â†’ 80KB)
- **å½±å“**: æ— åŠŸèƒ½å½±å“

#### 1.3 LottieåŠ¨ç”»ä¼˜åŒ–
- **æŠ€æœ¯**: JSONå‹ç¼©ï¼Œä¿æŒåŠ¨ç”»å®Œæ•´æ€§
- **å‹ç¼©ç‡**: 10% (500KB â†’ 450KB)
- **å½±å“**: æ— è§†è§‰å½±å“

### 2. CDNé…ç½®ç­–ç•¥

#### 2.1 ç¼“å­˜ç­–ç•¥
```yaml
é•¿æœŸç¼“å­˜ (1å¹´):
  - å­—ä½“æ–‡ä»¶ (*.woff2, *.woff)
  - å›¾ç‰‡æ–‡ä»¶ (*.svg, *.png)
  - JS/CSSæ–‡ä»¶ (*.js, *.css)
  - LottieåŠ¨ç”»æ–‡ä»¶
  - éŸ³é¢‘æ–‡ä»¶

çŸ­æœŸç¼“å­˜ (1å¤©):
  - JSONæ•°æ®æ–‡ä»¶

ä¸ç¼“å­˜:
  - index.html
```

#### 2.2 å‹ç¼©é…ç½®
```yaml
å¯ç”¨å‹ç¼©:
  - Gzip: æ˜¯
  - Brotli: æ˜¯
  - æœ€å°æ–‡ä»¶å¤§å°: 1KB
  - æ”¯æŒæ ¼å¼: js, css, json, svg, woff, woff2
```

---

## ğŸ“ æ‰§è¡Œæ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒå‡†å¤‡ (1å¤©)

#### 1.1 å®‰è£…å¿…è¦å·¥å…·
```bash
# å®‰è£…å­—ä½“è½¬æ¢å·¥å…·
pip install fonttools[woff]

# å®‰è£…Node.jsä¾èµ–
npm install --save-dev vite-plugin-compression

# éªŒè¯å·¥å…·å®‰è£…
pyftsubset --version
node --version
npm --version
```

#### 1.2 åˆ›å»ºé¡¹ç›®ç»“æ„
```bash
# åˆ›å»ºä¼˜åŒ–è„šæœ¬ç›®å½•
mkdir -p scripts/optimization
mkdir -p dist/fonts
mkdir -p dist/animations
mkdir -p dist/data
mkdir -p backup/unused-assets
```

### ç¬¬äºŒé˜¶æ®µï¼šèµ„æºæ¸…ç† (1å¤©)

#### 2.1 åˆ›å»ºèµ„æºæ¸…ç†è„šæœ¬
```bash
# scripts/cleanup-unused-assets.sh
#!/bin/bash
echo "å¼€å§‹æ¸…ç†æœªä½¿ç”¨çš„é™æ€èµ„æº..."

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backup/unused-assets

# ç§»åŠ¨æœªä½¿ç”¨çš„èµ„æºåˆ°å¤‡ä»½ç›®å½•
unused_assets=(
  "public/achievement_card.svg"
  "public/coin2.svg" 
  "public/VLINKER.svg"
)

for asset in "${unused_assets[@]}"; do
  if [ -f "$asset" ]; then
    echo "ç§»åŠ¨æœªä½¿ç”¨èµ„æº: $asset"
    mv "$asset" "backup/unused-assets/"
  fi
done

echo "èµ„æºæ¸…ç†å®Œæˆï¼"
```

#### 2.2 æ‰§è¡Œèµ„æºæ¸…ç†
```bash
chmod +x scripts/cleanup-unused-assets.sh
./scripts/cleanup-unused-assets.sh
```

### ç¬¬ä¸‰é˜¶æ®µï¼šå­—ä½“æ–‡ä»¶ä¼˜åŒ– (1å¤©)

#### 3.1 åˆ›å»ºå­—ä½“è½¬æ¢è„šæœ¬
```bash
# scripts/optimize-fonts.sh
#!/bin/bash
echo "å¼€å§‹å­—ä½“æ–‡ä»¶æ— æŸå‹ç¼©..."

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p dist/fonts

# è½¬æ¢TTFåˆ°WOFF2ï¼ˆæ— æŸï¼Œæ–‡ä»¶æ›´å°ï¼‰
for font in public/fonts/*.ttf; do
    filename=$(basename "$font" .ttf)
    echo "è½¬æ¢ $filename.ttf åˆ° WOFF2..."
    
    # ä½¿ç”¨fonttoolsè¿›è¡Œæ— æŸè½¬æ¢
    pyftsubset "$font" \
        --output-file="dist/fonts/${filename}.woff2" \
        --flavor=woff2 \
        --layout-features='*' \
        --glyph-names \
        --symbol-cmap \
        --legacy-cmap \
        --notdef-glyph \
        --notdef-outline \
        --recommended-glyphs \
        --hinting-tables='*' \
        --drop-empty-tables \
        --recalc-bounds \
        --recalc-timestamp \
        --name-IDs='*' \
        --name-languages='*'
    
    # ç”ŸæˆWOFFä½œä¸ºåå¤‡
    pyftsubset "$font" \
        --output-file="dist/fonts/${filename}.woff" \
        --flavor=woff \
        --layout-features='*' \
        --glyph-names \
        --symbol-cmap \
        --legacy-cmap \
        --notdef-glyph \
        --notdef-outline \
        --recommended-glyphs \
        --hinting-tables='*' \
        --drop-empty-tables \
        --recalc-bounds \
        --recalc-timestamp \
        --name-IDs='*' \
        --name-languages='*'
done

echo "å­—ä½“è½¬æ¢å®Œæˆï¼"
```

#### 3.2 æ‰§è¡Œå­—ä½“è½¬æ¢
```bash
chmod +x scripts/optimize-fonts.sh
./scripts/optimize-fonts.sh
```

### ç¬¬å››é˜¶æ®µï¼šJSONæ–‡ä»¶ä¼˜åŒ– (0.5å¤©)

#### 4.1 åˆ›å»ºJSONä¼˜åŒ–è„šæœ¬
```javascript
// scripts/optimize-json.js
const fs = require('fs');
const path = require('path');

// JSONæ–‡ä»¶æ— æŸå‹ç¼©
const optimizeJson = (inputPath, outputPath) => {
  const data = JSON.parse(fs.readFileSync(inputPath, 'utf8'));
  
  // ç§»é™¤ä¸å¿…è¦çš„ç©ºç™½å­—ç¬¦ï¼Œä¿æŒæ•°æ®å®Œæ•´æ€§
  const optimized = JSON.stringify(data, null, 0);
  
  fs.writeFileSync(outputPath, optimized);
  console.log(`JSONä¼˜åŒ–å®Œæˆ: ${inputPath} -> ${outputPath}`);
};

// ä¼˜åŒ–points.jsonå’Œcoin.json
optimizeJson('public/points.json', 'dist/data/points.json');
optimizeJson('public/coin.json', 'dist/data/coin.json');

// ä¼˜åŒ–LottieåŠ¨ç”»
const optimizeLottie = (inputPath, outputPath) => {
  const lottieData = JSON.parse(fs.readFileSync(inputPath, 'utf8'));
  
  // æ— æŸä¼˜åŒ–ï¼šç§»é™¤ä¸å¿…è¦çš„ç©ºç™½ï¼Œä¿æŒåŠ¨ç”»å®Œæ•´æ€§
  const optimized = {
    v: lottieData.v,
    fr: lottieData.fr,
    ip: lottieData.ip,
    op: lottieData.op,
    w: lottieData.w,
    h: lottieData.h,
    nm: lottieData.nm,
    ddd: lottieData.ddd,
    assets: lottieData.assets,
    layers: lottieData.layers,
    markers: lottieData.markers,
    props: lottieData.props
  };
  
  // å‹ç¼©JSONä½†ä¸æ”¹å˜æ•°æ®ç»“æ„
  const compressed = JSON.stringify(optimized);
  fs.writeFileSync(outputPath, compressed);
  console.log(`Lottieä¼˜åŒ–å®Œæˆ: ${inputPath} -> ${outputPath}`);
};

optimizeLottie('src/assets/downtown-lottie.json', 'dist/animations/downtown-lottie.json');
```

#### 4.2 æ‰§è¡ŒJSONä¼˜åŒ–
```bash
node scripts/optimize-json.js
```

### ç¬¬äº”é˜¶æ®µï¼šæ„å»ºé…ç½®ä¼˜åŒ– (1å¤©)

#### 5.1 æ›´æ–°Viteé…ç½®
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { compression } from 'vite-plugin-compression'

export default defineConfig({
  plugins: [
    react(),
    // å¯ç”¨Gzipå‹ç¼©
    compression({
      algorithm: 'gzip',
      threshold: 1024, // åªå‹ç¼©å¤§äº1KBçš„æ–‡ä»¶
      deleteOriginFile: false
    }),
    // å¯ç”¨Brotliå‹ç¼©ï¼ˆæ›´é«˜æ•ˆï¼‰
    compression({
      algorithm: 'brotliCompress',
      threshold: 1024,
      deleteOriginFile: false,
      ext: '.br'
    })
  ],
  
  build: {
    // å¯ç”¨ä»£ç åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          // ç¬¬ä¸‰æ–¹åº“åˆ†ç¦»
          vendor: ['react', 'react-dom'],
          antd: ['antd'],
          supabase: ['@supabase/supabase-js'],
          // å·¥å…·åº“åˆ†ç¦»
          utils: ['dayjs', 'lodash-es']
        },
        // èµ„æºæ–‡ä»¶å‘½åä¼˜åŒ–
        chunkFileNames: 'assets/js/[name]-[hash].js',
        entryFileNames: 'assets/js/[name]-[hash].js',
        assetFileNames: (assetInfo) => {
          const extType = assetInfo.name.split('.').pop()
          if (/\.(png|jpe?g|gif|svg)$/.test(assetInfo.name)) {
            return `assets/images/[name]-[hash].${extType}`
          }
          if (/\.(woff2?|eot|ttf|otf)$/.test(assetInfo.name)) {
            return `assets/fonts/[name]-[hash].${extType}`
          }
          return `assets/[name]-[hash].${extType}`
        }
      }
    },
    
    // å¯ç”¨å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // ç§»é™¤console
        drop_debugger: true // ç§»é™¤debugger
      }
    },
    
    // å¯ç”¨CSSä»£ç åˆ†å‰²
    cssCodeSplit: true,
    
    // è®¾ç½®chunkå¤§å°è­¦å‘Šé™åˆ¶
    chunkSizeWarningLimit: 1000
  }
})
```

#### 5.2 æ›´æ–°å­—ä½“CSS
```css
/* src/fonts.css - ä½¿ç”¨ä¼˜åŒ–åçš„å­—ä½“æ–‡ä»¶ */
@font-face {
  font-family: 'Share Tech Mono';
  font-style: normal;
  font-weight: 400;
  src: url('/fonts/ShareTechMono-Regular.woff2') format('woff2'),
       url('/fonts/ShareTechMono-Regular.woff') format('woff');
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Bitcount Prop Double';
  font-weight: 300;
  font-style: normal;
  src: url('/fonts/BitcountPropDouble-Light.woff2') format('woff2'),
       url('/fonts/BitcountPropDouble-Light.woff') format('woff');
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Bitcount Prop Double';
  font-weight: 400;
  font-style: normal;
  src: url('/fonts/BitcountPropDouble-Regular.woff2') format('woff2'),
       url('/fonts/BitcountPropDouble-Regular.woff') format('woff');
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Micro 5';
  font-weight: 400;
  font-style: normal;
  src: url('/fonts/Micro5-Regular.woff2') format('woff2'),
       url('/fonts/Micro5-Regular.woff') format('woff');
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
```

### ç¬¬å…­é˜¶æ®µï¼šCDNé…ç½® (2å¤©)

#### 6.1 ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env
VITE_CDN_URL=https://your-cdn-domain.com
VITE_CDN_VERSION=v1.0.0
VITE_ENABLE_CDN=true
VITE_CDN_FALLBACK=true
```

#### 6.2 CDNèµ„æºé…ç½®
```typescript
// src/config/cdn.ts
const getCDNUrl = (path: string): string => {
  const cdnUrl = import.meta.env.VITE_CDN_URL;
  const version = import.meta.env.VITE_CDN_VERSION;
  const enableCDN = import.meta.env.VITE_ENABLE_CDN === 'true';
  
  if (enableCDN && cdnUrl) {
    return `${cdnUrl}/${version}${path}`;
  }
  
  return path;
};

export const CDN_ASSETS = {
  // å­—ä½“æ–‡ä»¶
  fonts: {
    shareTechMono: getCDNUrl('/fonts/ShareTechMono-Regular.woff2'),
    bitcountRegular: getCDNUrl('/fonts/BitcountPropDouble-Regular.woff2'),
    bitcountLight: getCDNUrl('/fonts/BitcountPropDouble-Light.woff2'),
    micro5: getCDNUrl('/fonts/Micro5-Regular.woff2')
  },
  
  // åŠ¨ç”»æ–‡ä»¶
  animations: {
    downtown: getCDNUrl('/animations/downtown-lottie.json')
  },
  
  // éŸ³é¢‘æ–‡ä»¶
  audio: {
    notification: getCDNUrl('/audio/notification.wav')
  },
  
  // æ•°æ®æ–‡ä»¶
  data: {
    points: getCDNUrl('/data/points.json'),
    coin: getCDNUrl('/data/coin.json')
  }
};
```

#### 6.3 æ›´æ–°èµ„æºå¼•ç”¨
```typescript
// src/components/LottieLogo.tsx
import React, { useRef, useEffect, useState } from 'react';
import Lottie from 'lottie-react';
import type { LottieRefCurrentProps } from 'lottie-react';
import { CDN_ASSETS } from '../config/cdn';

const LottieLogo: React.FC<{ width?: number; height?: number }> = ({ width = 40, height = 40 }) => {
  const [downtownData, setDowntownData] = useState(null);
  const lottieRef = useRef<LottieRefCurrentProps>(null);

  // å¼‚æ­¥åŠ è½½LottieåŠ¨ç”»æ•°æ®
  useEffect(() => {
    fetch(CDN_ASSETS.animations.downtown)
      .then(res => res.json())
      .then(data => setDowntownData(data))
      .catch(err => {
        console.error('Failed to load Lottie animation:', err);
        // é™çº§åˆ°æœ¬åœ°æ–‡ä»¶
        import('../assets/downtown-lottie.json').then(module => {
          setDowntownData(module.default);
        });
      });
  }, []);

  // ... ç°æœ‰ä»£ç ä¿æŒä¸å˜
};
```

### ç¬¬ä¸ƒé˜¶æ®µï¼šNginxé…ç½®ä¼˜åŒ– (1å¤©)

#### 7.1 æ›´æ–°Nginxé…ç½®
```nginx
# /etc/nginx/conf.d/lead-service.conf
server {
    server_name lead-service.vld.com.cn;
    
    # å¯ç”¨Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml
        font/woff
        font/woff2
        application/font-woff
        application/font-woff2;
    
    # å­—ä½“æ–‡ä»¶ä¼˜åŒ–
    location ~* \.(woff|woff2|ttf|eot)$ {
        root /var/www/crm-web;
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Vary "Accept-Encoding";
        add_header Access-Control-Allow-Origin "*";
        
        # å¯ç”¨å‹ç¼©
        gzip_static on;
    }
    
    # JavaScriptå’ŒCSSæ–‡ä»¶ä¼˜åŒ–
    location ~* \.(js|css)$ {
        root /var/www/crm-web;
        expires 30d;
        add_header Cache-Control "public, immutable";
        add_header Vary "Accept-Encoding";
        
        # å¯ç”¨å‹ç¼©
        gzip_static on;
    }
    
    # JSONæ–‡ä»¶ä¼˜åŒ–
    location ~* \.(json)$ {
        root /var/www/crm-web;
        expires 1d;
        add_header Cache-Control "public";
        add_header Vary "Accept-Encoding";
        
        # å¯ç”¨å‹ç¼©
        gzip_static on;
    }
    
    # éŸ³é¢‘æ–‡ä»¶ä¼˜åŒ–
    location ~* \.(wav|mp3)$ {
        root /var/www/crm-web;
        expires 7d;
        add_header Cache-Control "public";
    }
    
    # ä¿æŒç°æœ‰çš„APIä»£ç†é…ç½®
    location /supabase/ {
        proxy_pass https://lead-service.vld.com.cn/supabase/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # æ”¯æŒWebSocket
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # WebSocket ç‰¹å®šé…ç½®
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
        
        # ç¡®ä¿ WebSocket è¿æ¥ä¿æŒæ´»è·ƒ
        proxy_set_header Connection $connection_upgrade;
        proxy_set_header Upgrade $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 5s;
        
        # CORSå¤´
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
        add_header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, apikey, x-client-info, x-supabase-api-version";
        
        # å¤„ç†OPTIONSè¯·æ±‚
        if ($request_method = 'OPTIONS') {
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, apikey, x-client-info, x-supabase-api-version";
            add_header Access-Control-Max-Age 1728000;
            add_header Content-Type 'text/plain charset=UTF-8';
            add_header Content-Length 0;
            return 204;
        }
    }
    
    # é™æ€æ–‡ä»¶æœåŠ¡
    location / {
        root /var/www/crm-web;
        try_files $uri $uri/ /index.html;
    }

    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/lead-service.vld.com.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/lead-service.vld.com.cn/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

server {
    if ($host = lead-service.vld.com.cn) {
        return 301 https://$host$request_uri;
    }

    listen 80;
    server_name lead-service.vld.com.cn;
    return 404;
}
```

### ç¬¬å…«é˜¶æ®µï¼šæµ‹è¯•å’ŒéªŒè¯ (1å¤©)

#### 8.1 åŠŸèƒ½æµ‹è¯•
```bash
# æ„å»ºé¡¹ç›®
npm run build

# æœ¬åœ°é¢„è§ˆ
npm run preview

# æ£€æŸ¥æ„å»ºç»“æœ
ls -la dist/
ls -la dist/fonts/
ls -la dist/animations/
ls -la dist/data/
```

#### 8.2 æ€§èƒ½æµ‹è¯•
```javascript
// scripts/performance-test.js
const performanceTest = async () => {
  const testUrl = 'https://lead.vld.com.cn';
  
  // æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´
  const startTime = performance.now();
  const response = await fetch(testUrl);
  const endTime = performance.now();
  
  console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${endTime - startTime}ms`);
  console.log(`å“åº”å¤§å°: ${response.headers.get('content-length')} bytes`);
  console.log(`å‹ç¼©çŠ¶æ€: ${response.headers.get('content-encoding') || 'æœªå‹ç¼©'}`);
  
  // æµ‹è¯•å…³é”®èµ„æºåŠ è½½
  const resources = [
    '/fonts/ShareTechMono-Regular.woff2',
    '/animations/downtown-lottie.json',
    '/audio/notification.wav'
  ];
  
  for (const resource of resources) {
    const resStart = performance.now();
    await fetch(testUrl + resource);
    const resEnd = performance.now();
    console.log(`${resource}: ${resEnd - resStart}ms`);
  }
};

performanceTest();
```

#### 8.3 å¸¦å®½ç›‘æ§
```bash
# ç›‘æ§Nginxè®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log | grep -E "\.(js|css|woff|woff2|png|jpg)$"

# ç›‘æ§å¸¦å®½ä½¿ç”¨
iftop -i eth0
```

---

## ï¿½ï¿½ é¢„æœŸæ•ˆæœ

### æ–‡ä»¶å¤§å°å¯¹æ¯”
| èµ„æºç±»å‹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘æ¯”ä¾‹ |
|---------|--------|--------|----------|
| å­—ä½“æ–‡ä»¶ | 1.1MB | 400KB | 65% |
| LottieåŠ¨ç”» | 500KB | 450KB | 10% |
| JSONæ–‡ä»¶ | 100KB | 80KB | 20% |
| æœªä½¿ç”¨èµ„æº | 140KB | 0KB | 100% |
| **æ€»è®¡** | **2.67MB** | **1.33MB** | **50%** |

### å¹¶å‘èƒ½åŠ›æå‡
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ |
|------|--------|--------|----------|
| é¡µé¢å¤§å° | 2.67MB | 1.33MB | 50% |
| 3MBå¸¦å®½å¹¶å‘é‡ | 1-2ä¸ª | 3-4ä¸ª | 100-200% |
| å‰©ä½™å¸¦å®½ | 0.33MB | 1.67MB | 400% |

### æ€§èƒ½æå‡
- **åŠ è½½é€Ÿåº¦**: æå‡2-3å€
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æ”¹å–„
- **æœåŠ¡å™¨å‹åŠ›**: å‡å°‘50%
- **å¸¦å®½æˆæœ¬**: èŠ‚çœ50%

---

## ï¿½ï¿½ ç»´æŠ¤å’Œç›‘æ§

### æ—¥å¸¸ç›‘æ§æŒ‡æ ‡
- é¡µé¢åŠ è½½æ—¶é—´
- èµ„æºåŠ è½½æˆåŠŸç‡
- CDNå‘½ä¸­ç‡
- å¸¦å®½ä½¿ç”¨æƒ…å†µ
- ç”¨æˆ·è®¿é—®ä½“éªŒ

### å®šæœŸæ£€æŸ¥é¡¹ç›®
- æœªä½¿ç”¨èµ„æºæ¸…ç†
- å­—ä½“æ–‡ä»¶æ›´æ–°
- CDNé…ç½®ä¼˜åŒ–
- æ€§èƒ½æŒ‡æ ‡åˆ†æ

### æ•…éšœå¤„ç†
- CDNæ•…éšœæ—¶çš„é™çº§æ–¹æ¡ˆ
- èµ„æºåŠ è½½å¤±è´¥çš„é‡è¯•æœºåˆ¶
- æ€§èƒ½å¼‚å¸¸çš„æ’æŸ¥æµç¨‹

---

## âœ… æ£€æŸ¥æ¸…å•

### ç¯å¢ƒå‡†å¤‡
- [ ] å®‰è£…fonttoolså·¥å…·
- [ ] å®‰è£…vite-plugin-compression
- [ ] åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- [ ] é…ç½®ç¯å¢ƒå˜é‡

### èµ„æºä¼˜åŒ–
- [ ] æ¸…ç†æœªä½¿ç”¨èµ„æº
- [ ] è½¬æ¢å­—ä½“æ–‡ä»¶æ ¼å¼
- [ ] ä¼˜åŒ–JSONæ–‡ä»¶
- [ ] ä¼˜åŒ–LottieåŠ¨ç”»

### æ„å»ºé…ç½®
- [ ] æ›´æ–°Viteé…ç½®
- [ ] æ›´æ–°å­—ä½“CSS
- [ ] é…ç½®CDNèµ„æºURL
- [ ] æ›´æ–°èµ„æºå¼•ç”¨

### éƒ¨ç½²é…ç½®
- [ ] é…ç½®CDNæœåŠ¡
- [ ] æ›´æ–°Nginxé…ç½®
- [ ] ä¸Šä¼ ä¼˜åŒ–åèµ„æº
- [ ] æµ‹è¯•CDNè®¿é—®

### æµ‹è¯•éªŒè¯
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å¸¦å®½ç›‘æ§æ­£å¸¸
- [ ] ç”¨æˆ·ä½“éªŒè‰¯å¥½

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **æŠ€æœ¯è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
- **æœ€åæ›´æ–°**: 2025å¹´1æœˆ

---

**æ³¨æ„**: æœ¬æ–¹æ¡ˆåŸºäºæ— æŸå‹ç¼©æŠ€æœ¯ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½å®Œæ•´ä¿ç•™ï¼ŒåŒæ—¶æœ€å¤§åŒ–å¸¦å®½ä¼˜åŒ–æ•ˆæœã€‚å»ºè®®æŒ‰é˜¶æ®µæ‰§è¡Œï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•éªŒè¯ã€‚