# Excel风格透视表功能指南

## 概述

本系统新增了Excel风格的透视表功能，支持拖拽式配置和实时数据可视化。

## 主要功能

### 1. 拖拽式配置
- 从左侧字段面板拖拽字段到右侧配置区域
- 支持视觉反馈和动画效果
- 直观的操作体验

### 2. 四个配置区域
- **行维度**：决定透视表的行结构
- **列维度**：决定透视表的列结构  
- **值字段**：决定透视表的数据聚合方式
- **筛选条件**：过滤数据（待实现）

### 3. 字段类型
- **维度字段**：适合作为行/列维度，如来源、线索类型、跟进阶段等
- **度量字段**：适合作为值字段，如预算、用户预算等

### 4. 聚合方式
- **求和(sum)**：数值字段的默认聚合方式
- **计数(count)**：维度字段的默认聚合方式
- **平均值(avg)**：计算平均值
- **最大值(max)**：计算最大值
- **最小值(min)**：计算最小值

## 使用步骤

### 第一步：加载数据
1. 设置筛选条件（时间范围、来源、线索类型等）
2. 点击"加载数据"按钮获取基础数据

### 第二步：配置透视表
1. 从左侧"可用字段"面板拖拽字段到右侧配置区域
2. 将维度字段拖拽到"行维度"或"列维度"
3. 将度量字段拖拽到"值字段"

### 第三步：执行透视表
1. 配置完成后点击"执行透视表"按钮
2. 系统将计算并显示透视表结果

### 第四步：保存配置（可选）
1. 点击"保存配置"按钮
2. 输入配置名称和描述
3. 配置将保存到"保存的配置"标签页

### 第五步：导出数据（可选）
1. 在透视表结果区域点击"导出Excel"或"导出CSV"
2. 选择保存位置并下载文件

## 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│                    页面头部                                 │
├─────────────────────────────────────────────────────────────┤
│                    筛选条件                                 │
├─────────────────────────────────────────────────────────────┤
│                    数据统计                                 │
├─────────────────────────────────────────────────────────────┤
│  可用字段  │  透视表配置  │        透视表结果              │
│  ┌──────┐  │  ┌────────┐  │  ┌────────────────────────┐  │
│  │维度  │  │  │行维度  │  │  │                        │  │
│  │字段  │  │  │        │  │  │                        │  │
│  │      │  │  ├────────┤  │  │                        │  │
│  │度量  │  │  │列维度  │  │  │                        │  │
│  │字段  │  │  │        │  │  │                        │  │
│  └──────┘  │  ├────────┤  │  │                        │  │
│            │  │值字段  │  │  │                        │  │
│            │  │        │  │  │                        │  │
│            │  ├────────┤  │  │                        │  │
│            │  │筛选    │  │  │                        │  │
│            │  │条件    │  │  │                        │  │
│            │  └────────┘  │  │                        │  │
│            │              │  │                        │  │
│            │  操作按钮    │  │                        │  │
│            └──────────────┘  └────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 使用技巧

### 1. 字段选择
- 维度字段适合作为行/列维度，可以创建分组和分类
- 度量字段适合作为值字段，可以进行数值计算
- 可以配置多个行维度和列维度来创建复杂的透视表

### 2. 配置优化
- 建议先配置行维度，再配置列维度，最后配置值字段
- 避免配置过多的行/列维度，可能导致透视表过于复杂
- 合理使用筛选条件来减少数据量

### 3. 数据导出
- Excel格式适合进一步的数据分析和处理
- CSV格式适合导入其他系统或工具

## 常见问题

### Q: 为什么拖拽字段没有反应？
A: 请确保：
1. 已经加载了数据
2. 拖拽的字段是有效的
3. 目标区域有足够的空间

### Q: 透视表结果为空？
A: 请检查：
1. 数据是否已加载
2. 配置是否正确
3. 筛选条件是否过于严格

### Q: 如何删除已配置的字段？
A: 点击字段标签上的关闭按钮即可删除

### Q: 如何修改聚合方式？
A: 目前系统会根据字段类型自动选择聚合方式，后续版本将支持手动修改

## 技术实现

### 前端技术栈
- React + TypeScript
- Ant Design UI组件库
- HTML5拖拽API
- CSS3动画效果

### 后端技术栈
- Supabase数据库
- PostgreSQL存储过程
- RLS安全策略

### 数据流程
1. 前端调用`filter_followups`函数获取基础数据
2. 前端进行透视表计算和聚合
3. 结果以表格形式展示
4. 支持配置保存和导出功能

## 更新日志

### v1.0.0 (2024-01-15)
- 新增Excel风格透视表功能
- 支持拖拽式配置
- 实现四个配置区域（行/列/值/筛选）
- 添加配置保存和加载功能
- 支持数据导出功能
- 优化UI界面和用户体验 