# 画板式规则设计器使用示例

## 示例1：抖音渠道积分分配流程

### 🎯 业务场景
当线索来源为抖音时，检查用户积分是否充足，如果充足则进行积分分配，最后输出分配结果。

### 📋 设计步骤

#### 步骤1：添加触发条件节点
1. 点击工具栏的"触发条件"按钮
2. 在画布上放置节点
3. 双击节点编辑配置：
   - **节点名称**：抖音渠道触发
   - **触发类型**：渠道触发
   - **配置**：
     ```json
     {
       "triggerType": "channel",
       "channels": ["douyin"],
       "operator": "in",
       "enabled": true
     }
     ```
   - **标签**：抖音、渠道
   - **备注**：抖音渠道的线索优先处理

#### 步骤2：添加条件判断节点
1. 点击工具栏的"条件判断"按钮
2. 在触发条件右侧放置节点
3. 双击节点编辑配置：
   - **节点名称**：积分检查
   - **条件类型**：积分检查
   - **配置**：
     ```json
     {
       "conditionType": "points_check",
       "threshold": 10,
       "operator": ">=",
       "enabled": true
     }
     ```
   - **标签**：积分、检查
   - **备注**：确保用户有足够积分

#### 步骤3：添加执行动作节点
1. 点击工具栏的"执行动作"按钮
2. 在条件判断右侧放置节点
3. 双击节点编辑配置：
   - **节点名称**：积分分配
   - **动作类型**：积分扣减
   - **配置**：
     ```json
     {
       "actionType": "deduct_points",
       "pointsPerLead": 15,
       "minPointsRequired": 10,
       "fallbackAction": "skip"
     }
     ```
   - **标签**：积分、分配
   - **备注**：每条线索消耗15积分

#### 步骤4：添加输出结果节点
1. 点击工具栏的"输出结果"按钮
2. 在执行动作右侧放置节点
3. 双击节点编辑配置：
   - **节点名称**：分配完成
   - **输出类型**：成功
   - **配置**：
     ```json
     {
       "outputType": "success",
       "message": "分配完成",
       "nextAction": "notify_user"
     }
     ```
   - **标签**：完成、成功
   - **备注**：分配流程结束

#### 步骤5：创建连接关系
1. 从触发条件拖拽到条件判断，设置连接标签为"触发检查"
2. 从条件判断拖拽到执行动作，设置连接标签为"积分充足"
3. 从执行动作拖拽到输出结果，设置连接标签为"分配成功"

### 🎨 最终效果
```
抖音渠道触发 → 积分检查 → 积分分配 → 分配完成
```

## 示例2：复杂分配流程

### 🎯 业务场景
多渠道线索分配，包含条件分支、循环控制和多种分配策略。

### 📋 设计步骤

#### 触发条件层
1. **渠道触发节点**：抖音 + 小红书
2. **社区触发节点**：北虹桥
3. **时间触发节点**：工作时间

#### 条件判断层
1. **积分检查节点**：检查用户积分是否充足
2. **工作量检查节点**：检查用户当前工作量
3. **优先级检查节点**：检查用户优先级

#### 执行动作层
1. **负载均衡节点**：按工作量分配
2. **积分扣减节点**：扣减相应积分
3. **通知发送节点**：发送分配通知
4. **记录日志节点**：记录分配日志

#### 输出结果层
1. **成功输出节点**：分配完成
2. **失败输出节点**：分配失败，进入兜底流程
3. **等待输出节点**：等待处理

### 🔄 连接逻辑
```
渠道触发
├── 积分充足 → 负载均衡 → 积分扣减 → 通知发送 → 记录日志 → 成功输出
├── 积分不足 → 失败输出
└── 工作量超限 → 等待输出
```

## 示例3：智能分配流程

### 🎯 业务场景
基于用户历史表现、积分余额、工作负载等多维度进行智能分配。

### 📋 节点配置

#### 触发条件节点
```json
{
  "triggerType": "multi_channel",
  "channels": ["douyin", "xiaohongshu", "wechat"],
  "communities": ["beihongqiao", "xuhui"],
  "timeRange": {
    "start": "09:00",
    "end": "18:00"
  }
}
```

#### 条件判断节点
```json
{
  "conditionType": "smart_check",
  "factors": [
    "points_balance",
    "workload",
    "performance_score",
    "availability"
  ],
  "weights": {
    "points": 0.3,
    "workload": 0.25,
    "performance": 0.25,
    "availability": 0.2
  }
}
```

#### 执行动作节点
```json
{
  "actionType": "smart_assign",
  "algorithm": "weighted_round_robin",
  "factors": [
    "points_balance",
    "workload",
    "performance_score"
  ],
  "fallback": "random_assign"
}
```

## 示例4：循环分配流程

### 🎯 业务场景
当第一次分配失败时，尝试其他分配策略，最多重试3次。

### 📋 设计步骤

#### 步骤1：添加循环控制节点
1. 点击工具栏的"循环控制"按钮
2. 配置循环参数：
   ```json
   {
     "loopType": "while",
     "maxIterations": 3,
     "condition": "!assignment_success && attempts < max_attempts",
     "enabled": true
   }
   ```

#### 步骤2：添加分配策略节点
1. **策略1**：积分分配
2. **策略2**：负载均衡
3. **策略3**：随机分配
4. **策略4**：兜底分配

#### 步骤3：添加条件判断节点
1. **分配成功检查**：检查是否分配成功
2. **重试次数检查**：检查是否超过最大重试次数

### 🔄 循环逻辑
```
开始分配 → 策略1 → 检查成功 → 成功则结束
         ↓ 失败
         → 策略2 → 检查成功 → 成功则结束
         ↓ 失败
         → 策略3 → 检查成功 → 成功则结束
         ↓ 失败
         → 策略4 → 结束
```

## 示例5：并行处理流程

### 🎯 业务场景
同时执行多个分配策略，选择最优结果。

### 📋 设计步骤

#### 并行分支1：积分分配
```
触发条件 → 积分检查 → 积分分配 → 结果评估
```

#### 并行分支2：负载均衡
```
触发条件 → 工作量检查 → 负载均衡 → 结果评估
```

#### 并行分支3：角色分配
```
触发条件 → 角色检查 → 角色分配 → 结果评估
```

#### 汇总节点：最优选择
```
结果评估1 ┐
结果评估2 ┼→ 最优选择 → 最终输出
结果评估3 ┘
```

## 使用技巧

### 🎨 界面操作技巧

#### 1. 快速添加节点
- 使用快捷键 `Ctrl + T` 添加触发条件
- 使用快捷键 `Ctrl + A` 添加执行动作
- 使用快捷键 `Ctrl + O` 添加输出结果

#### 2. 批量操作
- 按住 `Ctrl` 键选择多个节点
- 使用 `Shift` 键进行范围选择
- 右键菜单进行批量操作

#### 3. 画布导航
- 使用鼠标滚轮缩放
- 按住空格键拖拽画布
- 双击空白处重置视图

### 🔧 配置技巧

#### 1. 节点命名规范
- 使用清晰的业务术语
- 包含动作和对象
- 例如：`抖音渠道触发`、`积分分配`、`分配完成`

#### 2. 标签管理
- 使用有意义的标签
- 便于分类和搜索
- 例如：`抖音`、`渠道`、`积分`、`分配`

#### 3. 备注说明
- 详细说明节点功能
- 记录配置原因
- 便于后续维护

### 📊 性能优化

#### 1. 节点数量控制
- 单个规则不超过20个节点
- 复杂逻辑拆分为多个规则
- 使用子流程简化设计

#### 2. 连接优化
- 避免循环连接
- 减少不必要的连接
- 使用条件连接减少分支

#### 3. 配置优化
- 合理设置优先级
- 优化条件判断顺序
- 使用缓存机制

## 常见问题解决

### Q1: 如何实现条件分支？

**解决方案**：
1. 添加条件判断节点
2. 创建多个连接，设置不同条件
3. 使用连接标签区分分支

### Q2: 如何实现循环逻辑？

**解决方案**：
1. 使用循环控制节点
2. 设置循环条件和最大次数
3. 添加退出条件判断

### Q3: 如何实现并行处理？

**解决方案**：
1. 从同一节点创建多个连接
2. 分别处理不同分支
3. 最后汇总到同一节点

### Q4: 如何优化规则性能？

**解决方案**：
1. 减少节点数量
2. 优化连接逻辑
3. 使用缓存机制
4. 合理设置优先级

## 最佳实践总结

### 📐 设计原则
1. **清晰性**：节点命名清晰，逻辑简单
2. **可维护性**：模块化设计，便于修改
3. **可扩展性**：预留扩展接口
4. **性能优化**：控制复杂度，优化执行效率

### 🔧 开发建议
1. **渐进式设计**：从简单开始，逐步复杂
2. **充分测试**：每个节点都要测试
3. **版本控制**：保存规则版本
4. **文档记录**：详细记录设计思路

### 🎯 应用场景
1. **简单分配**：单一渠道、单一策略
2. **复杂分配**：多渠道、多策略
3. **智能分配**：基于多维度因素
4. **动态分配**：实时调整策略

通过这些示例和技巧，您可以快速掌握画板式规则设计器的使用方法，构建出高效、灵活的线索分配系统。 