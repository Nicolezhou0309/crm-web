# 部门管理员功能使用说明

## 功能概述

部门管理员功能允许超级管理员为特定部门分配管理员，部门管理员可以管理自己部门的成员，包括邀请新成员、调整成员部门、标记成员离职等操作。

## 权限层级

### 超级管理员
- 可以管理所有部门和成员
- 可以设置和移除部门管理员
- 可以创建、删除、调整部门结构
- 拥有系统最高权限

### 部门管理员
- 只能管理被分配的部门及其子部门
- 可以邀请新成员到管理的部门
- 可以调整成员在管理的部门间调动
- 可以标记成员离职
- 无法设置其他部门管理员

### 基础用户
- 只能查看自己所属部门的信息
- 无法进行管理操作

## 功能模块

### 1. 部门管理页面 (`/departments`)
- **超级管理员功能**：
  - 创建新部门
  - 删除部门
  - 拖拽调整部门层级
  - 设置部门管理员
  - 移除部门管理员

- **部门管理员功能**：
  - 查看管理的部门
  - 邀请新成员
  - 调整成员部门
  - 标记成员离职

### 2. 部门管理员页面 (`/department-admin`)
- **仪表板**：显示管理部门统计信息
- **部门管理**：快速访问部门管理功能
- **成员管理**：专门的成员管理界面（开发中）

## 操作指南

### 设置部门管理员

1. 超级管理员登录系统
2. 进入"部门管理"页面
3. 选择要设置管理员的部门
4. 点击右上角"..."菜单
5. 选择"设置管理员"
6. 在弹出的对话框中选择管理员用户
7. 点击"设置"确认

### 移除部门管理员

1. 超级管理员登录系统
2. 进入"部门管理"页面
3. 选择要移除管理员的部门
4. 点击右上角"..."菜单
5. 选择"移除管理员"
6. 确认移除操作

### 邀请新成员

1. 部门管理员或超级管理员登录系统
2. 进入"部门管理"页面
3. 选择要邀请成员的部门
4. 点击"邀请成员"按钮
5. 填写成员邮箱和姓名
6. 点击"发送邀请"

### 调整成员部门

1. 部门管理员或超级管理员登录系统
2. 进入"部门管理"页面
3. 在成员列表中找到要调整的成员
4. 点击"调整部门"按钮
5. 选择新的部门
6. 确认调整

### 标记成员离职

1. 部门管理员或超级管理员登录系统
2. 进入"部门管理"页面
3. 在成员列表中找到要标记的成员
4. 点击"离职"按钮
5. 确认离职操作

## 权限控制

### 前端权限控制
- 使用 `PermissionGate` 组件控制功能显示
- 使用 `usePermissions` Hook 获取用户权限
- 根据权限动态显示菜单和按钮

### API权限控制
- 所有管理操作都需要验证用户权限
- 部门管理员只能操作自己管理的部门
- 超级管理员可以操作所有部门

### 数据库权限控制
- 使用 Row Level Security (RLS) 策略
- 部门管理员只能查看和修改自己管理的部门数据
- 超级管理员拥有所有数据的访问权限

## 安全考虑

1. **权限验证**：所有操作都会验证用户权限
2. **数据隔离**：部门管理员只能访问自己部门的数据
3. **操作日志**：重要操作会记录日志
4. **输入验证**：所有用户输入都会进行验证

## 故障排除

### 常见问题

1. **无法设置部门管理员**
   - 检查是否为超级管理员
   - 确认目标用户存在且状态正常

2. **无法邀请成员**
   - 检查邮箱格式是否正确
   - 确认有邀请权限
   - 检查网络连接

3. **无法调整成员部门**
   - 确认有管理该部门的权限
   - 检查目标部门是否存在

4. **权限显示异常**
   - 刷新页面重新获取权限
   - 检查用户登录状态
   - 联系系统管理员

### 技术支持

如遇到技术问题，请联系系统管理员或查看系统日志获取详细错误信息。 