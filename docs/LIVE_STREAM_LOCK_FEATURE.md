# 直播场次锁定功能实现

## 功能概述

本次更新为直播报名系统添加了完整的锁定功能，包括：

1. **右键菜单锁定功能** - 在右键菜单中增加锁定/解锁选项
2. **未报名卡片右键菜单** - 为所有卡片（包括未报名的空卡片）显示右键菜单
3. **锁定状态显示** - 锁定状态的卡片有特殊的视觉标识
4. **锁定操作限制** - 锁定的场次无法进行报名或编辑操作

## 实现的功能

### 1. API接口

**新增文件**: `src/api/liveStreamLockApi.ts`

- `lockLiveStreamSchedule()` - 锁定直播场次
- `unlockLiveStreamSchedule()` - 解锁直播场次

### 2. 右键菜单增强

**更新文件**: `src/components/LiveStreamCardContextMenu.tsx`

- 添加锁定/解锁菜单项
- 根据锁定状态动态显示菜单选项
- 添加确认对话框

### 3. 卡片渲染逻辑

**更新文件**: `src/components/LiveStreamRegistrationBase.tsx`

- 为所有卡片显示右键菜单（包括未报名的空卡片）
- 锁定状态的卡片显示红色边框和锁定图标
- 锁定状态的卡片显示"已锁定"文字
- 锁定状态的卡片点击时显示警告信息

### 4. 锁定状态处理

- 锁定状态的卡片无法进行报名或编辑操作
- 锁定操作需要用户登录验证
- 锁定/解锁操作会实时更新本地状态和数据库
- 支持实时同步（通过现有的realtime订阅）

### 5. 锁定状态UI显示

- **红色边框**：锁定状态的卡片显示红色边框（#ff4d4f）
- **锁定图标**：显示锁定图标和"已锁定"文字
- **白色背景**：锁定状态使用白色背景，不显示彩色背景
- **锁定信息**：鼠标悬停显示锁定原因和锁定结束时间
- **不显示报名人**：锁定状态不显示报名人信息，只显示锁定相关信息

## 使用方法

### 锁定场次
1. 右键点击任意场次卡片（包括未报名的空卡片）
2. 选择"锁定场次"
3. 确认锁定操作
4. 场次将变为锁定状态，显示红色边框和锁定图标
   - 对于未报名的空卡片，系统会自动创建一个锁定记录
   - 对于已报名的场次，直接更新为锁定状态

### 解锁场次
1. 右键点击已锁定的场次卡片
2. 选择"解锁场次"
3. 确认解锁操作
4. 场次将变为可报名状态

## 技术细节

### 锁定类型
- `manual` - 手动锁定（管理员操作）
- `system` - 系统锁定（自动触发）
- `maintenance` - 维护锁定（系统维护期间）

### 数据库字段
- `lock_type` - 锁定类型
- `lock_reason` - 锁定原因
- `lock_end_time` - 锁定结束时间
- `status` - 场次状态（包含'locked'状态）

### 权限控制
- 当前实现中，所有登录用户都可以进行锁定/解锁操作
- 可以根据需要添加管理员权限验证

## 注意事项

1. 锁定的场次无法进行报名或编辑操作
2. 锁定操作会立即生效，无需刷新页面
3. 支持实时同步，多用户环境下状态会实时更新
4. 锁定状态在卡片上有明显的视觉标识
5. **未报名的空卡片也可以锁定**，系统会自动创建锁定记录
6. 锁定空卡片后，该时间段将无法被其他用户报名

## 后续扩展

可以考虑添加以下功能：
1. 管理员权限验证
2. 自动锁定功能（基于时间或条件）
3. 批量锁定操作
4. 锁定历史记录
5. 锁定原因的自定义输入
