# 页面刷新测试指南

## 问题描述

切换标签页时页面会刷新，影响用户体验。

## 测试步骤

### 1. 基础测试

#### 切换标签页测试
1. 打开应用页面
2. 切换到其他标签页
3. 再切换回应用页面
4. **预期结果**: 页面不应该刷新，不应该出现loading状态

#### 监控日志检查
在浏览器控制台中观察日志：
```
🚀 [页面监控] 页面开始加载  // 不应该出现
📄 [页面监控] DOM内容加载完成  // 不应该出现
✅ [页面监控] 页面加载完成  // 不应该出现
```

### 2. 可见性变化测试

#### 正常切换测试
1. 快速切换标签页多次
2. 观察控制台日志
3. **预期结果**: 只应该看到可见性变化日志，不应该有页面加载日志

#### 日志示例
```
👁️ [页面监控] 可见性变化 {
  visibilityState: 'hidden',
  timeSinceLastChange: 1341,
  duration: 4668,
  previousState: 'visible'
}
```

### 3. 长时间离开测试

#### 长时间离开页面
1. 切换到其他标签页
2. 等待5分钟以上
3. 切换回应用页面
4. **预期结果**: 页面不应该刷新，但可能需要检查会话状态

### 4. 会话状态测试

#### 会话即将过期测试
1. 等待会话即将过期（5分钟内）
2. 切换标签页
3. 切换回应用页面
4. **预期结果**: 可能显示会话警告，但不应该刷新页面

## 优化措施

### 1. 禁用页面可见性处理

```typescript
// 智能页面可见性变化处理 - 暂时禁用以避免页面刷新
useEffect(() => {
  // 暂时禁用页面可见性变化处理，避免页面刷新
  return () => {};
}, [checkSessionTimeout]);
```

### 2. 静默模式防护

```typescript
// 在静默模式下，不处理任何认证状态变化
if (isSilentMode || isVisibilityCheck) {
  return;
}
```

### 3. 多重条件检查

```typescript
if (!skipLoading && !isVisibilityCheck && !isSilentMode) {
  setLoading(true);
}
```

## 测试结果记录

### 测试日期: _________
### 测试环境: _________

| 测试项目 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|------|
| 切换标签页 | 不刷新 | | |
| 快速切换 | 不刷新 | | |
| 长时间离开 | 不刷新 | | |
| 会话检查 | 正常 | | |

### 问题记录

如果测试中发现问题，请记录：

1. **问题描述**: 
2. **复现步骤**: 
3. **控制台日志**: 
4. **浏览器信息**: 
5. **解决方案**: 

## 监控指标

### 性能指标
- 页面加载时间
- 内存使用情况
- CPU占用率

### 用户体验指标
- 切换标签页响应时间
- 是否出现loading状态
- 页面是否刷新

## 注意事项

1. **测试环境**: 确保在开发环境和生产环境都进行测试
2. **浏览器兼容性**: 在不同浏览器中测试
3. **网络条件**: 在不同网络条件下测试
4. **设备类型**: 在桌面和移动设备上测试

## 后续优化

如果测试通过，可以考虑：

1. **重新启用智能可见性处理**
2. **优化会话检查频率**
3. **添加更多监控指标**
4. **优化用户体验** 