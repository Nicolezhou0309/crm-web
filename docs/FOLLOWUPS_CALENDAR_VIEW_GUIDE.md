# 跟进记录日历视图使用指南

## 功能概述

跟进记录日历视图是一个全新的功能，允许用户以日历形式查看和管理跟进记录。该功能基于followups表的`moveintime`（入住日期）字段来显示数据。

## 主要功能

### 1. 日历显示
- 以月历形式显示所有跟进记录
- 根据入住日期（moveintime）在对应日期显示记录
- **线索编号显示**：日历中只显示线索编号，界面更简洁
- **文本省略**：线索编号超出容器宽度时自动省略显示
- **记录总数**：页面顶部显示当前月份记录总数
- **简洁显示**：线索编号直接显示，无圆形状态图标
- **日期记录总数**：每个有记录的日期卡片右上角显示"共X条"
- 不同跟进阶段用不同颜色标识（仅在详情弹窗中显示）：
  - 待接收：默认色
  - 已接收：蓝色
  - 已联系：蓝色
  - 已约访：橙色
  - 已带看：绿色
  - 已成交：绿色
  - 已流失：红色

### 2. 过滤功能
- **月份切换**：使用日历导航按钮切换月份，自动加载对应月份数据
- **跟进阶段过滤**：按跟进阶段筛选记录
- **重置功能**：快速重置为当月数据

### 3. 交互功能
- **点击日期**：查看该日期的所有跟进记录详情
- **事件详情弹窗**：显示完整的跟进记录信息
- **日历导航**：使用日历默认的月份切换功能

## 页面结构

### 顶部月份信息区域
```
📅 当前显示：2025年01月 (基于入住日期显示跟进记录)
数据范围：01-01 至 01-31    📊 共 15 条记录
```

### 过滤器区域
```
跟进阶段：[下拉选择]
[重置为当月]
```

### 日历主体区域
- 标准月历视图
- 每个日期单元格显示当天的跟进记录
- 记录以纯文本形式显示线索编号，无状态图标
- 有记录的日期右上角显示"共X条"总数统计

### 详情弹窗
点击日期后显示：
- 线索编号
- 跟进阶段（带颜色标签）
- 客户画像
- 工作地点
- 预算范围
- 来访意向
- 预约社区（如有）
- 负责销售
- 联系电话
- 微信
- 备注信息

## 数据来源

### 主要数据表
- `followups`：跟进记录主表
- `leads`：线索信息表
- `users_profile`：用户信息表

### 关键字段
- `moveintime`：入住日期（日历显示依据）
- `followupstage`：跟进阶段
- `customerprofile`：客户画像
- `userrating`：来访意向
- `scheduledcommunity`：预约社区

## 使用方法

### 1. 访问页面
- 在导航菜单中点击"线索管理" → "跟进日历"
- 或直接访问 `/followups-calendar` 路径
- 调试功能：点击"线索管理" → "跟进日历" 或访问 `/followups-calendar` 路径

### 2. 查看数据
- **默认显示本月数据**：页面加载后自动显示当前月份的数据
- **月份信息显示**：页面顶部显示当前查看的月份和数据范围
- **日历视图**：日历上会显示所有有入住日期的跟进记录

### 3. 过滤数据
- 使用顶部的过滤器来筛选特定条件的数据
- 支持跟进阶段过滤
- 月份切换会自动加载对应月份的数据

### 4. 查看详情
- **只有点击有事件的日期才会弹出详情弹窗**
- 在弹出的模态框中查看该日期的所有跟进记录
- **月份切换时不会弹出弹窗**

### 5. 导航操作
- 使用日历头部的 ‹ › 按钮进行月份切换
- 月份切换时会自动加载对应月份的数据
- 当前月份信息会实时更新显示
- 点击"重置为当月"按钮快速回到本月视图
- 仅支持月视图，年视图已被完全移除

## 技术实现

### 前端技术栈
- React 18
- TypeScript
- Ant Design 5.x
- Day.js（日期处理）

### 核心组件
- `Calendar`：Ant Design日历组件
- `Modal`：详情弹窗
- `List`：记录列表显示
- `Badge`：状态标识

### 数据获取
- 使用Supabase客户端进行数据查询
- 支持实时数据更新
- 包含错误处理和加载状态

## 样式特点

### 响应式设计
- 支持桌面端和移动端
- 自适应布局
- 移动端优化的触摸交互

### 视觉设计
- 现代化的卡片式布局
- 清晰的颜色编码系统
- 优雅的动画效果
- 良好的可读性

## 注意事项

### 数据要求
- 只有设置了`moveintime`的跟进记录才会在日历中显示
- 空值或null的入住日期不会显示

### 性能考虑
- 大量数据时建议使用日期范围过滤
- 数据加载时显示加载状态
- 支持分页加载（未来版本）

### 权限控制
- 遵循现有的权限系统
- 用户只能查看有权限的数据

## 未来扩展

### 计划功能
- 拖拽编辑入住日期
- 批量操作功能
- 导出日历数据
- 更多过滤条件
- 统计图表集成

### 优化方向
- 性能优化
- 用户体验改进
- 更多自定义选项
- 移动端优化

## 故障排除

### 常见问题
1. **日历不显示数据**
   - 检查是否有设置了入住日期的跟进记录
   - 确认数据库连接正常

2. **过滤不生效**
   - 检查过滤条件是否正确
   - 确认数据格式匹配

3. **详情弹窗无内容**
   - 检查该日期是否有跟进记录
   - 确认数据权限

### 调试工具
- 使用"日历调试"页面进行问题诊断
- 包含环境变量检查、连接测试、查询测试等功能
- 可通过导航菜单"线索管理" → "日历调试"访问

### 技术支持
如遇到问题，请联系技术支持团队。 