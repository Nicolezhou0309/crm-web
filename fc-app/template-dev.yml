ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'

Resources:
  crm-frontend-dev:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: 'CRM前端应用服务 - 开发环境'
      Policies:
        - AliyunOSSFullAccess
        - AliyunLogFullAccess
      LogConfig:
        Project: crm-logs-dev
        Logstore: crm-function-logs-dev
    
    crm-frontend-app-dev:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Description: 'CRM前端应用函数 - 开发环境'
        CodeUri: './'
        Handler: index.handler
        Runtime: nodejs18
        MemorySize: 512
        Timeout: 30
        InstanceConcurrency: 5
        InstanceType: e1
        EnvironmentVariables:
          VITE_SUPABASE_URL: 'http://47.123.26.25:8000'
          VITE_SUPABASE_ANON_KEY: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNicC04b2gxOG0wM2hiYjA4N3RhIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NTU0MjI4MjEsImV4cCI6MjA3MDk5ODgyMX0.TMNhVSwNgrJHxRKQnV-GVzX_EovIQ6EIg2vXdQEWRgE'
          VITE_SUPABASE_SERVICE_ROLE_KEY: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNicC04b2gxOG0wM2hiYjA4N3RhIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NTU0MjI4MjEsImV4cCI6MjA3MDk5ODgyMX0.TMNhVSwNgrJHxRKQnV-GVzX_EovIQ6EIg2vXdQEWRgE'
          VITE_APP_ENV: 'development'
          VITE_APP_VERSION: '1.0.0-dev'
          VITE_WECOM_CORP_ID: 'ww68a125fce698cb59'
          VITE_WECOM_AGENT_ID: '1000002'
          NODE_ENV: 'development'
      Events:
        http-trigger:
          Type: HTTP
          Properties:
            AuthType: ANONYMOUS
            Methods: ['GET', 'POST', 'PUT', 'DELETE', 'HEAD', 'OPTIONS', 'PATCH']
            Path: '/{proxy+}'
            Cors:
              AllowOrigin: '*'
              AllowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'HEAD', 'OPTIONS', 'PATCH']
              AllowHeaders: ['Content-Type', 'Authorization', 'X-Requested-With', 'X-Client-Info']
              MaxAge: 3600

Outputs:
  ServiceName:
    Value:
      Fn::GetAtt: [crm-frontend-dev, Name]
    Description: 'CRM前端服务名称 - 开发环境'
  
  FunctionName:
    Value:
      Fn::GetAtt: [crm-frontend-app-dev, Name]
    Description: 'CRM前端函数名称 - 开发环境'
  
  HttpTriggerUrl:
    Value:
      Fn::GetAtt: [crm-frontend-app-dev, HttpTriggerUrl]
    Description: 'HTTP触发器访问地址 - 开发环境'
