var __defProp=Object.defineProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__publicField=(e,t,r)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,r),_a;import{r as reactExports,c as commonjsGlobal,g as getDefaultExportFromCjs,d as reactDomExports,R as React$2,e as ReactDOM,a as ReactDOM$1}from"./vendor-CpJG26Rf.js";import{r as requireDayjs_min,s as staticMethods,M as Modal$2,l as dayjs,T as Typography,m as Tabs,C as Card$1,D as Descriptions,S as Space$1,B as Button$1,R as RefIcon,n as RefIcon$1,o as RefIcon$2,p as RefIcon$3,q as Tag$1,t as RefIcon$4,u as RefIcon$5,v as RefIcon$6,w as RefIcon$7,I as Input$1,x as DatePicker$2,F as Form$4,y as Tooltip,z as Checkbox,A as RefIcon$8,E as RefIcon$9,G as RefIcon$a,H as ForwardTable,J as Row,K as Col,L as Select,N as Switch$1,O as Drawer,P as Radio,Q as Progress,U as RefIcon$b,V as TypedInputNumber,W as RefIcon$c,X as RefIcon$d,Y as RefIcon$e,Z as Upload,$ as RefIcon$f,a0 as Spin,a1 as RefIcon$g,a2 as RefIcon$h,a3 as Avatar$1,a4 as RefIcon$i,a5 as Statistic,a6 as Slider,a7 as RefIcon$j,a8 as RefIcon$k,a9 as Result,aa as RefIcon$l,ab as RefIcon$m,ac as Dropdown,ad as RefIcon$n,ae as TreeSelect,af as _objectSpread2$3,ag as commonLocale,ah as Cascader,ai as Alert,aj as Steps,ak as Divider$1,al as Image$2,am as Calendar,an as Badge$2,ao as Empty$1,ap as Layout,aq as RefIcon$o,ar as RefIcon$p,as as RefIcon$q,at as RefIcon$r,au as RefIcon$s,av as RefIcon$t,aw as Menu,ax as RefIcon$u,ay as RefIcon$v,az as RefIcon$w,aA as RefIcon$x,aB as RefIcon$y,aC as RefIcon$z,aD as RefIcon$A,aE as RefIcon$B,aF as RefIcon$C,aG as RefIcon$D,aH as RefIcon$E,aI as RefIcon$F,aJ as RefIcon$G,aK as RefIcon$H,aL as RefIcon$I,aM as RefIcon$J,aN as RefIcon$K,aO as Tree,aP as RefIcon$L,aQ as Pagination,aR as RefIcon$M,aS as RefIcon$N,aT as Popconfirm,aU as RefIcon$O,aV as TimePicker,aW as RefIcon$P,aX as RefIcon$Q,aY as RefIcon$R,aZ as RefIcon$S,a_ as RefIcon$T,a$ as RefIcon$U,b0 as RefIcon$V,b1 as RefIcon$W,b2 as RefIcon$X,b3 as RefIcon$Y,b4 as RefIcon$Z,b5 as staticMethods$1,b6 as List$3,b7 as Skeleton,b8 as RefIcon$_,b9 as RefIcon$$,ba as RefIcon$10,bb as RefIcon$11,bc as RefIcon$12,bd as Collapse,be as RefIcon$13,bf as RefIcon$14,bg as RefIcon$15,bh as RefIcon$16,bi as RefIcon$17,bj as RefIcon$18,bk as RefIcon$19,bl as classNames$1,bm as index,bn as useEvent,bo as reactIsExports,bp as warningOnce$2,i as _asyncToGenerator,k as _regeneratorRuntime,a as _toConsumableArray,h as _defineProperty$2,bq as merge$1,br as _typeof,bs as get,bt as set,b as _inherits,bu as _createSuper,d as _classCallCheck,bv as _assertThisInitialized,bw as isEqual$2,bx as toArray$3,c as _createClass,j as _objectWithoutProperties$2,by as _extends$4,g as _slicedToArray$1,bz as RefIcon$1a,bA as Rate$1,bB as RefIcon$1b,bC as ConfigProvider,bD as Popover$2,bE as weekday}from"./antd-CiVgXYuJ.js";import{c as createClient,_ as __vitePreload}from"./supabase-D0hzhjQg.js";import{L as LineChart,_ as __extends,a as __assign,o as objectSpread2Exports,t as toNumber_1,i as isObject_1,n as now_1,b as __read,c as __spreadArray,d as __rest$1,e as __values,f as __awaiter$1,g as __generator,h as _typeofExports}from"./charts-kWkPs0L-.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},f$1=reactExports,k=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,n={},i=null,o=null;for(s in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)m$1.call(t,s)&&!p.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:k,type:e,key:i,ref:o,props:n,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1,reactJsxRuntime_production_min.jsx=q,reactJsxRuntime_production_min.jsxs=q,jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,utc$1={exports:{}},t2,i2,e2;utc$1.exports=(t2="minute",i2=/[+-]\d\d(?::?\d\d)?/g,e2=/([+-]|\d\d)/g,function(e,t,r){var s=t.prototype;r.utc=function(e){return new t({date:e,utc:!0,args:arguments})},s.utc=function(e){var t=r(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),t2):t},s.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var n=s.parse;s.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),n.call(this,e)};var i=s.init;s.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else i.call(this)};var o=s.utcOffset;s.utcOffset=function(e,t){var r=this.$utils().u;if(r(e))return this.$u?0:r(this.$offset)?o.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(i2);if(!t)return null;var r=(""+t[0]).match(e2)||["-",0,0],s=r[0],n=60*+r[1]+ +r[2];return 0===n?0:"+"===s?n:-n}(e)))return this;var s=Math.abs(e)<=16?60*e:e,n=this;if(t)return n.$offset=s,n.$u=0===e,n;if(0!==e){var i=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(n=this.local().add(s+i,t2)).$offset=s,n.$x.$localOffset=i}else n=this.utc();return n};var a=s.format;s.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return a.call(this,t)},s.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},s.isUTC=function(){return!!this.$u},s.toISOString=function(){return this.toDate().toISOString()},s.toString=function(){return this.toDate().toUTCString()};var l=s.toDate;s.toDate=function(e){return"s"===e&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var c=s.diff;s.diff=function(e,t,s){if(e&&this.$u===e.$u)return c.call(this,e,t,s);var n=this.local(),i=r(e).local();return c.call(n,i,t,s)}});var utcExports=utc$1.exports;const utc=getDefaultExportFromCjs(utcExports);var timezone$1={exports:{}};timezone$1.exports=function(){var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(r,s,n){var i,o=function(e,r,s){void 0===s&&(s={});var n=new Date(e);return function(e,r){void 0===r&&(r={});var s=r.timeZoneName||"short",n=e+"|"+s,i=t[n];return i||(i=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:s}),t[n]=i),i}(r,s).formatToParts(n)},a=function(t,r){for(var s=o(t,r),i=[],a=0;a<s.length;a+=1){var l=s[a],c=l.type,u=l.value,d=e[c];d>=0&&(i[d]=parseInt(u,10))}var p=i[3],m=24===p?0:p,h=i[0]+"-"+i[1]+"-"+i[2]+" "+m+":"+i[4]+":"+i[5]+":000",x=+t;return(n.utc(h).valueOf()-(x-=x%1e3))/6e4},l=s.prototype;l.tz=function(e,t){void 0===e&&(e=i);var r,s=this.utcOffset(),o=this.toDate(),a=o.toLocaleString("en-US",{timeZone:e}),l=Math.round((o-new Date(a))/1e3/60),c=15*-Math.round(o.getTimezoneOffset()/15)-l;if(Number(c)){if(r=n(a,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(c,!0),t){var u=r.utcOffset();r=r.add(s-u,"minute")}}else r=this.utcOffset(0,t);return r.$x.$timezone=e,r},l.offsetName=function(e){var t=this.$x.$timezone||n.tz.guess(),r=o(this.valueOf(),t,{timeZoneName:e}).find(function(e){return"timezonename"===e.type.toLowerCase()});return r&&r.value};var c=l.startOf;l.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return c.call(this,e,t);var r=n(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return c.call(r,e,t).tz(this.$x.$timezone,!0)},n.tz=function(e,t,r){var s=r&&t,o=r||t||i,l=a(+n(),o);if("string"!=typeof e)return n(e).tz(o);var c=function(e,t,r){var s=e-60*t*1e3,n=a(s,r);if(t===n)return[s,t];var i=a(s-=60*(n-t)*1e3,r);return n===i?[s,n]:[e-60*Math.min(n,i)*1e3,Math.max(n,i)]}(n.utc(e,s).valueOf(),l,o),u=c[0],d=c[1],p=n(u).utcOffset(d);return p.$x.$timezone=o,p},n.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},n.tz.setDefault=function(e){i=e}}}();var timezoneExports=timezone$1.exports;const timezone=getDefaultExportFromCjs(timezoneExports);var updateLocale$1={exports:{}};updateLocale$1.exports=function(e,t,r){r.updateLocale=function(e,t){var s=r.Ls[e];if(s)return(t?Object.keys(t):[]).forEach(function(e){s[e]=t[e]}),s}};var updateLocaleExports=updateLocale$1.exports;const updateLocale=getDefaultExportFromCjs(updateLocaleExports);var zhCn={exports:{}},createRoot$1;zhCn.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e),s={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var r=100*e+t;return r<600?"凌晨":r<900?"早上":r<1100?"上午":r<1300?"中午":r<1800?"下午":"晚上"}};return r.default.locale(s,null,!0),s}(requireDayjs_min());var m=reactDomExports;createRoot$1=m.createRoot,m.hydrateRoot;var dist={};Object.defineProperty(dist,"__esModule",{value:!0}),dist.parse=parse$1,dist.serialize=serialize;const cookieNameRegExp=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,cookieValueRegExp=/^[\u0021-\u003A\u003C-\u007E]*$/,domainValueRegExp=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,pathValueRegExp=/^[\u0020-\u003A\u003D-\u007E]*$/,__toString=Object.prototype.toString,NullObject=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function parse$1(e,t){const r=new NullObject,s=e.length;if(s<2)return r;const n=(null==t?void 0:t.decode)||decode;let i=0;do{const t=e.indexOf("=",i);if(-1===t)break;const o=e.indexOf(";",i),a=-1===o?s:o;if(t>a){i=e.lastIndexOf(";",t-1)+1;continue}const l=startIndex(e,i,t),c=endIndex(e,t,l),u=e.slice(l,c);if(void 0===r[u]){let s=startIndex(e,t+1,a),i=endIndex(e,a,s);const o=n(e.slice(s,i));r[u]=o}i=a+1}while(i<s);return r}function startIndex(e,t,r){do{const r=e.charCodeAt(t);if(32!==r&&9!==r)return t}while(++t<r);return r}function endIndex(e,t,r){for(;t>r;){const r=e.charCodeAt(--t);if(32!==r&&9!==r)return t+1}return r}function serialize(e,t,r){const s=(null==r?void 0:r.encode)||encodeURIComponent;if(!cookieNameRegExp.test(e))throw new TypeError(`argument name is invalid: ${e}`);const n=s(t);if(!cookieValueRegExp.test(n))throw new TypeError(`argument val is invalid: ${t}`);let i=e+"="+n;if(!r)return i;if(void 0!==r.maxAge){if(!Number.isInteger(r.maxAge))throw new TypeError(`option maxAge is invalid: ${r.maxAge}`);i+="; Max-Age="+r.maxAge}if(r.domain){if(!domainValueRegExp.test(r.domain))throw new TypeError(`option domain is invalid: ${r.domain}`);i+="; Domain="+r.domain}if(r.path){if(!pathValueRegExp.test(r.path))throw new TypeError(`option path is invalid: ${r.path}`);i+="; Path="+r.path}if(r.expires){if(!isDate(r.expires)||!Number.isFinite(r.expires.valueOf()))throw new TypeError(`option expires is invalid: ${r.expires}`);i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.partitioned&&(i+="; Partitioned"),r.priority){switch("string"==typeof r.priority?r.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${r.priority}`)}}if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${r.sameSite}`)}}return i}function decode(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(e2){return e}}function isDate(e){return"[object Date]"===__toString.call(e)}var PopStateEventType="popstate";function createBrowserHistory(e={}){return getUrlBasedHistory(function(e,t){let{pathname:r,search:s,hash:n}=e.location;return createLocation("",{pathname:r,search:s,hash:n},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:createPath(t)},null,e)}function invariant(e,t){if(!1===e||null==e)throw new Error(t)}function warning$3(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(e2){}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(e,t){return{usr:e.state,key:e.key,idx:t}}function createLocation(e,t,r=null,s){return{pathname:"string"==typeof e?e:e.pathname,search:"",hash:"",..."string"==typeof t?parsePath(t):t,state:r,key:t&&t.key||s||createKey()}}function createPath({pathname:e="/",search:t="",hash:r=""}){return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),r&&"#"!==r&&(e+="#"===r.charAt(0)?r:"#"+r),e}function parsePath(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substring(s),e=e.substring(0,s)),e&&(t.pathname=e)}return t}function getUrlBasedHistory(e,t,r,s={}){let{window:n=document.defaultView,v5Compat:i=!1}=s,o=n.history,a="POP",l=null,c=u();function u(){return(o.state||{idx:null}).idx}function d(){a="POP";let e=u(),t=null==e?null:e-c;c=e,l&&l({action:a,location:m.location,delta:t})}function p(e){return createBrowserURLImpl(e)}null==c&&(c=0,o.replaceState({...o.state,idx:c},""));let m={get action(){return a},get location(){return e(n,o)},listen(e){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(PopStateEventType,d),l=e,()=>{n.removeEventListener(PopStateEventType,d),l=null}},createHref:e=>t(n,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){a="PUSH";let r=createLocation(m.location,e,t);c=u()+1;let s=getHistoryState(r,c),d=m.createHref(r);try{o.pushState(s,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;n.location.assign(d)}i&&l&&l({action:a,location:m.location,delta:1})},replace:function(e,t){a="REPLACE";let r=createLocation(m.location,e,t);c=u();let s=getHistoryState(r,c),n=m.createHref(r);o.replaceState(s,"",n),i&&l&&l({action:a,location:m.location,delta:0})},go:e=>o.go(e)};return m}function createBrowserURLImpl(e,t=!1){let r="http://localhost";"undefined"!=typeof window&&(r="null"!==window.location.origin?window.location.origin:window.location.href),invariant(r,"No window.location.(origin|href) available to create URL");let s="string"==typeof e?e:createPath(e);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=r+s),new URL(s,r)}function matchRoutes(e,t,r="/"){return matchRoutesImpl(e,t,r,!1)}function matchRoutesImpl(e,t,r,s){let n=stripBasename(("string"==typeof t?parsePath(t):t).pathname||"/",r);if(null==n)return null;let i=flattenRoutes(e);rankRouteBranches(i);let o=null;for(let a=0;null==o&&a<i.length;++a){let e=decodePath(n);o=matchRouteBranch(i[a],e,s)}return o}function flattenRoutes(e,t=[],r=[],s=""){let n=(e,n,i)=>{let o={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};o.relativePath.startsWith("/")&&(invariant(o.relativePath.startsWith(s),`Absolute route path "${o.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),o.relativePath=o.relativePath.slice(s.length));let a=joinPaths([s,o.relativePath]),l=r.concat(o);e.children&&e.children.length>0&&(invariant(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${a}".`),flattenRoutes(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:computeScore(a,e.index),routesMeta:l})};return e.forEach((e,t)=>{var r;if(""!==e.path&&(null==(r=e.path)?void 0:r.includes("?")))for(let s of explodeOptionalSegments(e.path))n(e,t,s);else n(e,t)}),t}function explodeOptionalSegments(e){let t=e.split("/");if(0===t.length)return[];let[r,...s]=t,n=r.endsWith("?"),i=r.replace(/\?$/,"");if(0===s.length)return n?[i,""]:[i];let o=explodeOptionalSegments(s.join("/")),a=[];return a.push(...o.map(e=>""===e?i:[i,e].join("/"))),n&&a.push(...o),a.map(t=>e.startsWith("/")&&""===t?"/":t)}function rankRouteBranches(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:compareIndexes(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>"*"===e;function computeScore(e,t){let r=e.split("/"),s=r.length;return r.some(isSplat)&&(s+=splatPenalty),t&&(s+=indexRouteValue),r.filter(e=>!isSplat(e)).reduce((e,t)=>e+(paramRe.test(t)?dynamicSegmentValue:""===t?emptySegmentValue:staticSegmentValue),s)}function compareIndexes(e,t){let r=e.length===t.length&&e.slice(0,-1).every((e,r)=>e===t[r]);return r?e[e.length-1]-t[t.length-1]:0}function matchRouteBranch(e,t,r=!1){let{routesMeta:s}=e,n={},i="/",o=[];for(let a=0;a<s.length;++a){let e=s[a],l=a===s.length-1,c="/"===i?t:t.slice(i.length)||"/",u=matchPath({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&r&&!s[s.length-1].route.index&&(u=matchPath({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(n,u.params),o.push({params:n,pathname:joinPaths([i,u.pathname]),pathnameBase:normalizePathname(joinPaths([i,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(i=joinPaths([i,u.pathnameBase]))}return o}function matchPath(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=compilePath(e.path,e.caseSensitive,e.end),n=t.match(r);if(!n)return null;let i=n[0],o=i.replace(/(.)\/+$/,"$1"),a=n.slice(1);return{params:s.reduce((e,{paramName:t,isOptional:r},s)=>{if("*"===t){let e=a[s]||"";o=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const n=a[s];return e[t]=r&&!n?void 0:(n||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:o,pattern:e}}function compilePath(e,t=!1,r=!0){warning$3("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let s=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,r)=>(s.push({paramName:t,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),s]}function decodePath(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return warning$3(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function stripBasename(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&"/"!==s?null:e.slice(r)||"/"}function resolvePath(e,t="/"){let{pathname:r,search:s="",hash:n=""}="string"==typeof e?parsePath(e):e;return{pathname:r?r.startsWith("/")?r:resolvePathname(r,t):t,search:normalizeSearch(s),hash:normalizeHash(n)}}function resolvePathname(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}function getInvalidPathError(e,t,r,s){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function getResolveToMatches(e){let t=getPathContributingMatches(e);return t.map((e,r)=>r===t.length-1?e.pathname:e.pathnameBase)}function resolveTo(e,t,r,s=!1){let n;"string"==typeof e?n=parsePath(e):(n={...e},invariant(!n.pathname||!n.pathname.includes("?"),getInvalidPathError("?","pathname","search",n)),invariant(!n.pathname||!n.pathname.includes("#"),getInvalidPathError("#","pathname","hash",n)),invariant(!n.search||!n.search.includes("#"),getInvalidPathError("#","search","hash",n)));let i,o=""===e||""===n.pathname,a=o?"/":n.pathname;if(null==a)i=r;else{let e=t.length-1;if(!s&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}i=e>=0?t[e]:"/"}let l=resolvePath(n,i),c=a&&"/"!==a&&a.endsWith("/"),u=(o||"."===a)&&r.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}var joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",normalizeHash=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function isRouteErrorResponse(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";var ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);function useHref(e,{relative:t}={}){invariant(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:s}=reactExports.useContext(NavigationContext),{hash:n,pathname:i,search:o}=useResolvedPath(e,{relative:t}),a=i;return"/"!==r&&(a="/"===i?r:joinPaths([r,i])),s.createHref({pathname:a,search:o,hash:n})}function useInRouterContext(){return null!=reactExports.useContext(LocationContext)}function useLocation(){return invariant(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}RouteErrorContext.displayName="RouteError";var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect$2(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let e=reactExports.useContext(DataRouterContext),{basename:t,navigator:r}=reactExports.useContext(NavigationContext),{matches:s}=reactExports.useContext(RouteContext),{pathname:n}=useLocation(),i=JSON.stringify(getResolveToMatches(s)),o=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{o.current=!0}),reactExports.useCallback((s,a={})=>{if(warning$3(o.current,navigateEffectWarning),!o.current)return;if("number"==typeof s)return void r.go(s);let l=resolveTo(s,JSON.parse(i),n,"path"===a.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:joinPaths([t,l.pathname])),(a.replace?r.replace:r.push)(l,a.state,a)},[t,r,i,n,e])}function useResolvedPath(e,{relative:t}={}){let{matches:r}=reactExports.useContext(RouteContext),{pathname:s}=useLocation(),n=JSON.stringify(getResolveToMatches(r));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(n),s,"path"===t),[e,n,s,t])}function useRoutes(e,t){return useRoutesImpl(e,t)}function useRoutesImpl(e,t,r,s){var n;invariant(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=reactExports.useContext(NavigationContext),{matches:o}=reactExports.useContext(RouteContext),a=o[o.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",d=a&&a.route;{let e=d&&d.path||"";warningOnce$1(c,!d||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let p,m=useLocation();if(t){let e="string"==typeof t?parsePath(t):t;invariant("/"===u||(null==(n=e.pathname)?void 0:n.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${e.pathname}" was given in the \`location\` prop.`),p=e}else p=m;let h=p.pathname||"/",x=h;if("/"!==u){let e=u.replace(/^\//,"").split("/");x="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let f=matchRoutes(e,{pathname:x});warning$3(d||null!=f,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),warning$3(null==f||void 0!==f[f.length-1].route.element||void 0!==f[f.length-1].route.Component||void 0!==f[f.length-1].route.lazy,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=_renderMatches(f&&f.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:joinPaths([u,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:joinPaths([u,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,r,s);return t&&g?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function DefaultErrorComponent(){let e=useRouteError(),t=isRouteErrorResponse(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("p",null,"💿 Hey developer 👋"),reactExports.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",reactExports.createElement("code",{style:i},"ErrorBoundary")," or"," ",reactExports.createElement("code",{style:i},"errorElement")," prop on your route.")),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},t),r?reactExports.createElement("pre",{style:n},r):null,o)}reactExports.createContext(null);var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function RenderedRoute({routeContext:e,match:t,children:r}){let s=reactExports.useContext(DataRouterContext);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),reactExports.createElement(RouteContext.Provider,{value:e},r)}function _renderMatches(e,t=[],r=null,s=null){if(null==e){if(!r)return null;if(r.errors)e=r.matches;else{if(0!==t.length||r.initialized||!(r.matches.length>0))return null;e=r.matches}}let n=e,i=null==r?void 0:r.errors;if(null!=i){let e=n.findIndex(e=>e.route.id&&void 0!==(null==i?void 0:i[e.route.id]));invariant(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),n=n.slice(0,Math.min(n.length,e+1))}let o=!1,a=-1;if(r)for(let l=0;l<n.length;l++){let e=n[l];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(a=l),e.route.id){let{loaderData:t,errors:s}=r,i=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!s||void 0===s[e.route.id]);if(e.route.lazy||i){o=!0,n=a>=0?n.slice(0,a+1):[n[0]];break}}}return n.reduceRight((e,s,l)=>{let c,u=!1,d=null,p=null;r&&(c=i&&s.route.id?i[s.route.id]:void 0,d=s.route.errorElement||defaultErrorElement,o&&(a<0&&0===l?(warningOnce$1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,p=null):a===l&&(u=!0,p=s.route.hydrateFallbackElement||null)));let m=t.concat(n.slice(0,l+1)),h=()=>{let t;return t=c?d:u?p:s.route.Component?reactExports.createElement(s.route.Component,null):s.route.element?s.route.element:e,reactExports.createElement(RenderedRoute,{match:s,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:t})};return r&&(s.route.ErrorBoundary||s.route.errorElement||0===l)?reactExports.createElement(RenderErrorBoundary,{location:r.location,revalidation:r.revalidation,component:d,error:c,children:h(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):h()},null)}function getDataRouterConsoleError(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(e){let t=reactExports.useContext(DataRouterContext);return invariant(t,getDataRouterConsoleError(e)),t}function useDataRouterState(e){let t=reactExports.useContext(DataRouterStateContext);return invariant(t,getDataRouterConsoleError(e)),t}function useRouteContext(e){let t=reactExports.useContext(RouteContext);return invariant(t,getDataRouterConsoleError(e)),t}function useCurrentRouteId(e){let t=useRouteContext(e),r=t.matches[t.matches.length-1];return invariant(r.route.id,`${e} can only be used on routes that contain a unique "id"`),r.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){var e;let t=reactExports.useContext(RouteErrorContext),r=useDataRouterState("useRouteError"),s=useCurrentRouteId("useRouteError");return void 0!==t?t:null==(e=r.errors)?void 0:e[s]}function useNavigateStable(){let{router:e}=useDataRouterContext("useNavigate"),t=useCurrentRouteId("useNavigate"),r=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{r.current=!0}),reactExports.useCallback(async(s,n={})=>{warning$3(r.current,navigateEffectWarning),r.current&&("number"==typeof s?e.navigate(s):await e.navigate(s,{fromRouteId:t,...n}))},[e,t])}var alreadyWarned={};function warningOnce$1(e,t,r){t||alreadyWarned[e]||(alreadyWarned[e]=!0,warning$3(!1,r))}function DataRoutes({routes:e,future:t,state:r}){return useRoutesImpl(e,void 0,r,t)}function Navigate({to:e,replace:t,state:r,relative:s}){invariant(useInRouterContext(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=reactExports.useContext(NavigationContext);warning$3(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=reactExports.useContext(RouteContext),{pathname:o}=useLocation(),a=useNavigate(),l=resolveTo(e,getResolveToMatches(i),o,"path"===s),c=JSON.stringify(l);return reactExports.useEffect(()=>{a(JSON.parse(c),{replace:t,state:r,relative:s})},[a,c,s,t,r]),null}function Route(e){invariant(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:e="/",children:t=null,location:r,navigationType:s="POP",navigator:n,static:i=!1}){invariant(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=e.replace(/^\/*/,"/"),a=reactExports.useMemo(()=>({basename:o,navigator:n,static:i,future:{}}),[o,n,i]);"string"==typeof r&&(r=parsePath(r));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:p="default"}=r,m=reactExports.useMemo(()=>{let e=stripBasename(l,o);return null==e?null:{location:{pathname:e,search:c,hash:u,state:d,key:p},navigationType:s}},[o,l,c,u,d,p,s]);return warning$3(null!=m,`<Router basename="${o}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),null==m?null:reactExports.createElement(NavigationContext.Provider,{value:a},reactExports.createElement(LocationContext.Provider,{children:t,value:m}))}function Routes({children:e,location:t}){return useRoutes(createRoutesFromChildren(e),t)}function createRoutesFromChildren(e,t=[]){let r=[];return reactExports.Children.forEach(e,(e,s)=>{if(!reactExports.isValidElement(e))return;let n=[...t,s];if(e.type===reactExports.Fragment)return void r.push.apply(r,createRoutesFromChildren(e.props.children,n));invariant(e.type===Route,`[${"string"==typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant(!e.props.index||!e.props.children,"An index route cannot have child routes.");let i={id:e.props.id||n.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=createRoutesFromChildren(e.props.children,n)),r.push(i)}),r}reactExports.memo(DataRoutes);var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(e){return null!=e&&"string"==typeof e.tagName}function isButtonElement(e){return isHtmlElement(e)&&"button"===e.tagName.toLowerCase()}function isFormElement(e){return isHtmlElement(e)&&"form"===e.tagName.toLowerCase()}function isInputElement(e){return isHtmlElement(e)&&"input"===e.tagName.toLowerCase()}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,t){return!(0!==e.button||t&&"_self"!==t||isModifiedEvent(e))}function createSearchParams(e=""){return new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let s=e[r];return t.concat(Array.isArray(s)?s.map(e=>[r,e]):[[r,s]])},[]))}function getSearchParamsForLocation(e,t){let r=createSearchParams(e);return t&&t.forEach((e,s)=>{r.has(s)||t.getAll(s).forEach(e=>{r.append(s,e)})}),r}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(null===_formDataSupportsSubmitter)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch(e2){_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(e){return null==e||supportedFormEncTypes.has(e)?e:(warning$3(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null)}function getFormSubmissionInfo(e,t){let r,s,n,i,o;if(isFormElement(e)){let o=e.getAttribute("action");s=o?stripBasename(o,t):null,r=e.getAttribute("method")||defaultMethod,n=getFormEncType(e.getAttribute("enctype"))||defaultEncType,i=new FormData(e)}else if(isButtonElement(e)||isInputElement(e)&&("submit"===e.type||"image"===e.type)){let o=e.form;if(null==o)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||o.getAttribute("action");if(s=a?stripBasename(a,t):null,r=e.getAttribute("formmethod")||o.getAttribute("method")||defaultMethod,n=getFormEncType(e.getAttribute("formenctype"))||getFormEncType(o.getAttribute("enctype"))||defaultEncType,i=new FormData(o,e),!isFormDataSubmitterSupported()){let{name:t,type:r,value:s}=e;if("image"===r){let e=t?`${t}.`:"";i.append(`${e}x`,"0"),i.append(`${e}y`,"0")}else t&&i.append(t,s)}}else{if(isHtmlElement(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=defaultMethod,s=null,n=defaultEncType,o=e}return i&&"text/plain"===n&&(o=i,i=void 0),{action:s,method:r.toLowerCase(),encType:n,formData:i,body:o}}function invariant2(e,t){if(!1===e||null==e)throw new Error(t)}async function loadRouteModule(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"==typeof e.imageSrcSet&&"string"==typeof e.imageSizes:"string"==typeof e.rel&&"string"==typeof e.href)}async function getKeyedPrefetchLinks(e,t,r){return dedupeLinkDescriptors((await Promise.all(e.map(async e=>{let s=t.routes[e.route.id];if(s){let e=await loadRouteModule(s,r);return e.links?e.links():[]}return[]}))).flat(1).filter(isHtmlLinkDescriptor).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"}))}function getNewMatchesForLinks(e,t,r,s,n,i){let o=(e,t)=>!r[t]||e.route.id!==r[t].route.id,a=(e,t)=>{var s;return r[t].pathname!==e.pathname||(null==(s=r[t].route.path)?void 0:s.endsWith("*"))&&r[t].params["*"]!==e.params["*"]};return"assets"===i?t.filter((e,t)=>o(e,t)||a(e,t)):"data"===i?t.filter((t,i)=>{var l;let c=s.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(o(t,i)||a(t,i))return!0;if(t.route.shouldRevalidate){let s=t.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:(null==(l=r[0])?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"==typeof s)return s}return!0}):[]}function getModuleLinkHrefs(e,t,{includeHydrateFallback:r}={}){return dedupeHrefs(e.map(e=>{let s=t.routes[e.route.id];if(!s)return[];let n=[s.module];return s.clientActionModule&&(n=n.concat(s.clientActionModule)),s.clientLoaderModule&&(n=n.concat(s.clientLoaderModule)),r&&s.hydrateFallbackModule&&(n=n.concat(s.hydrateFallbackModule)),s.imports&&(n=n.concat(s.imports)),n}).flat(1))}function dedupeHrefs(e){return[...new Set(e)]}function sortKeys(e){let t={},r=Object.keys(e).sort();for(let s of r)t[s]=e[s];return t}function dedupeLinkDescriptors(e,t){let r=new Set;return new Set(t),e.reduce((e,t)=>{let s=JSON.stringify(sortKeys(t));return r.has(s)||(r.add(s),e.push({key:s,link:t})),e},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var NO_BODY_STATUS_CODES=new Set([100,101,204,205]);function singleFetchUrl(e,t){let r="string"==typeof e?new URL(e,"undefined"==typeof window?"server://singlefetch/":window.location.origin):e;return"/"===r.pathname?r.pathname="_root.data":t&&"/"===stripBasename(r.pathname,t)?r.pathname=`${t.replace(/\/$/,"")}/_root.data`:r.pathname=`${r.pathname.replace(/\/$/,"")}.data`,r}function useDataRouterContext2(){let e=reactExports.useContext(DataRouterContext);return invariant2(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function useDataRouterStateContext(){let e=reactExports.useContext(DataRouterStateContext);return invariant2(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var FrameworkContext=reactExports.createContext(void 0);function useFrameworkContext(){let e=reactExports.useContext(FrameworkContext);return invariant2(e,"You must render this element inside a <HydratedRouter> element"),e}function usePrefetchBehavior(e,t){let r=reactExports.useContext(FrameworkContext),[s,n]=reactExports.useState(!1),[i,o]=reactExports.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=t,p=reactExports.useRef(null);reactExports.useEffect(()=>{if("render"===e&&o(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{o(e.isIntersecting)})},{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}},[e]),reactExports.useEffect(()=>{if(s){let e=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(e)}}},[s]);let m=()=>{n(!0)},h=()=>{n(!1),o(!1)};return r?"intent"!==e?[i,p,{}]:[i,p,{onFocus:composeEventHandlers(a,m),onBlur:composeEventHandlers(l,h),onMouseEnter:composeEventHandlers(c,m),onMouseLeave:composeEventHandlers(u,h),onTouchStart:composeEventHandlers(d,m)}]:[!1,p,{}]}function composeEventHandlers(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function PrefetchPageLinks({page:e,...t}){let{router:r}=useDataRouterContext2(),s=reactExports.useMemo(()=>matchRoutes(r.routes,e,r.basename),[r.routes,e,r.basename]);return s?reactExports.createElement(PrefetchPageLinksImpl,{page:e,matches:s,...t}):null}function useKeyedPrefetchLinks(e){let{manifest:t,routeModules:r}=useFrameworkContext(),[s,n]=reactExports.useState([]);return reactExports.useEffect(()=>{let s=!1;return getKeyedPrefetchLinks(e,t,r).then(e=>{s||n(e)}),()=>{s=!0}},[e,t,r]),s}function PrefetchPageLinksImpl({page:e,matches:t,...r}){let s=useLocation(),{manifest:n,routeModules:i}=useFrameworkContext(),{basename:o}=useDataRouterContext2(),{loaderData:a,matches:l}=useDataRouterStateContext(),c=reactExports.useMemo(()=>getNewMatchesForLinks(e,t,l,n,s,"data"),[e,t,l,n,s]),u=reactExports.useMemo(()=>getNewMatchesForLinks(e,t,l,n,s,"assets"),[e,t,l,n,s]),d=reactExports.useMemo(()=>{if(e===s.pathname+s.search+s.hash)return[];let r=new Set,l=!1;if(t.forEach(e=>{var t;let s=n.routes[e.route.id];s&&s.hasLoader&&(!c.some(t=>t.route.id===e.route.id)&&e.route.id in a&&(null==(t=i[e.route.id])?void 0:t.shouldRevalidate)||s.hasClientLoader?l=!0:r.add(e.route.id))}),0===r.size)return[];let u=singleFetchUrl(e,o);return l&&r.size>0&&u.searchParams.set("_routes",t.filter(e=>r.has(e.route.id)).map(e=>e.route.id).join(",")),[u.pathname+u.search]},[o,a,s,n,c,t,e,i]),p=reactExports.useMemo(()=>getModuleLinkHrefs(u,n),[u,n]),m=useKeyedPrefetchLinks(u);return reactExports.createElement(reactExports.Fragment,null,d.map(e=>reactExports.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...r})),p.map(e=>reactExports.createElement("link",{key:e,rel:"modulepreload",href:e,...r})),m.map(({key:e,link:t})=>reactExports.createElement("link",{key:e,...t})))}function mergeRefs(...e){return t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}}FrameworkContext.displayName="FrameworkContext";var isBrowser$2="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;try{isBrowser$2&&(window.__reactRouterVersion="7.6.3")}catch(e2){}function BrowserRouter({basename:e,children:t,window:r}){let s=reactExports.useRef();null==s.current&&(s.current=createBrowserHistory({window:r,v5Compat:!0}));let n=s.current,[i,o]=reactExports.useState({action:n.action,location:n.location}),a=reactExports.useCallback(e=>{reactExports.startTransition(()=>o(e))},[o]);return reactExports.useLayoutEffect(()=>n.listen(a),[n,a]),reactExports.createElement(Router,{basename:e,children:t,location:i.location,navigationType:i.action,navigator:n})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:s,reloadDocument:n,replace:i,state:o,target:a,to:l,preventScrollReset:c,viewTransition:u,...d},p){let m,{basename:h}=reactExports.useContext(NavigationContext),x="string"==typeof l&&ABSOLUTE_URL_REGEX2.test(l),f=!1;if("string"==typeof l&&x&&(m=l,isBrowser$2))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),r=stripBasename(t.pathname,h);t.origin===e.origin&&null!=r?l=r+t.search+t.hash:f=!0}catch(e2){warning$3(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=useHref(l,{relative:s}),[y,v,E]=usePrefetchBehavior(r,d),j=useLinkClickHandler(l,{replace:i,state:o,target:a,preventScrollReset:c,relative:s,viewTransition:u});let b=reactExports.createElement("a",{...d,...E,href:m||g,onClick:f||n?e:function(t){e&&e(t),t.defaultPrevented||j(t)},ref:mergeRefs(p,v),target:a,"data-discover":x||"render"!==t?void 0:"true"});return y&&!x?reactExports.createElement(reactExports.Fragment,null,b,reactExports.createElement(PrefetchPageLinks,{page:g})):b});Link.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:s=!1,style:n,to:i,viewTransition:o,children:a,...l},c){let u=useResolvedPath(i,{relative:l.relative}),d=useLocation(),p=reactExports.useContext(DataRouterStateContext),{navigator:m,basename:h}=reactExports.useContext(NavigationContext),x=null!=p&&useViewTransitionState(u)&&!0===o,f=m.encodeLocation?m.encodeLocation(u).pathname:u.pathname,g=d.pathname,y=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;t||(g=g.toLowerCase(),y=y?y.toLowerCase():null,f=f.toLowerCase()),y&&h&&(y=stripBasename(y,h)||y);const v="/"!==f&&f.endsWith("/")?f.length-1:f.length;let E,j=g===f||!s&&g.startsWith(f)&&"/"===g.charAt(v),b=null!=y&&(y===f||!s&&y.startsWith(f)&&"/"===y.charAt(f.length)),w={isActive:j,isPending:b,isTransitioning:x},R=j?e:void 0;E="function"==typeof r?r(w):[r,j?"active":null,b?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let _="function"==typeof n?n(w):n;return reactExports.createElement(Link,{...l,"aria-current":R,className:E,ref:c,style:_,to:i,viewTransition:o},"function"==typeof a?a(w):a)});NavLink.displayName="NavLink";var Form$3=reactExports.forwardRef(({discover:e="render",fetcherKey:t,navigate:r,reloadDocument:s,replace:n,state:i,method:o=defaultMethod,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...p},m)=>{let h=useSubmit(),x=useFormAction(a,{relative:c}),f="get"===o.toLowerCase()?"get":"post",g="string"==typeof a&&ABSOLUTE_URL_REGEX2.test(a);return reactExports.createElement("form",{ref:m,method:f,action:x,onSubmit:s?l:e=>{if(l&&l(e),e.defaultPrevented)return;e.preventDefault();let s=e.nativeEvent.submitter,a=(null==s?void 0:s.getAttribute("formmethod"))||o;h(s||e.currentTarget,{fetcherKey:t,method:a,navigate:r,replace:n,state:i,relative:c,preventScrollReset:u,viewTransition:d})},...p,"data-discover":g||"render"!==e?void 0:"true"})});function getDataRouterConsoleError2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(e){let t=reactExports.useContext(DataRouterContext);return invariant(t,getDataRouterConsoleError2(e)),t}function useLinkClickHandler(e,{target:t,replace:r,state:s,preventScrollReset:n,relative:i,viewTransition:o}={}){let a=useNavigate(),l=useLocation(),c=useResolvedPath(e,{relative:i});return reactExports.useCallback(u=>{if(shouldProcessLinkClick(u,t)){u.preventDefault();let t=void 0!==r?r:createPath(l)===createPath(c);a(e,{replace:t,state:s,preventScrollReset:n,relative:i,viewTransition:o})}},[l,a,c,r,s,t,e,n,i,o])}function useSearchParams(e){warning$3("undefined"!=typeof URLSearchParams,"You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=reactExports.useRef(createSearchParams(e)),r=reactExports.useRef(!1),s=useLocation(),n=reactExports.useMemo(()=>getSearchParamsForLocation(s.search,r.current?null:t.current),[s.search]),i=useNavigate(),o=reactExports.useCallback((e,t)=>{const s=createSearchParams("function"==typeof e?e(n):e);r.current=!0,i("?"+s,t)},[i,n]);return[n,o]}Form$3.displayName="Form";var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:e}=useDataRouterContext3("useSubmit"),{basename:t}=reactExports.useContext(NavigationContext),r=useRouteId();return reactExports.useCallback(async(s,n={})=>{let{action:i,method:o,encType:a,formData:l,body:c}=getFormSubmissionInfo(s,t);if(!1===n.navigate){let t=n.fetcherKey||getUniqueFetcherId();await e.fetch(t,r,n.action||i,{preventScrollReset:n.preventScrollReset,formData:l,body:c,formMethod:n.method||o,formEncType:n.encType||a,flushSync:n.flushSync})}else await e.navigate(n.action||i,{preventScrollReset:n.preventScrollReset,formData:l,body:c,formMethod:n.method||o,formEncType:n.encType||a,replace:n.replace,state:n.state,fromRouteId:r,flushSync:n.flushSync,viewTransition:n.viewTransition})},[e,t,r])}function useFormAction(e,{relative:t}={}){let{basename:r}=reactExports.useContext(NavigationContext),s=reactExports.useContext(RouteContext);invariant(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),i={...useResolvedPath(e||".",{relative:t})},o=useLocation();if(null==e){i.search=o.search;let e=new URLSearchParams(i.search),t=e.getAll("index");if(t.some(e=>""===e)){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let r=e.toString();i.search=r?`?${r}`:""}}return e&&"."!==e||!n.route.index||(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),"/"!==r&&(i.pathname="/"===i.pathname?r:joinPaths([r,i.pathname])),createPath(i)}function useViewTransitionState(e,t={}){let r=reactExports.useContext(ViewTransitionContext);invariant(null!=r,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=useDataRouterContext3("useViewTransitionState"),n=useResolvedPath(e,{relative:t.relative});if(!r.isTransitioning)return!1;let i=stripBasename(r.currentLocation.pathname,s)||r.currentLocation.pathname,o=stripBasename(r.nextLocation.pathname,s)||r.nextLocation.pathname;return null!=matchPath(n.pathname,o)||null!=matchPath(n.pathname,i)}let CacheManager$1=(_a=class{constructor(){__publicField(this,"CACHE_VERSION_KEY","app_cache_version"),__publicField(this,"CURRENT_VERSION","1.0.0"),__publicField(this,"CACHE_PREFIX","crm_cache_"),this.initializeVersion()}static getInstance(){return _a.instance||(_a.instance=new _a),_a.instance}initializeVersion(){const e=this.getStoredVersion();e&&e.version===this.CURRENT_VERSION||(console.log(`🔄 [CacheManager] 检测到版本更新: ${(null==e?void 0:e.version)||"未知"} -> ${this.CURRENT_VERSION}`),this.clearAllCaches(),this.setStoredVersion(this.CURRENT_VERSION))}getStoredVersion(){try{const e=localStorage.getItem(this.CACHE_VERSION_KEY);return e?JSON.parse(e):null}catch{return null}}setStoredVersion(e){try{const t={version:e,timestamp:Date.now()};localStorage.setItem(this.CACHE_VERSION_KEY,JSON.stringify(t))}catch(t){console.error("设置版本信息失败:",t)}}clearAllCaches(){console.log("🧹 [CacheManager] 清除所有应用缓存...");const e=[];for(let r=0;r<localStorage.length;r++){const t=localStorage.key(r);t&&t.startsWith(this.CACHE_PREFIX)&&e.push(t)}e.forEach(e=>{localStorage.removeItem(e)});const t=["user_cache","profile_cache","user_cache_timestamp","last_activity_timestamp","session_id","frequency_check","metro_stations_cache"];t.forEach(e=>{localStorage.removeItem(e)}),console.log(`✅ [CacheManager] 已清除 ${e.length+t.length} 个缓存项`)}setCache(e,t,r){try{const r={data:t,timestamp:Date.now(),version:this.CURRENT_VERSION},s=`${this.CACHE_PREFIX}${e}`;localStorage.setItem(s,JSON.stringify(r))}catch(s){console.error("设置缓存失败:",s)}}getCache(e,t){try{const r=`${this.CACHE_PREFIX}${e}`,s=localStorage.getItem(r);if(!s)return null;const n=JSON.parse(s);return n.version!==this.CURRENT_VERSION||t&&Date.now()-n.timestamp>t?(localStorage.removeItem(r),null):n.data}catch(r){return console.error("获取缓存失败:",r),null}}removeCache(e){try{const t=`${this.CACHE_PREFIX}${e}`;localStorage.removeItem(t)}catch(t){console.error("删除缓存失败:",t)}}forceRefreshAll(){console.log("🔄 [CacheManager] 强制刷新所有缓存..."),this.clearAllCaches(),this.setStoredVersion(this.CURRENT_VERSION),window.location.reload()}checkForUpdates(){const e=this.getStoredVersion();return!e||e.version!==this.CURRENT_VERSION}getCurrentVersion(){return this.CURRENT_VERSION}getStoredVersionInfo(){return this.getStoredVersion()}},__publicField(_a,"instance"),_a);const cacheManager=CacheManager$1.getInstance(),useVersionCheck=()=>{const[e,t]=reactExports.useState({current:cacheManager.getCurrentVersion(),stored:null,hasUpdate:!1,lastUpdateTime:null}),[r,s]=reactExports.useState(!1),n=reactExports.useCallback(()=>{const e=cacheManager.getCurrentVersion(),r=cacheManager.getStoredVersionInfo(),s=(null==r?void 0:r.version)||null,n=cacheManager.checkForUpdates(),i=(null==r?void 0:r.timestamp)?new Date(r.timestamp).toLocaleString():null;return t({current:e,stored:s,hasUpdate:n,lastUpdateTime:i}),n},[]),i=reactExports.useCallback(()=>{s(!1),staticMethods.loading("正在刷新缓存...",0),setTimeout(()=>{cacheManager.forceRefreshAll()},1e3)},[]),o=reactExports.useCallback(()=>{s(!1),localStorage.setItem("ignore_version_update",Date.now().toString())},[]);return reactExports.useEffect(()=>{const e=n(),t=localStorage.getItem("ignore_version_update");e&&(!t||Date.now()-parseInt(t)>864e5)&&s(!0);const r=setInterval(()=>{n()},3e5);return()=>clearInterval(r)},[n]),reactExports.useEffect(()=>{const e=()=>{document.hidden||n()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[n]),{versionInfo:e,showUpdateModal:r,checkVersion:n,forceRefresh:i,ignoreUpdate:o,setShowUpdateModal:s}},VersionUpdateModal=({visible:e,versionInfo:t,onRefresh:r,onIgnore:s,onCancel:n})=>jsxRuntimeExports.jsx(Modal$2,{title:"🔄 检测到应用更新",open:e,onOk:r,onCancel:n,okText:"立即更新",cancelText:"稍后提醒",width:500,okButtonProps:{type:"primary"},children:jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("p",{children:"检测到应用有新版本，建议刷新缓存以获得最新功能："}),jsxRuntimeExports.jsxs("div",{style:{background:"#f5f5f5",padding:12,borderRadius:6,marginBottom:16},children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"当前版本："}),t.current]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"存储版本："}),t.stored||"未知"]}),t.lastUpdateTime&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"最后更新："}),t.lastUpdateTime]})]}),jsxRuntimeExports.jsx("p",{children:"更新后将清除所有本地缓存，页面会自动刷新。"})]})});var lottie$1={exports:{}};(function(module,exports){var factory;"undefined"!=typeof document&&"undefined"!=typeof navigator&&(factory=function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,t){var r,s,n=e.length;for(r=0;r<n;r+=1)for(var i in s=e[r].prototype)Object.prototype.hasOwnProperty.call(s,i)&&(t.prototype[i]=s[i])}function getDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)}function createProxyFunction(e){function t(){}return t.prototype=e,t}var audioControllerFactory=function(){function e(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(e){this.audios.push(e)},pause:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].pause()},resume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].resume()},setRate:function(e){var t,r=this.audios.length;for(t=0;t<r;t+=1)this.audios[t].setRate(e)},createAudio:function(e){return this.audioFactory?this.audioFactory(e):window.Howl?new window.Howl({src:[e]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(e){this.audioFactory=e},setVolume:function(e){this._volume=e,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(e,t){var r,s=0,n=[];switch(e){case"int16":case"uint8c":r=1;break;default:r=1.1}for(s=0;s<t;s+=1)n.push(r);return n}return"function"==typeof Uint8ClampedArray&&"function"==typeof Float32Array?function(t,r){return"float32"===t?new Float32Array(r):"int16"===t?new Int16Array(r):"uint8c"===t?new Uint8ClampedArray(r):e(t,r)}:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){return(_typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};!function(){var e,t=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],r=t.length;for(e=0;e<r;e+=1)BMMath[t[e]]=Math[t[e]]}(),BMMath.random=Math.random,BMMath.abs=function(e){if("object"===_typeof$6(e)&&e.length){var t,r=createSizedArray(e.length),s=e.length;for(t=0;t<s;t+=1)r[t]=Math.abs(e[t]);return r}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,t,r,s){this.type=e,this.currentTime=t,this.totalTime=r,this.direction=s<0?-1:1}function BMCompleteEvent(e,t){this.type=e,this.direction=t<0?-1:1}function BMCompleteLoopEvent(e,t,r,s){this.type=e,this.currentLoop=r,this.totalLoops=t,this.direction=s<0?-1:1}function BMSegmentStartEvent(e,t,r){this.type=e,this.firstFrame=t,this.totalFrames=r}function BMDestroyEvent(e,t){this.type=e,this.target=t}function BMRenderFrameErrorEvent(e,t){this.type="renderFrameError",this.nativeError=e,this.currentTime=t}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return idPrefix$1+"__lottie_element_"+(e+=1)}}();function HSVtoRGB(e,t,r){var s,n,i,o,a,l,c,u;switch(l=r*(1-t),c=r*(1-(a=6*e-(o=Math.floor(6*e)))*t),u=r*(1-(1-a)*t),o%6){case 0:s=r,n=u,i=l;break;case 1:s=c,n=r,i=l;break;case 2:s=l,n=r,i=u;break;case 3:s=l,n=c,i=r;break;case 4:s=u,n=l,i=r;break;case 5:s=r,n=l,i=c}return[s,n,i]}function RGBtoHSV(e,t,r){var s,n=Math.max(e,t,r),i=Math.min(e,t,r),o=n-i,a=0===n?0:o/n,l=n/255;switch(n){case i:s=0;break;case e:s=t-r+o*(t<r?6:0),s/=6*o;break;case t:s=r-e+2*o,s/=6*o;break;case r:s=e-t+4*o,s/=6*o}return[s,a,l]}function addSaturationToRGB(e,t){var r=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return r[1]+=t,r[1]>1?r[1]=1:r[1]<=0&&(r[1]=0),HSVtoRGB(r[0],r[1],r[2])}function addBrightnessToRGB(e,t){var r=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return r[2]+=t,r[2]>1?r[2]=1:r[2]<0&&(r[2]=0),HSVtoRGB(r[0],r[1],r[2])}function addHueToRGB(e,t){var r=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return r[0]+=t/360,r[0]>1?r[0]-=1:r[0]<0&&(r[0]+=1),HSVtoRGB(r[0],r[1],r[2])}var rgbToHex=function(){var e,t,r=[];for(e=0;e<256;e+=1)t=e.toString(16),r[e]=1===t.length?"0"+t:t;return function(e,t,s){return e<0&&(e=0),t<0&&(t=0),s<0&&(s=0),"#"+r[e]+r[t]+r[s]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){return(_typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var dataManager=function(){var e,t,r=1,s=[],n={onmessage:function(){},postMessage:function(t){e({data:t})}},i={postMessage:function(e){n.onmessage({data:e})}};function o(){t||(t=function(t){if(window.Worker&&window.Blob&&getWebWorker()){var r=new Blob(["var _workerSelf = self; self.onmessage = ",t.toString()],{type:"text/javascript"}),s=URL.createObjectURL(r);return new Worker(s)}return e=t,n}(function(e){if(i.dataManager||(i.dataManager=function(){function e(n,i){var o,a,l,c,d,p,m=n.length;for(a=0;a<m;a+=1)if("ks"in(o=n[a])&&!o.completed){if(o.completed=!0,o.hasMask){var h=o.masksProperties;for(c=h.length,l=0;l<c;l+=1)if(h[l].pt.k.i)s(h[l].pt.k);else for(p=h[l].pt.k.length,d=0;d<p;d+=1)h[l].pt.k[d].s&&s(h[l].pt.k[d].s[0]),h[l].pt.k[d].e&&s(h[l].pt.k[d].e[0])}0===o.ty?(o.layers=t(o.refId,i),e(o.layers,i)):4===o.ty?r(o.shapes):5===o.ty&&u(o)}}function t(e,t){var r=function(e,t){for(var r=0,s=t.length;r<s;){if(t[r].id===e)return t[r];r+=1}return null}(e,t);return r?r.layers.__used?JSON.parse(JSON.stringify(r.layers)):(r.layers.__used=!0,r.layers):null}function r(e){var t,n,i;for(t=e.length-1;t>=0;t-=1)if("sh"===e[t].ty)if(e[t].ks.k.i)s(e[t].ks.k);else for(i=e[t].ks.k.length,n=0;n<i;n+=1)e[t].ks.k[n].s&&s(e[t].ks.k[n].s[0]),e[t].ks.k[n].e&&s(e[t].ks.k[n].e[0]);else"gr"===e[t].ty&&r(e[t].it)}function s(e){var t,r=e.i.length;for(t=0;t<r;t+=1)e.i[t][0]+=e.v[t][0],e.i[t][1]+=e.v[t][1],e.o[t][0]+=e.v[t][0],e.o[t][1]+=e.v[t][1]}function n(e,t){var r=t?t.split("."):[100,100,100];return e[0]>r[0]||!(r[0]>e[0])&&(e[1]>r[1]||!(r[1]>e[1])&&(e[2]>r[2]||!(r[2]>e[2])&&null))}var i=function(){var e=[4,4,14];function t(e){var t=e.t.d;e.t.d={k:[{s:t,t:0}]}}function r(e){var r,s=e.length;for(r=0;r<s;r+=1)5===e[r].ty&&t(e[r])}return function(t){if(n(e,t.v)&&(r(t.layers),t.assets)){var s,i=t.assets.length;for(s=0;s<i;s+=1)t.assets[s].layers&&r(t.assets[s].layers)}}}(),o=function(){var e=[4,7,99];return function(t){if(t.chars&&!n(e,t.v)){var s,i=t.chars.length;for(s=0;s<i;s+=1){var o=t.chars[s];o.data&&o.data.shapes&&(r(o.data.shapes),o.data.ip=0,o.data.op=99999,o.data.st=0,o.data.sr=1,o.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},t.chars[s].t||(o.data.shapes.push({ty:"no"}),o.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),a=function(){var e=[5,7,15];function t(e){var t=e.t.p;"number"==typeof t.a&&(t.a={a:0,k:t.a}),"number"==typeof t.p&&(t.p={a:0,k:t.p}),"number"==typeof t.r&&(t.r={a:0,k:t.r})}function r(e){var r,s=e.length;for(r=0;r<s;r+=1)5===e[r].ty&&t(e[r])}return function(t){if(n(e,t.v)&&(r(t.layers),t.assets)){var s,i=t.assets.length;for(s=0;s<i;s+=1)t.assets[s].layers&&r(t.assets[s].layers)}}}(),l=function(){var e=[4,1,9];function t(e){var r,s,n,i=e.length;for(r=0;r<i;r+=1)if("gr"===e[r].ty)t(e[r].it);else if("fl"===e[r].ty||"st"===e[r].ty)if(e[r].c.k&&e[r].c.k[0].i)for(n=e[r].c.k.length,s=0;s<n;s+=1)e[r].c.k[s].s&&(e[r].c.k[s].s[0]/=255,e[r].c.k[s].s[1]/=255,e[r].c.k[s].s[2]/=255,e[r].c.k[s].s[3]/=255),e[r].c.k[s].e&&(e[r].c.k[s].e[0]/=255,e[r].c.k[s].e[1]/=255,e[r].c.k[s].e[2]/=255,e[r].c.k[s].e[3]/=255);else e[r].c.k[0]/=255,e[r].c.k[1]/=255,e[r].c.k[2]/=255,e[r].c.k[3]/=255}function r(e){var r,s=e.length;for(r=0;r<s;r+=1)4===e[r].ty&&t(e[r].shapes)}return function(t){if(n(e,t.v)&&(r(t.layers),t.assets)){var s,i=t.assets.length;for(s=0;s<i;s+=1)t.assets[s].layers&&r(t.assets[s].layers)}}}(),c=function(){var e=[4,4,18];function t(e){var r,s,n;for(r=e.length-1;r>=0;r-=1)if("sh"===e[r].ty)if(e[r].ks.k.i)e[r].ks.k.c=e[r].closed;else for(n=e[r].ks.k.length,s=0;s<n;s+=1)e[r].ks.k[s].s&&(e[r].ks.k[s].s[0].c=e[r].closed),e[r].ks.k[s].e&&(e[r].ks.k[s].e[0].c=e[r].closed);else"gr"===e[r].ty&&t(e[r].it)}function r(e){var r,s,n,i,o,a,l=e.length;for(s=0;s<l;s+=1){if((r=e[s]).hasMask){var c=r.masksProperties;for(i=c.length,n=0;n<i;n+=1)if(c[n].pt.k.i)c[n].pt.k.c=c[n].cl;else for(a=c[n].pt.k.length,o=0;o<a;o+=1)c[n].pt.k[o].s&&(c[n].pt.k[o].s[0].c=c[n].cl),c[n].pt.k[o].e&&(c[n].pt.k[o].e[0].c=c[n].cl)}4===r.ty&&t(r.shapes)}}return function(t){if(n(e,t.v)&&(r(t.layers),t.assets)){var s,i=t.assets.length;for(s=0;s<i;s+=1)t.assets[s].layers&&r(t.assets[s].layers)}}}();function u(e){0===e.t.a.length&&e.t.p}var d={completeData:function(r){r.__complete||(l(r),i(r),o(r),a(r),c(r),e(r.layers,r.assets),function(r,s){if(r){var n=0,i=r.length;for(n=0;n<i;n+=1)1===r[n].t&&(r[n].data.layers=t(r[n].data.refId,s),e(r[n].data.layers,s))}}(r.chars,r.assets),r.__complete=!0)}};return d.checkColors=l,d.checkChars=o,d.checkPathProperties=a,d.checkShapes=c,d.completeLayers=e,d}()),i.assetLoader||(i.assetLoader=function(){function e(e){var t=e.getResponseHeader("content-type");return t&&"json"===e.responseType&&-1!==t.indexOf("json")||e.response&&"object"===_typeof$5(e.response)?e.response:e.response&&"string"==typeof e.response?JSON.parse(e.response):e.responseText?JSON.parse(e.responseText):null}return{load:function(t,r,s,n){var i,o=new XMLHttpRequest;try{o.responseType="json"}catch(a){}o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)i=e(o),s(i);else try{i=e(o),s(i)}catch(a){n&&n(a)}};try{o.open(["G","E","T"].join(""),t,!0)}catch(l){o.open(["G","E","T"].join(""),r+"/"+t,!0)}o.send()}}}()),"loadAnimation"===e.data.type)i.assetLoader.load(e.data.path,e.data.fullPath,function(t){i.dataManager.completeData(t),i.postMessage({id:e.data.id,payload:t,status:"success"})},function(){i.postMessage({id:e.data.id,status:"error"})});else if("complete"===e.data.type){var t=e.data.animation;i.dataManager.completeData(t),i.postMessage({id:e.data.id,payload:t,status:"success"})}else"loadData"===e.data.type&&i.assetLoader.load(e.data.path,e.data.fullPath,function(t){i.postMessage({id:e.data.id,payload:t,status:"success"})},function(){i.postMessage({id:e.data.id,status:"error"})})}),t.onmessage=function(e){var t=e.data,r=t.id,n=s[r];s[r]=null,"success"===t.status?n.onComplete(t.payload):n.onError&&n.onError()})}function a(e,t){var n="processId_"+(r+=1);return s[n]={onComplete:e,onError:t},n}return{loadAnimation:function(e,r,s){o();var n=a(r,s);t.postMessage({type:"loadAnimation",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},loadData:function(e,r,s){o();var n=a(r,s);t.postMessage({type:"loadData",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},completeAnimation:function(e,r,s){o();var n=a(r,s);t.postMessage({type:"complete",animation:e,id:n})}}}(),ImagePreloader=function(){var e=function(){var e=createTag("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),e}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function r(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function s(e,t,r){var s="";if(e.e)s=e.p;else if(t){var n=e.p;-1!==n.indexOf("images/")&&(n=n.split("/")[1]),s=t+n}else s=r,s+=e.u?e.u:"",s+=e.p;return s}function n(e){var t=0,r=setInterval(function(){(e.getBBox().width||t>500)&&(this._imageLoaded(),clearInterval(r)),t+=1}.bind(this),50)}function i(e){var t={assetData:e},r=s(e,this.assetsPath,this.path);return dataManager.loadData(r,function(e){t.img=e,this._footageLoaded()}.bind(this),function(){t.img={},this._footageLoaded()}.bind(this)),t}function o(){this._imageLoaded=t.bind(this),this._footageLoaded=r.bind(this),this.testImageLoaded=n.bind(this),this.createFootageData=i.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return o.prototype={loadAssets:function(e,t){var r;this.imagesLoadedCb=t;var s=e.length;for(r=0;r<s;r+=1)e[r].layers||(e[r].t&&"seq"!==e[r].t?3===e[r].t&&(this.totalFootages+=1,this.images.push(this.createFootageData(e[r]))):(this.totalImages+=1,this.images.push(this._createImageData(e[r]))))},setAssetsPath:function(e){this.assetsPath=e||""},setPath:function(e){this.path=e||""},loadedImages:function(){return this.totalImages===this.loadedAssets},loadedFootages:function(){return this.totalFootages===this.loadedFootagesCount},destroy:function(){this.imagesLoadedCb=null,this.images.length=0},getAsset:function(e){for(var t=0,r=this.images.length;t<r;){if(this.images[t].assetData===e)return this.images[t].img;t+=1}return null},createImgData:function(t){var r=s(t,this.assetsPath,this.path),n=createTag("img");n.crossOrigin="anonymous",n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){i.img=e,this._imageLoaded()}.bind(this),!1),n.src=r;var i={img:n,assetData:t};return i},createImageData:function(t){var r=s(t,this.assetsPath,this.path),n=createNS("image");isSafari?this.testImageLoaded(n):n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){i.img=e,this._imageLoaded()}.bind(this),!1),n.setAttributeNS("http://www.w3.org/1999/xlink","href",r),this._elementHelper.append?this._elementHelper.append(n):this._elementHelper.appendChild(n);var i={img:n,assetData:t};return i},imageLoaded:t,footageLoaded:r,setCacheType:function(e,t){"svg"===e?(this._elementHelper=t,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}},o}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var r=this._cbs[e],s=0;s<r.length;s+=1)r[s](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),function(){this.removeEventListener(e,t)}.bind(this)},removeEventListener:function(e,t){if(t){if(this._cbs[e]){for(var r=0,s=this._cbs[e].length;r<s;)this._cbs[e][r]===t&&(this._cbs[e].splice(r,1),r-=1,s-=1),r+=1;this._cbs[e].length||(this._cbs[e]=null)}}else this._cbs[e]=null}};var markerParser=function(){function e(e){for(var t,r=e.split("\r\n"),s={},n=0,i=0;i<r.length;i+=1)2===(t=r[i].split(":")).length&&(s[t[0]]=t[1].trim(),n+=1);if(0===n)throw new Error;return s}return function(t){for(var r=[],s=0;s<t.length;s+=1){var n=t[s],i={time:n.tm,duration:n.dr};try{i.payload=JSON.parse(t[s].cm)}catch(o){try{i.payload=e(t[s].cm)}catch(a){i.payload={name:t[s].cm}}}r.push(i)}return r}}(),ProjectInterface=function(){function e(e){this.compositions.push(e)}return function(){function t(e){for(var t=0,r=this.compositions.length;t<r;){if(this.compositions[t].data&&this.compositions[t].data.nm===e)return this.compositions[t].prepareFrame&&this.compositions[t].data.xt&&this.compositions[t].prepareFrame(this.currentFrame),this.compositions[t].compInterface;t+=1}return null}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){return(_typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var t="svg";e.animType?t=e.animType:e.renderer&&(t=e.renderer);var r=getRenderer(t);this.renderer=new r(this,e.rendererSettings),this.imagePreloader.setCacheType(t,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=t,""===e.loop||null===e.loop||void 0===e.loop||!0===e.loop?this.loop=!0:!1===e.loop?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay=!("autoplay"in e)||e.autoplay,this.name=e.name?e.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(e,"autoloadSegments")||e.autoloadSegments,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(-1!==e.path.lastIndexOf("\\")?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,t){t&&"object"!==_typeof$4(t)&&(t=JSON.parse(t));var r={wrapper:e,animationData:t},s=e.attributes;r.path=s.getNamedItem("data-animation-path")?s.getNamedItem("data-animation-path").value:s.getNamedItem("data-bm-path")?s.getNamedItem("data-bm-path").value:s.getNamedItem("bm-path")?s.getNamedItem("bm-path").value:"",r.animType=s.getNamedItem("data-anim-type")?s.getNamedItem("data-anim-type").value:s.getNamedItem("data-bm-type")?s.getNamedItem("data-bm-type").value:s.getNamedItem("bm-type")?s.getNamedItem("bm-type").value:s.getNamedItem("data-bm-renderer")?s.getNamedItem("data-bm-renderer").value:s.getNamedItem("bm-renderer")?s.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var n=s.getNamedItem("data-anim-loop")?s.getNamedItem("data-anim-loop").value:s.getNamedItem("data-bm-loop")?s.getNamedItem("data-bm-loop").value:s.getNamedItem("bm-loop")?s.getNamedItem("bm-loop").value:"";"false"===n?r.loop=!1:"true"===n?r.loop=!0:""!==n&&(r.loop=parseInt(n,10));var i=s.getNamedItem("data-anim-autoplay")?s.getNamedItem("data-anim-autoplay").value:s.getNamedItem("data-bm-autoplay")?s.getNamedItem("data-bm-autoplay").value:!s.getNamedItem("bm-autoplay")||s.getNamedItem("bm-autoplay").value;r.autoplay="false"!==i,r.name=s.getNamedItem("data-name")?s.getNamedItem("data-name").value:s.getNamedItem("data-bm-name")?s.getNamedItem("data-bm-name").value:s.getNamedItem("bm-name")?s.getNamedItem("bm-name").value:"","false"===(s.getNamedItem("data-anim-prerender")?s.getNamedItem("data-anim-prerender").value:s.getNamedItem("data-bm-prerender")?s.getNamedItem("data-bm-prerender").value:s.getNamedItem("bm-prerender")?s.getNamedItem("bm-prerender").value:"")&&(r.prerender=!1),r.path?this.setParams(r):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var t,r,s=this.animationData.layers,n=s.length,i=e.layers,o=i.length;for(r=0;r<o;r+=1)for(t=0;t<n;){if(s[t].id===i[r].id){s[t]=i[r];break}t+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(n=e.assets.length,t=0;t<n;t+=1)this.animationData.assets.push(e.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||0===e.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var t=e.shift();this.timeCompleted=t.time*this.frameRate;var r=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(r,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||"canvas"!==this.renderer.rendererType)&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,t){var r="number"==typeof e?e:void 0,s="number"==typeof t?t:void 0;this.renderer.updateContainerSize(r,s)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||!0===this.isPaused&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||!1===this.isPaused&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var t,r=0;r<this.markers.length;r+=1)if((t=this.markers[r]).payload&&t.payload.name===e)return t;return null},AnimationItem.prototype.goToAndStop=function(e,t,r){if(!r||this.name===r){var s=Number(e);if(isNaN(s)){var n=this.getMarkerData(e);n&&this.goToAndStop(n.time,!0)}else t?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,t,r){if(!r||this.name===r){var s=Number(e);if(isNaN(s)){var n=this.getMarkerData(e);n&&(n.duration?this.playSegments([n.time,n.time+n.duration],!0):this.goToAndStop(n.time,!0))}else this.goToAndStop(s,t,r);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!0!==this.isPaused&&!1!==this.isLoaded){var t=this.currentRawFrame+e*this.frameModifier,r=!1;t>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?t>=this.totalFrames?(this.playCount+=1,this.checkSegments(t%this.totalFrames)||(this.setCurrentRawFrameValue(t%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(t):this.checkSegments(t>this.totalFrames?t%this.totalFrames:0)||(r=!0,t=this.totalFrames-1):t<0?this.checkSegments(t%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(r=!0,t=0):(this.setCurrentRawFrameValue(this.totalFrames+t%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(t),r&&(this.setCurrentRawFrameValue(t),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,t){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-t)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+t)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,t){var r=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?r=e:this.currentRawFrame+this.firstFrame>t&&(r=t-e)),this.firstFrame=e,this.totalFrames=t-e,this.timeCompleted=this.totalFrames,-1!==r&&this.goToAndStop(r,!0)},AnimationItem.prototype.playSegments=function(e,t){if(t&&(this.segments.length=0),"object"===_typeof$4(e[0])){var r,s=e.length;for(r=0;r<s;r+=1)this.segments.push(e[r])}else this.segments.push(e);this.segments.length&&t&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),e),!0)},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,t){t&&this.name!==t||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var t="";if(e.e)t=e.p;else if(this.assetsPath){var r=e.p;-1!==r.indexOf("images/")&&(r=r.split("/")[1]),t=this.assetsPath+r}else t=this.path,t+=e.u?e.u:"",t+=e.p;return t},AnimationItem.prototype.getAssetData=function(e){for(var t=0,r=this.assets.length;t<r;){if(e===this.assets[t].id)return this.assets[t];t+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,t,r){try{this.renderer.getElementByPath(e).updateDocumentData(t,r)}catch(s){}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}"enterFrame"===e&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===e&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),"complete"===e&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),"segmentStart"===e&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),"destroy"===e&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var t=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)},AnimationItem.prototype.triggerConfigError=function(e){var t=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)};var animationManager=function(){var e={},t=[],r=0,s=0,n=0,i=!0,o=!1;function a(e){for(var r=0,n=e.target;r<s;)t[r].animation===n&&(t.splice(r,1),r-=1,s-=1,n.isPaused||u()),r+=1}function l(e,r){if(!e)return null;for(var n=0;n<s;){if(t[n].elem===e&&null!==t[n].elem)return t[n].animation;n+=1}var i=new AnimationItem;return d(i,e),i.setData(e,r),i}function c(){n+=1,h()}function u(){n-=1}function d(e,r){e.addEventListener("destroy",a),e.addEventListener("_active",c),e.addEventListener("_idle",u),t.push({elem:r,animation:e}),s+=1}function p(e){var a,l=e-r;for(a=0;a<s;a+=1)t[a].animation.advanceTime(l);r=e,n&&!o?window.requestAnimationFrame(p):i=!0}function m(e){r=e,window.requestAnimationFrame(p)}function h(){!o&&n&&i&&(window.requestAnimationFrame(m),i=!1)}return e.registerAnimation=l,e.loadAnimation=function(e){var t=new AnimationItem;return d(t,null),t.setParams(e),t},e.setSpeed=function(e,r){var n;for(n=0;n<s;n+=1)t[n].animation.setSpeed(e,r)},e.setDirection=function(e,r){var n;for(n=0;n<s;n+=1)t[n].animation.setDirection(e,r)},e.play=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.play(e)},e.pause=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.pause(e)},e.stop=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.stop(e)},e.togglePause=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.togglePause(e)},e.searchAnimations=function(e,t,r){var s,n=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),i=n.length;for(s=0;s<i;s+=1)r&&n[s].setAttribute("data-bm-type",r),l(n[s],e);if(t&&0===i){r||(r="svg");var o=document.getElementsByTagName("body")[0];o.innerText="";var a=createTag("div");a.style.width="100%",a.style.height="100%",a.setAttribute("data-bm-type",r),o.appendChild(a),l(a,e)}},e.resize=function(){var e;for(e=0;e<s;e+=1)t[e].animation.resize()},e.goToAndStop=function(e,r,n){var i;for(i=0;i<s;i+=1)t[i].animation.goToAndStop(e,r,n)},e.destroy=function(e){var r;for(r=s-1;r>=0;r-=1)t[r].animation.destroy(e)},e.freeze=function(){o=!0},e.unfreeze=function(){o=!1,h()},e.setVolume=function(e,r){var n;for(n=0;n<s;n+=1)t[n].animation.setVolume(e,r)},e.mute=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.mute(e)},e.unmute=function(e){var r;for(r=0;r<s;r+=1)t[r].animation.unmute(e)},e.getRegisteredAnimations=function(){var e,r=t.length,s=[];for(e=0;e<r;e+=1)s.push(t[e].animation);return s},e}(),BezierFactory=function(){var e={getBezierEasing:function(e,r,s,n,i){var o=i||("bez_"+e+"_"+r+"_"+s+"_"+n).replace(/\./g,"p");if(t[o])return t[o];var a=new u([e,r,s,n]);return t[o]=a,a}},t={},r=11,s=1/(r-1),n="function"==typeof Float32Array;function i(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function a(e){return 3*e}function l(e,t,r){return((i(t,r)*e+o(t,r))*e+a(t))*e}function c(e,t,r){return 3*i(t,r)*e*e+2*o(t,r)*e+a(t)}function u(e){this._p=e,this._mSampleValues=n?new Float32Array(r):new Array(r),this._precomputed=!1,this.get=this.get.bind(this)}return u.prototype={get:function(e){var t=this._p[0],r=this._p[1],s=this._p[2],n=this._p[3];return this._precomputed||this._precompute(),t===r&&s===n?e:0===e?0:1===e?1:l(this._getTForX(e),r,n)},_precompute:function(){var e=this._p[0],t=this._p[1],r=this._p[2],s=this._p[3];this._precomputed=!0,e===t&&r===s||this._calcSampleValues()},_calcSampleValues:function(){for(var e=this._p[0],t=this._p[2],n=0;n<r;++n)this._mSampleValues[n]=l(n*s,e,t)},_getTForX:function(e){for(var t=this._p[0],n=this._p[2],i=this._mSampleValues,o=0,a=1,u=r-1;a!==u&&i[a]<=e;++a)o+=s;var d=o+(e-i[--a])/(i[a+1]-i[a])*s,p=c(d,t,n);return p>=.001?function(e,t,r,s){for(var n=0;n<4;++n){var i=c(t,r,s);if(0===i)return t;t-=(l(t,r,s)-e)/i}return t}(e,d,t,n):0===p?d:function(e,t,r,s,n){var i,o,a=0;do{(i=l(o=t+(r-t)/2,s,n)-e)>0?r=o:t=o}while(Math.abs(i)>1e-7&&++a<10);return o}(e,o,o+s,t,n)}},e}(),pooling=function(){return{double:function(e){return e.concat(createSizedArray(e.length))}}}(),poolFactory=function(){return function(e,t,r){var s=0,n=e,i=createSizedArray(n);return{newElement:function(){return s?i[s-=1]:t()},release:function(e){s===n&&(i=pooling.double(i),n*=2),r&&r(e),i[s]=e,s+=1}}}}(),bezierLengthPool=poolFactory(8,function(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}),segmentsLengthPool=poolFactory(8,function(){return{lengths:[],totalLength:0}},function(e){var t,r=e.lengths.length;for(t=0;t<r;t+=1)bezierLengthPool.release(e.lengths[t]);e.lengths.length=0});function bezFunction(){var e=Math;function t(e,t,r,s,n,i){var o=e*s+t*n+r*i-n*s-i*e-r*t;return o>-.001&&o<.001}var r=function(){return function(e,t,r,s){var n,i,o,a,l,c,u=getDefaultCurveSegments(),d=0,p=[],m=[],h=bezierLengthPool.newElement();for(o=r.length,n=0;n<u;n+=1){for(l=n/(u-1),c=0,i=0;i<o;i+=1)a=bmPow(1-l,3)*e[i]+3*bmPow(1-l,2)*l*r[i]+3*(1-l)*bmPow(l,2)*s[i]+bmPow(l,3)*t[i],p[i]=a,null!==m[i]&&(c+=bmPow(p[i]-m[i],2)),m[i]=p[i];c&&(d+=c=bmSqrt(c)),h.percents[n]=l,h.lengths[n]=d}return h.addedLength=d,h}}();function s(e){this.segmentLength=0,this.points=new Array(e)}function n(e,t){this.partialLength=e,this.point=t}var i=function(){var e={};return function(r,i,o,a){var l=(r[0]+"_"+r[1]+"_"+i[0]+"_"+i[1]+"_"+o[0]+"_"+o[1]+"_"+a[0]+"_"+a[1]).replace(/\./g,"p");if(!e[l]){var c,u,d,p,m,h,x,f=getDefaultCurveSegments(),g=0,y=null;2===r.length&&(r[0]!==i[0]||r[1]!==i[1])&&t(r[0],r[1],i[0],i[1],r[0]+o[0],r[1]+o[1])&&t(r[0],r[1],i[0],i[1],i[0]+a[0],i[1]+a[1])&&(f=2);var v=new s(f);for(d=o.length,c=0;c<f;c+=1){for(x=createSizedArray(d),m=c/(f-1),h=0,u=0;u<d;u+=1)p=bmPow(1-m,3)*r[u]+3*bmPow(1-m,2)*m*(r[u]+o[u])+3*(1-m)*bmPow(m,2)*(i[u]+a[u])+bmPow(m,3)*i[u],x[u]=p,null!==y&&(h+=bmPow(x[u]-y[u],2));g+=h=bmSqrt(h),v.points[c]=new n(h,x),y=x}v.segmentLength=g,e[l]=v}return e[l]}}();function o(e,t){var r=t.percents,s=t.lengths,n=r.length,i=bmFloor((n-1)*e),o=e*t.addedLength,a=0;if(i===n-1||0===i||o===s[i])return r[i];for(var l=s[i]>o?-1:1,c=!0;c;)if(s[i]<=o&&s[i+1]>o?(a=(o-s[i])/(s[i+1]-s[i]),c=!1):i+=l,i<0||i>=n-1){if(i===n-1)return r[i];c=!1}return r[i]+(r[i+1]-r[i])*a}var a=createTypedArray("float32",8);return{getSegmentsLength:function(e){var t,s=segmentsLengthPool.newElement(),n=e.c,i=e.v,o=e.o,a=e.i,l=e._length,c=s.lengths,u=0;for(t=0;t<l-1;t+=1)c[t]=r(i[t],i[t+1],o[t],a[t+1]),u+=c[t].addedLength;return n&&l&&(c[t]=r(i[t],i[0],o[t],a[0]),u+=c[t].addedLength),s.totalLength=u,s},getNewSegment:function(t,r,s,n,i,l,c){i<0?i=0:i>1&&(i=1);var u,d=o(i,c),p=o(l=l>1?1:l,c),m=t.length,h=1-d,x=1-p,f=h*h*h,g=d*h*h*3,y=d*d*h*3,v=d*d*d,E=h*h*x,j=d*h*x+h*d*x+h*h*p,b=d*d*x+h*d*p+d*h*p,w=d*d*p,R=h*x*x,_=d*x*x+h*p*x+h*x*p,S=d*p*x+h*p*p+d*x*p,C=d*p*p,k=x*x*x,$=p*x*x+x*p*x+x*x*p,T=p*p*x+x*p*p+p*x*p,I=p*p*p;for(u=0;u<m;u+=1)a[4*u]=e.round(1e3*(f*t[u]+g*s[u]+y*n[u]+v*r[u]))/1e3,a[4*u+1]=e.round(1e3*(E*t[u]+j*s[u]+b*n[u]+w*r[u]))/1e3,a[4*u+2]=e.round(1e3*(R*t[u]+_*s[u]+S*n[u]+C*r[u]))/1e3,a[4*u+3]=e.round(1e3*(k*t[u]+$*s[u]+T*n[u]+I*r[u]))/1e3;return a},getPointInSegment:function(t,r,s,n,i,a){var l=o(i,a),c=1-l;return[e.round(1e3*(c*c*c*t[0]+(l*c*c+c*l*c+c*c*l)*s[0]+(l*l*c+c*l*l+l*c*l)*n[0]+l*l*l*r[0]))/1e3,e.round(1e3*(c*c*c*t[1]+(l*c*c+c*l*c+c*c*l)*s[1]+(l*l*c+c*l*l+l*c*l)*n[1]+l*l*l*r[1]))/1e3]},buildBezierData:i,pointOnLine2D:t,pointOnLine3D:function(r,s,n,i,o,a,l,c,u){if(0===n&&0===a&&0===u)return t(r,s,i,o,l,c);var d,p=e.sqrt(e.pow(i-r,2)+e.pow(o-s,2)+e.pow(a-n,2)),m=e.sqrt(e.pow(l-r,2)+e.pow(c-s,2)+e.pow(u-n,2)),h=e.sqrt(e.pow(l-i,2)+e.pow(c-o,2)+e.pow(u-a,2));return(d=p>m?p>h?p-m-h:h-m-p:h>m?h-m-p:m-p-h)>-1e-4&&d<1e-4}}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,t){var r,s=this.offsetTime;"multidimensional"===this.propType&&(r=createTypedArray("float32",this.pv.length));for(var n,i,o,a,l,c,u,d,p,m=t.lastIndex,h=m,x=this.keyframes.length-1,f=!0;f;){if(n=this.keyframes[h],i=this.keyframes[h+1],h===x-1&&e>=i.t-s){n.h&&(n=i),m=0;break}if(i.t-s>e){m=h;break}h<x-1?h+=1:(m=0,f=!1)}o=this.keyframesMetadata[h]||{};var g,y=i.t-s,v=n.t-s;if(n.to){o.bezierData||(o.bezierData=bez.buildBezierData(n.s,i.s||n.e,n.to,n.ti));var E=o.bezierData;if(e>=y||e<v){var j=e>=y?E.points.length-1:0;for(l=E.points[j].point.length,a=0;a<l;a+=1)r[a]=E.points[j].point[a]}else{o.__fnct?p=o.__fnct:(p=BezierFactory.getBezierEasing(n.o.x,n.o.y,n.i.x,n.i.y,n.n).get,o.__fnct=p),c=p((e-v)/(y-v));var b,w=E.segmentLength*c,R=t.lastFrame<e&&t._lastKeyframeIndex===h?t._lastAddedLength:0;for(d=t.lastFrame<e&&t._lastKeyframeIndex===h?t._lastPoint:0,f=!0,u=E.points.length;f;){if(R+=E.points[d].partialLength,0===w||0===c||d===E.points.length-1){for(l=E.points[d].point.length,a=0;a<l;a+=1)r[a]=E.points[d].point[a];break}if(w>=R&&w<R+E.points[d+1].partialLength){for(b=(w-R)/E.points[d+1].partialLength,l=E.points[d].point.length,a=0;a<l;a+=1)r[a]=E.points[d].point[a]+(E.points[d+1].point[a]-E.points[d].point[a])*b;break}d<u-1?d+=1:f=!1}t._lastPoint=d,t._lastAddedLength=R-E.points[d].partialLength,t._lastKeyframeIndex=h}}else{var _,S,C,k,$;if(x=n.s.length,g=i.s||n.e,this.sh&&1!==n.h)e>=y?(r[0]=g[0],r[1]=g[1],r[2]=g[2]):e<=v?(r[0]=n.s[0],r[1]=n.s[1],r[2]=n.s[2]):quaternionToEuler(r,slerp(createQuaternion(n.s),createQuaternion(g),(e-v)/(y-v)));else for(h=0;h<x;h+=1)1!==n.h&&(e>=y?c=1:e<v?c=0:(n.o.x.constructor===Array?(o.__fnct||(o.__fnct=[]),o.__fnct[h]?p=o.__fnct[h]:(_=void 0===n.o.x[h]?n.o.x[0]:n.o.x[h],S=void 0===n.o.y[h]?n.o.y[0]:n.o.y[h],C=void 0===n.i.x[h]?n.i.x[0]:n.i.x[h],k=void 0===n.i.y[h]?n.i.y[0]:n.i.y[h],p=BezierFactory.getBezierEasing(_,S,C,k).get,o.__fnct[h]=p)):o.__fnct?p=o.__fnct:(_=n.o.x,S=n.o.y,C=n.i.x,k=n.i.y,p=BezierFactory.getBezierEasing(_,S,C,k).get,n.keyframeMetadata=p),c=p((e-v)/(y-v)))),g=i.s||n.e,$=1===n.h?n.s[h]:n.s[h]+(g[h]-n.s[h])*c,"multidimensional"===this.propType?r[h]=$:r=$}return t.lastIndex=m,r}function slerp(e,t,r){var s,n,i,o,a,l=[],c=e[0],u=e[1],d=e[2],p=e[3],m=t[0],h=t[1],x=t[2],f=t[3];return(n=c*m+u*h+d*x+p*f)<0&&(n=-n,m=-m,h=-h,x=-x,f=-f),1-n>1e-6?(s=Math.acos(n),i=Math.sin(s),o=Math.sin((1-r)*s)/i,a=Math.sin(r*s)/i):(o=1-r,a=r),l[0]=o*c+a*m,l[1]=o*u+a*h,l[2]=o*d+a*x,l[3]=o*p+a*f,l}function quaternionToEuler(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],o=Math.atan2(2*s*i-2*r*n,1-2*s*s-2*n*n),a=Math.asin(2*r*s+2*n*i),l=Math.atan2(2*r*i-2*s*n,1-2*r*r-2*n*n);e[0]=o/degToRads,e[1]=a/degToRads,e[2]=l/degToRads}function createQuaternion(e){var t=e[0]*degToRads,r=e[1]*degToRads,s=e[2]*degToRads,n=Math.cos(t/2),i=Math.cos(r/2),o=Math.cos(s/2),a=Math.sin(t/2),l=Math.sin(r/2),c=Math.sin(s/2);return[a*l*o+n*i*c,a*i*o+n*l*c,n*l*o-a*i*c,n*i*o-a*l*c]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,t=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=r&&e>=r||this._caching.lastFrame<t&&e<t))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var s=this.interpolateValue(e,this._caching);this.pv=s}return this._caching.lastFrame=e,this.pv}function setVValue(e){var t;if("unidimensional"===this.propType)t=e*this.mult,mathAbs(this.v-t)>1e-5&&(this.v=t,this._mdf=!0);else for(var r=0,s=this.v.length;r<s;)t=e[r]*this.mult,mathAbs(this.v[r]-t)>1e-5&&(this.v[r]=t,this._mdf=!0),r+=1}function processEffectsSequence(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e;this.lock=!0,this._mdf=this._isFirstFrame;var t=this.effectsSequence.length,r=this.kf?this.pv:this.data.k;for(e=0;e<t;e+=1)r=this.effectsSequence[e](r);this.setVValue(r),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,t,r,s){this.propType="unidimensional",this.mult=r||1,this.data=t,this.v=r?t.k*r:t.k,this.pv=t.k,this._mdf=!1,this.elem=e,this.container=s,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,t,r,s){var n;this.propType="multidimensional",this.mult=r||1,this.data=t,this._mdf=!1,this.elem=e,this.container=s,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var i=t.k.length;for(this.v=createTypedArray("float32",i),this.pv=createTypedArray("float32",i),this.vel=createTypedArray("float32",i),n=0;n<i;n+=1)this.v[n]=t.k[n]*this.mult,this.pv[n]=t.k[n];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,t,r,s){this.propType="unidimensional",this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=t,this.mult=r||1,this.elem=e,this.container=s,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,t,r,s){var n;this.propType="multidimensional";var i,o,a,l,c=t.k.length;for(n=0;n<c-1;n+=1)t.k[n].to&&t.k[n].s&&t.k[n+1]&&t.k[n+1].s&&(i=t.k[n].s,o=t.k[n+1].s,a=t.k[n].to,l=t.k[n].ti,(2===i.length&&(i[0]!==o[0]||i[1]!==o[1])&&bez.pointOnLine2D(i[0],i[1],o[0],o[1],i[0]+a[0],i[1]+a[1])&&bez.pointOnLine2D(i[0],i[1],o[0],o[1],o[0]+l[0],o[1]+l[1])||3===i.length&&(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2])&&bez.pointOnLine3D(i[0],i[1],i[2],o[0],o[1],o[2],i[0]+a[0],i[1]+a[1],i[2]+a[2])&&bez.pointOnLine3D(i[0],i[1],i[2],o[0],o[1],o[2],o[0]+l[0],o[1]+l[1],o[2]+l[2]))&&(t.k[n].to=null,t.k[n].ti=null),i[0]===o[0]&&i[1]===o[1]&&0===a[0]&&0===a[1]&&0===l[0]&&0===l[1]&&(2===i.length||i[2]===o[2]&&0===a[2]&&0===l[2])&&(t.k[n].to=null,t.k[n].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=t,this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=r||1,this.elem=e,this.container=s,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var u=t.k[0].s.length;for(this.v=createTypedArray("float32",u),this.pv=createTypedArray("float32",u),n=0;n<u;n+=1)this.v[n]=initFrame,this.pv[n]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",u)},this.addEffect=addEffect}var PropertyFactory=function(){return{getProp:function(e,t,r,s,n){var i;if(t.sid&&(t=e.globalData.slotManager.getProp(t)),t.k.length)if("number"==typeof t.k[0])i=new MultiDimensionalProperty(e,t,s,n);else switch(r){case 0:i=new KeyframedValueProperty(e,t,s,n);break;case 1:i=new KeyframedMultidimensionalProperty(e,t,s,n)}else i=new ValueProperty(e,t,s,n);return i.effectsSequence.length&&n.addDynamicProperty(i),i}}}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var e;this._mdf=!1;var t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=poolFactory(8,function(){return createTypedArray("float32",2)});function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,t){this.c=e,this.setLength(t);for(var r=0;r<t;)this.v[r]=pointPool.newElement(),this.o[r]=pointPool.newElement(),this.i[r]=pointPool.newElement(),r+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,t,r,s,n){var i;switch(this._length=Math.max(this._length,s+1),this._length>=this._maxLength&&this.doubleArrayLength(),r){case"v":i=this.v;break;case"i":i=this.i;break;case"o":i=this.o;break;default:i=[]}(!i[s]||i[s]&&!n)&&(i[s]=pointPool.newElement()),i[s][0]=e,i[s][1]=t},ShapePath.prototype.setTripleAt=function(e,t,r,s,n,i,o,a){this.setXYAt(e,t,"v",o,a),this.setXYAt(r,s,"o",o,a),this.setXYAt(n,i,"i",o,a)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var t=this.v,r=this.o,s=this.i,n=0;this.c&&(e.setTripleAt(t[0][0],t[0][1],s[0][0],s[0][1],r[0][0],r[0][1],0,!1),n=1);var i,o=this._length-1,a=this._length;for(i=n;i<a;i+=1)e.setTripleAt(t[o][0],t[o][1],s[o][0],s[o][1],r[o][0],r[o][1],i,!1),o-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=(factory=poolFactory(4,function(){return new ShapePath},function(e){var t,r=e._length;for(t=0;t<r;t+=1)pointPool.release(e.v[t]),pointPool.release(e.i[t]),pointPool.release(e.o[t]),e.v[t]=null,e.i[t]=null,e.o[t]=null;e._length=0,e.c=!1}),factory.clone=function(e){var t,r=factory.newElement(),s=void 0===e._length?e.v.length:e._length;for(r.setLength(s),r.c=e.c,t=0;t<s;t+=1)r.setTripleAt(e.v[t][0],e.v[t][1],e.o[t][0],e.o[t][1],e.i[t][0],e.i[t][1],t);return r},factory),factory;function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=(ob2={newShapeCollection:function(){return _length?pool[_length-=1]:new ShapeCollection},release:function(e){var t,r=e._length;for(t=0;t<r;t+=1)shapePool.release(e.shapes[t]);e._length=0,_length===_maxLength&&(pool=pooling.double(pool),_maxLength*=2),pool[_length]=e,_length+=1}},_length=0,_maxLength=4,pool=createSizedArray(_maxLength),ob2),ob2,_length,_maxLength,pool,ShapePropertyFactory=function(){var e=-999999;function t(e,t,r){var s,n,i,o,a,l,c,u,d,p=r.lastIndex,m=this.keyframes;if(e<m[0].t-this.offsetTime)s=m[0].s[0],i=!0,p=0;else if(e>=m[m.length-1].t-this.offsetTime)s=m[m.length-1].s?m[m.length-1].s[0]:m[m.length-2].e[0],i=!0;else{for(var h,x,f,g=p,y=m.length-1,v=!0;v&&(h=m[g],!((x=m[g+1]).t-this.offsetTime>e));)g<y-1?g+=1:v=!1;if(f=this.keyframesMetadata[g]||{},p=g,!(i=1===h.h)){if(e>=x.t-this.offsetTime)u=1;else if(e<h.t-this.offsetTime)u=0;else{var E;f.__fnct?E=f.__fnct:(E=BezierFactory.getBezierEasing(h.o.x,h.o.y,h.i.x,h.i.y).get,f.__fnct=E),u=E((e-(h.t-this.offsetTime))/(x.t-this.offsetTime-(h.t-this.offsetTime)))}n=x.s?x.s[0]:h.e[0]}s=h.s[0]}for(l=t._length,c=s.i[0].length,r.lastIndex=p,o=0;o<l;o+=1)for(a=0;a<c;a+=1)d=i?s.i[o][a]:s.i[o][a]+(n.i[o][a]-s.i[o][a])*u,t.i[o][a]=d,d=i?s.o[o][a]:s.o[o][a]+(n.o[o][a]-s.o[o][a])*u,t.o[o][a]=d,d=i?s.v[o][a]:s.v[o][a]+(n.v[o][a]-s.v[o][a])*u,t.v[o][a]=d}function r(){var t=this.comp.renderedFrame-this.offsetTime,r=this.keyframes[0].t-this.offsetTime,s=this.keyframes[this.keyframes.length-1].t-this.offsetTime,n=this._caching.lastFrame;return n!==e&&(n<r&&t<r||n>s&&t>s)||(this._caching.lastIndex=n<t?this._caching.lastIndex:0,this.interpolateShape(t,this.pv,this._caching)),this._caching.lastFrame=t,this.pv}function s(){this.paths=this.localShapeCollection}function n(e){(function(e,t){if(e._length!==t._length||e.c!==t.c)return!1;var r,s=e._length;for(r=0;r<s;r+=1)if(e.v[r][0]!==t.v[r][0]||e.v[r][1]!==t.v[r][1]||e.o[r][0]!==t.o[r][0]||e.o[r][1]!==t.o[r][1]||e.i[r][0]!==t.i[r][0]||e.i[r][1]!==t.i[r][1])return!1;return!0})(this.v,e)||(this.v=shapePool.clone(e),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function i(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e,t;this.lock=!0,this._mdf=!1,e=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var r=this.effectsSequence.length;for(t=0;t<r;t+=1)e=this.effectsSequence[t](e);this.setVValue(e),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function o(e,t,r){this.propType="shape",this.comp=e.comp,this.container=e,this.elem=e,this.data=t,this.k=!1,this.kf=!1,this._mdf=!1;var n=3===r?t.pt.k:t.ks.k;this.v=shapePool.clone(n),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=s,this.effectsSequence=[]}function a(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function l(t,n,i){this.propType="shape",this.comp=t.comp,this.elem=t,this.container=t,this.offsetTime=t.data.st,this.keyframes=3===i?n.pt.k:n.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var o=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,o),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=s,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[r.bind(this)]}o.prototype.interpolateShape=t,o.prototype.getValue=i,o.prototype.setVValue=n,o.prototype.addEffect=a,l.prototype.getValue=i,l.prototype.interpolateShape=t,l.prototype.setVValue=n,l.prototype.addEffect=a;var c=function(){var e=roundCorner;function t(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=t.d,this.elem=e,this.comp=e.comp,this.frameId=-1,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return t.prototype={reset:s,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var t=this.p.v[0],r=this.p.v[1],s=this.s.v[0]/2,n=this.s.v[1]/2,i=3!==this.d,o=this.v;o.v[0][0]=t,o.v[0][1]=r-n,o.v[1][0]=i?t+s:t-s,o.v[1][1]=r,o.v[2][0]=t,o.v[2][1]=r+n,o.v[3][0]=i?t-s:t+s,o.v[3][1]=r,o.i[0][0]=i?t-s*e:t+s*e,o.i[0][1]=r-n,o.i[1][0]=i?t+s:t-s,o.i[1][1]=r-n*e,o.i[2][0]=i?t+s*e:t-s*e,o.i[2][1]=r+n,o.i[3][0]=i?t-s:t+s,o.i[3][1]=r+n*e,o.o[0][0]=i?t+s*e:t-s*e,o.o[0][1]=r-n,o.o[1][0]=i?t+s:t-s,o.o[1][1]=r+n*e,o.o[2][0]=i?t-s*e:t+s*e,o.o[2][1]=r+n,o.o[3][0]=i?t-s:t+s,o.o[3][1]=r-n*e}},extendPrototype([DynamicPropertyContainer],t),t}(),u=function(){function e(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=e,this.comp=e.comp,this.data=t,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),1===t.sy?(this.ir=PropertyFactory.getProp(e,t.ir,0,0,this),this.is=PropertyFactory.getProp(e,t.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(e,t.pt,0,0,this),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,degToRads,this),this.or=PropertyFactory.getProp(e,t.or,0,0,this),this.os=PropertyFactory.getProp(e,t.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return e.prototype={reset:s,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var e,t,r,s,n=2*Math.floor(this.pt.v),i=2*Math.PI/n,o=!0,a=this.or.v,l=this.ir.v,c=this.os.v,u=this.is.v,d=2*Math.PI*a/(2*n),p=2*Math.PI*l/(2*n),m=-Math.PI/2;m+=this.r.v;var h=3===this.data.d?-1:1;for(this.v._length=0,e=0;e<n;e+=1){r=o?c:u,s=o?d:p;var x=(t=o?a:l)*Math.cos(m),f=t*Math.sin(m),g=0===x&&0===f?0:f/Math.sqrt(x*x+f*f),y=0===x&&0===f?0:-x/Math.sqrt(x*x+f*f);x+=+this.p.v[0],f+=+this.p.v[1],this.v.setTripleAt(x,f,x-g*s*r*h,f-y*s*r*h,x+g*s*r*h,f+y*s*r*h,e,!0),o=!o,m+=i*h}},convertPolygonToPath:function(){var e,t=Math.floor(this.pt.v),r=2*Math.PI/t,s=this.or.v,n=this.os.v,i=2*Math.PI*s/(4*t),o=.5*-Math.PI,a=3===this.data.d?-1:1;for(o+=this.r.v,this.v._length=0,e=0;e<t;e+=1){var l=s*Math.cos(o),c=s*Math.sin(o),u=0===l&&0===c?0:c/Math.sqrt(l*l+c*c),d=0===l&&0===c?0:-l/Math.sqrt(l*l+c*c);l+=+this.p.v[0],c+=+this.p.v[1],this.v.setTripleAt(l,c,l-u*i*n*a,c-d*i*n*a,l+u*i*n*a,c+d*i*n*a,e,!0),o+=r*a}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],e),e}(),d=function(){function e(e,t){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=e,this.comp=e.comp,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return e.prototype={convertRectToPath:function(){var e=this.p.v[0],t=this.p.v[1],r=this.s.v[0]/2,s=this.s.v[1]/2,n=bmMin(r,s,this.r.v),i=n*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(e+r,t-s+n,e+r,t-s+n,e+r,t-s+i,0,!0),this.v.setTripleAt(e+r,t+s-n,e+r,t+s-i,e+r,t+s-n,1,!0),0!==n?(this.v.setTripleAt(e+r-n,t+s,e+r-n,t+s,e+r-i,t+s,2,!0),this.v.setTripleAt(e-r+n,t+s,e-r+i,t+s,e-r+n,t+s,3,!0),this.v.setTripleAt(e-r,t+s-n,e-r,t+s-n,e-r,t+s-i,4,!0),this.v.setTripleAt(e-r,t-s+n,e-r,t-s+i,e-r,t-s+n,5,!0),this.v.setTripleAt(e-r+n,t-s,e-r+n,t-s,e-r+i,t-s,6,!0),this.v.setTripleAt(e+r-n,t-s,e+r-i,t-s,e+r-n,t-s,7,!0)):(this.v.setTripleAt(e-r,t+s,e-r+i,t+s,e-r,t+s,2),this.v.setTripleAt(e-r,t-s,e-r,t-s+i,e-r,t-s,3))):(this.v.setTripleAt(e+r,t-s+n,e+r,t-s+i,e+r,t-s+n,0,!0),0!==n?(this.v.setTripleAt(e+r-n,t-s,e+r-n,t-s,e+r-i,t-s,1,!0),this.v.setTripleAt(e-r+n,t-s,e-r+i,t-s,e-r+n,t-s,2,!0),this.v.setTripleAt(e-r,t-s+n,e-r,t-s+n,e-r,t-s+i,3,!0),this.v.setTripleAt(e-r,t+s-n,e-r,t+s-i,e-r,t+s-n,4,!0),this.v.setTripleAt(e-r+n,t+s,e-r+n,t+s,e-r+i,t+s,5,!0),this.v.setTripleAt(e+r-n,t+s,e+r-i,t+s,e+r-n,t+s,6,!0),this.v.setTripleAt(e+r,t+s-n,e+r,t+s-n,e+r,t+s-i,7,!0)):(this.v.setTripleAt(e-r,t-s,e-r+i,t-s,e-r,t-s,1,!0),this.v.setTripleAt(e-r,t+s,e-r,t+s-i,e-r,t+s,2,!0),this.v.setTripleAt(e+r,t+s,e+r-i,t+s,e+r,t+s,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:s},extendPrototype([DynamicPropertyContainer],e),e}(),p={getShapeProp:function(e,t,r){var s;return 3===r||4===r?s=(3===r?t.pt:t.ks).k.length?new l(e,t,r):new o(e,t,r):5===r?s=new d(e,t):6===r?s=new c(e,t):7===r&&(s=new u(e,t)),s.k&&e.addDynamicProperty(s),s},getConstructorFunction:function(){return o},getKeyframedConstructorFunction:function(){return l}};return p}(),Matrix=function(){var e=Math.cos,t=Math.sin,r=Math.tan,s=Math.round;function n(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function i(r){if(0===r)return this;var s=e(r),n=t(r);return this._t(s,-n,0,0,n,s,0,0,0,0,1,0,0,0,0,1)}function o(r){if(0===r)return this;var s=e(r),n=t(r);return this._t(1,0,0,0,0,s,-n,0,0,n,s,0,0,0,0,1)}function a(r){if(0===r)return this;var s=e(r),n=t(r);return this._t(s,0,n,0,0,1,0,0,-n,0,s,0,0,0,0,1)}function l(r){if(0===r)return this;var s=e(r),n=t(r);return this._t(s,-n,0,0,n,s,0,0,0,0,1,0,0,0,0,1)}function c(e,t){return this._t(1,t,e,1,0,0)}function u(e,t){return this.shear(r(e),r(t))}function d(s,n){var i=e(n),o=t(n);return this._t(i,o,0,0,-o,i,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,r(s),1,0,0,0,0,1,0,0,0,0,1)._t(i,-o,0,0,o,i,0,0,0,0,1,0,0,0,0,1)}function p(e,t,r){return r||0===r||(r=1),1===e&&1===t&&1===r?this:this._t(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1)}function m(e,t,r,s,n,i,o,a,l,c,u,d,p,m,h,x){return this.props[0]=e,this.props[1]=t,this.props[2]=r,this.props[3]=s,this.props[4]=n,this.props[5]=i,this.props[6]=o,this.props[7]=a,this.props[8]=l,this.props[9]=c,this.props[10]=u,this.props[11]=d,this.props[12]=p,this.props[13]=m,this.props[14]=h,this.props[15]=x,this}function h(e,t,r){return r=r||0,0!==e||0!==t||0!==r?this._t(1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1):this}function x(e,t,r,s,n,i,o,a,l,c,u,d,p,m,h,x){var f=this.props;if(1===e&&0===t&&0===r&&0===s&&0===n&&1===i&&0===o&&0===a&&0===l&&0===c&&1===u&&0===d)return f[12]=f[12]*e+f[15]*p,f[13]=f[13]*i+f[15]*m,f[14]=f[14]*u+f[15]*h,f[15]*=x,this._identityCalculated=!1,this;var g=f[0],y=f[1],v=f[2],E=f[3],j=f[4],b=f[5],w=f[6],R=f[7],_=f[8],S=f[9],C=f[10],k=f[11],$=f[12],T=f[13],I=f[14],P=f[15];return f[0]=g*e+y*n+v*l+E*p,f[1]=g*t+y*i+v*c+E*m,f[2]=g*r+y*o+v*u+E*h,f[3]=g*s+y*a+v*d+E*x,f[4]=j*e+b*n+w*l+R*p,f[5]=j*t+b*i+w*c+R*m,f[6]=j*r+b*o+w*u+R*h,f[7]=j*s+b*a+w*d+R*x,f[8]=_*e+S*n+C*l+k*p,f[9]=_*t+S*i+C*c+k*m,f[10]=_*r+S*o+C*u+k*h,f[11]=_*s+S*a+C*d+k*x,f[12]=$*e+T*n+I*l+P*p,f[13]=$*t+T*i+I*c+P*m,f[14]=$*r+T*o+I*u+P*h,f[15]=$*s+T*a+I*d+P*x,this._identityCalculated=!1,this}function f(e){var t=e.props;return this.transform(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function g(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function y(e){for(var t=0;t<16;){if(e.props[t]!==this.props[t])return!1;t+=1}return!0}function v(e){var t;for(t=0;t<16;t+=1)e.props[t]=this.props[t];return e}function E(e){var t;for(t=0;t<16;t+=1)this.props[t]=e[t]}function j(e,t,r){return{x:e*this.props[0]+t*this.props[4]+r*this.props[8]+this.props[12],y:e*this.props[1]+t*this.props[5]+r*this.props[9]+this.props[13],z:e*this.props[2]+t*this.props[6]+r*this.props[10]+this.props[14]}}function b(e,t,r){return e*this.props[0]+t*this.props[4]+r*this.props[8]+this.props[12]}function w(e,t,r){return e*this.props[1]+t*this.props[5]+r*this.props[9]+this.props[13]}function R(e,t,r){return e*this.props[2]+t*this.props[6]+r*this.props[10]+this.props[14]}function _(){var e=this.props[0]*this.props[5]-this.props[1]*this.props[4],t=this.props[5]/e,r=-this.props[1]/e,s=-this.props[4]/e,n=this.props[0]/e,i=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/e,o=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/e,a=new Matrix;return a.props[0]=t,a.props[1]=r,a.props[4]=s,a.props[5]=n,a.props[12]=i,a.props[13]=o,a}function S(e){return this.getInverseMatrix().applyToPointArray(e[0],e[1],e[2]||0)}function C(e){var t,r=e.length,s=[];for(t=0;t<r;t+=1)s[t]=S(e[t]);return s}function k(e,t,r){var s=createTypedArray("float32",6);if(this.isIdentity())s[0]=e[0],s[1]=e[1],s[2]=t[0],s[3]=t[1],s[4]=r[0],s[5]=r[1];else{var n=this.props[0],i=this.props[1],o=this.props[4],a=this.props[5],l=this.props[12],c=this.props[13];s[0]=e[0]*n+e[1]*o+l,s[1]=e[0]*i+e[1]*a+c,s[2]=t[0]*n+t[1]*o+l,s[3]=t[0]*i+t[1]*a+c,s[4]=r[0]*n+r[1]*o+l,s[5]=r[0]*i+r[1]*a+c}return s}function $(e,t,r){return this.isIdentity()?[e,t,r]:[e*this.props[0]+t*this.props[4]+r*this.props[8]+this.props[12],e*this.props[1]+t*this.props[5]+r*this.props[9]+this.props[13],e*this.props[2]+t*this.props[6]+r*this.props[10]+this.props[14]]}function T(e,t){if(this.isIdentity())return e+","+t;var r=this.props;return Math.round(100*(e*r[0]+t*r[4]+r[12]))/100+","+Math.round(100*(e*r[1]+t*r[5]+r[13]))/100}function I(){for(var e=0,t=this.props,r="matrix3d(";e<16;)r+=s(1e4*t[e])/1e4,r+=15===e?")":",",e+=1;return r}function P(e){return e<1e-6&&e>0||e>-1e-6&&e<0?s(1e4*e)/1e4:e}function A(){var e=this.props;return"matrix("+P(e[0])+","+P(e[1])+","+P(e[4])+","+P(e[5])+","+P(e[12])+","+P(e[13])+")"}return function(){this.reset=n,this.rotate=i,this.rotateX=o,this.rotateY=a,this.rotateZ=l,this.skew=u,this.skewFromAxis=d,this.shear=c,this.scale=p,this.setTransform=m,this.translate=h,this.transform=x,this.multiply=f,this.applyToPoint=j,this.applyToX=b,this.applyToY=w,this.applyToZ=R,this.applyToPointArray=$,this.applyToTriplePoints=k,this.applyToPointStringified=T,this.toCSS=I,this.to2dCSS=A,this.clone=v,this.cloneFromProps=E,this.equals=y,this.inversePoints=C,this.inversePoint=S,this.getInverseMatrix=_,this._t=this.transform,this.isIdentity=g,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){return(_typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if("string"==typeof e)switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10)}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return"undefined"!=typeof navigator}function installPlugin(e,t){"expressions"===e&&setExpressionsPlugin(t)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var t=queryString.split("&"),r=0;r<t.length;r+=1){var s=t[r].split("=");if(decodeURIComponent(s[0])==e)return decodeURIComponent(s[1])}return null}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";var queryString="",scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer");var readyStateCheckInterval=setInterval(checkReady,100);try{"object"!==_typeof$3(exports)&&(window.bodymovin=lottie)}catch(err){}var ShapeModifiers=function(){var e={},t={};return e.registerModifier=function(e,r){t[e]||(t[e]=r)},e.getModifier=function(e,r,s){return new t[e](r,s)},e}();function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var t={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(t),this.addShapeToModifier(t),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,t){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,t){this.s=PropertyFactory.getProp(e,t.s,0,.01,this),this.e=PropertyFactory.getProp(e,t.e,0,.01,this),this.o=PropertyFactory.getProp(e,t.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=t.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,t,r,s,n){var i=[];t<=1?i.push({s:e,e:t}):e>=1?i.push({s:e-1,e:t-1}):(i.push({s:e,e:1}),i.push({s:0,e:t-1}));var o,a,l=[],c=i.length;for(o=0;o<c;o+=1){var u,d;(a=i[o]).e*n<s||a.s*n>s+r||(u=a.s*n<=s?0:(a.s*n-s)/r,d=a.e*n>=s+r?1:(a.e*n-s)/r,l.push([u,d]))}return l.length||l.push([0,0]),l},TrimModifier.prototype.releasePathsData=function(e){var t,r=e.length;for(t=0;t<r;t+=1)segmentsLengthPool.release(e[t]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var t,r,s,n;if(this._mdf||e){var i=this.o.v%360/360;if(i<0&&(i+=1),(t=this.s.v>1?1+i:this.s.v<0?0+i:this.s.v+i)>(r=this.e.v>1?1+i:this.e.v<0?0+i:this.e.v+i)){var o=t;t=r,r=o}t=1e-4*Math.round(1e4*t),r=1e-4*Math.round(1e4*r),this.sValue=t,this.eValue=r}else t=this.sValue,r=this.eValue;var a,l,c,u,d,p=this.shapes.length,m=0;if(r===t)for(n=0;n<p;n+=1)this.shapes[n].localShapeCollection.releaseShapes(),this.shapes[n].shape._mdf=!0,this.shapes[n].shape.paths=this.shapes[n].localShapeCollection,this._mdf&&(this.shapes[n].pathsData.length=0);else if(1===r&&0===t||0===r&&1===t){if(this._mdf)for(n=0;n<p;n+=1)this.shapes[n].pathsData.length=0,this.shapes[n].shape._mdf=!0}else{var h,x,f=[];for(n=0;n<p;n+=1)if((h=this.shapes[n]).shape._mdf||this._mdf||e||2===this.m){if(l=(s=h.shape.paths)._length,d=0,!h.shape._mdf&&h.pathsData.length)d=h.totalShapeLength;else{for(c=this.releasePathsData(h.pathsData),a=0;a<l;a+=1)u=bez.getSegmentsLength(s.shapes[a]),c.push(u),d+=u.totalLength;h.totalShapeLength=d,h.pathsData=c}m+=d,h.shape._mdf=!0}else h.shape.paths=h.localShapeCollection;var g,y=t,v=r,E=0;for(n=p-1;n>=0;n-=1)if((h=this.shapes[n]).shape._mdf){for((x=h.localShapeCollection).releaseShapes(),2===this.m&&p>1?(g=this.calculateShapeEdges(t,r,h.totalShapeLength,E,m),E+=h.totalShapeLength):g=[[y,v]],l=g.length,a=0;a<l;a+=1){y=g[a][0],v=g[a][1],f.length=0,v<=1?f.push({s:h.totalShapeLength*y,e:h.totalShapeLength*v}):y>=1?f.push({s:h.totalShapeLength*(y-1),e:h.totalShapeLength*(v-1)}):(f.push({s:h.totalShapeLength*y,e:h.totalShapeLength}),f.push({s:0,e:h.totalShapeLength*(v-1)}));var j=this.addShapes(h,f[0]);if(f[0].s!==f[0].e){if(f.length>1)if(h.shape.paths.shapes[h.shape.paths._length-1].c){var b=j.pop();this.addPaths(j,x),j=this.addShapes(h,f[1],b)}else this.addPaths(j,x),j=this.addShapes(h,f[1]);this.addPaths(j,x)}}h.shape.paths=x}}},TrimModifier.prototype.addPaths=function(e,t){var r,s=e.length;for(r=0;r<s;r+=1)t.addShape(e[r])},TrimModifier.prototype.addSegment=function(e,t,r,s,n,i,o){n.setXYAt(t[0],t[1],"o",i),n.setXYAt(r[0],r[1],"i",i+1),o&&n.setXYAt(e[0],e[1],"v",i),n.setXYAt(s[0],s[1],"v",i+1)},TrimModifier.prototype.addSegmentFromArray=function(e,t,r,s){t.setXYAt(e[1],e[5],"o",r),t.setXYAt(e[2],e[6],"i",r+1),s&&t.setXYAt(e[0],e[4],"v",r),t.setXYAt(e[3],e[7],"v",r+1)},TrimModifier.prototype.addShapes=function(e,t,r){var s,n,i,o,a,l,c,u,d=e.pathsData,p=e.shape.paths.shapes,m=e.shape.paths._length,h=0,x=[],f=!0;for(r?(a=r._length,u=r._length):(r=shapePool.newElement(),a=0,u=0),x.push(r),s=0;s<m;s+=1){for(l=d[s].lengths,r.c=p[s].c,i=p[s].c?l.length:l.length+1,n=1;n<i;n+=1)if(h+(o=l[n-1]).addedLength<t.s)h+=o.addedLength,r.c=!1;else{if(h>t.e){r.c=!1;break}t.s<=h&&t.e>=h+o.addedLength?(this.addSegment(p[s].v[n-1],p[s].o[n-1],p[s].i[n],p[s].v[n],r,a,f),f=!1):(c=bez.getNewSegment(p[s].v[n-1],p[s].v[n],p[s].o[n-1],p[s].i[n],(t.s-h)/o.addedLength,(t.e-h)/o.addedLength,l[n-1]),this.addSegmentFromArray(c,r,a,f),f=!1,r.c=!1),h+=o.addedLength,a+=1}if(p[s].c&&l.length){if(o=l[n-1],h<=t.e){var g=l[n-1].addedLength;t.s<=h&&t.e>=h+g?(this.addSegment(p[s].v[n-1],p[s].o[n-1],p[s].i[0],p[s].v[0],r,a,f),f=!1):(c=bez.getNewSegment(p[s].v[n-1],p[s].v[0],p[s].o[n-1],p[s].i[0],(t.s-h)/g,(t.e-h)/g,l[n-1]),this.addSegmentFromArray(c,r,a,f),f=!1,r.c=!1)}else r.c=!1;h+=o.addedLength,a+=1}if(r._length&&(r.setXYAt(r.v[u][0],r.v[u][1],"i",u),r.setXYAt(r.v[r._length-1][0],r.v[r._length-1][1],"o",r._length-1)),h>t.e)break;s<m-1&&(r=shapePool.newElement(),f=!0,x.push(r),a=0)}return x},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,t){var r=t/100,s=[0,0],n=e._length,i=0;for(i=0;i<n;i+=1)s[0]+=e.v[i][0],s[1]+=e.v[i][1];s[0]/=n,s[1]/=n;var o,a,l,c,u,d,p=shapePool.newElement();for(p.c=e.c,i=0;i<n;i+=1)o=e.v[i][0]+(s[0]-e.v[i][0])*r,a=e.v[i][1]+(s[1]-e.v[i][1])*r,l=e.o[i][0]+(s[0]-e.o[i][0])*-r,c=e.o[i][1]+(s[1]-e.o[i][1])*-r,u=e.i[i][0]+(s[0]-e.i[i][0])*-r,d=e.i[i][1]+(s[1]-e.i[i][1])*-r,p.setTripleAt(o,a,l,c,u,d,i);return p},PuckerAndBloatModifier.prototype.processShapes=function(e){var t,r,s,n,i,o,a=this.shapes.length,l=this.amount.v;if(0!==l)for(r=0;r<a;r+=1){if(o=(i=this.shapes[r]).localShapeCollection,i.shape._mdf||this._mdf||e)for(o.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,n=i.shape.paths._length,s=0;s<n;s+=1)o.addShape(this.processPath(t[s],l));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function t(e,t,r){if(this.elem=e,this.frameId=-1,this.propType="transform",this.data=t,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(r||e),t.p&&t.p.s?(this.px=PropertyFactory.getProp(e,t.p.x,0,0,this),this.py=PropertyFactory.getProp(e,t.p.y,0,0,this),t.p.z&&(this.pz=PropertyFactory.getProp(e,t.p.z,0,0,this))):this.p=PropertyFactory.getProp(e,t.p||{k:[0,0,0]},1,0,this),t.rx){if(this.rx=PropertyFactory.getProp(e,t.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(e,t.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(e,t.rz,0,degToRads,this),t.or.k[0].ti){var s,n=t.or.k.length;for(s=0;s<n;s+=1)t.or.k[s].to=null,t.or.k[s].ti=null}this.or=PropertyFactory.getProp(e,t.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(e,t.r||{k:0},0,degToRads,this);t.sk&&(this.sk=PropertyFactory.getProp(e,t.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(e,t.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(e,t.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(e,t.s||{k:[100,100,100]},1,.01,this),t.o?this.o=PropertyFactory.getProp(e,t.o,0,.01,e):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return t.prototype={applyToMatrix:function(e){var t=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||t,this.a&&e.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&e.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&e.skewFromAxis(-this.sk.v,this.sa.v),this.r?e.rotate(-this.r.v):e.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?e.translate(this.px.v,this.py.v,-this.pz.v):e.translate(this.px.v,this.py.v,0):e.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(t){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||t){var r;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var s,n;if(r=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(s=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/r,0),n=this.p.getValueAtTime(this.p.keyframes[0].t/r,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(s=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/r,0),n=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/r,0)):(s=this.p.pv,n=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/r,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){s=[],n=[];var i=this.px,o=this.py;i._caching.lastFrame+i.offsetTime<=i.keyframes[0].t?(s[0]=i.getValueAtTime((i.keyframes[0].t+.01)/r,0),s[1]=o.getValueAtTime((o.keyframes[0].t+.01)/r,0),n[0]=i.getValueAtTime(i.keyframes[0].t/r,0),n[1]=o.getValueAtTime(o.keyframes[0].t/r,0)):i._caching.lastFrame+i.offsetTime>=i.keyframes[i.keyframes.length-1].t?(s[0]=i.getValueAtTime(i.keyframes[i.keyframes.length-1].t/r,0),s[1]=o.getValueAtTime(o.keyframes[o.keyframes.length-1].t/r,0),n[0]=i.getValueAtTime((i.keyframes[i.keyframes.length-1].t-.01)/r,0),n[1]=o.getValueAtTime((o.keyframes[o.keyframes.length-1].t-.01)/r,0)):(s=[i.pv,o.pv],n[0]=i.getValueAtTime((i._caching.lastFrame+i.offsetTime-.01)/r,i.offsetTime),n[1]=o.getValueAtTime((o._caching.lastFrame+o.offsetTime-.01)/r,o.offsetTime))}else s=n=e;this.v.rotate(-Math.atan2(s[1]-n[1],s[0]-n[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],t),t.prototype.addDynamicProperty=function(e){this._addDynamicProperty(e),this.elem.addDynamicProperty(e),this._isDirty=!0},t.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(e,r,s){return new t(e,r,s)}}}();function RepeaterModifier(){}function RoundCornersModifier(){}function floatEqual(e,t){return 1e5*Math.abs(e-t)<=Math.min(Math.abs(e),Math.abs(t))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,t,r){return e*(1-r)+t*r}function lerpPoint(e,t,r){return[lerp(e[0],t[0],r),lerp(e[1],t[1],r)]}function quadRoots(e,t,r){if(0===e)return[];var s=t*t-4*e*r;if(s<0)return[];var n=-t/(2*e);if(0===s)return[n];var i=Math.sqrt(s)/(2*e);return[n-i,n+i]}function polynomialCoefficients(e,t,r,s){return[3*t-e-3*r+s,3*e-6*t+3*r,-3*e+3*t,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,t,r,s,n){n&&pointEqual(e,t)&&(t=lerpPoint(e,s,1/3)),n&&pointEqual(r,s)&&(r=lerpPoint(e,s,2/3));var i=polynomialCoefficients(e[0],t[0],r[0],s[0]),o=polynomialCoefficients(e[1],t[1],r[1],s[1]);this.a=[i[0],o[0]],this.b=[i[1],o[1]],this.c=[i[2],o[2]],this.d=[i[3],o[3]],this.points=[e,t,r,s]}function extrema(e,t){var r=e.points[0][t],s=e.points[e.points.length-1][t];if(r>s){var n=s;s=r,r=n}for(var i=quadRoots(3*e.a[t],2*e.b[t],e.c[t]),o=0;o<i.length;o+=1)if(i[o]>0&&i[o]<1){var a=e.point(i[o])[t];a<r?r=a:a>s&&(s=a)}return{min:r,max:s}}function intersectData(e,t,r){var s=e.boundingBox();return{cx:s.cx,cy:s.cy,width:s.width,height:s.height,bez:e,t:(t+r)/2,t1:t,t2:r}}function splitData(e){var t=e.bez.split(.5);return[intersectData(t[0],e.t1,e.t),intersectData(t[1],e.t,e.t2)]}function boxIntersect(e,t){return 2*Math.abs(e.cx-t.cx)<e.width+t.width&&2*Math.abs(e.cy-t.cy)<e.height+t.height}function intersectsImpl(e,t,r,s,n,i){if(boxIntersect(e,t))if(r>=i||e.width<=s&&e.height<=s&&t.width<=s&&t.height<=s)n.push([e.t,t.t]);else{var o=splitData(e),a=splitData(t);intersectsImpl(o[0],a[0],r+1,s,n,i),intersectsImpl(o[0],a[1],r+1,s,n,i),intersectsImpl(o[1],a[0],r+1,s,n,i),intersectsImpl(o[1],a[1],r+1,s,n,i)}}function crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function lineIntersection(e,t,r,s){var n=[e[0],e[1],1],i=[t[0],t[1],1],o=[r[0],r[1],1],a=[s[0],s[1],1],l=crossProduct(crossProduct(n,i),crossProduct(o,a));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(e,t,r){return[e[0]+Math.cos(t)*r,e[1]-Math.sin(t)*r]}function pointDistance(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function pointEqual(e,t){return floatEqual(e[0],t[0])&&floatEqual(e[1],t[1])}function ZigZagModifier(){}function setPoint(e,t,r,s,n,i,o){var a=r-Math.PI/2,l=r+Math.PI/2,c=t[0]+Math.cos(r)*s*n,u=t[1]-Math.sin(r)*s*n;e.setTripleAt(c,u,c+Math.cos(a)*i,u-Math.sin(a)*i,c+Math.cos(l)*o,u-Math.sin(l)*o,e.length())}function getPerpendicularVector(e,t){var r=[t[0]-e[0],t[1]-e[1]],s=.5*-Math.PI;return[Math.cos(s)*r[0]-Math.sin(s)*r[1],Math.sin(s)*r[0]+Math.cos(s)*r[1]]}function getProjectingAngle(e,t){var r=0===t?e.length()-1:t-1,s=(t+1)%e.length(),n=getPerpendicularVector(e.v[r],e.v[s]);return Math.atan2(0,1)-Math.atan2(n[1],n[0])}function zigZagCorner(e,t,r,s,n,i,o){var a=getProjectingAngle(t,r),l=t.v[r%t._length],c=t.v[0===r?t._length-1:r-1],u=t.v[(r+1)%t._length],d=2===i?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0,p=2===i?Math.sqrt(Math.pow(l[0]-u[0],2)+Math.pow(l[1]-u[1],2)):0;setPoint(e,t.v[r%t._length],a,o,s,p/(2*(n+1)),d/(2*(n+1)))}function zigZagSegment(e,t,r,s,n,i){for(var o=0;o<s;o+=1){var a=(o+1)/(s+1),l=2===n?Math.sqrt(Math.pow(t.points[3][0]-t.points[0][0],2)+Math.pow(t.points[3][1]-t.points[0][1],2)):0,c=t.normalAngle(a);setPoint(e,t.point(a),c,i,r,l/(2*(s+1)),l/(2*(s+1))),i=-i}return i}function linearOffset(e,t,r){var s=Math.atan2(t[0]-e[0],t[1]-e[1]);return[polarOffset(e,s,r),polarOffset(t,s,r)]}function offsetSegment(e,t){var r,s,n,i,o,a,l;r=(l=linearOffset(e.points[0],e.points[1],t))[0],s=l[1],n=(l=linearOffset(e.points[1],e.points[2],t))[0],i=l[1],o=(l=linearOffset(e.points[2],e.points[3],t))[0],a=l[1];var c=lineIntersection(r,s,n,i);null===c&&(c=s);var u=lineIntersection(o,a,n,i);return null===u&&(u=o),new PolynomialBezier(r,c,u,a)}function joinLines(e,t,r,s,n){var i=t.points[3],o=r.points[0];if(3===s)return i;if(pointEqual(i,o))return i;if(2===s){var a=-t.tangentAngle(1),l=-r.tangentAngle(0)+Math.PI,c=lineIntersection(i,polarOffset(i,a+Math.PI/2,100),o,polarOffset(o,a+Math.PI/2,100)),u=c?pointDistance(c,i):pointDistance(i,o)/2,d=polarOffset(i,a,2*u*roundCorner);return e.setXYAt(d[0],d[1],"o",e.length()-1),d=polarOffset(o,l,2*u*roundCorner),e.setTripleAt(o[0],o[1],o[0],o[1],d[0],d[1],e.length()),o}var p=lineIntersection(pointEqual(i,t.points[2])?t.points[0]:t.points[2],i,o,pointEqual(o,r.points[1])?r.points[3]:r.points[1]);return p&&pointDistance(p,i)<n?(e.setTripleAt(p[0],p[1],p[0],p[1],p[0],p[1],e.length()),p):i}function getIntersection(e,t){var r=e.intersections(t);return r.length&&floatEqual(r[0][0],1)&&r.shift(),r.length?r[0]:null}function pruneSegmentIntersection(e,t){var r=e.slice(),s=t.slice(),n=getIntersection(e[e.length-1],t[0]);return n&&(r[e.length-1]=e[e.length-1].split(n[0])[0],s[0]=t[0].split(n[1])[1]),e.length>1&&t.length>1&&(n=getIntersection(e[0],t[t.length-1]))?[[e[0].split(n[0])[0]],[t[t.length-1].split(n[1])[1]]]:[r,s]}function pruneIntersections(e){for(var t,r=1;r<e.length;r+=1)t=pruneSegmentIntersection(e[r-1],e[r]),e[r-1]=t[0],e[r]=t[1];return e.length>1&&(t=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=t[0],e[0]=t[1]),e}function offsetSegmentSplit(e,t){var r,s,n,i,o=e.inflectionPoints();if(0===o.length)return[offsetSegment(e,t)];if(1===o.length||floatEqual(o[1],1))return r=(n=e.split(o[0]))[0],s=n[1],[offsetSegment(r,t),offsetSegment(s,t)];r=(n=e.split(o[0]))[0];var a=(o[1]-o[0])/(1-o[0]);return i=(n=n[1].split(a))[0],s=n[1],[offsetSegment(r,t),offsetSegment(i,t),offsetSegment(s,t)]}function OffsetPathModifier(){}function getFontProperties(e){for(var t=e.fStyle?e.fStyle.split(" "):[],r="normal",s="normal",n=t.length,i=0;i<n;i+=1)switch(t[i].toLowerCase()){case"italic":s="italic";break;case"bold":r="700";break;case"black":r="900";break;case"medium":r="500";break;case"regular":case"normal":r="400";break;case"light":case"thin":r="200"}return{style:s,weight:e.fWeight||r}}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,t.c,0,null,this),this.o=PropertyFactory.getProp(e,t.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,t.tr,this),this.so=PropertyFactory.getProp(e,t.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,t.tr.eo,0,.01,this),this.data=t,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,t,r,s,n,i){var o=i?-1:1,a=s.s.v[0]+(1-s.s.v[0])*(1-n),l=s.s.v[1]+(1-s.s.v[1])*(1-n);e.translate(s.p.v[0]*o*n,s.p.v[1]*o*n,s.p.v[2]),t.translate(-s.a.v[0],-s.a.v[1],s.a.v[2]),t.rotate(-s.r.v*o*n),t.translate(s.a.v[0],s.a.v[1],s.a.v[2]),r.translate(-s.a.v[0],-s.a.v[1],s.a.v[2]),r.scale(i?1/a:a,i?1/l:l),r.translate(s.a.v[0],s.a.v[1],s.a.v[2])},RepeaterModifier.prototype.init=function(e,t,r,s){for(this.elem=e,this.arr=t,this.pos=r,this.elemsData=s,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t[r]);r>0;)r-=1,this._elements.unshift(t[r]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var t,r=e.length;for(t=0;t<r;t+=1)e[t]._processed=!1,"gr"===e[t].ty&&this.resetElements(e[t].it)},RepeaterModifier.prototype.cloneElements=function(e){var t=JSON.parse(JSON.stringify(e));return this.resetElements(t),t},RepeaterModifier.prototype.changeGroupRender=function(e,t){var r,s=e.length;for(r=0;r<s;r+=1)e[r]._render=t,"gr"===e[r].ty&&this.changeGroupRender(e[r].it,t)},RepeaterModifier.prototype.processShapes=function(e){var t,r,s,n,i,o=!1;if(this._mdf||e){var a,l=Math.ceil(this.c.v);if(this._groups.length<l){for(;this._groups.length<l;){var c={it:this.cloneElements(this._elements),ty:"gr"};c.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,c),this._groups.splice(0,0,c),this._currentCopies+=1}this.elem.reloadShapes(),o=!0}for(i=0,s=0;s<=this._groups.length-1;s+=1){if(a=i<l,this._groups[s]._render=a,this.changeGroupRender(this._groups[s].it,a),!a){var u=this.elemsData[s].it,d=u[u.length-1];0!==d.transform.op.v?(d.transform.op._mdf=!0,d.transform.op.v=0):d.transform.op._mdf=!1}i+=1}this._currentCopies=l;var p=this.o.v,m=p%1,h=p>0?Math.floor(p):Math.ceil(p),x=this.pMatrix.props,f=this.rMatrix.props,g=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var y,v,E=0;if(p>0){for(;E<h;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),E+=1;m&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,m,!1),E+=m)}else if(p<0){for(;E>h;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),E-=1;m&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-m,!0),E-=m)}for(s=1===this.data.m?0:this._currentCopies-1,n=1===this.data.m?1:-1,i=this._currentCopies;i;){if(v=(r=(t=this.elemsData[s].it)[t.length-1].transform.mProps.v.props).length,t[t.length-1].transform.mProps._mdf=!0,t[t.length-1].transform.op._mdf=!0,t[t.length-1].transform.op.v=1===this._currentCopies?this.so.v:this.so.v+(this.eo.v-this.so.v)*(s/(this._currentCopies-1)),0!==E){for((0!==s&&1===n||s!==this._currentCopies-1&&-1===n)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15]),y=0;y<v;y+=1)r[y]=this.matrix.props[y];this.matrix.reset()}else for(this.matrix.reset(),y=0;y<v;y+=1)r[y]=this.matrix.props[y];E+=1,i-=1,s+=n}}else for(i=this._currentCopies,s=0,n=1;i;)r=(t=this.elemsData[s].it)[t.length-1].transform.mProps.v.props,t[t.length-1].transform.mProps._mdf=!1,t[t.length-1].transform.op._mdf=!1,i-=1,s+=n;return o},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,t.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,t){var r,s=shapePool.newElement();s.c=e.c;var n,i,o,a,l,c,u,d,p,m,h,x,f=e._length,g=0;for(r=0;r<f;r+=1)n=e.v[r],o=e.o[r],i=e.i[r],n[0]===o[0]&&n[1]===o[1]&&n[0]===i[0]&&n[1]===i[1]?0!==r&&r!==f-1||e.c?(a=0===r?e.v[f-1]:e.v[r-1],c=(l=Math.sqrt(Math.pow(n[0]-a[0],2)+Math.pow(n[1]-a[1],2)))?Math.min(l/2,t)/l:0,u=h=n[0]+(a[0]-n[0])*c,d=x=n[1]-(n[1]-a[1])*c,p=u-(u-n[0])*roundCorner,m=d-(d-n[1])*roundCorner,s.setTripleAt(u,d,p,m,h,x,g),g+=1,a=r===f-1?e.v[0]:e.v[r+1],c=(l=Math.sqrt(Math.pow(n[0]-a[0],2)+Math.pow(n[1]-a[1],2)))?Math.min(l/2,t)/l:0,u=p=n[0]+(a[0]-n[0])*c,d=m=n[1]+(a[1]-n[1])*c,h=u-(u-n[0])*roundCorner,x=d-(d-n[1])*roundCorner,s.setTripleAt(u,d,p,m,h,x,g),g+=1):(s.setTripleAt(n[0],n[1],o[0],o[1],i[0],i[1],g),g+=1):(s.setTripleAt(e.v[r][0],e.v[r][1],e.o[r][0],e.o[r][1],e.i[r][0],e.i[r][1],g),g+=1);return s},RoundCornersModifier.prototype.processShapes=function(e){var t,r,s,n,i,o,a=this.shapes.length,l=this.rd.v;if(0!==l)for(r=0;r<a;r+=1){if(o=(i=this.shapes[r]).localShapeCollection,i.shape._mdf||this._mdf||e)for(o.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,n=i.shape.paths._length,s=0;s<n;s+=1)o.addShape(this.processPath(t[s],l));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var t=this.derivative(e);return Math.atan2(t[1],t[0])},PolynomialBezier.prototype.normalAngle=function(e){var t=this.derivative(e);return Math.atan2(t[0],t[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var t=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,r=t*t-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(r<0)return[];var s=Math.sqrt(r);return floatZero(s)?s>0&&s<1?[t]:[]:[t-s,t+s].filter(function(e){return e>0&&e<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var t=lerpPoint(this.points[0],this.points[1],e),r=lerpPoint(this.points[1],this.points[2],e),s=lerpPoint(this.points[2],this.points[3],e),n=lerpPoint(t,r,e),i=lerpPoint(r,s,e),o=lerpPoint(n,i,e);return[new PolynomialBezier(this.points[0],t,n,o,!0),new PolynomialBezier(o,i,s,this.points[3],!0)]},PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}},PolynomialBezier.prototype.intersections=function(e,t,r){void 0===t&&(t=2),void 0===r&&(r=7);var s=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,t,s,r),s},PolynomialBezier.shapeSegment=function(e,t){var r=(t+1)%e.length();return new PolynomialBezier(e.v[t],e.o[t],e.i[r],e.v[r],!0)},PolynomialBezier.shapeSegmentInverted=function(e,t){var r=(t+1)%e.length();return new PolynomialBezier(e.v[r],e.i[r],e.o[t],e.v[t],!0)},extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,t.s,0,null,this),this.frequency=PropertyFactory.getProp(e,t.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,t.pt,0,null,this),this._isAnimated=0!==this.amplitude.effectsSequence.length||0!==this.frequency.effectsSequence.length||0!==this.pointsType.effectsSequence.length},ZigZagModifier.prototype.processPath=function(e,t,r,s){var n=e._length,i=shapePool.newElement();if(i.c=e.c,e.c||(n-=1),0===n)return i;var o=-1,a=PolynomialBezier.shapeSegment(e,0);zigZagCorner(i,e,0,t,r,s,o);for(var l=0;l<n;l+=1)o=zigZagSegment(i,a,t,r,s,-o),a=l!==n-1||e.c?PolynomialBezier.shapeSegment(e,(l+1)%n):null,zigZagCorner(i,e,l+1,t,r,s,o);return i},ZigZagModifier.prototype.processShapes=function(e){var t,r,s,n,i,o,a=this.shapes.length,l=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),u=this.pointsType.v;if(0!==l)for(r=0;r<a;r+=1){if(o=(i=this.shapes[r]).localShapeCollection,i.shape._mdf||this._mdf||e)for(o.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,n=i.shape.paths._length,s=0;s<n;s+=1)o.addShape(this.processPath(t[s],l,c,u));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,t.ml,0,null,this),this.lineJoin=t.lj,this._isAnimated=0!==this.amount.effectsSequence.length},OffsetPathModifier.prototype.processPath=function(e,t,r,s){var n=shapePool.newElement();n.c=e.c;var i,o,a,l=e.length();e.c||(l-=1);var c=[];for(i=0;i<l;i+=1)a=PolynomialBezier.shapeSegment(e,i),c.push(offsetSegmentSplit(a,t));if(!e.c)for(i=l-1;i>=0;i-=1)a=PolynomialBezier.shapeSegmentInverted(e,i),c.push(offsetSegmentSplit(a,t));c=pruneIntersections(c);var u=null,d=null;for(i=0;i<c.length;i+=1){var p=c[i];for(d&&(u=joinLines(n,d,p[0],r,s)),d=p[p.length-1],o=0;o<p.length;o+=1)a=p[o],u&&pointEqual(a.points[0],u)?n.setXYAt(a.points[1][0],a.points[1][1],"o",n.length()-1):n.setTripleAt(a.points[0][0],a.points[0][1],a.points[1][0],a.points[1][1],a.points[0][0],a.points[0][1],n.length()),n.setTripleAt(a.points[3][0],a.points[3][1],a.points[3][0],a.points[3][1],a.points[2][0],a.points[2][1],n.length()),u=a.points[3]}return c.length&&joinLines(n,d,c[0][0],r,s),n},OffsetPathModifier.prototype.processShapes=function(e){var t,r,s,n,i,o,a=this.shapes.length,l=this.amount.v,c=this.miterLimit.v,u=this.lineJoin;if(0!==l)for(r=0;r<a;r+=1){if(o=(i=this.shapes[r]).localShapeCollection,i.shape._mdf||this._mdf||e)for(o.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,n=i.shape.paths._length,s=0;s<n;s+=1)o.addShape(this.processPath(t[s],l,u,c));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var FontManager=function(){var e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var r=127988,s=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function n(e,t){var r=createTag("span");r.setAttribute("aria-hidden",!0),r.style.fontFamily=t;var s=createTag("span");s.innerText="giItT1WQy@!-/#",r.style.position="absolute",r.style.left="-10000px",r.style.top="-10000px",r.style.fontSize="300px",r.style.fontVariant="normal",r.style.fontStyle="normal",r.style.fontWeight="normal",r.style.letterSpacing="0",r.appendChild(s),document.body.appendChild(r);var n=s.offsetWidth;return s.style.fontFamily=function(e){var t,r=e.split(","),s=r.length,n=[];for(t=0;t<s;t+=1)"sans-serif"!==r[t]&&"monospace"!==r[t]&&n.push(r[t]);return n.join(",")}(e)+", "+t,{node:s,w:n,parent:r}}function i(e,t){var r,s=document.body&&t?"svg":"canvas",n=getFontProperties(e);if("svg"===s){var i=createNS("text");i.style.fontSize="100px",i.setAttribute("font-family",e.fFamily),i.setAttribute("font-style",n.style),i.setAttribute("font-weight",n.weight),i.textContent="1",e.fClass?(i.style.fontFamily="inherit",i.setAttribute("class",e.fClass)):i.style.fontFamily=e.fFamily,t.appendChild(i),r=i}else{var o=new OffscreenCanvas(500,500).getContext("2d");o.font=n.style+" "+n.weight+" 100px "+e.fFamily,r=o}return{measureText:function(e){return"svg"===s?(r.textContent=e,r.getComputedTextLength()):r.measureText(e).width}}}function o(e){var t=0,r=e.charCodeAt(0);if(r>=55296&&r<=56319){var s=e.charCodeAt(1);s>=56320&&s<=57343&&(t=1024*(r-55296)+s-56320+65536)}return t}function a(e){var t=o(e);return t>=127462&&t<=127487}var l=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};l.isModifier=function(e,t){var r=e.toString(16)+t.toString(16);return-1!==s.indexOf(r)},l.isZeroWidthJoiner=function(e){return 8205===e},l.isFlagEmoji=function(e){return a(e.substr(0,2))&&a(e.substr(2,2))},l.isRegionalCode=a,l.isCombinedCharacter=function(e){return-1!==t.indexOf(e)},l.isRegionalFlag=function(e,t){var s=o(e.substr(t,2));if(s!==r)return!1;var n=0;for(t+=2;n<5;){if((s=o(e.substr(t,2)))<917601||s>917626)return!1;n+=1,t+=2}return 917631===o(e.substr(t,2))},l.isVariationSelector=function(e){return 65039===e},l.BLACK_FLAG_CODE_POINT=r;var c={addChars:function(e){if(e){var t;this.chars||(this.chars=[]);var r,s,n=e.length,i=this.chars.length;for(t=0;t<n;t+=1){for(r=0,s=!1;r<i;)this.chars[r].style===e[t].style&&this.chars[r].fFamily===e[t].fFamily&&this.chars[r].ch===e[t].ch&&(s=!0),r+=1;s||(this.chars.push(e[t]),i+=1)}}},addFonts:function(e,t){if(e){if(this.chars)return this.isLoaded=!0,void(this.fonts=e.list);if(!document.body)return this.isLoaded=!0,e.list.forEach(function(e){e.helper=i(e),e.cache={}}),void(this.fonts=e.list);var r,s=e.list,o=s.length,a=o;for(r=0;r<o;r+=1){var l,c,u=!0;if(s[r].loaded=!1,s[r].monoCase=n(s[r].fFamily,"monospace"),s[r].sansCase=n(s[r].fFamily,"sans-serif"),s[r].fPath){if("p"===s[r].fOrigin||3===s[r].origin){if((l=document.querySelectorAll('style[f-forigin="p"][f-family="'+s[r].fFamily+'"], style[f-origin="3"][f-family="'+s[r].fFamily+'"]')).length>0&&(u=!1),u){var d=createTag("style");d.setAttribute("f-forigin",s[r].fOrigin),d.setAttribute("f-origin",s[r].origin),d.setAttribute("f-family",s[r].fFamily),d.type="text/css",d.innerText="@font-face {font-family: "+s[r].fFamily+"; font-style: normal; src: url('"+s[r].fPath+"');}",t.appendChild(d)}}else if("g"===s[r].fOrigin||1===s[r].origin){for(l=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),c=0;c<l.length;c+=1)-1!==l[c].href.indexOf(s[r].fPath)&&(u=!1);if(u){var p=createTag("link");p.setAttribute("f-forigin",s[r].fOrigin),p.setAttribute("f-origin",s[r].origin),p.type="text/css",p.rel="stylesheet",p.href=s[r].fPath,document.body.appendChild(p)}}else if("t"===s[r].fOrigin||2===s[r].origin){for(l=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),c=0;c<l.length;c+=1)s[r].fPath===l[c].src&&(u=!1);if(u){var m=createTag("link");m.setAttribute("f-forigin",s[r].fOrigin),m.setAttribute("f-origin",s[r].origin),m.setAttribute("rel","stylesheet"),m.setAttribute("href",s[r].fPath),t.appendChild(m)}}}else s[r].loaded=!0,a-=1;s[r].helper=i(s[r],t),s[r].cache={},this.fonts.push(s[r])}0===a?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},getCharData:function(t,r,s){for(var n=0,i=this.chars.length;n<i;){if(this.chars[n].ch===t&&this.chars[n].style===r&&this.chars[n].fFamily===s)return this.chars[n];n+=1}return("string"==typeof t&&13!==t.charCodeAt(0)||!t)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",t,r,s)),e},getFontByName:function(e){for(var t=0,r=this.fonts.length;t<r;){if(this.fonts[t].fName===e)return this.fonts[t];t+=1}return this.fonts[0]},measureText:function(e,t,r){var s=this.getFontByName(t),n=e;if(!s.cache[n]){var i=s.helper;if(" "===e){var o=i.measureText("|"+e+"|"),a=i.measureText("||");s.cache[n]=(o-a)/100}else s.cache[n]=i.measureText(e)/100}return s.cache[n]*r},checkLoadedFonts:function(){var e,t,r,s=this.fonts.length,n=s;for(e=0;e<s;e+=1)this.fonts[e].loaded?n-=1:"n"===this.fonts[e].fOrigin||0===this.fonts[e].origin?this.fonts[e].loaded=!0:(t=this.fonts[e].monoCase.node,r=this.fonts[e].monoCase.w,t.offsetWidth!==r?(n-=1,this.fonts[e].loaded=!0):(t=this.fonts[e].sansCase.node,r=this.fonts[e].sansCase.w,t.offsetWidth!==r&&(n-=1,this.fonts[e].loaded=!0)),this.fonts[e].loaded&&(this.fonts[e].sansCase.parent.parentNode.removeChild(this.fonts[e].sansCase.parent),this.fonts[e].monoCase.parent.parentNode.removeChild(this.fonts[e].monoCase.parent)));0!==n&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)},setIsLoaded:function(){this.isLoaded=!0}};return l.prototype=c,l}();function SlotManager(e){this.animationData=e}function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){-1===this.renderableComponents.indexOf(e)&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){-1!==this.renderableComponents.indexOf(e)&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(t){return e[t]||""}}();function SliderEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,0,0,r)}function AngleEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,0,0,r)}function ColorEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,1,0,r)}function PointEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,1,0,r)}function LayerIndexEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,0,0,r)}function MaskIndexEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,0,0,r)}function CheckboxEffect(e,t,r){this.p=PropertyFactory.getProp(t,e.v,0,0,r)}function NoValueEffect(){this.p={}}function EffectsManager(e,t){var r,s=e.ef||[];this.effectElements=[];var n,i=s.length;for(r=0;r<i;r+=1)n=new GroupEffect(s[r],t),this.effectElements.push(n)}function GroupEffect(e,t){this.init(e,t)}function BaseElement(){}function FrameElement(){}function FootageElement(e,t,r){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.footageData=t.imageLoader.getAsset(this.assetData),this.initBaseData(e,t,r)}function AudioElement(e,t,r){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.initBaseData(e,t,r),this._isPlaying=!1,this._canPlay=!1;var s=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(s),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,t){var r;this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(t);var s,n=this.data.ef.length,i=this.data.ef;for(r=0;r<n;r+=1){switch(s=null,i[r].ty){case 0:s=new SliderEffect(i[r],t,this);break;case 1:s=new AngleEffect(i[r],t,this);break;case 2:s=new ColorEffect(i[r],t,this);break;case 3:s=new PointEffect(i[r],t,this);break;case 4:case 7:s=new CheckboxEffect(i[r],t,this);break;case 10:s=new LayerIndexEffect(i[r],t,this);break;case 11:s=new MaskIndexEffect(i[r],t,this);break;case 5:s=new EffectsManager(i[r],t);break;default:s=new NoValueEffect(i[r])}s&&this.effectElements.push(s)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if("n"!==this.data.masksProperties[e].mode&&!1!==this.data.masksProperties[e].cl)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(e){var t=e("layer"),r=e("effects"),s=e("shape"),n=e("text"),i=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var o=r.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(o),0===this.data.ty||this.data.xt?this.compInterface=i(this):4===this.data.ty?(this.layerInterface.shapeInterface=s(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=n(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=e},initBaseData:function(e,t,r){this.globalData=t,this.comp=r,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var r,s=this.dynamicProperties.length;for(r=0;r<s;r+=1)(t||this._isParent&&"transform"===this.dynamicProperties[r].propType)&&(this.dynamicProperties[r].getValue(),this.dynamicProperties[r]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&this.dynamicProperties.push(e)}},FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var t=e("footage");this.layerInterface=t(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var t=this.tm.v;this._currentTime=t}this._volume=this.lv.v[0];var r=this._volume*this._volumeMultiplier;this._previousVolume!==r&&(this._previousVolume=r,this.audio.volume(r))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(e){var t,r,s=this.layers.length;for(this.completeLayers=!0,t=s-1;t>=0;t-=1)this.elements[t]||(r=this.layers[t]).ip-r.st<=e-this.layers[t].st&&r.op-r.st>e-this.layers[t].st&&this.buildItem(t),this.completeLayers=!!this.elements[t]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:default:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){var t;this.completeLayers=!1;var r,s=e.length,n=this.layers.length;for(t=0;t<s;t+=1)for(r=0;r<n;){if(this.layers[r].id===e[t].id){this.layers[r]=e[t];break}r+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,t,r){for(var s=this.elements,n=this.layers,i=0,o=n.length;i<o;)n[i].ind==t&&(s[i]&&!0!==s[i]?(r.push(s[i]),s[i].setAsParent(),void 0!==n[i].parent?this.buildElementParenting(e,n[i].parent,r):e.setHierarchy(r)):(this.buildItem(i),this.addPendingElement(e))),i+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var t,r=e.length;for(t=0;t<r;t+=1)if(e[t].xt){var s=this.createComp(e[t]);s.initExpressions(),this.globalData.projectInterface.registerComposition(s)}},BaseRenderer.prototype.getElementById=function(e){var t,r=this.elements.length;for(t=0;t<r;t+=1)if(this.elements[t].data.ind===e)return this.elements[t];return null},BaseRenderer.prototype.getElementByPath=function(e){var t,r=e.shift();if("number"==typeof r)t=this.elements[r];else{var s,n=this.elements.length;for(s=0;s<n;s+=1)if(this.elements[s].data.nm===r){t=this.elements[s];break}}return 0===e.length?t:t.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,t){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,t),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}function MaskElement(e,t,r){this.data=e,this.element=t,this.globalData=r,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var s,n,i=this.globalData.defs,o=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(o),this.solidPath="";var a,l,c,u,d,p,m=this.masksProperties,h=0,x=[],f=createElementID(),g="clipPath",y="clip-path";for(s=0;s<o;s+=1)if(("a"!==m[s].mode&&"n"!==m[s].mode||m[s].inv||100!==m[s].o.k||m[s].o.x)&&(g="mask",y="mask"),"s"!==m[s].mode&&"i"!==m[s].mode||0!==h?c=null:((c=createNS("rect")).setAttribute("fill","#ffffff"),c.setAttribute("width",this.element.comp.data.w||0),c.setAttribute("height",this.element.comp.data.h||0),x.push(c)),n=createNS("path"),"n"===m[s].mode)this.viewData[s]={op:PropertyFactory.getProp(this.element,m[s].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,m[s],3),elem:n,lastPath:""},i.appendChild(n);else{var v;if(h+=1,n.setAttribute("fill","s"===m[s].mode?"#000000":"#ffffff"),n.setAttribute("clip-rule","nonzero"),0!==m[s].x.k?(g="mask",y="mask",p=PropertyFactory.getProp(this.element,m[s].x,0,null,this.element),v=createElementID(),(u=createNS("filter")).setAttribute("id",v),(d=createNS("feMorphology")).setAttribute("operator","erode"),d.setAttribute("in","SourceGraphic"),d.setAttribute("radius","0"),u.appendChild(d),i.appendChild(u),n.setAttribute("stroke","s"===m[s].mode?"#000000":"#ffffff")):(d=null,p=null),this.storedData[s]={elem:n,x:p,expan:d,lastPath:"",lastOperator:"",filterId:v,lastRadius:0},"i"===m[s].mode){l=x.length;var E=createNS("g");for(a=0;a<l;a+=1)E.appendChild(x[a]);var j=createNS("mask");j.setAttribute("mask-type","alpha"),j.setAttribute("id",f+"_"+h),j.appendChild(n),i.appendChild(j),E.setAttribute("mask","url("+getLocationHref()+"#"+f+"_"+h+")"),x.length=0,x.push(E)}else x.push(n);m[s].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[s]={elem:n,lastPath:"",op:PropertyFactory.getProp(this.element,m[s].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,m[s],3),invRect:c},this.viewData[s].prop.k||this.drawPath(m[s],this.viewData[s].prop.v,this.viewData[s])}for(this.maskElement=createNS(g),o=x.length,s=0;s<o;s+=1)this.maskElement.appendChild(x[s]);h>0&&(this.maskElement.setAttribute("id",f),this.element.maskedElement.setAttribute(y,"url("+getLocationHref()+"#"+f+")"),i.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,r=0,s=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;r<s;){if(this.hierarchy[r].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}r+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),r=0;r<s;r+=1)t.multiply(this.hierarchy[r].finalTransform.mProp.v)}this.localTransforms&&!this.finalTransform._matMdf||(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var r=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(r),e=1;e<t;e+=1){var s=this.localTransforms[e].matrix;r.multiply(s)}r.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var n=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)n*=.01*this.localTransforms[e].opacity;this.finalTransform.localOpacity=n}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,r=e.length;for(t=0;t<r;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var r,s=!0,n=this.comp;s;)n.finalTransform?(n.data.hasMask&&t.splice(0,0,n.finalTransform),n=n.comp):s=!1;var i,o=t.length;for(r=0;r<o;r+=1)i=t[r].mat.applyToPointArray(0,0,0),e=[e[0]-i[0],e[1]-i[1],0];return e},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var t,r=this.element.finalTransform.mat,s=this.masksProperties.length;for(t=0;t<s;t+=1)if((this.viewData[t].prop._mdf||e)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||e)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),"n"!==this.masksProperties[t].mode&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[t].invRect.setAttribute("transform",r.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||e))){var n=this.storedData[t].expan;this.storedData[t].x.v<0?("erode"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),n.setAttribute("radius",-this.storedData[t].x.v)):("dilate"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",2*this.storedData[t].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(e,t,r){var s,n,i=" M"+t.v[0][0]+","+t.v[0][1];for(n=t._length,s=1;s<n;s+=1)i+=" C"+t.o[s-1][0]+","+t.o[s-1][1]+" "+t.i[s][0]+","+t.i[s][1]+" "+t.v[s][0]+","+t.v[s][1];if(t.c&&n>1&&(i+=" C"+t.o[s-1][0]+","+t.o[s-1][1]+" "+t.i[0][0]+","+t.i[0][1]+" "+t.v[0][0]+","+t.v[0][1]),r.lastPath!==i){var o="";r.elem&&(t.c&&(o=e.inv?this.solidPath+i:i),r.elem.setAttribute("d",o)),r.lastPath=i}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={createFilter:function(e,t){var r=createNS("filter");return r.setAttribute("id",e),!0!==t&&(r.setAttribute("filterUnits","objectBoundingBox"),r.setAttribute("x","0%"),r.setAttribute("y","0%"),r.setAttribute("width","100%"),r.setAttribute("height","100%")),r},createAlphaToLuminanceFilter:function(){var e=createNS("feColorMatrix");return e.setAttribute("type","matrix"),e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),e}};return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:"undefined"!=typeof OffscreenCanvas};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var t,r,s="SourceGraphic",n=e.data.ef?e.data.ef.length:0,i=createElementID(),o=filtersFactory.createFilter(i,!0),a=0;for(this.filters=[],t=0;t<n;t+=1){r=null;var l=e.data.ef[t].ty;registeredEffects$1[l]&&(r=new(0,registeredEffects$1[l].effect)(o,e.effectsManager.effectElements[t],e,idPrefix+a,s),s=idPrefix+a,registeredEffects$1[l].countsAsEffect&&(a+=1)),r&&this.filters.push(r)}a&&(e.globalData.defs.appendChild(o),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+i+")")),this.filters.length&&e.addRenderableComponent(this)}function registerEffect$1(e,t,r){registeredEffects$1[e]={effect:t,countsAsEffect:r}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(e,t,r){this.assetData=t.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=t.slotManager.getProp(this.assetData)),this.initElement(e,t,r),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(e,t){this.elem=e,this.pos=t}function IShapeElement(){}SVGEffects.prototype.renderFrame=function(e){var t,r=this.filters.length;for(t=0;t<r;t+=1)this.filters[t].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var t,r=this.filters.length,s=[];for(t=0;t<r;t+=1)this.filters[t].type===e&&s.push(this.filters[t]);return s},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var r=createNS("clipPath"),s=createNS("path");s.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var n=createElementID();if(r.setAttribute("id",n),r.appendChild(s),this.globalData.defs.appendChild(r),this.checkMasks()){var i=createNS("g");i.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),i.appendChild(this.layerElement),this.transformedElement=i,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t,r,s,n,i=this.layerId+"_"+e;if(1===e||3===e){var o=createNS("mask");o.setAttribute("id",i),o.setAttribute("mask-type",3===e?"luminance":"alpha"),(s=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),o.appendChild(s),this.globalData.defs.appendChild(o),featureSupport.maskType||1!==e||(o.setAttribute("mask-type","luminance"),t=createElementID(),r=filtersFactory.createFilter(t),this.globalData.defs.appendChild(r),r.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(n=createNS("g")).appendChild(s),o.appendChild(n),n.setAttribute("filter","url("+getLocationHref()+"#"+t+")"))}else if(2===e){var a=createNS("mask");a.setAttribute("id",i),a.setAttribute("mask-type","alpha");var l=createNS("g");a.appendChild(l),t=createElementID(),r=filtersFactory.createFilter(t);var c=createNS("feComponentTransfer");c.setAttribute("in","SourceGraphic"),r.appendChild(c);var u=createNS("feFuncA");u.setAttribute("type","table"),u.setAttribute("tableValues","1.0 0.0"),c.appendChild(u),this.globalData.defs.appendChild(r);var d=createNS("rect");d.setAttribute("width",this.comp.data.w),d.setAttribute("height",this.comp.data.h),d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("fill","#ffffff"),d.setAttribute("opacity","0"),l.setAttribute("filter","url("+getLocationHref()+"#"+t+")"),l.appendChild(d),(s=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),l.appendChild(s),featureSupport.maskType||(a.setAttribute("mask-type","luminance"),r.appendChild(filtersFactory.createAlphaToLuminanceFilter()),n=createNS("g"),l.appendChild(d),n.appendChild(this.layerElement),l.appendChild(n)),this.globalData.defs.appendChild(a)}this.matteMasks[e]=i}return this.matteMasks[e]},setMatte:function(e){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(e,t,r){this.initFrame(),this.initBaseData(e,t,r),this.initTransform(e,t,r),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(e){var t,r=this.shapeModifiers.length;for(t=0;t<r;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=this.shapeModifiers.length;0<t;)if(this.shapeModifiers[0].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();for(e=(t=this.shapeModifiers.length)-1;e>=0&&!this.shapeModifiers[e].processShapes(this._isFirstFrame);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,r=0,s=t.length;r<s;){if(t[r].elem===e)return t[r].pos;r+=1}return 0},addProcessedElement:function(e,t){for(var r=this.processedElements,s=r.length;s;)if(r[s-=1].elem===e)return void(r[s].pos=t);r.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,t,r){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=r,this.lvl=t,this._isAnimated=!!r.k;for(var s=0,n=e.length;s<n;){if(e[s].mProps.dynamicProperties.length){this._isAnimated=!0;break}s+=1}}function SVGStyleData(e,t){this.data=e,this.type=e.ty,this.d="",this.lvl=t,this._mdf=!1,this.closed=!0===e.hd,this.pElem=createNS("path"),this.msElem=null}function DashProperty(e,t,r,s){var n;this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(t.length),this.renderer=r,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",t.length?t.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(s);var i,o=t.length||0;for(n=0;n<o;n+=1)i=PropertyFactory.getProp(e,t[n].v,0,0,this),this.k=i.k||this.k,this.dataProps[n]={n:t[n].n,p:i};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(e,t,r){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=r,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(e,t,r){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=r}function SVGNoStyleData(e,t,r){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=r}function GradientProperty(e,t,r){this.data=t,this.c=createTypedArray("uint8c",4*t.p);var s=t.k.k[0].s?t.k.k[0].s.length-4*t.p:t.k.k.length-4*t.p;this.o=createTypedArray("float32",s),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=s,this.initDynamicPropertyContainer(r),this.prop=PropertyFactory.getProp(e,t.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(e,t,r){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,t,r)}function SVGGradientStrokeStyleData(e,t,r){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.initGradientData(e,t,r),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,t,r){this.transform={mProps:e,op:t,container:r},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(e){if((this.elem.globalData.frameId!==this.frameId||e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var t=0,r=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),t=0;t<r;t+=1)"o"!==this.dataProps[t].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[t].p.v:this.dashArray[t]=this.dataProps[t].p.v:this.dashoffset[0]=this.dataProps[t].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(e,t){for(var r=0,s=this.o.length/2;r<s;){if(Math.abs(e[4*r]-e[4*t+2*r])>.01)return!1;r+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!=this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,t=this.data.k.k.length;e<t;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var t,r,s,n=4*this.data.p;for(t=0;t<n;t+=1)r=t%4==0?100:255,s=Math.round(this.prop.v[t]*r),this.c[t]!==s&&(this.c[t]=s,this._cmdf=!e);if(this.o.length)for(n=this.prop.v.length,t=4*this.data.p;t<n;t+=1)r=t%2==0?100:1,s=t%2==0?Math.round(100*this.prop.v[t]):this.prop.v[t],this.o[t-4*this.data.p]!==s&&(this.o[t-4*this.data.p]=s,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(e,t,r){this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.s=PropertyFactory.getProp(e,t.s,1,null,this),this.e=PropertyFactory.getProp(e,t.e,1,null,this),this.h=PropertyFactory.getProp(e,t.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,t.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,t.g,this),this.style=r,this.stops=[],this.setGradientData(r.pElem,t),this.setGradientOpacity(t,r),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,t){var r=createElementID(),s=createNS(1===t.t?"linearGradient":"radialGradient");s.setAttribute("id",r),s.setAttribute("spreadMethod","pad"),s.setAttribute("gradientUnits","userSpaceOnUse");var n,i,o,a=[];for(o=4*t.g.p,i=0;i<o;i+=4)n=createNS("stop"),s.appendChild(n),a.push(n);e.setAttribute("gf"===t.ty?"fill":"stroke","url("+getLocationHref()+"#"+r+")"),this.gf=s,this.cst=a},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,t){if(this.g._hasOpacity&&!this.g._collapsable){var r,s,n,i=createNS("mask"),o=createNS("path");i.appendChild(o);var a=createElementID(),l=createElementID();i.setAttribute("id",l);var c=createNS(1===e.t?"linearGradient":"radialGradient");c.setAttribute("id",a),c.setAttribute("spreadMethod","pad"),c.setAttribute("gradientUnits","userSpaceOnUse"),n=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var u=this.stops;for(s=4*e.g.p;s<n;s+=2)(r=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),c.appendChild(r),u.push(r);o.setAttribute("gf"===e.ty?"fill":"stroke","url("+getLocationHref()+"#"+a+")"),"gs"===e.ty&&(o.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),o.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),1===e.lj&&o.setAttribute("stroke-miterlimit",e.ml)),this.of=c,this.ms=i,this.ost=u,this.maskId=l,t.msElem=o}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var buildShapeString=function(e,t,r,s){if(0===t)return"";var n,i=e.o,o=e.i,a=e.v,l=" M"+s.applyToPointStringified(a[0][0],a[0][1]);for(n=1;n<t;n+=1)l+=" C"+s.applyToPointStringified(i[n-1][0],i[n-1][1])+" "+s.applyToPointStringified(o[n][0],o[n][1])+" "+s.applyToPointStringified(a[n][0],a[n][1]);return r&&t&&(l+=" C"+s.applyToPointStringified(i[n-1][0],i[n-1][1])+" "+s.applyToPointStringified(o[0][0],o[0][1])+" "+s.applyToPointStringified(a[0][0],a[0][1]),l+="z"),l},SVGElementsRenderer=function(){var e=new Matrix,t=new Matrix;function r(e,t,r){(r||t.transform.op._mdf)&&t.transform.container.setAttribute("opacity",t.transform.op.v),(r||t.transform.mProps._mdf)&&t.transform.container.setAttribute("transform",t.transform.mProps.v.to2dCSS())}function s(){}function n(r,s,n){var i,o,a,l,c,u,d,p,m,h,x=s.styles.length,f=s.lvl;for(u=0;u<x;u+=1){if(l=s.sh._mdf||n,s.styles[u].lvl<f){for(p=t.reset(),m=f-s.styles[u].lvl,h=s.transformers.length-1;!l&&m>0;)l=s.transformers[h].mProps._mdf||l,m-=1,h-=1;if(l)for(m=f-s.styles[u].lvl,h=s.transformers.length-1;m>0;)p.multiply(s.transformers[h].mProps.v),m-=1,h-=1}else p=e;if(o=(d=s.sh.paths)._length,l){for(a="",i=0;i<o;i+=1)(c=d.shapes[i])&&c._length&&(a+=buildShapeString(c,c._length,c.c,p));s.caches[u]=a}else a=s.caches[u];s.styles[u].d+=!0===r.hd?"":a,s.styles[u]._mdf=l||s.styles[u]._mdf}}function i(e,t,r){var s=t.style;(t.c._mdf||r)&&s.pElem.setAttribute("fill","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||r)&&s.pElem.setAttribute("fill-opacity",t.o.v)}function o(e,t,r){a(e,t,r),l(0,t,r)}function a(e,t,r){var s,n,i,o,a,l=t.gf,c=t.g._hasOpacity,u=t.s.v,d=t.e.v;if(t.o._mdf||r){var p="gf"===e.ty?"fill-opacity":"stroke-opacity";t.style.pElem.setAttribute(p,t.o.v)}if(t.s._mdf||r){var m=1===e.t?"x1":"cx",h="x1"===m?"y1":"cy";l.setAttribute(m,u[0]),l.setAttribute(h,u[1]),c&&!t.g._collapsable&&(t.of.setAttribute(m,u[0]),t.of.setAttribute(h,u[1]))}if(t.g._cmdf||r){s=t.cst;var x=t.g.c;for(i=s.length,n=0;n<i;n+=1)(o=s[n]).setAttribute("offset",x[4*n]+"%"),o.setAttribute("stop-color","rgb("+x[4*n+1]+","+x[4*n+2]+","+x[4*n+3]+")")}if(c&&(t.g._omdf||r)){var f=t.g.o;for(i=(s=t.g._collapsable?t.cst:t.ost).length,n=0;n<i;n+=1)o=s[n],t.g._collapsable||o.setAttribute("offset",f[2*n]+"%"),o.setAttribute("stop-opacity",f[2*n+1])}if(1===e.t)(t.e._mdf||r)&&(l.setAttribute("x2",d[0]),l.setAttribute("y2",d[1]),c&&!t.g._collapsable&&(t.of.setAttribute("x2",d[0]),t.of.setAttribute("y2",d[1])));else if((t.s._mdf||t.e._mdf||r)&&(a=Math.sqrt(Math.pow(u[0]-d[0],2)+Math.pow(u[1]-d[1],2)),l.setAttribute("r",a),c&&!t.g._collapsable&&t.of.setAttribute("r",a)),t.s._mdf||t.e._mdf||t.h._mdf||t.a._mdf||r){a||(a=Math.sqrt(Math.pow(u[0]-d[0],2)+Math.pow(u[1]-d[1],2)));var g=Math.atan2(d[1]-u[1],d[0]-u[0]),y=t.h.v;y>=1?y=.99:y<=-1&&(y=-.99);var v=a*y,E=Math.cos(g+t.a.v)*v+u[0],j=Math.sin(g+t.a.v)*v+u[1];l.setAttribute("fx",E),l.setAttribute("fy",j),c&&!t.g._collapsable&&(t.of.setAttribute("fx",E),t.of.setAttribute("fy",j))}}function l(e,t,r){var s=t.style,n=t.d;n&&(n._mdf||r)&&n.dashStr&&(s.pElem.setAttribute("stroke-dasharray",n.dashStr),s.pElem.setAttribute("stroke-dashoffset",n.dashoffset[0])),t.c&&(t.c._mdf||r)&&s.pElem.setAttribute("stroke","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||r)&&s.pElem.setAttribute("stroke-opacity",t.o.v),(t.w._mdf||r)&&(s.pElem.setAttribute("stroke-width",t.w.v),s.msElem&&s.msElem.setAttribute("stroke-width",t.w.v))}return{createRenderFunction:function(e){switch(e.ty){case"fl":return i;case"gf":return a;case"gs":return o;case"st":return l;case"sh":case"el":case"rc":case"sr":return n;case"tr":return r;case"no":return s;default:return null}}}}();function SVGShapeElement(e,t,r){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,t,r),this.prevViewData=[]}function LetterProps(e,t,r,s,n,i){this.o=e,this.sw=t,this.sc=r,this.fc=s,this.m=n,this.p=i,this._mdf={o:!0,sw:!!t,sc:!!r,fc:!!s,m:!0,p:!0}}function TextProperty(e,t){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,t.d&&t.d.sid&&(t.d=e.globalData.slotManager.getProp(t.d)),this.data=t,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,t,r,s,n=this.shapes.length,i=this.stylesList.length,o=[],a=!1;for(r=0;r<i;r+=1){for(s=this.stylesList[r],a=!1,o.length=0,e=0;e<n;e+=1)-1!==(t=this.shapes[e]).styles.indexOf(s)&&(o.push(t),a=t._isAnimated||a);o.length>1&&a&&this.setShapesAsAnimated(o)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var t,r=e.length;for(t=0;t<r;t+=1)e[t].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,t){var r,s=new SVGStyleData(e,t),n=s.pElem;return"st"===e.ty?r=new SVGStrokeStyleData(this,e,s):"fl"===e.ty?r=new SVGFillStyleData(this,e,s):"gf"===e.ty||"gs"===e.ty?(r=new("gf"===e.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,e,s),this.globalData.defs.appendChild(r.gf),r.maskId&&(this.globalData.defs.appendChild(r.ms),this.globalData.defs.appendChild(r.of),n.setAttribute("mask","url("+getLocationHref()+"#"+r.maskId+")"))):"no"===e.ty&&(r=new SVGNoStyleData(this,e,s)),"st"!==e.ty&&"gs"!==e.ty||(n.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),n.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),n.setAttribute("fill-opacity","0"),1===e.lj&&n.setAttribute("stroke-miterlimit",e.ml)),2===e.r&&n.setAttribute("fill-rule","evenodd"),e.ln&&n.setAttribute("id",e.ln),e.cl&&n.setAttribute("class",e.cl),e.bm&&(n.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(s),this.addToAnimatedContents(e,r),r},SVGShapeElement.prototype.createGroupElement=function(e){var t=new ShapeGroupData;return e.ln&&t.gr.setAttribute("id",e.ln),e.cl&&t.gr.setAttribute("class",e.cl),e.bm&&(t.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),t},SVGShapeElement.prototype.createTransformElement=function(e,t){var r=TransformPropertyFactory.getTransformProperty(this,e,this),s=new SVGTransformData(r,r.o,t);return this.addToAnimatedContents(e,s),s},SVGShapeElement.prototype.createShapeElement=function(e,t,r){var s=4;"rc"===e.ty?s=5:"el"===e.ty?s=6:"sr"===e.ty&&(s=7);var n=new SVGShapeData(t,r,ShapePropertyFactory.getShapeProp(this,e,s,this));return this.shapes.push(n),this.addShapeToModifiers(n),this.addToAnimatedContents(e,n),n},SVGShapeElement.prototype.addToAnimatedContents=function(e,t){for(var r=0,s=this.animatedContents.length;r<s;){if(this.animatedContents[r].element===t)return;r+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:t,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var t,r=e.styles,s=this.stylesList.length;for(t=0;t<s;t+=1)-1!==r.indexOf(this.stylesList[t])||this.stylesList[t].closed||r.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,t,r,s,n,i,o){var a,l,c,u,d,p,m=[].concat(i),h=e.length-1,x=[],f=[];for(a=h;a>=0;a-=1){if((p=this.searchProcessedElement(e[a]))?t[a]=r[p-1]:e[a]._render=o,"fl"===e[a].ty||"st"===e[a].ty||"gf"===e[a].ty||"gs"===e[a].ty||"no"===e[a].ty)p?t[a].style.closed=e[a].hd:t[a]=this.createStyleElement(e[a],n),e[a]._render&&t[a].style.pElem.parentNode!==s&&s.appendChild(t[a].style.pElem),x.push(t[a].style);else if("gr"===e[a].ty){if(p)for(c=t[a].it.length,l=0;l<c;l+=1)t[a].prevViewData[l]=t[a].it[l];else t[a]=this.createGroupElement(e[a]);this.searchShapes(e[a].it,t[a].it,t[a].prevViewData,t[a].gr,n+1,m,o),e[a]._render&&t[a].gr.parentNode!==s&&s.appendChild(t[a].gr)}else"tr"===e[a].ty?(p||(t[a]=this.createTransformElement(e[a],s)),u=t[a].transform,m.push(u)):"sh"===e[a].ty||"rc"===e[a].ty||"el"===e[a].ty||"sr"===e[a].ty?(p||(t[a]=this.createShapeElement(e[a],m,n)),this.setElementStyles(t[a])):"tm"===e[a].ty||"rd"===e[a].ty||"ms"===e[a].ty||"pb"===e[a].ty||"zz"===e[a].ty||"op"===e[a].ty?(p?(d=t[a]).closed=!1:((d=ShapeModifiers.getModifier(e[a].ty)).init(this,e[a]),t[a]=d,this.shapeModifiers.push(d)),f.push(d)):"rp"===e[a].ty&&(p?(d=t[a]).closed=!0:(d=ShapeModifiers.getModifier(e[a].ty),t[a]=d,d.init(this,e,a,t),this.shapeModifiers.push(d),o=!1),f.push(d));this.addProcessedElement(e[a],a+1)}for(h=x.length,a=0;a<h;a+=1)x[a].closed=!0;for(h=f.length,a=0;a<h;a+=1)f[a].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){var e;this.renderModifiers();var t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<t;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,t,r=this.animatedContents.length;for(e=0;e<r;e+=1)t=this.animatedContents[e],(this._isFirstFrame||t.element._isAnimated)&&!0!==t.data&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(e,t,r,s,n,i){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var o=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,o=!0),this.sw!==t&&(this.sw=t,this._mdf.sw=!0,o=!0),this.sc!==r&&(this.sc=r,this._mdf.sc=!0,o=!0),this.fc!==s&&(this.fc=s,this._mdf.fc=!0,o=!0),this.m!==n&&(this.m=n,this._mdf.m=!0,o=!0),!i.length||this.p[0]===i[0]&&this.p[1]===i[1]&&this.p[4]===i[4]&&this.p[5]===i[5]&&this.p[12]===i[12]&&this.p[13]===i[13]||(this.p=i,this._mdf.p=!0,o=!0),o},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||e){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var t=this.currentData,r=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var s;this.lock=!0,this._mdf=!1;var n=this.effectsSequence.length,i=e||this.data.d.k[this.keysIndex].s;for(s=0;s<n;s+=1)i=r!==this.keysIndex?this.effectsSequence[s](i,i.t):this.effectsSequence[s](this.currentData,i.t);t!==i&&this.setCurrentData(i),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,t=this.elem.comp.renderedFrame,r=0,s=e.length;r<=s-1&&!(r===s-1||e[r+1].t>t);)r+=1;return this.keysIndex!==r&&(this.keysIndex=r),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var t,r,s=[],n=0,i=e.length,o=!1,a=!1,l="";n<i;)o=a,a=!1,t=e.charCodeAt(n),l=e.charAt(n),FontManager.isCombinedCharacter(t)?o=!0:t>=55296&&t<=56319?FontManager.isRegionalFlag(e,n)?l=e.substr(n,14):(r=e.charCodeAt(n+1))>=56320&&r<=57343&&(FontManager.isModifier(t,r)?(l=e.substr(n,2),o=!0):l=FontManager.isFlagEmoji(e.substr(n,4))?e.substr(n,4):e.substr(n,2)):t>56319?(r=e.charCodeAt(n+1),FontManager.isVariationSelector(t)&&(o=!0)):FontManager.isZeroWidthJoiner(t)&&(o=!0,a=!0),o?(s[s.length-1]+=l,o=!1):s.push(l),n+=l.length;return s},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var t,r,s,n,i,o,a,l=this.elem.globalData.fontManager,c=this.data,u=[],d=0,p=c.m.g,m=0,h=0,x=0,f=[],g=0,y=0,v=l.getFontByName(e.f),E=0,j=getFontProperties(v);e.fWeight=j.weight,e.fStyle=j.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),r=e.finalText.length,e.finalLineHeight=e.lh;var b,w=e.tr/1e3*e.finalSize;if(e.sz)for(var R,_,S=!0,C=e.sz[0],k=e.sz[1];S;){R=0,g=0,r=(_=this.buildFinalText(e.t)).length,w=e.tr/1e3*e.finalSize;var $=-1;for(t=0;t<r;t+=1)b=_[t].charCodeAt(0),s=!1," "===_[t]?$=t:13!==b&&3!==b||(g=0,s=!0,R+=e.finalLineHeight||1.2*e.finalSize),l.chars?(a=l.getCharData(_[t],v.fStyle,v.fFamily),E=s?0:a.w*e.finalSize/100):E=l.measureText(_[t],e.f,e.finalSize),g+E>C&&" "!==_[t]?(-1===$?r+=1:t=$,R+=e.finalLineHeight||1.2*e.finalSize,_.splice(t,$===t?1:0,"\r"),$=-1,g=0):(g+=E,g+=w);R+=v.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&k<R?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=_,r=e.finalText.length,S=!1)}g=-w,E=0;var T,I=0;for(t=0;t<r;t+=1)if(s=!1,13===(b=(T=e.finalText[t]).charCodeAt(0))||3===b?(I=0,f.push(g),y=g>y?g:y,g=-2*w,n="",s=!0,x+=1):n=T,l.chars?(a=l.getCharData(T,v.fStyle,l.getFontByName(e.f).fFamily),E=s?0:a.w*e.finalSize/100):E=l.measureText(n,e.f,e.finalSize)," "===T?I+=E+w:(g+=E+w+I,I=0),u.push({l:E,an:E,add:m,n:s,anIndexes:[],val:n,line:x,animatorJustifyOffset:0}),2==p){if(m+=E,""===n||" "===n||t===r-1){for(""!==n&&" "!==n||(m-=E);h<=t;)u[h].an=m,u[h].ind=d,u[h].extra=E,h+=1;d+=1,m=0}}else if(3==p){if(m+=E,""===n||t===r-1){for(""===n&&(m-=E);h<=t;)u[h].an=m,u[h].ind=d,u[h].extra=E,h+=1;m=0,d+=1}}else u[d].ind=d,u[d].extra=0,d+=1;if(e.l=u,y=g>y?g:y,f.push(g),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=y,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=f;var P,A,F,M,D=c.a;o=D.length;var O=[];for(i=0;i<o;i+=1){for((P=D[i]).a.sc&&(e.strokeColorAnim=!0),P.a.sw&&(e.strokeWidthAnim=!0),(P.a.fc||P.a.fh||P.a.fs||P.a.fb)&&(e.fillColorAnim=!0),M=0,F=P.s.b,t=0;t<r;t+=1)(A=u[t]).anIndexes[i]=M,(1==F&&""!==A.val||2==F&&""!==A.val&&" "!==A.val||3==F&&(A.n||" "==A.val||t==r-1)||4==F&&(A.n||t==r-1))&&(1===P.s.rn&&O.push(M),M+=1);c.a[i].s.totalChars=M;var N,B=-1;if(1===P.s.rn)for(t=0;t<r;t+=1)B!=(A=u[t]).anIndexes[i]&&(B=A.anIndexes[i],N=O.splice(Math.floor(Math.random()*O.length),1)[0]),A.anIndexes[i]=N}e.yOffset=e.finalLineHeight||1.2*e.finalSize,e.ls=e.ls||0,e.ascent=v.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,t){t=void 0===t?this.keysIndex:t;var r=this.copyData({},this.data.d.k[t].s);r=this.copyData(r,e),this.data.d.k[t].s=r,this.recalculate(t),this.setCurrentData(r),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var t=this.data.d.k[e].s;t.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(t)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,t=Math.min,r=Math.floor;function s(e,t){this._currentTextLength=-1,this.k=!1,this.data=t,this.elem=e,this.comp=e.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(e),this.s=PropertyFactory.getProp(e,t.s||{k:0},0,0,this),this.e="e"in t?PropertyFactory.getProp(e,t.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(e,t.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(e,t.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(e,t.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(e,t.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(e,t.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return s.prototype={getMult:function(s){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var n=0,i=0,o=1,a=1;this.ne.v>0?n=this.ne.v/100:i=-this.ne.v/100,this.xe.v>0?o=1-this.xe.v/100:a=1+this.xe.v/100;var l=BezierFactory.getBezierEasing(n,i,o,a).get,c=0,u=this.finalS,d=this.finalE,p=this.data.sh;if(2===p)c=l(c=d===u?s>=d?1:0:e(0,t(.5/(d-u)+(s-u)/(d-u),1)));else if(3===p)c=l(c=d===u?s>=d?0:1:1-e(0,t(.5/(d-u)+(s-u)/(d-u),1)));else if(4===p)d===u?c=0:(c=e(0,t(.5/(d-u)+(s-u)/(d-u),1)))<.5?c*=2:c=1-2*(c-.5),c=l(c);else if(5===p){if(d===u)c=0;else{var m=d-u,h=-m/2+(s=t(e(0,s+.5-u),d-u)),x=m/2;c=Math.sqrt(1-h*h/(x*x))}c=l(c)}else 6===p?(d===u?c=0:(s=t(e(0,s+.5-u),d-u),c=(1+Math.cos(Math.PI+2*Math.PI*s/(d-u)))/2),c=l(c)):(s>=r(u)&&(c=e(0,t(s-u<0?t(d,1)-(u-s):d-s,1))),c=l(c));if(100!==this.sm.v){var f=.01*this.sm.v;0===f&&(f=1e-8);var g=.5-.5*f;c<g?c=0:(c=(c-g)/f)>1&&(c=1)}return c*this.a.v},getValue:function(e){this.iterateDynamicProperties(),this._mdf=e||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,e&&2===this.data.r&&(this.e.v=this._currentTextLength);var t=2===this.data.r?1:100/this.data.totalChars,r=this.o.v/t,s=this.s.v/t+r,n=this.e.v/t+r;if(s>n){var i=s;s=n,n=i}this.finalS=s,this.finalE=n}},extendPrototype([DynamicPropertyContainer],s),{getTextSelectorProp:function(e,t,r){return new s(e,t)}}}();function TextAnimatorDataProperty(e,t,r){var s={propType:!1},n=PropertyFactory.getProp,i=t.a;this.a={r:i.r?n(e,i.r,0,degToRads,r):s,rx:i.rx?n(e,i.rx,0,degToRads,r):s,ry:i.ry?n(e,i.ry,0,degToRads,r):s,sk:i.sk?n(e,i.sk,0,degToRads,r):s,sa:i.sa?n(e,i.sa,0,degToRads,r):s,s:i.s?n(e,i.s,1,.01,r):s,a:i.a?n(e,i.a,1,0,r):s,o:i.o?n(e,i.o,0,.01,r):s,p:i.p?n(e,i.p,1,0,r):s,sw:i.sw?n(e,i.sw,0,0,r):s,sc:i.sc?n(e,i.sc,1,0,r):s,fc:i.fc?n(e,i.fc,1,0,r):s,fh:i.fh?n(e,i.fh,0,0,r):s,fs:i.fs?n(e,i.fs,0,.01,r):s,fb:i.fb?n(e,i.fb,0,.01,r):s,t:i.t?n(e,i.t,0,0,r):s},this.s=TextSelectorProp.getTextSelectorProp(e,t.s,r),this.s.t=t.s.t}function TextAnimatorProperty(e,t,r){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=t,this._elem=r,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(r)}function ITextElement(){}TextAnimatorProperty.prototype.searchProperties=function(){var e,t,r=this._textData.a.length,s=PropertyFactory.getProp;for(e=0;e<r;e+=1)t=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:s(this._elem,this._textData.p.a,0,0,this),f:s(this._elem,this._textData.p.f,0,0,this),l:s(this._elem,this._textData.p.l,0,0,this),r:s(this._elem,this._textData.p.r,0,0,this),p:s(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=s(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,t){if(this.lettersChangedFlag=t,this._mdf||this._isFirstFrame||t||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var r,s,n,i,o,a,l,c,u,d,p,m,h,x,f,g,y,v,E,j=this._moreOptions.alignment.v,b=this._animatorsData,w=this._textData,R=this.mHelper,_=this._renderType,S=this.renderedLetters.length,C=e.l;if(this._hasMaskedPath){if(E=this._pathData.m,!this._pathData.n||this._pathData._mdf){var k,$=E.v;for(this._pathData.r.v&&($=$.reverse()),o={tLength:0,segments:[]},i=$._length-1,g=0,n=0;n<i;n+=1)k=bez.buildBezierData($.v[n],$.v[n+1],[$.o[n][0]-$.v[n][0],$.o[n][1]-$.v[n][1]],[$.i[n+1][0]-$.v[n+1][0],$.i[n+1][1]-$.v[n+1][1]]),o.tLength+=k.segmentLength,o.segments.push(k),g+=k.segmentLength;n=i,E.v.c&&(k=bez.buildBezierData($.v[n],$.v[0],[$.o[n][0]-$.v[n][0],$.o[n][1]-$.v[n][1]],[$.i[0][0]-$.v[0][0],$.i[0][1]-$.v[0][1]]),o.tLength+=k.segmentLength,o.segments.push(k),g+=k.segmentLength),this._pathData.pi=o}if(o=this._pathData.pi,a=this._pathData.f.v,p=0,d=1,c=0,u=!0,x=o.segments,a<0&&E.v.c)for(o.tLength<Math.abs(a)&&(a=-Math.abs(a)%o.tLength),d=(h=x[p=x.length-1].points).length-1;a<0;)a+=h[d].partialLength,(d-=1)<0&&(d=(h=x[p-=1].points).length-1);m=(h=x[p].points)[d-1],f=(l=h[d]).partialLength}i=C.length,r=0,s=0;var T,I,P,A,F,M=1.2*e.finalSize*.714,D=!0;P=b.length;var O,N,B,L,z,V,U,H,W,q,G,Y,K=-1,X=a,J=p,Z=d,Q=-1,ee="",te=this.defaultPropsArray;if(2===e.j||1===e.j){var re=0,se=0,ne=2===e.j?-.5:-1,ie=0,oe=!0;for(n=0;n<i;n+=1)if(C[n].n){for(re&&(re+=se);ie<n;)C[ie].animatorJustifyOffset=re,ie+=1;re=0,oe=!0}else{for(I=0;I<P;I+=1)(T=b[I].a).t.propType&&(oe&&2===e.j&&(se+=T.t.v*ne),(F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars)).length?re+=T.t.v*F[0]*ne:re+=T.t.v*F*ne);oe=!1}for(re&&(re+=se);ie<n;)C[ie].animatorJustifyOffset=re,ie+=1}for(n=0;n<i;n+=1){if(R.reset(),L=1,C[n].n)r=0,s+=e.yOffset,s+=D?1:0,a=X,D=!1,this._hasMaskedPath&&(d=Z,m=(h=x[p=J].points)[d-1],f=(l=h[d]).partialLength,c=0),ee="",G="",W="",Y="",te=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Q!==C[n].line){switch(e.j){case 1:a+=g-e.lineWidths[C[n].line];break;case 2:a+=(g-e.lineWidths[C[n].line])/2}Q=C[n].line}K!==C[n].ind&&(C[K]&&(a+=C[K].extra),a+=C[n].an/2,K=C[n].ind),a+=j[0]*C[n].an*.005;var ae=0;for(I=0;I<P;I+=1)(T=b[I].a).p.propType&&((F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars)).length?ae+=T.p.v[0]*F[0]:ae+=T.p.v[0]*F),T.a.propType&&((F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars)).length?ae+=T.a.v[0]*F[0]:ae+=T.a.v[0]*F);for(u=!0,this._pathData.a.v&&(a=.5*C[0].an+(g-this._pathData.f.v-.5*C[0].an-.5*C[C.length-1].an)*K/(i-1),a+=this._pathData.f.v);u;)c+f>=a+ae||!h?(y=(a+ae-c)/l.partialLength,N=m.point[0]+(l.point[0]-m.point[0])*y,B=m.point[1]+(l.point[1]-m.point[1])*y,R.translate(-j[0]*C[n].an*.005,-j[1]*M*.01),u=!1):h&&(c+=l.partialLength,(d+=1)>=h.length&&(d=0,x[p+=1]?h=x[p].points:E.v.c?(d=0,h=x[p=0].points):(c-=l.partialLength,h=null)),h&&(m=l,f=(l=h[d]).partialLength));O=C[n].an/2-C[n].add,R.translate(-O,0,0)}else O=C[n].an/2-C[n].add,R.translate(-O,0,0),R.translate(-j[0]*C[n].an*.005,-j[1]*M*.01,0);for(I=0;I<P;I+=1)(T=b[I].a).t.propType&&(F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars),0===r&&0===e.j||(this._hasMaskedPath?F.length?a+=T.t.v*F[0]:a+=T.t.v*F:F.length?r+=T.t.v*F[0]:r+=T.t.v*F));for(e.strokeWidthAnim&&(V=e.sw||0),e.strokeColorAnim&&(z=e.sc?[e.sc[0],e.sc[1],e.sc[2]]:[0,0,0]),e.fillColorAnim&&e.fc&&(U=[e.fc[0],e.fc[1],e.fc[2]]),I=0;I<P;I+=1)(T=b[I].a).a.propType&&((F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars)).length?R.translate(-T.a.v[0]*F[0],-T.a.v[1]*F[1],T.a.v[2]*F[2]):R.translate(-T.a.v[0]*F,-T.a.v[1]*F,T.a.v[2]*F));for(I=0;I<P;I+=1)(T=b[I].a).s.propType&&((F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars)).length?R.scale(1+(T.s.v[0]-1)*F[0],1+(T.s.v[1]-1)*F[1],1):R.scale(1+(T.s.v[0]-1)*F,1+(T.s.v[1]-1)*F,1));for(I=0;I<P;I+=1){if(T=b[I].a,F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars),T.sk.propType&&(F.length?R.skewFromAxis(-T.sk.v*F[0],T.sa.v*F[1]):R.skewFromAxis(-T.sk.v*F,T.sa.v*F)),T.r.propType&&(F.length?R.rotateZ(-T.r.v*F[2]):R.rotateZ(-T.r.v*F)),T.ry.propType&&(F.length?R.rotateY(T.ry.v*F[1]):R.rotateY(T.ry.v*F)),T.rx.propType&&(F.length?R.rotateX(T.rx.v*F[0]):R.rotateX(T.rx.v*F)),T.o.propType&&(F.length?L+=(T.o.v*F[0]-L)*F[0]:L+=(T.o.v*F-L)*F),e.strokeWidthAnim&&T.sw.propType&&(F.length?V+=T.sw.v*F[0]:V+=T.sw.v*F),e.strokeColorAnim&&T.sc.propType)for(H=0;H<3;H+=1)F.length?z[H]+=(T.sc.v[H]-z[H])*F[0]:z[H]+=(T.sc.v[H]-z[H])*F;if(e.fillColorAnim&&e.fc){if(T.fc.propType)for(H=0;H<3;H+=1)F.length?U[H]+=(T.fc.v[H]-U[H])*F[0]:U[H]+=(T.fc.v[H]-U[H])*F;T.fh.propType&&(U=F.length?addHueToRGB(U,T.fh.v*F[0]):addHueToRGB(U,T.fh.v*F)),T.fs.propType&&(U=F.length?addSaturationToRGB(U,T.fs.v*F[0]):addSaturationToRGB(U,T.fs.v*F)),T.fb.propType&&(U=F.length?addBrightnessToRGB(U,T.fb.v*F[0]):addBrightnessToRGB(U,T.fb.v*F))}}for(I=0;I<P;I+=1)(T=b[I].a).p.propType&&(F=b[I].s.getMult(C[n].anIndexes[I],w.a[I].s.totalChars),this._hasMaskedPath?F.length?R.translate(0,T.p.v[1]*F[0],-T.p.v[2]*F[1]):R.translate(0,T.p.v[1]*F,-T.p.v[2]*F):F.length?R.translate(T.p.v[0]*F[0],T.p.v[1]*F[1],-T.p.v[2]*F[2]):R.translate(T.p.v[0]*F,T.p.v[1]*F,-T.p.v[2]*F));if(e.strokeWidthAnim&&(W=V<0?0:V),e.strokeColorAnim&&(q="rgb("+Math.round(255*z[0])+","+Math.round(255*z[1])+","+Math.round(255*z[2])+")"),e.fillColorAnim&&e.fc&&(G="rgb("+Math.round(255*U[0])+","+Math.round(255*U[1])+","+Math.round(255*U[2])+")"),this._hasMaskedPath){if(R.translate(0,-e.ls),R.translate(0,j[1]*M*.01+s,0),this._pathData.p.v){v=(l.point[1]-m.point[1])/(l.point[0]-m.point[0]);var le=180*Math.atan(v)/Math.PI;l.point[0]<m.point[0]&&(le+=180),R.rotate(-le*Math.PI/180)}R.translate(N,B,0),a-=j[0]*C[n].an*.005,C[n+1]&&K!==C[n+1].ind&&(a+=C[n].an/2,a+=.001*e.tr*e.finalSize)}else{switch(R.translate(r,s,0),e.ps&&R.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:R.translate(C[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[C[n].line]),0,0);break;case 2:R.translate(C[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[C[n].line])/2,0,0)}R.translate(0,-e.ls),R.translate(O,0,0),R.translate(j[0]*C[n].an*.005,j[1]*M*.01,0),r+=C[n].l+.001*e.tr*e.finalSize}"html"===_?ee=R.toCSS():"svg"===_?ee=R.to2dCSS():te=[R.props[0],R.props[1],R.props[2],R.props[3],R.props[4],R.props[5],R.props[6],R.props[7],R.props[8],R.props[9],R.props[10],R.props[11],R.props[12],R.props[13],R.props[14],R.props[15]],Y=L}S<=n?(A=new LetterProps(Y,W,q,G,ee,te),this.renderedLetters.push(A),S+=1,this.lettersChangedFlag=!0):(A=this.renderedLetters[n],this.lettersChangedFlag=A.update(Y,W,q,G,ee,te)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(e,t,r){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,t,r),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,t,r),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,t){var r,s,n=t.length,i="";for(r=0;r<n;r+=1)"sh"===t[r].ty&&(s=t[r].ks.k,i+=buildShapeString(s,s.i.length,!0,e));return i},ITextElement.prototype.updateDocumentData=function(e,t){this.textProperty.updateDocumentData(e,t)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,t,r,s,n){switch(e.ps&&t.translate(e.ps[0],e.ps[1]+e.ascent,0),t.translate(0,-e.ls,0),e.j){case 1:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[r]),0,0);break;case 2:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[r])/2,0,0)}t.translate(s,n,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,t,r){this.textSpans=[],this.renderType="svg",this.initElement(e,t,r)}function ISolidElement(e,t,r){this.initElement(e,t,r)}function NullElement(e,t,r){this.initFrame(),this.initBaseData(e,t,r),this.initFrame(),this.initTransform(e,t,r),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(e,t,r){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,r),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function SVGRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var r="";if(t&&t.title){var s=createNS("title"),n=createElementID();s.setAttribute("id",n),s.textContent=t.title,this.svgElement.appendChild(s),r+=n}if(t&&t.description){var i=createNS("desc"),o=createElementID();i.setAttribute("id",o),i.textContent=t.description,this.svgElement.appendChild(i),r+=" "+o}r&&this.svgElement.setAttribute("aria-labelledby",r);var a=createNS("defs");this.svgElement.appendChild(a);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",progressiveLoad:t&&t.progressiveLoad||!1,hideOnTransparent:!(t&&!1===t.hideOnTransparent),viewBoxOnly:t&&t.viewBoxOnly||!1,viewBoxSize:t&&t.viewBoxSize||!1,className:t&&t.className||"",id:t&&t.id||"",focusable:t&&t.focusable,filterSize:{width:t&&t.filterSize&&t.filterSize.width||"100%",height:t&&t.filterSize&&t.filterSize.height||"100%",x:t&&t.filterSize&&t.filterSize.x||"0%",y:t&&t.filterSize&&t.filterSize.y||"0%"},width:t&&t.width,height:t&&t.height,runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:a,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var t=0,r=e.length,s=[],n="";t<r;)e[t]===String.fromCharCode(13)||e[t]===String.fromCharCode(3)?(s.push(n),n=""):n+=e[t],t+=1;return s.push(n),s},SVGTextLottieElement.prototype.buildShapeData=function(e,t){if(e.shapes&&e.shapes.length){var r=e.shapes[0];if(r.it){var s=r.it[r.it.length-1];s.s&&(s.s.k[0]=t,s.s.k[1]=t)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){var e,t;this.addDynamicProperty(this);var r=this.textProperty.currentData;this.renderedLetters=createSizedArray(r?r.l.length:0),r.fc?this.layerElement.setAttribute("fill",this.buildColor(r.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),r.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(r.sc)),this.layerElement.setAttribute("stroke-width",r.sw)),this.layerElement.setAttribute("font-size",r.finalSize);var s=this.globalData.fontManager.getFontByName(r.f);if(s.fClass)this.layerElement.setAttribute("class",s.fClass);else{this.layerElement.setAttribute("font-family",s.fFamily);var n=r.fWeight,i=r.fStyle;this.layerElement.setAttribute("font-style",i),this.layerElement.setAttribute("font-weight",n)}this.layerElement.setAttribute("aria-label",r.t);var o,a=r.l||[],l=!!this.globalData.fontManager.chars;t=a.length;var c=this.mHelper,u=this.data.singleShape,d=0,p=0,m=!0,h=.001*r.tr*r.finalSize;if(!u||l||r.sz){var x,f=this.textSpans.length;for(e=0;e<t;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!l||!u||0===e){if(o=f>e?this.textSpans[e].span:createNS(l?"g":"text"),f<=e){if(o.setAttribute("stroke-linecap","butt"),o.setAttribute("stroke-linejoin","round"),o.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=o,l){var g=createNS("g");o.appendChild(g),this.textSpans[e].childSpan=g}this.textSpans[e].span=o,this.layerElement.appendChild(o)}o.style.display="inherit"}if(c.reset(),u&&(a[e].n&&(d=-h,p+=r.yOffset,p+=m?1:0,m=!1),this.applyTextPropertiesToMatrix(r,c,a[e].line,d,p),d+=a[e].l||0,d+=h),l){var y;if(1===(x=this.globalData.fontManager.getCharData(r.finalText[e],s.fStyle,this.globalData.fontManager.getFontByName(r.f).fFamily)).t)y=new SVGCompElement(x.data,this.globalData,this);else{var v=emptyShapeData;x.data&&x.data.shapes&&(v=this.buildShapeData(x.data,r.finalSize)),y=new SVGShapeElement(v,this.globalData,this)}if(this.textSpans[e].glyph){var E=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(E.layerElement),E.destroy()}this.textSpans[e].glyph=y,y._debug=!0,y.prepareFrame(0),y.renderFrame(),this.textSpans[e].childSpan.appendChild(y.layerElement),1===x.t&&this.textSpans[e].childSpan.setAttribute("transform","scale("+r.finalSize/100+","+r.finalSize/100+")")}else u&&o.setAttribute("transform","translate("+c.props[12]+","+c.props[13]+")"),o.textContent=a[e].val,o.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}u&&o&&o.setAttribute("d","")}else{var j=this.textContainer,b="start";switch(r.j){case 1:b="end";break;case 2:b="middle";break;default:b="start"}j.setAttribute("text-anchor",b),j.setAttribute("letter-spacing",h);var w=this.buildTextContents(r.finalText);for(t=w.length,p=r.ps?r.ps[1]+r.ascent:0,e=0;e<t;e+=1)(o=this.textSpans[e].span||createNS("tspan")).textContent=w[e],o.setAttribute("x",0),o.setAttribute("y",p),o.style.display="inherit",j.appendChild(o),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=o,p+=r.finalLineHeight;this.layerElement.appendChild(j)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,t,r=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<r;e+=1)(t=this.textSpans[e].glyph)&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var e,t;this._sizeChanged=!0;var r,s,n,i=this.textAnimator.renderedLetters,o=this.textProperty.currentData.l;for(t=o.length,e=0;e<t;e+=1)o[e].n||(r=i[e],s=this.textSpans[e].span,(n=this.textSpans[e].glyph)&&n.renderFrame(),r._mdf.m&&s.setAttribute("transform",r.m),r._mdf.o&&s.setAttribute("opacity",r.o),r._mdf.sw&&s.setAttribute("stroke-width",r.sw),r._mdf.sc&&s.setAttribute("stroke",r.sc),r._mdf.fc&&s.setAttribute("fill",r.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)},NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var t=this.globalData.defs;this.setupGlobalData(e,t),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var r=createNS("clipPath"),s=createNS("rect");s.setAttribute("width",e.w),s.setAttribute("height",e.h),s.setAttribute("x",0),s.setAttribute("y",0);var n=createElementID();r.setAttribute("id",n),r.appendChild(s),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),t.appendChild(r),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var t=0,r=this.layers.length;for(t=0;t<r;t+=1)if(this.layers[t].ind===e)return t;return-1},SVGRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){t[e]=!0;var r=this.createItem(this.layers[e]);if(t[e]=r,getExpressionsPlugin()&&(0===this.layers[e].ty&&this.globalData.projectInterface.registerComposition(r),r.initExpressions()),this.appendElementInPos(r,e),this.layers[e].tt){var s="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(-1===s)return;if(this.elements[s]&&!0!==this.elements[s]){var n=t[s].getMatte(this.layers[e].tt);r.setMatte(n)}else this.buildItem(s),this.addPendingElement(r)}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var t=0,r=this.elements.length;t<r;){if(this.elements[t]===e){var s="tp"in e.data?this.findIndexByInd(e.data.tp):t-1,n=this.elements[s].getMatte(this.layers[t].tt);e.setMatte(n);break}t+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(this.renderedFrame!==e&&!this.destroyed){var t;null===e?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var r=this.layers.length;for(this.completeLayers||this.checkLayers(e),t=r-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(e-this.layers[t].st);if(this.globalData._mdf)for(t=0;t<r;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,t){var r=e.getBaseElement();if(r){for(var s,n=0;n<t;)this.elements[n]&&!0!==this.elements[n]&&this.elements[n].getBaseElement()&&(s=this.elements[n].getBaseElement()),n+=1;s?this.layerElement.insertBefore(r,s):this.layerElement.appendChild(r)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,t,r){this.initFrame(),this.initBaseData(e,t,r),this.initTransform(e,t,r),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&t.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var t=this.tm.v;t===this.data.op&&(t=this.data.op-1),this.renderedFrame=t}var r,s=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),r=s-1;r>=0;r-=1)(this.completeLayers||this.elements[r])&&(this.elements[r].prepareFrame(this.renderedFrame-this.layers[r].st),this.elements[r]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},ShapeTransformManager.prototype={addTransformSequence:function(e){var t,r=e.length,s="_";for(t=0;t<r;t+=1)s+=e[t].transform.key+"_";var n=this.sequences[s];return n||(n={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[s]=n,this.sequenceList.push(n)),n},processSequence:function(e,t){for(var r=0,s=e.transforms.length,n=t;r<s&&!t;){if(e.transforms[r].transform.mProps._mdf){n=!0;break}r+=1}if(n)for(e.finalTransform.reset(),r=s-1;r>=0;r-=1)e.finalTransform.multiply(e.transforms[r].transform.mProps.v);e._mdf=n},processSequences:function(e){var t,r=this.sequenceList.length;for(t=0;t<r;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,r=null,s=null;function n(){var n,i,o;t||(n=createNS("svg"),i=createNS("filter"),o=createNS("feColorMatrix"),i.setAttribute("id",e),o.setAttribute("type","matrix"),o.setAttribute("color-interpolation-filters","sRGB"),o.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),i.appendChild(o),n.appendChild(i),n.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(n.style.display="none"),s=n,document.body.appendChild(s),t=createTag("canvas"),(r=t.getContext("2d")).filter="url(#"+e+")",r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1))}return{load:n,get:function(s){return t||n(),t.width=s.width,t.height=s.height,r.filter="url(#"+e+")",t}}};function createCanvas(e,t){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,t);var r=createTag("canvas");return r.width=e,r.height=t,r}var assetLoader={loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas:createCanvas},registeredEffects={};function CVEffects(e){var t,r,s=e.data.ef?e.data.ef.length:0;for(this.filters=[],t=0;t<s;t+=1){r=null;var n=e.data.ef[t].ty;registeredEffects[n]&&(r=new(0,registeredEffects[n].effect)(e.effectsManager.effectElements[t],e)),r&&this.filters.push(r)}this.filters.length&&e.addRenderableComponent(this)}function registerEffect(e,t){registeredEffects[e]={effect:t}}function CVMaskElement(e,t){var r;this.data=e,this.element=t,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var s=this.masksProperties.length,n=!1;for(r=0;r<s;r+=1)"n"!==this.masksProperties[r].mode&&(n=!0),this.viewData[r]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[r],3);this.hasMasks=n,n&&this.element.addRenderableComponent(this)}function CVBaseElement(){}CVEffects.prototype.renderFrame=function(e){var t,r=this.filters.length;for(t=0;t<r;t+=1)this.filters[t].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var t,r=this.filters.length,s=[];for(t=0;t<r;t+=1)this.filters[t].type===e&&s.push(this.filters[t]);return s},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e,t,r,s,n=this.element.finalTransform.mat,i=this.element.canvasContext,o=this.masksProperties.length;for(i.beginPath(),e=0;e<o;e+=1)if("n"!==this.masksProperties[e].mode){var a;this.masksProperties[e].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),s=this.viewData[e].v,t=n.applyToPointArray(s.v[0][0],s.v[0][1],0),i.moveTo(t[0],t[1]);var l=s._length;for(a=1;a<l;a+=1)r=n.applyToTriplePoints(s.o[a-1],s.i[a],s.v[a]),i.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);r=n.applyToTriplePoints(s.o[a-1],s.i[0],s.v[0]),i.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};function CVShapeData(e,t,r,s){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var n,i=4;"rc"===t.ty?i=5:"el"===t.ty?i=6:"sr"===t.ty&&(i=7),this.sh=ShapePropertyFactory.getShapeProp(e,t,i,e);var o,a=r.length;for(n=0;n<a;n+=1)r[n].closed||(o={transforms:s.addTransformSequence(r[n].transforms),trNodes:[]},this.styledShapes.push(o),r[n].elements.push(o))}function CVShapeElement(e,t,r){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,t,r)}function CVTextElement(e,t,r){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,t,r)}function CVImageElement(e,t,r){this.assetData=t.getAssetData(e.refId),this.img=t.imageLoader.getAsset(this.assetData),this.initElement(e,t,r)}function CVSolidElement(e,t,r){this.initElement(e,t,r)}function CanvasRendererBase(){}function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){var e;for(this.stack=[],this.cArrPos=0,this.cTr=new Matrix,e=0;e<15;e+=1){var t=new CanvasContext;this.stack[e]=t}this._length=15,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}function CVCompElement(e,t,r){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,t,r),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function CanvasRenderer(e,t){this.animationItem=e,this.renderConfig={clearCanvas:!t||void 0===t.clearCanvas||t.clearCanvas,context:t&&t.context||null,progressiveLoad:t&&t.progressiveLoad||!1,preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",className:t&&t.className||"",id:t&&t.id||"",runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.renderConfig.dpr=t&&t.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=t&&t.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}function HBaseElement(){}function HSolidElement(e,t,r){this.initElement(e,t,r)}function HShapeElement(e,t,r){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,t,r),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}function HTextElement(e,t,r){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,t,r)}function HCameraElement(e,t,r){this.initFrame(),this.initBaseData(e,t,r),this.initHierarchy();var s=PropertyFactory.getProp;if(this.pe=s(this,e.pe,0,0,this),e.ks.p.s?(this.px=s(this,e.ks.p.x,1,0,this),this.py=s(this,e.ks.p.y,1,0,this),this.pz=s(this,e.ks.p.z,1,0,this)):this.p=s(this,e.ks.p,1,0,this),e.ks.a&&(this.a=s(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var n,i=e.ks.or.k.length;for(n=0;n<i;n+=1)e.ks.or.k[n].to=null,e.ks.or.k[n].ti=null}this.or=s(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=s(this,e.ks.rx,0,degToRads,this),this.ry=s(this,e.ks.ry,0,degToRads,this),this.rz=s(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}function HImageElement(e,t,r){this.assetData=t.getAssetData(e.refId),this.initElement(e,t,r)}function HybridRendererBase(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}function HCompElement(e,t,r){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,r),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function HybridRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"},runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var r=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(r),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){this.hidden||this.isInRange&&!this.isTransparent||(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0].getContext("2d");this.clearCanvas(e),e.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");if(this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform),this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1).renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var r=assetLoader.getLumaCanvas(this.canvasContext.canvas);r.getContext("2d").drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(r,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!this.hidden&&!this.data.hd&&(1!==this.data.td||e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=0===this.data.ty;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,t){var r={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(t),transforms:[],elements:[],closed:!0===e.hd},s={};if("fl"===e.ty||"st"===e.ty?(s.c=PropertyFactory.getProp(this,e.c,1,255,this),s.c.k||(r.co="rgb("+bmFloor(s.c.v[0])+","+bmFloor(s.c.v[1])+","+bmFloor(s.c.v[2])+")")):"gf"!==e.ty&&"gs"!==e.ty||(s.s=PropertyFactory.getProp(this,e.s,1,null,this),s.e=PropertyFactory.getProp(this,e.e,1,null,this),s.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),s.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),s.g=new GradientProperty(this,e.g,this)),s.o=PropertyFactory.getProp(this,e.o,0,.01,this),"st"===e.ty||"gs"===e.ty){if(r.lc=lineCapEnum[e.lc||2],r.lj=lineJoinEnum[e.lj||2],1==e.lj&&(r.ml=e.ml),s.w=PropertyFactory.getProp(this,e.w,0,null,this),s.w.k||(r.wi=s.w.v),e.d){var n=new DashProperty(this,e.d,"canvas",this);s.d=n,s.d.k||(r.da=s.d.dashArray,r.do=s.d.dashoffset[0])}}else r.r=2===e.r?"evenodd":"nonzero";return this.stylesList.push(r),s.style=r,s},CVShapeElement.prototype.createGroupElement=function(){return{it:[],prevViewData:[]}},CVShapeElement.prototype.createTransformElement=function(e){return{transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}}},CVShapeElement.prototype.createShapeElement=function(e){var t=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(t),this.addShapeToModifiers(t),t},CVShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var t,r=this.stylesList.length;for(t=0;t<r;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var t,r=e.length;for(t=0;t<r;t+=1)e[t].closed=!0},CVShapeElement.prototype.searchShapes=function(e,t,r,s,n){var i,o,a,l,c,u,d=e.length-1,p=[],m=[],h=[].concat(n);for(i=d;i>=0;i-=1){if((l=this.searchProcessedElement(e[i]))?t[i]=r[l-1]:e[i]._shouldRender=s,"fl"===e[i].ty||"st"===e[i].ty||"gf"===e[i].ty||"gs"===e[i].ty)l?t[i].style.closed=!1:t[i]=this.createStyleElement(e[i],h),p.push(t[i].style);else if("gr"===e[i].ty){if(l)for(a=t[i].it.length,o=0;o<a;o+=1)t[i].prevViewData[o]=t[i].it[o];else t[i]=this.createGroupElement(e[i]);this.searchShapes(e[i].it,t[i].it,t[i].prevViewData,s,h)}else"tr"===e[i].ty?(l||(u=this.createTransformElement(e[i]),t[i]=u),h.push(t[i]),this.addTransformToStyleList(t[i])):"sh"===e[i].ty||"rc"===e[i].ty||"el"===e[i].ty||"sr"===e[i].ty?l||(t[i]=this.createShapeElement(e[i])):"tm"===e[i].ty||"rd"===e[i].ty||"pb"===e[i].ty||"zz"===e[i].ty||"op"===e[i].ty?(l?(c=t[i]).closed=!1:((c=ShapeModifiers.getModifier(e[i].ty)).init(this,e[i]),t[i]=c,this.shapeModifiers.push(c)),m.push(c)):"rp"===e[i].ty&&(l?(c=t[i]).closed=!0:(c=ShapeModifiers.getModifier(e[i].ty),t[i]=c,c.init(this,e,i,t),this.shapeModifiers.push(c),s=!1),m.push(c));this.addProcessedElement(e[i],i+1)}for(this.removeTransformFromStyleList(),this.closeStyles(p),d=m.length,i=0;i<d;i+=1)m[i].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,t){(e._opMdf||t.op._mdf||this._isFirstFrame)&&(t.opacity=e.opacity,t.opacity*=t.op.v,t._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,t,r,s,n,i,o,a,l,c=this.stylesList.length,u=this.globalData.renderer,d=this.globalData.canvasContext;for(e=0;e<c;e+=1)if(("st"!==(a=(l=this.stylesList[e]).type)&&"gs"!==a||0!==l.wi)&&l.data._shouldRender&&0!==l.coOp&&0!==this.globalData.currentGlobalAlpha){for(u.save(),i=l.elements,"st"===a||"gs"===a?(u.ctxStrokeStyle("st"===a?l.co:l.grd),u.ctxLineWidth(l.wi),u.ctxLineCap(l.lc),u.ctxLineJoin(l.lj),u.ctxMiterLimit(l.ml||0)):u.ctxFillStyle("fl"===a?l.co:l.grd),u.ctxOpacity(l.coOp),"st"!==a&&"gs"!==a&&d.beginPath(),u.ctxTransform(l.preTransforms.finalTransform.props),r=i.length,t=0;t<r;t+=1){for("st"!==a&&"gs"!==a||(d.beginPath(),l.da&&(d.setLineDash(l.da),d.lineDashOffset=l.do)),n=(o=i[t].trNodes).length,s=0;s<n;s+=1)"m"===o[s].t?d.moveTo(o[s].p[0],o[s].p[1]):"c"===o[s].t?d.bezierCurveTo(o[s].pts[0],o[s].pts[1],o[s].pts[2],o[s].pts[3],o[s].pts[4],o[s].pts[5]):d.closePath();"st"!==a&&"gs"!==a||(u.ctxStroke(),l.da&&d.setLineDash(this.dashResetter))}"st"!==a&&"gs"!==a&&this.globalData.renderer.ctxFill(l.r),u.restore()}},CVShapeElement.prototype.renderShape=function(e,t,r,s){var n,i;for(i=e,n=t.length-1;n>=0;n-=1)"tr"===t[n].ty?(i=r[n].transform,this.renderShapeTransform(e,i)):"sh"===t[n].ty||"el"===t[n].ty||"rc"===t[n].ty||"sr"===t[n].ty?this.renderPath(t[n],r[n]):"fl"===t[n].ty?this.renderFill(t[n],r[n],i):"st"===t[n].ty?this.renderStroke(t[n],r[n],i):"gf"===t[n].ty||"gs"===t[n].ty?this.renderGradientFill(t[n],r[n],i):"gr"===t[n].ty?this.renderShape(i,t[n].it,r[n].it):t[n].ty;s&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,t){if(this._isFirstFrame||t._mdf||e.transforms._mdf){var r,s,n,i=e.trNodes,o=t.paths,a=o._length;i.length=0;var l=e.transforms.finalTransform;for(n=0;n<a;n+=1){var c=o.shapes[n];if(c&&c.v){for(s=c._length,r=1;r<s;r+=1)1===r&&i.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),i.push({t:"c",pts:l.applyToTriplePoints(c.o[r-1],c.i[r],c.v[r])});1===s&&i.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),c.c&&s&&(i.push({t:"c",pts:l.applyToTriplePoints(c.o[r-1],c.i[0],c.v[0])}),i.push({t:"z"}))}}e.trNodes=i}},CVShapeElement.prototype.renderPath=function(e,t){if(!0!==e.hd&&e._shouldRender){var r,s=t.styledShapes.length;for(r=0;r<s;r+=1)this.renderStyledShape(t.styledShapes[r],t.sh)}},CVShapeElement.prototype.renderFill=function(e,t,r){var s=t.style;(t.c._mdf||this._isFirstFrame)&&(s.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||r._opMdf||this._isFirstFrame)&&(s.coOp=t.o.v*r.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,t,r){var s,n=t.style;if(!n.grd||t.g._mdf||t.s._mdf||t.e._mdf||1!==e.t&&(t.h._mdf||t.a._mdf)){var i,o=this.globalData.canvasContext,a=t.s.v,l=t.e.v;if(1===e.t)s=o.createLinearGradient(a[0],a[1],l[0],l[1]);else{var c=Math.sqrt(Math.pow(a[0]-l[0],2)+Math.pow(a[1]-l[1],2)),u=Math.atan2(l[1]-a[1],l[0]-a[0]),d=t.h.v;d>=1?d=.99:d<=-1&&(d=-.99);var p=c*d,m=Math.cos(u+t.a.v)*p+a[0],h=Math.sin(u+t.a.v)*p+a[1];s=o.createRadialGradient(m,h,0,a[0],a[1],c)}var x=e.g.p,f=t.g.c,g=1;for(i=0;i<x;i+=1)t.g._hasOpacity&&t.g._collapsable&&(g=t.g.o[2*i+1]),s.addColorStop(f[4*i]/100,"rgba("+f[4*i+1]+","+f[4*i+2]+","+f[4*i+3]+","+g+")");n.grd=s}n.coOp=t.o.v*r.opacity},CVShapeElement.prototype.renderStroke=function(e,t,r){var s=t.style,n=t.d;n&&(n._mdf||this._isFirstFrame)&&(s.da=n.dashArray,s.do=n.dashoffset[0]),(t.c._mdf||this._isFirstFrame)&&(s.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||r._opMdf||this._isFirstFrame)&&(s.coOp=t.o.v*r.opacity),(t.w._mdf||this._isFirstFrame)&&(s.wi=t.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=!1;e.fc?(t=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=t;var r=!1;e.sc&&(r=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var s,n,i,o,a,l,c,u,d,p,m,h,x=this.globalData.fontManager.getFontByName(e.f),f=e.l,g=this.mHelper;this.stroke=r,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,n=e.finalText.length;var y=this.data.singleShape,v=.001*e.tr*e.finalSize,E=0,j=0,b=!0,w=0;for(s=0;s<n;s+=1){o=(i=this.globalData.fontManager.getCharData(e.finalText[s],x.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily))&&i.data||{},g.reset(),y&&f[s].n&&(E=-v,j+=e.yOffset,j+=b?1:0,b=!1),d=(c=o.shapes?o.shapes[0].it:[]).length,g.scale(e.finalSize/100,e.finalSize/100),y&&this.applyTextPropertiesToMatrix(e,g,f[s].line,E,j),m=createSizedArray(d-1);var R=0;for(u=0;u<d;u+=1)if("sh"===c[u].ty){for(l=c[u].ks.k.i.length,p=c[u].ks.k,h=[],a=1;a<l;a+=1)1===a&&h.push(g.applyToX(p.v[0][0],p.v[0][1],0),g.applyToY(p.v[0][0],p.v[0][1],0)),h.push(g.applyToX(p.o[a-1][0],p.o[a-1][1],0),g.applyToY(p.o[a-1][0],p.o[a-1][1],0),g.applyToX(p.i[a][0],p.i[a][1],0),g.applyToY(p.i[a][0],p.i[a][1],0),g.applyToX(p.v[a][0],p.v[a][1],0),g.applyToY(p.v[a][0],p.v[a][1],0));h.push(g.applyToX(p.o[a-1][0],p.o[a-1][1],0),g.applyToY(p.o[a-1][0],p.o[a-1][1],0),g.applyToX(p.i[0][0],p.i[0][1],0),g.applyToY(p.i[0][0],p.i[0][1],0),g.applyToX(p.v[0][0],p.v[0][1],0),g.applyToY(p.v[0][0],p.v[0][1],0)),m[R]=h,R+=1}y&&(E+=f[s].l,E+=v),this.textSpans[w]?this.textSpans[w].elem=m:this.textSpans[w]={elem:m},w+=1}},CVTextElement.prototype.renderInnerContent=function(){var e,t,r,s,n,i;this.validateText(),this.canvasContext.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var o,a=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var c,u,d=null,p=null,m=null,h=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if((o=a[e])&&(h.save(),h.ctxTransform(o.p),h.ctxOpacity(o.o)),this.fill){for(o&&o.fc?d!==o.fc&&(h.ctxFillStyle(o.fc),d=o.fc):d!==this.values.fill&&(d=this.values.fill,h.ctxFillStyle(this.values.fill)),s=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),r=0;r<s;r+=1)for(i=(u=c[r]).length,this.globalData.canvasContext.moveTo(u[0],u[1]),n=2;n<i;n+=6)this.globalData.canvasContext.bezierCurveTo(u[n],u[n+1],u[n+2],u[n+3],u[n+4],u[n+5]);this.globalData.canvasContext.closePath(),h.ctxFill()}if(this.stroke){for(o&&o.sw?m!==o.sw&&(m=o.sw,h.ctxLineWidth(o.sw)):m!==this.values.sWidth&&(m=this.values.sWidth,h.ctxLineWidth(this.values.sWidth)),o&&o.sc?p!==o.sc&&(p=o.sc,h.ctxStrokeStyle(o.sc)):p!==this.values.stroke&&(p=this.values.stroke,h.ctxStrokeStyle(this.values.stroke)),s=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),r=0;r<s;r+=1)for(i=(u=c[r]).length,this.globalData.canvasContext.moveTo(u[0],u[1]),n=2;n<i;n+=6)this.globalData.canvasContext.bezierCurveTo(u[n],u[n+1],u[n+2],u[n+3],u[n+4],u[n+5]);this.globalData.canvasContext.closePath(),h.ctxStroke()}o&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var t,r,s=e.getContext("2d"),n=this.img.width,i=this.img.height,o=n/i,a=this.assetData.w/this.assetData.h,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;o>a&&"xMidYMid slice"===l||o<a&&"xMidYMid slice"!==l?t=(r=i)*a:r=(t=n)/a,s.drawImage(this.img,(n-t)/2,(i-r)/2,t,r,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){1===e[0]&&0===e[1]&&0===e[4]&&1===e[5]&&0===e[12]&&0===e[13]||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,t,r,s){this.canvasContext.fillRect(e,t,r,s)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){this.renderConfig.clearCanvas?this.contextData.reset():this.canvasContext.restore()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){this.renderConfig.clearCanvas?(e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)):this.canvasContext.restore()},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var t=this.animationItem.container.style;t.width="100%",t.height="100%";var r="0px 0px 0px";t.transformOrigin=r,t.mozTransformOrigin=r,t.webkitTransformOrigin=r,t["-webkit-transform"]=r,t.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,t){var r,s,n,i;if(this.reset(),e?(r=e,s=t,this.canvasContext.canvas.width=r,this.canvasContext.canvas.height=s):(this.animationItem.wrapper&&this.animationItem.container?(r=this.animationItem.wrapper.offsetWidth,s=this.animationItem.wrapper.offsetHeight):(r=this.canvasContext.canvas.width,s=this.canvasContext.canvas.height),this.canvasContext.canvas.width=r*this.renderConfig.dpr,this.canvasContext.canvas.height=s*this.renderConfig.dpr),-1!==this.renderConfig.preserveAspectRatio.indexOf("meet")||-1!==this.renderConfig.preserveAspectRatio.indexOf("slice")){var o=this.renderConfig.preserveAspectRatio.split(" "),a=o[1]||"meet",l=o[0]||"xMidYMid",c=l.substr(0,4),u=l.substr(4);n=r/s,(i=this.transformCanvas.w/this.transformCanvas.h)>n&&"meet"===a||i<n&&"slice"===a?(this.transformCanvas.sx=r/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=s/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.h/this.renderConfig.dpr)),this.transformCanvas.tx="xMid"===c&&(i<n&&"meet"===a||i>n&&"slice"===a)?(r-this.transformCanvas.w*(s/this.transformCanvas.h))/2*this.renderConfig.dpr:"xMax"===c&&(i<n&&"meet"===a||i>n&&"slice"===a)?(r-this.transformCanvas.w*(s/this.transformCanvas.h))*this.renderConfig.dpr:0,this.transformCanvas.ty="YMid"===u&&(i>n&&"meet"===a||i<n&&"slice"===a)?(s-this.transformCanvas.h*(r/this.transformCanvas.w))/2*this.renderConfig.dpr:"YMax"===u&&(i>n&&"meet"===a||i<n&&"slice"===a)?(s-this.transformCanvas.h*(r/this.transformCanvas.w))*this.renderConfig.dpr:0}else"none"===this.renderConfig.preserveAspectRatio?(this.transformCanvas.sx=r/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){var e;for(this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),e=(this.layers?this.layers.length:0)-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,t){if((this.renderedFrame!==e||!0!==this.renderConfig.clearCanvas||t)&&!this.destroyed&&-1!==e){var r;this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||t,this.globalData.projectInterface.currentFrame=e;var s=this.layers.length;for(this.completeLayers||this.checkLayers(e),r=s-1;r>=0;r-=1)(this.completeLayers||this.elements[r])&&this.elements[r].prepareFrame(e-this.layers[r].st);if(this.globalData._mdf){for(!0===this.renderConfig.clearCanvas?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),r=s-1;r>=0;r-=1)(this.completeLayers||this.elements[r])&&this.elements[r].renderFrame();!0!==this.renderConfig.clearCanvas&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){var r=this.createItem(this.layers[e],this,this.globalData);t[e]=r,r.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},CVContextData.prototype.duplicate=function(){var e=2*this._length,t=0;for(t=this._length;t<e;t+=1)this.stack[t]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var t,r=this.stack[this.cArrPos],s=r.transform,n=this.cTr.props;for(t=0;t<16;t+=1)n[t]=s[t];if(e){this.nativeContext.restore();var i=this.stack[this.cArrPos+1];this.appliedFillStyle=i.fillStyle,this.appliedStrokeStyle=i.strokeStyle,this.appliedLineWidth=i.lineWidth,this.appliedLineCap=i.lineCap,this.appliedLineJoin=i.lineJoin,this.appliedMiterLimit=i.miterLimit}this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13]),(e||-1!==r.opacity&&this.currentOpacity!==r.opacity)&&(this.nativeContext.globalAlpha=r.opacity,this.currentOpacity=r.opacity),this.currentFillStyle=r.fillStyle,this.currentStrokeStyle=r.strokeStyle,this.currentLineWidth=r.lineWidth,this.currentLineCap=r.lineCap,this.currentLineJoin=r.lineJoin,this.currentMiterLimit=r.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var t=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var r,s=this.stack[this.cArrPos];for(r=0;r<16;r+=1)s.transform[r]=t[r];this.cArrPos+=1;var n=this.stack[this.cArrPos];n.opacity=s.opacity,n.fillStyle=s.fillStyle,n.strokeStyle=s.strokeStyle,n.lineWidth=s.lineWidth,n.lineCap=s.lineCap,n.lineJoin=s.lineJoin,n.miterLimit=s.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var t=this.cTr;this.transformMat.multiply(t),t.cloneFromProps(this.transformMat.props);var r=t.props;this.nativeContext.setTransform(r[0],r[1],r[4],r[5],r[12],r[13])},CVContextData.prototype.opacity=function(e){var t=this.stack[this.cArrPos].opacity;t*=e<0?0:e,this.stack[this.cArrPos].opacity!==t&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=t)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,t,r,s){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,t,r,s)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e,t=this.canvasContext;for(t.beginPath(),t.moveTo(0,0),t.lineTo(this.data.w,0),t.lineTo(this.data.w,this.data.h),t.lineTo(0,this.data.h),t.lineTo(0,0),t.clip(),e=this.layers.length-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var e;for(e=this.layers.length-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0!==this.data.bm&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting,extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?((e=createNS("rect")).setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):((e=createTag("div")).style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)},extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var t=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",t.w),e.setAttribute("height",t.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,t){var r,s=e.length;for(r=0;r<s;r+=1)t=e[r].mProps.v.applyToPointArray(t[0],t[1],0);return t},HShapeElement.prototype.calculateShapeBoundingBox=function(e,t){var r,s,n,i,o,a=e.sh.v,l=e.transformers,c=a._length;if(!(c<=1)){for(r=0;r<c-1;r+=1)s=this.getTransformedPoint(l,a.v[r]),n=this.getTransformedPoint(l,a.o[r]),i=this.getTransformedPoint(l,a.i[r+1]),o=this.getTransformedPoint(l,a.v[r+1]),this.checkBounds(s,n,i,o,t);a.c&&(s=this.getTransformedPoint(l,a.v[r]),n=this.getTransformedPoint(l,a.o[r]),i=this.getTransformedPoint(l,a.i[0]),o=this.getTransformedPoint(l,a.v[0]),this.checkBounds(s,n,i,o,t))}},HShapeElement.prototype.checkBounds=function(e,t,r,s,n){this.getBoundsOfCurve(e,t,r,s);var i=this.shapeBoundingBox;n.x=bmMin(i.left,n.x),n.xMax=bmMax(i.right,n.xMax),n.y=bmMin(i.top,n.y),n.yMax=bmMax(i.bottom,n.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,t,r,s){for(var n,i,o,a,l,c,u,d=[[e[0],s[0]],[e[1],s[1]]],p=0;p<2;++p)i=6*e[p]-12*t[p]+6*r[p],n=-3*e[p]+9*t[p]-9*r[p]+3*s[p],o=3*t[p]-3*e[p],i|=0,o|=0,0==(n|=0)&&0===i||(0===n?(a=-o/i)>0&&a<1&&d[p].push(this.calculateF(a,e,t,r,s,p)):(l=i*i-4*o*n)>=0&&((c=(-i+bmSqrt(l))/(2*n))>0&&c<1&&d[p].push(this.calculateF(c,e,t,r,s,p)),(u=(-i-bmSqrt(l))/(2*n))>0&&u<1&&d[p].push(this.calculateF(u,e,t,r,s,p))));this.shapeBoundingBox.left=bmMin.apply(null,d[0]),this.shapeBoundingBox.top=bmMin.apply(null,d[1]),this.shapeBoundingBox.right=bmMax.apply(null,d[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,d[1])},HShapeElement.prototype.calculateF=function(e,t,r,s,n,i){return bmPow(1-e,3)*t[i]+3*bmPow(1-e,2)*e*r[i]+3*(1-e)*bmPow(e,2)*s[i]+bmPow(e,3)*n[i]},HShapeElement.prototype.calculateBoundingBox=function(e,t){var r,s=e.length;for(r=0;r<s;r+=1)e[r]&&e[r].sh?this.calculateShapeBoundingBox(e[r],t):e[r]&&e[r].it?this.calculateBoundingBox(e[r].it,t):e[r]&&e[r].style&&e[r].w&&this.expandStrokeBoundingBox(e[r].w,t)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,t){var r=0;if(e.keyframes){for(var s=0;s<e.keyframes.length;s+=1){var n=e.keyframes[s].s;n>r&&(r=n)}r*=e.mult}else r=e.v*e.mult;t.x-=r,t.xMax+=r,t.y-=r,t.yMax+=r},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,t=999999;if(e.x=t,e.xMax=-t,e.y=t,e.yMax=-t,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var r=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),r=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),r=!0),r||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var s=this.shapeCont.style,n="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";s.transform=n,s.webkitTransform=n}}},extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=this.innerElem.style,r=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";t.fill=r,t.color=r,e.sc&&(t.stroke=this.buildColor(e.sc),t.strokeWidth=e.sw+"px");var s,n,i=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(t.fontSize=e.finalSize+"px",t.lineHeight=e.finalSize+"px",i.fClass)this.innerElem.className=i.fClass;else{t.fontFamily=i.fFamily;var o=e.fWeight,a=e.fStyle;t.fontStyle=a,t.fontWeight=o}var l,c,u,d=e.l;n=d.length;var p,m=this.mHelper,h="",x=0;for(s=0;s<n;s+=1){if(this.globalData.fontManager.chars?(this.textPaths[x]?l=this.textPaths[x]:((l=createNS("path")).setAttribute("stroke-linecap",lineCapEnum[1]),l.setAttribute("stroke-linejoin",lineJoinEnum[2]),l.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[x]?u=(c=this.textSpans[x]).children[0]:((c=createTag("div")).style.lineHeight=0,(u=createNS("svg")).appendChild(l),styleDiv(c)))):this.isMasked?l=this.textPaths[x]?this.textPaths[x]:createNS("text"):this.textSpans[x]?(c=this.textSpans[x],l=this.textPaths[x]):(styleDiv(c=createTag("span")),styleDiv(l=createTag("span")),c.appendChild(l)),this.globalData.fontManager.chars){var f,g=this.globalData.fontManager.getCharData(e.finalText[s],i.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily);if(f=g?g.data:null,m.reset(),f&&f.shapes&&f.shapes.length&&(p=f.shapes[0].it,m.scale(e.finalSize/100,e.finalSize/100),h=this.createPathShape(m,p),l.setAttribute("d",h)),this.isMasked)this.innerElem.appendChild(l);else{if(this.innerElem.appendChild(c),f&&f.shapes){document.body.appendChild(u);var y=u.getBBox();u.setAttribute("width",y.width+2),u.setAttribute("height",y.height+2),u.setAttribute("viewBox",y.x-1+" "+(y.y-1)+" "+(y.width+2)+" "+(y.height+2));var v=u.style,E="translate("+(y.x-1)+"px,"+(y.y-1)+"px)";v.transform=E,v.webkitTransform=E,d[s].yOffset=y.y-1}else u.setAttribute("width",1),u.setAttribute("height",1);c.appendChild(u)}}else if(l.textContent=d[s].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(l);else{this.innerElem.appendChild(c);var j=l.style,b="translate3d(0,"+-e.finalSize/1.2+"px,0)";j.transform=b,j.webkitTransform=b}this.isMasked?this.textSpans[x]=l:this.textSpans[x]=c,this.textSpans[x].style.display="block",this.textPaths[x]=l,x+=1}for(;x<this.textSpans.length;)this.textSpans[x].style.display="none",x+=1},HTextElement.prototype.renderInnerContent=function(){var e;if(this.validateText(),this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var t="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=t,e.webkitTransform=t}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag){var r,s,n,i,o,a=0,l=this.textAnimator.renderedLetters,c=this.textProperty.currentData.l;for(s=c.length,r=0;r<s;r+=1)c[r].n?a+=1:(i=this.textSpans[r],o=this.textPaths[r],n=l[a],a+=1,n._mdf.m&&(this.isMasked?i.setAttribute("transform",n.m):(i.style.webkitTransform=n.m,i.style.transform=n.m)),i.style.opacity=n.o,n.sw&&n._mdf.sw&&o.setAttribute("stroke-width",n.sw),n.sc&&n._mdf.sc&&o.setAttribute("stroke",n.sc),n.fc&&n._mdf.fc&&(o.setAttribute("fill",n.fc),o.style.color=n.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var u=this.innerElem.getBBox();if(this.currentBBox.w!==u.width&&(this.currentBBox.w=u.width,this.svgElement.setAttribute("width",u.width)),this.currentBBox.h!==u.height&&(this.currentBBox.h=u.height,this.svgElement.setAttribute("height",u.height)),this.currentBBox.w!==u.width+2||this.currentBBox.h!==u.height+2||this.currentBBox.x!==u.x-1||this.currentBBox.y!==u.y-1){this.currentBBox.w=u.width+2,this.currentBBox.h=u.height+2,this.currentBBox.x=u.x-1,this.currentBBox.y=u.y-1,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var d="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=d,e.webkitTransform=d}}}},extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,t,r,s,n=this.comp.threeDElements.length;for(e=0;e<n;e+=1)if("3d"===(t=this.comp.threeDElements[e]).type){r=t.perspectiveElem.style,s=t.container.style;var i=this.pe.v+"px",o="0px 0px 0px",a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";r.perspective=i,r.webkitPerspective=i,s.transformOrigin=o,s.mozTransformOrigin=o,s.webkitTransformOrigin=o,r.transform=a,r.webkitTransform=a}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e,t,r=this._isFirstFrame;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)r=this.hierarchy[e].finalTransform.mProp._mdf||r;if(r||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(e=t=this.hierarchy.length-1;e>=0;e-=1){var s=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-s.p.v[0],-s.p.v[1],s.p.v[2]),this.mat.rotateX(-s.or.v[0]).rotateY(-s.or.v[1]).rotateZ(s.or.v[2]),this.mat.rotateX(-s.rx.v).rotateY(-s.ry.v).rotateZ(s.rz.v),this.mat.scale(1/s.s.v[0],1/s.s.v[1],1/s.s.v[2]),this.mat.translate(s.a.v[0],s.a.v[1],s.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var n;n=this.p?[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var i=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)),o=[n[0]/i,n[1]/i,n[2]/i],a=Math.sqrt(o[2]*o[2]+o[0]*o[0]),l=Math.atan2(o[1],a),c=Math.atan2(o[0],-o[2]);this.mat.rotateY(c).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var u=!this._prevMat.equals(this.mat);if((u||this.pe._mdf)&&this.comp.threeDElements){var d,p,m;for(t=this.comp.threeDElements.length,e=0;e<t;e+=1)if("3d"===(d=this.comp.threeDElements[e]).type){if(u){var h=this.mat.toCSS();(m=d.container.style).transform=h,m.webkitTransform=h}this.pe._mdf&&((p=d.perspectiveElem.style).perspective=this.pe.v+"px",p.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null},extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),t=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(t),t.crossOrigin="anonymous",t.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)},extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},HybridRendererBase.prototype.appendElementInPos=function(e,t){var r=e.getBaseElement();if(r){var s=this.layers[t];if(s.ddd&&this.supports3d)this.addTo3dContainer(r,t);else if(this.threeDElements)this.addTo3dContainer(r,t);else{for(var n,i,o=0;o<t;)this.elements[o]&&!0!==this.elements[o]&&this.elements[o].getBaseElement&&(i=this.elements[o],n=(this.layers[o].ddd?this.getThreeDContainerByPos(o):i.getBaseElement())||n),o+=1;n?s.ddd&&this.supports3d||this.layerElement.insertBefore(r,n):s.ddd&&this.supports3d||this.layerElement.appendChild(r)}}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var t=0,r=this.threeDElements.length;t<r;){if(this.threeDElements[t].startPos<=e&&this.threeDElements[t].endPos>=e)return this.threeDElements[t].perspectiveElem;t+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,t){var r,s,n=createTag("div");styleDiv(n);var i=createTag("div");if(styleDiv(i),"3d"===t){(r=n.style).width=this.globalData.compSize.w+"px",r.height=this.globalData.compSize.h+"px";var o="50% 50%";r.webkitTransformOrigin=o,r.mozTransformOrigin=o,r.transformOrigin=o;var a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";(s=i.style).transform=a,s.webkitTransform=a}n.appendChild(i);var l={container:i,perspectiveElem:n,startPos:e,endPos:e,type:t};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var e,t,r=this.layers.length,s="";for(e=0;e<r;e+=1)this.layers[e].ddd&&3!==this.layers[e].ty?("3d"!==s&&(s="3d",t=this.createThreeDContainer(e,"3d")),t.endPos=Math.max(t.endPos,e)):("2d"!==s&&(s="2d",t=this.createThreeDContainer(e,"2d")),t.endPos=Math.max(t.endPos,e));for(e=(r=this.threeDElements.length)-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,t){for(var r=0,s=this.threeDElements.length;r<s;){if(t<=this.threeDElements[r].endPos){for(var n,i=this.threeDElements[r].startPos;i<t;)this.elements[i]&&this.elements[i].getBaseElement&&(n=this.elements[i].getBaseElement()),i+=1;n?this.threeDElements[r].container.insertBefore(e,n):this.threeDElements[r].container.appendChild(e);break}r+=1}},HybridRendererBase.prototype.configAnimation=function(e){var t=createTag("div"),r=this.animationItem.wrapper,s=t.style;s.width=e.w+"px",s.height=e.h+"px",this.resizerElem=t,styleDiv(t),s.transformStyle="flat",s.mozTransformStyle="flat",s.webkitTransformStyle="flat",this.renderConfig.className&&t.setAttribute("class",this.renderConfig.className),r.appendChild(t),s.overflow="hidden";var n=createNS("svg");n.setAttribute("width","1"),n.setAttribute("height","1"),styleDiv(n),this.resizerElem.appendChild(n);var i=createNS("defs");n.appendChild(i),this.data=e,this.setupGlobalData(e,n),this.globalData.defs=i,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e,t,r,s,n=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,o=n/i;this.globalData.compSize.w/this.globalData.compSize.h>o?(e=n/this.globalData.compSize.w,t=n/this.globalData.compSize.w,r=0,s=(i-this.globalData.compSize.h*(n/this.globalData.compSize.w))/2):(e=i/this.globalData.compSize.h,t=i/this.globalData.compSize.h,r=(n-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,s=0);var a=this.resizerElem.style;a.webkitTransform="matrix3d("+e+",0,0,0,0,"+t+",0,0,0,0,1,0,"+r+","+s+",0,1)",a.transform=a.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e,t=this.globalData.compSize.w,r=this.globalData.compSize.h,s=this.threeDElements.length;for(e=0;e<s;e+=1){var n=this.threeDElements[e].perspectiveElem.style;n.webkitPerspective=Math.sqrt(Math.pow(t,2)+Math.pow(r,2))+"px",n.perspective=n.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var t,r=e.length,s=createTag("div");for(t=0;t<r;t+=1)if(e[t].xt){var n=this.createComp(e[t],s,this.globalData.comp,null);n.initExpressions(),this.globalData.projectInterface.registerComposition(n)}},extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,t){for(var r,s=0;s<t;)this.elements[s]&&this.elements[s].getBaseElement&&(r=this.elements[s].getBaseElement()),s+=1;r?this.layerElement.insertBefore(e,r):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)},extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function t(t){for(var r=0,s=e.layers.length;r<s;){if(e.layers[r].nm===t||e.layers[r].ind===t)return e.elements[r].layerInterface;r+=1}return null}return Object.defineProperty(t,"_name",{value:e.data.nm}),t.layer=t,t.pixelAspect=1,t.height=e.data.h||e.globalData.compSize.h,t.width=e.data.w||e.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/e.globalData.frameRate,t.displayStartTime=0,t.numLayers=e.layers.length,t}}();function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function seedRandom(e,t){var r=this,s=256,n="random",i=t.pow(s,6),o=t.pow(2,52),a=2*o,l=255;function c(e){var t,r=e.length,n=this,i=0,o=n.i=n.j=0,a=n.S=[];for(r||(e=[r++]);i<s;)a[i]=i++;for(i=0;i<s;i++)a[i]=a[o=l&o+e[i%r]+(t=a[i])],a[o]=t;n.g=function(e){for(var t,r=0,i=n.i,o=n.j,a=n.S;e--;)t=a[i=l&i+1],r=r*s+a[l&(a[i]=a[o=l&o+t])+(a[o]=t)];return n.i=i,n.j=o,r}}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){var r,s=[],n=_typeof$2(e);if(t&&"object"==n)for(r in e)try{s.push(d(e[r],t-1))}catch(e2){}return s.length?s:"string"==n?e:e+"\0"}function p(e,t){for(var r,s=e+"",n=0;n<s.length;)t[l&n]=l&(r^=19*t[l&n])+s.charCodeAt(n++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}t["seed"+n]=function(l,h,x){var f=[],g=p(d((h=!0===h?{entropy:!0}:h||{}).entropy?[l,m(e)]:null===l?function(){try{var t=new Uint8Array(s);return(r.crypto||r.msCrypto).getRandomValues(t),m(t)}catch(e2){var n=r.navigator,i=n&&n.plugins;return[+new Date,r,i,r.screen,m(e)]}}():l,3),f),y=new c(f),v=function(){for(var e=y.g(6),t=i,r=0;e<o;)e=(e+r)*s,t*=s,r=y.g(1);for(;e>=a;)e/=2,t/=2,r>>>=1;return(e+r)/t};return v.int32=function(){return 0|y.g(4)},v.quick=function(){return y.g(4)/4294967296},v.double=v,p(m(y.S),e),(h.pass||x||function(e,r,s,i){return i&&(i.S&&u(i,y),e.state=function(){return u(y,{})}),s?(t[n]=e,r):e})(v,g,"global"in h?h.global:this==t,h.state)},p(t.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,t){return"number"===e||t instanceof Number||"boolean"===e||"string"===e}function $bm_neg(e){var t=_typeof$1(e);if("number"===t||e instanceof Number||"boolean"===t)return-e;if($bm_isInstanceOfArray(e)){var r,s=e.length,n=[];for(r=0;r<s;r+=1)n[r]=-e[r];return n}return e.propType?e.v:-e}initialize$2(BMMath);var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,t){var r=_typeof$1(e),s=_typeof$1(t);if(isNumerable(r,e)&&isNumerable(s,t)||"string"===r||"string"===s)return e+t;if($bm_isInstanceOfArray(e)&&isNumerable(s,t))return(e=e.slice(0))[0]+=t,e;if(isNumerable(r,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e+t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,i=e.length,o=t.length,a=[];n<i||n<o;)("number"==typeof e[n]||e[n]instanceof Number)&&("number"==typeof t[n]||t[n]instanceof Number)?a[n]=e[n]+t[n]:a[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return a}return 0}var add=sum;function sub(e,t){var r=_typeof$1(e),s=_typeof$1(t);if(isNumerable(r,e)&&isNumerable(s,t))return"string"===r&&(e=parseInt(e,10)),"string"===s&&(t=parseInt(t,10)),e-t;if($bm_isInstanceOfArray(e)&&isNumerable(s,t))return(e=e.slice(0))[0]-=t,e;if(isNumerable(r,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e-t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,i=e.length,o=t.length,a=[];n<i||n<o;)("number"==typeof e[n]||e[n]instanceof Number)&&("number"==typeof t[n]||t[n]instanceof Number)?a[n]=e[n]-t[n]:a[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return a}return 0}function mul(e,t){var r,s,n,i=_typeof$1(e),o=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(o,t))return e*t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,r=createTypedArray("float32",n),s=0;s<n;s+=1)r[s]=e[s]*t;return r}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,r=createTypedArray("float32",n),s=0;s<n;s+=1)r[s]=e*t[s];return r}return 0}function div(e,t){var r,s,n,i=_typeof$1(e),o=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(o,t))return e/t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,r=createTypedArray("float32",n),s=0;s<n;s+=1)r[s]=e[s]/t;return r}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,r=createTypedArray("float32",n),s=0;s<n;s+=1)r[s]=e/t[s];return r}return 0}function mod(e,t){return"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof t&&(t=parseInt(t,10)),e%t}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,t,r){if(t>r){var s=r;r=t,t=s}return Math.min(Math.max(e,t),r)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,t){if("number"==typeof e||e instanceof Number)return t=t||0,Math.abs(e-t);var r;t||(t=helperLengthArray);var s=Math.min(e.length,t.length),n=0;for(r=0;r<s;r+=1)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var t,r,s=e[0],n=e[1],i=e[2],o=Math.max(s,n,i),a=Math.min(s,n,i),l=(o+a)/2;if(o===a)t=0,r=0;else{var c=o-a;switch(r=l>.5?c/(2-o-a):c/(o+a),o){case s:t=(n-i)/c+(n<i?6:0);break;case n:t=(i-s)/c+2;break;case i:t=(s-n)/c+4}t/=6}return[t,r,l,e[3]]}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hslToRgb(e){var t,r,s,n=e[0],i=e[1],o=e[2];if(0===i)t=o,s=o,r=o;else{var a=o<.5?o*(1+i):o+i-o*i,l=2*o-a;t=hue2rgb(l,a,n+1/3),r=hue2rgb(l,a,n),s=hue2rgb(l,a,n-1/3)}return[t,r,s,e[3]]}function linear(e,t,r,s,n){if(void 0!==s&&void 0!==n||(s=t,n=r,t=0,r=1),r<t){var i=r;r=t,t=i}if(e<=t)return s;if(e>=r)return n;var o,a=r===t?0:(e-t)/(r-t);if(!s.length)return s+(n-s)*a;var l=s.length,c=createTypedArray("float32",l);for(o=0;o<l;o+=1)c[o]=s[o]+(n[o]-s[o])*a;return c}function random(e,t){if(void 0===t&&(void 0===e?(e=0,t=1):(t=e,e=void 0)),t.length){var r,s=t.length;e||(e=createTypedArray("float32",s));var n=createTypedArray("float32",s),i=BMMath.random();for(r=0;r<s;r+=1)n[r]=e[r]+i*(t[r]-e[r]);return n}return void 0===e&&(e=0),e+BMMath.random()*(t-e)}function createPath(e,t,r,s){var n,i=e.length,o=shapePool.newElement();o.setPathData(!!s,i);var a,l,c=[0,0];for(n=0;n<i;n+=1)a=t&&t[n]?t[n]:c,l=r&&r[n]?r[n]:c,o.setTripleAt(e[n][0],e[n][1],l[0]+e[n][0],l[1]+e[n][1],a[0]+e[n][0],a[1]+e[n][1],n,!0);return o}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(e,t){var r,s,n=this.pv.length?this.pv.length:1,i=createTypedArray("float32",n),o=Math.floor(5*time);for(r=0,s=0;r<o;){for(s=0;s<n;s+=1)i[s]+=-t+2*t*BMMath.random();r+=1}var a=5*time,l=a-Math.floor(a),c=createTypedArray("float32",n);if(n>1){for(s=0;s<n;s+=1)c[s]=this.pv[s]+i[s]+(-t+2*t*BMMath.random())*l;return c}return this.pv+i[0]+(-t+2*t*BMMath.random())*l}.bind(this);function loopInDuration(e,t){return loopIn(e,t,!0)}function loopOutDuration(e,t){return loopOut(e,t,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(e,t){var r=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],s=Math.atan2(r[0],Math.sqrt(r[1]*r[1]+r[2]*r[2]))/degToRads;return[-Math.atan2(r[1],r[2])/degToRads,s,0]}function easeOut(e,t,r,s,n){return applyEase(easeOutBez,e,t,r,s,n)}function easeIn(e,t,r,s,n){return applyEase(easeInBez,e,t,r,s,n)}function ease(e,t,r,s,n){return applyEase(easeInOutBez,e,t,r,s,n)}function applyEase(e,t,r,s,n,i){void 0===n?(n=r,i=s):t=(t-r)/(s-r),t>1?t=1:t<0&&(t=0);var o=e(t);if($bm_isInstanceOfArray(n)){var a,l=n.length,c=createTypedArray("float32",l);for(a=0;a<l;a+=1)c[a]=(i[a]-n[a])*o+n[a];return c}return(i-n)*o+n}function nearestKey(e){var t,r,s,n=data.k.length;if(data.k.length&&"number"!=typeof data.k[0])if(r=-1,(e*=elem.comp.globalData.frameRate)<data.k[0].t)r=1,s=data.k[0].t;else{for(t=0;t<n-1;t+=1){if(e===data.k[t].t){r=t+1,s=data.k[t].t;break}if(e>data.k[t].t&&e<data.k[t+1].t){e-data.k[t].t>data.k[t+1].t-e?(r=t+2,s=data.k[t+1].t):(r=t+1,s=data.k[t].t);break}}-1===r&&(r=t+1,s=data.k[t].t)}else r=0,s=0;var i={};return i.index=r,i.time=s/elem.comp.globalData.frameRate,i}function key(e){var t,r,s;if(!data.k.length||"number"==typeof data.k[0])throw new Error("The property has no keyframe at index "+e);e-=1,t={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var n=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(s=n.length,r=0;r<s;r+=1)t[r]=n[r],t.value[r]=n[r];return t}function framesToTime(e,t){return t||(t=elem.comp.globalData.frameRate),e/t}function timeToFrames(e,t){return e||0===e||(e=time),t||(t=elem.comp.globalData.frameRate),e*t}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,t){return"string"==typeof value?void 0===t?value.substring(e):value.substring(e,t):""}function substr(e,t){return"string"==typeof value?void 0===t?value.substr(e):value.substr(e,t):""}function posterizeTime(e){time=0===e?0:Math.floor(time*e)/e,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={initExpressions:function(e){var t=0,r=[];e.renderer.compInterface=CompExpressionInterface(e.renderer),e.renderer.globalData.projectInterface.registerComposition(e.renderer),e.renderer.globalData.pushExpression=function(){t+=1},e.renderer.globalData.popExpression=function(){0==(t-=1)&&function(){var e,t=r.length;for(e=0;e<t;e+=1)r[e].release();r.length=0}()},e.renderer.globalData.registerExpressionProperty=function(e){-1===r.indexOf(e)&&r.push(e)}}};return e.resetFrame=ExpressionManager.resetFrame,e}(),MaskManagerInterface=function(){function e(e,t){this._mask=e,this._data=t}return Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(t){var r,s=createSizedArray(t.viewData.length),n=t.viewData.length;for(r=0;r<n;r+=1)s[r]=new e(t.viewData[r],t.masksProperties[r]);return function(e){for(r=0;r<n;){if(t.masksProperties[r].nm===e)return s[r];r+=1}return null}}}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},t={pv:[0,0,0],v:[0,0,0],mult:1};function r(e,t,r){Object.defineProperty(e,"velocity",{get:function(){return t.getVelocityAtTime(t.comp.currentFrame)}}),e.numKeys=t.keyframes?t.keyframes.length:0,e.key=function(s){if(!e.numKeys)return 0;var n="";n="s"in t.keyframes[s-1]?t.keyframes[s-1].s:"e"in t.keyframes[s-2]?t.keyframes[s-2].e:t.keyframes[s-2].s;var i="unidimensional"===r?new Number(n):Object.assign({},n);return i.time=t.keyframes[s-1].t/t.elem.comp.globalData.frameRate,i.value="unidimensional"===r?n[0]:n,i},e.valueAtTime=t.getValueAtTime,e.speedAtTime=t.getSpeedAtTime,e.velocityAtTime=t.getVelocityAtTime,e.propertyGroup=t.propertyGroup}function s(){return e}return function(n){return n?"unidimensional"===n.propType?function(t){t&&"pv"in t||(t=e);var s=1/t.mult,n=t.pv*s,i=new Number(n);return i.value=n,r(i,t,"unidimensional"),function(){return t.k&&t.getValue(),n=t.v*s,i.value!==n&&((i=new Number(n)).value=n,i[0]=n,r(i,t,"unidimensional")),i}}(n):function(e){e&&"pv"in e||(e=t);var s=1/e.mult,n=e.data&&e.data.l||e.pv.length,i=createTypedArray("float32",n),o=createTypedArray("float32",n);return i.value=o,r(i,e,"multidimensional"),function(){e.k&&e.getValue();for(var t=0;t<n;t+=1)o[t]=e.v[t]*s,i[t]=o[t];return i}}(n):s}}(),TransformExpressionInterface=function(){return function(e){function t(e){switch(e){case"scale":case"Scale":case"ADBE Scale":case 6:return t.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return t.rotation;case"ADBE Rotate X":return t.xRotation;case"ADBE Rotate Y":return t.yRotation;case"position":case"Position":case"ADBE Position":case 2:return t.position;case"ADBE Position_0":return t.xPosition;case"ADBE Position_1":return t.yPosition;case"ADBE Position_2":return t.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return t.anchorPoint;case"opacity":case"Opacity":case 11:return t.opacity;default:return null}}var r,s,n,i;return Object.defineProperty(t,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(t,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(t,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(t,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(t,"scale",{get:ExpressionPropertyInterface(e.s)}),e.p?i=ExpressionPropertyInterface(e.p):(r=ExpressionPropertyInterface(e.px),s=ExpressionPropertyInterface(e.py),e.pz&&(n=ExpressionPropertyInterface(e.pz))),Object.defineProperty(t,"position",{get:function(){return e.p?i():[r(),s(),n?n():0]}}),Object.defineProperty(t,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(t,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(t,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(t,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(t,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(t,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(t,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(t,"orientation",{get:ExpressionPropertyInterface(e.or)}),t}}(),LayerExpressionInterface=function(){function e(e){var t=new Matrix;return void 0!==e?this._elem.finalTransform.mProp.getValueAtTime(e).clone(t):this._elem.finalTransform.mProp.applyToMatrix(t),t}function t(e,t){var r=this.getMatrix(t);return r.props[12]=0,r.props[13]=0,r.props[14]=0,this.applyPoint(r,e)}function r(e,t){var r=this.getMatrix(t);return this.applyPoint(r,e)}function s(e,t){var r=this.getMatrix(t);return r.props[12]=0,r.props[13]=0,r.props[14]=0,this.invertPoint(r,e)}function n(e,t){var r=this.getMatrix(t);return this.invertPoint(r,e)}function i(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var r,s=this._elem.hierarchy.length;for(r=0;r<s;r+=1)this._elem.hierarchy[r].finalTransform.mProp.applyToMatrix(e)}return e.applyToPointArray(t[0],t[1],t[2]||0)}function o(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var r,s=this._elem.hierarchy.length;for(r=0;r<s;r+=1)this._elem.hierarchy[r].finalTransform.mProp.applyToMatrix(e)}return e.inversePoint(t)}function a(e){var t=new Matrix;if(t.reset(),this._elem.finalTransform.mProp.applyToMatrix(t),this._elem.hierarchy&&this._elem.hierarchy.length){var r,s=this._elem.hierarchy.length;for(r=0;r<s;r+=1)this._elem.hierarchy[r].finalTransform.mProp.applyToMatrix(t);return t.inversePoint(e)}return t.inversePoint(e)}function l(){return[1,1,1,1]}return function(c){var u;function d(e){switch(e){case"ADBE Root Vectors Group":case"Contents":case 2:return d.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return u;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return d.effect;case"ADBE Text Properties":return d.textInterface;default:return null}}d.getMatrix=e,d.invertPoint=o,d.applyPoint=i,d.toWorld=r,d.toWorldVec=t,d.fromWorld=n,d.fromWorldVec=s,d.toComp=r,d.fromComp=a,d.sampleImage=l,d.sourceRectAtTime=c.sourceRectAtTime.bind(c),d._elem=c;var p=getDescriptor(u=TransformExpressionInterface(c.finalTransform.mProp),"anchorPoint");return Object.defineProperties(d,{hasParent:{get:function(){return c.hierarchy.length}},parent:{get:function(){return c.hierarchy[0].layerInterface}},rotation:getDescriptor(u,"rotation"),scale:getDescriptor(u,"scale"),position:getDescriptor(u,"position"),opacity:getDescriptor(u,"opacity"),anchorPoint:p,anchor_point:p,transform:{get:function(){return u}},active:{get:function(){return c.isInRange}}}),d.startTime=c.data.st,d.index=c.data.ind,d.source=c.data.refId,d.height=0===c.data.ty?c.data.h:100,d.width=0===c.data.ty?c.data.w:100,d.inPoint=c.data.ip/c.comp.globalData.frameRate,d.outPoint=c.data.op/c.comp.globalData.frameRate,d._name=c.data.nm,d.registerMaskInterface=function(e){d.mask=new MaskManagerInterface(e,c)},d.registerEffectsInterface=function(e){d.effect=e},d}}(),propertyGroupFactory=function(){return function(e,t){return function(r){return(r=void 0===r?1:r)<=0?e:t(r-1)}}}(),PropertyInterface=function(){return function(e,t){var r={_name:e};return function(e){return(e=void 0===e?1:e)<=0?r:t(e-1)}}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:function(e,r){if(e.effectsManager){var s,n=[],i=e.data.ef,o=e.effectsManager.effectElements.length;for(s=0;s<o;s+=1)n.push(t(i[s],e.effectsManager.effectElements[s],r,e));var a=e.data.ef||[],l=function(e){for(s=0,o=a.length;s<o;){if(e===a[s].nm||e===a[s].mn||e===a[s].ix)return n[s];s+=1}return null};return Object.defineProperty(l,"numProperties",{get:function(){return a.length}}),l}return null}};function t(e,s,n,i){function o(t){for(var r=e.ef,s=0,n=r.length;s<n;){if(t===r[s].nm||t===r[s].mn||t===r[s].ix)return 5===r[s].ty?c[s]:c[s]();s+=1}throw new Error}var a,l=propertyGroupFactory(o,n),c=[],u=e.ef.length;for(a=0;a<u;a+=1)5===e.ef[a].ty?c.push(t(e.ef[a],s.effectElements[a],s.effectElements[a].propertyGroup,i)):c.push(r(s.effectElements[a],e.ef[a].ty,i,l));return"ADBE Color Control"===e.mn&&Object.defineProperty(o,"color",{get:function(){return c[0]()}}),Object.defineProperties(o,{numProperties:{get:function(){return e.np}},_name:{value:e.nm},propertyGroup:{value:l}}),o.enabled=0!==e.en,o.active=o.enabled,o}function r(e,t,r,s){var n=ExpressionPropertyInterface(e.p);return e.p.setGroupProperty&&e.p.setGroupProperty(PropertyInterface("",s)),function(){return 10===t?r.comp.compInterface(e.p.v):n()}}return e}(),ShapePathInterface=function(){return function(e,t,r){var s=t.sh;function n(e){return"Shape"===e||"shape"===e||"Path"===e||"path"===e||"ADBE Vector Shape"===e||2===e?n.path:null}var i=propertyGroupFactory(n,r);return s.setGroupProperty(PropertyInterface("Path",i)),Object.defineProperties(n,{path:{get:function(){return s.k&&s.getValue(),s}},shape:{get:function(){return s.k&&s.getValue(),s}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:r}}),n}}(),ShapeExpressionInterface=function(){function e(e,a,m){var h,x=[],f=e?e.length:0;for(h=0;h<f;h+=1)"gr"===e[h].ty?x.push(t(e[h],a[h],m)):"fl"===e[h].ty?x.push(r(e[h],a[h],m)):"st"===e[h].ty?x.push(i(e[h],a[h],m)):"tm"===e[h].ty?x.push(o(e[h],a[h],m)):"tr"===e[h].ty||("el"===e[h].ty?x.push(l(e[h],a[h],m)):"sr"===e[h].ty?x.push(c(e[h],a[h],m)):"sh"===e[h].ty?x.push(ShapePathInterface(e[h],a[h],m)):"rc"===e[h].ty?x.push(u(e[h],a[h],m)):"rd"===e[h].ty?x.push(d(e[h],a[h],m)):"rp"===e[h].ty?x.push(p(e[h],a[h],m)):"gf"===e[h].ty?x.push(s(e[h],a[h],m)):x.push(n(e[h],a[h])));return x}function t(t,r,s){var n=function(e){switch(e){case"ADBE Vectors Group":case"Contents":case 2:return n.content;default:return n.transform}};n.propertyGroup=propertyGroupFactory(n,s);var i=function(t,r,s){var n,i=function(e){for(var t=0,r=n.length;t<r;){if(n[t]._name===e||n[t].mn===e||n[t].propertyIndex===e||n[t].ix===e||n[t].ind===e)return n[t];t+=1}return"number"==typeof e?n[e-1]:null};i.propertyGroup=propertyGroupFactory(i,s),n=e(t.it,r.it,i.propertyGroup),i.numProperties=n.length;var o=a(t.it[t.it.length-1],r.it[r.it.length-1],i.propertyGroup);return i.transform=o,i.propertyIndex=t.cix,i._name=t.nm,i}(t,r,n.propertyGroup),o=a(t.it[t.it.length-1],r.it[r.it.length-1],n.propertyGroup);return n.content=i,n.transform=o,Object.defineProperty(n,"_name",{get:function(){return t.nm}}),n.numProperties=t.np,n.propertyIndex=t.ix,n.nm=t.nm,n.mn=t.mn,n}function r(e,t,r){function s(e){return"Color"===e||"color"===e?s.color:"Opacity"===e||"opacity"===e?s.opacity:null}return Object.defineProperties(s,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",r)),t.o.setGroupProperty(PropertyInterface("Opacity",r)),s}function s(e,t,r){function s(e){return"Start Point"===e||"start point"===e?s.startPoint:"End Point"===e||"end point"===e?s.endPoint:"Opacity"===e||"opacity"===e?s.opacity:null}return Object.defineProperties(s,{startPoint:{get:ExpressionPropertyInterface(t.s)},endPoint:{get:ExpressionPropertyInterface(t.e)},opacity:{get:ExpressionPropertyInterface(t.o)},type:{get:function(){return"a"}},_name:{value:e.nm},mn:{value:e.mn}}),t.s.setGroupProperty(PropertyInterface("Start Point",r)),t.e.setGroupProperty(PropertyInterface("End Point",r)),t.o.setGroupProperty(PropertyInterface("Opacity",r)),s}function n(){return function(){return null}}function i(e,t,r){var s,n=propertyGroupFactory(c,r),i=propertyGroupFactory(l,n);function o(r){Object.defineProperty(l,e.d[r].nm,{get:ExpressionPropertyInterface(t.d.dataProps[r].p)})}var a=e.d?e.d.length:0,l={};for(s=0;s<a;s+=1)o(s),t.d.dataProps[s].p.setGroupProperty(i);function c(e){return"Color"===e||"color"===e?c.color:"Opacity"===e||"opacity"===e?c.opacity:"Stroke Width"===e||"stroke width"===e?c.strokeWidth:null}return Object.defineProperties(c,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},strokeWidth:{get:ExpressionPropertyInterface(t.w)},dash:{get:function(){return l}},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",n)),t.o.setGroupProperty(PropertyInterface("Opacity",n)),t.w.setGroupProperty(PropertyInterface("Stroke Width",n)),c}function o(e,t,r){function s(t){return t===e.e.ix||"End"===t||"end"===t?s.end:t===e.s.ix?s.start:t===e.o.ix?s.offset:null}var n=propertyGroupFactory(s,r);return s.propertyIndex=e.ix,t.s.setGroupProperty(PropertyInterface("Start",n)),t.e.setGroupProperty(PropertyInterface("End",n)),t.o.setGroupProperty(PropertyInterface("Offset",n)),s.propertyIndex=e.ix,s.propertyGroup=r,Object.defineProperties(s,{start:{get:ExpressionPropertyInterface(t.s)},end:{get:ExpressionPropertyInterface(t.e)},offset:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm}}),s.mn=e.mn,s}function a(e,t,r){function s(t){return e.a.ix===t||"Anchor Point"===t?s.anchorPoint:e.o.ix===t||"Opacity"===t?s.opacity:e.p.ix===t||"Position"===t?s.position:e.r.ix===t||"Rotation"===t||"ADBE Vector Rotation"===t?s.rotation:e.s.ix===t||"Scale"===t?s.scale:e.sk&&e.sk.ix===t||"Skew"===t?s.skew:e.sa&&e.sa.ix===t||"Skew Axis"===t?s.skewAxis:null}var n=propertyGroupFactory(s,r);return t.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",n)),t.transform.mProps.p.setGroupProperty(PropertyInterface("Position",n)),t.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",n)),t.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",n)),t.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",n)),t.transform.mProps.sk&&(t.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",n)),t.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",n))),t.transform.op.setGroupProperty(PropertyInterface("Opacity",n)),Object.defineProperties(s,{opacity:{get:ExpressionPropertyInterface(t.transform.mProps.o)},position:{get:ExpressionPropertyInterface(t.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(t.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(t.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(t.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(t.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(t.transform.mProps.sa)},_name:{value:e.nm}}),s.ty="tr",s.mn=e.mn,s.propertyGroup=r,s}function l(e,t,r){function s(t){return e.p.ix===t?s.position:e.s.ix===t?s.size:null}var n=propertyGroupFactory(s,r);s.propertyIndex=e.ix;var i="tm"===t.sh.ty?t.sh.prop:t.sh;return i.s.setGroupProperty(PropertyInterface("Size",n)),i.p.setGroupProperty(PropertyInterface("Position",n)),Object.defineProperties(s,{size:{get:ExpressionPropertyInterface(i.s)},position:{get:ExpressionPropertyInterface(i.p)},_name:{value:e.nm}}),s.mn=e.mn,s}function c(e,t,r){function s(t){return e.p.ix===t?s.position:e.r.ix===t?s.rotation:e.pt.ix===t?s.points:e.or.ix===t||"ADBE Vector Star Outer Radius"===t?s.outerRadius:e.os.ix===t?s.outerRoundness:!e.ir||e.ir.ix!==t&&"ADBE Vector Star Inner Radius"!==t?e.is&&e.is.ix===t?s.innerRoundness:null:s.innerRadius}var n=propertyGroupFactory(s,r),i="tm"===t.sh.ty?t.sh.prop:t.sh;return s.propertyIndex=e.ix,i.or.setGroupProperty(PropertyInterface("Outer Radius",n)),i.os.setGroupProperty(PropertyInterface("Outer Roundness",n)),i.pt.setGroupProperty(PropertyInterface("Points",n)),i.p.setGroupProperty(PropertyInterface("Position",n)),i.r.setGroupProperty(PropertyInterface("Rotation",n)),e.ir&&(i.ir.setGroupProperty(PropertyInterface("Inner Radius",n)),i.is.setGroupProperty(PropertyInterface("Inner Roundness",n))),Object.defineProperties(s,{position:{get:ExpressionPropertyInterface(i.p)},rotation:{get:ExpressionPropertyInterface(i.r)},points:{get:ExpressionPropertyInterface(i.pt)},outerRadius:{get:ExpressionPropertyInterface(i.or)},outerRoundness:{get:ExpressionPropertyInterface(i.os)},innerRadius:{get:ExpressionPropertyInterface(i.ir)},innerRoundness:{get:ExpressionPropertyInterface(i.is)},_name:{value:e.nm}}),s.mn=e.mn,s}function u(e,t,r){function s(t){return e.p.ix===t?s.position:e.r.ix===t?s.roundness:e.s.ix===t||"Size"===t||"ADBE Vector Rect Size"===t?s.size:null}var n=propertyGroupFactory(s,r),i="tm"===t.sh.ty?t.sh.prop:t.sh;return s.propertyIndex=e.ix,i.p.setGroupProperty(PropertyInterface("Position",n)),i.s.setGroupProperty(PropertyInterface("Size",n)),i.r.setGroupProperty(PropertyInterface("Rotation",n)),Object.defineProperties(s,{position:{get:ExpressionPropertyInterface(i.p)},roundness:{get:ExpressionPropertyInterface(i.r)},size:{get:ExpressionPropertyInterface(i.s)},_name:{value:e.nm}}),s.mn=e.mn,s}function d(e,t,r){function s(t){return e.r.ix===t||"Round Corners 1"===t?s.radius:null}var n=propertyGroupFactory(s,r),i=t;return s.propertyIndex=e.ix,i.rd.setGroupProperty(PropertyInterface("Radius",n)),Object.defineProperties(s,{radius:{get:ExpressionPropertyInterface(i.rd)},_name:{value:e.nm}}),s.mn=e.mn,s}function p(e,t,r){function s(t){return e.c.ix===t||"Copies"===t?s.copies:e.o.ix===t||"Offset"===t?s.offset:null}var n=propertyGroupFactory(s,r),i=t;return s.propertyIndex=e.ix,i.c.setGroupProperty(PropertyInterface("Copies",n)),i.o.setGroupProperty(PropertyInterface("Offset",n)),Object.defineProperties(s,{copies:{get:ExpressionPropertyInterface(i.c)},offset:{get:ExpressionPropertyInterface(i.o)},_name:{value:e.nm}}),s.mn=e.mn,s}return function(t,r,s){var n;function i(e){if("number"==typeof e)return 0===(e=void 0===e?1:e)?s:n[e-1];for(var t=0,r=n.length;t<r;){if(n[t]._name===e)return n[t];t+=1}return null}return i.propertyGroup=propertyGroupFactory(i,function(){return s}),n=e(t,r,i.propertyGroup),i.numProperties=n.length,i._name="Contents",i}}(),TextExpressionInterface=function(){return function(e){var t;function r(e){return"ADBE Text Document"===e?r.sourceText:null}return Object.defineProperty(r,"sourceText",{get:function(){e.textProperty.getValue();var r=e.textProperty.currentData.t;return t&&r===t.value||((t=new String(r)).value=r||new String(r),Object.defineProperty(t,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),t}}),r}}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var FootageInterface=function(){var e=function(e){function t(e){return"Outline"===e?t.outlineInterface():null}return t._name="Outline",t.outlineInterface=function(e){var t="",r=e.getFootageData();function s(e){if(r[e])return t=e,"object"===_typeof(r=r[e])?s:r;var n=e.indexOf(t);if(-1!==n){var i=parseInt(e.substr(n+t.length),10);return"object"===_typeof(r=r[i])?s:r}return""}return function(){return t="",r=e.getFootageData(),s}}(e),t};return function(t){function r(e){return"Data"===e?r.dataInterface:null}return r._name="Data",r.dataInterface=e(t),r}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){return{searchExpressions:function(e,t,r){t.x&&(r.k=!0,r.x=!0,r.initiateExpression=ExpressionManager.initiateExpression,r.effectsSequence.push(r.initiateExpression(e,t,r).bind(r)))},getSpeedAtTime:function(e){var t=this.getValueAtTime(e),r=this.getValueAtTime(e+-.01),s=0;if(t.length){var n;for(n=0;n<t.length;n+=1)s+=Math.pow(r[n]-t[n],2);s=100*Math.sqrt(s)}else s=0;return s},getVelocityAtTime:function(e){if(void 0!==this.vel)return this.vel;var t,r,s=-.001,n=this.getValueAtTime(e),i=this.getValueAtTime(e+s);if(n.length)for(t=createTypedArray("float32",n.length),r=0;r<n.length;r+=1)t[r]=(i[r]-n[r])/s;else t=(i-n)/s;return t},getValueAtTime:function(e){return e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<e?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(e,this._cachingAtTime),this._cachingAtTime.lastFrame=e),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(e){this.propertyGroup=e}}}();function addPropertyDecorator(){function e(e,t,r){if(!this.k||!this.keyframes)return this.pv;e=e?e.toLowerCase():"";var s,n,i,o,a,l=this.comp.renderedFrame,c=this.keyframes,u=c[c.length-1].t;if(l<=u)return this.pv;if(r?n=u-(s=t?Math.abs(u-this.elem.comp.globalData.frameRate*t):Math.max(0,u-this.elem.data.ip)):((!t||t>c.length-1)&&(t=c.length-1),s=u-(n=c[c.length-1-t].t)),"pingpong"===e){if(Math.floor((l-n)/s)%2!=0)return this.getValueAtTime((s-(l-n)%s+n)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var d=this.getValueAtTime(n/this.comp.globalData.frameRate,0),p=this.getValueAtTime(u/this.comp.globalData.frameRate,0),m=this.getValueAtTime(((l-n)%s+n)/this.comp.globalData.frameRate,0),h=Math.floor((l-n)/s);if(this.pv.length){for(o=(a=new Array(d.length)).length,i=0;i<o;i+=1)a[i]=(p[i]-d[i])*h+m[i];return a}return(p-d)*h+m}if("continue"===e){var x=this.getValueAtTime(u/this.comp.globalData.frameRate,0),f=this.getValueAtTime((u-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(a=new Array(x.length)).length,i=0;i<o;i+=1)a[i]=x[i]+(x[i]-f[i])*((l-u)/this.comp.globalData.frameRate)/5e-4;return a}return x+(l-u)/.001*(x-f)}}return this.getValueAtTime(((l-n)%s+n)/this.comp.globalData.frameRate,0)}function t(e,t,r){if(!this.k)return this.pv;e=e?e.toLowerCase():"";var s,n,i,o,a,l=this.comp.renderedFrame,c=this.keyframes,u=c[0].t;if(l>=u)return this.pv;if(r?n=u+(s=t?Math.abs(this.elem.comp.globalData.frameRate*t):Math.max(0,this.elem.data.op-u)):((!t||t>c.length-1)&&(t=c.length-1),s=(n=c[t].t)-u),"pingpong"===e){if(Math.floor((u-l)/s)%2==0)return this.getValueAtTime(((u-l)%s+u)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var d=this.getValueAtTime(u/this.comp.globalData.frameRate,0),p=this.getValueAtTime(n/this.comp.globalData.frameRate,0),m=this.getValueAtTime((s-(u-l)%s+u)/this.comp.globalData.frameRate,0),h=Math.floor((u-l)/s)+1;if(this.pv.length){for(o=(a=new Array(d.length)).length,i=0;i<o;i+=1)a[i]=m[i]-(p[i]-d[i])*h;return a}return m-(p-d)*h}if("continue"===e){var x=this.getValueAtTime(u/this.comp.globalData.frameRate,0),f=this.getValueAtTime((u+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(a=new Array(x.length)).length,i=0;i<o;i+=1)a[i]=x[i]+(x[i]-f[i])*(u-l)/.001;return a}return x+(x-f)*(u-l)/.001}}return this.getValueAtTime((s-((u-l)%s+u))/this.comp.globalData.frameRate,0)}function r(e,t){if(!this.k)return this.pv;if(e=.5*(e||.4),(t=Math.floor(t||5))<=1)return this.pv;var r,s,n=this.comp.renderedFrame/this.comp.globalData.frameRate,i=n-e,o=t>1?(n+e-i)/(t-1):1,a=0,l=0;for(r=this.pv.length?createTypedArray("float32",this.pv.length):0;a<t;){if(s=this.getValueAtTime(i+a*o),this.pv.length)for(l=0;l<this.pv.length;l+=1)r[l]+=s[l];else r+=s;a+=1}if(this.pv.length)for(l=0;l<this.pv.length;l+=1)r[l]/=t;else r/=t;return r}function s(e){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var t=this._transformCachingAtTime.v;if(t.cloneFromProps(this.pre.props),this.appliedTransformations<1){var r=this.a.getValueAtTime(e);t.translate(-r[0]*this.a.mult,-r[1]*this.a.mult,r[2]*this.a.mult)}if(this.appliedTransformations<2){var s=this.s.getValueAtTime(e);t.scale(s[0]*this.s.mult,s[1]*this.s.mult,s[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var n=this.sk.getValueAtTime(e),i=this.sa.getValueAtTime(e);t.skewFromAxis(-n*this.sk.mult,i*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var o=this.r.getValueAtTime(e);t.rotate(-o*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var a=this.rz.getValueAtTime(e),l=this.ry.getValueAtTime(e),c=this.rx.getValueAtTime(e),u=this.or.getValueAtTime(e);t.rotateZ(-a*this.rz.mult).rotateY(l*this.ry.mult).rotateX(c*this.rx.mult).rotateZ(-u[2]*this.or.mult).rotateY(u[1]*this.or.mult).rotateX(u[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var d=this.px.getValueAtTime(e),p=this.py.getValueAtTime(e);if(this.data.p.z){var m=this.pz.getValueAtTime(e);t.translate(d*this.px.mult,p*this.py.mult,-m*this.pz.mult)}else t.translate(d*this.px.mult,p*this.py.mult,0)}else{var h=this.p.getValueAtTime(e);t.translate(h[0]*this.p.mult,h[1]*this.p.mult,-h[2]*this.p.mult)}return t}function n(){return this.v.clone(new Matrix)}var i=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(e,t,r){var o=i(e,t,r);return o.dynamicProperties.length?o.getValueAtTime=s.bind(o):o.getValueAtTime=n.bind(o),o.setGroupProperty=expressionHelpers.setGroupProperty,o};var o=PropertyFactory.getProp;PropertyFactory.getProp=function(s,n,i,a,l){var c=o(s,n,i,a,l);c.kf?c.getValueAtTime=expressionHelpers.getValueAtTime.bind(c):c.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(c),c.setGroupProperty=expressionHelpers.setGroupProperty,c.loopOut=e,c.loopIn=t,c.smooth=r,c.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(c),c.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(c),c.numKeys=1===n.a?n.k.length:0,c.propertyIndex=n.ix;var u=0;return 0!==i&&(u=createTypedArray("float32",1===n.a?n.k[0].s.length:n.k.length)),c._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:u},expressionHelpers.searchExpressions(s,n,c),c.k&&l.addDynamicProperty(c),c};var a=ShapePropertyFactory.getConstructorFunction(),l=ShapePropertyFactory.getKeyframedConstructorFunction();function c(){}c.prototype={vertices:function(e,t){this.k&&this.getValue();var r,s=this.v;void 0!==t&&(s=this.getValueAtTime(t,0));var n=s._length,i=s[e],o=s.v,a=createSizedArray(n);for(r=0;r<n;r+=1)a[r]="i"===e||"o"===e?[i[r][0]-o[r][0],i[r][1]-o[r][1]]:[i[r][0],i[r][1]];return a},points:function(e){return this.vertices("v",e)},inTangents:function(e){return this.vertices("i",e)},outTangents:function(e){return this.vertices("o",e)},isClosed:function(){return this.v.c},pointOnPath:function(e,t){var r=this.v;void 0!==t&&(r=this.getValueAtTime(t,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(r));for(var s,n=this._segmentsLength,i=n.lengths,o=n.totalLength*e,a=0,l=i.length,c=0;a<l;){if(c+i[a].addedLength>o){var u=a,d=r.c&&a===l-1?0:a+1,p=(o-c)/i[a].addedLength;s=bez.getPointInSegment(r.v[u],r.v[d],r.o[u],r.i[d],p,i[a]);break}c+=i[a].addedLength,a+=1}return s||(s=r.c?[r.v[0][0],r.v[0][1]]:[r.v[r._length-1][0],r.v[r._length-1][1]]),s},vectorOnPath:function(e,t,r){1==e?e=this.v.c:0==e&&(e=.999);var s=this.pointOnPath(e,t),n=this.pointOnPath(e+.001,t),i=n[0]-s[0],o=n[1]-s[1],a=Math.sqrt(Math.pow(i,2)+Math.pow(o,2));return 0===a?[0,0]:"tangent"===r?[i/a,o/a]:[-o/a,i/a]},tangentOnPath:function(e,t){return this.vectorOnPath(e,t,"tangent")},normalOnPath:function(e,t){return this.vectorOnPath(e,t,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([c],a),extendPrototype([c],l),l.prototype.getValueAtTime=function(e){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<e?this._caching.lastIndex:0,this._cachingAtTime.lastTime=e,this.interpolateShape(e,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},l.prototype.initiateExpression=ExpressionManager.initiateExpression;var u=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(e,t,r,s,n){var i=u(e,t,r,s,n);return i.propertyIndex=t.ix,i.lock=!1,3===r?expressionHelpers.searchExpressions(e,t.pt,i):4===r&&expressionHelpers.searchExpressions(e,t.ks,i),i.k&&e.addDynamicProperty(i),i}}function initialize$1(){addPropertyDecorator()}function addDecorator(){TextProperty.prototype.getExpressionValue=function(e,t){var r=this.calculateExpression(t);if(e.t!==r){var s={};return this.copyData(s,e),s.t=r.toString(),s.__complete=!1,s}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=function(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function(e,t){var r,s,n=createNS("feMerge");for(n.setAttribute("result",e),s=0;s<t.length;s+=1)(r=createNS("feMergeNode")).setAttribute("in",t[s]),n.appendChild(r),n.appendChild(r);return n}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,t,r,s,n){this.filterManager=t;var i=createNS("feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","linearRGB"),i.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=i,i.setAttribute("result",s+"_tint_1"),e.appendChild(i),(i=createNS("feColorMatrix")).setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),i.setAttribute("result",s+"_tint_2"),e.appendChild(i),this.matrixFilter=i;var o=this.createMergeNode(s,[n,s+"_tint_1",s+"_tint_2"]);e.appendChild(o)}function SVGFillFilter(e,t,r,s){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),n.setAttribute("result",s),e.appendChild(n),this.matrixFilter=n}function SVGStrokeEffect(e,t,r){this.initialized=!1,this.filterManager=t,this.elem=r,this.paths=[]}function SVGTritoneFilter(e,t,r,s){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","linearRGB"),n.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(n);var i=createNS("feComponentTransfer");i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("result",s),this.matrixFilter=i;var o=createNS("feFuncR");o.setAttribute("type","table"),i.appendChild(o),this.feFuncR=o;var a=createNS("feFuncG");a.setAttribute("type","table"),i.appendChild(a),this.feFuncG=a;var l=createNS("feFuncB");l.setAttribute("type","table"),i.appendChild(l),this.feFuncB=l,e.appendChild(i)}function SVGProLevelsFilter(e,t,r,s){this.filterManager=t;var n=this.filterManager.effectElements,i=createNS("feComponentTransfer");(n[10].p.k||0!==n[10].p.v||n[11].p.k||1!==n[11].p.v||n[12].p.k||1!==n[12].p.v||n[13].p.k||0!==n[13].p.v||n[14].p.k||1!==n[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",i)),(n[17].p.k||0!==n[17].p.v||n[18].p.k||1!==n[18].p.v||n[19].p.k||1!==n[19].p.v||n[20].p.k||0!==n[20].p.v||n[21].p.k||1!==n[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",i)),(n[24].p.k||0!==n[24].p.v||n[25].p.k||1!==n[25].p.v||n[26].p.k||1!==n[26].p.v||n[27].p.k||0!==n[27].p.v||n[28].p.k||1!==n[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",i)),(n[31].p.k||0!==n[31].p.v||n[32].p.k||1!==n[32].p.v||n[33].p.k||1!==n[33].p.v||n[34].p.k||0!==n[34].p.v||n[35].p.k||1!==n[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",i)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(i.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(i)),(n[3].p.k||0!==n[3].p.v||n[4].p.k||1!==n[4].p.v||n[5].p.k||1!==n[5].p.v||n[6].p.k||0!==n[6].p.v||n[7].p.k||1!==n[7].p.v)&&((i=createNS("feComponentTransfer")).setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("result",s),e.appendChild(i),this.feFuncRComposed=this.createFeFunc("feFuncR",i),this.feFuncGComposed=this.createFeFunc("feFuncG",i),this.feFuncBComposed=this.createFeFunc("feFuncB",i))}function SVGDropShadowEffect(e,t,r,s,n){var i=t.container.globalData.renderConfig.filterSize,o=t.data.fs||i;e.setAttribute("x",o.x||i.x),e.setAttribute("y",o.y||i.y),e.setAttribute("width",o.width||i.width),e.setAttribute("height",o.height||i.height),this.filterManager=t;var a=createNS("feGaussianBlur");a.setAttribute("in","SourceAlpha"),a.setAttribute("result",s+"_drop_shadow_1"),a.setAttribute("stdDeviation","0"),this.feGaussianBlur=a,e.appendChild(a);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",s+"_drop_shadow_1"),l.setAttribute("result",s+"_drop_shadow_2"),this.feOffset=l,e.appendChild(l);var c=createNS("feFlood");c.setAttribute("flood-color","#00ff00"),c.setAttribute("flood-opacity","1"),c.setAttribute("result",s+"_drop_shadow_3"),this.feFlood=c,e.appendChild(c);var u=createNS("feComposite");u.setAttribute("in",s+"_drop_shadow_3"),u.setAttribute("in2",s+"_drop_shadow_2"),u.setAttribute("operator","in"),u.setAttribute("result",s+"_drop_shadow_4"),e.appendChild(u);var d=this.createMergeNode(s,[s+"_drop_shadow_4",n]);e.appendChild(d)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,s=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+s+" 0"),this.matrixFilter.setAttribute("values",r[0]-t[0]+" 0 0 0 "+t[0]+" "+(r[1]-t[1])+" 0 0 0 "+t[1]+" "+(r[2]-t[2])+" 0 0 0 "+t[2]+" 0 0 0 1 0")}},SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[2].p.v,r=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+t[0]+" 0 0 0 0 "+t[1]+" 0 0 0 0 "+t[2]+" 0 0 0 "+r+" 0")}},SVGStrokeEffect.prototype.initialize=function(){var e,t,r,s,n=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(s=this.elem.maskManager.masksProperties.length,r=0):s=1+(r=this.filterManager.effectElements[0].p.v-1),(t=createNS("g")).setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1);r<s;r+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:r});if(3===this.filterManager.effectElements[10].p.v){var i=createNS("mask"),o=createElementID();i.setAttribute("id",o),i.setAttribute("mask-type","alpha"),i.appendChild(t),this.elem.globalData.defs.appendChild(i);var a=createNS("g");for(a.setAttribute("mask","url("+getLocationHref()+"#"+o+")");n[0];)a.appendChild(n[0]);this.elem.layerElement.appendChild(a),this.masker=i,t.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(n=this.elem.layerElement.children||this.elem.layerElement.childNodes;n.length;)this.elem.layerElement.removeChild(n[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(e){var t;this.initialized||this.initialize();var r,s,n=this.paths.length;for(t=0;t<n;t+=1)if(-1!==this.paths[t].m&&(r=this.elem.maskManager.viewData[this.paths[t].m],s=this.paths[t].p,(e||this.filterManager._mdf||r.prop._mdf)&&s.setAttribute("d",r.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||r.prop._mdf)){var i;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var o=.01*Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),a=.01*Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),l=s.getTotalLength();i="0 0 0 "+l*o+" ";var c,u=l*(a-o),d=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01,p=Math.floor(u/d);for(c=0;c<p;c+=1)i+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01+" ";i+="0 "+10*l+" 0 0"}else i="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01;s.setAttribute("stroke-dasharray",i)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(e||this.filterManager.effectElements[3].p._mdf)){var m=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(255*m[0])+","+bmFloor(255*m[1])+","+bmFloor(255*m[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,s=this.filterManager.effectElements[2].p.v,n=s[0]+" "+r[0]+" "+t[0],i=s[1]+" "+r[1]+" "+t[1],o=s[2]+" "+r[2]+" "+t[2];this.feFuncR.setAttribute("tableValues",n),this.feFuncG.setAttribute("tableValues",i),this.feFuncB.setAttribute("tableValues",o)}},SVGProLevelsFilter.prototype.createFeFunc=function(e,t){var r=createNS(e);return r.setAttribute("type","table"),t.appendChild(r),r},SVGProLevelsFilter.prototype.getTableValue=function(e,t,r,s,n){for(var i,o,a=0,l=Math.min(e,t),c=Math.max(e,t),u=Array.call(null,{length:256}),d=0,p=n-s,m=t-e;a<=256;)o=(i=a/256)<=l?m<0?n:s:i>=c?m<0?s:n:s+p*Math.pow((i-e)/m,1/r),u[d]=o,d+=1,a+=256/255;return u.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t,r=this.filterManager.effectElements;this.feFuncRComposed&&(e||r[3].p._mdf||r[4].p._mdf||r[5].p._mdf||r[6].p._mdf||r[7].p._mdf)&&(t=this.getTableValue(r[3].p.v,r[4].p.v,r[5].p.v,r[6].p.v,r[7].p.v),this.feFuncRComposed.setAttribute("tableValues",t),this.feFuncGComposed.setAttribute("tableValues",t),this.feFuncBComposed.setAttribute("tableValues",t)),this.feFuncR&&(e||r[10].p._mdf||r[11].p._mdf||r[12].p._mdf||r[13].p._mdf||r[14].p._mdf)&&(t=this.getTableValue(r[10].p.v,r[11].p.v,r[12].p.v,r[13].p.v,r[14].p.v),this.feFuncR.setAttribute("tableValues",t)),this.feFuncG&&(e||r[17].p._mdf||r[18].p._mdf||r[19].p._mdf||r[20].p._mdf||r[21].p._mdf)&&(t=this.getTableValue(r[17].p.v,r[18].p.v,r[19].p.v,r[20].p.v,r[21].p.v),this.feFuncG.setAttribute("tableValues",t)),this.feFuncB&&(e||r[24].p._mdf||r[25].p._mdf||r[26].p._mdf||r[27].p._mdf||r[28].p._mdf)&&(t=this.getTableValue(r[24].p.v,r[25].p.v,r[26].p.v,r[27].p.v,r[28].p.v),this.feFuncB.setAttribute("tableValues",t)),this.feFuncA&&(e||r[31].p._mdf||r[32].p._mdf||r[33].p._mdf||r[34].p._mdf||r[35].p._mdf)&&(t=this.getTableValue(r[31].p.v,r[32].p.v,r[33].p.v,r[34].p.v,r[35].p.v),this.feFuncA.setAttribute("tableValues",t))}},extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var t=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var r=this.filterManager.effectElements[3].p.v,s=(this.filterManager.effectElements[2].p.v-90)*degToRads,n=r*Math.cos(s),i=r*Math.sin(s);this.feOffset.setAttribute("dx",n),this.feOffset.setAttribute("dy",i)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,t,r){this.initialized=!1,this.filterManager=t,this.filterElem=e,this.elem=r,r.matteElement=createNS("g"),r.matteElement.appendChild(r.layerElement),r.matteElement.appendChild(r.transformedElement),r.baseElement=r.matteElement}function SVGGaussianBlurEffect(e,t,r,s){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=t;var n=createNS("feGaussianBlur");n.setAttribute("result",s),e.appendChild(n),this.feGaussianBlur=n}function TransformEffect(){}function SVGTransformEffect(e,t){this.init(t)}function CVTransformEffect(e){this.init(e)}return SVGMatte3Effect.prototype.findSymbol=function(e){for(var t=0,r=_svgMatteSymbols.length;t<r;){if(_svgMatteSymbols[t]===e)return _svgMatteSymbols[t];t+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,t){var r=e.layerElement.parentNode;if(r){for(var s,n=r.children,i=0,o=n.length;i<o&&n[i]!==e.layerElement;)i+=1;i<=o-2&&(s=n[i+1]);var a=createNS("use");a.setAttribute("href","#"+t),s?r.insertBefore(a,s):r.appendChild(a)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,t){if(!this.findSymbol(t)){var r=createElementID(),s=createNS("mask");s.setAttribute("id",t.layerId),s.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(t);var n=e.globalData.defs;n.appendChild(s);var i=createNS("symbol");i.setAttribute("id",r),this.replaceInParent(t,r),i.appendChild(t.layerElement),n.appendChild(i);var o=createNS("use");o.setAttribute("href","#"+r),s.appendChild(o),t.data.hd=!1,t.show()}e.setMatte(t.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,t=this.elem.comp.elements,r=0,s=t.length;r<s;)t[r]&&t[r].data.ind===e&&this.setElementAsMask(this.elem,t[r]),r+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=.3*this.filterManager.effectElements[0].p.v,r=this.filterManager.effectElements[1].p.v,s=3==r?0:t,n=2==r?0:t;this.feGaussianBlur.setAttribute("stdDeviation",s+" "+n);var i=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",i)}},TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var t=this.effectsManager.effectElements,r=t[0].p.v,s=t[1].p.v,n=1===t[2].p.v,i=t[3].p.v,o=n?i:t[4].p.v,a=t[5].p.v,l=t[6].p.v,c=t[7].p.v;this.matrix.reset(),this.matrix.translate(-r[0],-r[1],r[2]),this.matrix.scale(.01*o,.01*i,1),this.matrix.rotate(-c*degToRads),this.matrix.skewFromAxis(-a*degToRads,(l+90)*degToRads),this.matrix.translate(s[0],s[1],0),this._mdf=!0,this.opacity!==t[8].p.v&&(this.opacity=t[8].p.v,this._opMdf=!0)}},extendPrototype([TransformEffect],SVGTransformEffect),extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie},module.exports=factory())})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty$1(e,t,r){return(t=_toPropertyKey$1(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,n,i,o,a=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t);else for(;!(l=(s=i.call(r)).done)&&(a.push(s.value),a.length!==t);l=!0);}catch(u){c=!0,n=u}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function _objectSpread2$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach(function(t){_defineProperty$1(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _objectWithoutProperties$1(e,t){if(null==e)return{};var r,s,n=_objectWithoutPropertiesLoose$3(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _objectWithoutPropertiesLoose$3(e,t){if(null==e)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;r[s]=e[s]}return r}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toPrimitive$1(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey$1(e){var t=_toPrimitive$1(e,"string");return"symbol"==typeof t?t:t+""}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}var _excluded$1$2=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function(e,t){var r=e.animationData,s=e.loop,n=e.autoplay,i=e.initialSegment,o=e.onComplete,a=e.onLoopComplete,l=e.onEnterFrame,c=e.onSegmentStart,u=e.onConfigReady,d=e.onDataReady,p=e.onDataFailed,m=e.onLoadedImages,h=e.onDOMLoaded,x=e.onDestroy;e.lottieRef,e.renderer,e.name,e.assetsPath,e.rendererSettings;var f=_objectWithoutProperties$1(e,_excluded$1$2),g=_slicedToArray(reactExports.useState(!1),2),y=g[0],v=g[1],E=reactExports.useRef(),j=reactExports.useRef(null);return reactExports.useEffect(function(){var t=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(j.current){null===(t=E.current)||void 0===t||t.destroy();var s=_objectSpread2$2(_objectSpread2$2(_objectSpread2$2({},e),r),{},{container:j.current});return E.current=lottie.loadAnimation(s),v(!!E.current),function(){var e;null===(e=E.current)||void 0===e||e.destroy(),E.current=void 0}}}();return function(){return null==t?void 0:t()}},[r,s]),reactExports.useEffect(function(){E.current&&(E.current.autoplay=!!n)},[n]),reactExports.useEffect(function(){E.current&&(i?Array.isArray(i)&&i.length&&((E.current.currentRawFrame<i[0]||E.current.currentRawFrame>i[1])&&(E.current.currentRawFrame=i[0]),E.current.setSegment(i[0],i[1])):E.current.resetSegments(!0))},[i]),reactExports.useEffect(function(){var e=[{name:"complete",handler:o},{name:"loopComplete",handler:a},{name:"enterFrame",handler:l},{name:"segmentStart",handler:c},{name:"config_ready",handler:u},{name:"data_ready",handler:d},{name:"data_failed",handler:p},{name:"loaded_images",handler:m},{name:"DOMLoaded",handler:h},{name:"destroy",handler:x}].filter(function(e){return null!=e.handler});if(e.length){var t=e.map(function(e){var t;return null===(t=E.current)||void 0===t||t.addEventListener(e.name,e.handler),function(){var t;null===(t=E.current)||void 0===t||t.removeEventListener(e.name,e.handler)}});return function(){t.forEach(function(e){return e()})}}},[o,a,l,c,u,d,p,m,h,x]),{View:React$2.createElement("div",_objectSpread2$2({style:t,ref:j},f)),play:function(){var e;null===(e=E.current)||void 0===e||e.play()},stop:function(){var e;null===(e=E.current)||void 0===e||e.stop()},pause:function(){var e;null===(e=E.current)||void 0===e||e.pause()},setSpeed:function(e){var t;null===(t=E.current)||void 0===t||t.setSpeed(e)},goToAndStop:function(e,t){var r;null===(r=E.current)||void 0===r||r.goToAndStop(e,t)},goToAndPlay:function(e,t){var r;null===(r=E.current)||void 0===r||r.goToAndPlay(e,t)},setDirection:function(e){var t;null===(t=E.current)||void 0===t||t.setDirection(e)},playSegments:function(e,t){var r;null===(r=E.current)||void 0===r||r.playSegments(e,t)},setSubframe:function(e){var t;null===(t=E.current)||void 0===t||t.setSubframe(e)},getDuration:function(e){var t;return null===(t=E.current)||void 0===t?void 0:t.getDuration(e)},destroy:function(){var e;null===(e=E.current)||void 0===e||e.destroy(),E.current=void 0},animationContainerRef:j,animationLoaded:y,animationItem:E.current}};function getContainerVisibility(e){var t=e.getBoundingClientRect(),r=t.top,s=t.height;return(window.innerHeight-r)/(window.innerHeight+s)}function getContainerCursorPosition(e,t,r){var s=e.getBoundingClientRect(),n=s.top;return{x:(t-s.left)/s.width,y:(r-n)/s.height}}var useInitInteractivity=function(e){var t=e.wrapperRef,r=e.animationItem,s=e.mode,n=e.actions;reactExports.useEffect(function(){var e=t.current;if(e&&r&&n.length){r.stop();var i,o,a,l,c;switch(s){case"scroll":return l=null,c=function(){var t=getContainerVisibility(e),s=n.find(function(e){var r=e.visibility;return r&&t>=r[0]&&t<=r[1]});if(s){if("seek"===s.type&&s.visibility&&2===s.frames.length){var i=s.frames[0]+Math.ceil((t-s.visibility[0])/(s.visibility[1]-s.visibility[0])*s.frames[1]);
//! goToAndStop must be relative to the start of the current segment
r.goToAndStop(i-r.firstFrame-1,!0)}"loop"===s.type&&(null===l||l!==s.frames||r.isPaused)&&(r.playSegments(s.frames,!0),l=s.frames),"play"===s.type&&r.isPaused&&(r.resetSegments(!0),r.play()),"stop"===s.type&&r.goToAndStop(s.frames[0]-r.firstFrame-1,!0)}},document.addEventListener("scroll",c),function(){document.removeEventListener("scroll",c)};case"cursor":return i=function(t,s){var i=t,o=s;if(-1!==i&&-1!==o){var a=getContainerCursorPosition(e,i,o);i=a.x,o=a.y}var l=n.find(function(e){var t=e.position;return t&&Array.isArray(t.x)&&Array.isArray(t.y)?i>=t.x[0]&&i<=t.x[1]&&o>=t.y[0]&&o<=t.y[1]:!(!t||Number.isNaN(t.x)||Number.isNaN(t.y))&&i===t.x&&o===t.y});if(l){if("seek"===l.type&&l.position&&Array.isArray(l.position.x)&&Array.isArray(l.position.y)&&2===l.frames.length){var c=(i-l.position.x[0])/(l.position.x[1]-l.position.x[0]),u=(o-l.position.y[0])/(l.position.y[1]-l.position.y[0]);r.playSegments(l.frames,!0),r.goToAndStop(Math.ceil((c+u)/2*(l.frames[1]-l.frames[0])),!0)}"loop"===l.type&&r.playSegments(l.frames,!0),"play"===l.type&&(r.isPaused&&r.resetSegments(!1),r.playSegments(l.frames)),"stop"===l.type&&r.goToAndStop(l.frames[0],!0)}},o=function(e){i(e.clientX,e.clientY)},a=function(){i(-1,-1)},e.addEventListener("mousemove",o),e.addEventListener("mouseout",a),function(){e.removeEventListener("mousemove",o),e.removeEventListener("mouseout",a)}}}},[s,r])},useLottieInteractivity=function(e){var t=e.actions,r=e.mode,s=e.lottieObj,n=s.animationItem,i=s.View,o=s.animationContainerRef;return useInitInteractivity({actions:t,animationItem:n,mode:r,wrapperRef:o}),i},_excluded$5=["style","interactivity"],Lottie=function(e){var t,r,s,n=e.style,i=e.interactivity,o=_objectWithoutProperties$1(e,_excluded$5),a=useLottie(o,n),l=a.View,c=a.play,u=a.stop,d=a.pause,p=a.setSpeed,m=a.goToAndStop,h=a.goToAndPlay,x=a.setDirection,f=a.playSegments,g=a.setSubframe,y=a.getDuration,v=a.destroy,E=a.animationContainerRef,j=a.animationLoaded,b=a.animationItem;return reactExports.useEffect(function(){e.lottieRef&&(e.lottieRef.current={play:c,stop:u,pause:d,setSpeed:p,goToAndPlay:h,goToAndStop:m,setDirection:x,playSegments:f,setSubframe:g,getDuration:y,destroy:v,animationContainerRef:E,animationLoaded:j,animationItem:b})},[null===(t=e.lottieRef)||void 0===t?void 0:t.current]),useLottieInteractivity({lottieObj:{View:l,play:c,stop:u,pause:d,setSpeed:p,goToAndStop:m,goToAndPlay:h,setDirection:x,playSegments:f,setSubframe:g,getDuration:y,destroy:v,animationContainerRef:E,animationLoaded:j,animationItem:b},actions:null!==(r=null==i?void 0:i.actions)&&void 0!==r?r:[],mode:null!==(s=null==i?void 0:i.mode)&&void 0!==s?s:"scroll"})};const v="5.12.1",fr=60,ip=0,op=63,w=430,h=430,nm="wired-flat-1713-downtown",ddd=0,assets=[{id:"comp_0",nm:"in-reveal",fr:60,layers:[{ddd:0,ind:1,ty:4,nm:"window-14",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.94,247.246,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:31,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,33.849],[20.015,33.849],[20.015,33.254],[-20.015,33.254]],c:!0}]},{t:60,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:31,op:813,st:-31,ct:1,bm:0},{ddd:0,ind:2,ty:4,nm:"window-1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.94,321.746,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:16,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,33.849],[20.015,33.849],[20.015,33.254],[-20.015,33.254]],c:!0}]},{t:45,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:16,op:798,st:-46,ct:1,bm:0},{ddd:0,ind:3,ty:4,nm:"window-13",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,218.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:31,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:60,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:31,op:813,st:-31,ct:1,bm:0},{ddd:0,ind:4,ty:4,nm:"window-12",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,218.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:31,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:60,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:31,op:813,st:-31,ct:1,bm:0},{ddd:0,ind:5,ty:4,nm:"window-11",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,274.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:52,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:805,st:-39,ct:1,bm:0},{ddd:0,ind:6,ty:4,nm:"window-10",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,274.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:52,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:805,st:-39,ct:1,bm:0},{ddd:0,ind:7,ty:4,nm:"window-9",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,330.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:20,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:49,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:20,op:802,st:-42,ct:1,bm:0},{ddd:0,ind:8,ty:4,nm:"window-2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,330.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:20,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:49,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:20,op:802,st:-42,ct:1,bm:0},{ddd:0,ind:9,ty:4,nm:"outline-2-stroke",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.3,y:1},o:{x:.167,y:.167},t:12,s:[{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[24.5,257.25],[-24.571,257.25]],c:!1}]},{t:61,s:[{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[24.536,0],[-24.536,0]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.922,.902,.937,1],ix:3,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:4},w:{a:0,k:7,ix:5},lc:2,lj:2,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Stroke",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[301.536,152.817],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:1,op:845,st:1,ct:1,bm:0},{ddd:0,ind:10,ty:4,nm:"mask",td:1,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[286.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.299,y:1},o:{x:.167,y:.167},t:12,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-78.13,212.227],[-78.293,212.406],[-78.25,212.305],[78.128,212.313],[78.125,212.203],[77.812,212.016],[-78.253,211.195]],c:!0}]},{t:61,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-77.94,-17.023],[-78.168,-10.844],[-78.062,7.305],[78.315,7.312],[78.25,-11.047],[78.031,-16.984],[-78.064,-17.055]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.29411765933,.701960802078,.992156863213,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[301.517,197.827],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:1,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:12,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:61,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.29411765933,.701960802078,.992156863213,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:1,op:845,st:1,ct:1,bm:0},{ddd:0,ind:11,ty:4,nm:"shadow",tt:2,tp:10,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:1,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:12,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:61,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:1,op:845,st:1,ct:1,bm:1},{ddd:0,ind:12,ty:4,nm:"outline-2-fill",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.299,y:1},o:{x:.167,y:.167},t:12,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-78.13,212.227],[-78.293,212.406],[-78.25,212.305],[78.128,212.313],[78.125,212.203],[77.812,212.016],[-78.253,211.195]],c:!0}]},{t:61,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-77.94,-17.023],[-78.168,-10.844],[-78.062,7.305],[78.315,7.312],[78.25,-11.047],[78.031,-16.984],[-78.064,-17.055]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:50,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[301.517,197.827],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:1,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:12,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:61,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:1,op:845,st:1,ct:1,bm:0},{ddd:0,ind:13,ty:4,nm:"outline",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.941,268.373,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:1,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.801,107.002],[-53.181,106.911],[-53.374,106.746],[-36.626,106.865]],c:!1}]},{i:{x:.39,y:1},o:{x:.167,y:.167},t:14,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.433,87.254],[-53.806,105.286],[-53.374,106.746],[-36.626,106.865]],c:!1}]},{t:63,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.501,-68.246],[-53.374,-50.714],[-53.374,106.746],[-36.626,106.865]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:50,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:3,cix:2,bm:1,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:1,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[53.565,106.911],[.199,106.814],[-53.181,106.911],[-53.374,106.746],[53.374,106.746]],c:!1}]},{i:{x:.39,y:1},o:{x:.167,y:.167},t:14,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[52.94,105.286],[-.433,49.254],[-53.806,105.286],[-53.374,106.746],[53.374,106.746]],c:!1}]},{t:63,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[53.373,-50.714],[-.001,-106.746],[-53.374,-50.714],[-53.374,106.746],[53.374,106.746]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1}],ip:1,op:847,st:3,ct:1,bm:0},{ddd:0,ind:15,ty:4,nm:"mask",td:1,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[174.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:1,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:14,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:22,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:29,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:33,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:42,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:63,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.647058844566,.552941203117,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:1,op:822,st:-22,ct:1,bm:0},{ddd:0,ind:16,ty:4,nm:"shadow",tt:2,tp:15,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[155.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:1,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:14,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:22,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:29,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:33,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:42,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:63,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:1,op:822,st:-22,ct:1,bm:1},{ddd:0,ind:17,ty:4,nm:"outline-3-fill",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[155.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:1,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:14,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:22,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:29,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:33,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:42,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:63,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:1,op:822,st:-22,ct:1,bm:0}]},{id:"comp_1",nm:"hover-pinch",fr:60,layers:[{ddd:0,ind:1,ty:4,nm:"window-14",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.94,247.246,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:53,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,33.849],[20.015,33.849],[20.015,33.254],[-20.015,33.254]],c:!0}]},{t:82,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:53,op:835,st:-9,ct:1,bm:0},{ddd:0,ind:2,ty:4,nm:"window-1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.94,321.746,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:38,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,33.849],[20.015,33.849],[20.015,33.254],[-20.015,33.254]],c:!0}]},{t:67,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:38,op:820,st:-24,ct:1,bm:0},{ddd:0,ind:3,ty:4,nm:"window-13",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,218.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:53,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:82,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:53,op:835,st:-9,ct:1,bm:0},{ddd:0,ind:4,ty:4,nm:"window-12",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,218.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:53,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:82,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:53,op:835,st:-9,ct:1,bm:0},{ddd:0,ind:5,ty:4,nm:"window-11",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,274.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:45,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:74,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:45,op:827,st:-17,ct:1,bm:0},{ddd:0,ind:6,ty:4,nm:"window-10",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,274.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:45,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:74,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:45,op:827,st:-17,ct:1,bm:0},{ddd:0,ind:7,ty:4,nm:"window-9",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[236.438,330.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:42,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:71,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:42,op:824,st:-20,ct:1,bm:0},{ddd:0,ind:8,ty:4,nm:"window-2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[296.438,330.514,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.1,y:1},o:{x:.167,y:.167},t:42,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,29.076],[18.195,29.076],[18.438,28.924],[-17.953,28.924]],c:!0}]},{t:71,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:42,op:824,st:-20,ct:1,bm:0},{ddd:0,ind:9,ty:4,nm:"outline-2-stroke",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.3,y:1},o:{x:.167,y:.167},t:34,s:[{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[24.5,257.25],[-24.571,257.25]],c:!1}]},{t:83,s:[{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[24.536,0],[-24.536,0]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.922,.902,.937,1],ix:3,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:4},w:{a:0,k:7,ix:5},lc:2,lj:2,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Stroke",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[301.536,152.817],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:23,op:867,st:23,ct:1,bm:0},{ddd:0,ind:10,ty:4,nm:"mask",td:1,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[286.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.299,y:1},o:{x:.167,y:.167},t:34,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-78.13,212.227],[-78.293,212.406],[-78.25,212.305],[78.128,212.313],[78.125,212.203],[77.812,212.016],[-78.253,211.195]],c:!0}]},{t:83,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-77.94,-17.023],[-78.168,-10.844],[-78.062,7.305],[78.315,7.312],[78.25,-11.047],[78.031,-16.984],[-78.064,-17.055]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.29411765933,.701960802078,.992156863213,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[301.517,197.827],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:23,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:34,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:83,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.29411765933,.701960802078,.992156863213,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:23,op:867,st:23,ct:1,bm:0},{ddd:0,ind:11,ty:4,nm:"shadow",tt:2,tp:10,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:23,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:34,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:83,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:867,st:23,ct:1,bm:1},{ddd:0,ind:12,ty:4,nm:"outline-2-fill",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[266.536,215.094,0],ix:2,l:2},a:{a:0,k:[301.536,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.299,y:1},o:{x:.167,y:.167},t:34,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-78.13,212.227],[-78.293,212.406],[-78.25,212.305],[78.128,212.313],[78.125,212.203],[77.812,212.016],[-78.253,211.195]],c:!0}]},{t:83,s:[{i:[[0,-.004],[0,0],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-77.94,-17.023],[-78.168,-10.844],[-78.062,7.305],[78.315,7.312],[78.25,-11.047],[78.031,-16.984],[-78.064,-17.055]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:50,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[301.517,197.827],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.697,y:.56},o:{x:.167,y:.167},t:23,s:[{i:[[0,0],[-14.765,.311],[0,0],[0,0],[0,0],[-31.075,-.109],[0,0]],o:[[28.195,-.109],[0,0],[0,0],[0,0],[11.925,.311],[0,0],[0,0]],v:[[26.52,160.015],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.46,160.015],[.04,159.475]],c:!0}]},{i:{x:.362,y:1},o:{x:.167,y:.243},t:34,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.5,91.515],[78.23,159.845],[78.22,160.025],[-78.22,160.025],[-78.21,159.845],[-26.48,91.515],[.01,62.975]],c:!0}]},{t:83,s:[{i:[[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.85,8.38],[0,0]],o:[[29.85,8.38],[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0]],v:[[26.49,-131.485],[78.22,-63.155],[78.22,160.025],[-78.22,160.025],[-78.22,-63.155],[-26.49,-131.485],[0,-160.025]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[301.535,250.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:1,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:23,op:867,st:23,ct:1,bm:0},{ddd:0,ind:13,ty:4,nm:"outline",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[134.941,268.373,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.801,107.002],[-53.181,106.911],[-53.374,106.746],[-36.626,106.865]],c:!1}]},{i:{x:.39,y:1},o:{x:.167,y:.167},t:36,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.433,87.254],[-53.806,105.286],[-53.374,106.746],[-36.626,106.865]],c:!1}]},{t:85,s:[{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-36.501,-68.246],[-53.374,-50.714],[-53.374,106.746],[-36.626,106.865]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:50,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:3,cix:2,bm:1,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[53.565,106.911],[.199,106.814],[-53.181,106.911],[-53.374,106.746],[53.374,106.746]],c:!1}]},{i:{x:.39,y:1},o:{x:.167,y:.167},t:36,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[52.94,105.286],[-.433,49.254],[-53.806,105.286],[-53.374,106.746],[53.374,106.746]],c:!1}]},{t:85,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[53.373,-50.714],[-.001,-106.746],[-53.374,-50.714],[-53.374,106.746],[53.374,106.746]],c:!1}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1}],ip:23,op:869,st:25,ct:1,bm:0},{ddd:0,ind:15,ty:4,nm:"mask",td:1,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[174.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:36,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:44,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:55,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:64,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:73,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:85,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.647058844566,.552941203117,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:844,st:0,ct:1,bm:0},{ddd:0,ind:16,ty:4,nm:"shadow",tt:2,tp:15,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[155.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:36,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:44,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:55,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:64,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:73,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:85,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:844,st:0,ct:1,bm:1},{ddd:0,ind:17,ty:4,nm:"outline-3-fill",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[155.784,149.281,0],ix:2,l:2},a:{a:0,k:[190.784,184.281,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:1,k:[{i:{x:.833,y:.833},o:{x:.333,y:0},t:23,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.168,225.63],[-60.936,225.66],[-61.211,225.87],[43.704,226.149],[45.893,225.76]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:36,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.115,167.13],[-60.882,167.16],[-61.106,209.37],[43.704,226.149],[45.946,167.26]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:44,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.135,106.354],[-60.88,117.359],[-61.042,166.841],[43.414,218.236],[39.109,106.596]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:51,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.152,53.175],[-60.878,73.783],[-60.986,129.627],[48.709,178.03],[40.626,53.476]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:55,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.159,32.45],[-60.877,56.801],[-60.878,108.586],[42.608,147.336],[36.951,32.844]],c:!0}]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:64,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.174,-14.18],[-60.875,18.592],[-60.832,77.494],[45.007,115.267],[43.307,-14.135]],c:!0}]},{i:{x:.4,y:1},o:{x:.167,y:.167},t:73,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.183,-41.751],[-60.874,-4],[-60.774,61.701],[52.345,96.256],[51.358,-41.973]],c:!0}]},{t:85,s:[{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-34.187,-54.37],[-60.874,-14.34],[-60.874,54.37],[61.216,102.219],[60.874,-54.37]],c:!0}]}],ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[190.784,184.281],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:23,op:844,st:0,ct:1,bm:0},{ddd:0,ind:18,ty:3,nm:"Building-start",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.833,y:.833},o:{x:.6,y:0},t:0,s:[213.163,215.094,0],to:[68,0,0],ti:[-68,0,0]},{t:30,s:[621.163,215.094,0]}],ix:2,l:2},a:{a:0,k:[248.163,250.094,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:19,ty:4,nm:"Warstwa-18",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300.873,152.723,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[24.536,0],[-24.536,0]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.922,.902,.937,1],ix:3,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:4},w:{a:0,k:7,ix:5},lc:2,lj:2,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Stroke",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:20,ty:4,nm:"Warstwa-17",parent:18,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[149.778,303.279,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-16.646,-67.996],[-32.769,-50.714],[-32.769,106.746],[-16.85,106.771]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:1},{ddd:0,ind:21,ty:4,nm:"Warstwa-16",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[170.382,356.652,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:3,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:22,ty:4,nm:"Warstwa-15",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[169.882,282.43,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-20.015,21.349],[20.015,21.349],[20.015,-21.349],[-20.015,-21.349]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.392,.431,.471,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('quaternary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".quaternary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"quaternary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:23,ty:4,nm:"Warstwa-14",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[170.382,303.279,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[53.373,-50.714],[0,-106.746],[-53.373,-50.714],[-53.373,106.746],[53.373,106.746]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:24,ty:4,nm:"Warstwa-12",parent:18,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[155.779,149.832,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[2.656,-20.015],[-25.428,20.015],[-6.646,20.001],[19.928,-19.859]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:1},{ddd:0,ind:25,ty:4,nm:"Warstwa-11",parent:18,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[142.436,211.993,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-12.084,-42.146],[-12.084,42.146],[6.584,42.035],[6.584,-42.257]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:1},{ddd:0,ind:26,ty:4,nm:"Warstwa-10",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[331.775,364.42,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:27,ty:4,nm:"Warstwa-9",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[271.469,364.42,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:28,ty:4,nm:"Warstwa-8",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[331.775,308.78,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:3,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:29,ty:4,nm:"Warstwa-7",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[271.469,308.78,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:30,ty:4,nm:"Warstwa-6",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[331.775,253.139,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:31,ty:4,nm:"Warstwa-5",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[271.469,253.139,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-18.195,16.576],[18.195,16.576],[18.195,-16.576],[-18.195,-16.576]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.922,.902,.937,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('primary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".primary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"primary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:32,ty:4,nm:"Warstwa-13",parent:18,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[268.947,250,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,-32.53],[0,0],[0,0],[0,0],[-29.444,8.639],[-.366,.395]],o:[[0,0],[0,0],[-29.85,8.38],[0,0],[0,0],[0,0],[0,-32.242],[.517,-.152],[0,0]],v:[[42.692,-149.67],[33.029,-160.025],[6.538,-131.485],[-45.192,-63.155],[-45.192,160.025],[-26.023,160.05],[-26.023,-62.961],[24.916,-131.063],[26.267,-131.893]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:1},{ddd:0,ind:33,ty:4,nm:"Warstwa-4",parent:18,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[301.85,192.9,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-.004],[0,0],[0,0],[0,0],[.166,1.979],[0,0]],o:[[0,0],[0,0],[0,0],[0,-2.021],[0,0],[0,.004]],v:[[-78.095,-12.043],[-78.095,12.055],[78.095,12.055],[78.095,-6.055],[77.844,-12.055],[-78.094,-12.055]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:1,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:1},{ddd:0,ind:34,ty:4,nm:"Warstwa-3",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[301.975,250,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[29.85,8.38],[0,0],[0,0],[0,-32.53]],o:[[0,0],[0,0],[0,-32.53],[0,0],[0,0],[-29.85,8.38],[0,0]],v:[[-78.22,160.025],[78.22,160.025],[78.22,-63.155],[26.49,-131.485],[0,-160.025],[-26.49,-131.485],[-78.22,-63.155]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"rd",nm:"Round Corners 1",r:{a:0,k:4,ix:1},ix:2,mn:"ADBE Vector Filter - RC",hd:!1},{ty:"fl",c:{a:0,k:[.525,.78,.086,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('secondary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".secondary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"secondary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:35,ty:4,nm:"Warstwa-2",parent:18,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[196.589,149.831,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-38.155,-20.015],[66.238,-20.015],[33.639,20.14],[-66.238,20.14]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0},{ddd:0,ind:36,ty:4,nm:"Warstwa-1",parent:18,sr:1,ks:{o:{a:0,k:98,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[184.836,211.993,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[54.484,42.146],[-54.484,42.146],[-54.484,-42.146],[54.484,-42.146]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.91,.886,.188,1],ix:4,x:"var $bm_rt;\n$bm_rt = comp('wired-flat-1713-downtown').layer('control').effect('tertiary')('Color');"},o:{a:0,k:100,ix:5},r:1,bm:0,nm:".tertiary",mn:"ADBE Vector Graphic - Fill",hd:!1,cl:"tertiary"},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:31,st:0,ct:1,bm:0}]}],layers=[{ddd:0,ind:1,ty:3,nm:"control",sr:1,ks:{o:{a:0,k:0,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[0,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,ef:[{ty:5,nm:"primary",np:3,mn:"ADBE Color Control",ix:1,en:1,ef:[{ty:2,nm:"Color",mn:"ADBE Color Control-0001",ix:1,v:{a:0,k:[.922,.902,.937],ix:1}}]},{ty:5,nm:"secondary",np:3,mn:"ADBE Color Control",ix:2,en:1,ef:[{ty:2,nm:"Color",mn:"ADBE Color Control-0001",ix:1,v:{a:0,k:[.525,.78,.086],ix:1}}]},{ty:5,nm:"tertiary",np:3,mn:"ADBE Color Control",ix:3,en:1,ef:[{ty:2,nm:"Color",mn:"ADBE Color Control-0001",ix:1,v:{a:0,k:[.91,.886,.188],ix:1}}]},{ty:5,nm:"quaternary",np:3,mn:"ADBE Color Control",ix:4,en:1,ef:[{ty:2,nm:"Color",mn:"ADBE Color Control-0001",ix:1,v:{a:0,k:[.392,.431,.471],ix:1}}]}],ip:0,op:159,st:0,bm:0},{ddd:0,ind:2,ty:0,nm:"in-reveal",refId:"comp_0",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[215,215,0],ix:2,l:2},a:{a:0,k:[215,215,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,w:430,h:430,ip:0,op:73,st:0,bm:0},{ddd:0,ind:3,ty:0,nm:"hover-pinch",refId:"comp_1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[215,215,0],ix:2,l:2},a:{a:0,k:[215,215,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,w:430,h:430,ip:73,op:168,st:73,bm:0}],markers=[{tm:0,cm:"default:in-reveal",dr:63},{tm:73,cm:"hover-pinch",dr:85}],props={},downtownData={v:v,fr:fr,ip:ip,op:op,w:w,h:h,nm:nm,ddd:ddd,assets:assets,layers:layers,markers:markers,props:props},LottieLogo=({width:e=40,height:t=40})=>{const r=reactExports.useRef(null);reactExports.useEffect(()=>{if(r.current){const e=r.current.getDuration(!0);"number"!=typeof e||isNaN(e)||r.current.goToAndStop(e-1,!0)}},[]);return jsxRuntimeExports.jsx("div",{style:{width:e,height:t,cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:()=>{r.current&&r.current.goToAndPlay(0,!0)},onMouseLeave:()=>{if(r.current){r.current.stop();const e=r.current.getDuration(!0);"number"!=typeof e||isNaN(e)||r.current.goToAndStop(e-1,!0)}},children:jsxRuntimeExports.jsx(Lottie,{lottieRef:r,animationData:downtownData,loop:!1,autoplay:!1,style:{width:"100%",height:"100%"}})})};let isOnline=navigator.onLine;const networkListeners=[];window.addEventListener("online",()=>{isOnline=!0,networkListeners.forEach(e=>e())}),window.addEventListener("offline",()=>{isOnline=!1});const _RetryManager=class e{constructor(){__publicField(this,"retryCache",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async withRetry(e,t={}){const{maxRetries:r=3,delay:s=1e3,backoff:n="exponential",onRetry:i,shouldRetry:o}=t;let a;for(let c=1;c<=r;c++)try{if(!isOnline)throw new Error("网络连接已断开");return await e()}catch(l){if(a=l,o&&!o(l))throw l;if(this.recordRetry(e.name||"unknown",l),console.warn(`API调用失败，第${c}次重试:`,{error:l.message,attempt:c,maxRetries:r}),i&&i(c,l),c<r){const e="exponential"===n?s*Math.pow(2,c-1):s;await new Promise(t=>setTimeout(t,e))}}throw a}recordRetry(e,t){const r=`${e}_${t.message}`,s=this.retryCache.get(r)||{count:0,lastRetry:0};s.count++,s.lastRetry=Date.now(),this.retryCache.set(r,s)}getRetryStats(){return Array.from(this.retryCache.entries()).map(([e,t])=>({api:e,retryCount:t.count,lastRetry:new Date(t.lastRetry)}))}clearRetryCache(){this.retryCache.clear()}};__publicField(_RetryManager,"instance");let RetryManager=_RetryManager;const retryManager=RetryManager.getInstance();async function withRetry(e,t={}){return retryManager.withRetry(e,t)}const supabaseRetryOptions={maxRetries:3,delay:1e3,backoff:"exponential",shouldRetry:e=>["NetworkError","TimeoutError","ConnectionError","fetch failed","Failed to fetch","net::ERR_CONNECTION_TIMED_OUT","net::ERR_NETWORK","net::ERR_CONNECTION_CLOSED","500","502","503","504"].some(t=>{var r,s,n;return(null==(r=e.message)?void 0:r.includes(t))||(null==(s=e.code)?void 0:s.includes(t))||(null==(n=e.status)?void 0:n.toString().includes(t))}),onRetry:(e,t)=>{}},supabaseUrl="https://lead-service.vld.com.cn/supabase",supabaseAnonKey="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzU1Nzg1ODY3LCJleHAiOjEzMjY2NDI1ODY3fQ.h_DW3s03LaUCtf_7LepkEwmFVxdqPZ6zfHhuSMc5Ewg",supabaseServiceRoleKey="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJvbGUiOiJzZXJ2aWNlX3JvbGUiLCJpYXQiOjE3NTU3ODU4NjcsImV4cCI6MTMyNjY0MjU4Njd9.YnpJt0nFCQ66CudiuxycZGU51mIw6Y6Z3qGXdMWau80";let supabaseInstance=null,supabaseServiceRoleInstance=null;function createSupabaseClient(){return supabaseInstance||(console.log("🔧 创建 Supabase 匿名客户端实例"),supabaseInstance=createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,flowType:"pkce",debug:!1,storage:{getItem:e=>{try{return localStorage.getItem(`supabase-auth-${e}`)}catch{return null}},setItem:(e,t)=>{try{localStorage.setItem(`supabase-auth-${e}`,t)}catch{}},removeItem:e=>{try{localStorage.removeItem(`supabase-auth-${e}`)}catch{}}}},realtime:{params:{eventsPerSecond:10},heartbeatIntervalMs:3e4,reconnectAfterMs:e=>Math.min(1e3*e,3e4),log_level:"info"},global:{headers:{"X-Client-Info":"crm-web-aliyun",Accept:"application/json","Content-Type":"application/json","User-Agent":"crm-web/1.0.0"}},db:{schema:"public"}})),supabaseInstance}console.log("🔧 Supabase配置信息:",{supabaseUrl:supabaseUrl,protocol:"undefined"!=typeof window?window.location.protocol:"unknown",environment:"生产环境",envUrl:"https://lead-service.vld.com.cn/supabase",realtimeEnabled:!0});const supabase=createSupabaseClient();function createSupabaseServiceRoleClient(){return supabaseServiceRoleInstance||(console.log("🔧 创建 Supabase 服务角色客户端实例"),supabaseServiceRoleInstance=createClient(supabaseUrl,supabaseServiceRoleKey,{global:{headers:{"X-Client-Info":"crm-web-aliyun-service-role",Accept:"application/json","Content-Type":"application/json","User-Agent":"crm-web/1.0.0"}},db:{schema:"public"}})),supabaseServiceRoleInstance}async function fetchEnumValues(e){return withRetry(async()=>{const{data:t,error:r}=await supabase.rpc("get_enum_values",{enum_name:e});if(r)throw console.error("❌ [错误] 调用 get_enum_values 失败:",r),r;return Array.isArray(t)?t:(console.error("❌ [错误] get_enum_values 返回的不是数组:",t),[])},supabaseRetryOptions)}async function fetchMetroStations(){return withRetry(async()=>{const{data:e,error:t}=await supabase.rpc("get_metrostations");if(t)throw console.error("❌ [错误] 获取地铁站数据失败:",t),t;return e||[]},supabaseRetryOptions)}createSupabaseServiceRoleClient();const formatCommunityRemark=(e,t)=>{if(!e&&!t)return"";const r=e?`[COMMUNITY:${e}]`:"";return t?r?`${r}\n${t}`:t:r},validateRuleForm=e=>{if(!e.name)throw new Error("规则名称不能为空");const t={start:e.time_start?dayjs(e.time_start).format("HH:mm"):void 0,end:e.time_end?dayjs(e.time_end).format("HH:mm"):void 0,weekdays:e.weekdays},r={sources:e.sources||[],communities:e.communities||[],lead_types:e.lead_types||[],time_ranges:t};return{name:e.name,description:e.description,conditions:r,user_groups:e.user_groups||[],allocation_method:e.allocation_method||"round_robin",priority:e.priority||0,is_active:e.is_active??!0}},validateGroupForm=e=>{if(!e.groupname)throw new Error("组名称不能为空");if(!e.list||!e.list.length)throw new Error("请选择组成员");const t=e.list.filter(e=>null!=e&&""!==e).map(e=>{const t=Number(e);if(isNaN(t))throw new Error(`无效的用户ID: ${e}`);return t});return{groupname:e.groupname,description:e.description,list:t,allocation:e.allocation||"round_robin",enable_quality_control:e.enable_quality_control??!1,daily_lead_limit:e.daily_lead_limit,conversion_rate_requirement:e.conversion_rate_requirement,max_pending_leads:e.max_pending_leads,enable_community_matching:e.enable_community_matching??!0}},loadingMessages=[{message:"别催啦，已经在拼命加载了！💨",subtitle:"正在为您准备最棒的用户体验..."},{message:"正在召唤数据精灵...✨",subtitle:"请耐心等待，魔法正在生效"},{message:"服务器正在疯狂运转中...⚡",subtitle:"我们的工程师正在后台拼命工作"},{message:"正在为您打开魔法之门...🚪",subtitle:"穿越数据宇宙需要一点时间"},{message:"正在收集用户信息...📊",subtitle:"每一份数据都很重要，请稍候"},{message:"正在连接云端服务器...☁️",subtitle:"网络信号正在穿越大气层"},{message:"正在为您定制专属体验...🎨",subtitle:"个性化设置需要一点时间"},{message:"正在检查您的权限...🔐",subtitle:"安全验证正在进行中"},{message:"正在加载您的个人资料...👤",subtitle:"个人信息正在从云端下载"},{message:"正在初始化系统...🔧",subtitle:"系统组件正在启动中"},{message:"正在为您加载客户画像…🖼️",subtitle:"知己知彼，百战百胜"},{message:"AI正在分析客户偏好…🤖",subtitle:"让您的推荐更精准，成交更轻松"},{message:"系统正在优化您的沟通话术…💬",subtitle:"每一句话，都离成交更近一步"},{message:"正在计算客户成交概率…📈",subtitle:"科学决策，减少无效跟进"},{message:"正在生成客户跟进策略…🗓️",subtitle:"节奏对了，成交就对了"},{message:"系统正在模拟客户反应…🎭",subtitle:"提前预判，从容应对"},{message:"您的下一个成交正在路上…🚀",subtitle:"保持节奏，冠军就是您"},{message:"正在为您挖掘新的销售突破口…⛏️",subtitle:"换个思路，海阔天空"},{message:"管家大神经验包加载中…🧠",subtitle:"站在巨人的肩膀上开单"},{message:"系统检测到您的业绩即将飙升…📊",subtitle:"这把稳了，继续冲！"},{message:"您的专属销售Buff已生效…🛡️",subtitle:"今日幸运值+50%，快去见客户！"},{message:"您的第5单正在派送中…📦",subtitle:"本月销冠已在向你招手！"},{message:"系统检测到超级客户正在靠近…🦸",subtitle:"这次开单，一定一拖三！"},{message:"恭喜！您的努力值已满格…⚡",subtitle:"今天必有好运降临！"},{message:"正在为您连接财富信号…📡",subtitle:"嘀——检测到高意向客户！"},{message:"您的开单锦鲤正在游来…🐠",subtitle:"转发这条锦鲤，今天必开单！"},{message:"幸运值充值完成…✨",subtitle:"今日宜签约、宜收款、宜破纪录！"},{message:"您的业绩火箭正在点火…🔥",subtitle:"3、2、1——冲榜倒计时！"},{message:"检测到您今日战斗力+200%…💥",subtitle:"现在去见客户，稳赢！"},{message:"销售暴击技能加载中…🎯",subtitle:"下一单，必是王炸！"},{message:"系统偷偷为您预留了VIP客户…🤫",subtitle:"别人抢不走，专属于你！"},{message:"恭喜解锁【开单狂魔】成就…🏆",subtitle:"再赢一单，奖励升级！"},{message:"您今天的笑容价值10万…😊",subtitle:"保持状态，客户马上签单！"},{message:"磁场感应：客户即将说'Yes'…🧲",subtitle:"自信点，你值得这一单！"},{message:"您的'成交气场'已全开…🌈",subtitle:"今天遇到的客户，都会被你打动！"},{message:"系统赠您一次'必开单'机会…🎰",subtitle:"试试发个朋友圈，马上有惊喜！"},{message:"财神爷正在为您筛选客户…💰",subtitle:"信我，今天必开大单！"},{message:"您的开单符已生效…🀄",subtitle:"天时地利人和，就差你行动！"},{message:"本月旺运指数：🌟🌟🌟🌟🌟",subtitle:"五颗星的日子，别浪费！"}],getRandomLoadingMessage=()=>{const e=Math.floor(Math.random()*loadingMessages.length);return loadingMessages[e]},getLoadingMessageByType=e=>({auth:{message:"正在验证您的身份...🔐",subtitle:"请稍候，我们正在检查您的登录状态..."},data:{message:"正在加载数据...📊",subtitle:"从服务器获取最新信息中..."},profile:{message:"正在加载您的个人资料...👤",subtitle:"个人信息正在从云端下载..."},system:{message:"正在初始化系统...🔧",subtitle:"系统组件正在启动中..."},sales:{message:"您的下一个成交正在路上…🚀",subtitle:"保持节奏，冠军就是您"},customer:{message:"正在为您加载客户画像…🖼️",subtitle:"知己知彼，百战百胜"},ai:{message:"AI正在分析客户偏好…🤖",subtitle:"让您的推荐更精准，成交更轻松"}}[e]||getRandomLoadingMessage()),LoadingScreen=({message:e,subtitle:t,showProgress:r=!0,type:s,useRandomMessage:n=!1})=>{reactExports.useEffect(()=>{var e,t;const r=(new Error).stack,s=(null==r?void 0:r.split("\n"))||[];for(let n=1;n<s.length;n++){const r=s[n];if(r.includes("LoadingScreen.tsx")||r.includes("useEffect"))continue;const i=r.match(/at\s+(.+?)\s+\((.+?):(\d+):(\d+)\)/);if(i){i[1];const t=i[2];i[3],null==(e=t.split("/").pop())||e.split("?")[0];break}const o=r.match(/at\s+(.+?):(\d+):(\d+)/);if(o){const e=o[1];o[2],null==(t=e.split("/").pop())||t.split("?")[0];break}}return()=>{}},[]);const[i,o]=reactExports.useState(()=>e&&t?{message:e,subtitle:t}:s&&"random"!==s?getLoadingMessageByType(s):getRandomLoadingMessage());return reactExports.useEffect(()=>{if(n){const e=setInterval(()=>{const e=getRandomLoadingMessage();o(e)},5e3);return()=>clearInterval(e)}},[n,i.message]),jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",background:"linear-gradient(135deg, #f8f9fa 0%, #ffffff 50%, #f1f3f4 100%)",color:"#333",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',position:"relative",overflow:"hidden"},children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.03) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.03) 0%, transparent 50%)",pointerEvents:"none"}}),jsxRuntimeExports.jsx("div",{style:{width:80,height:80,border:"3px solid #e8eaed",borderTop:"3px solid #1890ff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:32,position:"relative",zIndex:1}}),jsxRuntimeExports.jsx("div",{style:{fontSize:"24px",fontWeight:600,marginBottom:16,textAlign:"center",color:"#1a1a1a",position:"relative",zIndex:1},children:i.message}),jsxRuntimeExports.jsx("div",{style:{fontSize:"16px",color:"#666",textAlign:"center",maxWidth:400,lineHeight:1.6,position:"relative",zIndex:1},children:i.subtitle}),r&&jsxRuntimeExports.jsx("div",{style:{marginTop:40,width:240,height:6,backgroundColor:"#f0f0f0",borderRadius:3,overflow:"hidden",position:"relative",zIndex:1,boxShadow:"inset 0 1px 2px rgba(0,0,0,0.1)"},children:jsxRuntimeExports.jsx("div",{style:{height:"100%",background:"linear-gradient(90deg, #1890ff 0%, #40a9ff 50%, #1890ff 100%)",borderRadius:3,animation:"progress 2s ease-in-out infinite",width:"30%",boxShadow:"0 1px 3px rgba(24, 144, 255, 0.3)"}})}),jsxRuntimeExports.jsx("div",{style:{marginTop:32,fontSize:"14px",color:"#999",textAlign:"center",position:"relative",zIndex:1},children:"如果加载时间过长，请检查网络连接"}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:"20%",right:"10%",width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(24, 144, 255, 0.05) 100%)",animation:"float 3s ease-in-out infinite",pointerEvents:"none"}}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",bottom:"20%",left:"10%",width:60,height:60,borderRadius:"50%",background:"linear-gradient(135deg, rgba(82, 196, 26, 0.1) 0%, rgba(82, 196, 26, 0.05) 100%)",animation:"float 4s ease-in-out infinite reverse",pointerEvents:"none"}}),jsxRuntimeExports.jsx("style",{children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        \n        @keyframes progress {\n          0% { transform: translateX(-100%); }\n          50% { transform: translateX(200%); }\n          100% { transform: translateX(-100%); }\n        }\n        \n        @keyframes float {\n          0%, 100% { transform: translateY(0px) rotate(0deg); }\n          50% { transform: translateY(-20px) rotate(180deg); }\n        }\n      "})]})},{Text:Text$l,Paragraph:Paragraph$3}=Typography,{TabPane:TabPane$5}=Tabs,LeadDetailDrawer=({leadid:e})=>{const[t,r]=reactExports.useState(!1),[s,n]=reactExports.useState(null);reactExports.useEffect(()=>{e&&(async()=>{var t,s,i;if(e){r(!0);try{const[{data:r,error:o},{data:a},{data:l},{data:c}]=await Promise.all([supabase.rpc("filter_leads",{p_leadid:e}),supabase.from("followups").select("*, interviewsales_user:users_profile!followups_interviewsales_user_id_fkey(nickname)").eq("leadid",e).single(),supabase.from("showings").select("*, showingsales_user:users_profile!showings_showingsales_fkey(nickname), trueshowingsales_user:users_profile!showings_trueshowingsales_fkey(nickname)").eq("leadid",e).order("created_at",{ascending:!1}),supabase.from("deals").select("*").eq("leadid",e).order("created_at",{ascending:!1})]);if(o)return void staticMethods.error("获取线索详情失败: "+o.message);if(r&&r.length>0){const e=r[0],o=l&&l.length>0?l[0]:null,u=c&&c.length>0?c[0]:null,d={...e,followup_id:null==a?void 0:a.id,followup_leadtype:null==a?void 0:a.leadtype,followupstage:null==a?void 0:a.followupstage,customerprofile:null==a?void 0:a.customerprofile,worklocation:null==a?void 0:a.worklocation,userbudget:null==a?void 0:a.userbudget,moveintime:null==a?void 0:a.moveintime,userrating:null==a?void 0:a.userrating,majorcategory:null==a?void 0:a.majorcategory,followupresult:null==a?void 0:a.followupresult,scheduletime:null==a?void 0:a.scheduletime,scheduledcommunity:null==a?void 0:a.scheduledcommunity,followup_created_at:null==a?void 0:a.created_at,followup_updated_at:null==a?void 0:a.updated_at,interviewsales_user_id:null==a?void 0:a.interviewsales_user_id,interviewsales_user_name:null==(t=null==a?void 0:a.interviewsales_user)?void 0:t.nickname,showing_id:null==o?void 0:o.id,showing_scheduletime:null==o?void 0:o.scheduletime,showing_community:null==o?void 0:o.community,arrivaltime:null==o?void 0:o.arrivaltime,showingsales:null==o?void 0:o.showingsales,showingsales_name:null==(s=null==o?void 0:o.showingsales_user)?void 0:s.nickname,trueshowingsales:null==o?void 0:o.trueshowingsales,trueshowingsales_name:null==(i=null==o?void 0:o.trueshowingsales_user)?void 0:i.nickname,viewresult:null==o?void 0:o.viewresult,showing_budget:null==o?void 0:o.budget,showing_moveintime:null==o?void 0:o.moveintime,showing_remark:null==o?void 0:o.remark,renttime:null==o?void 0:o.renttime,showing_created_at:null==o?void 0:o.created_at,showing_updated_at:null==o?void 0:o.updated_at,deal_id:null==u?void 0:u.id,contractdate:null==u?void 0:u.contractdate,deal_community:null==u?void 0:u.community,contractnumber:null==u?void 0:u.contractnumber,roomnumber:null==u?void 0:u.roomnumber,deal_created_at:null==u?void 0:u.created_at,deal_updated_at:null==u?void 0:u.updated_at,showingsList:l||[],dealsList:c||[]};n(d)}else staticMethods.warning("未找到该线索信息")}catch(o){staticMethods.error("获取线索详情失败")}finally{r(!1)}}})()},[e]);const i=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{staticMethods.success(`${t}已复制到剪贴板`)}).catch(()=>{staticMethods.error("复制失败")})},o=e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"-",a=e=>e?e.length<4?e:e.substring(0,2)+"****"+e.substring(e.length-2):"-",l=e=>({"新建":"green","重复":"orange","待接收":"blue","确认需求":"cyan","邀约到店":"purple","已到店":"magenta","赢单":"success","丢单":"error"}[e]||"default");return t?jsxRuntimeExports.jsx(LoadingScreen,{type:"data"}):s?jsxRuntimeExports.jsxs(Tabs,{defaultActiveKey:"basic",size:"large",children:[jsxRuntimeExports.jsx(TabPane$5,{tab:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$5,{}),"基本信息"]}),children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Card$1,{title:"线索基础信息",size:"small",children:jsxRuntimeExports.jsxs(Descriptions,{column:2,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"线索编号",span:2,children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Text$l,{code:!0,children:s.leadid}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>i(s.leadid,"线索编号"),children:"复制"})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"手机号",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$1,{}),jsxRuntimeExports.jsx(Text$l,{children:o(s.phone)}),s.phone&&jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>i(s.phone,"手机号"),children:"复制"})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"微信号",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$2,{}),jsxRuntimeExports.jsx(Text$l,{children:a(s.wechat)}),s.wechat&&jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>i(s.wechat,"微信号"),children:"复制"})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"QQ",children:jsxRuntimeExports.jsx(Text$l,{children:s.qq||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"位置",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$3,{}),jsxRuntimeExports.jsx(Text$l,{children:s.location||"-"})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"预算",children:jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:s.budget||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"区域",children:jsxRuntimeExports.jsx(Text$l,{children:s.area||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"来源",children:jsxRuntimeExports.jsx(Tag$1,{color:(c=s.source,{"抖音":"red","小红书":"pink","微信":"green","电话":"blue","其他":"default"}[c]||"default"),children:s.source||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"线索类型",children:jsxRuntimeExports.jsx(Tag$1,{color:"green",children:s.leadtype||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"线索状态",children:jsxRuntimeExports.jsx(Tag$1,{color:l(s.leadstatus),children:s.leadstatus||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"流量类型",children:jsxRuntimeExports.jsx(Text$l,{children:s.traffictype||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"互动类型",children:jsxRuntimeExports.jsx(Text$l,{children:s.interactiontype||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$4,{}),jsxRuntimeExports.jsx(Text$l,{children:dayjs(s.created_at).format("YYYY-MM-DD HH:mm:ss")})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"更新时间",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$4,{}),jsxRuntimeExports.jsx(Text$l,{children:dayjs(s.updata_at).format("YYYY-MM-DD HH:mm:ss")})]})})]})}),jsxRuntimeExports.jsx(Card$1,{title:"广告信息",size:"small",children:jsxRuntimeExports.jsxs(Descriptions,{column:2,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"抖音ID",children:jsxRuntimeExports.jsx(Text$l,{children:s.douyinid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"抖音账号",children:jsxRuntimeExports.jsx(Text$l,{children:s.douyin_accountname||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"小红书ID",children:jsxRuntimeExports.jsx(Text$l,{children:s.redbookid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"员工姓名",children:jsxRuntimeExports.jsx(Text$l,{children:s.staffname||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"广告系列ID",children:jsxRuntimeExports.jsx(Text$l,{code:!0,children:s.campaignid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"广告系列名称",children:jsxRuntimeExports.jsx(Text$l,{children:s.campaignname||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"广告单元ID",children:jsxRuntimeExports.jsx(Text$l,{code:!0,children:s.unitid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"广告单元名称",children:jsxRuntimeExports.jsx(Text$l,{children:s.unitname||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创意ID",children:jsxRuntimeExports.jsx(Text$l,{code:!0,children:s.creativedid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创意名称",children:jsxRuntimeExports.jsx(Text$l,{children:s.creativename||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"抖音线索ID",children:jsxRuntimeExports.jsx(Text$l,{code:!0,children:s.douyinleadid||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"备注链接",children:jsxRuntimeExports.jsx(Text$l,{children:s.notelink||"-"})})]})}),jsxRuntimeExports.jsx(Card$1,{title:"备注信息",size:"small",children:jsxRuntimeExports.jsx(Paragraph$3,{children:s.remark||"暂无备注信息"})})]})},"basic"),jsxRuntimeExports.jsx(TabPane$5,{tab:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$5,{}),"跟进信息"]}),children:jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Card$1,{title:"跟进记录",size:"small",children:jsxRuntimeExports.jsxs(Descriptions,{column:2,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"跟进阶段",children:jsxRuntimeExports.jsx(Tag$1,{color:l(s.followupstage||""),children:s.followupstage||"待接收"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"客户画像",children:jsxRuntimeExports.jsx(Text$l,{children:s.customerprofile||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"工作地点",children:jsxRuntimeExports.jsx(Text$l,{children:s.worklocation||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"用户预算",children:jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:s.userbudget||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"入住时间",children:jsxRuntimeExports.jsx(Text$l,{children:s.moveintime?dayjs(s.moveintime).format("YYYY-MM-DD"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"用户评级",children:jsxRuntimeExports.jsx(Text$l,{children:s.userrating||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"主要分类",children:jsxRuntimeExports.jsx(Text$l,{children:s.majorcategory||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"预约时间",children:jsxRuntimeExports.jsx(Text$l,{children:s.scheduletime?dayjs(s.scheduletime).format("YYYY-MM-DD HH:mm"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"预约社区",children:jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:s.scheduledcommunity||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"面试销售",children:jsxRuntimeExports.jsx(Text$l,{children:s.interviewsales_user_name||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"跟进结果",children:jsxRuntimeExports.jsx(Text$l,{children:s.followupresult||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"跟进创建时间",children:jsxRuntimeExports.jsx(Text$l,{children:s.followup_created_at?dayjs(s.followup_created_at).format("YYYY-MM-DD HH:mm:ss"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"跟进更新时间",children:jsxRuntimeExports.jsx(Text$l,{children:s.followup_updated_at?dayjs(s.followup_updated_at).format("YYYY-MM-DD HH:mm:ss"):"-"})})]})})})},"followup"),jsxRuntimeExports.jsx(TabPane$5,{tab:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$6,{}),"带看信息"]}),children:jsxRuntimeExports.jsx("div",{children:(null==s?void 0:s.showingsList)&&Array.isArray(s.showingsList)&&s.showingsList.length>0?jsxRuntimeExports.jsx("div",{children:s.showingsList.map((e,t)=>{var r,n;return jsxRuntimeExports.jsx(Card$1,{title:"带看记录 #"+(s.showingsList.length-t),size:"small",children:jsxRuntimeExports.jsxs(Descriptions,{column:2,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"预约时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.scheduletime?dayjs(e.scheduletime).format("YYYY-MM-DD HH:mm"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"社区",children:jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:e.community||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"到达时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.arrivaltime?dayjs(e.arrivaltime).format("YYYY-MM-DD HH:mm"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"带看销售",children:jsxRuntimeExports.jsx(Text$l,{children:(null==(r=e.showingsales_user)?void 0:r.nickname)||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"真实带看销售",children:jsxRuntimeExports.jsx(Text$l,{children:(null==(n=e.trueshowingsales_user)?void 0:n.nickname)||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"看房结果",children:jsxRuntimeExports.jsx(Text$l,{children:e.viewresult||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"预算",children:jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:e.budget?`¥${e.budget}`:"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"入住时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.moveintime?dayjs(e.moveintime).format("YYYY-MM-DD"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"租期",children:jsxRuntimeExports.jsx(Text$l,{children:e.renttime?`${e.renttime}个月`:"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"备注",children:jsxRuntimeExports.jsx(Text$l,{children:e.remark||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.created_at?dayjs(e.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"更新时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.updated_at?dayjs(e.updated_at).format("YYYY-MM-DD HH:mm:ss"):"-"})}),e.phone&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"手机号",children:jsxRuntimeExports.jsx(Text$l,{children:o(e.phone)})}),e.wechat&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"微信号",children:jsxRuntimeExports.jsx(Text$l,{children:a(e.wechat)})})]})},e.id)})}):jsxRuntimeExports.jsx(Card$1,{style:{textAlign:"center",color:"#999"},size:"small",bordered:!1,children:"暂无带看记录"})})},"showing"),jsxRuntimeExports.jsx(TabPane$5,{tab:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$7,{}),"成交信息"]}),children:jsxRuntimeExports.jsx("div",{children:(null==s?void 0:s.dealsList)&&Array.isArray(s.dealsList)&&s.dealsList.length>0?jsxRuntimeExports.jsx("div",{children:s.dealsList.map((e,t)=>jsxRuntimeExports.jsx(Card$1,{title:"成交记录 #"+(s.dealsList.length-t),size:"small",children:jsxRuntimeExports.jsxs(Descriptions,{column:2,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"合同日期",children:jsxRuntimeExports.jsx(Text$l,{children:e.contractdate?dayjs(e.contractdate).format("YYYY-MM-DD"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"社区",children:jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e.community||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"合同编号",children:jsxRuntimeExports.jsx(Text$l,{code:!0,children:e.contractnumber||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"房间编号",children:jsxRuntimeExports.jsx(Text$l,{children:e.roomnumber||"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.created_at?dayjs(e.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"更新时间",children:jsxRuntimeExports.jsx(Text$l,{children:e.updated_at?dayjs(e.updated_at).format("YYYY-MM-DD HH:mm:ss"):"-"})}),e.phone&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"手机号",children:jsxRuntimeExports.jsx(Text$l,{children:o(e.phone)})}),e.wechat&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"微信号",children:jsxRuntimeExports.jsx(Text$l,{children:a(e.wechat)})})]})},e.id))}):jsxRuntimeExports.jsx(Card$1,{style:{textAlign:"center",color:"#999"},size:"small",bordered:!1,children:"暂无成交记录"})})},"deal")]}):null;var c};function normalizeUtcString(e){return e.replace(/\+00$/,"Z")}function toBeijingTimeStr(e){if(!e)return"";let t="string"==typeof e?e:e.toString();t=normalizeUtcString(t);return dayjs(t).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss")}function getCurrentBeijingTime(){return dayjs().tz("Asia/Shanghai")}function toBeijingTime(e){return e?dayjs(e).tz("Asia/Shanghai"):dayjs().tz("Asia/Shanghai")}function toBeijingDateStr(e){return toBeijingTime(e).format("YYYY-MM-DD")}function toBeijingDateTimeStr(e){return toBeijingTime(e).format("YYYY-MM-DD HH:mm:ss")}function getDayStart(e){return toBeijingTime(e).startOf("day")}function getDayEnd(e){return toBeijingTime(e).endOf("day")}function getWeekStart(e){return toBeijingTime(e).startOf("week")}function getWeekEnd(e){return toBeijingTime(e).endOf("week")}dayjs.extend(utc),dayjs.extend(timezone);const{Title:Title$h}=Typography,{Search:Search$2}=Input$1,{TextArea:TextArea$6}=Input$1,{RangePicker:RangePicker$5}=DatePicker$2,LeadsList=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(""),[o,a]=reactExports.useState(""),[l,c]=reactExports.useState(!1),[u]=Form$4.useForm(),[,d]=reactExports.useState(null),[p,m]=reactExports.useState([]),[h,x]=reactExports.useState({}),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState([]),[b,w]=reactExports.useState(!1),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState(""),[k,$]=reactExports.useState([]),[T,I]=reactExports.useState(!1),[P,A]=reactExports.useState(!1),[F,M]=reactExports.useState({current:1,pageSize:10,total:0});reactExports.useEffect(()=>{O(),fetchEnumValues("source").then(e=>{m(e.map(e=>({value:e,label:e})))}),supabase.rpc("get_enum_values",{enum_name:"community"}).then(({data:e,error:t})=>{!t&&Array.isArray(e)&&j(e.filter(e=>"string"==typeof e&&!!e).map(e=>({value:e,label:e})))}),D()},[]);const D=async()=>{A(!0);try{const{data:e,error:t}=await supabase.from("users_profile").select("\n          id,\n          nickname,\n          status,\n          organization_id,\n          organizations(name)\n        ").eq("status","active").order("nickname");if(t)staticMethods.error("获取销售人员列表失败: "+t.message);else{const t=(null==e?void 0:e.map(e=>{var t;return{...e,organization_name:null==(t=e.organizations)?void 0:t.name}}))||[];$(t)}}catch(e){staticMethods.error("获取销售人员列表失败")}finally{A(!1)}};reactExports.useEffect(()=>{const t=Array.from(new Set(e.map(e=>e.leadtype).filter(e=>"string"==typeof e&&!!e)));v(t.map(e=>({value:e,label:e})))},[e]);const O=async(e={})=>{s(!0);try{const r=Object.fromEntries(Object.entries(e).filter(([e])=>L.includes(e))),{data:s,error:n}=await supabase.rpc("filter_leads",r);n?staticMethods.error("获取线索失败: "+n.message):(t(s||[]),M(e=>({...e,total:(null==s?void 0:s.length)||0})))}catch(r){staticMethods.error("获取线索失败")}finally{s(!1)}},N=t=>{const r=Array.from(new Set(e.map(e=>e[t]))).filter(e=>"string"==typeof e&&!!e&&""!==e);return r.map(e=>{let r=e;var s,n;return"phone"===t?r=!(n=e)||n.length<7?n:n.substring(0,4)+"****"+n.substring(n.length-3):"wechat"===t&&(r=!(s=e)||s.length<4?s:s.substring(0,2)+"****"+s.substring(s.length-2)),{text:r,value:e,searchText:"phone"===t||"wechat"===t?`${e} ${r}`:void 0}})},B=[{title:"线索编号",dataIndex:"leadid",key:"leadid",width:120,filters:N("leadid"),filterSearch:!0,filterMultiple:!1,render:e=>jsxRuntimeExports.jsx(Tooltip,{title:"点击查看线索详情",children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>{C(e),_(!0)},children:e})})},{title:"手机号",dataIndex:"phone",key:"phone",width:120,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>{const o=N("phone").filter(e=>{if(!n)return!0;const t=String(e.value||"").toLowerCase(),r=String(e.text||"").toLowerCase();return t.includes(n.toLowerCase())||r.includes(n.toLowerCase())});return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"在筛选项中搜索",value:n,onChange:e=>i(e.target.value),style:{marginBottom:8}}),jsxRuntimeExports.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:o.map((r,s)=>jsxRuntimeExports.jsxs("div",{style:{padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",backgroundColor:t.includes(r.value)?"#e6f7ff":void 0},onClick:()=>{const s=t.includes(r.value)?t.filter(e=>e!==r.value):[...t,r.value];e(s)},children:[jsxRuntimeExports.jsx(Checkbox,{checked:t.includes(r.value),style:{marginRight:8},tabIndex:-1,onChange:()=>{}}),jsxRuntimeExports.jsx("span",{children:r.text})]},s))}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"right"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>r(),style:{marginRight:8},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>{s&&s(),r&&r()},children:"重置"})]})]})},filterMultiple:!1,render:e=>{if(!e)return jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"});return jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx("span",{style:{color:"#000"},children:(t=e,!t||t.length<7?t:t.substring(0,4)+"****"+t.substring(t.length-3))})});var t}},{title:"微信",dataIndex:"wechat",key:"wechat",width:120,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>{const n=N("wechat").filter(e=>{if(!o)return!0;const t=String(e.value||"").toLowerCase(),r=String(e.text||"").toLowerCase();return t.includes(o.toLowerCase())||r.includes(o.toLowerCase())});return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"在筛选项中搜索",value:o,onChange:e=>a(e.target.value),style:{marginBottom:8}}),jsxRuntimeExports.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:n.map((r,s)=>jsxRuntimeExports.jsxs("div",{style:{padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",backgroundColor:t.includes(r.value)?"#e6f7ff":void 0},onClick:()=>{const s=t.includes(r.value)?t.filter(e=>e!==r.value):[...t,r.value];e(s)},children:[jsxRuntimeExports.jsx(Checkbox,{checked:t.includes(r.value),style:{marginRight:8},tabIndex:-1,onChange:()=>{}}),jsxRuntimeExports.jsx("span",{children:r.text})]},s))}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"right"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>r(),style:{marginRight:8},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>{s&&s(),r&&r()},children:"重置"})]})]})},filterMultiple:!1,render:e=>{if(!e)return jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"});return jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1677ff"},children:(t=e,!t||t.length<4?t:t.substring(0,2)+"****"+t.substring(t.length-2))})});var t}},{title:"渠道",dataIndex:"source",key:"source",width:100,filters:N("source"),render:e=>{const t=p.find(t=>t.value===e);return jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:(null==t?void 0:t.label)||e})}},{title:"线索类型",dataIndex:"leadtype",key:"leadtype",width:100,filters:N("leadtype"),render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e}):"-"},{title:"预算",dataIndex:"budget",key:"budget",width:100,filters:N("budget"),render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:e}):"-"},{title:"区域",dataIndex:"area",key:"area",width:120,filters:N("area"),render:e=>e||"-"},{title:"状态",dataIndex:"leadstatus",key:"leadstatus",width:100,filters:N("leadstatus"),render:e=>{return jsxRuntimeExports.jsx(Tag$1,{color:(t=e,{"新建":"blue","跟进中":"orange","已到店":"green","赢单":"success","输单":"red","重复":"purple"}[t]||"default"),children:e});var t}},{title:"备注",dataIndex:"remark",key:"remark",width:150,filters:N("remark"),filterSearch:!0,render:e=>e||"-"},{title:"分配管家",dataIndex:"interviewsales",key:"interviewsales",width:120,filters:N("interviewsales"),render:e=>jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",color:"#000"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#bfbfbf",marginRight:6,fontSize:18}}),e||"未分配"]})},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180,sorter:(e,t)=>toBeijingTime(t.created_at).valueOf()-toBeijingTime(e.created_at).valueOf(),filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>{let n;if(Array.isArray(t[0])&&2===t[0].length){const[e,r]=t[0];n=[e?dayjs(e):null,r?dayjs(r):null]}return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(RangePicker$5,{showTime:!0,style:{width:240},value:n,onChange:(t,r)=>{t&&r[0]&&r[1]?e([[r[0],r[1]]]):e([])}}),jsxRuntimeExports.jsxs("div",{style:{marginTop:8,textAlign:"right"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{marginRight:8},onClick:()=>r(),children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>{s&&s(),d(null)},children:"重置"})]})]})},filterDropdownProps:{onOpenChange:e=>{}},onFilter:(e,t)=>{if(!e||!Array.isArray(e)||2!==e.length)return!0;const[r,s]=e,n=toBeijingTime(t.created_at).valueOf();return n>=toBeijingTime(r).valueOf()&&n<=toBeijingTime(s).valueOf()},render:e=>toBeijingDateTimeStr(e)}],L=["p_leadid","p_created_at_start","p_created_at_end","p_updata_at_start","p_updata_at_end","p_phone","p_wechat","p_qq","p_location","p_budget","p_remark","p_source","p_douyinid","p_douyin_accountname","p_staffname","p_redbookid","p_area","p_notelink","p_campaignid","p_campaignname","p_unitid","p_unitname","p_creativedid","p_creativename","p_leadtype","p_traffictype","p_interactiontype","p_douyinleadid","p_leadstatus","p_keyword"],z={leadid:"p_leadid",created_at:"created_at",updata_at:"updata_at",phone:"p_phone",wechat:"p_wechat",qq:"p_qq",location:"p_location",budget:"p_budget",remark:"p_remark",source:"p_source",douyinid:"p_douyinid",douyin_accountname:"p_douyin_accountname",staffname:"p_staffname",redbookid:"p_redbookid",area:"p_area",notelink:"p_notelink",campaignid:"p_campaignid",campaignname:"p_campaignname",unitid:"p_unitid",unitname:"p_unitname",creativedid:"p_creativedid",creativename:"p_creativename",leadtype:"p_leadtype",traffictype:"p_traffictype",interactiontype:"p_interactiontype",douyinleadid:"p_douyinleadid",leadstatus:"p_leadstatus"},V=(e,t)=>{M(r=>({...r,current:e,pageSize:t}))};return jsxRuntimeExports.jsxs("div",{className:"page-card",children:[jsxRuntimeExports.jsx("div",{className:"mb-6",children:jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsx(Title$h,{level:4,className:"m-0 font-bold text-gray-800",children:"线索列表"}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexDirection:"row"},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"线索编号或联系方式...",allowClear:!0,onPressEnter:e=>(e=>{const t={...h,p_keyword:e||null};x(t),M(e=>({...e,current:1})),O(t)})(e.target.value),style:{width:"280px"},prefix:jsxRuntimeExports.jsx(RefIcon$8,{style:{color:"#bfbfbf"}})}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:()=>O(),className:"rounded-md font-medium",children:"刷新"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>c(!0),className:"rounded-md font-medium",children:"新建线索"})]})]})}),jsxRuntimeExports.jsx("div",{className:"w-full",style:{marginTop:"8px"},children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:B,dataSource:e,loading:{spinning:r,tip:""},pagination:{current:F.current,pageSize:F.pageSize,total:F.total,pageSizeOptions:["10","20","50","100"],showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:V,onShowSizeChange:V},bordered:!1,className:"page-table compact-table",rowClassName:()=>"compact-table-row",scroll:{x:"max-content",y:600},tableLayout:"fixed",sticky:!0,onChange:(e,t)=>{const r={...h};Object.keys(t).forEach(e=>{if("created_at"===e)return void(t.created_at&&Array.isArray(t.created_at)&&2===t.created_at.length?(r.p_created_at_start=toBeijingDateStr(getDayStart(t.created_at[0])),r.p_created_at_end=toBeijingDateStr(getDayEnd(t.created_at[1]))):(r.p_created_at_start=null,r.p_created_at_end=null));if("updata_at"===e)return void(t.updata_at&&Array.isArray(t.updata_at)&&2===t.updata_at.length?(r.p_updata_at_start=toBeijingDateStr(getDayStart(t.updata_at[0])),r.p_updata_at_end=toBeijingDateStr(getDayEnd(t.updata_at[1]))):(r.p_updata_at_start=null,r.p_updata_at_end=null));const s=z[e];s&&(t[e]&&t[e].length>0?r[s]=t[e][0]:r[s]=null)}),x(r),O(r)}})}),jsxRuntimeExports.jsx(Modal$2,{title:"新建线索",open:l,onCancel:()=>{c(!1),u.resetFields(),I(!1)},footer:null,width:800,className:"page-modal",centered:!0,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:u,layout:"vertical",onFinish:async e=>{if(!b){w(!0);try{if(!e.phone&&!e.wechat)return void staticMethods.error("请至少填写手机号或微信号");let t=e.remark||"";if(T&&e.assigned_user_id){const r=`MANUAL_ASSIGN:${e.assigned_user_id}`;t=t?`${t}|${r}`:r}const{community:r,assigned_user_id:s,...n}=e,i=formatCommunityRemark(T?null:r,t),o={...n,remark:i,created_at:toBeijingDateTimeStr(new Date)},{data:a,error:l}=await supabase.from("leads").insert([o]).select();if(l)staticMethods.error("添加线索失败: "+l.message);else{const t=a&&a[0];if(t&&"重复"===t.leadstatus)staticMethods.warning('该线索为重复线索，已标记为"重复"');else if(T&&e.assigned_user_id){const t=k.find(t=>t.id===e.assigned_user_id);staticMethods.success(`添加线索成功！已手动分配给 ${(null==t?void 0:t.nickname)||"指定用户"}`)}else staticMethods.success("添加线索成功！系统将自动分配销售管家");f?(u.resetFields(),I(!1)):(c(!1),u.resetFields(),I(!1)),g(!1),O()}}catch(t){staticMethods.error(`添加线索失败: ${t.message}`)}finally{w(!1)}}},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,padding:12,backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:6},children:[jsxRuntimeExports.jsx("div",{style:{color:"#52c41a",fontWeight:500,marginBottom:4},children:"💡 线索分配提示"}),jsxRuntimeExports.jsx("div",{style:{fontSize:12,color:"#666",lineHeight:1.5},children:"系统会根据渠道、线索类型、区域等信息自动分配销售管家。 填写越详细，分配越精准。您可以选择自动分配（选社区）或手动分配（选销售）。"})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"phone",label:"手机号",rules:[{validator:(e,t)=>{const r=u.getFieldValue("wechat");return t||r?Promise.resolve():Promise.reject(new Error("请至少填写手机号或微信号"))}}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入手机号（可选）"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"wechat",label:"微信号",rules:[{validator:(e,t)=>{const r=u.getFieldValue("phone");return t||r?Promise.resolve():Promise.reject(new Error("请至少填写手机号或微信号"))}}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入微信号（可选）"})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"source",label:"渠道",rules:[{required:!0,message:"请选择渠道"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择渠道",options:p})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx("span",{children:"定向分配"}),jsxRuntimeExports.jsx(Switch$1,{checked:T,onChange:e=>{I(e),e?u.setFieldsValue({community:void 0}):u.setFieldsValue({assigned_user_id:void 0})},size:"small"})]}),children:T?jsxRuntimeExports.jsx(Form$4.Item,{name:"assigned_user_id",rules:[{required:T,message:"请选择销售人员"}],style:{marginBottom:0},children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择销售人员",loading:P,showSearch:!0,filterOption:(e,t)=>((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase()),options:k.map(e=>({value:e.id,label:`${e.nickname}${e.organization_name?` (${e.organization_name})`:""}`,disabled:"active"!==e.status}))})}):jsxRuntimeExports.jsx(Form$4.Item,{name:"community",rules:[{required:!T,message:"请选择社区"}],style:{marginBottom:0},children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择社区",options:E})})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"budget",label:"预算",children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择预算范围",allowClear:!0,children:[jsxRuntimeExports.jsx(Select.Option,{value:"2000以下",children:"2000以下"}),jsxRuntimeExports.jsx(Select.Option,{value:"2000～2500",children:"2000～2500"}),jsxRuntimeExports.jsx(Select.Option,{value:"2500～3000",children:"2500～3000"}),jsxRuntimeExports.jsx(Select.Option,{value:"3000～4000",children:"3000～4000"}),jsxRuntimeExports.jsx(Select.Option,{value:"4000以上",children:"4000以上"})]})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"leadtype",label:"线索类型",children:jsxRuntimeExports.jsx(Select,{mode:"tags",placeholder:"请选择或输入线索类型",allowClear:!0,options:y.length>0?y:[]})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"campaignname",label:"广告计划",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入广告计划名称（可选）"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"unitname",label:"广告单元",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入广告单元名称（可选）"})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"creativename",label:"创意名称",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入创意名称（可选）"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"remark",label:"备注",children:jsxRuntimeExports.jsx(TextArea$6,{rows:3,placeholder:"请输入备注信息（可选）",maxLength:500,showCount:!0,style:{marginBottom:16}})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginBottom:0,textAlign:"right"},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>{c(!1),u.resetFields(),I(!1)},disabled:b,children:"取消"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{g(!0),u.submit()},disabled:b,children:"继续新建"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:b,children:"确定"})]})})]})}),jsxRuntimeExports.jsx(Drawer,{open:R,onClose:()=>{_(!1),C("")},title:"线索详情",width:800,destroyOnHidden:!0,placement:"right",children:S&&jsxRuntimeExports.jsx(LeadDetailDrawer,{leadid:S})})]})};async function getConversionRateStatsWithActualSales(e={}){const{data:t,error:r}=await supabase.rpc("get_conversion_rate_stats_with_actual_sales",{p_date_start:e.date_start||null,p_date_end:e.date_end||null,p_previous_date_start:e.previous_date_start||null,p_previous_date_end:e.previous_date_end||null});if(r)throw r;return t}const{Text:Text$k}=Typography,{RangePicker:RangePicker$4}=DatePicker$2,ShowingConversionRate=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState("thisMonth"),[o,a]=reactExports.useState(null),l=async()=>{s(!0);try{const e=(e=>{const t=dayjs();switch(e){case"thisWeek":return{start:t.startOf("week").toISOString(),end:t.endOf("week").toISOString(),previousStart:t.subtract(1,"week").startOf("week").toISOString(),previousEnd:t.subtract(1,"week").endOf("week").toISOString()};case"lastWeek":return{start:t.subtract(1,"week").startOf("week").toISOString(),end:t.subtract(1,"week").endOf("week").toISOString(),previousStart:t.subtract(2,"week").startOf("week").toISOString(),previousEnd:t.subtract(2,"week").endOf("week").toISOString()};case"thisMonth":return{start:t.startOf("month").toISOString(),end:t.endOf("month").toISOString(),previousStart:t.subtract(1,"month").startOf("month").toISOString(),previousEnd:t.subtract(1,"month").endOf("month").toISOString()};case"lastMonth":return{start:t.subtract(1,"month").startOf("month").toISOString(),end:t.subtract(1,"month").endOf("month").toISOString(),previousStart:t.subtract(2,"month").startOf("month").toISOString(),previousEnd:t.subtract(2,"month").endOf("month").toISOString()};case"custom":if(o){const[e,t]=o,r=t.diff(e,"day"),s=e.subtract(r,"day"),n=t.subtract(r,"day");return{start:e.toISOString(),end:t.toISOString(),previousStart:s.toISOString(),previousEnd:n.toISOString()}}return{start:t.startOf("month").toISOString(),end:t.endOf("month").toISOString(),previousStart:t.subtract(1,"month").startOf("month").toISOString(),previousEnd:t.subtract(1,"month").endOf("month").toISOString()}}})(n),r={date_start:e.start,date_end:e.end,previous_date_start:e.previousStart,previous_date_end:e.previousEnd},s=await getConversionRateStatsWithActualSales(r),i=c(s);t(i)}catch(e){console.error("获取转化率数据失败:",e)}finally{s(!1)}},c=e=>{const t=new Map;e.forEach(e=>{const r=e.sales_id;t.has(r)||t.set(r,{key:`showing_${r}`,showingsales_id:r,showingsales_name:e.sales_name,showings_count:0,direct_deal_count:0,reserved_count:0,intention_count:0,considering_count:0,lost_count:0,unfilled_count:0,direct_rate:0,conversion_rate:0,previous_showings_count:0,previous_direct_deal_count:0,previous_reserved_count:0,previous_intention_count:0,previous_considering_count:0,previous_lost_count:0,previous_unfilled_count:0,previous_direct_rate:0,previous_conversion_rate:0,children:[]});const s=t.get(r);if(null!==e.actual_sales_id){const t={key:`actual_${e.actual_sales_id}`,showingsales_id:e.actual_sales_id,showingsales_name:e.actual_sales_name||"未知销售",showings_count:e.showings_count,direct_deal_count:e.direct_deal_count,reserved_count:e.reserved_count,intention_count:e.intention_count,considering_count:e.considering_count,lost_count:e.lost_count,unfilled_count:e.unfilled_count,direct_rate:e.direct_rate,conversion_rate:e.conversion_rate,previous_showings_count:e.previous_showings_count,previous_direct_deal_count:e.previous_direct_deal_count,previous_reserved_count:e.previous_reserved_count,previous_intention_count:e.previous_intention_count,previous_considering_count:e.previous_considering_count,previous_lost_count:e.previous_lost_count,previous_unfilled_count:e.previous_unfilled_count,previous_direct_rate:e.previous_direct_rate,previous_conversion_rate:e.previous_conversion_rate};s.children.push(t),s.showings_count+=e.showings_count,s.direct_deal_count+=e.direct_deal_count,s.reserved_count+=e.reserved_count,s.intention_count+=e.intention_count,s.considering_count+=e.considering_count,s.lost_count+=e.lost_count,s.unfilled_count+=e.unfilled_count,s.previous_showings_count+=e.previous_showings_count,s.previous_direct_deal_count+=e.previous_direct_deal_count,s.previous_reserved_count+=e.previous_reserved_count,s.previous_intention_count+=e.previous_intention_count,s.previous_considering_count+=e.previous_considering_count,s.previous_lost_count+=e.previous_lost_count,s.previous_unfilled_count+=e.previous_unfilled_count}else{const t={key:`no_actual_${r}`,showingsales_id:r,showingsales_name:"未分配",showings_count:e.showings_count,direct_deal_count:e.direct_deal_count,reserved_count:e.reserved_count,intention_count:e.intention_count,considering_count:e.considering_count,lost_count:e.lost_count,unfilled_count:e.unfilled_count,direct_rate:e.direct_rate,conversion_rate:e.conversion_rate,previous_showings_count:e.previous_showings_count,previous_direct_deal_count:e.previous_direct_deal_count,previous_reserved_count:e.previous_reserved_count,previous_intention_count:e.previous_intention_count,previous_considering_count:e.previous_considering_count,previous_lost_count:e.previous_lost_count,previous_unfilled_count:e.previous_unfilled_count,previous_direct_rate:e.previous_direct_rate,previous_conversion_rate:e.previous_conversion_rate};s.children.push(t),s.showings_count+=e.showings_count,s.direct_deal_count+=e.direct_deal_count,s.reserved_count+=e.reserved_count,s.intention_count+=e.intention_count,s.considering_count+=e.considering_count,s.lost_count+=e.lost_count,s.unfilled_count+=e.unfilled_count,s.previous_showings_count+=e.previous_showings_count,s.previous_direct_deal_count+=e.previous_direct_deal_count,s.previous_reserved_count+=e.previous_reserved_count,s.previous_intention_count+=e.previous_intention_count,s.previous_considering_count+=e.previous_considering_count,s.previous_lost_count+=e.previous_lost_count,s.previous_unfilled_count+=e.previous_unfilled_count}}),t.forEach(e=>{e.showings_count>0&&(e.direct_rate=e.direct_deal_count/e.showings_count*100,e.conversion_rate=(e.direct_deal_count+e.reserved_count)/e.showings_count*100),e.previous_showings_count>0&&(e.previous_direct_rate=e.previous_direct_deal_count/e.previous_showings_count*100,e.previous_conversion_rate=(e.previous_direct_deal_count+e.previous_reserved_count)/e.previous_showings_count*100)});return Array.from(t.values()).map(e=>(e.children&&e.children.length>0&&e.children.sort((e,t)=>t.showings_count-e.showings_count),e)).sort((e,t)=>t.showings_count-e.showings_count)};reactExports.useEffect(()=>{l()},[n,o]);const u=[{title:"带看管家",dataIndex:"showingsales_name",key:"showingsales_name",width:120,fixed:"left",render:(e,t)=>{const r=t.key.startsWith("actual_")||t.key.startsWith("no_actual_"),s=t.key.startsWith("no_actual_");return jsxRuntimeExports.jsx("span",{style:{color:r?"#666":"#262626",fontWeight:r?"normal":600},children:s?"未分配":e})}},{title:"带看量",dataIndex:"showings_count",key:"showings_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"直签量",dataIndex:"direct_deal_count",key:"direct_deal_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"预定量",dataIndex:"reserved_count",key:"reserved_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"意向金",dataIndex:"intention_count",key:"intention_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"考虑中",dataIndex:"considering_count",key:"considering_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"已流失",dataIndex:"lost_count",key:"lost_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"未填写",dataIndex:"unfilled_count",key:"unfilled_count",width:100,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#000000"},children:e})},{title:"直签率",dataIndex:"direct_rate",key:"direct_rate",width:100,fixed:"right",render:(e,t)=>{const r=j(t.showingsales_id,"direct_rate");return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:600,color:g(e,y)},children:[e.toFixed(1),"%"]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:r.change.startsWith("+")?"#ff4d4f":"#52c41a"},children:r.change})]})}},{title:"成交率",dataIndex:"conversion_rate",key:"conversion_rate",width:100,fixed:"right",render:(e,t)=>{const r=j(t.showingsales_id,"conversion_rate");return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:600,color:g(e,v)},children:[e.toFixed(1),"%"]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:r.change.startsWith("+")?"#ff4d4f":"#52c41a"},children:r.change})]})}}],d=e.reduce((e,t)=>({showings_count:e.showings_count+t.showings_count,direct_deal_count:e.direct_deal_count+t.direct_deal_count,reserved_count:e.reserved_count+t.reserved_count,intention_count:e.intention_count+t.intention_count,considering_count:e.considering_count+t.considering_count,lost_count:e.lost_count+t.lost_count,unfilled_count:e.unfilled_count+t.unfilled_count}),{showings_count:0,direct_deal_count:0,reserved_count:0,intention_count:0,considering_count:0,lost_count:0,unfilled_count:0}),p=e.reduce((e,t)=>({showings_count:e.showings_count+t.previous_showings_count,direct_deal_count:e.direct_deal_count+t.previous_direct_deal_count,reserved_count:e.reserved_count+t.previous_reserved_count,intention_count:e.intention_count+t.previous_intention_count,considering_count:e.considering_count+t.previous_considering_count,lost_count:e.lost_count+t.previous_lost_count,unfilled_count:e.unfilled_count+t.previous_unfilled_count}),{showings_count:0,direct_deal_count:0,reserved_count:0,intention_count:0,considering_count:0,lost_count:0,unfilled_count:0}),m=d.showings_count>0?d.direct_deal_count/d.showings_count*100:0,h=d.showings_count>0?(d.direct_deal_count+d.reserved_count)/d.showings_count*100:0,x=p.showings_count>0?p.direct_deal_count/p.showings_count*100:0,f=p.showings_count>0?(p.direct_deal_count+p.reserved_count)/p.showings_count*100:0,g=(e,t)=>{if(0===t.length)return"#000000";const r=[...t].sort((e,t)=>e-t),s=r[0],n=r[r.length-1];if(n===s)return"#000000";const i=(e-s)/(n-s);return i<=.2?"#389e0d":i>=.8?"#cf1322":"#000000"},y=e.map(e=>e.direct_rate),v=e.map(e=>e.conversion_rate),E=(e,t)=>{if(0===t)return e>0?"+∞":"0%";const r=(e-t)/t*100;return r>0?`+${r.toFixed(1)}%`:`${r.toFixed(1)}%`},j=(t,r)=>{var s,n;const i=(null==(s=e.find(e=>e.showingsales_id===t))?void 0:s[r])||0,o=(null==(n=e.find(e=>e.showingsales_id===t))?void 0:n[`previous_${r}`])||0;return{current:i,previous:o,change:E(i,o)}},b=E(m,x),w=E(h,f);return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:24,padding:"16px 20px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(Text$k,{strong:!0,style:{fontSize:"14px",color:"#262626"},children:"统计周期："}),jsxRuntimeExports.jsx(Text$k,{style:{fontSize:"14px",color:"#595959"},children:(()=>{const e=dayjs();switch(n){case"thisWeek":return`本周 (${e.startOf("week").format("MM/DD")} - ${e.endOf("week").format("MM/DD")})`;case"lastWeek":return`上周 (${e.subtract(1,"week").startOf("week").format("MM/DD")} - ${e.subtract(1,"week").endOf("week").format("MM/DD")})`;case"thisMonth":return`本月 (${e.startOf("month").format("YYYY/MM")})`;case"lastMonth":return`上月 (${e.subtract(1,"month").startOf("month").format("YYYY/MM")})`;case"custom":if(o){const[e,t]=o;return`自定义 (${e.format("MM/DD")} - ${t.format("MM/DD")})`}return`本月 (${e.startOf("month").format("YYYY/MM")})`}})()})]}),jsxRuntimeExports.jsx(RangePicker$4,{value:o,onChange:e=>{e?(a(e),i("custom")):(a(null),i("thisMonth"))},size:"small",style:{width:220},placeholder:["开始日期","结束日期"],allowClear:!0})]}),jsxRuntimeExports.jsx("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:jsxRuntimeExports.jsxs(Radio.Group,{value:n,onChange:e=>i(e.target.value),size:"small",buttonStyle:"solid",children:[jsxRuntimeExports.jsx(Radio.Button,{value:"thisWeek",children:"本周"}),jsxRuntimeExports.jsx(Radio.Button,{value:"lastWeek",children:"上周"}),jsxRuntimeExports.jsx(Radio.Button,{value:"thisMonth",children:"本月"}),jsxRuntimeExports.jsx(Radio.Button,{value:"lastMonth",children:"上月"})]})})]})}),r?jsxRuntimeExports.jsx(LoadingScreen,{type:"data"}):jsxRuntimeExports.jsx(ForwardTable,{columns:u,dataSource:e,rowKey:"key",size:"small",pagination:!1,scroll:{x:1e3,y:400},expandable:{defaultExpandAllRows:!0,rowExpandable:e=>!e.key.startsWith("actual_")&&!e.key.startsWith("no_actual_")&&Boolean(e.children&&e.children.length>0)},summary:()=>jsxRuntimeExports.jsxs(ForwardTable.Summary.Row,{style:{backgroundColor:"#e6f7ff",fontWeight:600,position:"sticky",bottom:0,zIndex:1},children:[jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:0,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:"总计"})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:1,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.showings_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:2,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.direct_deal_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:3,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.reserved_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:4,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.intention_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:5,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.considering_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:6,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.lost_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:7,children:jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:d.unfilled_count})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:8,children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:600,color:"#1890ff"},children:[m.toFixed(1),"%"]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:b.startsWith("+")?"#ff4d4f":"#52c41a"},children:b})]})}),jsxRuntimeExports.jsx(ForwardTable.Summary.Cell,{index:9,children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:600,color:"#1890ff"},children:[h.toFixed(1),"%"]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:w.startsWith("+")?"#ff4d4f":"#52c41a"},children:w})]})})]})})]})},{Text:Text$j,Title:Title$g}=Typography,SessionTimeoutWarning=({isVisible:e,timeRemaining:t,onExtend:r,onLogout:s})=>{const[n,i]=reactExports.useState(t),[o,a]=reactExports.useState(!1);reactExports.useEffect(()=>{if(!e)return;const t=setInterval(()=>{i(e=>{const t=e-1e3;return t<=0?(s(),0):t})},1e3);return()=>{clearInterval(t)}},[e,s,t]),reactExports.useEffect(()=>{Math.abs(n-t)>5e3&&i(t)},[t,n]);const l=(t-n)/t*100;return jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$b,{style:{color:"#faad14"}}),jsxRuntimeExports.jsx("span",{children:"会话即将过期"})]}),open:e,footer:null,closable:!1,maskClosable:!1,width:400,centered:!0,children:jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[jsxRuntimeExports.jsxs(Title$g,{level:4,style:{marginBottom:16},children:["您的会话将在 ",(c=n,`${Math.floor(c/6e4)}:${Math.floor(c%6e4/1e3).toString().padStart(2,"0")}`)," 后过期"]}),jsxRuntimeExports.jsx("div",{style:{marginBottom:20},children:jsxRuntimeExports.jsx(Progress,{percent:l,status:"exception",strokeColor:{"0%":"#108ee9","100%":"#ff4d4f"},showInfo:!1})}),jsxRuntimeExports.jsx(Text$j,{type:"secondary",style:{display:"block",marginBottom:24},children:'为了您的账户安全，系统将在无操作30分钟后自动登出。 您可以点击"继续使用"来延长会话时间。'}),jsxRuntimeExports.jsxs(Space$1,{size:"middle",children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$9,{}),loading:o,onClick:async()=>{a(!0);try{await r()}catch(e){}finally{a(!1)}},size:"large",children:"继续使用"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{s()},size:"large",children:"立即登出"})]})]})});var c},safeParseJWT=e=>{try{const t=e.split(".");if(3!==t.length)return null;const r=t[1],s=r+"=".repeat((4-r.length%4)%4),n=atob(s);return JSON.parse(n)}catch(t){return console.warn("JWT解析失败:",t),null}},_TokenManager=class e{constructor(){__publicField(this,"state"),__publicField(this,"config"),__publicField(this,"refreshTimer",null),__publicField(this,"listeners",new Set),__publicField(this,"lastNotifyTime",0),this.state={isRefreshing:!1,lastRefreshTime:0,retryCount:0,lastActivityTime:Date.now()},this.config={refreshThresholdMs:3e5,maxRetryAttempts:3,retryDelayMs:5e3,checkIntervalMs:3e5}}static getInstance(){return e.instance||(e.instance=new e),e.instance}async getSession(){try{const{data:{session:e},error:t}=await supabase.auth.getSession();return t?(console.error("获取会话失败:",t),{session:null,error:t}):{session:e,error:null}}catch(e){return console.error("获取会话异常:",e),{session:null,error:e}}}async getUser(){try{const{data:{user:e},error:t}=await supabase.auth.getUser();return t?(console.error("获取用户失败:",t),{user:null,error:t}):{user:e,error:null}}catch(e){return console.error("获取用户异常:",e),{user:null,error:e}}}async signInWithPassword(e,t){var r;try{console.log("开始密码登录:",e);const{data:s,error:n}=await supabase.auth.signInWithPassword({email:e,password:t});return n?(console.error("密码登录失败:",n),{data:null,error:n}):(console.log("密码登录成功:",null==(r=null==s?void 0:s.user)?void 0:r.id),(null==s?void 0:s.user)&&this.notifyListeners("SIGNED_IN",{user:s.user}),{data:s,error:null})}catch(s){return console.error("密码登录异常:",s),{data:null,error:s}}}async verifyOtp(e,t,r){try{const{data:s,error:n}=await supabase.auth.verifyOtp({email:e,token:t,type:r});return n?(console.error("验证OTP失败:",n),{data:null,error:n}):{data:s,error:null}}catch(s){return console.error("验证OTP异常:",s),{data:null,error:s}}}async setSession(e,t){try{const{data:r,error:s}=await supabase.auth.setSession({access_token:e,refresh_token:t||""});return s?(console.error("设置会话失败:",s),{data:null,error:s}):{data:r,error:null}}catch(r){return console.error("设置会话异常:",r),{data:null,error:r}}}async updateUser(e){try{const{data:t,error:r}=await supabase.auth.updateUser(e);return r?(console.error("更新用户失败:",r),{data:null,error:r}):{data:t,error:null}}catch(t){return console.error("更新用户异常:",t),{data:null,error:t}}}async resetPasswordForEmail(e,t){try{const{error:r}=await supabase.auth.resetPasswordForEmail(e,{redirectTo:t});return r?(console.error("发送密码重置邮件失败:",r),{error:r}):{error:null}}catch(r){return console.error("发送密码重置邮件异常:",r),{error:r}}}async signUp(e,t){try{const{data:r,error:s}=await supabase.auth.signUp({email:e,password:t});return s?(console.error("用户注册失败:",s),{data:null,error:s}):{data:r,error:null}}catch(r){return console.error("用户注册异常:",r),{data:null,error:r}}}isTokenValid(e){try{const t=e.split(".");if(3!==t.length)return!1;const r=t[1],s=r+"=".repeat((4-r.length%4)%4),n=atob(s),i=JSON.parse(n),o=Math.floor(Date.now()/1e3);return i.exp>o}catch{return!1}}async smartTokenRefresh(){const e=Date.now();if(e-this.state.lastRefreshTime<6e4)return{success:!0,skipped:!0};if(this.state.isRefreshing)return{success:!0,skipped:!0};try{this.state.isRefreshing=!0;const{session:t,error:r}=await this.getSession();if(r)throw r;if(!(null==t?void 0:t.expires_at))return{success:!1,error:"无有效会话"};const s=new Date(t.expires_at);if(s.getTime()-e<=this.config.refreshThresholdMs){console.log("Token即将过期，开始刷新...");const{error:t}=await supabase.auth.refreshSession();if(t)throw t;return this.state.lastRefreshTime=e,this.state.retryCount=0,console.log("Token刷新成功"),{success:!0,refreshed:!0}}return{success:!0,skipped:!0}}catch(t){return this.state.retryCount++,console.error("Token刷新失败:",t),this.state.retryCount>=this.config.maxRetryAttempts&&(console.error("Token刷新重试次数过多，执行登出"),await this.logout()),{success:!1,error:t instanceof Error?t.message:"刷新失败"}}finally{this.state.isRefreshing=!1}}async logout(e){try{console.log("开始执行统一退出登录..."),this.clearAllLocalStorage(),await supabase.auth.signOut(),this.resetInternalState(),this.notifyListeners("SIGNED_OUT",null),this.redirectToLogin(e),console.log("退出登录完成")}catch(t){console.error("退出登录失败:",t),this.redirectToLogin(e)}}clearAllLocalStorage(){try{localStorage.removeItem("last_activity_timestamp"),localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("supabase.auth.expires_at"),localStorage.removeItem("supabase.auth.refresh_token"),localStorage.removeItem("supabase.auth.access_token"),localStorage.removeItem("user_profile"),localStorage.removeItem("user_permissions"),localStorage.removeItem("user_session"),localStorage.removeItem("user_avatar_url"),localStorage.removeItem("user_nickname"),localStorage.removeItem("app_notifications"),localStorage.removeItem("app_theme"),localStorage.removeItem("app_language");const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&(r.includes("user")||r.includes("auth")||r.includes("session")||r.includes("token")||r.includes("profile")||r.includes("permission"))&&e.push(r)}e.forEach(e=>{localStorage.removeItem(e)}),console.log("本地存储清理完成")}catch(e){console.error("清除本地存储失败:",e)}}resetInternalState(){this.state={isRefreshing:!1,lastRefreshTime:0,retryCount:0,lastActivityTime:0},this.stopAutoRefresh(),console.log("内部状态重置完成")}redirectToLogin(e){try{e&&"function"==typeof e?(e("/login",{replace:!0}),console.log("使用React Router跳转到登录页")):(window.location.href="/login",console.log("使用页面刷新跳转到登录页"))}catch(t){console.error("跳转到登录页失败:",t),window.location.href="/login"}}async safeSignOut(e){return this.logout(e)}updateActivity(){this.state.lastActivityTime=Date.now(),localStorage.setItem("last_activity_timestamp",this.state.lastActivityTime.toString())}addAuthStateListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(e,t){this.lastNotifyTime&&Date.now()-this.lastNotifyTime<1e3||(this.lastNotifyTime=Date.now(),this.listeners.forEach(r=>{try{r(e,t)}catch(s){console.error("认证状态监听器执行失败:",s)}}))}startAutoRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=setInterval(async()=>{try{(await this.smartTokenRefresh()).refreshed&&console.log("自动Token刷新完成")}catch(e){console.error("自动Token刷新失败:",e)}},this.config.checkIntervalMs);const{data:{subscription:e}}=supabase.auth.onAuthStateChange((e,t)=>{setTimeout(()=>{"SIGNED_IN"!==e&&"SIGNED_OUT"!==e&&"TOKEN_REFRESHED"!==e||this.notifyListeners(e,t),"SIGNED_IN"!==e&&"TOKEN_REFRESHED"!==e||this.updateActivity(),"TOKEN_REFRESHED"===e&&(console.log("收到Token刷新事件"),this.state.lastRefreshTime=Date.now(),this.state.retryCount=0)},10)}),t=["mousedown","mousemove","keypress","scroll","touchstart","click"],r=()=>this.updateActivity();return t.forEach(e=>{document.addEventListener(e,r,{passive:!0})}),()=>{this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),e.unsubscribe(),t.forEach(e=>{document.removeEventListener(e,r)})}}stopAutoRefresh(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}getState(){return{...this.state}}getConfig(){return{...this.config}}async getTokenStatus(){try{const{session:e}=await this.getSession();if(!(null==e?void 0:e.expires_at))return{hasSession:!1,isRefreshing:this.state.isRefreshing,lastRefreshTime:this.state.lastRefreshTime,retryCount:this.state.retryCount};const t=new Date(e.expires_at).getTime()-Date.now();return{hasSession:!0,expiresAt:e.expires_at?String(e.expires_at):void 0,timeUntilExpiry:t,isRefreshing:this.state.isRefreshing,lastRefreshTime:this.state.lastRefreshTime,retryCount:this.state.retryCount}}catch(e){return console.error("获取Token状态失败:",e),{hasSession:!1,isRefreshing:this.state.isRefreshing,lastRefreshTime:this.state.lastRefreshTime,retryCount:this.state.retryCount}}}async checkAuthStatus(){try{const{session:e,error:t}=await this.getSession();if(t)return{isValid:!1,error:"无有效会话"};if(!e)return{isValid:!1,error:"无有效会话"};const{user:r,error:s}=await this.getUser();return s?{isValid:!1,error:"用户信息无效"}:r?{isValid:!0,user:r}:{isValid:!1,error:"用户信息无效"}}catch(e){return console.error("TokenManager: 认证状态检查异常",e),{isValid:!1,error:"认证检查异常"}}}async ensureValidToken(){try{const e=await this.smartTokenRefresh();return e.success?{success:!0}:{success:!1,error:e.error}}catch(e){return console.error("确保Token有效失败:",e),{success:!1,error:e instanceof Error?e.message:"Token验证失败"}}}async resetAuthState(){try{localStorage.removeItem("last_activity_timestamp"),localStorage.removeItem("supabase.auth.token"),this.state.lastRefreshTime=0,this.state.lastActivityTime=0,this.state.retryCount=0,this.notifyListeners("SIGNED_OUT",null)}catch(e){console.error("TokenManager: 重置认证状态失败",e)}}};__publicField(_TokenManager,"instance");let TokenManager=_TokenManager;const tokenManager=TokenManager.getInstance();tokenManager.testLogout=async function(e){console.log("测试登出功能..."),console.log("当前localStorage项目数量:",localStorage.length);const t=[];for(let r=0;r<localStorage.length;r++){const e=localStorage.key(r);e&&t.push(e)}console.log("当前localStorage项目:",t),await this.logout(e)},tokenManager.testTokenStatus=async function(){console.log("测试Token状态...");const e=await this.getTokenStatus();console.log("Token状态:",e);const t=this.getConfig();console.log("Token配置:",t);const r=this.getState();console.log("Token状态:",r)},tokenManager.testTokenRefresh=async function(){console.log("测试手动Token刷新...");const e=await this.smartTokenRefresh();console.log("Token刷新结果:",e)};const UserContext=reactExports.createContext(void 0),SESSION_TIMEOUT=18e5,WARNING_THRESHOLD=3e5,UserProvider=({children:e})=>{const[t,r]=reactExports.useState(null),[s,n]=reactExports.useState(null),[i,o]=reactExports.useState(null),[a,l]=reactExports.useState(null),[c,u]=reactExports.useState(SESSION_TIMEOUT),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState(!0),[x,f]=reactExports.useState(!1),g=reactExports.useRef(new Map);reactExports.useRef(t).current=t;const y=reactExports.useCallback(async()=>{try{await tokenManager.logout(),r(null),n(null),o(null),u(0),p(!1)}catch(e){console.error("登出失败:",e)}},[]),v=reactExports.useCallback(()=>{const e=localStorage.getItem("last_activity_timestamp"),t=Date.now();if(!e)return void y();const r=t-parseInt(e),s=Math.max(0,SESSION_TIMEOUT-r);if(u(s),r>SESSION_TIMEOUT)return void y();p(s<=WARNING_THRESHOLD&&s>0)},[y]),E=reactExports.useCallback(()=>{localStorage.setItem("last_activity_timestamp",Date.now().toString()),p(!1),u(SESSION_TIMEOUT)},[]),j=reactExports.useCallback(()=>{localStorage.setItem("last_activity_timestamp",Date.now().toString()),d&&p(!1)},[d]);reactExports.useEffect(()=>{const e=["mousedown","mousemove","keypress","scroll","touchstart","click"],t=()=>{j()};return e.forEach(e=>{document.addEventListener(e,t,!0)}),()=>{e.forEach(e=>{document.removeEventListener(e,t,!0)})}},[j]),reactExports.useEffect(()=>{const e=setInterval(()=>{v()},6e4);return()=>clearInterval(e)},[v]);const b=reactExports.useCallback(async()=>{var e,s,i,a,c,u,d,p;if(!m||t)try{h(!0),l(null);const t=await tokenManager.checkAuthStatus();if(!t.isValid)return console.warn("认证状态无效:",t.error),t.error&&t.error.includes("does not exist")&&(console.log("检测到JWT用户不存在错误，清理认证状态..."),await tokenManager.resetAuthState()),r(null),n(null),o(null),l(null),void h(!1);const m=t.user;if(m){r(m),f(!0);try{const{data:t,error:r}=await supabase.from("users_profile").select("*").eq("user_id",m.id).order("created_at",{ascending:!1}).limit(1).single();if(r)if("PGRST116"===r.code){console.log("用户profile不存在，正在创建...");try{const{data:t,error:r}=await supabase.from("users_profile").insert({user_id:m.id,email:m.email,nickname:(null==(e=m.user_metadata)?void 0:e.full_name)||(null==(s=m.email)?void 0:s.split("@")[0])||"用户",status:"active"}).select().single();r?(console.error("创建profile失败:",r),l(`创建用户档案失败: ${r.message}`),n({id:0,user_id:m.id,nickname:(null==(i=m.user_metadata)?void 0:i.full_name)||(null==(a=m.email)?void 0:a.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0})):(console.log("成功创建用户profile:",t),n(t))}catch(x){console.error("创建profile异常:",x),l(`创建用户档案异常: ${x}`),n({id:0,user_id:m.id,nickname:(null==(c=m.user_metadata)?void 0:c.full_name)||(null==(u=m.email)?void 0:u.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0})}}else l(r.message),n({id:0,user_id:m.id,nickname:(null==(d=m.user_metadata)?void 0:d.full_name)||(null==(p=m.email)?void 0:p.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0});else{n(t);try{const{data:{session:e}}=await supabase.auth.getSession();let t=!1;if(null==e?void 0:e.access_token){const r=safeParseJWT(e.access_token);t="service_role"===(null==r?void 0:r.role)}const{data:r}=await supabase.rpc("get_user_roles",{p_user_id:m.id}),s=r||[],n=s.some(e=>"admin"===e.role_name)||!1;let i=[];if(t||n){const{data:e}=await supabase.from("organizations").select("id").order("name");i=(null==e?void 0:e.map(e=>e.id))||[]}else{const{data:e}=await supabase.rpc("get_managed_org_ids",{admin_id:m.id});e&&e.length>0&&(i=e.map(e=>e.org_id))}const a={manageableOrganizations:i,isSuperAdmin:t,isDepartmentAdmin:i.length>0,userRoles:s};o(a)}catch(g){console.error("获取权限信息失败:",g),o(null)}}}finally{f(!1)}}else r(null),n(null),o(null),f(!1)}catch(y){console.error("refreshUser: 刷新失败",y),l(y instanceof Error?y.message:"获取用户信息失败"),r(null),n(null),o(null),h(!1)}},[]),w=reactExports.useCallback(()=>{localStorage.removeItem("last_activity_timestamp")},[]),R=reactExports.useCallback(async e=>{const t=Date.now(),r=g.current.get(e);if(r&&t-r.timestamp<3e5)return r.data;try{const{data:r}=await supabase.from("users_profile").select("nickname, email").eq("id",e).single(),s={displayName:(null==r?void 0:r.nickname)||(null==r?void 0:r.email)||"未知用户",nickname:null==r?void 0:r.nickname,email:null==r?void 0:r.email};return g.current.set(e,{data:s,timestamp:t}),s}catch(s){return console.error("获取用户信息失败:",s),{displayName:"未知用户"}}},[]),_=reactExports.useCallback(()=>{g.current.clear()},[]);reactExports.useEffect(()=>{(async()=>{var e,t,s,i,a,l;try{const d=await tokenManager.checkAuthStatus();if(d.isValid&&d.user){r(d.user),f(!0);try{const{data:r,error:o}=await supabase.from("users_profile").select("*").eq("user_id",d.user.id).order("created_at",{ascending:!1}).limit(1).single();if(o){if("PGRST116"===o.code){console.log("初始化时用户profile不存在，正在创建...");try{const{data:r,error:o}=await supabase.from("users_profile").insert({user_id:d.user.id,email:d.user.email,nickname:(null==(e=d.user.user_metadata)?void 0:e.full_name)||(null==(t=d.user.email)?void 0:t.split("@")[0])||"用户",status:"active"}).select().single();!o&&r?(console.log("初始化时成功创建用户profile:",r),n(r)):o&&(console.error("初始化时创建profile失败:",o),n({id:0,user_id:d.user.id,nickname:(null==(s=d.user.user_metadata)?void 0:s.full_name)||(null==(i=d.user.email)?void 0:i.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0}))}catch(c){console.error("初始化时创建profile异常:",c),n({id:0,user_id:d.user.id,nickname:(null==(a=d.user.user_metadata)?void 0:a.full_name)||(null==(l=d.user.email)?void 0:l.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0})}}}else r&&n(r)}catch(u){console.error("初始化时获取profile失败:",u)}finally{f(!1),h(!1)}}else d.error&&d.error.includes("does not exist")&&(console.log("初始化时检测到JWT用户不存在错误，清理认证状态..."),await tokenManager.resetAuthState()),r(null),n(null),o(null),h(!1)}catch(d){console.error("初始化用户状态失败:",d),r(null),n(null),o(null),h(!1)}})();const e=tokenManager.startAutoRefresh(),t=tokenManager.addAuthStateListener((e,t)=>{if("SIGNED_IN"===e&&(null==t?void 0:t.user)){r(t.user),f(!0);(async()=>{var e,r,s,i,o,a;try{const{data:c,error:u}=await supabase.from("users_profile").select("*").eq("user_id",t.user.id).order("created_at",{ascending:!1}).limit(1).single();if(u){if("PGRST116"===u.code){console.log("登录时用户profile不存在，正在创建...");try{const{data:o,error:a}=await supabase.from("users_profile").insert({user_id:t.user.id,email:t.user.email,nickname:(null==(e=t.user.user_metadata)?void 0:e.full_name)||(null==(r=t.user.email)?void 0:r.split("@")[0])||"用户",status:"active"}).select().single();!a&&o?(console.log("登录时成功创建用户profile:",o),n(o)):a&&(console.error("登录时创建profile失败:",a),n({id:0,user_id:t.user.id,nickname:(null==(s=t.user.user_metadata)?void 0:s.full_name)||(null==(i=t.user.email)?void 0:i.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0}))}catch(l){console.error("登录时创建profile异常:",l),n({id:0,user_id:t.user.id,nickname:(null==(o=t.user.user_metadata)?void 0:o.full_name)||(null==(a=t.user.email)?void 0:a.split("@")[0])||"用户",avatar_url:void 0,password_set:void 0})}}}else c&&n(c)}catch(c){console.error("获取用户profile失败:",c)}finally{f(!1),h(!1)}})()}else"SIGNED_OUT"===e&&(r(null),n(null),o(null),u(0),p(!1))});return()=>{t(),e()}},[]);const S={user:t,profile:s,permissions:i,loading:m,profileLoading:x,error:a,refreshUser:b,clearUserCache:w,sessionTimeRemaining:c,isSessionExpired:c<=0,getCachedUserInfo:R,clearUserInfoCache:_};return jsxRuntimeExports.jsxs(UserContext.Provider,{value:S,children:[e,jsxRuntimeExports.jsx(SessionTimeoutWarning,{isVisible:d,timeRemaining:c,onExtend:E,onLogout:y})]})},useUser=()=>{const e=reactExports.useContext(UserContext);if(void 0===e)throw new Error("useUser must be used within a UserProvider");return e};function _mergeNamespaces(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if("default"!==r&&!(r in e)){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(e)}function copyExifWithoutOrientation(e,t){return new Promise(function(r,s){let n;return getApp1Segment(e).then(function(e){try{return n=e,r(new Blob([t.slice(0,2),n,t.slice(2)],{type:"image/jpeg"}))}catch(i){return s(i)}},s)})}const getApp1Segment=e=>new Promise((t,r)=>{const s=new FileReader;s.addEventListener("load",({target:{result:e}})=>{const s=new DataView(e);let n=0;if(65496!==s.getUint16(n))return r("not a valid JPEG");for(n+=2;;){const i=s.getUint16(n);if(65498===i)break;const o=s.getUint16(n+2);if(65505===i&&1165519206===s.getUint32(n+4)){const i=n+10;let a;switch(s.getUint16(i)){case 18761:a=!0;break;case 19789:a=!1;break;default:return r("TIFF header contains invalid endian")}if(42!==s.getUint16(i+2,a))return r("TIFF header contains invalid version");const l=s.getUint32(i+4,a),c=i+l+2+12*s.getUint16(i+l,a);for(let e=i+l+2;e<c;e+=12)if(274==s.getUint16(e,a)){if(3!==s.getUint16(e+2,a))return r("Orientation data type is invalid");if(1!==s.getUint32(e+4,a))return r("Orientation data count is invalid");s.setUint16(e+8,1,a);break}return t(e.slice(n,n+2+o))}n+=2+o}return t(new Blob)}),s.readAsArrayBuffer(e)});var e$1={},t={get exports(){return e$1},set exports(e){e$1=e}};!function(e){var r,s,n={};t.exports=n,n.parse=function(e,t){for(var r=n.bin.readUshort,s=n.bin.readUint,i=0,o={},a=new Uint8Array(e),l=a.length-4;101010256!=s(a,l);)l--;i=l,i+=4;var c=r(a,i+=4);r(a,i+=2);var u=s(a,i+=2),d=s(a,i+=4);i+=4,i=d;for(var p=0;p<c;p++){s(a,i),i+=4,i+=4,i+=4,s(a,i+=4),u=s(a,i+=4);var m=s(a,i+=4),h=r(a,i+=4),x=r(a,i+2),f=r(a,i+4);i+=6;var g=s(a,i+=8);i+=4,i+=h+x+f,n._readLocal(a,g,o,u,m,t)}return o},n._readLocal=function(e,t,r,s,i,o){var a=n.bin.readUshort,l=n.bin.readUint;l(e,t),a(e,t+=4),a(e,t+=2);var c=a(e,t+=2);l(e,t+=2),l(e,t+=4),t+=4;var u=a(e,t+=8),d=a(e,t+=2);t+=2;var p=n.bin.readUTF8(e,t,u);if(t+=u,t+=d,o)r[p]={size:i,csize:s};else{var m=new Uint8Array(e.buffer,t);if(0==c)r[p]=new Uint8Array(m.buffer.slice(t,t+s));else{if(8!=c)throw"unknown compression method: "+c;var h=new Uint8Array(i);n.inflateRaw(m,h),r[p]=h}}},n.inflateRaw=function(e,t){return n.F.inflate(e,t)},n.inflate=function(e,t){return e[0],e[1],n.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},n.deflate=function(e,t){null==t&&(t={level:6});var r=0,s=new Uint8Array(50+Math.floor(1.1*e.length));s[r]=120,s[r+1]=156,r+=2,r=n.F.deflateRaw(e,s,r,t.level);var i=n.adler(e,0,e.length);return s[r+0]=i>>>24&255,s[r+1]=i>>>16&255,s[r+2]=i>>>8&255,s[r+3]=i>>>0&255,new Uint8Array(s.buffer,0,r+4)},n.deflateRaw=function(e,t){null==t&&(t={level:6});var r=new Uint8Array(50+Math.floor(1.1*e.length)),s=n.F.deflateRaw(e,r,s,t.level);return new Uint8Array(r.buffer,0,s)},n.encode=function(e,t){null==t&&(t=!1);var r=0,s=n.bin.writeUint,i=n.bin.writeUshort,o={};for(var a in e){var l=!n._noNeed(a)&&!t,c=e[a],u=n.crc.crc(c,0,c.length);o[a]={cpr:l,usize:c.length,crc:u,file:l?n.deflateRaw(c):c}}for(var a in o)r+=o[a].file.length+30+46+2*n.bin.sizeUTF8(a);r+=22;var d=new Uint8Array(r),p=0,m=[];for(var a in o){var h=o[a];m.push(p),p=n._writeHeader(d,p,a,h,0)}var x=0,f=p;for(var a in o)h=o[a],m.push(p),p=n._writeHeader(d,p,a,h,1,m[x++]);var g=p-f;return s(d,p,101010256),p+=4,i(d,p+=4,x),i(d,p+=2,x),s(d,p+=2,g),s(d,p+=4,f),p+=4,p+=2,d.buffer},n._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},n._writeHeader=function(e,t,r,s,i,o){var a=n.bin.writeUint,l=n.bin.writeUshort,c=s.file;return a(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),l(e,t,20),l(e,t+=2,0),l(e,t+=2,s.cpr?8:0),a(e,t+=2,0),a(e,t+=4,s.crc),a(e,t+=4,c.length),a(e,t+=4,s.usize),l(e,t+=4,n.bin.sizeUTF8(r)),l(e,t+=2,0),t+=2,1==i&&(t+=2,t+=2,a(e,t+=6,o),t+=4),t+=n.bin.writeUTF8(e,t,r),0==i&&(e.set(c,t),t+=c.length),t},n.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,s=0;s<8;s++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,s){for(var i=0;i<s;i++)e=n.crc.table[255&(e^t[r+i])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^n.crc.update(4294967295,e,t,r)}},n.adler=function(e,t,r){for(var s=1,n=0,i=t,o=t+r;i<o;){for(var a=Math.min(i+5552,o);i<a;)n+=s+=e[i++];s%=65521,n%=65521}return n<<16|s},n.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255},readASCII:function(e,t,r){for(var s="",n=0;n<r;n++)s+=String.fromCharCode(e[t+n]);return s},writeASCII:function(e,t,r){for(var s=0;s<r.length;s++)e[t+s]=r.charCodeAt(s)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var s,i="",o=0;o<r;o++)i+="%"+n.bin.pad(e[t+o].toString(16));try{s=decodeURIComponent(i)}catch(a){return n.bin.readASCII(e,t,r)}return s},writeUTF8:function(e,t,r){for(var s=r.length,n=0,i=0;i<s;i++){var o=r.charCodeAt(i);if(4294967168&o)if(4294965248&o)if(4294901760&o){if(4292870144&o)throw"e";e[t+n]=240|o>>18,e[t+n+1]=128|o>>12&63,e[t+n+2]=128|o>>6&63,e[t+n+3]=128|63&o,n+=4}else e[t+n]=224|o>>12,e[t+n+1]=128|o>>6&63,e[t+n+2]=128|63&o,n+=3;else e[t+n]=192|o>>6,e[t+n+1]=128|63&o,n+=2;else e[t+n]=o,n++}return n},sizeUTF8:function(e){for(var t=e.length,r=0,s=0;s<t;s++){var n=e.charCodeAt(s);if(4294967168&n)if(4294965248&n)if(4294901760&n){if(4292870144&n)throw"e";r+=4}else r+=3;else r+=2;else r++}return r}},n.F={},n.F.deflateRaw=function(e,t,r,s){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][s],o=n.F.U,a=n.F._goodIndex;n.F._hash;var l=n.F._putsE,c=0,u=r<<3,d=0,p=e.length;if(0==s){for(;c<p;)l(t,u,c+(R=Math.min(65535,p-c))==p?1:0),u=n.F._copyExact(e,c,R,t,u+8),c+=R;return u>>>3}var m=o.lits,h=o.strt,x=o.prev,f=0,g=0,y=0,v=0,E=0,j=0;for(p>2&&(h[j=n.F._hash(e,0)]=0),c=0;c<p;c++){if(E=j,c+1<p-2){j=n.F._hash(e,c+1);var b=c+1&32767;x[b]=h[j],h[j]=b}if(d<=c){(f>14e3||g>26697)&&p-c>100&&(d<c&&(m[f]=c-d,f+=2,d=c),u=n.F._writeBlock(c==p-1||d==p?1:0,m,f,v,e,y,c-y,t,u),f=g=v=0,y=c);var w=0;c<p-2&&(w=n.F._bestMatch(e,c,x,E,Math.min(i[2],p-c),i[3]));var R=w>>>16,_=65535&w;if(0!=w){_=65535&w;var S=a(R=w>>>16,o.of0);o.lhst[257+S]++;var C=a(_,o.df0);o.dhst[C]++,v+=o.exb[S]+o.dxb[C],m[f]=R<<23|c-d,m[f+1]=_<<16|S<<8|C,f+=2,d=c+R}else o.lhst[e[c]]++;g++}}for(y==c&&0!=e.length||(d<c&&(m[f]=c-d,f+=2,d=c),u=n.F._writeBlock(1,m,f,v,e,y,c-y,t,u),f=0,g=0,f=g=v=0,y=c);7&u;)u++;return u>>>3},n.F._bestMatch=function(e,t,r,s,i,o){var a=32767&t,l=r[a],c=a-l+32768&32767;if(l==a||s!=n.F._hash(e,t-c))return 0;for(var u=0,d=0,p=Math.min(32767,t);c<=p&&0!=--o&&l!=a;){if(0==u||e[t+u]==e[t+u-c]){var m=n.F._howLong(e,t,c);if(m>u){if(d=c,(u=m)>=i)break;c+2<m&&(m=c+2);for(var h=0,x=0;x<m-2;x++){var f=t-c+x+32768&32767,g=f-r[f]+32768&32767;g>h&&(h=g,l=f)}}}c+=(a=l)-(l=r[a])+32768&32767}return u<<16|d},n.F._howLong=function(e,t,r){if(e[t]!=e[t-r]||e[t+1]!=e[t+1-r]||e[t+2]!=e[t+2-r])return 0;var s=t,n=Math.min(e.length,t+258);for(t+=3;t<n&&e[t]==e[t-r];)t++;return t-s},n.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(e,t,r,s,i,o,a,l,c){var u,d,p,m,h,x,f,g,y,v=n.F.U,E=n.F._putsF,j=n.F._putsE;v.lhst[256]++,d=(u=n.F.getTrees())[0],p=u[1],m=u[2],h=u[3],x=u[4],f=u[5],g=u[6],y=u[7];var b=32+(c+3&7?8-(c+3&7):0)+(a<<3),w=s+n.F.contSize(v.fltree,v.lhst)+n.F.contSize(v.fdtree,v.dhst),R=s+n.F.contSize(v.ltree,v.lhst)+n.F.contSize(v.dtree,v.dhst);R+=14+3*f+n.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var _=0;_<286;_++)v.lhst[_]=0;for(_=0;_<30;_++)v.dhst[_]=0;for(_=0;_<19;_++)v.ihst[_]=0;var S=b<w&&b<R?0:w<R?1:2;if(E(l,c,e),E(l,c+1,S),c+=3,0==S){for(;7&c;)c++;c=n.F._copyExact(i,o,a,l,c)}else{var C,k;if(1==S&&(C=v.fltree,k=v.fdtree),2==S){n.F.makeCodes(v.ltree,d),n.F.revCodes(v.ltree,d),n.F.makeCodes(v.dtree,p),n.F.revCodes(v.dtree,p),n.F.makeCodes(v.itree,m),n.F.revCodes(v.itree,m),C=v.ltree,k=v.dtree,j(l,c,h-257),j(l,c+=5,x-1),j(l,c+=5,f-4),c+=4;for(var $=0;$<f;$++)j(l,c+3*$,v.itree[1+(v.ordr[$]<<1)]);c+=3*f,c=n.F._codeTiny(g,v.itree,l,c),c=n.F._codeTiny(y,v.itree,l,c)}for(var T=o,I=0;I<r;I+=2){for(var P=t[I],A=P>>>23,F=T+(8388607&P);T<F;)c=n.F._writeLit(i[T++],C,l,c);if(0!=A){var M=t[I+1],D=M>>16,O=M>>8&255,N=255&M;j(l,c=n.F._writeLit(257+O,C,l,c),A-v.of0[O]),c+=v.exb[O],E(l,c=n.F._writeLit(N,k,l,c),D-v.df0[N]),c+=v.dxb[N],T+=A}}c=n.F._writeLit(256,C,l,c)}return c},n.F._copyExact=function(e,t,r,s,n){var i=n>>>3;return s[i]=r,s[i+1]=r>>>8,s[i+2]=255-s[i],s[i+3]=255-s[i+1],i+=4,s.set(new Uint8Array(e.buffer,t,r),i),n+(r+4<<3)},n.F.getTrees=function(){for(var e=n.F.U,t=n.F._hufTree(e.lhst,e.ltree,15),r=n.F._hufTree(e.dhst,e.dtree,15),s=[],i=n.F._lenCodes(e.ltree,s),o=[],a=n.F._lenCodes(e.dtree,o),l=0;l<s.length;l+=2)e.ihst[s[l]]++;for(l=0;l<o.length;l+=2)e.ihst[o[l]]++;for(var c=n.F._hufTree(e.ihst,e.itree,7),u=19;u>4&&0==e.itree[1+(e.ordr[u-1]<<1)];)u--;return[t,r,c,i,a,u,s,o]},n.F.getSecond=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(e[r+1]);return t},n.F.nonZero=function(e){for(var t="",r=0;r<e.length;r+=2)0!=e[r+1]&&(t+=(r>>1)+",");return t},n.F.contSize=function(e,t){for(var r=0,s=0;s<t.length;s++)r+=t[s]*e[1+(s<<1)];return r},n.F._codeTiny=function(e,t,r,s){for(var i=0;i<e.length;i+=2){var o=e[i],a=e[i+1];s=n.F._writeLit(o,t,r,s);var l=16==o?2:17==o?3:7;o>15&&(n.F._putsE(r,s,a,l),s+=l)}return s},n.F._lenCodes=function(e,t){for(var r=e.length;2!=r&&0==e[r-1];)r-=2;for(var s=0;s<r;s+=2){var n=e[s+1],i=s+3<r?e[s+3]:-1,o=s+5<r?e[s+5]:-1,a=0==s?-1:e[s-1];if(0==n&&i==n&&o==n){for(var l=s+5;l+2<r&&e[l+2]==n;)l+=2;(c=Math.min(l+1-s>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),s+=2*c-2}else if(n==a&&i==n&&o==n){for(l=s+5;l+2<r&&e[l+2]==n;)l+=2;var c=Math.min(l+1-s>>>1,6);t.push(16,c-3),s+=2*c-2}else t.push(n,0)}return r>>>1},n.F._hufTree=function(e,t,r){var s=[],i=e.length,o=t.length,a=0;for(a=0;a<o;a+=2)t[a]=0,t[a+1]=0;for(a=0;a<i;a++)0!=e[a]&&s.push({lit:a,f:e[a]});var l=s.length,c=s.slice(0);if(0==l)return 0;if(1==l){var u=s[0].lit;return c=0==u?1:0,t[1+(u<<1)]=1,t[1+(c<<1)]=1,1}s.sort(function(e,t){return e.f-t.f});var d=s[0],p=s[1],m=0,h=1,x=2;for(s[0]={lit:-1,f:d.f+p.f,l:d,r:p,d:0};h!=l-1;)d=m!=h&&(x==l||s[m].f<s[x].f)?s[m++]:s[x++],p=m!=h&&(x==l||s[m].f<s[x].f)?s[m++]:s[x++],s[h++]={lit:-1,f:d.f+p.f,l:d,r:p};var f=n.F.setDepth(s[h-1],0);for(f>r&&(n.F.restrictDepth(c,r,f),f=r),a=0;a<l;a++)t[1+(c[a].lit<<1)]=c[a].d;return f},n.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(n.F.setDepth(e.l,t+1),n.F.setDepth(e.r,t+1))},n.F.restrictDepth=function(e,t,r){var s=0,n=1<<r-t,i=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),s=0;s<e.length&&e[s].d>t;s++){var o=e[s].d;e[s].d=t,i+=n-(1<<r-o)}for(i>>>=r-t;i>0;)(o=e[s].d)<t?(e[s].d++,i-=1<<t-o-1):s++;for(;s>=0;s--)e[s].d==t&&i<0&&(e[s].d--,i++);0!=i&&console.log("debt left")},n.F._goodIndex=function(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r},n.F._writeLit=function(e,t,r,s){return n.F._putsF(r,s,t[e<<1]),s+t[1+(e<<1)]},n.F.inflate=function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var s=n.F,i=s._bitsF,o=s._bitsE,a=s._decodeTiny,l=s.makeCodes,c=s.codes2map,u=s._get17,d=s.U,p=null==t;p&&(t=new r(e.length>>>2<<3));for(var m,h,x=0,f=0,g=0,y=0,v=0,E=0,j=0,b=0,w=0;0==x;)if(x=i(e,w,1),f=i(e,w+1,2),w+=3,0!=f){if(p&&(t=n.F._check(t,b+(1<<17))),1==f&&(m=d.flmap,h=d.fdmap,E=511,j=31),2==f){g=o(e,w,5)+257,y=o(e,w+5,5)+1,v=o(e,w+10,4)+4,w+=14;for(var R=0;R<38;R+=2)d.itree[R]=0,d.itree[R+1]=0;var _=1;for(R=0;R<v;R++){var S=o(e,w+3*R,3);d.itree[1+(d.ordr[R]<<1)]=S,S>_&&(_=S)}w+=3*v,l(d.itree,_),c(d.itree,_,d.imap),m=d.lmap,h=d.dmap,w=a(d.imap,(1<<_)-1,g+y,e,w,d.ttree);var C=s._copyOut(d.ttree,0,g,d.ltree);E=(1<<C)-1;var k=s._copyOut(d.ttree,g,y,d.dtree);j=(1<<k)-1,l(d.ltree,C),c(d.ltree,C,m),l(d.dtree,k),c(d.dtree,k,h)}for(;;){var $=m[u(e,w)&E];w+=15&$;var T=$>>>4;if(T>>>8==0)t[b++]=T;else{if(256==T)break;var I=b+T-254;if(T>264){var P=d.ldef[T-257];I=b+(P>>>3)+o(e,w,7&P),w+=7&P}var A=h[u(e,w)&j];w+=15&A;var F=A>>>4,M=d.ddef[F],D=(M>>>4)+i(e,w,15&M);for(w+=15&M,p&&(t=n.F._check(t,b+(1<<17)));b<I;)t[b]=t[b++-D],t[b]=t[b++-D],t[b]=t[b++-D],t[b]=t[b++-D];b=I}}}else{7&w&&(w+=8-(7&w));var O=4+(w>>>3),N=e[O-4]|e[O-3]<<8;p&&(t=n.F._check(t,b+N)),t.set(new r(e.buffer,e.byteOffset+O,N),b),w=O+N<<3,b+=N}return t.length==b?t:t.slice(0,b)},n.F._check=function(e,t){var r=e.length;if(t<=r)return e;var s=new Uint8Array(Math.max(r<<1,t));return s.set(e,0),s},n.F._decodeTiny=function(e,t,r,s,i,o){for(var a=n.F._bitsE,l=n.F._get17,c=0;c<r;){var u=e[l(s,i)&t];i+=15&u;var d=u>>>4;if(d<=15)o[c]=d,c++;else{var p=0,m=0;16==d?(m=3+a(s,i,2),i+=2,p=o[c-1]):17==d?(m=3+a(s,i,3),i+=3):18==d&&(m=11+a(s,i,7),i+=7);for(var h=c+m;c<h;)o[c]=p,c++}}return i},n.F._copyOut=function(e,t,r,s){for(var n=0,i=0,o=s.length>>>1;i<r;){var a=e[i+t];s[i<<1]=0,s[1+(i<<1)]=a,a>n&&(n=a),i++}for(;i<o;)s[i<<1]=0,s[1+(i<<1)]=0,i++;return n},n.F.makeCodes=function(e,t){for(var r,s,i,o,a=n.F.U,l=e.length,c=a.bl_count,u=0;u<=t;u++)c[u]=0;for(u=1;u<l;u+=2)c[e[u]]++;var d=a.next_code;for(r=0,c[0]=0,s=1;s<=t;s++)r=r+c[s-1]<<1,d[s]=r;for(i=0;i<l;i+=2)0!=(o=e[i+1])&&(e[i]=d[o],d[o]++)},n.F.codes2map=function(e,t,r){for(var s=e.length,i=n.F.U.rev15,o=0;o<s;o+=2)if(0!=e[o+1])for(var a=o>>1,l=e[o+1],c=a<<4|l,u=t-l,d=e[o]<<u,p=d+(1<<u);d!=p;)r[i[d]>>>15-t]=c,d++},n.F.revCodes=function(e,t){for(var r=n.F.U.rev15,s=15-t,i=0;i<e.length;i+=2){var o=e[i]<<t-e[i+1];e[i]=r[o]>>>s}},n.F._putsE=function(e,t,r){r<<=7&t;var s=t>>>3;e[s]|=r,e[s+1]|=r>>>8},n.F._putsF=function(e,t,r){r<<=7&t;var s=t>>>3;e[s]|=r,e[s+1]|=r>>>8,e[s+2]|=r>>>16},n.F._bitsE=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},n.F._bitsF=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},n.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},n.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},n.F.U=(r=Uint16Array,s=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new s(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new s(286),dhst:new s(30),ihst:new s(19),lits:new s(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var e=n.F.U,t=0;t<32768;t++){var r=t;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[t]=(r>>>16|r<<16)>>>17}function s(e,t,r){for(;0!=t--;)e.push(0,r)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];s(e.fltree,144,8),s(e.fltree,112,9),s(e.fltree,24,7),s(e.fltree,8,8),n.F.makeCodes(e.fltree,9),n.F.codes2map(e.fltree,9,e.flmap),n.F.revCodes(e.fltree,9),s(e.fdtree,32,5),n.F.makeCodes(e.fdtree,5),n.F.codes2map(e.fdtree,5,e.fdmap),n.F.revCodes(e.fdtree,5),s(e.itree,19,0),s(e.ltree,286,0),s(e.dtree,30,0),s(e.ttree,320,0)}()}();var UZIP=_mergeNamespaces({__proto__:null,default:e$1},[e$1]);const UPNG=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII(e,t,r){let s="";for(let n=0;n<r;n++)s+=String.fromCharCode(e[t+n]);return s},writeASCII(e,t,r){for(let s=0;s<r.length;s++)e[t+s]=r.charCodeAt(s)},readBytes(e,t,r){const s=[];for(let n=0;n<r;n++)s.push(e[t+n]);return s},pad:e=>e.length<2?`0${e}`:e,readUTF8(t,r,s){let n,i="";for(let a=0;a<s;a++)i+=`%${e.pad(t[r+a].toString(16))}`;try{n=decodeURIComponent(i)}catch(o){return e.readASCII(t,r,s)}return n}};function t(t,r,s,n){const o=r*s,a=i(n),l=Math.ceil(r*a/8),c=new Uint8Array(4*o),u=new Uint32Array(c.buffer),{ctype:d}=n,{depth:p}=n,m=e.readUshort;if(6==d){const e=o<<2;if(8==p)for(var h=0;h<e;h+=4)c[h]=t[h],c[h+1]=t[h+1],c[h+2]=t[h+2],c[h+3]=t[h+3];if(16==p)for(h=0;h<e;h++)c[h]=t[h<<1]}else if(2==d){const e=n.tabs.tRNS;if(null==e){if(8==p)for(h=0;h<o;h++){var x=3*h;u[h]=255<<24|t[x+2]<<16|t[x+1]<<8|t[x]}if(16==p)for(h=0;h<o;h++)x=6*h,u[h]=255<<24|t[x+4]<<16|t[x+2]<<8|t[x]}else{var f=e[0];const r=e[1],s=e[2];if(8==p)for(h=0;h<o;h++){var g=h<<2;x=3*h,u[h]=255<<24|t[x+2]<<16|t[x+1]<<8|t[x],t[x]==f&&t[x+1]==r&&t[x+2]==s&&(c[g+3]=0)}if(16==p)for(h=0;h<o;h++)g=h<<2,x=6*h,u[h]=255<<24|t[x+4]<<16|t[x+2]<<8|t[x],m(t,x)==f&&m(t,x+2)==r&&m(t,x+4)==s&&(c[g+3]=0)}}else if(3==d){const e=n.tabs.PLTE,i=n.tabs.tRNS,a=i?i.length:0;if(1==p)for(var y=0;y<s;y++){var v=y*l,E=y*r;for(h=0;h<r;h++){g=E+h<<2;var j=3*(b=t[v+(h>>3)]>>7-(7&h)&1);c[g]=e[j],c[g+1]=e[j+1],c[g+2]=e[j+2],c[g+3]=b<a?i[b]:255}}if(2==p)for(y=0;y<s;y++)for(v=y*l,E=y*r,h=0;h<r;h++)g=E+h<<2,j=3*(b=t[v+(h>>2)]>>6-((3&h)<<1)&3),c[g]=e[j],c[g+1]=e[j+1],c[g+2]=e[j+2],c[g+3]=b<a?i[b]:255;if(4==p)for(y=0;y<s;y++)for(v=y*l,E=y*r,h=0;h<r;h++)g=E+h<<2,j=3*(b=t[v+(h>>1)]>>4-((1&h)<<2)&15),c[g]=e[j],c[g+1]=e[j+1],c[g+2]=e[j+2],c[g+3]=b<a?i[b]:255;if(8==p)for(h=0;h<o;h++){var b;g=h<<2,j=3*(b=t[h]),c[g]=e[j],c[g+1]=e[j+1],c[g+2]=e[j+2],c[g+3]=b<a?i[b]:255}}else if(4==d){if(8==p)for(h=0;h<o;h++){g=h<<2;var w=t[R=h<<1];c[g]=w,c[g+1]=w,c[g+2]=w,c[g+3]=t[R+1]}if(16==p)for(h=0;h<o;h++){var R;g=h<<2,w=t[R=h<<2],c[g]=w,c[g+1]=w,c[g+2]=w,c[g+3]=t[R+2]}}else if(0==d)for(f=n.tabs.tRNS?n.tabs.tRNS:-1,y=0;y<s;y++){const e=y*l,s=y*r;if(1==p)for(var _=0;_<r;_++){var S=(w=255*(t[e+(_>>>3)]>>>7-(7&_)&1))==255*f?0:255;u[s+_]=S<<24|w<<16|w<<8|w}else if(2==p)for(_=0;_<r;_++)S=(w=85*(t[e+(_>>>2)]>>>6-((3&_)<<1)&3))==85*f?0:255,u[s+_]=S<<24|w<<16|w<<8|w;else if(4==p)for(_=0;_<r;_++)S=(w=17*(t[e+(_>>>1)]>>>4-((1&_)<<2)&15))==17*f?0:255,u[s+_]=S<<24|w<<16|w<<8|w;else if(8==p)for(_=0;_<r;_++)S=(w=t[e+_])==f?0:255,u[s+_]=S<<24|w<<16|w<<8|w;else if(16==p)for(_=0;_<r;_++)w=t[e+(_<<1)],S=m(t,e+(_<<1))==f?0:255,u[s+_]=S<<24|w<<16|w<<8|w}return c}function r(e,t,r,a){const l=i(e),c=Math.ceil(r*l/8),u=new Uint8Array((c+1+e.interlace)*a);return t=e.tabs.CgBI?n(t,u):s(t,u),0==e.interlace?t=o(t,e,0,r,a):1==e.interlace&&(t=function(e,t){const r=t.width,s=t.height,n=i(t),a=n>>3,l=Math.ceil(r*n/8),c=new Uint8Array(s*l);let u=0;const d=[0,0,4,0,2,0,1],p=[0,4,0,2,0,1,0],m=[8,8,8,4,4,2,2],h=[8,8,4,4,2,2,1];let x=0;for(;x<7;){const i=m[x],g=h[x];let y=0,v=0,E=d[x];for(;E<s;)E+=i,v++;let j=p[x];for(;j<r;)j+=g,y++;const b=Math.ceil(y*n/8);o(e,t,u,y,v);let w=0,R=d[x];for(;R<s;){let t=p[x],s=u+w*b<<3;for(;t<r;){var f;if(1==n&&(f=(f=e[s>>3])>>7-(7&s)&1,c[R*l+(t>>3)]|=f<<7-(7&t)),2==n&&(f=(f=e[s>>3])>>6-(7&s)&3,c[R*l+(t>>2)]|=f<<6-((3&t)<<1)),4==n&&(f=(f=e[s>>3])>>4-(7&s)&15,c[R*l+(t>>1)]|=f<<4-((1&t)<<2)),n>=8){const r=R*l+t*a;for(let t=0;t<a;t++)c[r+t]=e[(s>>3)+t]}s+=n,t+=g}w++,R+=i}y*v!=0&&(u+=v*(1+b)),x+=1}return c}(t,e)),t}function s(e,t){return n(new Uint8Array(e.buffer,2,e.length-6),t)}var n=function(){const e={H:{}};return e.H.N=function(t,r){const s=Uint8Array;let n,i,o=0,a=0,l=0,c=0,u=0,d=0,p=0,m=0,h=0;if(3==t[0]&&0==t[1])return r||new s(0);const x=e.H,f=x.b,g=x.e,y=x.R,v=x.n,E=x.A,j=x.Z,b=x.m,w=null==r;for(w&&(r=new s(t.length>>>2<<5));0==o;)if(o=f(t,h,1),a=f(t,h+1,2),h+=3,0!=a){if(w&&(r=e.H.W(r,m+(1<<17))),1==a&&(n=b.J,i=b.h,d=511,p=31),2==a){l=g(t,h,5)+257,c=g(t,h+5,5)+1,u=g(t,h+10,4)+4,h+=14;let e=1;for(var R=0;R<38;R+=2)b.Q[R]=0,b.Q[R+1]=0;for(R=0;R<u;R++){const r=g(t,h+3*R,3);b.Q[1+(b.X[R]<<1)]=r,r>e&&(e=r)}h+=3*u,v(b.Q,e),E(b.Q,e,b.u),n=b.w,i=b.d,h=y(b.u,(1<<e)-1,l+c,t,h,b.v);const r=x.V(b.v,0,l,b.C);d=(1<<r)-1;const s=x.V(b.v,l,c,b.D);p=(1<<s)-1,v(b.C,r),E(b.C,r,n),v(b.D,s),E(b.D,s,i)}for(;;){const e=n[j(t,h)&d];h+=15&e;const s=e>>>4;if(s>>>8==0)r[m++]=s;else{if(256==s)break;{let e=m+s-254;if(s>264){const r=b.q[s-257];e=m+(r>>>3)+g(t,h,7&r),h+=7&r}const n=i[j(t,h)&p];h+=15&n;const o=n>>>4,a=b.c[o],l=(a>>>4)+f(t,h,15&a);for(h+=15&a;m<e;)r[m]=r[m++-l],r[m]=r[m++-l],r[m]=r[m++-l],r[m]=r[m++-l];m=e}}}}else{7&h&&(h+=8-(7&h));const n=4+(h>>>3),i=t[n-4]|t[n-3]<<8;w&&(r=e.H.W(r,m+i)),r.set(new s(t.buffer,t.byteOffset+n,i),m),h=n+i<<3,m+=i}return r.length==m?r:r.slice(0,m)},e.H.W=function(e,t){const r=e.length;if(t<=r)return e;const s=new Uint8Array(r<<1);return s.set(e,0),s},e.H.R=function(t,r,s,n,i,o){const a=e.H.e,l=e.H.Z;let c=0;for(;c<s;){const e=t[l(n,i)&r];i+=15&e;const s=e>>>4;if(s<=15)o[c]=s,c++;else{let e=0,t=0;16==s?(t=3+a(n,i,2),i+=2,e=o[c-1]):17==s?(t=3+a(n,i,3),i+=3):18==s&&(t=11+a(n,i,7),i+=7);const r=c+t;for(;c<r;)o[c]=e,c++}}return i},e.H.V=function(e,t,r,s){let n=0,i=0;const o=s.length>>>1;for(;i<r;){const r=e[i+t];s[i<<1]=0,s[1+(i<<1)]=r,r>n&&(n=r),i++}for(;i<o;)s[i<<1]=0,s[1+(i<<1)]=0,i++;return n},e.H.n=function(t,r){const s=e.H.m,n=t.length;let i,o,a,l;const c=s.j;for(var u=0;u<=r;u++)c[u]=0;for(u=1;u<n;u+=2)c[t[u]]++;const d=s.K;for(i=0,c[0]=0,o=1;o<=r;o++)i=i+c[o-1]<<1,d[o]=i;for(a=0;a<n;a+=2)l=t[a+1],0!=l&&(t[a]=d[l],d[l]++)},e.H.A=function(t,r,s){const n=t.length,i=e.H.m.r;for(let e=0;e<n;e+=2)if(0!=t[e+1]){const n=e>>1,o=t[e+1],a=n<<4|o,l=r-o;let c=t[e]<<l;const u=c+(1<<l);for(;c!=u;)s[i[c]>>>15-r]=a,c++}},e.H.l=function(t,r){const s=e.H.m.r,n=15-r;for(let e=0;e<t.length;e+=2){const i=t[e]<<r-t[e+1];t[e]=s[i]>>>n}},e.H.M=function(e,t,r){r<<=7&t;const s=t>>>3;e[s]|=r,e[s+1]|=r>>>8},e.H.I=function(e,t,r){r<<=7&t;const s=t>>>3;e[s]|=r,e[s+1]|=r>>>8,e[s+2]|=r>>>16},e.H.e=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},e.H.b=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var r=0;r<32768;r++){let e=r;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[r]=(e>>>16|e<<16)>>>17}function s(e,t,r){for(;0!=t--;)e.push(0,r)}for(r=0;r<32;r++)t.q[r]=t.S[r]<<3|t.T[r],t.c[r]=t.p[r]<<4|t.z[r];s(t._,144,8),s(t._,112,9),s(t._,24,7),s(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),s(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),s(t.Q,19,0),s(t.C,286,0),s(t.D,30,0),s(t.v,320,0)}(),e.H.N}();function i(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function o(e,t,r,s,n){let o=i(t);const l=Math.ceil(s*o/8);let c,u;o=Math.ceil(o/8);let d=e[r],p=0;if(d>1&&(e[r]=[0,0,1][d-2]),3==d)for(p=o;p<l;p++)e[p+1]=e[p+1]+(e[p+1-o]>>>1)&255;for(let i=0;i<n;i++)if(c=r+i*l,u=c+i+1,d=e[u-1],p=0,0==d)for(;p<l;p++)e[c+p]=e[u+p];else if(1==d){for(;p<o;p++)e[c+p]=e[u+p];for(;p<l;p++)e[c+p]=e[u+p]+e[c+p-o]}else if(2==d)for(;p<l;p++)e[c+p]=e[u+p]+e[c+p-l];else if(3==d){for(;p<o;p++)e[c+p]=e[u+p]+(e[c+p-l]>>>1);for(;p<l;p++)e[c+p]=e[u+p]+(e[c+p-l]+e[c+p-o]>>>1)}else{for(;p<o;p++)e[c+p]=e[u+p]+a(0,e[c+p-l],0);for(;p<l;p++)e[c+p]=e[u+p]+a(e[c+p-o],e[c+p-l],e[c+p-o-l])}return e}function a(e,t,r){const s=e+t-r,n=s-e,i=s-t,o=s-r;return n*n<=i*i&&n*n<=o*o?e:i*i<=o*o?t:r}function l(t,r,s){s.width=e.readUint(t,r),r+=4,s.height=e.readUint(t,r),r+=4,s.depth=t[r],r++,s.ctype=t[r],r++,s.compress=t[r],r++,s.filter=t[r],r++,s.interlace=t[r],r++}function c(e,t,r,s,n,i,o,a,l){const c=Math.min(t,n),u=Math.min(r,i);let d=0,p=0;for(let j=0;j<u;j++)for(let r=0;r<c;r++)if(o>=0&&a>=0?(d=j*t+r<<2,p=(a+j)*n+o+r<<2):(d=(-a+j)*t-o+r<<2,p=j*n+r<<2),0==l)s[p]=e[d],s[p+1]=e[d+1],s[p+2]=e[d+2],s[p+3]=e[d+3];else if(1==l){var m=e[d+3]*(1/255),h=e[d]*m,x=e[d+1]*m,f=e[d+2]*m,g=s[p+3]*(1/255),y=s[p]*g,v=s[p+1]*g,E=s[p+2]*g;const t=1-m,r=m+g*t,n=0==r?0:1/r;s[p+3]=255*r,s[p+0]=(h+y*t)*n,s[p+1]=(x+v*t)*n,s[p+2]=(f+E*t)*n}else if(2==l)m=e[d+3],h=e[d],x=e[d+1],f=e[d+2],g=s[p+3],y=s[p],v=s[p+1],E=s[p+2],m==g&&h==y&&x==v&&f==E?(s[p]=0,s[p+1]=0,s[p+2]=0,s[p+3]=0):(s[p]=h,s[p+1]=x,s[p+2]=f,s[p+3]=m);else if(3==l){if(m=e[d+3],h=e[d],x=e[d+1],f=e[d+2],g=s[p+3],y=s[p],v=s[p+1],E=s[p+2],m==g&&h==y&&x==v&&f==E)continue;if(m<220&&g>20)return!1}return!0}return{decode:function(t){const i=new Uint8Array(t);let o=8;const a=e,c=a.readUshort,u=a.readUint,d={tabs:{},frames:[]},p=new Uint8Array(i.length);let m,h=0,x=0;const f=[137,80,78,71,13,10,26,10];for(var g=0;g<8;g++)if(i[g]!=f[g])throw"The input is not a PNG file!";for(;o<i.length;){const e=a.readUint(i,o);o+=4;const t=a.readASCII(i,o,4);if(o+=4,"IHDR"==t)l(i,o,d);else if("iCCP"==t){for(var y=o;0!=i[y];)y++;a.readASCII(i,o,y-o),i[y+1];const r=i.slice(y+2,o+e);let l=null;try{l=s(r)}catch(_){l=n(r)}d.tabs[t]=l}else if("CgBI"==t)d.tabs[t]=i.slice(o,o+4);else if("IDAT"==t){for(g=0;g<e;g++)p[h+g]=i[o+g];h+=e}else if("acTL"==t)d.tabs[t]={num_frames:u(i,o),num_plays:u(i,o+4)},m=new Uint8Array(i.length);else if("fcTL"==t){0!=x&&((R=d.frames[d.frames.length-1]).data=r(d,m.slice(0,x),R.rect.width,R.rect.height),x=0);const e={x:u(i,o+12),y:u(i,o+16),width:u(i,o+4),height:u(i,o+8)};let t=c(i,o+22);t=c(i,o+20)/(0==t?100:t);const s={rect:e,delay:Math.round(1e3*t),dispose:i[o+24],blend:i[o+25]};d.frames.push(s)}else if("fdAT"==t){for(g=0;g<e-4;g++)m[x+g]=i[o+g+4];x+=e-4}else if("pHYs"==t)d.tabs[t]=[a.readUint(i,o),a.readUint(i,o+4),i[o+8]];else if("cHRM"==t)for(d.tabs[t]=[],g=0;g<8;g++)d.tabs[t].push(a.readUint(i,o+4*g));else if("tEXt"==t||"zTXt"==t){null==d.tabs[t]&&(d.tabs[t]={});var v=a.nextZero(i,o),E=a.readASCII(i,o,v-o),j=o+e-v-1;if("tEXt"==t)w=a.readASCII(i,v+1,j);else{var b=s(i.slice(v+2,v+2+j));w=a.readUTF8(b,0,b.length)}d.tabs[t][E]=w}else if("iTXt"==t){null==d.tabs[t]&&(d.tabs[t]={}),v=0,y=o,v=a.nextZero(i,y),E=a.readASCII(i,y,v-y);const r=i[y=v+1];var w;i[y+1],y+=2,v=a.nextZero(i,y),a.readASCII(i,y,v-y),y=v+1,v=a.nextZero(i,y),a.readUTF8(i,y,v-y),j=e-((y=v+1)-o),0==r?w=a.readUTF8(i,y,j):(b=s(i.slice(y,y+j)),w=a.readUTF8(b,0,b.length)),d.tabs[t][E]=w}else if("PLTE"==t)d.tabs[t]=a.readBytes(i,o,e);else if("hIST"==t){const e=d.tabs.PLTE.length/3;for(d.tabs[t]=[],g=0;g<e;g++)d.tabs[t].push(c(i,o+2*g))}else if("tRNS"==t)3==d.ctype?d.tabs[t]=a.readBytes(i,o,e):0==d.ctype?d.tabs[t]=c(i,o):2==d.ctype&&(d.tabs[t]=[c(i,o),c(i,o+2),c(i,o+4)]);else if("gAMA"==t)d.tabs[t]=a.readUint(i,o)/1e5;else if("sRGB"==t)d.tabs[t]=i[o];else if("bKGD"==t)0==d.ctype||4==d.ctype?d.tabs[t]=[c(i,o)]:2==d.ctype||6==d.ctype?d.tabs[t]=[c(i,o),c(i,o+2),c(i,o+4)]:3==d.ctype&&(d.tabs[t]=i[o]);else if("IEND"==t)break;o+=e,a.readUint(i,o),o+=4}var R;return 0!=x&&((R=d.frames[d.frames.length-1]).data=r(d,m.slice(0,x),R.rect.width,R.rect.height)),d.data=r(d,p,d.width,d.height),delete d.compress,delete d.interlace,delete d.filter,d},toRGBA8:function(e){const r=e.width,s=e.height;if(null==e.tabs.acTL)return[t(e.data,r,s,e).buffer];const n=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const i=r*s*4,o=new Uint8Array(i),a=new Uint8Array(i),l=new Uint8Array(i);for(let d=0;d<e.frames.length;d++){const p=e.frames[d],m=p.rect.x,h=p.rect.y,x=p.rect.width,f=p.rect.height,g=t(p.data,x,f,e);if(0!=d)for(var u=0;u<i;u++)l[u]=o[u];if(0==p.blend?c(g,x,f,o,r,s,m,h,0):1==p.blend&&c(g,x,f,o,r,s,m,h,1),n.push(o.buffer.slice(0)),0==p.dispose);else if(1==p.dispose)c(a,x,f,o,r,s,m,h,0);else if(2==p.dispose)for(u=0;u<i;u++)o[u]=l[u]}return n},_paeth:a,_copyTile:c,_bin:e}}();!function(){const{_copyTile:e}=UPNG,{_bin:t}=UPNG,r=UPNG._paeth;var s={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update(e,t,r,n){for(let i=0;i<n;i++)e=s.table[255&(e^t[r+i])]^e>>>8;return e},crc:(e,t,r)=>4294967295^s.update(4294967295,e,t,r)};function n(e,t,r,s){t[r]+=e[0]*s>>4,t[r+1]+=e[1]*s>>4,t[r+2]+=e[2]*s>>4,t[r+3]+=e[3]*s>>4}function i(e){return Math.max(0,Math.min(255,e))}function o(e,t){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],i=e[3]-t[3];return r*r+s*s+n*n+i*i}function a(e,t,r,s,a,l,c){null==c&&(c=1);const u=s.length,d=[];for(var p=0;p<u;p++){const e=s[p];d.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(p=0;p<u;p++){let e=4294967295;for(var m=0,h=0;h<u;h++){var x=o(d[p],d[h]);h!=p&&x<e&&(e=x,m=h)}}const f=new Uint32Array(a.buffer),g=new Int16Array(t*r*4),y=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(p=0;p<y.length;p++)y[p]=255*((y[p]+.5)/16-.5);for(let E=0;E<r;E++)for(let a=0;a<t;a++){var v;p=4*(E*t+a),2!=c?v=[i(e[p]+g[p]),i(e[p+1]+g[p+1]),i(e[p+2]+g[p+2]),i(e[p+3]+g[p+3])]:(x=y[4*(3&E)+(3&a)],v=[i(e[p]+x),i(e[p+1]+x),i(e[p+2]+x),i(e[p+3]+x)]),m=0;let j=16777215;for(h=0;h<u;h++){const e=o(v,d[h]);e<j&&(j=e,m=h)}const b=d[m],w=[v[0]-b[0],v[1]-b[1],v[2]-b[2],v[3]-b[3]];1==c&&(a!=t-1&&n(w,g,p+4,7),E!=r-1&&(0!=a&&n(w,g,p+4*t-4,3),n(w,g,p+4*t,5),a!=t-1&&n(w,g,p+4*t+4,1))),l[p>>2]=m,f[p>>2]=s[m]}}function l(e,r,n,i,o){null==o&&(o={});const{crc:a}=s,l=t.writeUint,c=t.writeUshort,u=t.writeASCII;let d=8;const p=e.frames.length>1;let m,h=!1,x=33+(p?20:0);if(null!=o.sRGB&&(x+=13),null!=o.pHYs&&(x+=21),null!=o.iCCP&&(m=pako.deflate(o.iCCP),x+=21+m.length+4),3==e.ctype){for(var f=e.plte.length,g=0;g<f;g++)e.plte[g]>>>24!=255&&(h=!0);x+=8+3*f+4+(h?8+1*f+4:0)}for(var y=0;y<e.frames.length;y++)p&&(x+=38),x+=(b=e.frames[y]).cimg.length+12,0!=y&&(x+=4);x+=12;const v=new Uint8Array(x),E=[137,80,78,71,13,10,26,10];for(g=0;g<8;g++)v[g]=E[g];if(l(v,d,13),d+=4,u(v,d,"IHDR"),d+=4,l(v,d,r),d+=4,l(v,d,n),d+=4,v[d]=e.depth,d++,v[d]=e.ctype,d++,v[d]=0,d++,v[d]=0,d++,v[d]=0,d++,l(v,d,a(v,d-17,17)),d+=4,null!=o.sRGB&&(l(v,d,1),d+=4,u(v,d,"sRGB"),d+=4,v[d]=o.sRGB,d++,l(v,d,a(v,d-5,5)),d+=4),null!=o.iCCP){const e=13+m.length;l(v,d,e),d+=4,u(v,d,"iCCP"),d+=4,u(v,d,"ICC profile"),d+=11,d+=2,v.set(m,d),d+=m.length,l(v,d,a(v,d-(e+4),e+4)),d+=4}if(null!=o.pHYs&&(l(v,d,9),d+=4,u(v,d,"pHYs"),d+=4,l(v,d,o.pHYs[0]),d+=4,l(v,d,o.pHYs[1]),d+=4,v[d]=o.pHYs[2],d++,l(v,d,a(v,d-13,13)),d+=4),p&&(l(v,d,8),d+=4,u(v,d,"acTL"),d+=4,l(v,d,e.frames.length),d+=4,l(v,d,null!=o.loop?o.loop:0),d+=4,l(v,d,a(v,d-12,12)),d+=4),3==e.ctype){for(l(v,d,3*(f=e.plte.length)),d+=4,u(v,d,"PLTE"),d+=4,g=0;g<f;g++){const t=3*g,r=e.plte[g],s=255&r,n=r>>>8&255,i=r>>>16&255;v[d+t+0]=s,v[d+t+1]=n,v[d+t+2]=i}if(d+=3*f,l(v,d,a(v,d-3*f-4,3*f+4)),d+=4,h){for(l(v,d,f),d+=4,u(v,d,"tRNS"),d+=4,g=0;g<f;g++)v[d+g]=e.plte[g]>>>24&255;d+=f,l(v,d,a(v,d-f-4,f+4)),d+=4}}let j=0;for(y=0;y<e.frames.length;y++){var b=e.frames[y];p&&(l(v,d,26),d+=4,u(v,d,"fcTL"),d+=4,l(v,d,j++),d+=4,l(v,d,b.rect.width),d+=4,l(v,d,b.rect.height),d+=4,l(v,d,b.rect.x),d+=4,l(v,d,b.rect.y),d+=4,c(v,d,i[y]),d+=2,c(v,d,1e3),d+=2,v[d]=b.dispose,d++,v[d]=b.blend,d++,l(v,d,a(v,d-30,30)),d+=4);const t=b.cimg;l(v,d,(f=t.length)+(0==y?0:4)),d+=4;const r=d;u(v,d,0==y?"IDAT":"fdAT"),d+=4,0!=y&&(l(v,d,j++),d+=4),v.set(t,d),d+=f,l(v,d,a(v,r,d-r)),d+=4}return l(v,d,0),d+=4,u(v,d,"IEND"),d+=4,l(v,d,a(v,d-4,4)),d+=4,v.buffer}function c(e,t,r){for(let s=0;s<e.frames.length;s++){const n=e.frames[s];n.rect.width;const i=n.rect.height,o=new Uint8Array(i*n.bpl+i);n.cimg=m(n.img,i,n.bpp,n.bpl,o,t,r)}}function u(t,r,s,n,i){const o=i[0],l=i[1],c=i[2],u=i[3],m=i[4],h=i[5];let f=6,g=8,y=255;for(var v=0;v<t.length;v++){const e=new Uint8Array(t[v]);for(var E=e.length,j=0;j<E;j+=4)y&=e[j+3]}const b=255!=y,w=function(t,r,s,n,i,o){const a=[];for(var l=0;l<t.length;l++){const d=new Uint8Array(t[l]),m=new Uint32Array(d.buffer);var c;let x=0,f=0,g=r,y=s,v=n?1:0;if(0!=l){const E=o||n||1==l||0!=a[l-2].dispose?1:2;let j=0,b=1e9;for(let e=0;e<E;e++){var u=new Uint8Array(t[l-1-e]);const n=new Uint32Array(t[l-1-e]);let o=r,a=s,c=-1,d=-1;for(let e=0;e<s;e++)for(let t=0;t<r;t++)m[h=e*r+t]!=n[h]&&(t<o&&(o=t),t>c&&(c=t),e<a&&(a=e),e>d&&(d=e));-1==c&&(o=a=c=d=0),i&&(!(1&~o)&&o--,!(1&~a)&&a--);const p=(c-o+1)*(d-a+1);p<b&&(b=p,j=e,x=o,f=a,g=c-o+1,y=d-a+1)}u=new Uint8Array(t[l-1-j]),1==j&&(a[l-1].dispose=2),c=new Uint8Array(g*y*4),e(u,r,s,c,g,y,-x,-f,0),v=e(d,r,s,c,g,y,-x,-f,3)?1:0,1==v?p(d,r,s,c,{x:x,y:f,width:g,height:y}):e(d,r,s,c,g,y,-x,-f,0)}else c=d.slice(0);a.push({rect:{x:x,y:f,width:g,height:y},img:c,blend:v,dispose:0})}if(n)for(l=0;l<a.length;l++){if(1==(x=a[l]).blend)continue;const e=x.rect,n=a[l-1].rect,o=Math.min(e.x,n.x),c=Math.min(e.y,n.y),u={x:o,y:c,width:Math.max(e.x+e.width,n.x+n.width)-o,height:Math.max(e.y+e.height,n.y+n.height)-c};a[l-1].dispose=1,l-1!=0&&d(t,r,s,a,l-1,u,i),d(t,r,s,a,l,u,i)}let m=0;if(1!=t.length)for(var h=0;h<a.length;h++){var x;m+=(x=a[h]).rect.width*x.rect.height}return a}(t,r,s,o,l,c),R={},_=[],S=[];if(0!=n){const e=[];for(j=0;j<w.length;j++)e.push(w[j].img.buffer);const t=x(function(e){let t=0;for(var r=0;r<e.length;r++)t+=e[r].byteLength;const s=new Uint8Array(t);let n=0;for(r=0;r<e.length;r++){const t=new Uint8Array(e[r]),i=t.length;for(let e=0;e<i;e+=4){let r=t[e],i=t[e+1],o=t[e+2];const a=t[e+3];0==a&&(r=i=o=0),s[n+e]=r,s[n+e+1]=i,s[n+e+2]=o,s[n+e+3]=a}n+=i}return s.buffer}(e),n);for(j=0;j<t.plte.length;j++)_.push(t.plte[j].est.rgba);let r=0;for(j=0;j<w.length;j++){const e=(k=w[j]).img.length;var C=new Uint8Array(t.inds.buffer,r>>2,e>>2);S.push(C);const s=new Uint8Array(t.abuf,r,e);h&&a(k.img,k.rect.width,k.rect.height,_,s,C),k.img.set(s),r+=e}}else for(v=0;v<w.length;v++){var k=w[v];const e=new Uint32Array(k.img.buffer);var $=k.rect.width;for(E=e.length,C=new Uint8Array(E),S.push(C),j=0;j<E;j++){const t=e[j];if(0!=j&&t==e[j-1])C[j]=C[j-1];else if(j>$&&t==e[j-$])C[j]=C[j-$];else{let e=R[t];if(null==e&&(R[t]=e=_.length,_.push(t),_.length>=300))break;C[j]=e}}}const T=_.length;for(T<=256&&0==m&&(g=T<=2?1:T<=4?2:T<=16?4:8,g=Math.max(g,u)),v=0;v<w.length;v++){(k=w[v]).rect.x,k.rect.y,$=k.rect.width;const e=k.rect.height;let t=k.img;new Uint32Array(t.buffer);let r=4*$,s=4;if(T<=256&&0==m){r=Math.ceil(g*$/8);var I=new Uint8Array(r*e);const n=S[v];for(let t=0;t<e;t++){j=t*r;const e=t*$;if(8==g)for(var P=0;P<$;P++)I[j+P]=n[e+P];else if(4==g)for(P=0;P<$;P++)I[j+(P>>1)]|=n[e+P]<<4-4*(1&P);else if(2==g)for(P=0;P<$;P++)I[j+(P>>2)]|=n[e+P]<<6-2*(3&P);else if(1==g)for(P=0;P<$;P++)I[j+(P>>3)]|=n[e+P]<<7-1*(7&P)}t=I,f=3,s=1}else if(0==b&&1==w.length){I=new Uint8Array($*e*3);const n=$*e;for(j=0;j<n;j++){const e=3*j,r=4*j;I[e]=t[r],I[e+1]=t[r+1],I[e+2]=t[r+2]}t=I,f=2,s=3,r=3*$}k.img=t,k.bpl=r,k.bpp=s}return{ctype:f,depth:g,plte:_,frames:w}}function d(t,r,s,n,i,o,a){const l=Uint8Array,c=Uint32Array,u=new l(t[i-1]),d=new c(t[i-1]),m=i+1<t.length?new l(t[i+1]):null,h=new l(t[i]),x=new c(h.buffer);let f=r,g=s,y=-1,v=-1;for(let e=0;e<o.height;e++)for(let t=0;t<o.width;t++){const s=o.x+t,a=o.y+e,l=a*r+s,c=x[l];0==c||0==n[i-1].dispose&&d[l]==c&&(null==m||0!=m[4*l+3])||(s<f&&(f=s),s>y&&(y=s),a<g&&(g=a),a>v&&(v=a))}-1==y&&(f=g=y=v=0),a&&(!(1&~f)&&f--,!(1&~g)&&g--),o={x:f,y:g,width:y-f+1,height:v-g+1};const E=n[i];E.rect=o,E.blend=1,E.img=new Uint8Array(o.width*o.height*4),0==n[i-1].dispose?(e(u,r,s,E.img,o.width,o.height,-o.x,-o.y,0),p(h,r,s,E.img,o)):e(h,r,s,E.img,o.width,o.height,-o.x,-o.y,0)}function p(t,r,s,n,i){e(t,r,s,n,i.width,i.height,-i.x,-i.y,2)}function m(e,t,r,s,n,i,o){const a=[];let l,c=[0,1,2,3,4];-1!=i?c=[i]:(t*s>5e5||1==r)&&(c=[0]),o&&(l={level:0});const u=UZIP;for(var d=0;d<c.length;d++){for(let i=0;i<t;i++)h(n,e,i,s,r,c[d]);a.push(u.deflate(n,l))}let p,m=1e9;for(d=0;d<a.length;d++)a[d].length<m&&(p=d,m=a[d].length);return a[p]}function h(e,t,s,n,i,o){const a=s*n;let l=a+s;if(e[l]=o,l++,0==o)if(n<500)for(var c=0;c<n;c++)e[l+c]=t[a+c];else e.set(new Uint8Array(t.buffer,a,n),l);else if(1==o){for(c=0;c<i;c++)e[l+c]=t[a+c];for(c=i;c<n;c++)e[l+c]=t[a+c]-t[a+c-i]+256&255}else if(0==s){for(c=0;c<i;c++)e[l+c]=t[a+c];if(2==o)for(c=i;c<n;c++)e[l+c]=t[a+c];if(3==o)for(c=i;c<n;c++)e[l+c]=t[a+c]-(t[a+c-i]>>1)+256&255;if(4==o)for(c=i;c<n;c++)e[l+c]=t[a+c]-r(t[a+c-i],0,0)+256&255}else{if(2==o)for(c=0;c<n;c++)e[l+c]=t[a+c]+256-t[a+c-n]&255;if(3==o){for(c=0;c<i;c++)e[l+c]=t[a+c]+256-(t[a+c-n]>>1)&255;for(c=i;c<n;c++)e[l+c]=t[a+c]+256-(t[a+c-n]+t[a+c-i]>>1)&255}if(4==o){for(c=0;c<i;c++)e[l+c]=t[a+c]+256-r(0,t[a+c-n],0)&255;for(c=i;c<n;c++)e[l+c]=t[a+c]+256-r(t[a+c-i],t[a+c-n],t[a+c-i-n])&255}}}function x(e,t){const r=new Uint8Array(e),s=r.slice(0),n=new Uint32Array(s.buffer),i=f(s,t),o=i[0],a=i[1],l=r.length,c=new Uint8Array(l>>2);let u;if(r.length<2e7)for(var d=0;d<l;d+=4)u=g(o,p=r[d]*(1/255),m=r[d+1]*(1/255),h=r[d+2]*(1/255),x=r[d+3]*(1/255)),c[d>>2]=u.ind,n[d>>2]=u.est.rgba;else for(d=0;d<l;d+=4){var p=r[d]*(1/255),m=r[d+1]*(1/255),h=r[d+2]*(1/255),x=r[d+3]*(1/255);for(u=o;u.left;)u=y(u.est,p,m,h,x)<=0?u.left:u.right;c[d>>2]=u.ind,n[d>>2]=u.est.rgba}return{abuf:s.buffer,inds:c,plte:a}}function f(e,t,r){null==r&&(r=1e-4);const s=new Uint32Array(e.buffer),n={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};n.bst=j(e,n.i0,n.i1),n.est=b(n.bst);const i=[n];for(;i.length<t;){let t=0,n=0;for(var o=0;o<i.length;o++)i[o].est.L>t&&(t=i[o].est.L,n=o);if(t<r)break;const a=i[n],l=v(e,s,a.i0,a.i1,a.est.e,a.est.eMq255);if(a.i0>=l||a.i1<=l){a.est.L=0;continue}const c={i0:a.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};c.bst=j(e,c.i0,c.i1),c.est=b(c.bst);const u={i0:l,i1:a.i1,bst:null,est:null,tdst:0,left:null,right:null};for(u.bst={R:[],m:[],N:a.bst.N-c.bst.N},o=0;o<16;o++)u.bst.R[o]=a.bst.R[o]-c.bst.R[o];for(o=0;o<4;o++)u.bst.m[o]=a.bst.m[o]-c.bst.m[o];u.est=b(u.bst),a.left=c,a.right=u,i[n]=c,i.push(u)}for(i.sort((e,t)=>t.bst.N-e.bst.N),o=0;o<i.length;o++)i[o].ind=o;return[n,i]}function g(e,t,r,s,n){if(null==e.left)return e.tdst=function(e,t,r,s,n){const i=t-e[0],o=r-e[1],a=s-e[2],l=n-e[3];return i*i+o*o+a*a+l*l}(e.est.q,t,r,s,n),e;const i=y(e.est,t,r,s,n);let o=e.left,a=e.right;i>0&&(o=e.right,a=e.left);const l=g(o,t,r,s,n);if(l.tdst<=i*i)return l;const c=g(a,t,r,s,n);return c.tdst<l.tdst?c:l}function y(e,t,r,s,n){const{e:i}=e;return i[0]*t+i[1]*r+i[2]*s+i[3]*n-e.eMq}function v(e,t,r,s,n,i){for(s-=4;r<s;){for(;E(e,r,n)<=i;)r+=4;for(;E(e,s,n)>i;)s-=4;if(r>=s)break;const o=t[r>>2];t[r>>2]=t[s>>2],t[s>>2]=o,r+=4,s-=4}for(;E(e,r,n)>i;)r-=4;return r+4}function E(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]+e[t+3]*r[3]}function j(e,t,r){const s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0],i=r-t>>2;for(let o=t;o<r;o+=4){const t=e[o]*(1/255),r=e[o+1]*(1/255),i=e[o+2]*(1/255),a=e[o+3]*(1/255);n[0]+=t,n[1]+=r,n[2]+=i,n[3]+=a,s[0]+=t*t,s[1]+=t*r,s[2]+=t*i,s[3]+=t*a,s[5]+=r*r,s[6]+=r*i,s[7]+=r*a,s[10]+=i*i,s[11]+=i*a,s[15]+=a*a}return s[4]=s[1],s[8]=s[2],s[9]=s[6],s[12]=s[3],s[13]=s[7],s[14]=s[11],{R:s,m:n,N:i}}function b(e){const{R:t}=e,{m:r}=e,{N:s}=e,n=r[0],i=r[1],o=r[2],a=r[3],l=0==s?0:1/s,c=[t[0]-n*n*l,t[1]-n*i*l,t[2]-n*o*l,t[3]-n*a*l,t[4]-i*n*l,t[5]-i*i*l,t[6]-i*o*l,t[7]-i*a*l,t[8]-o*n*l,t[9]-o*i*l,t[10]-o*o*l,t[11]-o*a*l,t[12]-a*n*l,t[13]-a*i*l,t[14]-a*o*l,t[15]-a*a*l],u=c,d=w;let p=[Math.random(),Math.random(),Math.random(),Math.random()],m=0,h=0;if(0!=s)for(let f=0;f<16&&(p=d.multVec(u,p),h=Math.sqrt(d.dot(p,p)),p=d.sml(1/h,p),!(0!=f&&Math.abs(h-m)<1e-9));f++)m=h;const x=[n*l,i*l,o*l,a*l];return{Cov:c,q:x,e:p,L:m,eMq255:d.dot(d.sml(255,x),p),eMq:d.dot(p,x),rgba:(Math.round(255*x[3])<<24|Math.round(255*x[2])<<16|Math.round(255*x[1])<<8|Math.round(255*x[0]))>>>0}}var w={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};UPNG.encode=function(e,t,r,s,n,i,o){null==s&&(s=0),null==o&&(o=!1);const a=u(e,t,r,s,[!1,!1,!1,0,o,!1]);return c(a,-1),l(a,t,r,n,i)},UPNG.encodeLL=function(e,t,r,s,n,i,o,a){const u={ctype:0+(1==s?0:2)+(0==n?0:4),depth:i,frames:[]},d=(s+n)*i,p=d*t;for(let l=0;l<e.length;l++)u.frames.push({rect:{x:0,y:0,width:t,height:r},img:new Uint8Array(e[l]),blend:0,dispose:1,bpp:Math.ceil(d/8),bpl:Math.ceil(p/8)});return c(u,0,!0),l(u,t,r,o,a)},UPNG.encode.compress=u,UPNG.encode.dither=a,UPNG.quantize=x,UPNG.quantize.getKDtree=f,UPNG.quantize.getNearest=g}();const r={toArrayBuffer(e,t){const s=e.width,n=e.height,i=s<<2,o=e.getContext("2d").getImageData(0,0,s,n),a=new Uint32Array(o.data.buffer),l=(32*s+31)/32<<2,c=l*n,u=122+c,d=new ArrayBuffer(u),p=new DataView(d),m=1<<20;let h,x,f,g,y=m,v=0,E=0,j=0;function b(e){p.setUint16(E,e,!0),E+=2}function w(e){p.setUint32(E,e,!0),E+=4}function R(e){E+=e}b(19778),w(u),R(4),w(122),w(108),w(s),w(-n>>>0),b(1),b(32),w(3),w(c),w(2835),w(2835),R(8),w(16711680),w(65280),w(255),w(4278190080),w(1466527264),function e(){for(;v<n&&y>0;){for(g=122+v*l,h=0;h<i;)y--,x=a[j++],f=x>>>24,p.setUint32(g+h,x<<8|f),h+=4;v++}j<a.length?(y=m,setTimeout(e,r._dly)):t(d)}()},toBlob(e,t){this.toArrayBuffer(e,e=>{t(new Blob([e],{type:"image/bmp"}))})},_dly:9};var i$1={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},o={[i$1.CHROME]:16384,[i$1.FIREFOX]:11180,[i$1.DESKTOP_SAFARI]:16384,[i$1.IE]:8192,[i$1.IOS]:4096,[i$1.ETC]:8192};const a="undefined"!=typeof window,s="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,f=a&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),CustomFile=(a||s)&&(f&&f.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),CustomFileReader=(a||s)&&(f&&f.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function getFilefromDataUrl(e,t,r=Date.now()){return new Promise(s=>{const n=e.split(","),i=n[0].match(/:(.*?);/)[1],o=globalThis.atob(n[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:i});c.name=t,c.lastModified=r,s(c)})}function getDataUrlFromFile(e){return new Promise((t,r)=>{const s=new CustomFileReader;s.onload=()=>t(s.result),s.onerror=e=>r(e),s.readAsDataURL(e)})}function loadImage(e){return new Promise((t,r)=>{const s=new Image;s.onload=()=>t(s),s.onerror=e=>r(e),s.src=e})}function getBrowserName(){if(void 0!==getBrowserName.cachedResult)return getBrowserName.cachedResult;let e=i$1.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=i$1.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=i$1.IOS:/Safari/i.test(t)?e=i$1.DESKTOP_SAFARI:/Firefox/i.test(t)?e=i$1.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=i$1.IE),getBrowserName.cachedResult=e,getBrowserName.cachedResult}function approximateBelowMaximumCanvasSizeOfBrowser(e,t){const r=getBrowserName(),s=o[r];let n=e,i=t,a=n*i;const l=n>i?i/n:n/i;for(;a>s*s;){const e=(s+n)/2,t=(s+i)/2;e<t?(i=t,n=t*l):(i=e*l,n=e),a=n*i}return{width:n,height:i}}function getNewCanvasAndCtx(e,t){let r,s;try{if(r=new OffscreenCanvas(e,t),s=r.getContext("2d"),null===s)throw new Error("getContext of OffscreenCanvas returns null")}catch(n){r=document.createElement("canvas"),s=r.getContext("2d")}return r.width=e,r.height=t,[r,s]}function drawImageInCanvas(e,t){const{width:r,height:s}=approximateBelowMaximumCanvasSizeOfBrowser(e.width,e.height),[n,i]=getNewCanvasAndCtx(r,s);return t&&/jpe?g/.test(t)&&(i.fillStyle="white",i.fillRect(0,0,n.width,n.height)),i.drawImage(e,0,0,n.width,n.height),n}function isIOS$1(){return void 0!==isIOS$1.cachedResult||(isIOS$1.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),isIOS$1.cachedResult}function drawFileInCanvas(e,t={}){return new Promise(function(r,s){let n,i;var o=function(){try{return i=drawImageInCanvas(n,t.fileType||e.type),r([n,i])}catch(o){return s(o)}},a=function(t){try{var r=function(e){try{throw e}catch(t){return s(t)}};try{let t;return getDataUrlFromFile(e).then(function(e){try{return t=e,loadImage(t).then(function(e){try{return n=e,function(){try{return o()}catch(e){return s(e)}}()}catch(t){return r(t)}},r)}catch(i){return r(i)}},r)}catch(i){r(i)}}catch(i){return s(i)}};try{if(isIOS$1()||[i$1.DESKTOP_SAFARI,i$1.MOBILE_SAFARI].includes(getBrowserName()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return n=e,o()}catch(t){return a()}},a)}catch(l){a()}})}function canvasToFile(e,t,s,n,i=1){return new Promise(function(o,a){let l;if("image/png"===t){let r,o,a;return r=e.getContext("2d"),({data:o}=r.getImageData(0,0,e.width,e.height)),a=UPNG.encode([o.buffer],e.width,e.height,4096*i),l=new Blob([a],{type:t}),l.name=s,l.lastModified=n,c.call(this)}{let o=function(){return c.call(this)};if("image/bmp"===t)return new Promise(t=>r.toBlob(e,t)).then(function(e){try{return l=e,l.name=s,l.lastModified=n,o.call(this)}catch(t){return a(t)}}.bind(this),a);{let r=function(){return o.call(this)};if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:i}).then(function(e){try{return l=e,l.name=s,l.lastModified=n,r.call(this)}catch(t){return a(t)}}.bind(this),a);{let o;return o=e.toDataURL(t,i),getFilefromDataUrl(o,s,n).then(function(e){try{return l=e,r.call(this)}catch(t){return a(t)}}.bind(this),a)}}}function c(){return o(l)}})}function cleanupCanvasMemory(e){e.width=0,e.height=0}function isAutoOrientationInBrowser(){return new Promise(function(e,t){let r,s,n,i;return void 0!==isAutoOrientationInBrowser.cachedResult?e(isAutoOrientationInBrowser.cachedResult):getFilefromDataUrl("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return r=o,drawFileInCanvas(r).then(function(o){try{return s=o[1],canvasToFile(s,r.type,r.name,r.lastModified).then(function(r){try{return n=r,cleanupCanvasMemory(s),drawFileInCanvas(n).then(function(r){try{return i=r[0],isAutoOrientationInBrowser.cachedResult=1===i.width&&2===i.height,e(isAutoOrientationInBrowser.cachedResult)}catch(s){return t(s)}},t)}catch(o){return t(o)}},t)}catch(a){return t(a)}},t)}catch(a){return t(a)}},t)})}function getExifOrientation(e){return new Promise((t,r)=>{const s=new CustomFileReader;s.onload=e=>{const r=new DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);const s=r.byteLength;let n=2;for(;n<s;){if(r.getUint16(n+2,!1)<=8)return t(-1);const e=r.getUint16(n,!1);if(n+=2,65505==e){if(1165519206!=r.getUint32(n+=2,!1))return t(-1);const e=18761==r.getUint16(n+=6,!1);n+=r.getUint32(n+4,e);const s=r.getUint16(n,e);n+=2;for(let i=0;i<s;i++)if(274==r.getUint16(n+12*i,e))return t(r.getUint16(n+12*i+8,e))}else{if(65280&~e)break;n+=r.getUint16(n,!1)}}return t(-1)},s.onerror=e=>r(e),s.readAsArrayBuffer(e)})}function handleMaxWidthOrHeight(e,t){const{width:r}=e,{height:s}=e,{maxWidthOrHeight:n}=t;let i,o=e;return isFinite(n)&&(r>n||s>n)&&([o,i]=getNewCanvasAndCtx(r,s),r>s?(o.width=n,o.height=s/r*n):(o.width=r/s*n,o.height=n),i.drawImage(e,0,0,o.width,o.height),cleanupCanvasMemory(e)),o}function followExifOrientation(e,t){const{width:r}=e,{height:s}=e,[n,i]=getNewCanvasAndCtx(r,s);switch(t>4&&t<9?(n.width=s,n.height=r):(n.width=r,n.height=s),t){case 2:i.transform(-1,0,0,1,r,0);break;case 3:i.transform(-1,0,0,-1,r,s);break;case 4:i.transform(1,0,0,-1,0,s);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,s,0);break;case 7:i.transform(0,-1,-1,0,s,r);break;case 8:i.transform(0,-1,1,0,0,r)}return i.drawImage(e,0,0,r,s),cleanupCanvasMemory(e),n}function compress(e,t,r=0){return new Promise(function(s,n){let i,o,a,l,c,u,d,p,m,h,x,f,g,y,v,E,j,b,w,R;function _(e=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;i+=e,t.onProgress(Math.min(i,100))}function S(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;i=Math.min(Math.max(e,i),100),t.onProgress(i)}return i=r,o=t.maxIteration||10,a=1024*t.maxSizeMB*1024,_(),drawFileInCanvas(e,t).then(function(r){try{return[,l]=r,_(),c=handleMaxWidthOrHeight(l,t),_(),new Promise(function(r,s){var n;if(!(n=t.exifOrientation))return getExifOrientation(e).then(function(e){try{return n=e,i.call(this)}catch(t){return s(t)}}.bind(this),s);function i(){return r(n)}return i.call(this)}).then(function(r){try{return u=r,_(),isAutoOrientationInBrowser().then(function(r){try{return d=r?c:followExifOrientation(c,u),_(),p=t.initialQuality||1,m=t.fileType||e.type,canvasToFile(d,m,e.name,e.lastModified,p).then(function(r){try{{let u=function(){if(o--&&(v>a||v>g)){let t,r;return t=R?.95*w.width:w.width,r=R?.95*w.height:w.height,[j,b]=getNewCanvasAndCtx(t,r),b.drawImage(w,0,0,t,r),p*="image/png"===m?.85:.95,canvasToFile(j,m,e.name,e.lastModified,p).then(function(e){try{return E=e,cleanupCanvasMemory(w),w=j,v=E.size,S(Math.min(99,Math.floor((y-v)/(y-a)*100))),u}catch(t){return n(t)}},n)}return[1]},C=function(){return cleanupCanvasMemory(w),cleanupCanvasMemory(j),cleanupCanvasMemory(c),cleanupCanvasMemory(d),cleanupCanvasMemory(l),S(100),s(E)};return h=r,_(),x=h.size>a,f=h.size>e.size,x||f?(g=e.size,y=h.size,v=y,w=d,R=!t.alwaysKeepResolution&&x,(i=function(e){for(;e;){if(e.then)return void e.then(i,n);try{if(e.pop){if(e.length)return e.pop()?C.call(this):e;e=u}else e=e.call(this)}catch(t){return n(t)}}}.bind(this))(u)):(S(100),s(h));var i}}catch(u){return n(u)}}.bind(this),n)}catch(i){return n(i)}}.bind(this),n)}catch(i){return n(i)}}.bind(this),n)}catch(i){return n(i)}}.bind(this),n)})}const l="\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n";let c;function compressOnWebWorker(e,t){return new Promise((r,s)=>{c||(c=function(e){const t=[];return t.push(e),URL.createObjectURL(new Blob(t))}(l));const n=new Worker(c);n.addEventListener("message",function(e){if(t.signal&&t.signal.aborted)n.terminate();else if(void 0===e.data.progress){if(e.data.error)return s(new Error(e.data.error)),void n.terminate();r(e.data.file),n.terminate()}else t.onProgress(e.data.progress)}),n.addEventListener("error",s),t.signal&&t.signal.addEventListener("abort",()=>{s(t.signal.reason),n.terminate()}),n.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})})}function imageCompression(e,t){return new Promise(function(r,s){let n,i,o,a,l,c;if(n={...t},o=0,({onProgress:a}=n),n.maxSizeMB=n.maxSizeMB||Number.POSITIVE_INFINITY,l="boolean"!=typeof n.useWebWorker||n.useWebWorker,delete n.useWebWorker,n.onProgress=e=>{o=e,"function"==typeof a&&a(o)},!(e instanceof Blob||e instanceof CustomFile))return s(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return s(new Error("The file given is not an image"));if(c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!l||"function"!=typeof Worker||c)return compress(e,n).then(function(e){try{return i=e,p.call(this)}catch(t){return s(t)}}.bind(this),s);var u=function(){try{return p.call(this)}catch(e){return s(e)}}.bind(this),d=function(t){try{return compress(e,n).then(function(e){try{return i=e,u()}catch(t){return s(t)}},s)}catch(r){return s(r)}};try{return n.libURL=n.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",compressOnWebWorker(e,n).then(function(e){try{return i=e,u()}catch(t){return d()}},d)}catch(m){d()}function p(){try{i.name=e.name,i.lastModified=e.lastModified}catch(m){}try{n.preserveExif&&"image/jpeg"===e.type&&(!n.fileType||n.fileType&&n.fileType===e.type)&&(i=copyExifWithoutOrientation(e,i))}catch(m){}return r(i)}})}imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage,imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.drawFileInCanvas=drawFileInCanvas,imageCompression.canvasToFile=canvasToFile,imageCompression.getExifOrientation=getExifOrientation,imageCompression.handleMaxWidthOrHeight=handleMaxWidthOrHeight,imageCompression.followExifOrientation=followExifOrientation,imageCompression.cleanupCanvasMemory=cleanupCanvasMemory,imageCompression.isAutoOrientationInBrowser=isAutoOrientationInBrowser,imageCompression.approximateBelowMaximumCanvasSizeOfBrowser=approximateBelowMaximumCanvasSizeOfBrowser,imageCompression.copyExifWithoutOrientation=copyExifWithoutOrientation,imageCompression.getBrowserName=getBrowserName,imageCompression.version="2.0.2";class ShowingsService{static async getStats(){const e=dayjs(),t=e.startOf("month").toISOString(),r=e.endOf("month").toISOString(),{data:s}=await supabase.rpc("filter_showings",{p_created_at_start:t,p_created_at_end:r,p_limit:1e3,p_offset:0}),n=(null==s?void 0:s.filter(e=>!e.invalid))||[],i=n.length,o=n.filter(e=>"直签"===e.viewresult).length,a=n.filter(e=>"预定"===e.viewresult).length,{count:l}=await supabase.from("showings_queue_record").select("id",{count:"exact",head:!0}).eq("queue_type","direct").eq("consumed",!1),{count:c}=await supabase.from("showings_queue_record").select("id",{count:"exact",head:!0}).eq("queue_type","skip").eq("consumed",!1),u=n.filter(e=>!e.viewresult||""===e.viewresult).length,d=o+a;return{monthShowings:i,monthDeals:d,conversionRate:Number((i&&d?d/i*100:0).toFixed(2)),directCount:l||0,skipCount:c||0,incompleteCount:u||0}}static async getViewResultOptions(){try{const{data:e,error:t}=await supabase.rpc("get_showings_viewresult_options");if(t)console.warn("RPC函数不存在，使用默认选项:",t.message);else if(e&&e.length>0)return console.log("✅ 从数据库获取看房结果选项:",e),"string"==typeof e[0]?e.map(e=>({value:e,label:e})):e}catch(t){console.error("获取看房结果选项失败:",t)}try{const{data:e,error:t}=await supabase.from("showings").select("viewresult").not("viewresult","is",null).not("viewresult","eq","");if(!t&&e){const t=[...new Set(e.map(e=>e.viewresult))];if(t.length>0){const e=t.map(e=>({value:e,label:e}));return console.log("✅ 从showings表获取看房结果选项:",e),e}}}catch(r){console.error("从showings表查询看房结果失败:",r)}const e=[{value:"直签",label:"直签"},{value:"预定",label:"预定"},{value:"意向金",label:"意向金"},{value:"考虑中",label:"考虑中"},{value:"已流失",label:"已流失"}];return console.log("✅ 使用默认看房结果选项:",e),e}static async getCommunityOptions(){try{const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"community"});if(t)throw t;return(e||[]).map(e=>({value:e,label:e}))}catch(e){return console.error("获取社区选项失败:",e),[]}}static async getSalesOptions(){try{const{data:e}=await supabase.from("users_profile").select("id, nickname").eq("status","active").order("nickname");return(e||[]).map(e=>({value:e.id,label:e.nickname}))}catch(e){return console.error("获取销售员选项失败:",e),[]}}static extractOptionsFromData(e){const t=new Set;e.forEach(e=>{e.interviewsales_nickname&&t.add(e.interviewsales_nickname)});const r=Array.from(t).map(e=>({value:e,label:e})),s=new Set;e.forEach(e=>{e.trueshowingsales_nickname&&s.add(e.trueshowingsales_nickname)});return{interviewsalesOptions:r,trueshowingsalesOptions:Array.from(s).map(e=>({value:e,label:e}))}}static async getQueueCardDetails(e){try{const{data:t,error:r}=await supabase.from("showings_queue_record").select("*").eq("queue_type",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){return console.error("获取卡片明细失败:",t),staticMethods.error("获取卡片明细失败"),[]}}static async submitRollbackApplication(e,t,r){try{const{data:s,error:n}=await supabase.from("approval_instances").select("id, status").eq("type","showing_rollback").eq("target_id",e.id).in("status",["pending","processing"]);if(n)throw n;if(s&&s.length>0)return staticMethods.error("该带看记录已提交回退申请，请勿重复提交"),!1;const{data:i,error:o}=await supabase.from("approval_flows").select("id").eq("type","showing_rollback").maybeSingle();if(o||!i)return staticMethods.error("未找到带看回退审批流模板，请联系管理员配置"),!1;const{error:a}=await supabase.from("approval_instances").insert({flow_id:i.id,type:"showing_rollback",target_table:"showings",target_id:e.id,status:"pending",created_by:r,config:{reason:t.reason,evidence:t.evidence,leadid:t.leadid}});if(a)throw a;return staticMethods.success("带看回退申请已提交，等待审批"),!0}catch(s){return staticMethods.error("回退提交失败: "+(s.message||s.toString())),!1}}static async uploadRollbackEvidence(e){const t=[];try{for(const r of e){const e={maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0},s=await imageCompression(r,e),n=r.name.split(".").pop(),i=`rollback/${`rollback-${toBeijingTime(new Date).valueOf()}-${Math.floor(1e4*Math.random())}.${n}`}`,{error:o}=await supabase.storage.from("rollback").upload(i,s);if(o)throw o;const{data:a}=supabase.storage.from("rollback").getPublicUrl(i);t.push(a.publicUrl)}return t}catch(r){throw staticMethods.error("图片上传失败: "+(r.message||r.toString())),r}}static getViewResultColor(e){return{"直签":"success","预定":"processing","意向金":"processing","考虑中":"warning","已流失":"error"}[e]||"default"}static maskPhone(e){return e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"-"}static maskWechat(e){return e?e.length<4?e:e.substring(0,2)+"****"+e.substring(e.length-2):"-"}static getRollbackReasonOptions(){return[{value:"临时取消",label:"临时取消"},{value:"无效客户",label:"无效客户"},{value:"重复带看",label:"重复带看"},{value:"其他原因",label:"其他原因"}]}static async getShowings(e={}){const{data:t,error:r}=await supabase.rpc("filter_showings",{p_leadid:e.leadid,p_community:e.community,p_showingsales:e.showingsales,p_trueshowingsales:e.trueshowingsales,p_interviewsales:e.interviewsales,p_viewresult:e.viewresult,p_budget_min:e.budget_min,p_budget_max:e.budget_max,p_renttime_min:e.renttime_min,p_renttime_max:e.renttime_max,p_scheduletime_start:e.scheduletime_start,p_scheduletime_end:e.scheduletime_end,p_arrivaltime_start:e.arrivaltime_start,p_arrivaltime_end:e.arrivaltime_end,p_moveintime_start:e.moveintime_start,p_moveintime_end:e.moveintime_end,p_created_at_start:e.created_at_start,p_created_at_end:e.created_at_end,p_order_by:e.orderBy||"created_at",p_ascending:e.ascending||!1,p_limit:e.limit||10,p_offset:e.offset||0,p_incomplete:e.incomplete||!1});if(r)throw r;return t}static async getShowingsCount(e={}){const{data:t,error:r}=await supabase.rpc("get_showings_count",{p_leadid:e.leadid,p_community:e.community,p_showingsales:e.showingsales,p_trueshowingsales:e.trueshowingsales,p_interviewsales:e.interviewsales,p_viewresult:e.viewresult,p_budget_min:e.budget_min,p_budget_max:e.budget_max,p_renttime_min:e.renttime_min,p_renttime_max:e.renttime_max,p_scheduletime_start:e.scheduletime_start,p_scheduletime_end:e.scheduletime_end,p_arrivaltime_start:e.arrivaltime_start,p_arrivaltime_end:e.arrivaltime_end,p_moveintime_start:e.moveintime_start,p_moveintime_end:e.moveintime_end,p_created_at_start:e.created_at_start,p_created_at_end:e.created_at_end,p_incomplete:e.incomplete||!1});if(r)throw r;return t||0}static async createShowing(e){const{data:t,error:r}=await supabase.from("showings").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]}static async updateShowing(e,t){console.log("🔄 服务层更新数据:",{id:e,showingData:t});const r=Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t));console.log("🔄 服务层过滤后数据:",r);const{data:s,error:n}=await supabase.from("showings").update(r).eq("id",e).select();if(n)throw console.error("🔄 服务层更新失败:",n),n;return console.log("🔄 服务层更新成功:",s),null==s?void 0:s[0]}static async deleteShowing(e){const{error:t}=await supabase.from("showings").delete().eq("id",e);if(t)throw t}}const{TextArea:TextArea$5}=Input$1,{RangePicker:RangePicker$3}=DatePicker$2,ShowingsList=()=>{const{profile:e}=useUser(),[t,r]=reactExports.useState([]),[s,n]=reactExports.useState(!1),[i,o]=reactExports.useState(0),[a,l]=reactExports.useState(1),[c,u]=reactExports.useState(10),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState(null),[x]=Form$4.useForm(),[f,g]=reactExports.useState({}),[y,v]=reactExports.useState(!1),[E,j]=reactExports.useState(null),[b,w]=reactExports.useState(),[R,_]=reactExports.useState([]),[S,C]=reactExports.useState(!1),[k,$]=reactExports.useState(!1),[T,I]=reactExports.useState(""),[P,A]=reactExports.useState([]),[F,M]=reactExports.useState([]),[D,O]=reactExports.useState([]),[N,B]=reactExports.useState([]),[L,z]=reactExports.useState([]),[V,U]=reactExports.useState({monthShowings:0,monthDeals:0,conversionRate:0,directCount:0,skipCount:0,incompleteCount:0}),[H,W]=reactExports.useState(null),[q,G]=reactExports.useState({visible:!1,type:null}),[Y,K]=reactExports.useState([]),[X,J]=reactExports.useState(!1),[Z,Q]=reactExports.useState(!1),ee=async()=>{try{const e=await ShowingsService.getStats();U(e)}catch(e){console.error("获取统计数据失败:",e),staticMethods.error("获取统计数据失败")}};reactExports.useEffect(()=>{ee()},[]),reactExports.useEffect(()=>{te(),re(),ee()},[a,c,f]);const te=async()=>{try{const e=await ShowingsService.getCommunityOptions();A(e),await(async()=>{try{const e=await ShowingsService.getViewResultOptions();M(e)}catch(e){console.error("获取看房结果选项失败:",e)}})();const t=await ShowingsService.getSalesOptions();O(t)}catch(e){console.error("获取销售选项失败:",e)}},re=async()=>{n(!0);try{const e=(a-1)*c,[t,s]=await Promise.all([ShowingsService.getShowings({...f,limit:c,offset:e,orderBy:"created_at",ascending:!1}),ShowingsService.getShowingsCount(f)]);console.log("🖥️ 电脑端传递给RPC函数的参数:",{filters:f,limit:c,offset:e,orderBy:"created_at",ascending:!1}),console.log("🖥️ 电脑端 getShowings返回的数据:",t),t&&t.length>0&&(console.log("🖥️ 电脑端 第一条记录的字段:",Object.keys(t[0])),console.log("🖥️ 电脑端 第一条记录的约访管家信息:",{interviewsales_nickname:t[0].interviewsales_nickname,interviewsales_user_id:t[0].interviewsales_user_id})),r(t||[]),o(s),(e=>{const t=ShowingsService.extractOptionsFromData(e);B(t.interviewsalesOptions),z(t.trueshowingsalesOptions)})(t||[])}catch(e){staticMethods.error("获取带看记录失败: "+e.message)}finally{n(!1)}},se=e=>{e.forEach(e=>{e.preview&&e.preview.startsWith("blob:")&&URL.revokeObjectURL(e.preview)})},ne=[{title:"线索编号",dataIndex:"leadid",key:"leadid",width:120,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"搜索线索ID",value:t[0],onChange:t=>e(t.target.value?[t.target.value]:[]),onPressEnter:()=>r(),style:{width:188,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$8,{}),size:"small",style:{width:90,marginRight:8},children:"搜索"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>s&&s(),size:"small",style:{width:90},children:"重置"})]}),onFilter:(e,t)=>{var r;return!!(null==(r=t.leadid)?void 0:r.toString().includes(String(e)))},render:e=>jsxRuntimeExports.jsx(Tooltip,{title:"点击查看线索详情",children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>{I(e),$(!0)},children:e})})},{title:"手机号",dataIndex:"lead_phone",key:"lead_phone",width:130,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"搜索手机号",value:t[0],onChange:t=>e(t.target.value?[t.target.value]:[]),onPressEnter:()=>r(),style:{width:188,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$8,{}),size:"small",style:{width:90,marginRight:8},children:"搜索"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>s&&s(),size:"small",style:{width:90},children:"重置"})]}),onFilter:(e,t)=>{var r;return!!(null==(r=t.lead_phone)?void 0:r.toString().includes(String(e)))},render:e=>ShowingsService.maskPhone(e)},{title:"微信号",dataIndex:"lead_wechat",key:"lead_wechat",width:130,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"搜索微信号",value:t[0],onChange:t=>e(t.target.value?[t.target.value]:[]),onPressEnter:()=>r(),style:{width:188,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$8,{}),size:"small",style:{width:90,marginRight:8},children:"搜索"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>s&&s(),size:"small",style:{width:90},children:"重置"})]}),onFilter:(e,t)=>{var r;return!!(null==(r=t.lead_wechat)?void 0:r.toString().includes(String(e)))},render:e=>ShowingsService.maskWechat(e)},{title:"带看社区",dataIndex:"community",key:"community",filters:P.map(e=>({text:e.label,value:e.value})),onFilter:(e,t)=>t.community===e,width:120,render:e=>e||"-"},{title:"预约时间",dataIndex:"scheduletime",key:"scheduletime",width:150,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8,minWidth:200,display:"flex",flexDirection:"column",justifyContent:"center"},children:[jsxRuntimeExports.jsx(RangePicker$3,{showTime:!0,value:t[0]||void 0,onChange:t=>e(t&&2===t.length?[t]:[]),style:{width:200,marginBottom:8,height:32,fontSize:13},className:"table-filter-range-picker",placeholder:["开始日期","结束日期"],allowClear:!0}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>r(),children:"筛 选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>s&&s(),children:"重 置"})]})]}),onFilter:(e,t)=>{const r=e;if(!r||!Array.isArray(r)||2!==r.length)return!0;const[s,n]=r;if(!t.scheduletime)return!1;const i=dayjs(t.scheduletime);return i.isAfter(s)&&i.isBefore(n)},render:e=>e?dayjs(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"到达时间",dataIndex:"arrivaltime",key:"arrivaltime",width:150,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8,minWidth:200},children:[jsxRuntimeExports.jsx(RangePicker$3,{showTime:!0,value:t[0]||void 0,onChange:t=>e(t&&2===t.length?[t]:[]),style:{width:200,marginBottom:8,height:32,fontSize:13},className:"table-filter-range-picker",placeholder:["开始日期","结束日期"],allowClear:!0}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>r(),children:"筛 选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>s&&s(),children:"重 置"})]})]}),onFilter:(e,t)=>{const r=e;if(!r||!Array.isArray(r)||2!==r.length)return!0;const[s,n]=r;if(!t.arrivaltime)return!1;const i=dayjs(t.arrivaltime);return i.isAfter(s)&&i.isBefore(n)},render:e=>e?dayjs(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"约访管家",dataIndex:"interviewsales_nickname",key:"interviewsales",width:120,filters:N.map(e=>({text:e.label,value:e.value})),onFilter:(e,t)=>t.interviewsales_nickname===e,filterSearch:!0,render:e=>jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",color:"#000"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#bfbfbf",marginRight:6,fontSize:18}}),e||"-"]})},{title:"分配管家",dataIndex:"showingsales_nickname",key:"showingsales",filters:D.map(e=>({text:e.label,value:e.label})),onFilter:(e,t)=>t.showingsales_nickname===e,filterSearch:!0,width:120,render:e=>jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",color:"#000"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#bfbfbf",marginRight:6,fontSize:18}}),e||"-"]})},{title:"实际带看管家",dataIndex:"trueshowingsales_nickname",key:"trueshowingsales",width:120,filters:L.map(e=>({text:e.label,value:e.value})),onFilter:(e,t)=>t.trueshowingsales_nickname===e,filterSearch:!0,render:e=>jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",color:"#000"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#bfbfbf",marginRight:6,fontSize:18}}),e||"-"]})},{title:"看房结果",dataIndex:"viewresult",key:"viewresult",filters:F.map(e=>({text:e.label,value:e.value})),onFilter:(e,t)=>t.viewresult===e,width:100,render:(e,t)=>t.invalid?jsxRuntimeExports.jsx(Tag$1,{color:"error",children:"无效"}):jsxRuntimeExports.jsx(Tag$1,{color:ShowingsService.getViewResultColor(e),children:e})},{title:"预算",dataIndex:"budget",key:"budget",width:100,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>{const[n,i]=t[0]||[void 0,void 0];return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最小值",value:n,onChange:t=>e(void 0!==t&&void 0!==i?[[t,i]]:[[t,void 0]]),style:{width:90,marginBottom:8,display:"inline-block",marginRight:8}}),jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最大值",value:i,onChange:t=>e(void 0!==n&&void 0!==t?[[n,t]]:[[void 0,t]]),style:{width:90,marginBottom:8,display:"inline-block"}}),jsxRuntimeExports.jsxs("div",{style:{marginTop:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),size:"small",style:{width:90,marginRight:8},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>s&&s(),size:"small",style:{width:90},children:"重置"})]})]})},onFilter:(e,t)=>{const[r,s]=e||[void 0,void 0];return void 0!==r&&void 0!==s?t.budget>=r&&t.budget<=s:void 0!==r?t.budget>=r:void 0===s||t.budget<=s},render:e=>"number"==typeof e?`¥${e.toLocaleString()}`:"-"},{title:"入住时间",dataIndex:"moveintime",key:"moveintime",width:150,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8,minWidth:200},children:[jsxRuntimeExports.jsx(RangePicker$3,{value:t[0]||void 0,onChange:t=>e(t&&2===t.length?[t]:[]),style:{width:200,marginBottom:8,height:32,fontSize:13},className:"table-filter-range-picker",placeholder:["开始日期","结束日期"],allowClear:!0}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>r(),children:"筛 选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1,height:28,fontSize:13},onClick:()=>s&&s(),children:"重 置"})]})]}),onFilter:(e,t)=>{const r=e;if(!r||!Array.isArray(r)||2!==r.length)return!0;const[s,n]=r;if(!t.moveintime)return!1;const i=dayjs(t.moveintime);return i.isAfter(s)&&i.isBefore(n)},render:e=>e?dayjs(e).format("YYYY-MM-DD"):"-"},{title:"租期(月)",dataIndex:"renttime",key:"renttime",width:100,filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>{const[n,i]=t[0]||[void 0,void 0];return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最小值",value:n,onChange:t=>e(void 0!==t&&void 0!==i?[[t,i]]:[[t,void 0]]),style:{width:90,marginBottom:8,display:"inline-block",marginRight:8}}),jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最大值",value:i,onChange:t=>e(void 0!==n&&void 0!==t?[[n,t]]:[[void 0,t]]),style:{width:90,marginBottom:8,display:"inline-block"}}),jsxRuntimeExports.jsxs("div",{style:{marginTop:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),size:"small",style:{width:90,marginRight:8},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>s&&s(),size:"small",style:{width:90},children:"重置"})]})]})},onFilter:(e,t)=>{const[r,s]=e||[void 0,void 0];return void 0!==r&&void 0!==s?t.renttime>=r&&t.renttime<=s:void 0!==r?t.renttime>=r:void 0===s||t.renttime<=s},render:e=>"number"==typeof e?`${e}个月`:"-"},{title:"备注",dataIndex:"remark",key:"remark",width:200,ellipsis:!0,render:e=>jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx("span",{children:e})})},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:150,render:e=>dayjs(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"action",width:140,fixed:"right",render:(e,t)=>jsxRuntimeExports.jsxs("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",minHeight:"60px"},children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>(e=>{h(e),x.setFieldsValue({...e,scheduletime:e.scheduletime?dayjs(e.scheduletime):null,arrivaltime:e.arrivaltime?dayjs(e.arrivaltime):null,moveintime:e.moveintime?dayjs(e.moveintime):null,interviewsales_user_id:e.interviewsales_user_id,showingsales:e.showingsales}),p(!0)})(t),style:{padding:"4px 8px",fontSize:"14px",borderRadius:"4px",border:"none",background:"transparent",color:"#1677ff",width:"100%",textAlign:"center",height:"28px",lineHeight:"1"},children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$d,{}),onClick:()=>(e=>{j(e),v(!0)})(t),disabled:t.invalid,style:{padding:"4px 8px",fontSize:"14px",borderRadius:"4px",border:"none",background:"transparent",color:t.invalid?"#bfbfbf":"#ff4d4f",width:"100%",textAlign:"center",height:"28px",lineHeight:"1",cursor:t.invalid?"not-allowed":"pointer"},children:t.invalid?"已回退":"回退"})]})}],ie=e=>{G({visible:!0,type:e}),(async e=>{J(!0);try{const t=await ShowingsService.getQueueCardDetails(e);K(t)}catch(t){console.error("获取卡片明细失败:",t)}finally{J(!1)}})(e)},oe=()=>{g({}),l(1),W(null)},ae=jsxRuntimeExports.jsxs(Row,{gutter:16,style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",style:{textAlign:"center",backgroundColor:"#ffffff",border:"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"本月带看量"}),jsxRuntimeExports.jsx("div",{style:{fontSize:24,fontWeight:700},children:V.monthShowings})]})}),jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",style:{textAlign:"center",backgroundColor:"#ffffff",border:"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"本月成交量"}),jsxRuntimeExports.jsx("div",{style:{fontSize:24,fontWeight:700},children:V.monthDeals})]})}),jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",className:"card-hover",style:{textAlign:"center",backgroundColor:"#ffffff",border:"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},onClick:()=>{Q(!0)},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"带看转化率"}),jsxRuntimeExports.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#000000"},children:[V.conversionRate,"%"]}),jsxRuntimeExports.jsx("div",{className:"zoom-icon",style:{position:"absolute",bottom:"8px",right:"8px",color:"#8c8c8c",opacity:.7,transition:"all 0.3s ease"},children:jsxRuntimeExports.jsx(RefIcon$e,{style:{fontSize:"16px"}})})]})}),jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",className:"card-hover",style:{textAlign:"center",cursor:"pointer",backgroundColor:"direct"===H?"#f6ffed":"#ffffff",border:"direct"===H?"2px solid #1677ff":"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.3s ease",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},onClick:()=>ie("direct"),children:[jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"直通卡数量"}),jsxRuntimeExports.jsx("div",{style:{fontSize:24,fontWeight:700},children:V.directCount}),jsxRuntimeExports.jsx("div",{className:"zoom-icon",style:{position:"absolute",bottom:"8px",right:"8px",color:"#8c8c8c",opacity:.7,transition:"all 0.3s ease"},children:jsxRuntimeExports.jsx(RefIcon$e,{style:{fontSize:"16px"}})})]})}),jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",className:"card-hover",style:{textAlign:"center",cursor:"pointer",backgroundColor:"skip"===H?"#f6ffed":"#ffffff",border:"skip"===H?"2px solid #1677ff":"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.3s ease",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},onClick:()=>ie("skip"),children:[jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"轮空卡数量"}),jsxRuntimeExports.jsx("div",{style:{fontSize:24,fontWeight:700},children:V.skipCount}),jsxRuntimeExports.jsx("div",{className:"zoom-icon",style:{position:"absolute",bottom:"8px",right:"8px",color:"#8c8c8c",opacity:.7,transition:"all 0.3s ease"},children:jsxRuntimeExports.jsx(RefIcon$e,{style:{fontSize:"16px"}})})]})}),jsxRuntimeExports.jsx(Col,{span:4,children:jsxRuntimeExports.jsxs(Card$1,{variant:"borderless",className:"card-hover",style:{textAlign:"center",cursor:"pointer",backgroundColor:"incomplete"===H?"#fff2f0":"#ffffff",border:"incomplete"===H?"2px solid #ff4d4f":"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.3s ease",position:"relative",height:"120px",display:"flex",flexDirection:"column",justifyContent:"center"},onClick:()=>(g({incomplete:!0}),l(1),void W("incomplete")),children:["incomplete"===H&&jsxRuntimeExports.jsx(Button$1,{type:"text",size:"small",style:{position:"absolute",top:"4px",right:"4px",padding:"2px 4px",minWidth:"auto",height:"20px",fontSize:"12px",color:"#ff4d4f",border:"none",background:"transparent"},onClick:e=>{e.stopPropagation(),oe()},children:"✕"}),jsxRuntimeExports.jsx("div",{style:{fontSize:14,color:"#888"},children:"工单未填写数量"}),jsxRuntimeExports.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#ff4d4f"},children:V.incompleteCount}),jsxRuntimeExports.jsx("div",{className:"zoom-icon",style:{position:"absolute",bottom:"8px",right:"8px",color:"#8c8c8c",opacity:.7,transition:"all 0.3s ease"},children:jsxRuntimeExports.jsx(RefIcon$e,{style:{fontSize:"16px"}})})]})})]});return jsxRuntimeExports.jsxs("div",{style:{padding:"24px"},children:[ae,H&&jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,padding:"8px 16px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsxs("span",{style:{color:"#52c41a",fontSize:14},children:["incomplete"===H&&"当前显示：未填写工单","direct"===H&&"当前显示：直通卡明细","skip"===H&&"当前显示：轮空卡明细"]}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:oe,style:{color:"#52c41a",padding:0},children:"清除筛选"})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:ne,dataSource:t,rowKey:"id",loading:s,pagination:{current:a,pageSize:c,total:i,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{l(e),u(t)}},scroll:{x:"max-content",y:600},size:"small",bordered:!1,className:"rounded-lg overflow-hidden",rowClassName:()=>"compact-table-row",tableLayout:"fixed",sticky:!0}),jsxRuntimeExports.jsx(Modal$2,{title:m?"编辑带看记录":"新增带看记录",open:d,onCancel:()=>{p(!1),h(null),x.resetFields()},footer:null,width:800,children:jsxRuntimeExports.jsxs(Form$4,{form:x,layout:"vertical",onFinish:async e=>{var t,r,s;try{const n={...e,scheduletime:null==(t=e.scheduletime)?void 0:t.toISOString(),arrivaltime:null==(r=e.arrivaltime)?void 0:r.toISOString(),moveintime:null==(s=e.moveintime)?void 0:s.toISOString()};delete n.interviewsales_user_id,m?(await ShowingsService.updateShowing(m.id,n),staticMethods.success("更新带看记录成功！")):(await ShowingsService.createShowing(n),staticMethods.success("添加带看记录成功！")),p(!1),x.resetFields(),h(null),re()}catch(n){staticMethods.error("操作失败: "+n.message)}},children:[jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:m?jsxRuntimeExports.jsxs("div",{style:{background:"#f8f9fa",padding:"16px",borderRadius:"8px",marginBottom:"16px",border:"1px solid #e9ecef"},children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:"#495057",marginBottom:"16px",display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{style:{marginRight:"8px"},children:"📋"}),"线索信息"]}),jsxRuntimeExports.jsxs(Row,{gutter:[24,16],children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#6c757d",marginBottom:"6px",fontWeight:500},children:"线索ID"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500,lineHeight:"1.4"},children:m.leadid})]})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#6c757d",marginBottom:"6px",fontWeight:500},children:"社区"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500,lineHeight:"1.4"},children:m.community||"-"})]})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#6c757d",marginBottom:"6px",fontWeight:500},children:"预约时间"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500,lineHeight:"1.4"},children:m.scheduletime?dayjs(m.scheduletime).format("YYYY-MM-DD HH:mm"):"-"})]})})]}),jsxRuntimeExports.jsxs(Row,{gutter:[24,16],style:{marginTop:"8px"},children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#6c757d",marginBottom:"6px",fontWeight:500},children:"约访销售"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500,lineHeight:"1.4"},children:m.interviewsales_nickname||"-"})]})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#6c757d",marginBottom:"6px",fontWeight:500},children:"带看销售"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500,lineHeight:"1.4"},children:m.showingsales_nickname||"-"})]})})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"线索ID",name:"leadid",rules:[{required:!0,message:"请输入线索ID"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入线索ID"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"社区",name:"community",children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择社区",allowClear:!0,children:P.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"预约时间",name:"scheduletime",children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,placeholder:"请选择预约时间",style:{width:"100%"}})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"约访销售",name:"interviewsales_user_id",children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择约访销售",allowClear:!0,children:D.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})})})]}),jsxRuntimeExports.jsx(Row,{gutter:16,children:jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"带看销售",name:"showingsales",children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择带看销售",allowClear:!0,children:D.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})})})})]})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"到达时间",name:"arrivaltime",rules:[{required:!0,message:"请选择到达时间"}],children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,placeholder:"请选择到达时间",style:{width:"100%"}})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"实际带看管家",name:"trueshowingsales",rules:[{required:!0,message:"请选择管家"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择管家",allowClear:!0,children:D.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"看房结果",name:"viewresult",rules:[{required:!0,message:"请选择看房结果"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择看房结果",allowClear:!0,children:F.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"预算",name:"budget",rules:[{required:!0,message:"请输入预算"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"请输入预算",style:{width:"100%"},formatter:e=>`¥ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/¥\s?|(,*)/g,"")})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"入住时间",name:"moveintime",rules:[{required:!0,message:"请选择入住时间"}],children:jsxRuntimeExports.jsx(DatePicker$2,{placeholder:"请选择入住时间",style:{width:"100%"}})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"租期(月)",name:"renttime",rules:[{required:!0,message:"请输入租期"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"请输入租期",style:{width:"100%"},min:1})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{label:"备注",name:"remark",rules:[{required:!0,message:"请输入备注"}],children:jsxRuntimeExports.jsx(TextArea$5,{rows:3,placeholder:"请输入备注"})}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginTop:"16px"},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:m?"更新":"创建"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{p(!1),h(null),x.resetFields()},children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Drawer,{open:k,onClose:()=>{$(!1),I("")},title:"线索详情",width:800,destroyOnHidden:!0,placement:"right",children:T&&jsxRuntimeExports.jsx(LeadDetailDrawer,{leadid:T})}),jsxRuntimeExports.jsx(Modal$2,{title:"direct"===q.type?"直通卡明细":"skip"===q.type?"轮空卡明细":"",open:q.visible,onCancel:()=>G({visible:!1,type:null}),footer:null,width:800,children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:Y,loading:X,rowKey:"id",size:"small",columns:[{title:"用户ID",dataIndex:"user_id",width:100},{title:"社区",dataIndex:"community",width:120},{title:"创建时间",dataIndex:"created_at",width:180,render:e=>e?dayjs(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"已消耗",dataIndex:"consumed",width:80,render:e=>e?"是":"否"},{title:"消耗时间",dataIndex:"consumed_at",width:180,render:e=>e?dayjs(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"操作理由",dataIndex:"remark",width:200,render:e=>e||"-",ellipsis:!0}],pagination:{pageSize:10}})}),jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontWeight:600,color:"#262626"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"18px"},children:"📊"}),jsxRuntimeExports.jsx("span",{children:"带看转化率统计"})]}),open:Z,onCancel:()=>Q(!1),footer:null,width:1200,centered:!0,styles:{body:{padding:"24px"}},style:{borderRadius:"8px",overflow:"hidden"},maskStyle:{backgroundColor:"rgba(0, 0, 0, 0.45)"},children:jsxRuntimeExports.jsx(ShowingConversionRate,{})}),jsxRuntimeExports.jsxs(Modal$2,{title:"带看回退操作",open:y,onCancel:()=>{v(!1),se(R),j(null),w(void 0),_([])},onOk:async()=>{let t=!1;if(b||(staticMethods.error("请选择回退理由"),t=!0),0===R.length&&(staticMethods.error("请上传回退证据"),t=!0),(null==e?void 0:e.id)||(staticMethods.error("用户信息获取失败"),t=!0),!t){C(!0);try{const t=R.filter(e=>!e.url).map(e=>e.file),r=await ShowingsService.uploadRollbackEvidence(t),s=[...R.filter(e=>e.url).map(e=>e.url),...r],n={reason:b,evidence:s,leadid:(null==E?void 0:E.leadid)||""};await ShowingsService.submitRollbackApplication(E,n,e.id)&&(v(!1),se(R),j(null),w(void 0),_([]))}catch(e2){staticMethods.error("回退提交失败: "+(e2.message||e2.toString()))}C(!1)}},okText:"确认回退",cancelText:"取消",confirmLoading:S,destroyOnHidden:!0,width:600,children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:8,fontWeight:600},children:"带看信息"}),jsxRuntimeExports.jsxs("div",{style:{padding:12,background:"#f5f5f5",borderRadius:6},children:[jsxRuntimeExports.jsxs("div",{children:["线索ID: ",null==E?void 0:E.leadid]}),jsxRuntimeExports.jsxs("div",{children:["社区: ",(null==E?void 0:E.community)||"-"]}),jsxRuntimeExports.jsxs("div",{children:["带看时间: ",(null==E?void 0:E.arrivaltime)?dayjs(E.arrivaltime).format("YYYY-MM-DD HH:mm"):"-"]}),jsxRuntimeExports.jsxs("div",{children:["看房结果: ",(null==E?void 0:E.viewresult)||"-"]}),jsxRuntimeExports.jsxs("div",{children:["带看管家: ",(null==E?void 0:E.showingsales_nickname)||"-"]})]})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:8,fontWeight:400},children:[jsxRuntimeExports.jsx("span",{style:{color:"#ff4d4f"},children:"*"})," 回退理由"]}),jsxRuntimeExports.jsx(Select,{placeholder:"请选择回退理由",value:b,onChange:w,style:{width:"100%"},options:ShowingsService.getRollbackReasonOptions()})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:8,fontWeight:400},children:[jsxRuntimeExports.jsx("span",{style:{color:"#ff4d4f"},children:"*"})," 回退证据"]}),jsxRuntimeExports.jsx(Upload,{listType:"picture-card",fileList:R.map((e,t)=>({uid:t.toString(),name:e.name,status:"done",url:e.preview,thumbUrl:e.preview})),beforeUpload:async e=>{const t=await imageCompression(e,{maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),r=URL.createObjectURL(t);return _(s=>[...s,{file:t,preview:r,name:e.name}]),!1},onRemove:e=>{(e=>{_(t=>{const r=t[e];return(null==r?void 0:r.preview)&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview),t.filter((t,r)=>r!==e)})})(parseInt(e.uid))},maxCount:5,children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(RefIcon$f,{}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:"上传"})]})}),jsxRuntimeExports.jsx("div",{style:{fontSize:12,color:"#666",marginTop:8},children:"支持jpg、png格式，最多5张，每张不超过500KB"})]}),jsxRuntimeExports.jsxs("div",{style:{padding:12,background:"#fff7e6",borderRadius:6,border:"1px solid #ffd591"},children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:14,fontWeight:600,color:"#d46b08",marginBottom:4},children:[jsxRuntimeExports.jsx("span",{style:{marginRight:4},children:"💡"}),"回退说明"]}),jsxRuntimeExports.jsx("div",{style:{fontSize:12,color:"#666"},children:"审批通过后，该带看记录将被标记为无效，同时为您发放一张直通卡作为补偿。"})]})]})]})};async function getCurrentProfileId(){const{data:{user:e}}=await supabase.auth.getUser();if(!e)return null;const{data:t,error:r}=await supabase.from("users_profile").select("id").eq("user_id",e.id).single();return r?null:t.id}async function getUserPointsInfo(e){const{data:t,error:r}=await supabase.rpc("get_user_points_info",{p_user_id:e});if(r)throw r;return t}async function getExchangeGoods(e,t){const{data:r,error:s}=await supabase.rpc("get_exchange_goods",{p_category:e,p_user_id:t});if(s)throw s;return r}async function exchangeGoodsItem(e,t,r){const{data:s,error:n}=await supabase.rpc("exchange_goods_item",{p_user_id:e,p_goods_id:t,p_description:r});if(n)throw console.error("exchangeGoodsItem API 错误:",n),n;if(s.success&&s.exchange_record_id)try{const{data:e,error:t}=await supabase.functions.invoke("issue-direct-card",{body:{exchange_record_id:s.exchange_record_id}});t?console.error("issue-direct-card 调用失败:",t):console.log("issue-direct-card 调用成功:",e)}catch(i){console.error("issue-direct-card 调用异常:",i)}return s}async function filterPointsTransactions(e,t={}){let r=supabase.from("user_points_transactions").select("*").eq("user_id",e);Object.entries(t).forEach(([e,t])=>{null==t||""===t||["orderBy","ascending","limit","offset"].includes(e)||(r=r.eq(e,t))}),r=t.orderBy?r.order(t.orderBy,{ascending:!!t.ascending}):r.order("created_at",{ascending:!1}),t.limit&&(r=r.limit(t.limit)),t.offset&&(r=r.range(t.offset,t.offset+(t.limit||10)-1));const{data:s,error:n}=await r;if(n)throw n;return s}async function getAllUserPointsWallets(){const{data:e,error:t}=await supabase.from("user_points_wallet").select("*");if(t)throw t;return e}async function submitPointsAdjustApproval({user_id:e,points:t,remark:r,created_by:s}){const{data:n,error:i}=await supabase.from("approval_flows").select("id").eq("type","points_adjust").maybeSingle();if(i||!n)throw new Error("未配置积分调整审批流");const{error:o}=await supabase.from("approval_instances").insert({flow_id:n.id,type:"points_adjust",target_table:"user_points_wallet",target_id:`${e}_${Date.now()}`,status:"pending",created_by:s,config:{user_id:e,points:t,remark:r}});if(o)throw o;return!0}const statusIcon=e=>e.can_allocate?jsxRuntimeExports.jsx(RefIcon$g,{style:{color:"#36cfc9",fontSize:18}}):Array.isArray(e.reason)&&e.reason.length>0?jsxRuntimeExports.jsx(RefIcon$h,{style:{color:"#faad14",fontSize:18}}):jsxRuntimeExports.jsx(RefIcon$h,{style:{color:"#ff4d4f",fontSize:18}}),AllocationStatusCard=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!0);reactExports.useEffect(()=>{(async()=>{s(!0);const e=await getCurrentProfileId();if(!e)return t([]),void s(!1);const{data:r}=await supabase.rpc("get_user_allocation_status_multi",{p_user_id:e});Array.isArray(r)?t(r):t([]),s(!1)})()},[]);const n=e.some(e=>!e.can_allocate);return jsxRuntimeExports.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:16,fontWeight:700,color:"#222",marginBottom:8,textAlign:"left",flex:"0 0 auto",background:"#fff",zIndex:2,display:"flex",alignItems:"center",gap:8},children:[jsxRuntimeExports.jsx("span",{children:"我的销售组"}),e.length>0&&(n?jsxRuntimeExports.jsx("span",{style:{background:"#ffeded",color:"#ff4d4f",borderRadius:8,fontSize:12,padding:"2px 10px",fontWeight:500,marginLeft:0},children:"异常"}):jsxRuntimeExports.jsx("span",{style:{background:"#e6fffb",color:"#36cfc9",borderRadius:8,fontSize:12,padding:"2px 10px",fontWeight:500,marginLeft:0},children:"正常"}))]}),jsxRuntimeExports.jsx("div",{style:{flex:1,overflowY:"auto"},children:r?jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:16},children:jsxRuntimeExports.jsx(Spin,{})}):0===e.length?jsxRuntimeExports.jsx("div",{style:{color:"#999",textAlign:"center",padding:12},children:"暂无分配组信息"}):e.map((e,t)=>{const r=!e.can_allocate&&Array.isArray(e.reason)&&e.reason.length>0?e.reason.join("；"):"";return jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",background:"#f6faff",borderRadius:16,padding:"10px 16px",boxShadow:"0 1px 4px 0 rgba(0,0,0,0.03)",fontSize:15,fontWeight:500,minHeight:38,marginBottom:10},children:[jsxRuntimeExports.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[jsxRuntimeExports.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",display:"inline-block"},children:e.groupname||"无"}),r&&jsxRuntimeExports.jsx("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:2,textAlign:"left",wordBreak:"break-all"},children:r})]}),jsxRuntimeExports.jsx("span",{style:{display:"flex",alignItems:"center",marginLeft:12},children:statusIcon(e)})]},t)})})]})};async function fetchBanners(){const{data:e,error:t}=await supabase.from("banners").select("*").order("sort_order",{ascending:!1});if(t)throw t;return e||[]}async function fetchBannersByPageType(e){const{data:t,error:r}=await supabase.from("banners").select("*").eq("page_type",e).eq("is_active",!0).order("sort_order",{ascending:!1});if(r)throw r;return t||[]}async function createBanner(e){const{data:t,error:r}=await supabase.from("banners").insert([e]).select().single();if(r)throw r;return t}async function updateBanner(e,t){const{data:r,error:s}=await supabase.from("banners").update(t).eq("id",e).select().single();if(s)throw s;return r}async function deleteBanner(e){const{error:t}=await supabase.from("banners").delete().eq("id",e);if(t)throw t;return!0}const rankingTabs=[{key:"creator",label:"劳模榜",data:[{id:1,name:"梁伟",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=1",value:215,followed:!1},{id:2,name:"任菲菲",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=2",value:164,followed:!1},{id:3,name:"李士军",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=3",value:166,followed:!1},{id:4,name:"唐攀",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=4",value:150,followed:!1},{id:5,name:"康萍",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=5",value:153,followed:!1},{id:6,name:"周轩元",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=6",value:144,followed:!1},{id:7,name:"罗兰兰",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=7",value:140,followed:!1},{id:8,name:"张桃",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=8",value:139,followed:!1}]},{key:"popular",label:"人气榜",data:[{id:1,name:"人气王",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=9",value:999,followed:!1},{id:2,name:"小红",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=10",value:888,followed:!1},{id:3,name:"小蓝",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=11",value:777,followed:!1}]},{key:"new",label:"新人榜",data:[{id:1,name:"新手1号",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=12",value:10,followed:!1},{id:2,name:"新手2号",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=13",value:8,followed:!1},{id:3,name:"新手3号",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=14",value:7,followed:!1}]}],gradientBg="linear-gradient(135deg, #ffe0e9 0%, #fff6e0 100%)",RankingBoard=()=>{const[e,t]=reactExports.useState("creator"),[r,s]=reactExports.useState({}),n=(rankingTabs.find(t=>t.key===e)||rankingTabs[0]).data,i={id:999,name:"本人昵称",avatar:"https://api.dicebear.com/7.x/miniavs/svg?seed=me",value:120,rank:null},o=n.findIndex(e=>e.id===i.id);return-1!==o&&(i.rank=o+1,i.value=n[o].value),jsxRuntimeExports.jsxs("div",{style:{background:gradientBg,borderRadius:18,boxShadow:"0 4px 16px rgba(255,107,53,0.08)",padding:"20px",width:"100%",height:"100%",position:"relative",fontSize:13,display:"flex",flexDirection:"column",overflow:"hidden"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8,fontSize:16},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:16,fontWeight:700,color:"#d97b2b",marginRight:8,whiteSpace:"nowrap"},children:"管家排行榜"}),jsxRuntimeExports.jsx("span",{style:{fontSize:20,marginLeft:2},children:"👑"}),jsxRuntimeExports.jsx("span",{style:{marginLeft:"auto",fontSize:11,color:"#999",whiteSpace:"nowrap"},children:"更新日期：2024-06-24"})]}),jsxRuntimeExports.jsx(Tabs,{activeKey:e,onChange:t,items:rankingTabs.map(e=>({key:e.key,label:e.label})),style:{marginBottom:0},tabBarStyle:{fontWeight:600,fontSize:13}}),jsxRuntimeExports.jsxs("div",{style:{flex:1,overflowY:"auto",paddingTop:20,minHeight:0},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[n[1]&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,margin:"0 6px 0 0",position:"relative"},children:[jsxRuntimeExports.jsxs("div",{style:{width:50,height:50,borderRadius:"50%",border:"2px solid #c0c0c0",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:2},children:[jsxRuntimeExports.jsx(Avatar$1,{src:n[1].avatar,size:40}),jsxRuntimeExports.jsx("span",{style:{position:"absolute",top:-14,left:"50%",transform:"translateX(-50%)",fontSize:11,fontWeight:700,color:"#fff",background:"#c0c0c0",borderRadius:8,padding:"1px 7px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",zIndex:2},children:"TOP.2"})]}),jsxRuntimeExports.jsx("span",{style:{fontWeight:600,fontSize:13,marginBottom:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n[1].name}),jsxRuntimeExports.jsxs("span",{style:{fontSize:11,color:"#d97b2b",fontWeight:500,whiteSpace:"nowrap"},children:["成交",n[1].value,"套"]})]}),n[0]&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,margin:0,position:"relative"},children:[jsxRuntimeExports.jsxs("div",{style:{width:60,height:60,borderRadius:"50%",border:"2px solid #ffd700",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px #ffd70033",marginBottom:2},children:[jsxRuntimeExports.jsx(Avatar$1,{src:n[0].avatar,size:48}),jsxRuntimeExports.jsx("span",{style:{position:"absolute",top:-14,left:"50%",transform:"translateX(-50%)",fontSize:11,fontWeight:700,color:"#fff",background:"#ffd700",borderRadius:8,padding:"1px 7px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",zIndex:2},children:"TOP.1"})]}),jsxRuntimeExports.jsx("span",{style:{fontWeight:600,fontSize:13,marginBottom:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n[0].name}),jsxRuntimeExports.jsxs("span",{style:{fontSize:11,color:"#d97b2b",fontWeight:500,whiteSpace:"nowrap"},children:["成交",n[0].value,"套"]})]}),n[2]&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,margin:"0 0 0 6px",position:"relative"},children:[jsxRuntimeExports.jsxs("div",{style:{width:50,height:50,borderRadius:"50%",border:"2px solid #cd7f32",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:2},children:[jsxRuntimeExports.jsx(Avatar$1,{src:n[2].avatar,size:40}),jsxRuntimeExports.jsx("span",{style:{position:"absolute",top:-14,left:"50%",transform:"translateX(-50%)",fontSize:11,fontWeight:700,color:"#fff",background:"#cd7f32",borderRadius:8,padding:"1px 7px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",zIndex:2},children:"TOP.3"})]}),jsxRuntimeExports.jsx("span",{style:{fontWeight:600,fontSize:13,marginBottom:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n[2].name}),jsxRuntimeExports.jsxs("span",{style:{fontSize:11,color:"#d97b2b",fontWeight:500,whiteSpace:"nowrap"},children:["成交",n[2].value,"套"]})]})]}),jsxRuntimeExports.jsx("div",{children:n.slice(3).map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 0",borderBottom:"1px solid #f7e6d6",fontSize:13},children:[jsxRuntimeExports.jsx("span",{style:{width:20,textAlign:"center",fontWeight:700,color:"#d97b2b",fontSize:13},children:t+4}),jsxRuntimeExports.jsx(Avatar$1,{src:e.avatar,size:28,style:{margin:"0 8px"}}),jsxRuntimeExports.jsx("span",{style:{flex:1,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),jsxRuntimeExports.jsxs("span",{style:{color:"#d97b2b",fontSize:11,marginRight:6,whiteSpace:"nowrap"},children:["成交",e.value,"套"]}),jsxRuntimeExports.jsx(Button$1,{size:"small",type:r[e.id]?"default":"primary",style:{borderRadius:16,minWidth:44,fontSize:12,height:22},onClick:()=>{return t=e.id,void s(e=>({...e,[t]:!e[t]}));var t},children:r[e.id]?"已关注":"关注"})]},e.id))})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:10,background:"#fff9f2",borderRadius:10,padding:"7px 10px",display:"flex",alignItems:"center",minHeight:36,boxShadow:"0 2px 8px rgba(255,107,53,0.04)",fontSize:13},children:[jsxRuntimeExports.jsx(Avatar$1,{src:i.avatar,size:22,style:{marginRight:8}}),jsxRuntimeExports.jsx("span",{style:{fontWeight:500,fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i.name}),i.rank?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{style:{marginLeft:10,color:"#d97b2b",fontWeight:600},children:["第",i.rank,"名"]}),jsxRuntimeExports.jsxs("span",{style:{marginLeft:8,color:"#d97b2b",fontSize:11},children:["成交",i.value,"套"]})]}):jsxRuntimeExports.jsx("span",{style:{marginLeft:10,color:"#bbb",fontWeight:500},children:"未上榜"})]})]})},mockData=[{id:"1",title:"1*0888续租",tag:"特急",tagColor:"red",due:"11月18日 18:00",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"190006",status:"todo"},{id:"2",title:"提交小红书勤奋度",tag:"特急",tagColor:"red",due:"3小时后",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"190006",status:"todo"},{id:"3",title:"发布小红书内容",tag:"一般",tagColor:"blue",due:"明天",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"180056",status:"todo"},{id:"4",title:"2*0666房租催收",tag:"重要",tagColor:"orange",due:"11月19日 12:00",owner:"霍勒斯",starter:"我",startTime:"11月18日 15:05",code:"180064",status:"todo"},{id:"5",title:"提交月度绩效报告",tag:"重要",tagColor:"orange",due:"11月20日 17:00",owner:"我",starter:"我",startTime:"11月18日 15:05",code:"180065",status:"todo"},{id:"6",title:"3*0999房间清洁检查",tag:"一般",tagColor:"blue",due:"11月21日 14:00",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"180066",status:"todo"},{id:"7",title:"4*0555租客投诉处理",tag:"特急",tagColor:"red",due:"11月18日 20:00",owner:"霍勒斯",starter:"我",startTime:"11月18日 15:05",code:"180067",status:"todo"},{id:"8",title:"5*0777水电费催缴",tag:"一般",tagColor:"blue",due:"11月22日 16:00",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"180068",status:"todo"},{id:"9",title:"6*0444房间维修跟进",tag:"重要",tagColor:"orange",due:"11月23日 10:00",owner:"霍勒斯",starter:"我",startTime:"11月18日 15:05",code:"180069",status:"done"},{id:"10",title:"7*0333租客退房手续",tag:"一般",tagColor:"blue",due:"11月24日 15:00",owner:"麦莉",starter:"我",startTime:"11月18日 15:05",code:"180070",status:"done"}],TodoCenter=()=>{const[e,t]=reactExports.useState(mockData),[r,s]=reactExports.useState("todo"),n=e.filter(e=>"todo"===e.status),i=e.filter(e=>"done"===e.status),o=reactExports.useMemo(()=>n.sort((e,t)=>e.due||t.due?e.due?t.due?e.due.localeCompare(t.due):-1:1:0),[n]),a=reactExports.useMemo(()=>i.sort((e,t)=>e.due||t.due?e.due?t.due?e.due.localeCompare(t.due):-1:1:0),[i]),l=e=>{const r="特急"===e.tag;let s="",n="";if(e.due){const t=e.due.match(/^(\d{1,2}月\d{1,2}日)[\s ]?(\d{1,2}:\d{2})?$/);t?(s=t[1],n=t[2]||""):s=e.due}return jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"8px 0",borderBottom:"1px solid #f3f3f3"},children:[jsxRuntimeExports.jsx(Checkbox,{checked:"done"===e.status,onChange:r=>{return s=e.id,n=r.target.checked,void t(e=>e.map(e=>e.id===s?{...e,status:n?"done":"todo"}:e));var s,n},style:{marginTop:2,marginRight:10}}),jsxRuntimeExports.jsxs("div",{style:{flex:1},children:[jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center"},children:jsxRuntimeExports.jsx(Tooltip,{title:e.title,placement:"topLeft",children:jsxRuntimeExports.jsx("span",{style:{fontSize:13,fontWeight:500,color:"done"===e.status?"#bbb":r?"#ff4d4f":"#222",textDecoration:"done"===e.status?"line-through":"none",maxWidth:150,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",verticalAlign:"middle"},children:e.title})})}),jsxRuntimeExports.jsxs("div",{style:{color:"#bbb",fontSize:11,marginTop:2,textAlign:"left"},children:[e.starter&&jsxRuntimeExports.jsx("span",{children:"我发起的"})," ",e.startTime&&jsxRuntimeExports.jsx("span",{style:{marginLeft:8},children:e.startTime})]})]}),jsxRuntimeExports.jsxs("div",{style:{minWidth:56,textAlign:"right",color:"#888",fontSize:12,marginLeft:8,marginRight:8,display:"flex",flexDirection:"column",alignItems:"flex-end",lineHeight:1.2},children:[jsxRuntimeExports.jsx("span",{children:s}),n&&jsxRuntimeExports.jsx("span",{children:n})]})]},e.id)};return jsxRuntimeExports.jsxs("div",{style:{width:"100%",height:"100%",background:"#fff",borderRadius:18,boxShadow:"0 4px 16px rgba(255,107,53,0.08)",padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#222",marginBottom:8,textAlign:"left"},children:"待办中心"}),jsxRuntimeExports.jsx(Tabs,{activeKey:r,onChange:e=>s(e),items:[{key:"todo",label:`未开始 (${n.length})`,children:jsxRuntimeExports.jsx("div",{style:{height:360,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#d9d9d9 #f5f5f5"},children:0===o.length?jsxRuntimeExports.jsx("div",{style:{color:"#bbb",fontSize:13,padding:"12px 0"},children:"暂无待办任务"}):o.map(e=>l(e))})},{key:"done",label:`已完成 (${i.length})`,children:jsxRuntimeExports.jsx("div",{style:{height:360,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#d9d9d9 #f5f5f5"},children:0===a.length?jsxRuntimeExports.jsx("div",{style:{color:"#bbb",fontSize:13,padding:"12px 0"},children:"暂无已完成任务"}):a.map(e=>l(e))})}],size:"small",style:{marginTop:0},tabBarStyle:{marginBottom:8}})]})};function getWeekNumber(e){const t=new Date(e.getFullYear(),0,1),r=(e-t)/864e5+1;return Math.ceil((r+t.getDay())/7)}function aggregateByWeek(e){const t=new Map;return e.forEach(e=>{const r=new Date(e.date),s=`${r.getFullYear()}-W${getWeekNumber(r)}`;t.has(s)||t.set(s,{date:s,leads:0,deals:0});const n=t.get(s);n.leads+=e.leads,n.deals+=e.deals}),Array.from(t.values())}const PerformanceDashboard=({trendData:e=[{date:"2024-07-01",leads:10,deals:1},{date:"2024-07-02",leads:12,deals:2},{date:"2024-07-03",leads:15,deals:3},{date:"2024-07-04",leads:18,deals:2},{date:"2024-07-05",leads:20,deals:4},{date:"2024-07-06",leads:16,deals:5},{date:"2024-07-07",leads:19,deals:3}],title:t="成交进度",className:r,style:s,showTrendChart:n=!0,showStatsCards:i=!0,height:o,leads30Days:a=320,deals30Days:l=27,leadsChange:c=12.5,dealsChange:u=-5.2,showSlider:d=!0,defaultRange:p=[Math.max(0,e.length-7),e.length-1],onEnlarge:m})=>{const[h,x]=reactExports.useState(p),f=reactExports.useRef(h),g=a>0?Math.round(l/a*100*100)/100:0,y=e=>{const t=new Date(e);if(isNaN(t.getTime()))return e;return`${String(t.getFullYear()).slice(2)}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},v=reactExports.useMemo(()=>e.map(e=>{const t=new Date(e.date);if(isNaN(t.getTime()))return e;const r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return{...e,date:`${r}-${s}-${n}`}}),[e]),E=reactExports.useMemo(()=>v.slice(h[0],h[1]+1),[v,h]),j=h[1]-h[0]+1<=7,b=reactExports.useMemo(()=>{if(j)return[...E.map(e=>({date:e.date,value:"number"==typeof e.leads?e.leads:0,type:"线索量"})),...E.map(e=>({date:e.date,value:"number"==typeof e.deals?e.deals:0,type:"成交量"}))];{const e=aggregateByWeek(E);return[...e.map(e=>({date:e.date,value:"number"==typeof e.leads?e.leads:0,type:"线索量"})),...e.map(e=>({date:e.date,value:"number"==typeof e.deals?e.deals:0,type:"成交量"}))]}},[E,j]),w=reactExports.useRef(null),[R,_]=reactExports.useState(void 0);reactExports.useLayoutEffect(()=>{w.current&&_(w.current.offsetHeight)},[o]);const S={data:b,xField:"date",yField:"value",seriesField:"type",height:"100%",smooth:!0,color:["#1890ff","#52c41a"],legend:{position:"top"},point:{size:3,shape:"circle"},padding:0,marginBottom:30,animation:{appear:{animation:"path-in",duration:1e3}},xAxis:{tickCount:j?7:void 0,label:{autoHide:!1,autoRotate:!0,formatter:e=>/W\d+$/.test(e)?e.replace(/^\d{4}-/,"W"):y(e)}},scrollbar:{type:"horizontal"},tooltip:{customContent:(e,t)=>`<div style="padding:4px 8px;font-size:14px;">${y(e)}</div>`+t.map(e=>`<div style="margin:2px 0;">\n              <span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${e.color};margin-right:6px;"></span>\n              ${e.name}: ${e.value}\n            </div>`).join("")}},C=e=>e>0?jsxRuntimeExports.jsxs("span",{style:{color:"#52c41a",fontSize:11},children:[jsxRuntimeExports.jsx(RefIcon$j,{})," +",e,"%"]}):e<0?jsxRuntimeExports.jsxs("span",{style:{color:"#ff4d4f",fontSize:11},children:[jsxRuntimeExports.jsx(RefIcon$k,{})," ",e,"%"]}):jsxRuntimeExports.jsx("span",{style:{color:"#8c8c8c",fontSize:11},children:"0%"});return jsxRuntimeExports.jsxs("div",{className:r,style:{minHeight:0,height:o??"100%",borderRadius:18,background:"#fff",padding:20,boxShadow:"0 1px 4px rgba(0,0,0,0.03)",display:"flex",flexDirection:"column",...s},children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:16,fontWeight:700,color:"#222",marginBottom:8,textAlign:"left",flex:"0 0 auto",background:"#fff",zIndex:2,display:"flex",alignItems:"center",gap:8,justifyContent:"space-between"},children:[jsxRuntimeExports.jsx("span",{children:t}),m&&jsxRuntimeExports.jsx(Button$1,{type:"text",icon:jsxRuntimeExports.jsx(RefIcon$i,{style:{fontSize:22,transition:"transform 0.18s"}}),onClick:m,style:{color:"#1890ff",fontSize:20,boxShadow:"none",padding:0,marginLeft:4,background:"none",border:"none",borderRadius:6,transition:"background 0.18s, transform 0.18s",display:"flex",alignItems:"center",justifyContent:"center",outline:"none"},title:"放大查看",size:"small",tabIndex:-1,onMouseDown:e=>e.preventDefault(),onMouseOver:e=>{e.currentTarget.style.background="#e6f4ff",e.currentTarget.style.transform="scale(1.12)"},onMouseOut:e=>{e.currentTarget.style.background="none",e.currentTarget.style.transform="scale(1)"}})]}),i&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:6,marginBottom:8,flexWrap:"wrap",minHeight:0,flex:"0 0 auto"},children:[jsxRuntimeExports.jsxs(Card$1,{size:"small",style:{flex:1,minWidth:90,maxWidth:120,borderRadius:18,border:"1px solid #f0f0f0",boxShadow:"0 4px 16px rgba(52,107,255,0.08)",padding:0},styles:{body:{padding:6}},children:[jsxRuntimeExports.jsx(Statistic,{title:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"30天线索量"}),value:a,suffix:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"条"}),valueStyle:{fontSize:15,fontWeight:600,color:"#1890ff"}}),jsxRuntimeExports.jsx("div",{style:{marginTop:2},children:C(c)})]}),jsxRuntimeExports.jsxs(Card$1,{size:"small",style:{flex:1,minWidth:90,maxWidth:120,borderRadius:18,border:"1px solid #f0f0f0",boxShadow:"0 4px 16px rgba(52,107,255,0.08)",padding:0},styles:{body:{padding:6}},children:[jsxRuntimeExports.jsx(Statistic,{title:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"30天成交量"}),value:l,suffix:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"单"}),valueStyle:{fontSize:15,fontWeight:600,color:"#52c41a"}}),jsxRuntimeExports.jsx("div",{style:{marginTop:2},children:C(u)})]}),jsxRuntimeExports.jsxs(Card$1,{size:"small",style:{flex:1,minWidth:90,maxWidth:120,borderRadius:18,border:"1px solid #f0f0f0",boxShadow:"0 4px 16px rgba(52,107,255,0.08)",padding:0},styles:{body:{padding:6}},children:[jsxRuntimeExports.jsx(Statistic,{title:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"30天转化率"}),value:g,suffix:jsxRuntimeExports.jsx("span",{style:{fontSize:11},children:"%"}),precision:1,valueStyle:{fontSize:15,fontWeight:600,color:"#722ed1"}}),jsxRuntimeExports.jsx("div",{style:{marginTop:2,fontSize:10,color:"#8c8c8c"},children:"线索→成交"})]})]}),n&&jsxRuntimeExports.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsx("div",{ref:w,style:{flex:1,minHeight:0,height:"100%"},children:jsxRuntimeExports.jsx(LineChart,{...{...S,height:R??200}})}),d&&jsxRuntimeExports.jsx("div",{style:{padding:"0 20px"},children:jsxRuntimeExports.jsx(Slider,{range:{draggableTrack:!0},min:0,max:e.length-1,value:h,onChange:t=>(t=>{const r=f.current,s=r[1]-r[0];if(t[1]-t[0]===s&&t[0]!==r[0]&&t[1]!==r[1]){const n=t[0]-r[0];let i=r[0]+n,o=r[1]+n;return i<0&&(i=0,o=i+s),o>e.length-1&&(o=e.length-1,i=o-s),x([i,o]),void(f.current=[i,o])}x(t),f.current=t})(t),step:1,style:{width:"100%"}})})]})]})},Index=()=>{const e=useNavigate(),[t,r]=reactExports.useState(0),[s,n]=reactExports.useState([]),i=reactExports.useRef(null),[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(!0),[u,d]=reactExports.useState(!1);reactExports.useEffect(()=>{c(!0),fetchBannersByPageType("home").then(e=>{n(e||[]),c(!1)}).catch(()=>{c(!1)})},[]),reactExports.useEffect(()=>(i.current&&clearTimeout(i.current),s.length>0&&(i.current=setTimeout(()=>{r(e=>(e+1)%s.length)},3e3)),()=>{i.current&&clearTimeout(i.current)}),[t,s.length]);const p=(()=>{const e=[];for(let t=29;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t);const s=toBeijingDateStr(r);e.push({date:s,leads:Math.floor(10*Math.random()+10),deals:Math.floor(5*Math.random()+1)})}return e})();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{children:"\n        .ant-carousel {\n          display: block ;\n          position: relative ;\n        }\n        .ant-carousel .slick-dots-bottom {\n          position: absolute ;\n          left: 0;\n          right: 0;\n          bottom: 16px ;\n          top: auto ;\n          width: 100%;\n          text-align: center;\n          margin: 0;\n          z-index: 10;\n        }\n        \n        /* 响应式布局样式 */\n        .homepage-container {\n          background: #f5f6fa;\n          width: 100%;\n          min-height: 100%;\n        }\n        \n        .homepage-row {\n          height: 80vh;\n          padding: 16px;\n        }\n        \n        .homepage-col-left {\n          height: 80vh;\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .homepage-col-center {\n          height: 80vh;\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .homepage-col-right {\n          height: 80vh;\n        }\n        \n        .banner-container {\n          width: 100%;\n          aspect-ratio: 3.84/1;\n          position: relative;\n          background: #364d79;\n          border-radius: 10px;\n          overflow: hidden;\n          box-shadow: 0 4px 16px rgba(52,107,255,0.08);\n          margin-bottom: 16px;\n          flex: none;\n        }\n        \n        .performance-container {\n          flex: 1;\n          min-height: 0;\n        }\n        \n        .sales-group-container {\n          width: 100%;\n          margin-bottom: 16;\n          flex: none;\n          display: flex;\n          align-items: stretch;\n        }\n        \n        .todo-container {\n          flex: 1;\n          min-height: 0;\n        }\n        \n        /* 小屏幕响应式布局 */\n        @media (max-width: 768px) {\n          .homepage-row {\n            height: auto;\n            padding: 12px;\n          }\n          \n          .homepage-col-left,\n          .homepage-col-center,\n          .homepage-col-right {\n            height: auto;\n            margin-bottom: 16px;\n          }\n          \n          .banner-container {\n            aspect-ratio: 3.84/1;\n            margin-bottom: 12px;\n          }\n          \n          .performance-container {\n            margin-bottom: 16px;\n          }\n          \n          .sales-group-container {\n            margin-bottom: 12px;\n          }\n          \n          .todo-container {\n            margin-bottom: 16px;\n          }\n        }\n      "}),l&&jsxRuntimeExports.jsx(LoadingScreen,{type:"data"}),jsxRuntimeExports.jsx("div",{className:"homepage-container",children:jsxRuntimeExports.jsxs(Row,{gutter:24,className:"homepage-row",children:[jsxRuntimeExports.jsxs(Col,{xs:24,sm:24,md:12,lg:12,xl:12,className:"homepage-col-left",children:[jsxRuntimeExports.jsxs("div",{className:"banner-container",children:[s.length>0&&s.map((r,s)=>jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:s===t?1:0,zIndex:s===t?2:1,transition:"opacity 0.5s",pointerEvents:s===t?"auto":"none"},children:jsxRuntimeExports.jsx("img",{src:r.image_url,alt:r.title,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:10,background:"#222",cursor:r.jump_type&&"none"!==r.jump_type?"pointer":"default",display:"block"},onClick:()=>(t=>{t.jump_type&&"none"!==t.jump_type&&("url"===t.jump_type&&t.jump_target?window.open(t.jump_target,"_blank"):"route"===t.jump_type&&t.jump_target?e(t.jump_target):"iframe"===t.jump_type&&t.jump_target&&a(t.jump_target))})(r)})},r.id)),jsxRuntimeExports.jsx(Modal$2,{open:!!o,onCancel:()=>a(null),footer:null,width:1e3,styles:{body:{padding:16,height:600}},destroyOnHidden:!0,centered:!0,children:o&&jsxRuntimeExports.jsx("iframe",{src:o,style:{width:"100%",height:600,border:"none",borderRadius:16},title:"嵌入页面"})}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:16,width:"100%",textAlign:"center",zIndex:10,display:"flex",justifyContent:"center",gap:16},children:s.map((e,s)=>jsxRuntimeExports.jsx("span",{onClick:()=>(e=>{r(e)})(s),style:{display:"inline-block",width:32,height:6,borderRadius:3,background:s===t?"#fff":"rgba(255,255,255,0.3)",cursor:"pointer",transition:"background 0.3s"}},s))})]}),jsxRuntimeExports.jsx("div",{className:"performance-container",children:jsxRuntimeExports.jsx(PerformanceDashboard,{trendData:p,leads30Days:320,deals30Days:27,leadsChange:12.5,dealsChange:-5.2,currentDeals:27,targetDeals:50,onEnlarge:()=>d(!0)})}),jsxRuntimeExports.jsx(Modal$2,{open:u,onCancel:()=>d(!1),width:1080,footer:null,centered:!0,children:jsxRuntimeExports.jsx(PerformanceDashboard,{trendData:p.slice(-14),leads30Days:320,deals30Days:27,leadsChange:12.5,dealsChange:-5.2,currentDeals:27,targetDeals:50,showSlider:!0,height:600,defaultRange:[7,13]})})]}),jsxRuntimeExports.jsxs(Col,{xs:24,sm:24,md:6,lg:6,xl:6,className:"homepage-col-center",children:[jsxRuntimeExports.jsx("div",{className:"sales-group-container",children:jsxRuntimeExports.jsx(Card$1,{style:{borderRadius:18,width:"100%",aspectRatio:"3.84/2.08",boxShadow:"0 4px 16px rgba(52,107,255,0.08)",background:"#fff",display:"flex",flexDirection:"column",justifyContent:"flex-start",padding:0},styles:{body:{padding:16,flex:1,overflowY:"auto",minHeight:0},header:{display:"none"}},variant:"borderless",children:jsxRuntimeExports.jsx(AllocationStatusCard,{})})}),jsxRuntimeExports.jsx("div",{className:"todo-container",children:jsxRuntimeExports.jsx(TodoCenter,{})})]}),jsxRuntimeExports.jsx(Col,{xs:24,sm:24,md:6,lg:6,xl:6,className:"homepage-col-right",children:jsxRuntimeExports.jsx(RankingBoard,{})})]})})]})};function Error404(){const e=useNavigate();return jsxRuntimeExports.jsx(Result,{status:"404",title:"404 页面未找到",subTitle:"您访问的页面不存在",extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>e("/"),children:"返回首页"})})}function Error403(){const e=useNavigate();return jsxRuntimeExports.jsx(Result,{status:"403",title:"403 无权限访问",subTitle:"您没有权限访问该页面",extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>e("/"),children:"返回首页"})})}function Error500(){const e=useNavigate();return jsxRuntimeExports.jsx(Result,{status:"500",title:"500 服务器错误",subTitle:"服务器发生错误，请稍后重试",extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>e("/"),children:"返回首页"})})}async function getDeals(e={}){const{data:t,error:r}=await supabase.rpc("filter_deals",{p_id:e.id,p_leadid:e.leadid,p_contractdate_start:e.contractdate_start,p_contractdate_end:e.contractdate_end,p_community:e.community,p_contractnumber:e.contractnumber,p_roomnumber:e.roomnumber,p_created_at_start:e.created_at_start,p_created_at_end:e.created_at_end,p_source:e.source,p_order_by:e.orderBy||"created_at",p_ascending:e.ascending||!1,p_limit:e.limit||10,p_offset:e.offset||0});if(r)throw r;return t}async function getDealsCount(e={}){const{data:t,error:r}=await supabase.rpc("get_deals_count",{p_id:e.id,p_leadid:e.leadid,p_contractdate_start:e.contractdate_start,p_contractdate_end:e.contractdate_end,p_community:e.community,p_contractnumber:e.contractnumber,p_roomnumber:e.roomnumber,p_created_at_start:e.created_at_start,p_created_at_end:e.created_at_end,p_source:e.source});if(r)throw r;return t||0}async function getDealsCommunityOptions(){const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"community"});if(t)throw t;return e||[]}async function getDealsSourceOptions(){const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"source"});if(t)throw t;return e||[]}async function createDeal(e){const{data:t,error:r}=await supabase.from("deals").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]}async function updateDeal(e,t){const{data:r,error:s}=await supabase.from("deals").update(t).eq("id",e).select();if(s)throw s;return null==r?void 0:r[0]}async function getAvailableLeadIds(){const{data:e,error:t}=await supabase.from("followups").select("leadid").not("leadid","is",null).order("created_at",{ascending:!1});if(t)throw t;return[...new Set(e.map(e=>e.leadid))].map(e=>({value:e,label:e}))}async function getUsersProfile(){const{data:e,error:t}=await supabase.from("users_profile").select("*").order("nickname",{ascending:!0});if(t)throw t;return e||[]}const{Title:Title$f}=Typography,{Option:Option$a}=Select,{RangePicker:RangePicker$2}=DatePicker$2,DealsList=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(0),[o,a]=reactExports.useState(1),[l,c]=reactExports.useState(10),[u,d]=reactExports.useState({}),[p,m]=reactExports.useState({}),[h,x]=reactExports.useState({}),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState(""),[E,j]=reactExports.useState(!1),[b,w]=reactExports.useState(null),[R]=Form$4.useForm(),[_,S]=reactExports.useState(!1),[C,k]=reactExports.useState(!1),[$]=Form$4.useForm(),[T,I]=reactExports.useState(!1),[P,A]=reactExports.useState([]),[F,M]=reactExports.useState([]),[D,O]=reactExports.useState([]),[N,B]=reactExports.useState([]);reactExports.useEffect(()=>{L(),z()},[o,l,u,p,h]);const L=async()=>{try{const e=await getDealsCommunityOptions();A(e.map(e=>({value:e,label:e})));const t=await getDealsSourceOptions();O(t.map(e=>({value:e,label:e})));const r=await getAvailableLeadIds();B(r);const s=await getUsersProfile();M(s.map(e=>({value:e.id,label:e.nickname})))}catch(e){console.error("获取选项失败:",e)}},z=async()=>{s(!0);try{const e=(o-1)*l,r={...u,limit:l,offset:e,orderBy:p.columnKey||"created_at",ascending:"ascend"===p.order||!1},s={...u},[n,a]=await Promise.all([getDeals(r),getDealsCount(s)]);t(n||[]),i(a)}catch(e){staticMethods.error("获取成交记录失败: "+e.message)}finally{s(!1)}},V=[{title:"合同日期",dataIndex:"contractdate",key:"contractdate",width:100,sorter:!0,sortOrder:"contractdate"===p.columnKey&&p.order,filterDropdown:e=>{const{setSelectedKeys:t,selectedKeys:r,confirm:s,clearFilters:n}=e;let i;return r&&r[0]&&Array.isArray(r[0])&&(i=[r[0][0]?dayjs(r[0][0]):null,r[0][1]?dayjs(r[0][1]):null]),jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(RangePicker$2,{value:i,onChange:e=>{e&&2===e.length&&e[0]&&e[1]?t([[e[0].format("YYYY-MM-DD"),e[1].format("YYYY-MM-DD")]]):t([])},style:{marginBottom:8,display:"block"},allowClear:!0}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>s(),style:{width:60},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{n&&n(),s()},size:"small",style:{width:60},children:"重置"})]})]})},filteredValue:h.contractdate||null,render:e=>e?dayjs(e).format("YYYY-MM-DD"):"-"},{title:"线索编号",dataIndex:"leadid",key:"leadid",width:120,sorter:!0,sortOrder:"leadid"===p.columnKey&&p.order,filterDropdown:e=>{const{setSelectedKeys:t,selectedKeys:r,confirm:s,clearFilters:n}=e;return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"输入线索编号",value:r[0]||"",onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:188,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>s(),style:{width:60},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{n&&n(),s()},size:"small",style:{width:60},children:"重置"})]})]})},filteredValue:h.leadid||null,render:e=>jsxRuntimeExports.jsx(Tooltip,{title:"点击查看线索详情",children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>{v(e),g(!0)},style:{padding:0,height:"auto"},children:e})})},{title:"约访管家",dataIndex:"interviewsales",key:"interviewsales",width:100,sorter:!0,sortOrder:"interviewsales"===p.columnKey&&p.order,filters:F.map(e=>({text:e.label,value:e.label})),filteredValue:h.interviewsales||null,filterSearch:!0,render:e=>e||"-"},{title:"渠道",dataIndex:"channel",key:"channel",width:80,sorter:!0,sortOrder:"channel"===p.columnKey&&p.order,filters:D.map(e=>({text:e.label,value:e.value})),filteredValue:h.channel||null,render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"green",style:{margin:0},children:e}):"-"},{title:"社区",dataIndex:"community",key:"community",width:120,sorter:!0,sortOrder:"community"===p.columnKey&&p.order,filters:P.map(e=>({text:e.label,value:e.value})),filteredValue:h.community||null,render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{margin:0},children:e}):"-"},{title:"操作编号",dataIndex:"contractnumber",key:"contractnumber",width:120,sorter:!0,sortOrder:"contractnumber"===p.columnKey&&p.order,filterDropdown:e=>{const{setSelectedKeys:t,selectedKeys:r,confirm:s,clearFilters:n}=e;return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"输入操作编号",value:r[0]||"",onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:140,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>s(),style:{width:60},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{n&&n(),s()},size:"small",style:{width:60},children:"重置"})]})]})},filteredValue:h.contractnumber||null,render:e=>e||"-"},{title:"房间号",dataIndex:"roomnumber",key:"roomnumber",width:100,sorter:!0,sortOrder:"roomnumber"===p.columnKey&&p.order,filterDropdown:e=>{const{setSelectedKeys:t,selectedKeys:r,confirm:s,clearFilters:n}=e;return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"输入房间号",value:r[0]||"",onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:120,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>s(),style:{width:60},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{n&&n(),s()},size:"small",style:{width:60},children:"重置"})]})]})},filteredValue:h.roomnumber||null,render:e=>e||"-"},{title:"操作",key:"action",fixed:"right",width:80,render:(e,t)=>jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>{w(t),R.setFieldsValue({contractdate:t.contractdate?dayjs(t.contractdate):null,leadid:t.leadid,interviewsales_user_id:t.interviewsales_user_id,channel:t.channel,community:t.community,contractnumber:t.contractnumber,roomnumber:t.roomnumber}),j(!0)},style:{padding:"4px 8px",fontSize:"12px",height:"24px",lineHeight:"1"},children:"编辑"})}];return jsxRuntimeExports.jsxs("div",{className:"page-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsx(Title$f,{level:4,className:"m-0 font-bold text-gray-800",children:"成交记录"}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{$.resetFields(),k(!0)},className:"rounded-md font-medium",children:"新增成交记录"}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:z,className:"rounded-md font-medium",children:"刷新"})]})]}),jsxRuntimeExports.jsx("div",{className:"page-table-wrap",children:jsxRuntimeExports.jsx(ForwardTable,{columns:V,dataSource:e,rowKey:"id",loading:r,onChange:(e,t,r)=>{m(r),x(t),e&&e.current!==o&&a(e.current),e&&e.pageSize!==l&&(c(e.pageSize),a(1));const s={};if(t.contractdate&&t.contractdate.length>0&&Array.isArray(t.contractdate[0])){const[e,r]=t.contractdate[0];e&&(s.contractdate_start=e),r&&(s.contractdate_end=r)}t.contractnumber&&t.contractnumber.length>0&&(s.contractnumber=t.contractnumber),t.community&&t.community.length>0&&(s.community=t.community),t.roomnumber&&t.roomnumber.length>0&&(s.roomnumber=t.roomnumber),t.interviewsales&&t.interviewsales.length>0&&(s.interviewsales=t.interviewsales),t.channel&&t.channel.length>0&&(s.channel=t.channel),t.leadid&&"string"==typeof t.leadid[0]&&(s.leadid=[t.leadid[0]]),t.interviewsales&&"string"==typeof t.interviewsales[0]&&(s.interviewsales=[t.interviewsales[0]]),t.contractnumber&&"string"==typeof t.contractnumber[0]&&(s.contractnumber=[t.contractnumber[0]]),t.roomnumber&&"string"==typeof t.roomnumber[0]&&(s.roomnumber=[t.roomnumber[0]]);Object.keys(s).length>0&&a(1),d(s)},pagination:{current:o,pageSize:l,total:n,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{a(e),c(t)}},size:"small",bordered:!1,className:"page-table compact-table",rowClassName:()=>"compact-table-row",scroll:{x:"max-content",y:600},sticky:!0,tableLayout:"fixed"})}),jsxRuntimeExports.jsx(Drawer,{open:f,onClose:()=>{g(!1),v("")},title:"线索详情",width:800,destroyOnHidden:!0,placement:"right",children:y&&jsxRuntimeExports.jsx(LeadDetailDrawer,{leadid:y})}),jsxRuntimeExports.jsx(Modal$2,{title:"编辑成交记录",open:E,onCancel:()=>j(!1),onOk:async()=>{try{S(!0);const e=await R.validateFields(),{channel:t,interviewsales_user_id:r,...s}=e,n={...s,contractdate:e.contractdate?toBeijingDateStr(e.contractdate):null};await updateDeal(b.id,n),staticMethods.success("成交记录更新成功"),j(!1),z()}catch(e){staticMethods.error("更新成交记录失败: "+e.message)}finally{S(!1)}},confirmLoading:_,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:R,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"contractdate",label:"合同日期",rules:[{required:!0,message:"请选择合同日期"}],children:jsxRuntimeExports.jsx(DatePicker$2,{style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"leadid",label:"线索编号",rules:[{required:!0,message:"请输入线索编号"}],children:jsxRuntimeExports.jsx(Input$1,{disabled:!0})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"interviewsales_user_id",label:"约访管家",children:jsxRuntimeExports.jsx(Select,{placeholder:"约访管家在followups表中管理",disabled:!0,children:F.map(e=>jsxRuntimeExports.jsx(Option$a,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"channel",label:"渠道",children:jsxRuntimeExports.jsx(Input$1,{disabled:!0})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"community",label:"社区",rules:[{required:!0,message:"请选择社区"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择社区",showSearch:!0,filterOption:(e,t)=>{var r;return null==(r=null==t?void 0:t.children)?void 0:r.toLowerCase().includes(e.toLowerCase())},optionFilterProp:"children",children:P.map(e=>jsxRuntimeExports.jsx(Option$a,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"contractnumber",label:"操作编号",rules:[{required:!0,message:"请输入操作编号"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入操作编号"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"roomnumber",label:"房间号",rules:[{required:!0,message:"请输入房间号"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入房间号"})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:"新增成交记录",open:C,onCancel:()=>k(!1),onOk:async()=>{try{I(!0);const e=await $.validateFields(),t={...e,contractdate:e.contractdate?toBeijingDateStr(e.contractdate):null};await createDeal(t),staticMethods.success("成交记录创建成功"),k(!1),z()}catch(e){staticMethods.error("创建成交记录失败: "+e.message)}finally{I(!1)}},confirmLoading:T,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:$,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"contractdate",label:"合同日期",rules:[{required:!0,message:"请选择合同日期"}],children:jsxRuntimeExports.jsx(DatePicker$2,{style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"leadid",label:"线索编号",rules:[{required:!0,message:"请选择线索编号"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择线索编号",showSearch:!0,filterOption:(e,t)=>{var r;return null==(r=null==t?void 0:t.children)?void 0:r.toLowerCase().includes(e.toLowerCase())},optionFilterProp:"children",children:N.map(e=>jsxRuntimeExports.jsx(Option$a,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"community",label:"社区",rules:[{required:!0,message:"请选择社区"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择社区",showSearch:!0,filterOption:(e,t)=>{var r;return null==(r=null==t?void 0:t.children)?void 0:r.toLowerCase().includes(e.toLowerCase())},optionFilterProp:"children",children:P.map(e=>jsxRuntimeExports.jsx(Option$a,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"contractnumber",label:"操作编号",rules:[{required:!0,message:"请输入操作编号"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入操作编号"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"roomnumber",label:"房间号",rules:[{required:!0,message:"请输入房间号"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入房间号"})})]})})]})},{Search:Search$1}=Input$1,{Title:Title$e}=Typography,PageHeader=({title:e,keywordSearch:t,groupField:r,groupFieldOptions:s,groupPanelOpen:n,onKeywordSearch:i,onKeywordChange:o,onKeywordClear:a,onGroupFieldChange:l,onRefresh:c,onGroupPanelToggle:u,onMoreActions:d,rollbackMenu:p})=>jsxRuntimeExports.jsxs("div",{className:"page-header",children:[jsxRuntimeExports.jsx(Title$e,{level:4,className:"m-0 font-bold text-gray-800",children:e}),jsxRuntimeExports.jsxs(Space$1,{size:"middle",children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"编号、联系方式或管家...",allowClear:!0,value:t,onChange:e=>{o(e.target.value)},onPressEnter:e=>{const t=e.target.value;i(t)},onBlur:e=>{const t=e.target.value;i(t)},style:{width:"280px"},prefix:jsxRuntimeExports.jsx(RefIcon$8,{style:{color:"#bfbfbf"}}),onClear:a}),jsxRuntimeExports.jsx(Select,{placeholder:"选择分组字段",value:r,onChange:l,style:{width:140},options:s}),r&&jsxRuntimeExports.jsx(Button$1,{type:n?"primary":"default",icon:n?jsxRuntimeExports.jsx(RefIcon$l,{}):jsxRuntimeExports.jsx(RefIcon$m,{}),onClick:()=>u(!n),title:n?"收起分组面板":"展开分组面板",style:{minWidth:"auto"},children:n?"收起":"展开"}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:c,className:"rounded-md font-medium",children:"刷新"}),d&&jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$8,{className:"ml-0 rotate-90"}),className:"border-none shadow-none bg-transparent text-lg outline-none flex items-center justify-center",tabIndex:0,style:{height:"32px",width:"32px"},onClick:d}),p&&jsxRuntimeExports.jsx(Dropdown,{menu:p,children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$n,{className:"ml-0 rotate-90"}),className:"border-none shadow-none bg-transparent text-lg outline-none flex items-center justify-center",tabIndex:0,style:{height:"32px",width:"32px"}})})]})]}),FilterPanel=({filters:e,onFilterRemove:t,onFilterReset:r})=>{const[s,n]=reactExports.useState({}),i=()=>Object.keys(e).filter(e=>"_initialized"!==e).length;reactExports.useEffect(()=>{const t=[];Object.entries(e).forEach(([e,r])=>{["p_interviewsales_user_id","p_showingsales_user_id","p_showingsales_user"].includes(e)&&(r&&Array.isArray(r)?r.forEach(e=>{e&&null!=e&&"null"!==String(e)&&!isNaN(Number(e))&&t.push(String(e))}):r&&null!=r&&"null"!==String(r)&&!isNaN(Number(r))&&t.push(String(r)))}),t.length>0&&(async e=>{const t=e.filter(e=>!s[e]);if(0!==t.length)try{const{data:e,error:r}=await supabase.from("users_profile").select("id, nickname").in("id",t);if(r||!e)return;const s={};e.forEach(e=>{s[String(e.id)]=e.nickname||`用户${e.id}`}),n(e=>({...e,...s}))}catch(r){console.error("批量获取用户昵称失败:",r)}})(t)},[e]);return 0===i()?null:jsxRuntimeExports.jsx("div",{className:"filter-panel",children:jsxRuntimeExports.jsxs("div",{className:"filter-tags-container",children:[(()=>{const r=[];return e.p_created_at_start&&e.p_created_at_end&&r.push(jsxRuntimeExports.jsxs(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭创建日期筛选标签"),t("p_created_at_start"),t("p_created_at_end")},style:{marginRight:8,marginBottom:8},children:["创建日期: ",new Date(e.p_created_at_start).toLocaleDateString()," ~ ",new Date(e.p_created_at_end).toLocaleDateString()]},"created_at_range")),e.p_created_at_not_null&&!0===e.p_created_at_not_null[0]&&r.push(jsxRuntimeExports.jsx(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭创建日期非空筛选标签"),t("p_created_at_not_null")},style:{marginRight:8,marginBottom:8},children:"创建日期: 非空"},"created_at_not_null")),e.p_moveintime_start&&e.p_moveintime_end&&r.push(jsxRuntimeExports.jsxs(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭入住日期筛选标签"),t("p_moveintime_start"),t("p_moveintime_end")},style:{marginRight:8,marginBottom:8},children:["入住日期: ",new Date(e.p_moveintime_start).toLocaleDateString()," ~ ",new Date(e.p_moveintime_end).toLocaleDateString()]},"moveintime_range")),e.p_moveintime_not_null&&!0===e.p_moveintime_not_null[0]&&r.push(jsxRuntimeExports.jsx(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭入住日期非空筛选标签"),t("p_moveintime_not_null")},style:{marginRight:8,marginBottom:8},children:"入住日期: 非空"},"moveintime_not_null")),e.p_scheduletime_start&&e.p_scheduletime_end&&r.push(jsxRuntimeExports.jsxs(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭预约时间筛选标签"),t("p_scheduletime_start"),t("p_scheduletime_end")},style:{marginRight:8,marginBottom:8},children:["预约时间: ",new Date(e.p_scheduletime_start).toLocaleDateString()," ~ ",new Date(e.p_scheduletime_end).toLocaleDateString()]},"scheduletime_range")),e.p_scheduletime_not_null&&!0===e.p_scheduletime_not_null[0]&&r.push(jsxRuntimeExports.jsx(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭预约时间非空筛选标签"),t("p_scheduletime_not_null")},style:{marginRight:8,marginBottom:8},children:"预约时间: 非空"},"scheduletime_not_null")),r})(),e.p_keyword?jsxRuntimeExports.jsxs(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭关键词筛选标签:",e.p_keyword),t("p_keyword")},style:{marginRight:8,marginBottom:8},children:["关键词: ",e.p_keyword]},"keyword_filter"):null,(()=>{const r=[];return Object.entries(e).forEach(([e,n])=>{if(null==n||Array.isArray(n)&&0===n.length)return;if(["p_keyword","p_created_at_start","p_created_at_end","p_moveintime_start","p_moveintime_end","p_scheduletime_start","p_scheduletime_end","p_scheduletime_not_null","_initialized"].includes(e))return;const i={p_leadid:"线索编号",p_leadtype:"线索来源",p_interviewsales_user_id:"约访管家",p_showingsales_user_id:"带看管家",p_followupstage:"阶段",p_customerprofile:"用户画像",p_worklocation:"工作地点",p_userbudget:"用户预算",p_userrating:"来访意向",p_majorcategory:"跟进结果",p_followupresult:"跟进备注",p_showingsales_user:"带看管家",p_scheduledcommunity:"预约社区",p_source:"渠道",p_remark:"客服备注",p_phone:"手机号",p_wechat:"微信号"}[e]||e.replace(/^p_/,"");(Array.isArray(n)?n:[n]).forEach((n,o)=>{let a=n;"p_interviewsales_user_id"===e||"p_showingsales_user_id"===e||"p_showingsales_user"===e?a=null==n||"null"===String(n)||"number"==typeof n&&isNaN(n)?"未分配":s[String(n)]||`用户${n}`:"p_scheduledcommunity"!==e||null!=n&&"null"!==String(n)&&""!==String(n)?(null==n||"null"===String(n)||"number"==typeof n&&isNaN(n))&&(a="为空"):a="未分配",r.push(jsxRuntimeExports.jsx(Tag$1,{closable:!0,className:"filter-tag",onClose:()=>{console.log("🔍 [FilterPanel] 关闭筛选标签:",{key:e,value:n,label:i,displayText:a}),t(e,n)},style:{marginRight:8,marginBottom:8},children:`${i}: ${a}`},`filter_${e}_${String(n)}_${o}`))})}),r})(),i()>0&&jsxRuntimeExports.jsx(Tag$1,{className:"filter-tag clear-all-tag",onClick:r,children:"清除全部"})]})})},QuickDateFilter=reactExports.memo(({quickDateKey:e,onQuickDateChange:t})=>{const r=reactExports.useCallback(r=>{t(e===r?null:r)},[e,t]);return jsxRuntimeExports.jsx("div",{className:"quick-date-bar",children:[{key:"thisWeek",label:"本周"},{key:"lastWeek",label:"上周"},{key:"thisMonth",label:"本月"},{key:"lastMonth",label:"上月"}].map(({key:t,label:s})=>jsxRuntimeExports.jsx("button",{className:"quick-date-btn"+(e===t?" active":""),onClick:()=>r(t),children:s},t))})});QuickDateFilter.displayName="QuickDateFilter";const GroupPanel=({groupPanelOpen:e,groupTotal:t,groupData:r,selectedGroup:s,quickDateKey:n,onGroupClick:i,onQuickDateChange:o})=>{if(!e)return null;return jsxRuntimeExports.jsxs("div",{className:"group-panel-sidebar "+(e?"open":"closed"),children:[jsxRuntimeExports.jsxs("div",{className:"group-total-section",children:[jsxRuntimeExports.jsx("span",{className:"group-card-title",children:"总记录数"}),jsxRuntimeExports.jsx("span",{className:"group-card-count",children:t})]}),jsxRuntimeExports.jsx(QuickDateFilter,{quickDateKey:n,onQuickDateChange:o}),jsxRuntimeExports.jsx("div",{className:"group-btn-list",children:r.map(e=>{let t=e.groupText||e.key;null!==e.key&&"null"!==e.key&&""!==e.key&&"未分组"!==e.groupText||(t="未分配");const r=e=>null==e||"null"===String(e).toLowerCase()||""===String(e)||"未分组"===e,n=r(e.key)&&("null"===s||r(s))||String(s)===String(e.key);return jsxRuntimeExports.jsxs("div",{onClick:()=>i(e.key),className:"group-btn"+(n?" group-btn-selected":""),children:[jsxRuntimeExports.jsx("span",{className:"group-btn-title",children:t}),jsxRuntimeExports.jsxs("span",{className:"group-btn-count",children:[e.count," 条"]})]},`group_${e.key}`)})})]})},UserTreeSelect=({value:e,onChange:t,placeholder:r="请选择成员",style:s,disabled:n=!1,allowClear:i=!0,showSearch:o=!0,maxTagCount:a="responsive",treeDefaultExpandAll:l=!0,popupMatchSelectWidth:c=!1,multiple:u=!0,currentUserId:d})=>{const[p,m]=reactExports.useState([]),[h,x]=reactExports.useState({}),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState(!1),E=e=>{const t=p.find(t=>t.key===e)||function t(r){for(const s of r){if(s.key===e)return s;if(s.children){const e=t(s.children);if(e)return e}}}(p);if(!t)return[];const r=e=>{const t=[];return e.children&&e.children.forEach(e=>{e.isLeaf&&e.key?t.push(e.key):e.children&&t.push(...r(e))}),t};return r(t)},j=(r,s)=>{const n=E(r);let i=[...Array.isArray(e)?e:[]];s?n.forEach(e=>{i.includes(e)||i.push(e)}):i=i.filter(e=>!n.includes(e)),null==t||t(i)};if(reactExports.useEffect(()=>{(async()=>{try{g(!0);const{data:e,error:t}=await supabase.from("organizations").select("id, name, parent_id");if(t)throw console.error("❌ 加载组织数据失败:",t),t;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, organization_id, status").eq("status","active");if(s)throw console.error("❌ 加载用户数据失败:",s),s;if(r&&r.length>0){const e=r.reduce((e,t)=>({...e,[String(t.id)]:{id:String(t.id),nickname:t.nickname||`用户${t.id}`,status:t.status}}),{});x(t=>({...t,...e}))}const n=t=>(e||[]).filter(e=>e.parent_id===t).map(e=>{const t=(r||[]).filter(t=>!!t.organization_id&&t.organization_id===e.id),s=n(e.id);return{title:`${e.name} (${t.length}人)`,value:`dept_${e.id}`,key:`dept_${e.id}`,children:[...t.map(e=>({title:e.nickname||`用户${e.id}`,value:String(e.id),key:String(e.id),isLeaf:!0})).filter(e=>e.key&&"undefined"!==e.key&&"null"!==e.key),...s].filter(e=>e.key&&"undefined"!==e.key&&"null"!==e.key)}}),i=(r||[]).filter(e=>!e.organization_id).map(e=>({title:e.nickname||`用户${e.id}`,value:String(e.id),key:String(e.id),isLeaf:!0})).filter(e=>e.key&&"undefined"!==e.key&&"null"!==e.key),o=n(null);i.length>0&&o.push({title:`未分配部门 (${i.length}人)`,value:"dept_none",key:"dept_none",children:i});const a=o.filter(e=>e.key&&"undefined"!==e.key&&"null"!==e.key&&(!e.children||e.children.every(e=>e.key&&"undefined"!==e.key&&"null"!==e.key)));m(a),v(!0)}catch(e){console.error("❌ 加载部门树数据失败:",e),m([]),v(!0)}finally{g(!1)}})()},[]),reactExports.useEffect(()=>{if(y&&p.length>0){const e=(t,r=0)=>{t.forEach(t=>{t.isLeaf||t.children&&e(t.children,r+1)})};e(p)}},[y,p]),!y)return jsxRuntimeExports.jsx("div",{style:{...s,padding:"8px 12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#fafafa",color:"#999"},children:"正在加载用户数据..."});const b=(Array.isArray(e)?e:e?[String(e)]:[]).filter(e=>{if(!e||"undefined"===e||"null"===e)return!1;const t=r=>r.some(r=>r.value===e||r.children&&t(r.children));return p.some(e=>t([e]))});return p.length,jsxRuntimeExports.jsx(TreeSelect,{treeData:p,value:b,treeCheckable:!0,showCheckedStrategy:u?TreeSelect.SHOW_CHILD:void 0,treeCheckStrictly:!1,onSelect:t=>{if(String(t).startsWith("dept_")){const r=E(String(t)),s=Array.isArray(e)?e:[],n=r.length>0&&r.every(e=>s.includes(e));return void j(String(t),!n)}},onDeselect:e=>{String(e).startsWith("dept_")&&j(String(e),!1)},onChange:e=>{if(!u){const r=Array.isArray(e)?e[0]:e;return void(r&&!String(r).startsWith("dept_")?null==t||t([String(r)]):null==t||t([]))}const r=Array.isArray(e)?e:[];let s=[];const n=r.filter(e=>String(e).startsWith("dept_")),i=r.filter(e=>!String(e).startsWith("dept_"));n.forEach(e=>{E(e).forEach(e=>{s.includes(e)||s.push(e)})}),i.forEach(e=>{const t=String(e);s.includes(t)||s.push(t)}),s=s.filter(e=>{if(!e||"undefined"===e||"null"===e)return!1;const t=r=>r.some(r=>r.isLeaf&&r.key===e||r.children&&t(r.children));return p.some(e=>t([e]))});const o=s.filter(e=>e&&"undefined"!==e&&"null"!==e);null==t||t(o)},tagRender:u?({value:e,closable:t,onClose:r})=>{if(!e||"undefined"===e||"null"===e)return jsxRuntimeExports.jsx(Tag$1,{closable:t,onClose:r,style:{display:"none"},children:"无效用户"});const s=null==h?void 0:h[String(e)],n=(null==s?void 0:s.nickname)||`用户${e}`,i=d&&String(e)===String(d);return jsxRuntimeExports.jsxs(Tag$1,{closable:!i&&t,onClose:i?void 0:r,style:{background:i?"#fff7e6":"#f0f8ff",border:i?"1px solid #ffd591":"1px solid #91d5ff",color:i?"#d46b08":"#1890ff",borderRadius:"6px",padding:"2px 8px",fontSize:"12px",lineHeight:"1.4",margin:"2px",position:"relative"},children:[i?`本人 (${n})`:n,i&&jsxRuntimeExports.jsx("span",{style:{position:"absolute",top:"-2px",right:"-2px",background:"#ff4d4f",color:"white",borderRadius:"50%",width:"12px",height:"12px",fontSize:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"},children:"锁"})]})}:void 0,placeholder:r,showSearch:o,filterTreeNode:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),style:s,disabled:n,allowClear:i,treeDefaultExpandAll:l,maxTagCount:u?a:void 0,styles:{popup:{root:{maxHeight:400,overflow:"auto"}}},popupMatchSelectWidth:c,loading:f})};var locale$6=_objectSpread2$3(_objectSpread2$3({},commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});const locale$5={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]},locale$4={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},locale$6),timePickerLocale:Object.assign({},locale$5)};locale$4.lang.ok="确定";const{RangePicker:RangePicker$1}=DatePicker$2,{Search:Search}=Input$1,SearchFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,placeholder:n="输入关键词",width:i=200,onReset:o,onConfirm:a})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Search,{placeholder:n,value:t[0]||"",onChange:t=>e(t.target.value?[t.target.value]:[]),onSearch:t=>{e(t?[t]:[]),r(),null==a||a()},style:{width:i,marginBottom:8}}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{r(),null==a||a()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),s&&s(),null==o||o()},children:"重置"})]})]}),SelectFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,options:n=[],placeholder:i="选择选项",width:o=200,onReset:a,onConfirm:l})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:i,value:t,onChange:e,options:n,allowClear:!0,style:{width:o,marginBottom:8}}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{r(),null==l||l()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),s&&s(),null==a||a()},children:"重置"})]})]}),DateRangeFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,width:n=200,onReset:i,onConfirm:o,notNullField:a})=>{const[l,c]=reactExports.useState(!1);return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(RangePicker$1,{value:t,onChange:t=>e(t),locale:locale$4,style:{width:n,marginBottom:8},placeholder:["开始日期","结束日期"]}),jsxRuntimeExports.jsx("div",{style:{marginBottom:8},children:jsxRuntimeExports.jsx(Checkbox,{checked:l,onChange:e=>c(e.target.checked),children:"仅显示非空记录"})}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{if(l&&a){const r=Array.isArray(t)?t:[];e([...r,{notNull:!0,field:a}])}r(),null==o||o()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),c(!1),s&&s(),null==i||i()},children:"重置"})]})]})},NumberRangeFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,onReset:n,onConfirm:i})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最小值",value:t[0],onChange:r=>{e([r,t[1]||null].filter(e=>null!==e))},style:{flex:1}}),jsxRuntimeExports.jsx(TypedInputNumber,{placeholder:"最大值",value:t[1],onChange:r=>{e([t[0]||null,r].filter(e=>null!==e))},style:{flex:1}})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{r(),null==i||i()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),s&&s(),null==n||n()},children:"重置"})]})]}),CascaderFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,options:n=[],placeholder:i="选择级联选项",width:o=200,onReset:a,onConfirm:l})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Cascader,{placeholder:i,value:t,onChange:e,options:n,allowClear:!0,style:{width:o,marginBottom:8}}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{r(),null==l||l()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),s&&s(),null==a||a()},children:"重置"})]})]}),CheckboxFilterDropdown=({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s,options:n=[],onReset:i,onConfirm:o})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:8,maxHeight:200,overflowY:"auto"},children:n.map(r=>jsxRuntimeExports.jsx("div",{style:{marginBottom:4},children:jsxRuntimeExports.jsx(Checkbox,{checked:t.includes(r.value),onChange:s=>{s.target.checked?e([...t,r.value]):e(t.filter(e=>e!==r.value))},children:r.label})},r.value))}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{r(),null==o||o()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{e([]),s&&s(),null==i||i()},children:"重置"})]})]}),HierarchicalLocationFilterDropdown=({setSelectedKeys:e,confirm:t,clearFilters:r,options:s=[],width:n=300,onReset:i,onConfirm:o})=>{var a;const[l,c]=reactExports.useState(""),[u,d]=reactExports.useState([]),p=s.map(e=>({value:e.value,label:e.label})),m=reactExports.useMemo(()=>{const e=[];return s.forEach(t=>{t.children&&t.children.forEach(t=>{const r=t.value,s=t.label;e.push({label:s,value:r})})}),e},[s]),h=l&&(null==(a=s.find(e=>e.value===l))?void 0:a.children)||[];return jsxRuntimeExports.jsxs("div",{style:{padding:16,width:n},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",color:"#000",marginBottom:8,fontSize:"14px"},children:"按线路筛选"}),jsxRuntimeExports.jsx(Select,{placeholder:"选择地铁线路",value:l,onChange:c,options:p,style:{width:"100%"},allowClear:!0,showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase())})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",color:"#000",marginBottom:8,fontSize:"14px"},children:"按站点筛选"}),jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:l?"选择该线路下的站点":"选择任意站点",value:u,onChange:d,options:l?h:m,style:{width:"100%"},allowClear:!0,showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase())}),!l&&jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4,fontStyle:"italic"},children:"提示：未选择线路时，可以从所有站点中选择"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{c(""),d([]),e([]),r&&r(),null==i||i()},children:"重置"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{const r=[];if(u.length>0)u.forEach(e=>{const t=e;r.push(t)}),console.log("🔍 [HierarchicalLocationFilterDropdown] 使用站点选择:",{selectedStations:u,finalKeys:r,reason:"用户选择了具体站点，优先使用站点选择"});else if(l){const e=s.find(e=>e.value===l);e&&e.children&&(e.children.forEach(e=>{const t=e.value;r.push(t)}),console.log("🔍 [HierarchicalLocationFilterDropdown] 使用线路选择（所有站点）:",{selectedLine:l,finalKeys:r,reason:"用户选择了线路但未选择具体站点，自动选择该线路下的所有站点"}))}console.log("🔍 [HierarchicalLocationFilterDropdown] 工作地点筛选确认:",{selectedLine:l,selectedStations:u,finalKeys:r,timestamp:(new Date).toISOString()}),e(r),t(),null==o||o()},children:"筛选"})]})]})},HierarchicalCategoryFilterDropdown=({setSelectedKeys:e,confirm:t,clearFilters:r,options:s=[],width:n=300,onReset:i,onConfirm:o})=>{var a;const[l,c]=reactExports.useState(""),[u,d]=reactExports.useState([]),p=s.map(e=>({value:e.value,label:e.label})),m=reactExports.useMemo(()=>{const e=[];return s.forEach(t=>{t.children&&t.children.forEach(t=>{e.push({label:t.label,value:t.value})})}),e},[s]),h=l&&(null==(a=s.find(e=>e.value===l))?void 0:a.children)||[];return jsxRuntimeExports.jsxs("div",{style:{padding:16,width:n},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",color:"#000",marginBottom:8,fontSize:"14px"},children:"按一级分类筛选"}),jsxRuntimeExports.jsx(Select,{placeholder:"选择一级分类",value:l,onChange:c,options:p,style:{width:"100%"},allowClear:!0,showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase())})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",color:"#000",marginBottom:8,fontSize:"14px"},children:"按二级分类筛选"}),jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:l?"选择该一级分类下的二级分类":"选择任意二级分类",value:u,onChange:d,options:l?h:m,style:{width:"100%"},allowClear:!0,showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase())}),!l&&jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4,fontStyle:"italic"},children:"提示：未选择一级分类时，可以从所有二级分类中选择"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{c(""),d([]),e([]),r&&r(),null==i||i()},children:"重置"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{const r=[];if(u.length>0)u.forEach(e=>{r.push(e)}),console.log("🔍 [HierarchicalCategoryFilterDropdown] 使用二级分类选择:",{selectedSubcategories:u,finalKeys:r,reason:"用户选择了具体二级分类，优先使用二级分类选择"});else if(l){const e=s.find(e=>e.value===l);e&&e.children&&(e.children.forEach(e=>{r.push(e.value)}),console.log("🔍 [HierarchicalCategoryFilterDropdown] 使用一级分类选择（所有二级分类）:",{selectedCategory:l,finalKeys:r,reason:"用户选择了一级分类但未选择具体二级分类，自动选择该一级分类下的所有二级分类"}))}console.log("🔍 [HierarchicalCategoryFilterDropdown] 主分类筛选确认:",{selectedCategory:l,selectedSubcategories:u,finalKeys:r,timestamp:(new Date).toISOString()}),e(r),t(),null==o||o()},children:"筛选"})]})]})},UserTreeFilterDropdown=({setSelectedKeys:e,confirm:t,clearFilters:r,width:s=300,onReset:n,onConfirm:i})=>{const[o,a]=reactExports.useState([]);return jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(UserTreeSelect,{value:o,onChange:e=>a(e),placeholder:"请选择约访管家",style:{width:s,marginBottom:8},multiple:!0,showSearch:!0,treeDefaultExpandAll:!1,maxTagCount:3}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{flex:1},onClick:()=>{const r=o.filter(e=>!String(e).startsWith("dept_"));e(r),t(),null==i||i()},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{flex:1},onClick:()=>{a([]),e([]),r&&r(),null==n||n()},children:"重置"})]})]})},createFilterDropdown=(e,t,r,s,n,i,o)=>{const a={filterType:e,options:t,placeholder:r,width:s,onReset:n,onConfirm:i,notNullField:o};switch(e){case"search":default:return e=>jsxRuntimeExports.jsx(SearchFilterDropdown,{...e,...a});case"select":return e=>jsxRuntimeExports.jsx(SelectFilterDropdown,{...e,...a});case"dateRange":return e=>jsxRuntimeExports.jsx(DateRangeFilterDropdown,{...e,...a});case"numberRange":return e=>jsxRuntimeExports.jsx(NumberRangeFilterDropdown,{...e,...a});case"cascader":return e=>jsxRuntimeExports.jsx(CascaderFilterDropdown,{...e,...a});case"checkbox":return e=>jsxRuntimeExports.jsx(CheckboxFilterDropdown,{...e,...a});case"hierarchicalLocation":return e=>jsxRuntimeExports.jsx(HierarchicalLocationFilterDropdown,{...e,...a});case"hierarchicalCategory":return e=>jsxRuntimeExports.jsx(HierarchicalCategoryFilterDropdown,{...e,...a});case"userTree":return e=>jsxRuntimeExports.jsx(UserTreeFilterDropdown,{...e,...a})}},getFollowupsTableFilters=(e,t,r,s,n,i,o,a,l,c,u,d,p,m,h)=>{const x=e=>()=>{null==m||m(e)},f=e=>()=>{null==h||h(e)};return{leadid:createFilterDropdown("search",void 0,"输入线索编号关键词",200,x("leadid"),f("leadid")),leadtype:createFilterDropdown("select",a,"选择线索来源",200,x("leadtype"),f("leadtype")),interviewsales_user_id:createFilterDropdown("userTree",void 0,"选择约访管家",300,x("interviewsales_user_id"),f("interviewsales_user_id")),followupstage:createFilterDropdown("select",t,"选择跟进阶段",200,x("followupstage"),f("followupstage")),customerprofile:createFilterDropdown("select",r,"选择用户画像",200,x("customerprofile"),f("customerprofile")),worklocation:createFilterDropdown("hierarchicalLocation",o,"选择工作地点",300,x("worklocation"),f("worklocation")),userbudget:createFilterDropdown("numberRange",void 0,"输入预算范围",240,x("userbudget"),f("userbudget")),moveintime:createFilterDropdown("dateRange",void 0,"选择入住时间范围",240,x("moveintime"),f("moveintime"),"p_moveintime_not_null"),userrating:createFilterDropdown("select",n,"选择来访意向",200,x("userrating"),f("userrating")),majorcategory:createFilterDropdown("hierarchicalCategory",i,"选择跟进结果",300,x("majorcategory"),f("majorcategory")),followupresult:createFilterDropdown("select",u,"选择跟进备注",200,x("followupresult"),f("followupresult")),scheduletime:createFilterDropdown("dateRange",void 0,"选择预约时间范围",240,x("scheduletime"),f("scheduletime"),"p_scheduletime_not_null"),scheduledcommunity:createFilterDropdown("select",e,"选择预约社区",200,x("scheduledcommunity"),f("scheduledcommunity")),showingsales_user:createFilterDropdown("userTree",void 0,"选择带看管家",300,x("showingsales_user"),f("showingsales_user")),created_at:createFilterDropdown("dateRange",void 0,"选择创建时间范围",240,x("created_at"),f("created_at"),"p_created_at_not_null"),source:createFilterDropdown("select",s,"选择来源",200,x("source"),f("source")),remark:createFilterDropdown("select",l,"选择备注类型",200,x("remark"),f("remark")),community:createFilterDropdown("select",e,"选择社区",200,x("community"),f("community")),metro_station:createFilterDropdown("cascader",o,"选择地铁站",240,x("metro_station"),f("metro_station")),major_category:createFilterDropdown("cascader",i,"选择主分类",240,x("major_category"),f("major_category")),subcategory:createFilterDropdown("select",[],"选择子分类",200,x("subcategory"),f("subcategory")),wechat:createFilterDropdown("search",void 0,"输入微信号",200,x("wechat"),f("wechat")),phone:createFilterDropdown("search",void 0,"输入手机号",200,x("phone"),f("phone")),keyword:createFilterDropdown("search",void 0,"输入关键词",200,x("keyword"),f("keyword"))}},_MetroCommuteService=class e{constructor(){__publicField(this,"metroData",null)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(){if(!this.metroData)try{const{data:e,error:t}=await supabase.rpc("get_metrostations");if(t)return void console.error("获取地铁站数据失败:",t);this.metroData=e}catch(e){console.error("初始化地铁服务失败:",e)}}async calculateCommuteTime(e,t){if(!e||!t)return 999;if(e===t)return 0;try{const r=this.parseStationName(e),s=this.parseStationName(t),n=await this.callSupabaseMetroCalculator(r,s);return n&&n.success?n.total_time_minutes:(console.warn("Supabase算法计算失败，使用备用方案:",null==n?void 0:n.error),this.getSimulatedCommuteTime(r,s))}catch(r){return console.error("计算通勤时间失败:",r),this.getSimulatedCommuteTime(e,t)}}parseStationName(e){if(!e)return"";if(e.includes("/")){const t=e.split("/");return t[t.length-1].trim()}if(e.includes("号线")){return e.split("号线")[0].trim()}return e.trim()}getDefaultStationForLine(e){return{1:"人民广场",2:"人民广场",3:"人民广场",4:"人民广场",5:"莘庄",6:"东方体育中心",7:"美兰湖",8:"沈杜公路",9:"松江南站",10:"新江湾城",11:"迪士尼",12:"七莘路",13:"金运路",16:"龙阳路",17:"虹桥火车站",18:"长江南路"}[e]||null}async calculateCommuteInfo(e,t){if(!e||!t)return null;if(e===t)return{startStation:e,endStation:t,totalTime:0,stationsCount:0,transferCount:0,path:[e],transfers:[],routeSummary:"无需移动"};try{const r=this.parseStationName(e),s=this.parseStationName(t),n=await this.callSupabaseMetroCalculator(r,s);return n&&n.success?{startStation:n.start_station,endStation:n.end_station,totalTime:n.total_time_minutes,stationsCount:n.stations_count,transferCount:n.transfer_count,path:n.path,transfers:n.transfers,routeSummary:n.route_summary}:(console.warn("Supabase算法计算失败:",null==n?void 0:n.error),null)}catch(r){return console.error("获取通勤信息失败:",r),null}}async callSupabaseMetroCalculatorWithTimeout(e,t){const r=new AbortController,s=setTimeout(()=>r.abort(),3e4);try{console.log("🚇 调用Supabase Dijkstra算法:",e,"→",t);const{data:r,error:n}=await supabase.rpc("calculate_metro_commute_time",{p_start_station:e,p_end_station:t});return clearTimeout(s),n?(console.error("Supabase RPC调用失败:",n),null):r?(console.log("✅ Supabase算法计算成功:",r),r):null}catch(n){return clearTimeout(s),"AbortError"===n.name?console.warn("⏰ 请求超时:",e,"→",t):console.error("调用Supabase算法失败:",n),null}}async callSupabaseMetroCalculator(e,t){for(let s=1;s<=2;s++)try{const r=await this.callSupabaseMetroCalculatorWithTimeout(e,t);if(r)return r;s<2&&(console.log(`🔄 第${s}次尝试失败，等待后重试...`),await new Promise(e=>setTimeout(e,1e3*s)))}catch(r){console.error(`第${s}次尝试失败:`,r),s<2&&await new Promise(e=>setTimeout(e,1e3*s))}return console.warn("❌ 经过2次尝试后仍然失败:",e,"→",t),null}getSimulatedCommuteTime(e,t){const r={"人民广场-浦江镇":45,"人民广场-万科城市花园站":35,"人民广场-华润城站":28,"徐家汇-浦江镇":38,"徐家汇-万科城市花园站":28,"徐家汇-华润城站":21,"陆家嘴-浦江镇":52,"陆家嘴-万科城市花园站":42,"陆家嘴-华润城站":35};return r[`${e}-${t}`]||r[`${t}-${e}`]||50}async getMetroStations(){return this.metroData||await this.initialize(),this.metroData||[]}async searchMetroStations(e){const t=await this.getMetroStations();return e?t.filter(t=>t.name.includes(e)||t.line.includes(e)):t}async getStationLines(e){return(await this.getMetroStations()).filter(t=>t.name===e).map(e=>e.line)}async isTransferStation(e){return(await this.getStationLines(e)).length>1}async batchCalculateCommuteTimes(e,t){const r={};for(const n of t)try{const t=await this.calculateCommuteTime(e,n);r[n]=t}catch(s){console.error(`计算${e}到${n}通勤时间失败:`,s),r[n]=999}return r}};__publicField(_MetroCommuteService,"instance");let MetroCommuteService=_MetroCommuteService;const _CommunityRecommendationService=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}async getRecommendations(e){try{if(e.followupId){const t=await this.getCachedRecommendations(e.followupId);if(t.length>0)return t}const t=await this.calculateRecommendationsFrontend(e);return e.followupId&&await this.cacheRecommendations(e.followupId,t),t}catch(t){return console.error("社区推荐服务错误:",t),[]}}async calculateRecommendationsFrontend(e){try{const t=await this.getCommunityDataWithCache();if(!t||0===t.length)return[];const r=[];for(const s of t){const t=await this.calculateCommunityScore(s,e);t.totalScore>0&&r.push({community:s.community,score:t.totalScore,commuteTime:t.commuteTime,commuteScore:t.commuteScore,budgetScore:t.budgetScore,historicalScore:t.historicalScore,recommendation:this.getRecommendationLevel(t.totalScore).recommendation,reason:this.buildRecommendationReason(s,t),color:this.getRecommendationLevel(t.totalScore).color,metrostation:s.metrostation||"",lowest_price:s.lowest_price||0,highest_price:s.highest_price||0,conversion_rates:s.conversion_rates||{}})}return r.sort((e,t)=>t.score-e.score)}catch(t){return console.error("前端计算推荐失败:",t),[]}}async getCommunityDataWithCache(){const t=Date.now();if(e.communityDataCache.length>0&&t-e.cacheTimestamp<e.CACHE_DURATION)return e.communityDataCache;try{const{data:r,error:s}=await supabase.from("community_keywords").select("community, metrostation, lowest_price, highest_price, conversion_rates").not("metrostation","is",null).not("lowest_price","is",null).not("highest_price","is",null);return s?(console.error("获取社区数据失败:",s),[]):(e.communityDataCache=r||[],e.cacheTimestamp=t,r||[])}catch(r){return console.error("获取社区数据失败:",r),[]}}async calculateCommunityScore(e,t){let r;r=t.followupId?await this.getCommuteTime(t.followupId,t.worklocation,e.community):50;const s=this.getCommuteScore(r),n=this.getBudgetScore(t.userbudget,e.lowest_price,e.highest_price),i=this.getConversionRate(e.conversion_rates,t.customerprofile),o=this.getHistoricalScore(i),a=.4*s+.4*n+.2*o;return{commuteTime:r,commuteScore:s,budgetScore:n,historicalScore:o,totalScore:Math.round(10*a)/10}}getCommuteScore(e){return e<=30?100:e<=45?85:e<=60?70:e<=90?50:30}getBudgetScore(e,t,r){return e>=t&&e<=r?100:e<t?e>=.7*t?80:60:e<=1.5*r?80:60}getConversionRate(e,t){return e&&t&&e[t]||0}getHistoricalScore(e){return e>=60?100:e>=45?80:e>=30?60:e>=20?40:20}buildRecommendationReason(e,t){const{community:r,metrostation:s}=e,{commuteTime:n,commuteScore:i,budgetScore:o,historicalScore:a,totalScore:l}=t;let c=`${r}社区推荐理由：`;return c+=n>=0?i>=85?`通勤时间优秀(${n}分钟)`:i>=70?`通勤时间良好(${n}分钟)`:i>=50?`通勤时间一般(${n}分钟)`:`通勤时间较长(${n}分钟)`:"通勤时间未计算(默认50分)",c+=o>0?`，预算匹配度${o}分`:"，预算信息缺失(默认50分)",c+=a>0?`，历史成交率${a}分`:"，历史数据缺失(默认50分)",c+=`，综合评分${l}分`,c}getRecommendationLevel(e){return e>=85?{recommendation:"强烈推荐",color:"#52c41a"}:e>=75?{recommendation:"推荐",color:"#1890ff"}:e>=65?{recommendation:"可考虑",color:"#fa8c16"}:e>=55?{recommendation:"谨慎推荐",color:"#fa541c"}:{recommendation:"不推荐",color:"#f5222d"}}async getRecommendationsWithCommuteTimes(e){try{const{data:r,error:s}=await supabase.from("community_keywords").select("community, metrostation, lowest_price, highest_price, conversion_rates").not("metrostation","is",null);if(s)return console.error("获取社区数据失败:",s),[];if(!r||0===r.length)return[];const n=[];for(const i of r)try{const t=e.commuteTimes[i.community]||0,r=t>=0?this.getCommuteScore(t):50,s=e.userbudget>0?this.getBudgetScore(e.userbudget,i.lowest_price,i.highest_price):50,o=e.customerprofile?this.getConversionRate(i.conversion_rates,e.customerprofile):0,a=e.customerprofile?this.getHistoricalScore(o):50,l=Math.round(.4*r+.4*s+.2*a),c=t>=0&&Object.keys(e.commuteTimes).length>0,u=e.userbudget>0;if(!(c||u))continue;const d=this.buildRecommendationReason(i,{commuteTime:t,commuteScore:r,budgetScore:s,historicalScore:a,totalScore:l}),{recommendation:p,color:m}=this.getRecommendationLevel(l);n.push({community:i.community,metrostation:i.metrostation,lowest_price:i.lowest_price||0,highest_price:i.highest_price||0,conversion_rates:i.conversion_rates||{},score:l,commuteTime:t,commuteScore:r,budgetScore:s,historicalScore:a,reason:d,recommendation:p,color:m})}catch(t){console.error(`计算社区 ${i.community} 推荐失败:`,t)}return n.sort((e,t)=>t.score-e.score),n}catch(r){return console.error("使用传入数据计算推荐失败:",r),[]}}async getRecommendationsWithCache(e){return this.getRecommendationsWithCommuteTimes({worklocation:e.worklocation,userbudget:e.userbudget,customerprofile:e.customerprofile,followupId:e.followupId,commuteTimes:e.cachedCommuteTimes})}async getCachedCommuteTimes(e){try{const{data:t,error:r}=await supabase.from("followups").select("extended_data").eq("id",e).single();return r||!(null==t?void 0:t.extended_data)?null:t.extended_data.commute_times||null}catch(t){return console.error("获取缓存通勤时间失败:",t),null}}async getCommuteTime(e,t,r){try{const t=await this.getCachedCommuteTimes(e);return t&&t[r]?t[r]:50}catch(s){return console.error("获取通勤时间失败:",s),50}}async getCachedRecommendations(e){try{const{data:t,error:r}=await supabase.from("followups").select("extended_data").eq("id",e).single();return r||!(null==t?void 0:t.extended_data)?[]:t.extended_data.community_recommendations||[]}catch(t){return console.error("获取缓存推荐失败:",t),[]}}async cacheRecommendations(e,t){try{const{error:r}=await supabase.from("followups").update({extended_data:{community_recommendations:t}}).eq("id",e);r&&console.error("缓存推荐失败:",r)}catch(r){console.error("缓存推荐失败:",r)}}clearLocalCache(){e.communityDataCache=[],e.cacheTimestamp=0}getCacheStatus(){const t=Date.now()-e.cacheTimestamp,r=e.communityDataCache.length;return{hasData:r>0,age:Math.round(t/1e3),count:r}}};__publicField(_CommunityRecommendationService,"instance"),__publicField(_CommunityRecommendationService,"communityDataCache",[]),__publicField(_CommunityRecommendationService,"cacheTimestamp",0),__publicField(_CommunityRecommendationService,"CACHE_DURATION",6048e5);let CommunityRecommendationService=_CommunityRecommendationService;const CommunityRecommendationService$1=Object.freeze(Object.defineProperty({__proto__:null,CommunityRecommendationService:CommunityRecommendationService,default:CommunityRecommendationService},Symbol.toStringTag,{value:"Module"})),{Text:Text$i}=Typography,CommunityRecommendations=({worklocation:e,userbudget:t,customerprofile:r,record:s,compact:n=!1})=>{var i;const[o,a]=reactExports.useState([]),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(null),p=CommunityRecommendationService.getInstance(),m=reactExports.useMemo(()=>{var e;return(null==(e=null==s?void 0:s.extended_data)?void 0:e.commute_times)?s.extended_data.commute_times:null},[null==(i=null==s?void 0:s.extended_data)?void 0:i.commute_times]),h=reactExports.useMemo(()=>m&&"object"==typeof m&&Object.keys(m).length>0,[m]);reactExports.useEffect(()=>{(h||t>0)&&x()},[e,t,r,h]);const x=async()=>{c(!0),d(null);try{const n=await p.getRecommendationsWithCommuteTimes({worklocation:e,userbudget:t,customerprofile:r,followupId:Number(s.id),commuteTimes:m||{}});a(n)}catch(n){d("获取推荐失败"),console.error("加载推荐失败:",n)}finally{c(!1)}};if(l)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:n?"12px":"20px"},children:[jsxRuntimeExports.jsx(Spin,{size:n?"small":"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:"8px",fontSize:n?"12px":"14px"},children:"正在计算推荐..."})]});if(u)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:n?"12px":"20px",color:"#ff4d4f"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:n?"12px":"14px"},children:u}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:x,style:{marginTop:"8px"},children:"重试"})]});if(!h&&t<=0)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:n?"12px":"20px",color:"#999"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:n?"14px":"16px",marginRight:"4px"},children:"ℹ️"}),jsxRuntimeExports.jsx("span",{style:{fontSize:n?"12px":"14px"},children:"请设置用户预算或计算通勤时间以获取社区推荐"})]});if(0===o.length)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:n?"12px":"20px",color:"#999"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:n?"12px":"14px"},children:"暂无推荐社区"}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:x,style:{marginTop:"8px"},children:"重新计算"})]});const f=o;return jsxRuntimeExports.jsx("div",{className:"community-recommendations",style:{margin:0,padding:0},children:f.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{padding:n?"8px 12px":"12px 16px",borderBottom:"1px solid #f0f0f0",display:"flex",alignItems:"center",gap:"12px",marginBottom:(f.length,"0")},children:[jsxRuntimeExports.jsx("div",{style:{width:"135px",height:"8px",background:"#f0f0f0",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:jsxRuntimeExports.jsx("div",{style:{width:`${e.score}%`,height:"100%",background:e.color,borderRadius:"4px",transition:"width 0.3s ease"}})}),jsxRuntimeExports.jsxs("div",{style:{minWidth:"50px",fontSize:"13px",fontWeight:"bold",color:e.color,textAlign:"center",flexShrink:0},children:[e.score,"分"]}),jsxRuntimeExports.jsx(Tag$1,{color:e.color,style:{fontSize:"12px",fontWeight:"bold",flexShrink:0,minWidth:"70px",textAlign:"center",padding:"4px 8px",border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.recommendation}),jsxRuntimeExports.jsx(Text$i,{strong:!0,style:{fontSize:"13px",color:"#333",width:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexShrink:0},children:e.community}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666",flexShrink:0,minWidth:"200px",textAlign:"left"},children:jsxRuntimeExports.jsxs(Space$1,{split:jsxRuntimeExports.jsx("span",{style:{color:"#d9d9d9",margin:"0 4px"},children:"|"}),children:[jsxRuntimeExports.jsxs("span",{children:["通勤: ",e.commuteTime>=0?`${e.commuteTime}分钟`:"未计算"]}),jsxRuntimeExports.jsxs("span",{children:["预算: ",e.budgetScore,"分"]}),jsxRuntimeExports.jsxs("span",{children:["历史: ",e.historicalScore,"分"]})]})})]},e.community))})},useCommuteTimeRealtime=()=>{const[e,t]=reactExports.useState(new Set),r=reactExports.useCallback(async(r,s,n,i)=>{if(!r||!s){const e="工作地点或跟进记录ID缺失，无法计算通勤时间";return staticMethods.warning(e),void(null==i||i(e))}if(e.has(r))staticMethods.warning("该记录正在计算中，请稍候...");else{t(e=>new Set(e).add(r));try{console.log("🚀 开始计算通勤时间:",{followupId:r,worklocation:s}),staticMethods.loading("正在计算通勤时间，请稍候...",0);const{data:e,error:o}=await supabase.rpc("calculate_commute_times_for_worklocation",{p_followup_id:r,p_worklocation:s});if(staticMethods.destroy(),o){console.error("❌ 通勤时间计算API调用失败:",o);const e="通勤时间计算失败: "+(o.message||"未知错误");return staticMethods.error(e),null==i||i(e),void t(e=>{const t=new Set(e);return t.delete(r),t})}if(null==e?void 0:e.success){console.log("✅ 通勤时间计算成功:",e);const t={success:!0,communitiesCount:e.communities_count,commuteTimes:e.commute_times,message:e.message};staticMethods.success(`通勤时间计算成功！已计算 ${e.communities_count||0} 个社区的通勤时间`),null==n||n(t)}else{console.error("❌ 通勤时间计算失败:",e);const t=(null==e?void 0:e.error)||"通勤时间计算失败";staticMethods.error(t),null==i||i(t)}t(e=>{const t=new Set(e);return t.delete(r),t})}catch(o){console.error("❌ 计算通勤时间异常:",o),staticMethods.destroy();const e="计算通勤时间失败: "+(o.message||"网络错误");staticMethods.error(e),null==i||i(e),t(e=>{const t=new Set(e);return t.delete(r),t})}}},[e]),s=reactExports.useCallback(t=>e.has(t),[e]),n=reactExports.useCallback(()=>{t(new Set)},[]);return reactExports.useEffect(()=>n,[n]),{startCalculation:r,isCalculating:s,cleanup:n}},{Paragraph:Paragraph$2}=Typography,RecommendationTag=({record:e,isExpanded:t,onToggleExpand:r})=>{var s,n,i;const[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(!1),{startCalculation:u,isCalculating:d}=useCommuteTimeRealtime(),p=reactExports.useCallback(async()=>{e.worklocation?await u(e.id,e.worklocation,e=>{console.log("✅ 通勤时间计算成功:",e),m()},e=>{console.error("❌ 通勤时间计算失败:",e)}):staticMethods.warning("工作地点缺失，无法计算通勤时间")},[e.id,e.worklocation,u]),m=async()=>{var t,r,s;const n=(null==(t=e.extended_data)?void 0:t.commute_times)&&Object.keys(e.extended_data.commute_times).length>0,i=Number(e.userbudget)>0;if(n||i){c(!0);try{const t=(await __vitePreload(async()=>{const{default:e}=await Promise.resolve().then(()=>CommunityRecommendationService$1);return{default:e}},[])).default.getInstance(),s=await t.getRecommendationsWithCommuteTimes({worklocation:e.worklocation||"",userbudget:Number(e.userbudget)||0,customerprofile:e.customerprofile||"",followupId:Number(e.id),commuteTimes:(null==(r=e.extended_data)?void 0:r.commute_times)||{}});if(s&&s.length>0){const e=s.sort((e,t)=>t.score-e.score)[0],t=[];e.commuteTime>=0&&(e.commuteTime<=30?t.push("通勤近"):e.commuteTime<=60&&t.push("通勤适中")),e.budgetScore>=90&&t.push("预算匹配"),e.historicalScore>=85&&t.push("成交率高"),a({community:e.community,score:e.score,reasons:t})}}catch(o){if(console.error("加载推荐失败:",o),null==(s=e.extended_data)?void 0:s.community_recommendations)try{const t=e.extended_data.community_recommendations;if(Array.isArray(t)&&t.length>0){const e=t.sort((e,t)=>t.score-e.score)[0],r=[];e.commuteTime>=0&&(e.commuteTime<=30?r.push("通勤近"):e.commuteTime<=60&&r.push("通勤适中")),e.budgetScore>=90&&r.push("预算匹配"),e.historicalScore>=85&&r.push("成交率高"),a({community:e.community,score:e.score,reasons:r})}}catch(l){console.error("读取缓存推荐失败:",l)}}finally{c(!1)}}};reactExports.useEffect(()=>{m()},[e.worklocation,e.userbudget,e.customerprofile,null==(s=e.extended_data)?void 0:s.commute_times]);const h=(null==(n=e.extended_data)?void 0:n.commute_times)&&Object.keys(e.extended_data.commute_times).length>0,x=Number(e.userbudget)>0;return h||x?l||d(e.id)?jsxRuntimeExports.jsx("div",{style:{padding:"6px 8px",borderBottom:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fafafa",borderRadius:"4px",fontSize:"12px",color:"#666"},children:jsxRuntimeExports.jsx("span",{children:d(e.id)?"计算通勤中...":"计算推荐中..."})}):o?jsxRuntimeExports.jsxs("div",{style:{padding:"6px 8px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fafafa",borderRadius:"4px",cursor:r?"pointer":"default",transition:"all 0.2s ease"},onMouseEnter:e=>{r&&(e.currentTarget.style.background="#f0f0f0")},onMouseLeave:e=>{r&&(e.currentTarget.style.background="#fafafa")},onClick:()=>{r&&r()},children:[jsxRuntimeExports.jsxs("div",{style:{flex:1},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:"#333",marginBottom:"6px",lineHeight:"1.2"},children:o.community}),jsxRuntimeExports.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",alignItems:"center"},children:o.reasons&&o.reasons.map((e,t)=>jsxRuntimeExports.jsx(Tag$1,{color:"通勤近"===e?"green":"通勤适中"===e?"cyan":"预算匹配"===e?"orange":"历史成交好"===e?"purple":"blue",style:{fontSize:"10px",margin:0,lineHeight:"1.2"},children:e},t))})]}),jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"flex-end"}})]}):((null==(i=e.extended_data)?void 0:i.commute_times)&&Object.keys(e.extended_data.commute_times).length,jsxRuntimeExports.jsxs("div",{style:{padding:"6px 8px",borderBottom:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fafafa",borderRadius:"4px",fontSize:"12px",color:"#666"},children:[jsxRuntimeExports.jsx("span",{children:"推荐社区"}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:p,style:{padding:"0",height:"auto",fontSize:"12px"},children:"计算通勤"})]})):null},EditableInput=({value:e,placeholder:t,style:r,onSave:s,disabled:n,allowClear:i})=>{const[o,a]=reactExports.useState(e);return reactExports.useEffect(()=>{a(e)},[e]),jsxRuntimeExports.jsx(Input$1,{value:o,placeholder:t,style:r,onChange:e=>a(e.target.value),onBlur:t=>{const r=t.target.value;r!==e&&s(r)},disabled:n,allowClear:i})},EditableInputNumber=({value:e,placeholder:t,style:r,onSave:s,disabled:n,formatter:i,parser:o,min:a,precision:l})=>{const[c,u]=reactExports.useState(e?Number(e):void 0);return reactExports.useEffect(()=>{u(e?Number(e):void 0)},[e]),jsxRuntimeExports.jsx(TypedInputNumber,{value:c,placeholder:t,style:r,onChange:e=>u(e||void 0),onBlur:()=>{const t=c,r=e?Number(e):void 0;if(t!==r&&(void 0!==t||void 0!==r)){const e=null!=t?String(t):"";console.log("🔄 [EditableInputNumber] 预算值变化，触发保存:",{original:r,current:t,stringValue:e}),s(e)}},onPressEnter:()=>{const t=c,r=e?Number(e):void 0;if(t!==r&&(void 0!==t||void 0!==r)){const e=null!=t?String(t):"";console.log("🔄 [EditableInputNumber] 预算值变化（回车），触发保存:",{original:r,current:t,stringValue:e}),s(e)}},disabled:n,formatter:i,parser:o,min:a,precision:l})},FollowupsTable=({data:e,loading:t,pagination:r,columnFilters:s,communityEnum:n,followupstageEnum:i,customerprofileEnum:o,sourceEnum:a,userratingEnum:l,majorCategoryOptions:c,metroStationOptions:u,onTableChange:d,onRowEdit:p,onLeadDetailClick:m,onStageClick:h,onRollbackClick:x,isFieldDisabled:f,forceUpdate:g,leadtypeFilters:y,remarkFilters:v,worklocationFilters:E,followupresultFilters:j,majorcategoryFilters:b,scheduledcommunityFilters:w,interviewsalesUserList:R,interviewsalesUserLoading:_,findCascaderPath:S})=>{const[C,k]=reactExports.useState([]),$=reactExports.useCallback(e=>{k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),T=Array.isArray(e)?e:[],I={minWidth:140,maxWidth:180,paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},P=reactExports.useMemo(()=>getFollowupsTableFilters(n,i,o,a,l,c,u,y,v,E,j,b,w,e=>{console.log("筛选器重置:",e)},e=>{console.log("筛选器确认:",e)}),[n,i,o,a,l,c,u,y,v,E,j,b,w]),A=reactExports.useMemo(()=>[{title:"线索编号",dataIndex:"leadid",key:"leadid",fixed:"left",ellipsis:!0,filterDropdown:P.leadid,filteredValue:s.leadid??null,onCell:()=>({style:{...I,minWidth:120,maxWidth:180}}),render:(e,t)=>e?jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center"},children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",style:{padding:0,height:"auto",fontSize:15,color:"#1677ff",fontWeight:"normal",display:"inline-block",whiteSpace:"nowrap"},onClick:()=>m(t.leadid),children:e}),jsxRuntimeExports.jsx(Paragraph$2,{copyable:{text:e,tooltips:!1,icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,marginLeft:4,display:"inline-block",whiteSpace:"nowrap"}})]})}):jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"})},{title:"跟进阶段",dataIndex:"followupstage",key:"followupstage",fixed:"left",width:100,ellipsis:!0,filterDropdown:P.followupstage,filteredValue:s.followupstage??null,onCell:()=>({style:{minWidth:100}}),render:(e,t)=>{const r=i.find(t=>t.value===e),s={"丢单":"#ff4d4f","待接收":"#bfbfbf","确认需求":"#1677ff","邀约到店":"#fa8c16","已到店":"#52c41a","赢单":"#faad14"}[(null==r?void 0:r.label)||e]||"#1677ff";return jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{background:s,borderColor:s,color:"#fff",boxShadow:"none",minWidth:60,padding:"0 8px"},onClick:()=>h(t),children:(null==r?void 0:r.label)||e})}},{title:"推荐社区",dataIndex:"recommendation",key:"recommendation",fixed:"left",width:"auto",ellipsis:!1,onCell:()=>({style:{minWidth:160,maxWidth:"none",whiteSpace:"nowrap"}}),render:(e,t)=>{var r;const s=C.includes(t.id),n=(null==(r=t.extended_data)?void 0:r.commute_times)&&Object.keys(t.extended_data.commute_times).length>0,i=Number(t.userbudget)>0,o=!(!n&&!i);return jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:jsxRuntimeExports.jsx(RecommendationTag,{record:t,isExpanded:s,onToggleExpand:o?()=>$(t.id):void 0})})}},{title:"手机号",dataIndex:"phone",key:"phone",width:140,ellipsis:!0,filterDropdown:P.phone,filteredValue:s.phone??null,onCell:()=>({style:{...I}}),render:e=>{if(!e)return jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"});const t=!(r=e)||r.length<7?r:r.substring(0,4)+"****"+r.substring(r.length-3);var r;return jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx(Paragraph$2,{copyable:{text:e,tooltips:!1,icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,display:"inline-block",whiteSpace:"nowrap"},children:t})})}},{title:"微信号",dataIndex:"wechat",key:"wechat",width:140,ellipsis:!0,filterDropdown:P.wechat,filteredValue:s.wechat??null,onCell:()=>({style:{...I}}),render:e=>{if(!e)return jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"});const t=!(r=e)||r.length<4?r:r.substring(0,2)+"****"+r.substring(r.length-2);var r;return jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx(Paragraph$2,{copyable:{text:e,tooltips:!1,icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,display:"inline-block",whiteSpace:"nowrap"},children:t})})}},{title:"创建日期",dataIndex:"created_at",key:"created_at",width:160,ellipsis:!0,filterDropdown:P.created_at,filteredValue:s.created_at??null,onCell:()=>({style:{...I}}),render:e=>{const t=e?new Date(e).toLocaleString("zh-CN"):"";return jsxRuntimeExports.jsx(Tooltip,{title:t,placement:"topLeft",children:jsxRuntimeExports.jsx("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"},children:t})})},sorter:(e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()},{title:"渠道",dataIndex:"source",key:"source",width:100,ellipsis:!0,filterDropdown:P.source,filteredValue:s.source??null,onCell:()=>({style:{...I,minWidth:60,maxWidth:100}}),render:e=>{const t=a.find(t=>t.value===e);return jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:(null==t?void 0:t.label)||e})}},{title:"线索来源",dataIndex:"leadtype",key:"leadtype",width:120,ellipsis:!0,filterDropdown:P.leadtype,filteredValue:s.leadtype??null,onCell:()=>({style:{...I}}),render:e=>e?jsxRuntimeExports.jsx("span",{children:e}):jsxRuntimeExports.jsx("span",{style:{color:"#bbb"},children:"-"})},{title:"约访管家",dataIndex:"interviewsales_user_id",key:"interviewsales_user_id",width:120,ellipsis:!0,filterDropdown:P.interviewsales_user_id,filteredValue:s.interviewsales_user_id??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#bfbfbf",marginRight:6,fontSize:18}}),t.interviewsales_user_name||t.interviewsales_user||"-"]})},{title:"用户画像",dataIndex:"customerprofile",key:"customerprofile",width:160,ellipsis:!0,filterDropdown:P.customerprofile,filteredValue:s.customerprofile??null,onCell:()=>({style:{...I,minWidth:140,maxWidth:200}}),render:(e,t)=>jsxRuntimeExports.jsx(Select,{value:e,options:o,style:{minWidth:140,maxWidth:200},onChange:r=>{r!==e&&p(t,"customerprofile",r)},onBlur:()=>{e!==t.customerprofile&&p(t,"customerprofile",t.customerprofile)},disabled:f(),placeholder:"选择用户画像"},g)},{title:"工作地点",dataIndex:"worklocation",key:"worklocation",width:180,ellipsis:!0,filterDropdown:P.worklocation,filteredValue:s.worklocation??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(Tooltip,{title:e||"未设置工作地点",children:jsxRuntimeExports.jsx(Cascader,{options:u,value:e?S(u,e):void 0,onChange:async(r,s)=>{let n="";s&&s.length>1?n=s[1].label:s&&1===s.length&&(n=s[0].label),n!==e&&n&&p(t,"worklocation",n)},placeholder:"请选择工作地点",style:{width:"100%",maxWidth:160},showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:f()},g)})},{title:"用户预算",dataIndex:"userbudget",key:"userbudget",width:120,ellipsis:!0,filterDropdown:P.userbudget,filteredValue:s.userbudget??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(EditableInputNumber,{value:e,placeholder:"输入预算金额",style:{minWidth:100,maxWidth:140},onSave:e=>p(t,"userbudget",e),disabled:f(),formatter:e=>`¥ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/¥\s?|(,*)/g,"")),min:0,precision:2})},{title:"入住日期",dataIndex:"moveintime",key:"moveintime",width:150,ellipsis:!0,filterDropdown:P.moveintime,filteredValue:s.moveintime??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(DatePicker$2,{locale:locale$4,style:{minWidth:120,maxWidth:180},placeholder:"请选择入住日期",value:e?dayjs(e):void 0,format:"YYYY-MM-DD",onChange:async e=>{if(e){const r=e.format("YYYY-MM-DD")+" 00:00:00";p(t,"moveintime",r)}},disabled:f()},g)},{title:"来访意向",dataIndex:"userrating",key:"userrating",width:120,ellipsis:!0,filterDropdown:P.userrating,filteredValue:s.userrating??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(Select,{value:e,options:l,style:{minWidth:100,maxWidth:140},onChange:r=>{r!==e&&p(t,"userrating",r)},onBlur:()=>{e!==t.userrating&&p(t,"userrating",t.userrating)},disabled:f()},g)},{title:"跟进结果",dataIndex:"majorcategory",key:"majorcategory",width:220,ellipsis:!0,filterDropdown:P.majorcategory,filteredValue:s.majorcategory??null,onCell:()=>({style:{...I,minWidth:180,maxWidth:260}}),render:(e,t)=>jsxRuntimeExports.jsx(Cascader,{options:c,value:S(c,e),onChange:async(r,s)=>{const n=s&&s.length>1?s[1].label:"";n!==e&&p(t,"majorcategory",n)},placeholder:"请选择跟进结果",style:{minWidth:180,maxWidth:260},showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:f()},g)},{title:"跟进备注",dataIndex:"followupresult",key:"followupresult",width:180,ellipsis:!0,filterDropdown:P.followupresult,filteredValue:s.followupresult??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(EditableInput,{value:e,placeholder:"输入跟进备注",style:{minWidth:120,maxWidth:180},onSave:e=>p(t,"followupresult",e),disabled:f(),allowClear:!0})},{title:"预约到店时间",dataIndex:"scheduletime",key:"scheduletime",width:160,ellipsis:!0,filterDropdown:P.scheduletime,filteredValue:s.scheduletime??null,onCell:()=>({style:{...I}}),render:(e,t)=>jsxRuntimeExports.jsx(DatePicker$2,{locale:locale$4,style:{minWidth:120,maxWidth:180},placeholder:"请选择预约时间",value:e?dayjs(e):void 0,format:"YYYY-MM-DD HH:mm",showTime:{format:"HH:mm"},onChange:async e=>{if(e){const r=e.format("YYYY-MM-DD HH:mm:ss");p(t,"scheduletime",r)}},disabled:f()},g)},{title:"预约社区",dataIndex:"scheduledcommunity",key:"scheduledcommunity",width:180,ellipsis:!0,filterDropdown:P.scheduledcommunity,filteredValue:s.scheduledcommunity??null,onCell:()=>({style:{...I,minWidth:160,maxWidth:220}}),render:(e,t)=>jsxRuntimeExports.jsx(Select,{value:e,options:n,style:{minWidth:160,maxWidth:220},onChange:r=>{r!==e&&p(t,"scheduledcommunity",r)},onBlur:()=>{e!==t.scheduledcommunity&&p(t,"scheduledcommunity",t.scheduledcommunity)},disabled:f(),placeholder:"选择预约社区"},g)},{title:"操作",key:"action",fixed:"right",width:100,render:(e,t)=>jsxRuntimeExports.jsx(Button$1,{size:"small",type:"default",danger:!0,onClick:()=>x(t),disabled:t.invalid,children:t.invalid?"已回退":"回退"})}],[s,n,i,o,a,l,c,u,m,h,x,p,f,g,P,S]);return jsxRuntimeExports.jsx(ForwardTable,{columns:A,dataSource:T,rowKey:"id",loading:t,pagination:{current:r.current,pageSize:r.pageSize,total:r.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{d({current:e,pageSize:t,total:r.total},{})}},scroll:{x:"max-content",y:600},size:"small",bordered:!1,className:"rounded-lg overflow-hidden",rowClassName:()=>"compact-table-row",tableLayout:"fixed",sticky:!0,expandable:{expandedRowKeys:C,expandedRowRender:e=>jsxRuntimeExports.jsx("div",{style:{padding:"16px",background:"#fafafa",margin:"0 -16px"},children:jsxRuntimeExports.jsx(CommunityRecommendations,{worklocation:e.worklocation||"",userbudget:Number(e.userbudget)||0,customerprofile:e.customerprofile||"",record:e,compact:!0})}),rowExpandable:e=>{var t;const r=(null==(t=e.extended_data)?void 0:t.commute_times)&&Object.keys(e.extended_data.commute_times).length>0,s=Number(e.userbudget)>0;return!(!r&&!s)},expandRowByClick:!1,expandIcon:()=>null,onExpandedRowsChange:e=>{k([...e])},indentSize:0,showExpandColumn:!1},locale:{emptyText:jsxRuntimeExports.jsxs("div",{style:{padding:"40px 0",textAlign:"center"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"16px",color:"#666",marginBottom:"8px"},children:t?"加载中...":"暂无跟进记录"}),!t&&jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#999"},children:"尝试调整筛选条件或刷新数据"})]})},onChange:(e,t,r)=>{if(t&&Object.keys(t).length>0){const r={};Object.entries(t).forEach(([e,t])=>{t&&Array.isArray(t)&&t.length>0&&(r[e]=t)}),d(e,r)}else d(e,{})}})},FrequencyAlert=({cooldown:e})=>e?jsxRuntimeExports.jsx(Alert,{type:"warning",showIcon:!0,banner:!0,style:{marginBottom:16,fontSize:14,fontWeight:"normal",textAlign:"left"},message:jsxRuntimeExports.jsxs("span",{children:[e.message,e.secondsLeft>0&&jsxRuntimeExports.jsxs("span",{style:{marginLeft:8,fontWeight:"bold"},children:["(剩余 ",e.secondsLeft," 秒)"]})]})}):null,stageFields$3={"丢单":["majorcategory","followupresult"],"待接收":[],"确认需求":["customerprofile","worklocation","userbudget","moveintime","userrating","majorcategory","followupresult"],"邀约到店":["scheduletime","scheduledcommunity"],"已到店":[],"赢单":[]},getFieldLabel$1=(e,t)=>{console.log("🔍 [getFieldLabel] 函数调用:",{field:e,currentStage:t});if("丢单"===t&&"followupresult"===e)return console.log("🔍 [getFieldLabel] 返回丢单原因"),"丢单原因";const r={customerprofile:"用户画像",worklocation:"工作地点",userbudget:"用户预算",moveintime:"入住时间",userrating:"来访意向",majorcategory:"跟进结果",followupresult:"跟进备注",scheduletime:"预约到店时间",scheduledcommunity:"预约社区",followupstage:"跟进阶段",leadtype:"线索类型",invalid:"是否无效"}[e]||e;return console.log("🔍 [getFieldLabel] 返回结果:",{field:e,result:r}),r},FollowupStageForm=({form:e,stage:t,record:r,isFieldDisabled:s=()=>!1,forceUpdate:n=0,communityEnum:i,followupstageEnum:o,customerprofileEnum:a,userratingEnum:l,majorCategoryOptions:c,metroStationOptions:u,enableManualAssign:d=!1,onAllocationModeChange:p})=>{if(console.log("🔍 [FollowupStageForm] 组件开始渲染:",{stage:t,record:null==r?void 0:r.id}),!e)return console.error("❌ [FollowupStageForm] form 参数为空"),jsxRuntimeExports.jsx("div",{children:"表单参数错误"});if(!t)return console.warn("⚠️ [FollowupStageForm] stage 参数为空"),jsxRuntimeExports.jsx("div",{children:"阶段参数为空"});const m=reactExports.useMemo(()=>({community:Array.isArray(i)&&i.length>0,followupstage:Array.isArray(o)&&o.length>0,customerprofile:Array.isArray(a)&&a.length>0,userrating:Array.isArray(l)&&l.length>0,majorCategory:Array.isArray(c)&&c.length>0,metroStation:Array.isArray(u)&&u.length>0}),[i,o,a,l,c,u]),h=reactExports.useMemo(()=>stageFields$3[t]||[],[t]),x=h.includes("scheduledcommunity"),f=h.includes("customerprofile"),g=h.includes("userrating"),y=h.includes("majorcategory"),v=h.includes("worklocation"),E=(!x||m.community)&&(!f||m.customerprofile)&&(!g||m.userrating)&&(!y||m.majorCategory)&&(!v||m.metroStation),j=reactExports.useCallback(t=>{let r=!1;const s={};["moveintime","scheduletime"].forEach(e=>{if(e in t){const n=t[e];n&&""!==n&&null!==n?dayjs.isDayjs(n)||(s[e]=dayjs(n),r=!0):(s[e]=void 0,r=!0)}}),r&&e.setFieldsValue(s)},[e]),b=reactExports.useCallback((r,n,d)=>{const p={name:r,label:n,rules:d?[{required:!0,message:`请填写${n}`}]:void 0};switch(r){case"followupstage":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Select,{options:o,placeholder:`请选择${n}`,loading:0===o.length,disabled:0===o.length||s()})});case"customerprofile":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Select,{options:a,placeholder:`请选择${n}`,loading:0===a.length,disabled:0===a.length||s()})});case"userrating":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Select,{options:l,placeholder:`请选择${n}`,loading:0===l.length,disabled:0===l.length||s()})});case"scheduledcommunity":return"邀约到店"===t?null:jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Select,{options:i,placeholder:`请选择${n}`,loading:0===i.length,disabled:0===i.length||s()})});case"worklocation":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Cascader,{options:Array.isArray(u)?u:[],placeholder:`请选择${n}`,showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:s(),onChange:(t,s)=>{let n="";s&&s.length>1?n=s[1].label:s&&1===s.length&&(n=s[0].label),n&&e.setFieldValue(r,n)}})});case"userbudget":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(TypedInputNumber,{style:{width:"100%"},placeholder:`请输入${n}`,min:0,precision:0,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number((null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||0),disabled:s()})});case"moveintime":case"scheduletime":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,locale:locale$4,style:{width:"100%"},placeholder:`请选择${n}`,disabled:s()})});case"majorcategory":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:Array.isArray(c)&&c.length>0?jsxRuntimeExports.jsx(Cascader,{options:c,placeholder:`请选择${n}`,showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:s()}):jsxRuntimeExports.jsx(Input$1,{placeholder:`${n}选项加载中...`,disabled:!0})});case"followupresult":return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:`请输入${n}`,rows:4,maxLength:500,showCount:!0,disabled:s()})});default:return jsxRuntimeExports.jsx(Form$4.Item,{...p,children:jsxRuntimeExports.jsx(Input$1,{placeholder:`请输入${n}`,disabled:s()})})}},[o,a,l,c,u,s,t,e]),w=reactExports.useCallback(e=>{console.log("🔍 [FollowupStageForm] renderField 调用:",{field:e,stage:t});const r=getFieldLabel$1(e,t);console.log("🔍 [FollowupStageForm] getFieldLabel 结果:",{field:e,stage:t,label:r});let s=!1;return s="确认需求"===t?"moveintime"!==e:["customerprofile","userrating","scheduledcommunity","majorcategory","followupresult"].includes(e),b(e,r,s)},[t,b]),R=reactExports.useCallback(()=>"确认需求"===t?jsxRuntimeExports.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:h.map(e=>jsxRuntimeExports.jsx("div",{children:w(e)},e))}):"邀约到店"===t||"丢单"===t||"已到店"===t||"赢单"===t?jsxRuntimeExports.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:h.map(e=>jsxRuntimeExports.jsx("div",{children:w(e)},e))}):jsxRuntimeExports.jsx("div",{children:h.map(e=>jsxRuntimeExports.jsx("div",{children:w(e)},e))}),[t,h,w]),_=reactExports.useCallback(()=>"邀约到店"!==t?null:jsxRuntimeExports.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Form$4.Item,{label:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx("span",{children:d?"手动分配":"自动分配"}),jsxRuntimeExports.jsx(Switch$1,{checked:d,onChange:p,size:"small"})]}),children:d?jsxRuntimeExports.jsx(Form$4.Item,{name:"assigned_showingsales",rules:[{required:d,message:"请选择带看人员"}],style:{marginBottom:0},children:jsxRuntimeExports.jsx(UserTreeSelect,{placeholder:"请选择带看人员",disabled:s(),multiple:!1,showSearch:!0,allowClear:!0,treeDefaultExpandAll:!1,style:{width:"100%"}})}):jsxRuntimeExports.jsx(Form$4.Item,{name:"scheduledcommunity",rules:[{required:!0,message:"请选择预约社区"}],style:{marginBottom:0},children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择预约社区",options:i,showSearch:!0,filterOption:(e,t)=>((null==t?void 0:t.label)??"").toString().toLowerCase().includes(e.toLowerCase())})})})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Form$4.Item,{name:"scheduletime",label:"预约到店时间",rules:[{required:!0,message:"请选择预约到店时间"}],children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,locale:locale$4,style:{width:"100%"},placeholder:"请选择预约到店时间",disabled:s()})})})]}),[t,d,p,s,i]);return E?0===h.length?jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[jsxRuntimeExports.jsx("p",{children:"当前阶段无需填写额外信息"}),jsxRuntimeExports.jsx("p",{children:'点击"下一步"继续推进'})]}):"已到店"===t||"赢单"===t?jsxRuntimeExports.jsx(Form$4,{form:e,layout:"vertical",preserve:!1}):jsxRuntimeExports.jsx(Form$4,{form:e,layout:"vertical",onValuesChange:j,preserve:!1,children:"邀约到店"===t?_():R()}):jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[jsxRuntimeExports.jsx("p",{children:"正在加载表单数据..."}),jsxRuntimeExports.jsx("p",{children:"请稍候"})]})},tableStyles="\n  .contract-deals-table .ant-table-measure-row {\n    display: none ;\n  }\n  \n  .contract-deals-table .ant-table-tbody > tr.ant-table-measure-row {\n    display: none ;\n  }\n  \n  .contract-deals-table .ant-table-tbody > tr.ant-table-measure-row > td {\n    display: none ;\n  }\n",ContractDealsTable=({dealsList:e,dealsLoading:t,onAdd:r,onEdit:s,onDelete:n,isReadOnly:i=!1,communityEnum:o,setDealsList:a})=>jsxRuntimeExports.jsxs("div",{style:{width:"100%",minWidth:0,display:"flex",flexDirection:"column",flex:"0 0 auto",height:"fit-content",maxHeight:"none",overflow:"visible"},children:[jsxRuntimeExports.jsx("style",{dangerouslySetInnerHTML:{__html:tableStyles}}),jsxRuntimeExports.jsxs("div",{style:{background:"transparent",borderRadius:0,padding:"8px 0",minHeight:"auto",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"none",flex:"0 0 auto"},children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:500,fontSize:14,color:"#666",display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{style:{marginRight:8},children:"📊 签约记录"}),jsxRuntimeExports.jsxs("span",{style:{fontSize:14,color:"#999",fontWeight:400},children:["(共 ",e.length," 条记录)"]})]}),!i&&jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{height:28,borderRadius:4,fontWeight:500,marginRight:0,fontSize:14},onClick:r,children:"新增"})]}),jsxRuntimeExports.jsx("div",{style:{flex:"0 0 auto",height:"fit-content",overflow:"visible"},children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:e,loading:t,size:"small",pagination:!1,scroll:{x:"max-content"},style:{backgroundColor:"transparent",width:"100%",minWidth:0,height:"fit-content",maxHeight:"none"},tableLayout:"fixed",columns:[{title:"签约日期",dataIndex:"contractdate",key:"contractdate",width:100,ellipsis:!0,render:(e,t)=>!i&&t.isEditing?jsxRuntimeExports.jsx(DatePicker$2,{size:"small",value:e?dayjs(e):void 0,format:"YYYY-MM-DD",onChange:e=>{const r=e?e.format("YYYY-MM-DD"):"";a(e=>e.map(e=>e.id===t.id?{...e,contractdate:r}:e))},style:{width:"100%"}}):e?dayjs(e).format("YYYY-MM-DD"):"-"},{title:"签约社区",dataIndex:"community",key:"community",width:120,ellipsis:!0,render:(e,t)=>!i&&t.isEditing?jsxRuntimeExports.jsx(Select,{size:"small",value:e,options:o,placeholder:"选择社区",style:{width:"100%"},onChange:e=>{a(r=>r.map(r=>r.id===t.id?{...r,community:e}:r))}}):e?jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:e}):"-"},{title:"签约操作编号",dataIndex:"contractnumber",key:"contractnumber",width:140,ellipsis:!0,render:(e,t)=>!i&&t.isEditing?jsxRuntimeExports.jsx(Input$1,{size:"small",value:e,placeholder:"输入操作编号",onChange:e=>{a(r=>r.map(r=>r.id===t.id?{...r,contractnumber:e.target.value}:r))}}):e?jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#1890ff"},children:e}):"-"},{title:"签约房间号",dataIndex:"roomnumber",key:"roomnumber",width:120,ellipsis:!0,render:(e,t)=>!i&&t.isEditing?jsxRuntimeExports.jsx(Input$1,{size:"small",value:e,placeholder:"输入房间号",onChange:e=>{a(r=>r.map(r=>r.id===t.id?{...r,roomnumber:e.target.value}:r))}}):e||"-"},{title:"操作",key:"action",width:80,fixed:"right",ellipsis:!1,render:(e,t)=>i?null:t.isEditing?jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",alignItems:"stretch"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:async()=>s(t),style:{width:"100%",fontSize:12,borderRadius:4,fontWeight:500,boxShadow:"0 2px 4px rgba(24, 144, 255, 0.2)"},children:"确认提交"}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>n(t),style:{width:"100%",fontSize:12,borderRadius:4,borderColor:"#d9d9d9",color:"#666",backgroundColor:"#fafafa"},children:"取消"})]}):jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>s(t),style:{width:"100%",fontSize:12,height:28,borderRadius:4,borderColor:"#1890ff",color:"#1890ff",backgroundColor:"transparent",fontWeight:500,transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f8ff",e.currentTarget.style.borderColor="#40a9ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#1890ff"},children:"编辑"})}],rowKey:"id",locale:{emptyText:t?"加载中...":'暂无签约记录，\n点击"新增"按钮添加'}})})]}),{Paragraph:Paragraph$1}=Typography,followupStages$1=["丢单","待接收","确认需求","邀约到店","已到店","赢单"],stageFields$2={"丢单":["majorcategory","followupresult"],"待接收":[],"确认需求":["customerprofile","worklocation","userbudget","moveintime","userrating","majorcategory","followupresult"],"邀约到店":["scheduletime","scheduledcommunity"],"已到店":[],"赢单":[]},maskPhone$1=e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"",maskWechat$1=e=>e?e.length>6?e.substring(0,3)+"***"+e.substring(e.length-3):e:"",processCascaderValue$1=(e,t)=>{if(!e||!Array.isArray(e))return e;if("worklocation"===t||"majorcategory"===t){if(e.length>1)return e[1];if(1===e.length)return e[0]}return e},processFormValues$1=e=>{const t={...e};return["worklocation","majorcategory"].forEach(e=>{t[e]&&Array.isArray(t[e])&&(t[e]=processCascaderValue$1(t[e],e))}),t},validateUpdateObject=(e,t)=>{const r=[];return t||r.push("记录ID不能为空"),e&&0!==Object.keys(e).length||r.push("更新对象不能为空"),Object.entries(e).forEach(([e,t])=>{try{JSON.stringify(t)}catch(e2){r.push(`字段 ${e} 包含循环引用`)}if(("moveintime"===e||"scheduletime"===e)&&t&&"string"==typeof t){const s=new Date(t);isNaN(s.getTime())&&r.push(`字段 ${e} 的日期格式无效: ${t}`)}"userbudget"===e&&null!=t&&""!==t&&isNaN(Number(t))&&r.push(`字段 ${e} 必须是数字: ${t}`)}),{isValid:0===r.length,errors:r}},FollowupStageDrawer=({open:e,onClose:t,record:r,onSave:s,isFieldDisabled:n=()=>!1,forceUpdate:i=0,communityEnum:o,followupstageEnum:a,customerprofileEnum:l,userratingEnum:c,majorCategoryOptions:u,metroStationOptions:d})=>{const[p]=Form$4.useForm(),[m,h]=reactExports.useState(0),[x,f]=reactExports.useState(""),[g,y]=reactExports.useState(!1),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState(!1),[w,R]=reactExports.useState([]),[_,S]=reactExports.useState(!1),[C,k]=reactExports.useState(!1),$=reactExports.useRef(!1),T=reactExports.useRef(!1),I=reactExports.useRef(!1);reactExports.useEffect(()=>{if(r&&e){const e=followupStages$1.findIndex(e=>e===r.followupstage);h(Math.max(0,e)),f(r.followupstage||"待接收"),A(),$.current=!1,T.current=!1,I.current=!1}},[r,e]),reactExports.useEffect(()=>{if(p&&r&&e){const e=setTimeout(()=>{const e={id:r.id,leadid:r.leadid,followupstage:r.followupstage,phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(t=>{e[t]&&(e[t]=dayjs(e[t]))});(stageFields$2[r.followupstage]||[]).forEach(t=>{e[t]||(e[t]="budget"===t||"renttime"===t?0:"viewresult"===t?"待填写":"")}),p.setFieldsValue(e),$.current=!1,I.current=!1},300);return()=>clearTimeout(e)}},[p,r,e]);const P=async()=>{try{if(r&&p){const e=p.getFieldsValue(),t=processFormValues$1(e);let n=!1;if(Object.keys(t).forEach(e=>{void 0!==t[e]&&null!==t[e]&&""!==t[e]&&(n=!0)}),n){const e={};Object.keys(t).forEach(r=>{void 0!==t[r]&&null!==t[r]&&""!==t[r]&&(e[r]=t[r])}),["moveintime","scheduletime"].forEach(t=>{var r;e[t]&&"function"==typeof(null==(r=e[t])?void 0:r.format)&&(e[t]=e[t].format("YYYY-MM-DD HH:mm:ss"))});const n=validateUpdateObject(e,r.id);if(!n.isValid)return console.error("❌ [自动保存数据验证失败] 更新对象验证失败:",n.errors),void staticMethods.warning(`数据验证失败: ${n.errors.join(", ")}`);console.log("🔍 [调试] 自动保存请求参数:",{table:"followups",id:r.id,updateObj:e,updateObjKeys:Object.keys(e)});const{error:i,data:o}=await supabase.from("followups").update(e).eq("id",r.id).select();i?(console.error("❌ [自动保存错误] 详细错误信息:",{code:i.code,message:i.message,details:i.details,hint:i.hint,requestParams:{table:"followups",id:r.id,updateObj:e}}),staticMethods.warning("数据保存失败，请检查网络连接")):(console.log("✅ [自动保存成功] 更新成功:",o),I.current||staticMethods.success("数据已自动保存"),s&&s(r,{...e,_autoSaveOnClose:!0}))}}}catch(e){staticMethods.warning("自动保存失败，请检查网络连接")}finally{h(0),f(""),R([]),S(!1),E(!1),b(!1),t()}},A=async()=>{if(null==r?void 0:r.leadid){S(!0);try{const{data:e,error:t}=await supabase.from("deals").select("*").eq("leadid",r.leadid).order("created_at",{ascending:!1});if(t)return void staticMethods.error("获取签约记录失败");R(e||[])}catch(e){staticMethods.error("获取签约记录失败")}finally{S(!1)}}},F=async e=>{if(r)try{y(!0);const t=await p.validateFields(),n=processFormValues$1(t);["moveintime","scheduletime"].forEach(e=>{var t;n[e]&&"function"==typeof(null==(t=n[e])?void 0:t.format)&&(n[e]=n[e].format("YYYY-MM-DD HH:mm:ss"))});const{assigned_showingsales:i,...o}=n,a={...o,...e};e&&e.followupstage&&(a._stageChange=!0);const l=r.worklocation,c=a.worklocation,u=c&&c!==l,{error:d}=await supabase.from("followups").update(a).eq("id",r.id);if(d)throw d;return I.current=!0,s&&s(r,a),u&&(console.log("🚀 [FollowupStageDrawer] 保存成功，开始自动通勤时间计算"),setTimeout(async()=>{try{const{error:e}=await supabase.rpc("calculate_commute_times_for_worklocation",{p_followup_id:r.id,p_worklocation:c});e?console.error("❌ [FollowupStageDrawer] 自动通勤时间计算失败:",e):console.log("✅ [FollowupStageDrawer] 自动通勤时间计算已触发")}catch(e){console.error("❌ [FollowupStageDrawer] 自动通勤时间计算异常:",e)}},1e3)),{success:!0}}catch(t){const e=t.message||"未知错误";return staticMethods.error("保存失败: "+e),{success:!1,error:e}}finally{y(!1)}},M=async()=>{if(!C)try{k(!0)}catch(e){console.error("❌ [handleClose] 执行过程中发生错误:",e)}finally{k(!1),P()}};return jsxRuntimeExports.jsx(Drawer,{title:"跟进阶段进度",placement:"bottom",open:e,onClose:P,destroyOnHidden:!0,height:"60vh",className:"followup-stage-drawer",maskClosable:!0,footer:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"8px",justifyContent:"flex-end"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:P,children:"取消"}),"丢单"!==x&&m>0&&jsxRuntimeExports.jsx(Button$1,{disabled:0===m,size:"middle",onClick:async()=>{try{if(!r)return void staticMethods.error("无当前记录，无法保存");const e=p.getFieldsValue(),t=processFormValues$1(e),n={};Object.keys(t).forEach(e=>{void 0!==t[e]&&null!==t[e]&&""!==t[e]&&(n[e]=t[e])}),["moveintime","scheduletime"].forEach(e=>{var t;n[e]&&"function"==typeof(null==(t=n[e])?void 0:t.format)&&(n[e]=n[e].format("YYYY-MM-DD HH:mm:ss"))}),n.followupstage=followupStages$1[m-1];const{error:i}=await supabase.from("followups").update(n).eq("id",r.id);if(i)throw console.error("上一步保存失败:",i),i;h(m-1),f(followupStages$1[m-1]),s&&s(r,n);setTimeout(()=>{const e={id:r.id,leadid:r.leadid,followupstage:followupStages$1[m-1],phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(t=>{e[t]&&(e[t]=dayjs(e[t]))}),p.setFieldsValue(e)},100);staticMethods.success("已回退到上一阶段")}catch(e){staticMethods.error("保存失败: "+(e.message||"未知错误"))}},children:"上一步"}),"邀约到店"===x&&jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:async()=>{if(!n()&&r&&!v){E(!0);try{const t=await p.validateFields();if(j){const s=t.assigned_showingsales;if(!s)return void staticMethods.error("请选择带看人员");const n=t.scheduledcommunity||null;let i=String(s);try{const{data:e}=await supabase.from("users_profile").select("nickname").eq("id",s).single();i=(null==e?void 0:e.nickname)||String(s)}catch(e){}const o=s;if(!o)return void staticMethods.error("带看人员选择无效");const a={leadid:r.leadid,scheduletime:t.scheduletime?dayjs(t.scheduletime).toISOString():null,community:n,showingsales:o,viewresult:"待填写",budget:0,moveintime:dayjs().add(1,"month").toISOString(),remark:"",renttime:12},{error:l}=await supabase.from("showings").insert(a).select();if(l)return void staticMethods.error("发放带看单失败: "+l.message);const c=await F({followupstage:"已到店"});c&&c.success?(h(m+1),f("已到店"),staticMethods.success(`带看单已发放，分配给 ${i}`)):staticMethods.error("推进阶段失败: "+((null==c?void 0:c.error)||"未知错误"))}else{const e=t.scheduledcommunity||null;if(!e)return void staticMethods.error("请先选择预约社区");const{data:s,error:n}=await supabase.rpc("assign_showings_user",{p_community:e});if(n||!s)return void staticMethods.error("分配带看人员失败: "+((null==n?void 0:n.message)||"无可用人员"));let i="";if(s){const{data:e}=await supabase.from("users_profile").select("nickname").eq("id",s).single();i=(null==e?void 0:e.nickname)||String(s)}const o={leadid:r.leadid,scheduletime:t.scheduletime?dayjs(t.scheduletime).toISOString():null,community:e,showingsales:s},{error:a}=await supabase.from("showings").insert(o).select();if(a)return void staticMethods.error("发放带看单失败: "+a.message);const l=await F({followupstage:"已到店"});l&&l.success?(h(m+1),f("已到店"),staticMethods.success(`带看单已发放，分配给 ${i}`)):staticMethods.error("推进阶段失败: "+((null==l?void 0:l.error)||"未知错误"))}}catch(e){console.error("❌ [带看分配] 分配过程中发生错误",e),staticMethods.error("分配过程中发生错误: "+(e.message||"未知错误"))}finally{E(!1)}}},loading:v,disabled:v,size:"middle",children:v?"分配中...":"发放带看单"}),"丢单"===x&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{danger:!0,onClick:async()=>{if(r)try{await p.validateFields();const e=await F({followupstage:"丢单"});e&&e.success?(M(),staticMethods.success("已确认丢单")):staticMethods.error("确认丢单失败: "+((null==e?void 0:e.error)||"未知错误"))}catch(e){staticMethods.error("请完整填写所有必填项")}},disabled:n(),size:"middle",children:"确认丢单"}),jsxRuntimeExports.jsx(Button$1,{onClick:async()=>{if(r)try{y(!0);const e={followupstage:"待接收"},{error:t}=await supabase.from("followups").update(e).eq("id",r.id);if(t)throw t;s&&s(r,e),M(),staticMethods.success("已恢复状态")}catch(e){staticMethods.error("恢复状态失败: "+(e.message||"未知错误"))}finally{y(!1)}},disabled:n(),size:"middle",children:"恢复状态"})]}),m<followupStages$1.length-1&&"已到店"!==x&&"丢单"!==x&&jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:g,size:"middle",onClick:async()=>{try{if(!r)return void staticMethods.error("无当前记录，无法保存");if("邀约到店"===x){const e=p.getFieldValue("scheduletime");if(!e)return void staticMethods.error("请先选择预约到店时间");const t={scheduletime:dayjs(e).toISOString(),followupstage:followupStages$1[m+1]},{error:n}=await supabase.from("followups").update(t).eq("id",r.id);if(n)throw console.error("邀约到店阶段推进失败:",n),n;h(m+1),f(followupStages$1[m+1]),s&&s(r,t);setTimeout(()=>{const e={id:r.id,leadid:r.leadid,followupstage:followupStages$1[m+1],phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(t=>{e[t]&&(e[t]=dayjs(e[t]))}),p.setFieldsValue(e)},100);return void staticMethods.success("已推进到已到店阶段")}const t=await p.validateFields(),n=processFormValues$1(t),i=(p.getFieldsValue(),{id:r.id,leadid:r.leadid,followupstage:followupStages$1[m+1],customerprofile:n.customerprofile||r.customerprofile,worklocation:n.worklocation||r.worklocation,userbudget:n.userbudget||r.userbudget,moveintime:n.moveintime||r.moveintime,userrating:n.userrating||r.userrating,majorcategory:n.majorcategory||r.majorcategory,followupresult:n.followupresult||r.followupresult,scheduledcommunity:n.scheduledcommunity||r.scheduledcommunity,scheduletime:n.scheduletime||r.scheduletime});["moveintime","scheduletime"].forEach(e=>{var t;i[e]&&"function"==typeof(null==(t=i[e])?void 0:t.format)&&(i[e]=i[e].format("YYYY-MM-DD HH:mm:ss"))});const o=r.worklocation,a=i.worklocation;a&&a!==o&&console.log("🚀 [FollowupStageDrawer] 工作地点更新，自动触发通勤时间计算:",{recordId:r.id,oldWorklocation:o,newWorklocation:a});let l=0;const c=3;let u=null;const d=validateUpdateObject(i,r.id);if(!d.isValid)throw console.error("❌ [数据验证失败] 更新对象验证失败:",d.errors),new Error(`数据验证失败: ${d.errors.join(", ")}`);for(console.log("🔍 [调试] 数据库更新请求参数:",{table:"followups",id:r.id,updateObj:i,updateObjKeys:Object.keys(i),updateObjValues:Object.values(i).map(e=>"object"==typeof e&&null!==e?"[Object]":e)});l<c;)try{const{error:e,data:t}=await supabase.from("followups").update(i).eq("id",r.id).select();if(e)throw console.error("❌ [数据库错误] 详细错误信息:",{code:e.code,message:e.message,details:e.details,hint:e.hint,requestParams:{table:"followups",id:r.id,updateObj:i}}),e;console.log("✅ [数据库成功] 更新成功:",t),u=null;break}catch(e){if(u=e,l++,console.error(`❌ [数据库重试] 第${l}次尝试失败:`,{error:e,code:e.code,message:e.message,details:e.details,hint:e.hint}),"57014"===e.code&&l<c){console.warn(`⏰ [数据库超时] 第${l}次重试...`),await new Promise(e=>setTimeout(e,1e3*l));continue}throw e}if(u)throw console.error("❌ [最终失败] 下一步保存失败:",u),u;h(m+1),f(followupStages$1[m+1]),s&&s(r,i);setTimeout(()=>{const e={id:r.id,leadid:r.leadid,followupstage:followupStages$1[m+1],phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(t=>{e[t]&&(e[t]=dayjs(e[t]))}),p.setFieldsValue(e)},100);staticMethods.success("已推进到下一阶段")}catch(t){staticMethods.error("推进失败: "+(t.message||"请完整填写所有必填项"))}},children:"下一步"}),m===followupStages$1.length-1&&jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>{staticMethods.success("跟进阶段管理完成"),M()},size:"middle",children:"完成"})]}),children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"24px",height:"100%",flexDirection:"row"},children:[jsxRuntimeExports.jsx("div",{style:{width:"300px",flexShrink:0},children:jsxRuntimeExports.jsxs("div",{style:{background:"#fafafa",padding:"16px",borderRadius:"8px"},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"线索编号："}),(null==r?void 0:r.leadid)?jsxRuntimeExports.jsx(Paragraph$1,{copyable:{text:r.leadid,tooltips:["复制","已复制"],icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,color:"#1677ff",fontWeight:600,display:"inline-block",whiteSpace:"nowrap"},children:r.leadid}):jsxRuntimeExports.jsx("span",{style:{color:"#999"},children:"-"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"手机号："}),(null==r?void 0:r.phone)?jsxRuntimeExports.jsx(Paragraph$1,{copyable:{text:r.phone,tooltips:["复制","已复制"],icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,display:"inline-block",whiteSpace:"nowrap"},children:maskPhone$1(r.phone)}):jsxRuntimeExports.jsx("span",{style:{color:"#999"},children:"-"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"微信号："}),(null==r?void 0:r.wechat)?jsxRuntimeExports.jsx(Paragraph$1,{copyable:{text:r.wechat,tooltips:["复制","已复制"],icon:jsxRuntimeExports.jsx(RefIcon,{style:{color:"#1677ff"}})},style:{margin:0,display:"inline-block",whiteSpace:"nowrap"},children:maskWechat$1(r.wechat)}):jsxRuntimeExports.jsx("span",{style:{color:"#999"},children:"-"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"渠道："}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:(null==r?void 0:r.source)||"-"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"创建时间："}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px"},children:(null==r?void 0:r.created_at)?new Date(r.created_at).toLocaleString("zh-CN"):"-"})]})]})}),jsxRuntimeExports.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",height:"100%"},children:[jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Steps,{current:m,items:followupStages$1.map((e,t)=>({title:e,disabled:0!==t,subTitle:null,description:null})),onChange:e=>{if(0===e&&(h(e),f(followupStages$1[e]),r)){const t=setTimeout(()=>{const t={id:r.id,leadid:r.leadid,followupstage:followupStages$1[e],phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(e=>{t[e]&&(t[e]=dayjs(t[e]))}),p.setFieldsValue(t)},100);return()=>clearTimeout(t)}},style:{marginBottom:"16px",flexShrink:0},"data-current":m,size:"small",direction:"horizontal"})}),jsxRuntimeExports.jsx(Divider$1,{style:{margin:"8px 0",flexShrink:0}})]}),jsxRuntimeExports.jsxs("div",{className:"form-scroll-area",style:{flex:1,minHeight:0,paddingBottom:"12px"},children:["已到店"===x&&jsxRuntimeExports.jsx("div",{style:{marginBottom:"24px"},children:jsxRuntimeExports.jsx(ContractDealsTable,{dealsList:w,dealsLoading:_,onAdd:()=>{const e={id:`new_${Date.now()}`,leadid:(null==r?void 0:r.leadid)||"",contractdate:toBeijingDateStr(dayjs()),community:"",contractnumber:"",roomnumber:"",created_at:toBeijingDateTimeStr(dayjs()),isNew:!0,isEditing:!0};R(t=>[e,...t])},onEdit:async e=>{if(e.isEditing)if(e.isNew){const t={leadid:null==r?void 0:r.leadid,contractdate:e.contractdate||toBeijingDateStr(dayjs()),community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber},{data:s,error:n}=await supabase.from("deals").insert([t]).select().single();if(n)return void staticMethods.error("创建签约记录失败: "+n.message);R(t=>t.map(t=>t.id===e.id?{...s,isEditing:!1}:t)),staticMethods.success("签约记录已保存");const i=await F({followupstage:"赢单"});i&&i.success?(h(m+1),f("赢单"),staticMethods.success("已推进到赢单阶段")):staticMethods.error("推进阶段失败: "+((null==i?void 0:i.error)||"未知错误"))}else{const{error:t}=await supabase.from("deals").update({contractdate:e.contractdate,community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber}).eq("id",e.id);if(t)return void staticMethods.error("更新签约记录失败: "+t.message);R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!1}:t)),staticMethods.success("签约记录已更新")}else R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!0}:t))},onDelete:e=>{e.isNew?R(t=>t.filter(t=>t.id!==e.id)):R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!1}:t))},currentRecord:r,communityEnum:o,setDealsList:R})}),"赢单"===x&&jsxRuntimeExports.jsx("div",{style:{marginBottom:"24px"},children:jsxRuntimeExports.jsx(ContractDealsTable,{dealsList:w,dealsLoading:_,onAdd:()=>{const e={id:`new_${Date.now()}`,leadid:(null==r?void 0:r.leadid)||"",contractdate:toBeijingDateStr(dayjs()),community:"",contractnumber:"",roomnumber:"",created_at:toBeijingDateTimeStr(dayjs()),isNew:!0,isEditing:!0};R(t=>[e,...t])},onEdit:async e=>{if(e.isEditing)if(e.isNew){const t={leadid:null==r?void 0:r.leadid,contractdate:e.contractdate||toBeijingDateStr(dayjs()),community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber},{data:s,error:n}=await supabase.from("deals").insert([t]).select().single();if(n)return void staticMethods.error("创建签约记录失败: "+n.message);R(t=>t.map(t=>t.id===e.id?{...s,isEditing:!1}:t)),staticMethods.success("签约记录已保存"),staticMethods.success("恭喜成交！")}else{const{error:t}=await supabase.from("deals").update({contractdate:e.contractdate,community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber}).eq("id",e.id);if(t)return void staticMethods.error("更新签约记录失败: "+t.message);R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!1}:t)),staticMethods.success("签约记录已更新")}else R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!0}:t))},onDelete:e=>{e.isNew?R(t=>t.filter(t=>t.id!==e.id)):R(t=>t.map(t=>t.id===e.id?{...t,isEditing:!1}:t))},currentRecord:r,communityEnum:o,setDealsList:R})}),jsxRuntimeExports.jsx(FollowupStageForm,{form:p,stage:x,record:r,isFieldDisabled:n,forceUpdate:i,communityEnum:o,followupstageEnum:a,customerprofileEnum:l,userratingEnum:c,majorCategoryOptions:u,metroStationOptions:d,enableManualAssign:j,onAllocationModeChange:e=>{b(e),p.setFieldsValue({assigned_showingsales:void 0})}})]})]})]})})};function useDebouncedCallback(e,t){const r=reactExports.useRef(null),s=reactExports.useRef(e);s.current=e;return reactExports.useCallback((...e)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s.current(...e)},t)},[t])}const useFollowupsData=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState({current:1,pageSize:20,total:0}),[u,d]=reactExports.useState(0),p=reactExports.useRef([]),m=reactExports.useRef({}),h=reactExports.useRef(""),x=reactExports.useRef(1),f=reactExports.useCallback(e=>{try{const t=Object.keys(e).sort().reduce((t,r)=>{const s=e[r];return null!=s&&""!==s&&(Array.isArray(s)?t[r]=s.sort():t[r]=s),t},{});return JSON.stringify(t)}catch(t){return console.error("生成筛选条件哈希值失败:",t),""}},[]);reactExports.useEffect(()=>{y({},1,l.pageSize)},[]);const g=["p_created_at_end","p_created_at_start","p_customerprofile","p_followupresult","p_followupstage","p_interviewsales_user_id","p_leadid","p_leadtype","p_limit","p_majorcategory","p_moveintime_end","p_moveintime_start","p_moveintime_not_null","p_scheduletime_start","p_scheduletime_end","p_scheduletime_not_null","p_offset","p_remark","p_scheduledcommunity","p_showingsales_user","p_source","p_userbudget","p_userbudget_min","p_userbudget_max","p_userrating","p_wechat","p_worklocation","p_phone","p_qq","p_location","p_budget","p_douyinid","p_douyin_accountname","p_staffname","p_redbookid","p_area","p_notelink","p_campaignid","p_campaignname","p_unitid","p_unitname","p_creativedid","p_creativename","p_traffictype","p_interactiontype","p_douyinleadid","p_leadstatus","p_keyword"],y=reactExports.useCallback(async(r={},n=x.current||l.current,o=l.pageSize,u=!1)=>{const d=f(r),y=h.current;if(r&&0!==Object.keys(r).length||(1!==n||u)&&(u||console.warn("⚠️ [useFollowupsData] 检测到空的筛选条件:",{filters:r,append:u,page:n,timestamp:(new Date).toISOString()})),!u||d===y){u?a(!0):i(!0);try{const i={p_limit:o,p_offset:(n-1)*o,...r,p_created_at_end:r.p_created_at_end||null,p_created_at_start:r.p_created_at_start||null,p_customerprofile:r.p_customerprofile||null,p_followupresult:r.p_followupresult||null,p_followupstage:r.p_followupstage||null,p_interviewsales_user_id:r.p_interviewsales_user_id||null,p_leadid:r.p_leadid||null,p_leadtype:r.p_leadtype||null,p_majorcategory:r.p_majorcategory||null,p_moveintime_end:r.p_moveintime_end||null,p_moveintime_start:r.p_moveintime_start||null,p_moveintime_not_null:r.p_moveintime_not_null||null,p_scheduletime_start:r.p_scheduletime_start||null,p_scheduletime_end:r.p_scheduletime_end||null,p_scheduletime_not_null:r.p_scheduletime_not_null||null,p_remark:r.p_remark||null,p_scheduledcommunity:r.p_scheduledcommunity||null,p_showingsales_user:r.p_showingsales_user||null,p_source:r.p_source||null,p_userbudget:r.p_userbudget||null,p_userbudget_min:r.p_userbudget_min||null,p_userbudget_max:r.p_userbudget_max||null,p_userrating:r.p_userrating||null,p_wechat:r.p_wechat||null,p_worklocation:r.p_worklocation||null,p_phone:r.p_phone||null,p_qq:r.p_qq||null,p_location:r.p_location||null,p_budget:r.p_budget||null,p_douyinid:r.p_douyinid||null,p_douyin_accountname:r.p_douyin_accountname||null,p_staffname:r.p_staffname||null,p_redbookid:r.p_redbookid||null,p_area:r.p_area||null,p_notelink:r.p_notelink||null,p_campaignid:r.p_campaignid||null,p_campaignname:r.p_campaignname||null,p_unitid:r.p_unitid||null,p_unitname:r.p_unitname||null,p_creativedid:r.p_creativedid||null,p_creativename:r.p_creativename||null,p_traffictype:r.p_traffictype||null,p_interactiontype:r.p_interactiontype||null,p_douyinleadid:r.p_douyinleadid||null,p_leadstatus:r.p_leadstatus||null,p_keyword:r.p_keyword||null};["p_customerprofile","p_followupresult","p_followupstage","p_interviewsales_user_id","p_leadid","p_leadtype","p_majorcategory","p_scheduledcommunity","p_source","p_userbudget","p_userrating","p_wechat","p_worklocation","p_phone","p_qq","p_location","p_budget","p_douyinid","p_douyin_accountname","p_staffname","p_redbookid","p_area","p_notelink","p_campaignid","p_campaignname","p_unitid","p_unitname","p_creativedid","p_creativename","p_traffictype","p_interactiontype","p_douyinleadid","p_leadstatus"].forEach(e=>{e in i&&(null===i[e]||void 0===i[e]?delete i[e]:Array.isArray(i[e])?Array.isArray(i[e])&&0===i[e].length&&delete i[e]:i[e]=[i[e]])});["p_created_at_start","p_created_at_end","p_moveintime_start","p_moveintime_end","p_scheduletime_start","p_scheduletime_end"].forEach(e=>{if(e in i&&i[e])try{let t,r=i[e];if("string"==typeof r){const s=dayjs(r);if(!s.isValid())return console.warn(`⚠️ [明细查询] 无效的日期格式 ${e}:`,r),void delete i[e];t=s.toDate()}else if(dayjs.isDayjs(r))t=r.toDate();else{const s=dayjs(r);if(!s.isValid())return console.warn(`⚠️ [明细查询] 无法解析的日期值 ${e}:`,r),void delete i[e];t=s.toDate()}i[e]=t}catch(t){console.error(`❌ [明细查询] 日期参数 ${e} 处理失败:`,t),delete i[e]}});const d=Object.fromEntries(Object.entries(i).filter(([e])=>g.includes(e)||"p_groupby_field"===e)),{data:y,error:v}=await supabase.rpc("filter_followups",d);if(v)return console.error("❌ [useFollowupsData] API调用失败:",v),void staticMethods.error("获取跟进记录失败: "+v.message);let E=0;E=y&&y.length>0?void 0!==y[0].total_count&&null!==y[0].total_count?Number(y[0].total_count):y.length:(y&&y.length,0),u&&0===E&&e.length>0&&(console.warn("⚠️ [useFollowupsData] 检测到总数异常变化，保持之前的总数:",{newTotal:E,currentDataLength:e.length,previousTotal:l.total,page:n,filters:r}),E=l.total);const j=(y||[]).filter(e=>!!e&&!!e.id),b=Array.from(new Map(j.map(e=>[e.id,e])).values()),w=b.map(e=>{const t={...e};return 0===t.interviewsales_user_id||null===t.interviewsales_user_id||void 0===t.interviewsales_user_id?t.interviewsales_user_id=null:"string"==typeof t.interviewsales_user_id&&(t.interviewsales_user_id=Number(t.interviewsales_user_id)),0===t.showingsales_user_id||null===t.showingsales_user_id||void 0===t.showingsales_user_id?t.showingsales_user_id=null:"string"==typeof t.showingsales_user_id&&(t.showingsales_user_id=Number(t.showingsales_user_id)),t.created_at&&(t.created_at=dayjs(t.created_at).format("YYYY-MM-DD HH:mm:ss")),t.moveintime&&(t.moveintime=dayjs(t.moveintime).format("YYYY-MM-DD HH:mm:ss")),t.scheduletime&&(t.scheduletime=dayjs(t.scheduletime).format("YYYY-MM-DD HH:mm:ss")),t});if(u){if(0===E&&e.length>0)return console.error("❌ [useFollowupsData] 数据不一致：总数为0但当前有数据，停止追加"),console.error("❌ [useFollowupsData] 数据不一致详情:",{currentDataLength:e.length,newDataLength:w.length,total:E,page:n,filters:m.current}),void a(!1);const r=new Set(p.current.map(e=>e.id)),i=w.filter(e=>!r.has(e.id)),l=[...p.current,...i];l.reduce((e,t)=>{const r=t.followupstage||"未知阶段";return e[r]=(e[r]||0)+1,e},{});t(l),s(l),p.current=l,c(e=>({...e,total:E,current:n,pageSize:o})),x.current=n}else{if(w.length>0){w.reduce((e,t)=>{const r=t.followupstage||"未知阶段";return e[r]=(e[r]||0)+1,e},{}),w.reduce((e,t)=>{const r=t.source||"未知来源";return e[r]=(e[r]||0)+1,e},{})}y&&0===y.length?(t([]),s([]),p.current=[]):(t(w),s(w),p.current=w),c(e=>({...e,total:E,current:n,pageSize:o})),x.current=n}m.current=r,h.current=f(r),x.current=n}catch(v){console.error("fetchFollowups执行失败:",v),staticMethods.error("获取跟进记录失败"),u||(t([]),s([]),p.current=[],c(e=>({...e,total:0,current:n})),x.current=n)}finally{i(!1),a(!1)}}},[]),v=useDebouncedCallback(e=>{s(e),t(e)},100),E=reactExports.useCallback((t,r,s)=>{const n=p.current.length>0?p.current:e,i=n.findIndex(e=>e.id===t);if(-1===i)return;if(n[i][r]===s)return;const o=[...n];o[i]={...o[i],[r]:s},p.current=o,v(o)},[e,v]),j=reactExports.useMemo(()=>{if(0===l.total)return!1;if(e.length>=l.total)return!1;const t=Math.ceil(l.total/l.pageSize);return!(l.current>=t)&&e.length<l.total},[l.total,e.length,l.current,l.pageSize]),b=reactExports.useCallback(async()=>{if(e.length>0&&0===l.total)return console.error("❌ [useFollowupsData] loadMore 数据不一致：有数据但总数为0，停止加载"),void console.error("❌ [useFollowupsData] 数据不一致详情:",{currentDataLength:e.length,total:l.total,currentPage:l.current,pageSize:l.pageSize});if(o||!j)return;const t=l.current+1;if(e.length<l.total){const e=m.current;e&&0!==Object.keys(e).length?await y(e,t,l.pageSize,!0):await y({},t,l.pageSize,!0)}},[o,j,l.current,l.pageSize,l.total,e.length,y]),w=reactExports.useCallback(async e=>{if(e){const n=m.current;h.current;const i=f(e),o=n.p_followupstage,u=e.p_followupstage;JSON.stringify(o),JSON.stringify(u),h.current=i,t([]),s([]),p.current=[],c(e=>({...e,total:0,current:1,pageSize:e.pageSize})),a(!1),x.current=1;try{await y(e,1,l.pageSize)}catch(r){console.error("❌ [useFollowupsData] 新筛选条件下数据获取失败:",r),staticMethods.error("筛选失败，请重试")}}else{const e=m.current;e&&Object.keys(e).length>0?y(e):y({})}},[y,l.pageSize,f]),R=reactExports.useCallback(()=>{c(e=>({...e,current:1})),x.current=1},[]),_=reactExports.useCallback(e=>{console.log("🔄 [useFollowupsData] 同步分页状态:",{old:l,new:e,currentPageRef:x.current}),c(t=>({...t,...e})),void 0!==e.current&&(x.current=e.current)},[l]);return{data:e,localData:r,loading:n,loadingMore:o,pagination:l,forceUpdate:u,hasMore:j,fetchFollowups:y,updateLocalData:E,refreshData:w,loadMore:b,resetPagination:R,setPagination:c,syncPaginationState:_,setData:t,setLocalData:s,setForceUpdate:d}},useFilterManager=()=>{const[e,t]=reactExports.useState({}),[r,s]=reactExports.useState({}),[n,i]=reactExports.useState(""),[o,a]=reactExports.useState(null);reactExports.useEffect(()=>{t({_initialized:!0})},[]);const l=reactExports.useCallback(e=>{const t={},r=["p_leadid","p_leadtype","p_interviewsales_user_id","p_followupstage","p_customerprofile","p_worklocation","p_userrating","p_majorcategory","p_subcategory","p_followupresult","p_scheduledcommunity","p_source","p_wechat","p_phone","p_showingsales_user"];e.p_worklocation&&console.log("🔍 [useFilterManager] 工作地点参数转换前:",{original:e.p_worklocation,type:typeof e.p_worklocation,isArray:Array.isArray(e.p_worklocation)});const s=["p_created_at_start","p_created_at_end","p_moveintime_start","p_moveintime_end","p_scheduletime_start","p_scheduletime_end"];return Object.entries(e).forEach(([e,n])=>{if("_initialized"!==e&&null!=n&&""!==n)if(r.includes(e))if(Array.isArray(n)){if(n.length>0){const r=n.filter(e=>null!=e&&""!==e);r.length>0&&(t[e]=r)}}else t[e]=[n];else if(s.includes(e))n&&(t[e]=n);else if("p_userbudget"===e&&Array.isArray(n)&&2===n.length){const[e,r]=n;null!=e&&""!==e&&(t.p_userbudget_min=Number(e)),null!=r&&""!==r&&(t.p_userbudget_max=Number(r))}else t[e]=n}),t},[]),c=reactExports.useCallback((e,r)=>{t(t=>({...t,[e]:r}))},[]),u=reactExports.useCallback((e,r)=>{t(t=>{const s={...t};return void 0!==r&&Array.isArray(s[e])?(s[e]=s[e].filter(e=>e!==r),0===s[e].length&&delete s[e]):delete s[e],s}),s(t=>{const r={...t};return r[e]=null,r})},[]),d=reactExports.useCallback(e=>{t(t=>{const r={...t};return delete r[e],r}),s(t=>{const r={...t};return r[e]=null,r})},[]),p=reactExports.useCallback(()=>{t({_initialized:!0}),s({}),i(""),a(null)},[]),m=reactExports.useCallback(e=>{s(e);const r=["followupstage","customerprofile","userrating","scheduledcommunity","source","leadtype","remark","worklocation","userbudget","followupresult","majorcategory"],n={};Object.entries(e).forEach(([e,t])=>{if(t&&Array.isArray(t)&&t.length>0){n[`p_${e}`]=t}}),t(e=>{const t={...e};return r.forEach(e=>{delete t[`p_${e}`]}),{...t,...n}})},[]),h=reactExports.useCallback(e=>{i(e),e.trim()?t(t=>({...t,p_keyword:e.trim()})):t(e=>{const t={...e};return delete t.p_keyword,t})},[]),x=reactExports.useCallback(()=>{i(""),t(e=>{const t={...e};return delete t.p_keyword,t})},[]),f=reactExports.useCallback(e=>{t(t=>{const r={...t};return delete r[e],r})},[]),g=reactExports.useCallback(()=>{const e=["p_followupstage","p_customerprofile","p_userrating","p_scheduledcommunity","p_source","p_leadtype","p_remark","p_worklocation","p_userbudget_min","p_userbudget_max","p_followupresult","p_majorcategory","p_created_at_start","p_created_at_end","p_moveintime_start","p_moveintime_end","p_scheduletime_start","p_scheduletime_end"];t(t=>{const r={...t};return e.forEach(e=>{delete r[e]}),r}),s({})},[]),y=reactExports.useCallback(e=>{if(a(e),e){let r,s;switch(e){case"thisWeek":r=dayjs().startOf("week").hour(0).minute(0).second(0).toDate(),s=dayjs().endOf("week").hour(23).minute(59).second(59).toDate();break;case"lastWeek":r=dayjs().subtract(1,"week").startOf("week").hour(0).minute(0).second(0).toDate(),s=dayjs().subtract(1,"week").endOf("week").hour(23).minute(59).second(59).toDate();break;case"thisMonth":r=dayjs().startOf("month").hour(0).minute(0).second(0).toDate(),s=dayjs().endOf("month").hour(23).minute(59).second(59).toDate();break;case"lastMonth":r=dayjs().subtract(1,"month").startOf("month").hour(0).minute(0).second(0).toDate(),s=dayjs().subtract(1,"month").endOf("month").hour(23).minute(59).second(59).toDate();break;default:return}t(e=>({...e,p_created_at_start:r,p_created_at_end:s}))}else t(e=>{const t={...e};return delete t.p_created_at_start,delete t.p_created_at_end,t})},[]),v=reactExports.useMemo(()=>l(e),[e,l]),E=reactExports.useCallback(()=>{const t=l(e);return t.p_worklocation&&console.log("🔍 [useFilterManager] 工作地点参数转换后:",{normalized:t.p_worklocation,type:typeof t.p_worklocation,isArray:Array.isArray(t.p_worklocation),length:Array.isArray(t.p_worklocation)?t.p_worklocation.length:"N/A"}),t},[e,l]);return{filters:e,columnFilters:r,keywordSearch:n,quickDateKey:o,applyFilter:c,removeFilter:u,resetFilter:d,resetAllFilters:p,updateColumnFilters:m,handleKeywordSearch:h,clearKeywordSearch:x,clearFilterType:f,clearTableFilters:g,setQuickDateFilter:y,getCurrentFilters:v,getCurrentFiltersFn:E,setFilters:t,setColumnFilters:s,setKeywordSearch:i}},useGroupManager=()=>{const[e,t]=reactExports.useState("followupstage"),[r,s]=reactExports.useState(""),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(0),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(!0);reactExports.useEffect(()=>{e&&setTimeout(()=>{p(e)},0)},[e]),reactExports.useRef({}),reactExports.useRef(new Set);const p=reactExports.useCallback(async(e,t={})=>{if(e)try{let r={p_groupby_field:e};if(t&&Object.keys(t).length>0){["p_leadid","p_leadtype","p_interviewsales_user_id","p_followupstage","p_customerprofile","p_worklocation","p_userbudget","p_userrating","p_majorcategory","p_subcategory","p_followupresult","p_scheduletime_start","p_scheduletime_end","p_scheduledcommunity","p_wechat","p_worklocation","p_phone","p_remark","p_subcategory","p_showingsales_user"].forEach(e=>{if(e in t){const s=t[e];if(null==s)r[e]=[null];else if(Array.isArray(s))if(Array.isArray(s)&&0===s.length)delete r[e];else if("p_followupstage"===e||"p_customerprofile"===e||"p_userrating"===e||"p_scheduledcommunity"===e||"p_source"===e){const t=s.filter(e=>null!=e&&""!==e);t.length>0?r[e]=t:delete r[e]}else r[e]=s;else r[e]=[s]}});["p_subcategory","p_scheduletime_start","p_scheduletime_end","p_showingsales_user"].forEach(e=>{if(e in r){const t=r[e];null==t?r[e]=[null]:Array.isArray(t)?Array.isArray(t)&&0===t.length&&delete r[e]:r[e]=[t]}});["p_created_at_start","p_created_at_end","p_moveintime_start","p_moveintime_end"].forEach(e=>{if(e in t&&t[e])try{let s,n=t[e];if("string"==typeof n){const t=dayjs(n);if(!t.isValid())return void delete r[e];s=t.toISOString()}else if(dayjs.isDayjs(n))s=n.toISOString();else if(n instanceof Date)s=n.toISOString();else{const t=dayjs(n);if(!t.isValid())return void delete r[e];s=t.toISOString()}r[e]=s}catch(s){console.warn(`[useGroupManager] 日期参数处理失败 ${e}:`,s),delete r[e]}})}const s={},n=["p_groupby_field"],o=Object.keys(r).sort();n.forEach(e=>{e in r&&(s[e]=r[e])}),o.forEach(e=>{n.includes(e)||(s[e]=r[e])});const l={p_groupby_field:e,p_leadid:t.p_leadid||null,p_leadtype:t.p_leadtype||null,p_interviewsales_user_id:t.p_interviewsales_user_id||null,p_followupstage:t.p_followupstage||null,p_customerprofile:t.p_customerprofile||null,p_worklocation:t.p_worklocation||null,p_userbudget:t.p_userbudget||null,p_moveintime_start:t.p_moveintime_start||null,p_moveintime_end:t.p_moveintime_end||null,p_userrating:t.p_userrating||null,p_majorcategory:t.p_majorcategory||null,p_subcategory:t.p_subcategory||null,p_followupresult:t.p_followupresult||null,p_scheduletime_start:t.p_scheduletime_start||null,p_scheduletime_end:t.p_scheduletime_end||null,p_scheduledcommunity:t.p_scheduledcommunity||null,p_keyword:t.p_keyword||null,p_wechat:t.p_wechat||null,p_phone:t.p_phone||null,p_source:t.p_source||null,p_created_at_start:t.p_created_at_start||null,p_created_at_end:t.p_created_at_end||null,p_remark:t.p_remark||null,p_showingsales_user:t.p_showingsales_user||null},c=await supabase.rpc("group_count_filter_followups",l),{data:u,error:d}=c;if(d)return console.error("❌ [useGroupManager] RPC函数调用失败:",d),i([]),void a(0);const p=m(u||[]);i(p);const h=p.reduce((e,t)=>e+t.count,0);a(h)}catch(r){console.error("❌ [useGroupManager] 异常:",r),i([]),a(0)}},[supabase]);reactExports.useCallback(async(e,t)=>{try{let r=supabase.from("followups").select("id, "+e+", created_at, leadtype, followupstage, customerprofile, worklocation, userbudget, userrating, majorcategory, followupresult, scheduledcommunity");t.p_created_at_start&&(r=r.gte("created_at",t.p_created_at_start)),t.p_created_at_end&&(r=r.lte("created_at",t.p_created_at_end)),t.p_leadtype&&t.p_leadtype.length>0&&(r=r.in("leadtype",t.p_leadtype)),t.p_followupstage&&t.p_followupstage.length>0&&(r=r.in("followupstage",t.p_followupstage)),t.p_customerprofile&&t.p_customerprofile.length>0&&(r=r.in("customerprofile",t.p_customerprofile)),t.p_worklocation&&t.p_worklocation.length>0&&(r=r.in("worklocation",t.p_worklocation)),void 0!==t.p_userbudget_min&&null!==t.p_userbudget_min&&(r=r.gte("userbudget",t.p_userbudget_min)),void 0!==t.p_userbudget_max&&null!==t.p_userbudget_max&&(r=r.lte("userbudget",t.p_userbudget_max)),t.p_userrating&&t.p_userrating.length>0&&(r=r.in("userrating",t.p_userrating)),t.p_majorcategory&&t.p_majorcategory.length>0&&(r=r.in("majorcategory",t.p_majorcategory)),t.p_followupresult&&t.p_followupresult.length>0&&(r=r.in("followupresult",t.p_followupresult)),t.p_scheduledcommunity&&t.p_scheduledcommunity.length>0&&(r=r.in("scheduledcommunity",t.p_scheduledcommunity)),t.p_keyword&&(r=r.ilike("leadid",`%${t.p_keyword}%`));const{data:s,error:n}=await r;if(n)return console.error("❌ [useGroupManager] 降级查询失败:",n),null;const i={};return null==s||s.forEach(t=>{const r=t[e]||"未分组";i[r]=(i[r]||0)+1}),Object.entries(i).map(([e,t])=>({group_id:e,group_value:e,count:t}))}catch(r){return console.error("❌ [useGroupManager] 降级查询异常:",r),null}},[supabase]);const m=reactExports.useCallback(e=>e&&Array.isArray(e)?e.map((e,t)=>{let r=e.group_id,s=e.group_id,n=e.group_value;return null==r||"null"===r||""===r?(r=`null_${t}`,s="null",n="未分配"):(r=String(r),s=String(e.group_id),n=e.group_value||String(e.group_id)),{key:r,groupValue:s,groupText:n,count:Number(e.count)||0}}):[],[]),h=reactExports.useCallback(t=>{if(!e)return;const n="p_"+e;let i={};const o=null==t||"null"===String(t).toLowerCase()||""===String(t)||"number"==typeof t&&(isNaN(t)||0===t)||"scheduledcommunity"===e&&"未分组"===String(t);if(r===String(t))return s(""),{shouldResetPagination:!0,newFilters:{}};if("created_at"===e){const e=String(t);if(o)i={p_created_at_start:null,p_created_at_end:null},s("null");else{i={p_created_at_start:dayjs(e).startOf("day").toDate(),p_created_at_end:dayjs(e).endOf("day").toDate()},s(e)}}else if(o)i={[n]:[null]},s("null");else{if("interviewsales_user_id"===e||"showingsales_user_id"===e){const e=Number(t);i={[n]:[isNaN(e)?null:e]}}else i={[n]:[String(t)]};s(String(t))}return{shouldResetPagination:!0,newFilters:i}},[e,r]),x=reactExports.useCallback(e=>{t(e),d(!0),p(e)},[p]),f=reactExports.useCallback(()=>{i([]),a(0),s("")},[]),g=reactExports.useCallback(t=>{const r="p_"+e;if(t[r]&&Array.isArray(t[r])&&t[r][0]){const e=t[r][0];s(null===e||"null"===e?"null":String(e))}else if("created_at"===e&&(t.p_created_at_start||t.p_created_at_end)){const e=t.p_created_at_start;if(e){const t=dayjs(e).format("YYYY-MM-DD");s(t)}else s("")}else s("")},[e]);return{groupField:e,selectedGroup:r,groupData:n,groupTotal:o,groupLoading:l,groupPanelOpen:u,groupFieldOptions:[{value:"followupstage",label:"跟进阶段"},{value:"scheduledcommunity",label:"预约社区"},{value:"source",label:"线索来源"},{value:"created_at",label:"创建日期"}],fetchGroupData:p,handleGroupClick:h,setGroupFieldWithData:x,syncSelectedGroup:g,clearGroupData:f,setGroupField:t,setSelectedGroup:s,setGroupData:i,setGroupTotal:a,setGroupPanelOpen:d}},useEnumData=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState([]),[l,c]=reactExports.useState([]),[u,d]=reactExports.useState([]),[p,m]=reactExports.useState([]),[h,x]=reactExports.useState([]),[f,g]=reactExports.useState([]),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState([]),[b]=reactExports.useState([{label:"跟进阶段",value:"followupstage"},{label:"约访管家",value:"interviewsales_user_id"},{label:"创建日期",value:"created_at"},{label:"社区",value:"scheduledcommunity"},{label:"渠道",value:"source"}]),[w,R]=reactExports.useState([]),[_,S]=reactExports.useState([]),C=reactExports.useCallback(async()=>{try{const{data:e,error:t}=await supabase.from("Selection").select("selection").eq("id",1).single();if(!t&&e&&e.selection)R(e.selection);else{console.warn("⚠️ [警告] 加载主分类选项失败，使用默认选项");R([{value:"跟进结果",label:"跟进结果",children:[{value:"有意向",label:"有意向"},{value:"需考虑",label:"需考虑"},{value:"暂无意向",label:"暂无意向"}]},{value:"成交状态",label:"成交状态",children:[{value:"已成交",label:"已成交"},{value:"已流失",label:"已流失"}]}])}}catch(e){console.error("❌ [错误] 加载主分类选项失败:",e);R([{value:"跟进结果",label:"跟进结果",children:[{value:"有意向",label:"有意向"},{value:"需考虑",label:"需考虑"},{value:"暂无意向",label:"暂无意向"}]},{value:"成交状态",label:"成交状态",children:[{value:"已成交",label:"已成交"},{value:"已流失",label:"已流失"}]}])}},[]),k=reactExports.useCallback(async()=>{try{const e=await fetchMetroStations(),t=e.reduce((e,t)=>{const r=t.line||"其他";return e[r]||(e[r]=[]),e[r].push(t),e},{}),r=Object.entries(t).sort(([e],[t])=>{const r=e=>{const t=e.match(/^(\d+)号线$/);return t?parseInt(t[1]):999999};return r(e)-r(t)}).map(([e,t])=>({value:String(e),label:String(e),children:t.map(e=>({value:String(e.name),label:String(e.name)}))}));S(r);const s=e.map(e=>({value:e.name,label:e.name}));x(s)}catch(e){console.error("❌ [错误] 加载地铁站数据失败:",e),S([]),x([])}},[]),$=reactExports.useCallback(async(e,t)=>{const r=`enum_${e}`,s=localStorage.getItem(`${r}_timestamp`);if(s&&Date.now()-parseInt(s)<9e5){const e=localStorage.getItem(r);if(e)try{return void t(JSON.parse(e))}catch(n){localStorage.removeItem(r),localStorage.removeItem(`${r}_timestamp`)}}try{const s=(await fetchEnumValues(e)).map(e=>({value:e,label:e}));t(s);try{localStorage.setItem(r,JSON.stringify(s)),localStorage.setItem(`${r}_timestamp`,Date.now().toString())}catch(i){console.warn(`⚠️ [缓存] 无法保存${e}枚举到localStorage:`,i)}}catch(o){console.error(`❌ [错误] 加载${e}枚举失败:`,o);const s=localStorage.getItem(r);if(s)try{t(JSON.parse(s))}catch(a){console.error("❌ [回退] 使用过期缓存也失败:",a)}}},[]),T=reactExports.useCallback(async()=>{try{const[t,r,s,n]=await Promise.allSettled([supabase.rpc("get_filter_options",{p_field_name:"followupresult",p_filters:{}}).then(({data:e,error:t})=>{if(t)throw t;return e||[]}),supabase.rpc("get_filter_options",{p_field_name:"majorcategory",p_filters:{}}).then(({data:e,error:t})=>{if(t)throw t;return e||[]}),supabase.rpc("get_filter_options",{p_field_name:"leadtype",p_filters:{}}).then(({data:e,error:t})=>{if(t)throw t;return e||[]}),supabase.from("leads").select("remark").not("remark","is",null).neq("remark","").limit(100).then(({data:e,error:t})=>{if(t)throw t;return[...new Set(null==e?void 0:e.map(e=>e.remark).filter(e=>e&&""!==e.trim()))].slice(0,50).map(e=>({value:e,label:e}))}),supabase.rpc("get_filter_options",{p_field_name:"userbudget",p_filters:{}}).then(({data:e,error:t})=>{if(t)throw t;return e||[]})]);if("fulfilled"===t.status){const e=t.value;if(Array.isArray(e)&&e.length>0){const t=e.map(e=>({value:e.value||e.text||e,label:e.label||e.text||e.value||e}));g(t)}else g([])}else g([]);if("fulfilled"===r.status){const e=r.value;if(Array.isArray(e)&&e.length>0){const t=e.map(e=>({value:e.value||e.text||e,label:e.label||e.text||e.value||e}));v(t)}else v([])}else v([]);if("fulfilled"===s.status){const e=s.value;if(Array.isArray(e)&&e.length>0){const t=e.map(e=>({value:e.value||e.text||e,label:e.label||e.text||e.value||e}));d(t)}else d([])}else d([]);if("fulfilled"===n.status){const e=n.value;if(Array.isArray(e)&&e.length>0){const t=e.map(e=>({value:e.value||e.text||e,label:e.label||e.text||e.value||e}));m(t)}else m([])}else m([]);e.length>0&&j(e)}catch(t){g([]),v([]),d([]),m([])}},[]),I=reactExports.useCallback(async()=>{Promise.allSettled([$("community",t),$("followupstage",s),$("customerprofile",i),$("source",a),$("userrating",c),k(),C()]).then(()=>{})},[$,k,C]);reactExports.useEffect(()=>{I()},[I]),reactExports.useEffect(()=>{e.length>0&&r.length>0&&n.length>0&&o.length>0&&l.length>0&&_.length>0&&T()},[e,r,n,o,l,_,T]);const P=reactExports.useCallback(async e=>{const r={community:t,followupstage:s,customerprofile:i,source:a,userrating:c}[e];if(r){const t=`enum_${e}`;localStorage.removeItem(t),localStorage.removeItem(`${t}_timestamp`),await $(e,r)}},[$]),A=reactExports.useCallback(async()=>{await I()},[I]),F=reactExports.useCallback(t=>({community:e,followupstage:r,customerprofile:n,source:o,userrating:l}[t]||[]),[e,r,n,o,l]),M=reactExports.useCallback((e,t)=>{const r=F(e).find(e=>e.value===t);return(null==r?void 0:r.label)||t},[F]),D=reactExports.useCallback(e=>F(e).length>0,[F]),O=reactExports.useCallback(()=>({community:D("community"),followupstage:D("followupstage"),customerprofile:D("customerprofile"),source:D("source"),userrating:D("userrating"),metrostations:_.length>0}),[D,_]),N=reactExports.useCallback((e,t)=>{for(const r of e)if(r.children){const e=r.children.find(e=>e.value===t);if(e)return[r.value,e.value]}return[]},[]);return{communityEnum:e,followupstageEnum:r,customerprofileEnum:n,sourceEnum:o,userratingEnum:l,groupFieldOptions:b,majorCategoryOptions:w,metroStationOptions:_,leadtypeFilters:u,remarkFilters:p,worklocationFilters:h,followupresultFilters:f,majorcategoryFilters:y,scheduledcommunityFilters:E,loadEnumWithCache:$,loadMetroStationOptions:k,loadMajorCategoryOptions:C,refreshEnum:P,refreshAllEnums:A,getEnumOptions:F,getEnumLabel:M,isEnumLoaded:D,getEnumsLoadingStatus:O,findCascaderPath:N,setCommunityEnum:t,setFollowupstageEnum:s,setCustomerprofileEnum:i,setSourceEnum:a,setUserratingEnum:c,setLeadtypeFilters:d,setRemarkFilters:m,setWorklocationFilters:x,setFollowupresultFilters:g,setMajorcategoryFilters:v,setScheduledcommunityFilters:j,setMetroStationOptions:S}};class FrequencyController{constructor(e){__publicField(this,"userId"),__publicField(this,"cache",new Map),__publicField(this,"pendingChecks",new Set),this.userId=e}getUserId(){return this.userId}async checkFrequency(){if(!this.userId||this.userId<=0)return{allowed:!0};const e="frequency_check",t=Date.now(),r=this.cache.get(e);if(r&&t-r.timestamp<1e4)return r.result;if(this.pendingChecks.has(e)){let r=0;for(;this.pendingChecks.has(e)&&r<3e3;)await new Promise(e=>setTimeout(e,100)),r+=100;const s=this.cache.get(e);if(s&&t-s.timestamp<1e4)return s.result}this.pendingChecks.add(e);try{const{data:r,error:s}=await supabase.rpc("check_operation_frequency",{p_user_id:this.userId,p_operation_type:"update"});if(s){console.error("[FREQ] RPC 调用失败:",s);const r={allowed:!0};return this.cache.set(e,{result:r,timestamp:t}),r}const n={allowed:r.allowed,message:r.message,cooldown_until:r.cooldown_until};return this.cache.set(e,{result:n,timestamp:t}),n}catch(s){console.error("[FREQ] 异常捕获:",s);const r={allowed:!0};return this.cache.set(e,{result:r,timestamp:t}),r}finally{this.pendingChecks.delete(e)}}async recordOperation(e,t,r){if(!this.userId||this.userId<=0)return;const s=`${e}_${t}_${r}`,n=Date.now(),i=this.cache.get(s);if(!(i&&n-i.timestamp<5e3))try{const{error:i}=await supabase.rpc("record_operation",{p_user_id:this.userId,p_operation_type:"update",p_record_id:e,p_old_value:t,p_new_value:r});i?console.error("[FREQ] recordOperation: RPC 调用失败，error:",i):this.cache.set(s,{result:{success:!0},timestamp:n})}catch(o){console.error("[FREQ] recordOperation: 异常捕获:",o)}}clearExpiredCache(){const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>6e4&&this.cache.delete(t)}}const useFrequencyControl=()=>{const{user:e,profile:t}=useUser(),[r,s]=reactExports.useState(null),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(null),p=reactExports.useRef(null);reactExports.useEffect(()=>{!async function(){if(e&&t){const e=new FrequencyController(Number(t.id));s(e),i(!0)}else i(!0)}()},[e,t]),reactExports.useEffect(()=>{r&&n?(async()=>{const e=await r.checkFrequency();if(c(!0),e.allowed)a(!1);else{let t="",r="",s=Date.now(),n=0;e.cooldown_until?(t=toBeijingTimeStr(e.cooldown_until),r=`请按实际情况填写用户真实信息，勿敷衍了事，避免被系统暂时锁定。请在 ${t} 后重试。`,s=new Date(e.cooldown_until).getTime(),n=Math.ceil((s-Date.now())/1e3)):r=e.message||"操作过于频繁，请稍后再试",d({until:s,secondsLeft:n,message:r}),a(!0),p.current&&clearInterval(p.current),p.current=setInterval(()=>{d(e=>{if(!e)return null;const t=Math.ceil((e.until-Date.now())/1e3);return t<1?(clearInterval(p.current),a(!1),null):{...e,secondsLeft:t}})},1e3)}})():n&&!r&&c(!0)},[r,n]);const m=reactExports.useCallback(async()=>{if(!r||!n)return{allowed:!0,message:"频率控制器未初始化"};if(u||o)return{allowed:!1,message:"操作过于频繁，请稍后再试"};try{const e=await r.checkFrequency();if(!e.allowed){let t="",r="",s=Date.now(),n=0;e.cooldown_until?(t=toBeijingTimeStr(e.cooldown_until),r=`请按实际情况填写用户真实信息，勿敷衍了事，避免被系统暂时锁定。请在 ${t} 后重试。`,s=new Date(e.cooldown_until).getTime(),n=Math.ceil((s-Date.now())/1e3)):r=e.message||"操作过于频繁，请稍后再试",d({until:s,secondsLeft:n,message:r}),a(!0),p.current&&clearInterval(p.current),p.current=setInterval(()=>{d(e=>{if(!e)return null;const t=Math.ceil((e.until-Date.now())/1e3);return t<1?(clearInterval(p.current),a(!1),null):{...e,secondsLeft:t}})},1e3),staticMethods.error(r)}return e}catch(e){return console.error("频率检查失败:",e),{allowed:!1,message:"频率检查失败，请稍后重试"}}},[r,n,u,o]),h=reactExports.useCallback(()=>!(!u&&!o)||(!l||!(!r&&n)&&!n),[u,o,l,r,n]);reactExports.useEffect(()=>()=>{p.current&&clearInterval(p.current)},[]);const x=reactExports.useCallback(()=>{p.current&&clearInterval(p.current),d(null),a(!1)},[]);return{isFrequencyLimited:o,hasCheckedFrequency:l,cooldown:u,frequencyController:r,frequencyControllerReady:n,checkFrequency:m,isFieldDisabled:h,clearCooldown:x,setFrequencyController:s,setFrequencyControllerReady:i}},useAutoSave=(e={})=>{const{maxRetries:t=3,retryDelay:r=1e3}=e,[s,n]=reactExports.useState(!1),[i,o]=reactExports.useState({totalUpdates:0,successfulUpdates:0,failedUpdates:0,skippedUpdates:0}),a=reactExports.useCallback(async(e,t,r,s)=>{if((s??"")===(r??""))return o(e=>({...e,skippedUpdates:e.skippedUpdates+1})),{success:!0,skipped:!0};n(!0);try{const{error:s}=await supabase.from("followups").update({[t]:r}).eq("id",e);return s?(console.error("Supabase 更新失败:",s),o(e=>({...e,failedUpdates:e.failedUpdates+1})),{success:!1,error:s.message}):(o(e=>({...e,totalUpdates:e.totalUpdates+1,successfulUpdates:e.successfulUpdates+1})),{success:!0})}catch(i){return console.error("保存过程中发生异常:",i),o(e=>({...e,failedUpdates:e.failedUpdates+1})),{success:!1,error:i.message}}finally{n(!1)}},[]),l=reactExports.useCallback(async(e,s,n,i,o=0)=>{const c=await a(e,s,n,i);return!c.success&&o<t?(await new Promise(e=>setTimeout(e,r)),l(e,s,n,i,o+1)):c},[a,t,r]),c=reactExports.useCallback(()=>{o({totalUpdates:0,successfulUpdates:0,failedUpdates:0,skippedUpdates:0})},[]);return{isSaving:s,stats:i,saveField:a,saveFieldWithRetry:l,resetStats:c}},useOptimizedLocalData=(e,t={})=>{const{enableOptimisticUpdates:r=!0}=t,s=Array.isArray(e)?e:[],[n,i]=reactExports.useState(s),o=reactExports.useRef(s),[a,l]=reactExports.useState({totalUpdates:0,optimisticUpdates:0}),c=reactExports.useCallback((e,t,s)=>{if(!r)return;const n=o.current,a=n.findIndex(t=>t.id===e);if(-1===a)return;const c=n[a];if(c[t]===s)return;const u=[...n];u[a]={...c,[t]:s},o.current=u,i(u),l(e=>({...e,totalUpdates:e.totalUpdates+1,optimisticUpdates:e.optimisticUpdates+1}))},[r]),u=reactExports.useCallback((e,t,s)=>{if(!r)return;const n=o.current,a=n.findIndex(t=>t.id===e);if(-1===a)return;const c=n[a];if(c[t]===s)return;const u=[...n];u[a]={...c,[t]:s},o.current=u,i(u),l(e=>({...e,totalUpdates:e.totalUpdates+1}))},[r]),d=reactExports.useCallback((e,t)=>{if(!r)return;const s=o.current,n=s.findIndex(t=>t.id===e);if(-1===n)return;const a=s[n],c={...a,...t};if(!Object.keys(t).some(e=>a[e]!==t[e]))return;const u=[...s];u[n]=c,o.current=u,i(u),l(e=>({...e,totalUpdates:e.totalUpdates+1,optimisticUpdates:e.optimisticUpdates+1}))},[r]),p=reactExports.useCallback(e=>{const t=Array.isArray(e)?e:[];o.current=t,i(t)},[]),m=reactExports.useCallback(()=>o.current,[]),h=reactExports.useCallback(e=>{o.current=e,i(e),l({totalUpdates:0,optimisticUpdates:0})},[]),x=reactExports.useCallback(()=>{},[]);return reactExports.useMemo(()=>{const t=Array.isArray(e)?e:[];t.length>0?p(t):p([])},[e,p]),{data:n,updateField:c,rollbackField:u,updateMultipleFields:d,syncExternalData:p,getCurrentData:m,resetData:h,cleanup:x,stats:a}};class BaseDataService{constructor(e){__publicField(this,"tableName"),this.tableName=e}async query(e,t,r,s,n){try{let i=supabase.from(this.tableName).select(e||"*");t&&Object.entries(t).forEach(([e,t])=>{null!=t&&(i=Array.isArray(t)?i.in(e,t):i.eq(e,t))}),r&&(i=i.order(r.column,{ascending:r.ascending??!0})),s&&(i=i.limit(s),n&&(i=i.range(n,n+s-1)));const{data:o,error:a}=await i;return{data:o,error:a}}catch(i){return console.error("[BaseDataService] 查询失败:",i),{data:null,error:i}}}async getById(e,t){try{const{data:r,error:s}=await supabase.from(this.tableName).select(t||"*").eq("id",e).single();return{data:r,error:s}}catch(r){return console.error("[BaseDataService] 根据ID查询失败:",r),{data:null,error:r}}}async create(e){try{const{data:t,error:r}=await supabase.from(this.tableName).insert(e).select().single();return{data:t,error:r}}catch(t){return console.error("[BaseDataService] 创建失败:",t),{data:null,error:t}}}async update(e,t){try{const{data:r,error:s}=await supabase.from(this.tableName).update(t).eq("id",e).select().single();return{data:r,error:s}}catch(r){return console.error("[BaseDataService] 更新失败:",r),{data:null,error:r}}}async delete(e){try{const{error:t}=await supabase.from(this.tableName).delete().eq("id",e);return{success:!t,error:t}}catch(t){return console.error("[BaseDataService] 删除失败:",t),{success:!1,error:t}}}async batchUpdate(e){try{return{results:await Promise.all(e.map(async({id:e,data:t})=>{const r=await this.update(e,t);return{success:!r.error,error:r.error}}))}}catch(t){return console.error("[BaseDataService] 批量更新失败:",t),{results:e.map(()=>({success:!1,error:t}))}}}async count(e){try{let t=supabase.from(this.tableName).select("*",{count:"exact",head:!0});e&&Object.entries(e).forEach(([e,r])=>{null!=r&&(t=Array.isArray(r)?t.in(e,r):t.eq(e,r))});const{count:r,error:s}=await t;return{count:r,error:s}}catch(t){return console.error("[BaseDataService] 统计失败:",t),{count:null,error:t}}}}class FollowupService extends BaseDataService{constructor(){super("followups")}async getFollowupsList(e){const{page:t,pageSize:r,filters:s={},keyword:n,groupField:i,selectedGroup:o}=e,a=(t-1)*r;try{let e=supabase.from(this.tableName).select("*");n&&(e=e.or(`leadid.ilike.%${n}%,phone.ilike.%${n}%,wechat.ilike.%${n}%`)),i&&void 0!==o&&(e="null"===o||""===o?e.is(i,null):e.eq(i,o)),Object.entries(s).forEach(([t,r])=>{if(null!=r&&""!==r)if(Array.isArray(r))e=e.in(t,r);else if(t.includes("_start")){const s=t.replace("_start","");e=e.gte(s,r)}else if(t.includes("_end")){const s=t.replace("_end","");e=e.lte(s,r)}else e=e.eq(t,r)});const{count:t}=await supabase.from("followups").select("*",{count:"exact",head:!0}),{data:l,error:c}=await e.order("created_at",{ascending:!1}).range(a,a+r-1);return{data:l,total:t||0,error:c}}catch(l){return console.error("[FollowupService] 获取跟进记录列表失败:",l),{data:[],total:0,error:l}}}async getGroupCount(e,t){try{let r=supabase.from(this.tableName).select(`${e}, count`,{count:"exact"});t&&Object.entries(t).forEach(([e,t])=>{if(null!=t&&""!==t)if(Array.isArray(t))r=r.in(e,t);else if(e.includes("_start")){const s=e.replace("_start","");r=r.gte(s,t)}else if(e.includes("_end")){const s=e.replace("_end","");r=r.lte(s,t)}else r=r.eq(e,t)});const{data:s,error:n}=await supabase.from("followups").select(e);if(n)throw n;const i={};null==s||s.forEach(t=>{const r=t[e]||null;i[r]=(i[r]||0)+1});const o=Object.entries(i).map(([t,r])=>({key:"null"===t?null:t,count:r,groupText:this.getGroupDisplayText(e,"null"===t?null:t)}));return o.find(e=>null===e.key)||o.push({key:null,count:0,groupText:"未分组"}),{data:o,error:null}}catch(r){return console.error("[FollowupService] 获取分组统计失败:",r),{data:[],error:r}}}getGroupDisplayText(e,t){if(null==t||""===t)return"未分配";switch(e){case"interviewsales_user_id":case"showingsales_user_id":return"用户ID";case"created_at":return"创建日期";default:return String(t)}}async updateFollowupStage(e,t,r){try{const s={followupstage:t};r&&Object.assign(s,r);const{data:n,error:i}=await this.update(e,s);return{data:n,error:i}}catch(s){return console.error("[FollowupService] 更新跟进阶段失败:",s),{data:null,error:s}}}async batchUpdateFollowups(e){try{const t=await Promise.all(e.map(async({id:e,updates:t})=>await this.update(e,t))),r=t.filter(e=>!e.error).length,s=t.filter(e=>e.error).map(e=>e.error);return{successCount:r,totalCount:e.length,errors:s,success:r===e.length}}catch(t){return console.error("[FollowupService] 批量更新失败:",t),{successCount:0,totalCount:e.length,errors:[t],success:!1}}}async getFollowupStats(e){try{const{count:t}=await this.count(e),{data:r}=await supabase.from(this.tableName).select("followupstage"),s=new Date;s.setHours(0,0,0,0);const{count:n}=await supabase.from(this.tableName).select("*",{count:"exact",head:!0}).gte("created_at",s.toISOString());return{total:t||0,todayCount:n||0,stageStats:r||[],error:null}}catch(t){return console.error("[FollowupService] 获取统计信息失败:",t),{total:0,todayCount:0,stageStats:[],error:t}}}}class ContractDealsService extends BaseDataService{constructor(){super("contract_deals")}async getContractDeals(e){try{const{data:t,error:r}=await this.query("*",{leadid:e});return{data:t,error:r}}catch(t){return console.error("[ContractDealsService] 获取签约记录失败:",t),{data:[],error:t}}}async createContractDeal(e){try{const{data:t,error:r}=await this.create(e);return{data:t,error:r}}catch(t){return console.error("[ContractDealsService] 创建签约记录失败:",t),{data:null,error:t}}}async updateContractDeal(e,t){try{const{data:r,error:s}=await this.update(e,t);return{data:r,error:s}}catch(r){return console.error("[ContractDealsService] 更新签约记录失败:",r),{data:null,error:r}}}async deleteContractDeal(e){try{const{success:t,error:r}=await this.delete(e);return{success:t,error:r}}catch(t){return console.error("[ContractDealsService] 删除签约记录失败:",t),{success:!1,error:t}}}async batchUpdateContractDeals(e){try{const t=await Promise.all(e.map(async({id:e,updates:t})=>await this.update(e,t))),r=t.filter(e=>!e.error).length,s=t.filter(e=>e.error).map(e=>e.error);return{successCount:r,totalCount:e.length,errors:s,success:r===e.length}}catch(t){return console.error("[ContractDealsService] 批量更新失败:",t),{successCount:0,totalCount:e.length,errors:[t],success:!1}}}async getContractStats(e){try{const t=e?{leadid:e}:{},{count:r}=await this.count(t),{data:s}=await this.query("community, count",t),n=new Date;n.setHours(0,0,0,0);const{count:i}=await this.count({...t,created_at:n.toISOString()});return{total:r||0,todayCount:i||0,communityStats:s||[],error:null}}catch(t){return console.error("[ContractDealsService] 获取统计信息失败:",t),{total:0,todayCount:0,communityStats:[],error:t}}}}class EnumDataService{constructor(){__publicField(this,"cache",new Map),__publicField(this,"CACHE_DURATION",3e5)}async getEnumValues(e,t,r){const s=`${e}_${t}_${r}`,n=Date.now(),i=this.cache.get(s);if(i&&n-i.timestamp<this.CACHE_DURATION)return{data:i.data,error:null};try{const{data:i,error:o}=await supabase.from(e).select(`${t}, ${r}`).order(r);if(o)throw o;const a=(null==i?void 0:i.map(e=>({value:e[t],label:e[r]})))||[];return this.cache.set(s,{data:a,timestamp:n}),{data:a,error:null}}catch(o){return console.error(`[EnumDataService] 获取枚举值失败: ${e}`,o),{data:[],error:o}}}async getCommunityEnum(){return this.getEnumValues("communities","code","name")}async getFollowupStageEnum(){return this.getEnumValues("followup_stages","code","name")}async getCustomerProfileEnum(){return this.getEnumValues("customer_profiles","code","name")}async getSourceEnum(){return this.getEnumValues("sources","code","name")}async getUserRatingEnum(){return this.getEnumValues("user_ratings","code","name")}async getMajorCategoryEnum(){return this.getEnumValues("major_categories","code","name")}async getMetroStations(){const e="metro_stations",t=Date.now(),r=this.cache.get(e);if(r&&t-r.timestamp<this.CACHE_DURATION)return{data:r.data,error:null};try{const{data:r,error:s}=await supabase.rpc("get_metrostations");if(s)throw s;return this.cache.set(e,{data:r,timestamp:t}),{data:r,error:null}}catch(s){return console.error("[EnumDataService] 获取地铁站失败:",s),{data:[],error:s}}}refreshEnumCache(e,t,r){const s=`${e}_${t}_${r}`;this.cache.delete(s)}refreshAllCache(){this.cache.clear()}getCacheStatus(){const e=Date.now(),t={};for(const[r,s]of this.cache.entries()){const n=e-s.timestamp;t[r]={valid:n<this.CACHE_DURATION,age:Math.floor(n/1e3)}}return t}}class FrequencyControlService{constructor(e){__publicField(this,"userId"),__publicField(this,"cache",new Map),__publicField(this,"pendingChecks",new Set),this.userId=e}async checkFrequency(e="update"){if(!this.userId||this.userId<=0)return{allowed:!0};const t=`frequency_check_${e}`,r=Date.now(),s=this.cache.get(t);if(s&&r-s.timestamp<1e4)return s.result;if(this.pendingChecks.has(t)){let e=0;for(;this.pendingChecks.has(t)&&e<3e3;)await new Promise(e=>setTimeout(e,100)),e+=100;const s=this.cache.get(t);if(s&&r-s.timestamp<1e4)return s.result}this.pendingChecks.add(t);try{const{data:s,error:n}=await supabase.rpc("check_operation_frequency",{p_user_id:this.userId,p_operation_type:e});if(n){console.error("[FREQ] RPC 调用失败:",n);const e={allowed:!0};return this.cache.set(t,{result:e,timestamp:r}),e}const i={allowed:s.allowed,message:s.message,cooldown_until:s.cooldown_until};return this.cache.set(t,{result:i,timestamp:r}),i}catch(n){console.error("[FREQ] 异常捕获:",n);const e={allowed:!0};return this.cache.set(t,{result:e,timestamp:r}),e}finally{this.pendingChecks.delete(t)}}async recordOperation(e="update",t,r,s){if(!this.userId||this.userId<=0)return;const n=`${e}_${t}_${r}_${s}`,i=Date.now(),o=this.cache.get(n);if(!(o&&i-o.timestamp<5e3))try{const{error:o}=await supabase.rpc("record_operation",{p_user_id:this.userId,p_operation_type:e,p_record_id:t,p_old_value:r,p_new_value:s});o?console.error("[FREQ] recordOperation: RPC 调用失败，error:",o):this.cache.set(n,{result:{success:!0},timestamp:i})}catch(a){console.error("[FREQ] recordOperation: 异常捕获:",a)}}getUserId(){return this.userId}clearExpiredCache(){const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>6e4&&this.cache.delete(t)}getCacheStatus(){const e=Date.now(),t={};for(const[r,s]of this.cache.entries()){const n=e-s.timestamp;t[r]={age:Math.floor(n/1e3),valid:n<6e4}}return t}}const _ServiceManager=class e{constructor(){__publicField(this,"services",new Map),__publicField(this,"initialized",!1)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(e){if(!this.initialized)try{this.services.set("followup",new FollowupService),this.services.set("contractDeals",new ContractDealsService),this.services.set("enumData",new EnumDataService),e&&this.services.set("frequencyControl",new FrequencyControlService(e)),this.initialized=!0,console.log("[ServiceManager] 服务初始化完成")}catch(t){throw console.error("[ServiceManager] 服务初始化失败:",t),t}}getFollowupService(){if(!this.services.has("followup"))throw new Error("FollowupService 未初始化");return this.services.get("followup")}getContractDealsService(){if(!this.services.has("contractDeals"))throw new Error("ContractDealsService 未初始化");return this.services.get("contractDeals")}getEnumDataService(){if(!this.services.has("enumData"))throw new Error("EnumDataService 未初始化");return this.services.get("enumData")}getFrequencyControlService(){return this.services.get("frequencyControl")||null}setUserId(e){e&&e>0&&this.services.set("frequencyControl",new FrequencyControlService(e))}getServicesStatus(){var e;const t={};for(const[r,s]of this.services.entries())t[r]={initialized:!!s,type:(null==(e=null==s?void 0:s.constructor)?void 0:e.name)||"Unknown"};return t}cleanup(){const e=this.getFrequencyControlService();e&&e.clearExpiredCache();const t=this.getEnumDataService();t&&t.refreshAllCache(),console.log("[ServiceManager] 服务资源清理完成")}reset(){this.services.clear(),this.initialized=!1,console.log("[ServiceManager] 服务管理器已重置")}};__publicField(_ServiceManager,"instance");let ServiceManager=_ServiceManager;const getServiceManager=()=>ServiceManager.getInstance(),{Option:Option$9}=Select,RollbackList=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(1),[o,a]=reactExports.useState(0),[l,c]=reactExports.useState("all"),[u,d]=reactExports.useState("");reactExports.useEffect(()=>{!async function(){s(!0);let e=supabase.from("approval_instances").select("id, target_id, status, created_at, config, type").in("type",["lead_rollback","showing_rollback"]);"all"!==l&&(e=e.eq("status",l)),u&&(e=e.ilike("target_id",`%${u}%`));let r=supabase.from("approval_instances").select("id",{count:"exact",head:!0}).in("type",["lead_rollback","showing_rollback"]);"all"!==l&&(r=r.eq("status",l)),u&&(r=r.ilike("target_id",`%${u}%`));const{count:i}=await r;a(i||0);const o=10*(n-1),c=o+10-1,{data:d,error:p}=await e.order("created_at",{ascending:!1}).range(o,c);p||t(d||[]),s(!1)}()},[n,l,u]);return jsxRuntimeExports.jsxs("div",{className:"rollback-list-container",children:[jsxRuntimeExports.jsxs("div",{className:"rollback-search-section",children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"搜索线索编号",allowClear:!0,value:u,onChange:e=>{d(e.target.value),i(1)},style:{width:180}}),jsxRuntimeExports.jsx(Select,{value:l,onChange:e=>{c(e),i(1)},style:{width:120},children:[{value:"all",label:"全部"},{value:"approved",label:"已通过"},{value:"rejected",label:"未通过"},{value:"processing",label:"审批中"},{value:"pending",label:"待审批"}].map(e=>jsxRuntimeExports.jsx(Option$9,{value:e.value,children:e.label},e.value))})]}),jsxRuntimeExports.jsx("div",{className:"rollback-table-section",children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:e,loading:r,rowKey:"id",size:"small",pagination:{current:n,pageSize:10,total:o,showSizeChanger:!1,onChange:e=>i(e),showTotal:e=>`共 ${e} 条`},columns:[{title:"线索编号",dataIndex:"target_id",key:"target_id",width:120},{title:"回退类型",dataIndex:"type",key:"type",width:100,render:e=>({lead_rollback:"线索回退",showing_rollback:"带看回退"}[e]||e)},{title:"回退理由",dataIndex:["config","reason"],key:"reason",width:180,render:(e,t)=>{var r;return(null==(r=t.config)?void 0:r.reason)||"-"}},{title:"证据",key:"evidence",width:160,render:(e,t)=>{var r;return jsxRuntimeExports.jsx(Space$1,{children:((null==(r=t.config)?void 0:r.evidence)||[]).map(e=>jsxRuntimeExports.jsx(Image$2,{src:e,width:40,height:40,style:{objectFit:"cover",borderRadius:2}},e))})}},{title:"状态",dataIndex:"status",key:"status",width:80,render:e=>{let t="orange",r="审批中";return"approved"===e?(t="green",r="已通过"):"rejected"===e?(t="red",r="已拒绝"):"processing"===e?(t="orange",r="审批中"):"pending"===e?(t="orange",r="待审批"):r=e,jsxRuntimeExports.jsx(Tag$1,{color:t,children:r})}},{title:"发起时间",dataIndex:"created_at",key:"created_at",width:160,render:e=>e&&toBeijingDateTimeStr(e)}],scroll:{x:700,y:350}})})]})},FollowupsCalendarView=()=>{const[e,t]=reactExports.useState(!1),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(null),[o,a]=reactExports.useState([]),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(toBeijingTime(dayjs())),[p,m]=reactExports.useState([]),[h,x]=reactExports.useState([]),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState(""),[E,j]=reactExports.useState(null),[b]=Form$4.useForm(),[w,R]=reactExports.useState(0),[_]=reactExports.useState(0),S=["丢单","待接收","确认需求","邀约到店","已到店","赢单"],C={"丢单":["majorcategory","followupresult"],"待接收":[],"确认需求":["customerprofile","worklocation","userbudget","moveintime","userrating","majorcategory","followupresult"],"邀约到店":["scheduletime","scheduledcommunity"],"已到店":[],"赢单":[]},k={customerprofile:"用户画像",worklocation:"工作地点",userbudget:"用户预算",moveintime:"入住时间",userrating:"来访意向",majorcategory:"跟进结果",followupresult:"跟进备注",scheduletime:"预约到店时间",scheduledcommunity:"预约社区",showingsales_user:"带看管家",followupstage:"跟进阶段"},$=(e,t)=>"丢单"===t&&"followupresult"===e?"丢单原因":k[e]||e,T=e=>{const t={...e};return["moveintime","scheduletime"].forEach(e=>{t[e]&&"string"==typeof t[e]&&(t[e]=toBeijingTime(t[e]))}),t},I=async(e={})=>{if(!E)return{success:!1,error:"无当前记录"};try{const t=b.getFieldsValue();["moveintime","scheduletime"].forEach(e=>{var r;t[e]&&"function"==typeof(null==(r=t[e])?void 0:r.format)&&(t[e]=toBeijingDateTimeStr(t[e]))});const{contractcommunity:r,contractnumber:s,roomnumber:n,...i}=t,o={...i,...e};Object.entries(o).forEach(([e,t])=>{t!==E[e]&&D(E.id,e,t)});const{error:a}=await supabase.from("followups").update(o).eq("id",E.id);return a?(Object.entries(o).forEach(([e,t])=>{t!==E[e]&&D(E.id,e,E[e])}),{success:!1,error:a.message}):{success:!0}}catch(t){const r=b.getFieldsValue(),{contractcommunity:s,contractnumber:n,roomnumber:i,...o}=r,a={...o,...e};return Object.entries(a).forEach(([e,t])=>{t!==E[e]&&D(E.id,e,E[e])}),{success:!1,error:"保存过程中发生错误"}}},P=async(e,r)=>{t(!0);try{console.log("🔍 开始获取跟进记录数据..."),console.log("📅 日期范围:",{startDate:e,endDate:r});const t={p_moveintime_start:e?`${e} 00:00:00`:void 0,p_moveintime_end:r?`${r} 23:59:59`:void 0,p_limit:1e3,p_offset:0};Object.keys(t).forEach(e=>{void 0!==t[e]&&null!==t[e]||delete t[e]}),console.log("📤 执行RPC查询...");const{data:n,error:i}=await supabase.rpc("filter_followups",t);if(i)return console.error("❌ 获取数据失败:",i),console.error("❌ 错误详情:",{message:i.message,details:i.details,hint:i.hint,code:i.code}),void staticMethods.error("获取数据失败: "+i.message);console.log("✅ 查询成功，数据条数:",(null==n?void 0:n.length)||0),console.log("📊 原始数据:",n);const o=(n||[]).map(e=>({id:e.id,leadid:e.leadid,title:e.leadid,date:e.moveintime,followupstage:e.followupstage,customerprofile:e.customerprofile,worklocation:e.worklocation,userbudget:e.userbudget,userrating:e.userrating,phone:e.phone||"",wechat:e.wechat||"",remark:e.remark,followupresult:e.followupresult,majorcategory:e.majorcategory,interviewsales_user_name:e.interviewsales_user_name||e.nickname,scheduledcommunity:e.scheduledcommunity}));console.log("🔄 转换后的日历事件:",o),s(o)}catch(n){console.error("❌ 获取跟进记录失败:",n),staticMethods.error("获取数据失败")}finally{t(!1)}};reactExports.useEffect(()=>{const e=dayjs(),t=e.startOf("month").startOf("week"),r=e.endOf("month").endOf("week");console.log("📅 初始化本月数据:",{startDate:t.format("YYYY-MM-DD"),endDate:r.format("YYYY-MM-DD"),currentMonth:e.format("YYYY年MM月")}),d(e),P(t.format("YYYY-MM-DD"),r.format("YYYY-MM-DD")),F("followupstage",m),M()},[]);const A=reactExports.useMemo(()=>{const e={};return r.forEach(t=>{const r=dayjs(t.date).format("YYYY-MM-DD");e[r]||(e[r]=[]),e[r].push(t)}),e},[r]),F=async(e,t)=>{const r=`enum_${e}`,s=localStorage.getItem(`${r}_timestamp`),n=Date.now();if(s&&n-parseInt(s)<3e5){const e=localStorage.getItem(r);if(e)return void t(JSON.parse(e))}try{const{data:s,error:i}=await supabase.rpc("get_enum_values",{enum_name:e});if(i)return void console.error(`加载${e}枚举失败:`,i);const o=(s||[]).map(e=>({label:e,value:e}));t(o),localStorage.setItem(r,JSON.stringify(o)),localStorage.setItem(`${r}_timestamp`,n.toString())}catch(i){console.error(`加载${e}枚举失败:`,i)}},M=async()=>{const e="metro_stations",t=localStorage.getItem(`${e}_timestamp`),r=Date.now();if(t&&r-parseInt(t)<3e5){const t=localStorage.getItem(e);if(t)return void x(JSON.parse(t))}try{const{data:t,error:s}=await supabase.rpc("get_metrostations");if(s)return void console.error("加载地铁站数据失败:",s);const n=(t||[]).reduce((e,t)=>{const r=t.line||"其他";return e[r]||(e[r]=[]),e[r].push(t),e},{}),i=Object.entries(n).sort(([e],[t])=>{const r=e=>{const t=e.match(/^(\d+)号线$/);return t?parseInt(t[1]):999999};return r(e)-r(t)}).map(([e,t])=>({value:e,label:e,children:t.map(e=>({value:e.name,label:e.name}))}));x(i),localStorage.setItem(e,JSON.stringify(i)),localStorage.setItem(`${e}_timestamp`,r.toString())}catch(s){console.error("加载地铁站数据失败:",s)}},D=(e,t,r)=>{s(s=>s.map(s=>s.id===e?{...s,[t]:r}:s))};return jsxRuntimeExports.jsxs("div",{className:"followups-calendar-view",style:{margin:0,padding:0},children:[jsxRuntimeExports.jsx("div",{className:"calendar-container",style:{margin:0,padding:0},children:jsxRuntimeExports.jsx(Spin,{spinning:e,children:jsxRuntimeExports.jsx(Calendar,{value:u,style:{margin:0,padding:0},className:"no-margin-calendar",cellRender:e=>{const t=e.format("YYYY-MM-DD"),r=A[t]||[],s=new Set(r.map(e=>e.leadid)).size;return jsxRuntimeExports.jsxs("div",{className:"calendar-cell",children:[s>0&&jsxRuntimeExports.jsx("div",{className:"count-header",children:jsxRuntimeExports.jsxs("span",{className:"count-text",children:["共",s,"条线索"]})}),jsxRuntimeExports.jsx("ul",{className:"events",children:r.map(e=>jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx(Badge$2,{status:(()=>{const e=["success","processing","warning","error","default"];return e[Math.floor(Math.random()*e.length)]})(),text:e.title})},e.id))})]})},onSelect:e=>{const t=e.format("YYYY-MM-DD"),r=A[t]||[];r.length>0&&(i(e),a(r),c(!0))},onPanelChange:(e,t)=>{if("month"===t){d(e);const t=e.startOf("month").startOf("week"),r=e.endOf("month").endOf("week");P(t.format("YYYY-MM-DD"),r.format("YYYY-MM-DD"))}},mode:"month",validRange:[dayjs("1900-01-01"),dayjs("2100-12-31")],headerRender:({value:e,onChange:t})=>jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:r=>{r.stopPropagation(),t(e.clone().subtract(1,"month"))},children:"‹"}),jsxRuntimeExports.jsx(Select,{value:e.year(),onChange:r=>{const s=e.year(r);t(s)},style:{width:100},size:"small",showSearch:!0,placeholder:"选择年份",children:Array.from({length:20},(e,t)=>{const r=dayjs().year()-10+t;return jsxRuntimeExports.jsxs(Select.Option,{value:r,children:[r,"年"]},r)})}),jsxRuntimeExports.jsx(Select,{value:e.month(),onChange:r=>{const s=e.month(r);t(s)},style:{width:80},size:"small",showSearch:!0,placeholder:"选择月份",children:Array.from({length:12},(e,t)=>jsxRuntimeExports.jsxs(Select.Option,{value:t,children:[String(t+1).padStart(2,"0"),"月"]},t))}),jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:r=>{r.stopPropagation(),t(e.clone().add(1,"month"))},children:"›"})]})})})})}),jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx(RefIcon$4,{style:{color:"#1890ff"}}),jsxRuntimeExports.jsxs("span",{children:[null==n?void 0:n.format("YYYY年MM月DD日")," 的跟进记录"]})]}),open:l,onCancel:()=>c(!1),footer:null,width:1e3,styles:{body:{maxHeight:"70vh",overflow:"auto",padding:0,margin:0}},children:o.length>0?jsxRuntimeExports.jsx("div",{className:"calendar-modal-content",children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:o,columns:[{title:"线索编号",dataIndex:"leadid",key:"leadid",width:120,fixed:"left",render:e=>jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",style:{padding:0,height:"auto",fontSize:14,color:"#1677ff",fontWeight:500},children:e})},{title:"跟进阶段",dataIndex:"followupstage",key:"followupstage",width:100,render:(e,t)=>{const r=p.find(t=>t.value===e),s={"丢单":"#ff4d4f","待接收":"#bfbfbf","确认需求":"#1677ff","邀约到店":"#fa8c16","已到店":"#52c41a","赢单":"#faad14"}[(null==r?void 0:r.label)||e]||"#1677ff";return jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",style:{background:s,borderColor:s,color:"#fff",boxShadow:"none",minWidth:60,display:"inline-block",textAlign:"center",padding:"0 8px",fontSize:12,zIndex:2},onClick:()=>{j(t),g(!0),v(t.followupstage),R(S.indexOf(t.followupstage)),b.setFieldsValue(T(t))},children:(null==r?void 0:r.label)||e})}},{title:"客户画像",dataIndex:"customerprofile",key:"customerprofile",width:120,render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"purple",children:e}):"-"},{title:"销售",dataIndex:"interviewsales_user_name",key:"interviewsales_user_name",width:100,render:e=>e||"-"},{title:"预约社区",dataIndex:"scheduledcommunity",key:"scheduledcommunity",width:120,ellipsis:!0,render:e=>e||"-"},{title:"工作地点",dataIndex:"worklocation",key:"worklocation",width:150,ellipsis:!0,render:e=>e||"-"},{title:"预算",dataIndex:"userbudget",key:"userbudget",width:100,render:e=>e||"-"},{title:"来访意向",dataIndex:"userrating",key:"userrating",width:100,render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:e}):"-"},{title:"跟进结果",dataIndex:"majorcategory",key:"majorcategory",width:200,ellipsis:!0,render:e=>e?jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx(Tag$1,{color:"purple",style:{maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}):"-"},{title:"跟进备注",dataIndex:"followupresult",key:"followupresult",width:200,ellipsis:!0,render:e=>e?jsxRuntimeExports.jsx(Tooltip,{title:e,children:jsxRuntimeExports.jsx("div",{style:{maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer",color:"#666"},children:e})}):"-"}],size:"small",pagination:!1,scroll:{x:1100,y:400},rowKey:"id",style:{backgroundColor:"transparent"},locale:{emptyText:"暂无跟进记录"}})}):jsxRuntimeExports.jsx(Empty$1,{description:"该日期没有跟进记录"})}),jsxRuntimeExports.jsx(Drawer,{title:"跟进阶段进度",placement:"bottom",open:f,onClose:async()=>{if(!E)return void g(!1);const e=await I();e.success?staticMethods.success("已自动保存"):staticMethods.error("保存失败: "+e.error),g(!1)},destroyOnHidden:!0,footer:null,className:"lead-detail-drawer",children:jsxRuntimeExports.jsxs("div",{className:"drawer-flex-row",children:[jsxRuntimeExports.jsxs("div",{className:"page-drawer-info",children:[jsxRuntimeExports.jsxs("div",{className:"mb-12",children:[jsxRuntimeExports.jsx("span",{className:"text-secondary",children:"线索编号："}),(null==E?void 0:E.leadid)?jsxRuntimeExports.jsx("span",{style:{color:"#1677ff",fontWeight:600,display:"inline-block",whiteSpace:"nowrap",maxWidth:320},children:E.leadid}):jsxRuntimeExports.jsx("span",{className:"text-muted",children:"-"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-12",children:[jsxRuntimeExports.jsx("span",{className:"text-secondary",children:"手机号："}),(null==E?void 0:E.phone)?jsxRuntimeExports.jsx("span",{style:{display:"inline-block",whiteSpace:"nowrap",maxWidth:320},children:E.phone.substring(0,4)+"****"+E.phone.substring(E.phone.length-3)}):jsxRuntimeExports.jsx("span",{className:"text-muted",children:"-"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-12",children:[jsxRuntimeExports.jsx("span",{className:"text-secondary",children:"微信号："}),(null==E?void 0:E.wechat)?jsxRuntimeExports.jsx("span",{style:{display:"inline-block",whiteSpace:"nowrap",maxWidth:320},children:E.wechat.substring(0,2)+"****"+E.wechat.substring(E.wechat.length-2)}):jsxRuntimeExports.jsx("span",{className:"text-muted",children:"-"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-12",children:[jsxRuntimeExports.jsx("span",{className:"text-secondary",children:"渠道："}),jsxRuntimeExports.jsx("span",{className:"text-primary",children:(null==E?void 0:E.source)||"-"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-12",children:[jsxRuntimeExports.jsx("span",{className:"text-secondary",children:"创建时间："}),jsxRuntimeExports.jsx("span",{children:(null==E?void 0:E.created_at)?new Date(E.created_at).toLocaleString("zh-CN"):"-"})]})]}),jsxRuntimeExports.jsxs("div",{className:"page-drawer-form",children:[jsxRuntimeExports.jsx(Steps,{current:w,items:S.map((e,t)=>({title:e,disabled:0!==t,subTitle:null,description:null})),onChange:e=>{0===e&&(R(e),v(S[e]),E&&b.setFieldsValue(T(E)))},style:{marginBottom:32},"data-current":w,size:"small"}),jsxRuntimeExports.jsx("div",{className:"form-content",children:jsxRuntimeExports.jsxs(Form$4,{form:b,layout:"vertical",onFinishFailed:()=>staticMethods.error("请完整填写所有必填项"),onValuesChange:e=>{let t=!1;const r={};["moveintime","scheduletime"].forEach(s=>{if(s in e){const n=e[s];n&&""!==n&&null!==n?dayjs.isDayjs(n)||(r[s]=dayjs(n),t=!0):(r[s]=void 0,t=!0)}}),t&&b.setFieldsValue(r)},children:[("确认需求"===y||"邀约到店"===y||"丢单"===y)&&jsxRuntimeExports.jsx("div",{className:"page-step-fields","data-stage":y,children:(C[y]||[]).map(e=>jsxRuntimeExports.jsx("div",{className:"page-step-field-item",children:jsxRuntimeExports.jsx(Form$4.Item,{name:e,label:$(e,y),rules:[{required:!0,message:`请填写${$(e,y)}`}],children:"scheduledcommunity"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择社区",disabled:!1},_):"customerprofile"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择用户画像",disabled:!1},_):"followupstage"===e?jsxRuntimeExports.jsx(Select,{options:p,placeholder:"请选择阶段",loading:0===p.length,disabled:0===p.length||!1},_):"userrating"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择来访意向",disabled:!1},_):"worklocation"===e?jsxRuntimeExports.jsx(Cascader,{options:h,placeholder:"请选择工作地点",showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:!1,onChange:(t,r)=>{let s="";r&&r.length>1?s=r[1].label:r&&1===r.length&&(s=r[0].label),s&&b.setFieldValue(e,s)}},_):"moveintime"===e||"scheduletime"===e?jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,locale:locale$4,style:{width:"100%"},placeholder:"请选择时间",disabled:!1,value:(()=>{const t=b.getFieldValue(e);if(t&&""!==t&&null!==t)return dayjs.isDayjs(t)?t:"string"==typeof t?dayjs(t):void 0})(),onChange:t=>{b.setFieldValue(e,t||void 0)}},_):"userbudget"===e?jsxRuntimeExports.jsx(TypedInputNumber,{style:{width:"100%"},placeholder:"请输入预算金额",min:0,precision:0,disabled:!1},_):"majorcategory"===e?jsxRuntimeExports.jsx(Input$1,{placeholder:"请选择跟进结果",disabled:!1},_):jsxRuntimeExports.jsx(Input$1,{disabled:!1},_)})},e))}),"确认需求"!==y&&"邀约到店"!==y&&"丢单"!==y&&"已到店"!==y&&"赢单"!==y&&jsxRuntimeExports.jsx("div",{className:"page-step-fields-single",children:(C[y]||[]).map(e=>jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Form$4.Item,{name:e,label:$(e,y),rules:[{required:!0,message:`请填写${$(e,y)}`}],children:"scheduledcommunity"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择社区",disabled:!1},_):"customerprofile"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择用户画像",disabled:!1},_):"followupstage"===e?jsxRuntimeExports.jsx(Select,{options:p,placeholder:"请选择阶段",loading:0===p.length,disabled:0===p.length||!1},_):"userrating"===e?jsxRuntimeExports.jsx(Select,{options:[],placeholder:"请选择来访意向",disabled:!1},_):"worklocation"===e?jsxRuntimeExports.jsx(Cascader,{options:h,placeholder:"请选择工作地点",showSearch:!0,changeOnSelect:!1,allowClear:!0,disabled:!1,onChange:(t,r)=>{let s="";r&&r.length>1?s=r[1].label:r&&1===r.length&&(s=r[0].label),s&&b.setFieldValue(e,s)}},_):"moveintime"===e||"scheduletime"===e?jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,locale:locale$4,style:{width:"100%"},placeholder:"请选择时间",disabled:!1,value:(()=>{const t=b.getFieldValue(e);if(t&&""!==t&&null!==t)return dayjs.isDayjs(t)?t:"string"==typeof t?dayjs(t):void 0})(),onChange:t=>{b.setFieldValue(e,t||void 0)}},_):"userbudget"===e?jsxRuntimeExports.jsx(TypedInputNumber,{style:{width:"100%"},placeholder:"请输入预算金额",min:0,precision:0,disabled:!1},_):"majorcategory"===e?jsxRuntimeExports.jsx(Input$1,{placeholder:"请选择跟进结果",disabled:!1},_):jsxRuntimeExports.jsx(Input$1,{disabled:!1},_)})},e))})]})}),jsxRuntimeExports.jsx("div",{className:"drawer-footer",children:jsxRuntimeExports.jsxs("div",{className:"button-group",children:["丢单"!==y&&jsxRuntimeExports.jsx(Button$1,{disabled:0===w,onClick:async()=>{if(!E)return;const e=await I({followupstage:S[w-1]});e.success?(R(w-1),v(S[w-1])):staticMethods.error("保存失败: "+e.error)},children:"上一步"}),"丢单"===y&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{danger:!0,onClick:async()=>{if(E)try{await b.validateFields();const e=await I({followupstage:"丢单"});e.success?(g(!1),staticMethods.success("已确认丢单")):staticMethods.error("确认丢单失败: "+e.error)}catch{staticMethods.error("请完整填写所有必填项")}},disabled:!1,children:"确认丢单"}),jsxRuntimeExports.jsx(Button$1,{onClick:async()=>{if(E)try{const e=await I({followupstage:"待接收"});e.success?(g(!1),staticMethods.success("已恢复状态")):staticMethods.error("恢复状态失败: "+e.error)}catch(e){staticMethods.error("恢复状态失败")}},disabled:!1,children:"恢复状态"})]}),w===S.length-1?jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>{staticMethods.success("跟进阶段管理完成"),g(!1)},children:"完成"}):"已到店"===y||"丢单"===y?null:jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:async()=>{try{if(!E)return;await b.validateFields();const e=await I({followupstage:S[w+1]});e.success?(R(w+1),v(S[w+1])):staticMethods.error("保存失败: "+e.error)}catch{staticMethods.error("请完整填写所有必填项")}},children:"下一步"})]})})]})]})})]})},SHANGHAI_METRO_STATIONS=[{id:"ST11-XZ",title:"莘庄",description:"莘庄",x:.3201,y:.6252,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-WHL",title:"外环路",description:"外环路",x:.332,y:.6099,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-LHL",title:"莲花路",description:"莲花路",x:.3445,y:.5978,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-JJLY",title:"锦江乐园",description:"锦江乐园",x:.3569,y:.586,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST4005-SHNZ",title:"上海南站",description:"上海南站",x:.3732,y:.5724,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST801-CBL",title:"漕宝路",description:"漕宝路",x:.3841,y:.5612,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST9-SHTYG",title:"上海体育馆",description:"上海体育馆",x:.3961,y:.4924,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST501-XJH",title:"徐家汇",description:"徐家汇",x:.4186,y:.4706,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-HSL",title:"衡山路",description:"衡山路",x:.4376,y:.453,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST41-CSL",title:"常熟路",description:"常熟路",x:.452,y:.4358,pin:"hidden",fill:null,zoom:12,distance:null},{id:"STA01-SXNL",title:"陕西南路",description:"陕西南路",x:.4784,y:.4358,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST2001-HPNL",title:"一大会址·黄陂南路",description:"一大会址·黄陂南路",x:.524,y:.4176,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST83-RMGC",title:"人民广场",description:"人民广场",x:.5236,y:.3948,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-XZL",title:"新闸路",description:"新闸路",x:.5154,y:.3609,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1801-HZL",title:"汉中路",description:"汉中路",x:.4996,y:.3496,pin:"hidden",fill:null,zoom:12,distance:null},{id:"STD-SHHCZ",title:"上海火车站",description:"上海火车站",x:.5013,y:.3271,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-ZSBL",title:"中山北路",description:"中山北路",x:.5,y:.297,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-YCL",title:"延长路",description:"延长路",x:.5,y:.2814,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-SHMXC",title:"上海马戏城",description:"上海马戏城",x:.5,y:.261,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-WSL",title:"汶水路",description:"汶水路",x:.5,y:.2434,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-PPXC",title:"彭浦新村",description:"彭浦新村",x:.5,y:.2207,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-GKL",title:"共康路",description:"共康路",x:.5,y:.1973,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-THXC",title:"通河新村",description:"通河新村",x:.5,y:.1741,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-HLL",title:"呼兰路",description:"呼兰路",x:.5,y:.1505,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-GFXC",title:"共富新村",description:"共富新村",x:.5,y:.1273,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-BAGL",title:"宝安公路",description:"宝安公路",x:.4954,y:.0985,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-YYXL",title:"友谊西路",description:"友谊西路",x:.4664,y:.0679,pin:"hidden",fill:null,zoom:12,distance:null},{id:"ST1-FJL",title:"富锦路",description:"富锦路",x:.4623,y:.0284,pin:"hidden",fill:null,zoom:12,distance:null}],METRO_LINES_DATA={"1号线":["莘庄","外环路","莲花路","锦江乐园","上海南站","漕宝路","上海体育馆","徐家汇","衡山路","常熟路","陕西南路","一大会址·黄陂南路","人民广场","新闸路","汉中路","上海火车站","中山北路","延长路","上海马戏城","汶水路","彭浦新村","共康路","通河新村","呼兰路","共富新村","宝安公路","友谊西路","富锦路"],"2号线":["国家会展中心","虹桥火车站","虹桥2号航站楼","淞虹路","北新泾","威宁路","娄山关路","中山公园","江苏路","静安寺","南京西路","人民广场","南京东路","陆家嘴","浦东南路","世纪大道","上海科技馆","世纪公园","龙阳路","张江高科","金科路","广兰路","唐镇","创新中路","华夏东路","川沙","凌空路","远东大道","海天三路","浦东1号2号航站楼"],"3号线":["上海南站","石龙路","龙漕路","漕溪路","宜山路","虹桥路","延安西路","中山公园","金沙江路","曹杨路","镇坪路","中潭路","上海火车站","宝山路","东宝兴路","虹口足球场","赤峰路","大柏树","江湾镇","殷高西路","长江南路","淞发路","张华浜","淞滨路","水产路","宝杨路","友谊路","铁力路","江杨北路"],"4号线":["宜山路","虹桥路","延安西路","中山公园","金沙江路","曹杨路","镇坪路","中潭路","上海火车站","宝山路","海伦路","临平路","大连路","杨树浦路","浦东大道","世纪大道","向城路","蓝村路","塘桥","南浦大桥","西藏南路","鲁班路","大木桥路","东安路","上海体育场","上海体育馆"],"5号线":["莘庄","春申路","银都路","颛桥","北桥","剑川路","东川路","江川路","西渡","萧塘","奉浦大道","环城东路","望园路","金海湖","奉贤新城","金平路","华宁路","文井路","闵行开发区"],"6号线":["东方体育中心","灵岩南路","上南路","华夏西路","高青路","东明路","高科西路","临沂新村","上海儿童医学中心","蓝村路","浦电路","世纪大道","源深体育中心","民生路","北洋泾路","德平路","云山路","金桥路","博兴路","五莲路","巨峰路","东靖路","五洲大道","洲海路","外高桥保税区南","航津路","外高桥保税区北","港城路"],"7号线":["美兰湖","罗南新村","潘广路","刘行","顾村公园","祁华路","上海大学","南陈路","上大路","场中路","大场镇","行知路","大华三路","新村路","岚皋路","镇坪路","长寿路","昌平路","静安寺","常熟路","肇嘉浜路","东安路","龙华中路","后滩","长清路","耀华路","云台路","高科西路","杨高南路","锦绣路","芳华路","龙阳路","花木路"],"8号线":["沈杜公路","联航路","江月路","浦江镇","芦恒路","凌兆新村","东方体育中心","杨思","成山路","耀华路","中华艺术宫","西藏南路","陆家浜路","老西门","大世界","人民广场","曲阜路","中兴路","西藏北路","虹口足球场","曲阳路","四平路","鞍山新村","江浦路","黄兴路","延吉中路","黄兴公园","翔殷路","嫩江路","市光路"],"9号线":["上海松江站","醉白池","松江体育中心","松江新城","松江大学城","洞泾","佘山","泗泾","九亭","中春路","七宝","星中路","合川路","漕河泾开发区","桂林路","宜山路","徐家汇","肇嘉浜路","嘉善路","打浦桥","马当路","陆家浜路","小南门","商城路","世纪大道","杨高中路","芳甸路","蓝天路","台儿庄路","金桥","金吉路","金海路","顾唐路","民雷路","曹路"],"10号线":["航中路","紫藤路","龙柏新村","虹桥火车站","虹桥2号航站楼","虹桥1号航站楼","上海动物园","龙溪路","水城路","伊犁路","宋园路","虹桥路","交通大学","上海图书馆","陕西南路","一大会址·新天地","老西门","豫园","南京东路","天潼路","四川北路","海伦路","邮电新村","四平路","同济大学","国权路","五角场","江湾体育场","三门路","殷高东路","新江湾城","国帆路","双江路","高桥西","高桥","港城路","基隆路"],"11号线":["花桥","光明路","兆丰路","安亭","上海汽车城","昌吉东路","上海赛车场","嘉定北","嘉定西","白银路","嘉定新城","马陆","陈翔公路","南翔","桃浦新村","武威路","祁连山路","李子园","上海西站","真如","枫桥路","曹杨路","隆德路","江苏路","交通大学","徐家汇","上海游泳馆","龙华","云锦路","龙耀路","东方体育中心","三林","三林东","浦三路","康恒路","御桥","罗山路","秀沿路","康新公路","迪士尼"],"12号线":["七莘路","虹莘路","顾戴路","东兰路","虹梅路","虹漕路","桂林公园","漕宝路","龙漕路","龙华","龙华中路","大木桥路","嘉善路","陕西南路","南京西路","汉中路","曲阜路","天潼路","国际客运中心","提篮桥","大连路","江浦公园","宁国路","隆昌路","爱国路","复兴岛","东陆路","巨峰路","东高北路","金京路","申江路","金海路"],"13号线":["金运路","金沙江西路","丰庄","祁连山南路","真北路","大渡河路","金沙江路","隆德路","武宁路","长寿路","江宁路","汉中路","自然博物馆","南京西路","淮海中路","一大会址·新天地","马当路","世博会博物馆","世博大道","长清路","成山路","东明路","华鹏路","下南路","北蔡","陈春路","莲溪路","华夏中路","中科路","学林路","张江路"],"14号线":["封浜","乐秀路","临洮路","嘉怡路","定边路","真新新村","真光路","铜川路","真如","中宁路","曹杨路","武宁路","武定路","静安寺","一大会址·黄陂南路","大世界","豫园","陆家嘴","浦东南路","浦东大道","源深路","昌邑路","歇浦路","云山路","蓝天路","黄杨路","云顺路","浦东足球场","金粤路","桂桥路"],"15号线":["紫竹高新区","永德路","元江路","双柏路","曙建路","景西路","虹梅南路","景洪路","朱梅路","罗秀路","华东理工大学","上海南站","桂林公园","桂林路","吴中路","姚虹路","红宝石路","娄山关路","长风公园","大渡河路","梅岭北路","铜川路","上海西站","武威东路","古浪路","祁安路","南大路","丰翔路","锦秋路","顾村公园"],"16号线":["龙阳路","华夏中路","罗山路","周浦东","鹤沙航城","航头东","新场","野生动物园","惠南","浦东火车站","书院","临港大道","滴水湖"],"17号线":["虹桥火车站","国家会展中心","蟠龙路","徐盈路","徐泾北城","嘉松中路","赵巷","汇金路","青浦新城","漕盈路","淀山湖大道","朱家角","东方绿舟","西岑"],"18号线":["航头","下沙","鹤涛路","沈梅路","繁荣路","周浦","康桥","御桥","莲溪路","北中路","芳芯路","龙阳路","迎春路","杨高中路","民生路","昌邑路","丹阳路","平凉路","江浦公园","江浦路","抚顺路","国权路","复旦大学","上海财经大学","殷高路","长江南路"]},TRANSFER_STATIONS=new Map,STATION_TO_LINES=new Map;Object.entries(METRO_LINES_DATA).forEach(([e,t])=>{t.forEach(t=>{STATION_TO_LINES.has(t)||STATION_TO_LINES.set(t,[]),STATION_TO_LINES.get(t).push(e)})}),STATION_TO_LINES.forEach((e,t)=>{e.length>1&&TRANSFER_STATIONS.set(t,e)}),SHANGHAI_METRO_STATIONS.filter(e=>METRO_LINES_DATA["1号线"].includes(e.title)),SHANGHAI_METRO_STATIONS.filter(e=>METRO_LINES_DATA["2号线"].includes(e.title));const _MetroDataService=class e{constructor(){__publicField(this,"cachedStations",[]),__publicField(this,"cacheTimestamp",0),__publicField(this,"CACHE_DURATION",864e5),__publicField(this,"CACHE_KEY","metro_stations_cache"),__publicField(this,"CACHE_TIMESTAMP_KEY","metro_stations_cache_timestamp"),this.loadFromLocalStorage()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async getAllStations(){return this.isCacheValid()?(console.log("📦 [MetroDataService] 使用本地缓存的地铁站点数据"),this.cachedStations):(console.log("🔄 [MetroDataService] 从数据库获取地铁站点数据"),await this.fetchFromDatabase())}async refreshStations(){return console.log("🔄 [MetroDataService] 强制刷新地铁站点数据"),this.clearCache(),await this.fetchFromDatabase()}async getStationsWithCacheManager(){const e=cacheManager.getCache(this.CACHE_KEY,this.CACHE_DURATION);if(e)return console.log("📦 [MetroDataService] 从缓存管理器获取地铁站点数据"),e;console.log("🔄 [MetroDataService] 从数据库获取地铁站点数据");const t=await this.fetchFromDatabase();return cacheManager.setCache(this.CACHE_KEY,t),t}async fetchFromDatabase(){try{const{data:e,error:t}=await supabase.rpc("get_metrostations");if(t){if(console.error("❌ [MetroDataService] 获取地铁站点数据失败:",t),this.cachedStations.length>0)return console.log("⚠️ [MetroDataService] 数据库获取失败，使用本地缓存数据"),this.cachedStations;throw t}if(!e||0===e.length)return console.warn("⚠️ [MetroDataService] 数据库返回空数据"),this.cachedStations;const r=this.convertToMetroStations(e);return this.updateCache(r),console.log(`✅ [MetroDataService] 成功获取 ${r.length} 个地铁站点数据`),r}catch(e){return console.error("❌ [MetroDataService] 获取地铁站点数据异常:",e),this.cachedStations.length>0?(console.log("⚠️ [MetroDataService] 数据库获取异常，使用本地缓存数据"),this.cachedStations):[]}}convertToMetroStations(e){const t=[],r=new Map;return e.forEach((e,s)=>{const n=`${e.line}-${e.name}`;if(r.has(e.name)){const t=r.get(e.name);t.description=`${t.description}, ${e.line}`}else{const s={id:n,title:e.name,description:e.line,x:.5,y:.5,pin:"hidden",fill:null,zoom:1,distance:null};r.set(e.name,s),t.push(s)}}),t}isCacheValid(){if(0===this.cachedStations.length)return!1;return Date.now()-this.cacheTimestamp<this.CACHE_DURATION}updateCache(e){this.cachedStations=e,this.cacheTimestamp=Date.now(),this.saveToLocalStorage()}clearCache(){this.cachedStations=[],this.cacheTimestamp=0,localStorage.removeItem(this.CACHE_KEY),localStorage.removeItem(this.CACHE_TIMESTAMP_KEY)}loadFromLocalStorage(){try{const e=localStorage.getItem(this.CACHE_KEY),t=localStorage.getItem(this.CACHE_TIMESTAMP_KEY);e&&t&&(this.cachedStations=JSON.parse(e),this.cacheTimestamp=parseInt(t),console.log(`📦 [MetroDataService] 从本地存储加载了 ${this.cachedStations.length} 个地铁站点`))}catch(e){console.error("❌ [MetroDataService] 从本地存储加载缓存失败:",e),this.clearCache()}}saveToLocalStorage(){try{localStorage.setItem(this.CACHE_KEY,JSON.stringify(this.cachedStations)),localStorage.setItem(this.CACHE_TIMESTAMP_KEY,this.cacheTimestamp.toString()),console.log("💾 [MetroDataService] 地铁站点数据已保存到本地存储")}catch(e){console.error("❌ [MetroDataService] 保存到本地存储失败:",e)}}getCacheInfo(){const e=Date.now();return{hasCache:this.cachedStations.length>0,stationCount:this.cachedStations.length,cacheAge:this.cacheTimestamp>0?e-this.cacheTimestamp:0,isValid:this.isCacheValid()}}searchStations(e){if(!e.trim())return this.cachedStations;const t=e.toLowerCase();return this.cachedStations.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}findStation(e){const t=e.toLowerCase();let r=this.cachedStations.find(e=>e.title.toLowerCase()===t);return r||(r=this.cachedStations.find(e=>e.title.toLowerCase().includes(t)),r||null)}};__publicField(_MetroDataService,"instance");let MetroDataService=_MetroDataService;const _MetroService=class e{constructor(){__publicField(this,"transferStations"),__publicField(this,"stationToLines"),__publicField(this,"metroDataService"),__publicField(this,"dynamicStations",[]),this.metroDataService=MetroDataService.getInstance(),this.initializeMappings(),this.initializeDynamicStations()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeMappings(){this.transferStations=new Map,this.stationToLines=new Map,Object.entries(METRO_LINES_DATA).forEach(([e,t])=>{t.forEach(t=>{this.stationToLines.has(t)||this.stationToLines.set(t,[]),this.stationToLines.get(t).push(e)})}),this.stationToLines.forEach((e,t)=>{e.length>1&&this.transferStations.set(t,e)})}async initializeDynamicStations(){try{this.dynamicStations=await this.metroDataService.getAllStations(),console.log(`✅ [MetroService] 动态加载了 ${this.dynamicStations.length} 个地铁站点`)}catch(e){console.error("❌ [MetroService] 初始化动态站点数据失败:",e),this.dynamicStations=SHANGHAI_METRO_STATIONS}}calculateCommute(e,t){const r=this.findStation(e),s=this.findStation(t);if(!r||!s)return null;const n=this.calculateDistance(r,s),i=this.planRoute(r,s);return{fromStation:r,toStation:s,distance:n,commuteTime:i.totalTime,stationCount:i.stationCount,route:i.route,transfers:i.transfers,transferCount:i.transferCount,routeSummary:i.routeSummary}}findStation(e){const t=e.toLowerCase();if(this.dynamicStations.length>0){let e=this.dynamicStations.find(e=>e.title.toLowerCase()===t);if(e)return e;if(e=this.dynamicStations.find(e=>e.title.toLowerCase().includes(t)),e)return e;if(e=this.dynamicStations.find(e=>e.id.toLowerCase().includes(t)),e)return e}let r=SHANGHAI_METRO_STATIONS.find(e=>e.title.toLowerCase()===t);return r||(r=SHANGHAI_METRO_STATIONS.find(e=>e.title.toLowerCase().includes(t)),r||(r=SHANGHAI_METRO_STATIONS.find(e=>e.id.toLowerCase().includes(t)),r||null))}getStationLines(e){return this.stationToLines.get(e.title)||[]}getAllStations(){return this.dynamicStations.length>0?this.dynamicStations:SHANGHAI_METRO_STATIONS}searchStations(e){if(!e.trim())return[];const t=e.toLowerCase();return SHANGHAI_METRO_STATIONS.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))}getTransferStations(){return new Map(this.transferStations)}isTransferStation(e){return this.transferStations.has(e)}getStationsByLine(e){return METRO_LINES_DATA[e]||[]}getAllLineNames(){return Object.keys(METRO_LINES_DATA)}calculateDistance(e,t){const r=e.x-t.x,s=e.y-t.y;return Math.sqrt(r*r+s*s)}planRoute(e,t){const r=this.getStationLines(e),s=this.getStationLines(t),n=r.find(e=>s.includes(e));if(n){const r=METRO_LINES_DATA[n],s=r.indexOf(e.title),i=r.indexOf(t.title),o=Math.abs(i-s);return{totalTime:3*o,stationCount:o,route:[e,t],transfers:[],transferCount:0,routeSummary:`从 ${e.title} 乘坐${n}到 ${t.title}，无需换乘`}}const i=this.findBestTransfer(e,t);return{totalTime:i.totalTime,stationCount:i.stationCount,route:i.route,transfers:i.transfers,transferCount:i.transferCount,routeSummary:i.routeSummary}}findBestTransfer(e,t){const r=this.getStationLines(e),s=this.getStationLines(t);let n=null,i=1/0;for(const o of r)for(const r of s){if(o===r)continue;const s=this.findTransferStations(o,r);for(const a of s){const s=this.calculateTransferRoute(e,a,t,o,r);s.totalTime<i&&(i=s.totalTime,n=s)}}return n||{totalTime:999,stationCount:999,route:[e,t],transfers:[],transferCount:0,routeSummary:`无法找到从 ${e.title} 到 ${t.title} 的路线`}}findTransferStations(e,t){const r=METRO_LINES_DATA[e],s=METRO_LINES_DATA[t];return r.filter(e=>s.includes(e))}calculateTransferRoute(e,t,r,s,n){const i=METRO_LINES_DATA[s],o=METRO_LINES_DATA[n],a=i.indexOf(e.title),l=i.indexOf(t),c=o.indexOf(t),u=o.indexOf(r.title),d=Math.abs(a-l)+Math.abs(u-c);return{totalTime:3*d+5,stationCount:d,route:[e,{...e,title:t},r],transfers:[{station:t,fromLine:s,toLine:n}],transferCount:1,routeSummary:`从 ${e.title} 乘坐${s}，在${t}换乘${n}，到达${r.title}`}}};__publicField(_MetroService,"instance");let MetroService=_MetroService;const _FrontendCommuteCalculationService=class e{constructor(){__publicField(this,"metroService"),__publicField(this,"metroCommuteService"),this.metroService=MetroService.getInstance(),this.metroCommuteService=MetroCommuteService.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateMetroCommuteTime(e,t){try{if(console.log("🚇 [前端计算] 开始计算通勤时间:",e,"→",t),!e||!t)return{success:!1,start_station:e||"",end_station:t||"",total_time_minutes:999,total_time_formatted:"999分钟",stations_count:0,path:[],transfers:[],transfer_count:0,route_summary:"参数错误",error:"起始站和终点站不能为空"};if(e===t)return{success:!0,start_station:e,end_station:t,total_time_minutes:0,total_time_formatted:"0分钟",stations_count:0,path:[e],transfers:[],transfer_count:0,route_summary:"无需移动"};const r=this.metroService.calculateCommute(e,t);if(!r)return{success:!1,start_station:e,end_station:t,total_time_minutes:999,total_time_formatted:"999分钟",stations_count:0,path:[],transfers:[],transfer_count:0,route_summary:"计算失败",error:"无法计算通勤路径"};const s={success:!0,start_station:r.fromStation.title,end_station:r.toStation.title,total_time_minutes:r.commuteTime,total_time_formatted:this.formatTime(r.commuteTime),stations_count:r.stationCount,path:r.route.map(e=>e.title),transfers:r.transfers,transfer_count:r.transferCount,route_summary:r.routeSummary};return console.log("✅ [前端计算] 通勤时间计算成功:",s),s}catch(r){return console.error("❌ [前端计算] 通勤时间计算失败:",r),{success:!1,start_station:e,end_station:t,total_time_minutes:999,total_time_formatted:"999分钟",stations_count:0,path:[],transfers:[],transfer_count:0,route_summary:"计算异常",error:r.message||"未知错误"}}}async batchCalculateCommunityCommuteTimes(e,t,r){var s,n;try{console.log("🚇 [前端批量计算] 开始批量计算通勤时间:",e,"→",t);const{data:o,error:a}=await supabase.from("community_keywords").select("community, metrostation").not("metrostation","is",null);if(a)throw new Error(`获取社区数据失败: ${a.message}`);if(!o||0===o.length)return{success:!0,commute_times:{},calculated_count:0,message:"没有找到社区数据，跳过通勤时间计算"};const l=(null==r?void 0:r.maxCommunities)||20,c=o.slice(0,l);console.log(`📊 [前端批量计算] 共找到 ${o.length} 个社区，限制计算前 ${c.length} 个`);const u={};let d=0;const p=Date.now();for(const t of c)try{null==(s=null==r?void 0:r.onProgress)||s.call(r,d+1,c.length,t.community);const{data:n,error:i}=await supabase.rpc("calculate_metro_commute_time",{p_start_station:e,p_end_station:t.metrostation});if(i?(console.error(`数据库计算${e}到${t.metrostation}通勤时间失败:`,i),u[t.community]=999):n&&n.success?(u[t.community]=n.total_time_minutes,console.log(`✅ [数据库计算] ${e} → ${t.metrostation}: ${n.total_time_minutes}分钟`)):(console.warn(`数据库计算${e}到${t.metrostation}返回失败:`,n),u[t.community]=999),d++,d%5==0){const e=Date.now()-p;console.log(`📊 [前端批量计算] 已计算 ${d}/${c.length} 个社区，耗时: ${e}ms`)}d%10==0&&await new Promise(e=>setTimeout(e,200))}catch(i){console.error(`计算${e}到${t.metrostation}通勤时间失败:`,i),u[t.community]=999,d++}null==(n=null==r?void 0:r.onComplete)||n.call(r,u);const m=Date.now()-p;return console.log("✅ [前端批量计算] 批量计算完成:",{calculatedCount:d,commuteTimesCount:Object.keys(u).length,totalTime:`${m}ms`,averageTime:`${Math.round(m/d)}ms/社区`}),{success:!0,commute_times:u,calculated_count:d,message:"通勤时间计算成功"}}catch(i){return console.error("❌ [前端批量计算] 批量计算失败:",i),{success:!1,commute_times:{},calculated_count:0,error:i.message||"未知错误"}}}async calculateCommuteTimesForWorklocation(e,t,r){try{console.log("🚇 [前端计算] 开始计算工作地点通勤时间:",t,"→",e);const s=await this.batchCalculateCommunityCommuteTimes(t,e,r);return s.success?{success:!0,message:"通勤时间计算成功",commute_times:s.commute_times,communities_count:s.calculated_count}:{success:!1,error:s.error||s.message}}catch(s){return console.error("❌ [前端计算] 工作地点通勤时间计算失败:",s),{success:!1,error:s.message||"未知错误"}}}formatTime(e){if(e<60)return`${e}分钟`;const t=e%60;return`${Math.floor(e/60)}小时${t>0?t+"分钟":""}`}async getMetroStations(){try{const{data:e,error:t}=await supabase.rpc("get_metrostations");return t?(console.error("获取地铁站数据失败:",t),[]):e||[]}catch(e){return console.error("获取地铁站数据异常:",e),[]}}async getCommunities(){try{const{data:e,error:t}=await supabase.from("community_keywords").select("community, metrostation").not("metrostation","is",null);return t?(console.error("获取社区数据失败:",t),[]):e||[]}catch(e){return console.error("获取社区数据异常:",e),[]}}};__publicField(_FrontendCommuteCalculationService,"instance");let FrontendCommuteCalculationService=_FrontendCommuteCalculationService;const{Content:Content$1}=Layout,Followups=()=>{const{profile:e}=useUser();reactExports.useEffect(()=>{(async()=>{if(null==e?void 0:e.id){const t=getServiceManager();await t.initialize(Number(e.id)),t.setUserId(Number(e.id))}})()},[e]),reactExports.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await supabase.from("Selection").select("selection").eq("id",3).single();!t&&e&&e.selection&&v(e.selection.map(e=>({value:e.value,label:e.label})))}catch(e){console.error("获取回退理由选项失败:",e)}})()},[]);const t=useFollowupsData(),r=useFilterManager(),s=useGroupManager(),n=useEnumData(),i=useFrequencyControl(),[o,a]=reactExports.useState(!1);reactExports.useEffect(()=>{a(!1)},[]),reactExports.useEffect(()=>{const e=r.getCurrentFiltersFn();t.refreshData(e)},[]);const[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(null),[p,m]=reactExports.useState(),[h,x]=reactExports.useState([]),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState(!1),[b,w]=reactExports.useState(!1),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState(null),[k,$]=reactExports.useState(!1),[T,I]=reactExports.useState(""),[P,A]=reactExports.useState(!1),F=useAutoSave({maxRetries:3,retryDelay:1e3}),M=useOptimizedLocalData(t.data,{enableOptimisticUpdates:!0}),D=reactExports.useMemo(()=>({maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),[]),O=reactExports.useMemo(()=>{const e=M.data;return Array.isArray(e)?e:(console.warn("⚠️ [Followups] 表格数据不是数组:",e),[])},[M.data]),N=reactExports.useCallback(e=>{r.setKeywordSearch(e);const s=r.getCurrentFiltersFn(),n=e.trim()?{...s,p_keyword:e.trim()}:{...s};e.trim()||delete n.p_keyword,t.refreshData(n)},[r,t]),B=reactExports.useCallback(e=>{r.setKeywordSearch(e)},[r]),L=reactExports.useCallback(()=>{r.setKeywordSearch("");const e={...r.getCurrentFiltersFn()};delete e.p_keyword,t.refreshData(e)},[r,t]),z=reactExports.useCallback(e=>{s.setGroupField(e),a(!0),A(!1);const t=n.getEnumsLoadingStatus(),i="followupstage"===e?"followupstage":"scheduledcommunity"===e?"community":"source"===e?"source":null;if(i&&!t[i]){console.warn(`⚠️ [Followups] 枚举数据 ${i} 尚未加载完成，等待加载完成后再获取分组数据`);const t=()=>{if(n.getEnumsLoadingStatus()[i]){const t=r.getCurrentFiltersFn();s.fetchGroupData(e,t),A(!0)}else setTimeout(t,100)};t()}else{const t=r.getCurrentFiltersFn();s.fetchGroupData(e,t),A(!0)}},[s,n,r,P]),V=reactExports.useCallback(e=>{if(a(e),e&&!P&&s.groupField){const e=r.getCurrentFiltersFn();s.fetchGroupData(s.groupField,e),A(!0)}},[r,s,P]),U=reactExports.useCallback(()=>{const e=r.getCurrentFiltersFn();t.refreshData(e),s.fetchGroupData(s.groupField,e),n.refreshAllEnums(),A(!1),staticMethods.success("数据已刷新")},[r,t,s,n]),H=reactExports.useCallback((e,t)=>{r.removeFilter(e,t)},[r]),W=reactExports.useCallback(()=>{Object.keys(r.filters).length,r.resetAllFilters(),t.resetPagination()},[r,t]),q=reactExports.useCallback(e=>{const n=s.handleGroupClick(e);if((null==n?void 0:n.shouldResetPagination)&&t.resetPagination(),(null==n?void 0:n.newFilters)&&Object.keys(n.newFilters).length>0){r.setFilters(e=>({...e,...n.newFilters}));const e=r.getCurrentFiltersFn();t.fetchFollowups(e,1,t.pagination.pageSize),s.fetchGroupData(s.groupField,e),A(!1)}else{const e=r.getCurrentFiltersFn();t.refreshData(e),s.fetchGroupData(s.groupField,e),A(!1)}},[s,t,r,P]),G=reactExports.useCallback(e=>{r.setQuickDateFilter(e),t.resetPagination()},[r,t]);reactExports.useEffect(()=>{const e=r.getCurrentFiltersFn();A(!1);const n=setTimeout(()=>{t.refreshData(e),s.fetchGroupData(s.groupField,e)},300);return()=>clearTimeout(n)},[r.filters]);const Y=reactExports.useCallback((e,n)=>{if(console.log("🔄 [Followups] 表格变更:",{pagination:e,currentPagination:t.pagination,filters:n}),e.current!==t.pagination.current||e.pageSize!==t.pagination.pageSize){console.log("📄 [Followups] 分页变化:",{from:{current:t.pagination.current,pageSize:t.pagination.pageSize},to:{current:e.current,pageSize:e.pageSize}}),t.syncPaginationState({current:e.current,pageSize:e.pageSize,total:e.total});const s=r.getCurrentFiltersFn();return void t.fetchFollowups(s,e.current,e.pageSize)}if(n&&Object.keys(n).length>0){const e={};Object.entries(n).forEach(([t,r])=>{if(r&&Array.isArray(r)&&r.length>0){if("created_at"===t){if(r.length>=2){const[t,s]=r;t&&s&&(e.p_created_at_start=t,e.p_created_at_end=s)}return void(r.find(e=>e&&"object"==typeof e&&e.notNull)&&(e.p_created_at_not_null=[!0]))}if("moveintime"===t){if(r.length>=2){const[t,s]=r;t&&s&&(e.p_moveintime_start=t,e.p_moveintime_end=s)}return void(r.find(e=>e&&"object"==typeof e&&e.notNull)&&(e.p_moveintime_not_null=[!0]))}if("scheduletime"===t){if(console.log("🔍 [Followups] 处理预约时间筛选器:",{key:t,value:r,valueType:typeof r,isArray:Array.isArray(r)}),r.length>=2){const[t,s]=r;console.log("📅 [Followups] 预约时间范围:",{start:t,end:s,startType:typeof t,endType:typeof s}),t&&s?(e.p_scheduletime_start=t,e.p_scheduletime_end=s,console.log("✅ [Followups] 预约时间范围参数已设置:",{p_scheduletime_start:e.p_scheduletime_start,p_scheduletime_end:e.p_scheduletime_end})):console.log("⚠️ [Followups] 预约时间范围参数无效:",{start:t,end:s})}else console.log("⚠️ [Followups] 预约时间值长度不足:",{length:r.length,value:r});return r.find(e=>e&&"object"==typeof e&&e.notNull)?(e.p_scheduletime_not_null=[!0],console.log("✅ [Followups] 预约时间非空条件已设置:",{p_scheduletime_not_null:e.p_scheduletime_not_null})):console.log("ℹ️ [Followups] 预约时间未选择非空条件"),void console.log("🔍 [Followups] 预约时间筛选器处理完成，rpcFilters:",e)}if("userbudget"===t&&2===r.length){const[t,s]=r;null!=t&&""!==t&&(e.p_userbudget_min=Number(t)),null!=s&&""!==s&&(e.p_userbudget_max=Number(s))}else{e[`p_${t}`]=r}}});["p_followupstage","p_customerprofile","p_userrating","p_scheduledcommunity","p_source"].forEach(t=>{if(e[t]&&Array.isArray(e[t])){const r=e[t].filter(e=>null!=e&&""!==e);r.length>0?e[t]=r:delete e[t]}}),r.setFilters(t=>({...t,...e})),t.resetPagination(),s.syncSelectedGroup(e)}else r.clearTableFilters(),r.setColumnFilters(n)},[t,r,s]),K=reactExports.useMemo(()=>FrontendCommuteCalculationService.getInstance(),[]),X=reactExports.useCallback(async(e,r,s)=>{var n;const i=null==(n=t.data.find(t=>t.id===e.id))?void 0:n[r];if((null!=i?String(i):"")===(null!=s?String(s):""))return void console.log(`🔄 [Followups] 字段 ${String(r)} 值未变化，跳过保存:`,{original:i,new:s});console.log(`💾 [Followups] 开始保存字段 ${String(r)}:`,{recordId:e.id,original:i,new:s,field:String(r)}),M.updateField(e.id,r,s);const o=await F.saveField(e.id,r,s,i);o.success?o.skipped?console.log(`⏭️ [Followups] 字段 ${String(r)} 保存被跳过（值相同）`):(staticMethods.success("保存成功"),console.log(`✅ [Followups] 字段 ${String(r)} 保存成功`),"worklocation"===r&&s&&s!==i&&(console.log("🚀 [Followups] 工作地点更新，自动触发前端通勤时间计算:",{recordId:e.id,oldWorklocation:i,newWorklocation:s}),setTimeout(async()=>{try{const r=await K.calculateCommuteTimesForWorklocation(e.id,s,{maxCommunities:10,onProgress:(e,t,r)=>{console.log(`📊 [Followups] 通勤时间计算进度: ${e}/${t} - ${r}`)},onComplete:async t=>{console.log("✅ [Followups] 前端通勤时间计算完成:",t);const r={...e.extended_data,commute_times:t};try{const{error:t}=await supabase.from("followups").update({extended_data:r}).eq("id",e.id);if(t)return console.error("❌ [Followups] 通勤时间数据保存失败:",t),void staticMethods.error("通勤时间数据保存失败: "+t.message);console.log("✅ [Followups] 通勤时间数据保存成功"),M.updateMultipleFields(e.id,{extended_data:r}),console.log("✅ [Followups] 前端乐观更新完成")}catch(s){console.error("❌ [Followups] 通勤时间数据保存异常:",s),staticMethods.error("通勤时间数据保存失败")}}});if(r.success){if(r.commute_times&&Object.keys(r.commute_times).length>0){const s={...e.extended_data,commute_times:r.commute_times};try{const{error:t}=await supabase.from("followups").update({extended_data:s}).eq("id",e.id);t?(console.error("❌ [Followups] 通勤时间数据保存失败:",t),staticMethods.error("通勤时间数据保存失败: "+t.message)):(console.log("✅ [Followups] 通勤时间数据保存成功"),M.updateMultipleFields(e.id,{extended_data:s}),console.log("✅ [Followups] 前端乐观更新完成"))}catch(t){console.error("❌ [Followups] 通勤时间数据保存异常:",t),staticMethods.error("通勤时间数据保存失败")}}}else console.error("❌ [Followups] 前端通勤时间计算失败:",r.error),staticMethods.error(`通勤时间计算失败: ${r.error}`)}catch(t){console.error("❌ [Followups] 前端通勤时间计算异常:",t),staticMethods.error(`通勤时间计算异常: ${t.message||"未知错误"}`)}},1e3))):(M.rollbackField(e.id,r,i),staticMethods.error("保存失败: "+(o.error||"未知错误")),console.error(`❌ [Followups] 字段 ${String(r)} 保存失败:`,o.error))},[t.data,M,F,K]),J=reactExports.useCallback(e=>{I(e),$(!0)},[]),Z=reactExports.useCallback(e=>{C(e),_(!0)},[]),Q=reactExports.useCallback((e,t)=>{if(console.log("🔄 [Followups] 抽屉保存操作:",{recordId:e.id,updatedFields:t,isAutoSave:t._autoSaveOnClose,isStageChange:t._stageChange}),M.updateMultipleFields(e.id,t),t._stageChange&&t.followupstage){console.log("📊 [Followups] 阶段推进，更新分组统计");const e=r.getCurrentFiltersFn();s.fetchGroupData(s.groupField,e)}console.log("✅ [Followups] 抽屉操作完成，使用乐观更新，跳过全局刷新")},[M,r,s]),ee=reactExports.useCallback(()=>{_(!1),C(null)},[]),te=reactExports.useCallback(e=>{d(e),c(!0)},[]),re=reactExports.useCallback(async e=>(x(t=>[...t,{file:e,preview:URL.createObjectURL(e),name:e.name}]),!1),[]),se=reactExports.useCallback(e=>{e.forEach(e=>{e.preview&&e.preview.startsWith("blob:")&&URL.revokeObjectURL(e.preview)})},[]),ne=reactExports.useCallback(e=>{x(t=>{const r=t.find(t=>t.name===e.name);return(null==r?void 0:r.preview)&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview),t.filter(t=>t.name!==e.name)})},[]),ie=reactExports.useCallback(async()=>{if(p)if(0!==h.length){g(!0);try{const{data:t,error:r}=await supabase.from("approval_instances").select("id, status").eq("type","lead_rollback").eq("target_id",null==u?void 0:u.leadid).in("status",["pending","processing"]);if(r)return g(!1),void staticMethods.error("回退检查失败，请重试");if(t&&t.length>0)return g(!1),void staticMethods.error("该线索已提交回退申请，请勿重复提交");const s=[];for(const e of h){if(e.url){s.push(e.url);continue}const t=await imageCompression(e.file,D),r=t.name.split(".").pop(),n=`rollback/${`rollback-${toBeijingTime(new Date).valueOf()}-${Math.floor(1e4*Math.random())}.${r}`}`,{error:i}=await supabase.storage.from("rollback").upload(n,t);if(i)throw i;const{data:o}=supabase.storage.from("rollback").getPublicUrl(n);s.push(o.publicUrl)}const{data:n,error:i}=await supabase.from("approval_flows").select("id").eq("type","lead_rollback").maybeSingle();if(i||!n)return staticMethods.error("未找到回退审批流模板，请联系管理员配置"),void g(!1);const{error:o}=await supabase.from("approval_instances").insert({flow_id:n.id,type:"lead_rollback",target_table:"leads",target_id:null==u?void 0:u.leadid,status:"pending",created_by:null==e?void 0:e.id,config:{reason:p,evidence:s,leadid:null==u?void 0:u.leadid}});if(o)throw o;staticMethods.success("回退申请已提交，等待审批"),c(!1),se(h),d(null),m(void 0),x([]),U()}catch(e2){staticMethods.error("回退提交失败: "+(e2.message||e2.toString()))}g(!1)}else staticMethods.error("请上传回退证据");else staticMethods.error("请选择回退理由")},[p,h,u,e,se,U,D]);reactExports.useEffect(()=>{if(t.data&&t.data.length>0){const e=setTimeout(()=>{M.syncExternalData(t.data)},300);return()=>clearTimeout(e)}},[t.data,M.syncExternalData]),reactExports.useEffect(()=>()=>{M.cleanup()},[M]);const oe=reactExports.useMemo(()=>({items:[{key:"rollback-list",label:"回退列表",onClick:()=>j(!0)},{key:"calendar-view",label:"入住日历",onClick:()=>w(!0)}]}),[]),ae=reactExports.useCallback(()=>{c(!1),se(h),d(null),m(void 0),x([]),g(!1)},[h,se]);reactExports.useCallback(()=>{c(!1),se(h),d(null),m(void 0),x([]),g(!1)},[h,se]);const le=reactExports.useCallback(()=>{j(!1)},[]),ce=reactExports.useCallback(()=>{w(!1)},[]),ue=reactExports.useMemo(()=>h.map((e,t)=>({uid:t+"",name:e.name,status:"done",url:e.url||e.preview,thumbUrl:e.preview})),[h]),de=reactExports.useMemo(()=>h.length>=5||f,[h.length,f]),pe=reactExports.useMemo(()=>h.length<5&&!f,[h.length,f]),me=reactExports.useMemo(()=>({interviewsalesUserList:[],interviewsalesUserLoading:!1}),[]);return jsxRuntimeExports.jsxs("div",{className:"followups-page-card",children:[jsxRuntimeExports.jsx(PageHeader,{title:"跟进记录",keywordSearch:r.keywordSearch,groupField:s.groupField,groupFieldOptions:n.groupFieldOptions,onKeywordSearch:N,onKeywordChange:B,onKeywordClear:L,onGroupFieldChange:z,onRefresh:U,onGroupPanelToggle:V,groupPanelOpen:o,rollbackMenu:oe}),jsxRuntimeExports.jsx(FrequencyAlert,{cooldown:i.cooldown}),jsxRuntimeExports.jsx(FilterPanel,{filters:r.filters,onFilterRemove:H,onFilterReset:W}),jsxRuntimeExports.jsxs("div",{className:"followups-main-content",children:[jsxRuntimeExports.jsx("div",{className:"followups-sidebar "+(o?"":"closed"),children:jsxRuntimeExports.jsx(GroupPanel,{groupPanelOpen:o,groupTotal:s.groupTotal,groupData:s.groupData,selectedGroup:s.selectedGroup,quickDateKey:r.quickDateKey,onGroupClick:q,onQuickDateChange:G})}),jsxRuntimeExports.jsx("div",{className:"followups-table-area",children:jsxRuntimeExports.jsx(FollowupsTable,{data:O,loading:t.loading,pagination:t.pagination,columnFilters:r.columnFilters,communityEnum:n.communityEnum,followupstageEnum:n.followupstageEnum,customerprofileEnum:n.customerprofileEnum,sourceEnum:n.sourceEnum,userratingEnum:n.userratingEnum,majorCategoryOptions:n.majorCategoryOptions,metroStationOptions:n.metroStationOptions,onTableChange:Y,onRowEdit:X,onLeadDetailClick:J,onStageClick:Z,onRollbackClick:te,isFieldDisabled:i.isFieldDisabled,forceUpdate:t.forceUpdate,leadtypeFilters:n.leadtypeFilters,remarkFilters:n.remarkFilters,worklocationFilters:n.worklocationFilters,followupresultFilters:n.followupresultFilters,majorcategoryFilters:n.majorcategoryFilters,scheduledcommunityFilters:n.scheduledcommunityFilters,interviewsalesUserList:me.interviewsalesUserList,interviewsalesUserLoading:me.interviewsalesUserLoading,findCascaderPath:n.findCascaderPath})})]}),jsxRuntimeExports.jsx(Modal$2,{open:l,title:"回退操作",onCancel:ae,destroyOnHidden:!0,centered:!0,width:500,footer:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{onClick:ae,children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:f,onClick:ie,children:"确认回退"})]}),children:jsxRuntimeExports.jsxs(Form$4,{layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"回退理由",required:!0,children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择回退理由",options:y,value:p,onChange:m,allowClear:!0})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"回退证据（图片，最多5张）",required:!0,children:jsxRuntimeExports.jsx(Upload,{listType:"picture-card",fileList:ue,customRequest:()=>{},beforeUpload:re,onRemove:ne,showUploadList:{showRemoveIcon:!0},multiple:!0,accept:"image/*",disabled:de,children:pe&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(RefIcon$f,{}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:"上传"})]})})})]})}),jsxRuntimeExports.jsx(Modal$2,{open:E,title:"回退申请列表",onCancel:le,footer:null,width:900,destroyOnHidden:!0,centered:!0,styles:{body:{padding:"0",background:"#fff"}},children:jsxRuntimeExports.jsx(RollbackList,{})}),jsxRuntimeExports.jsx(Modal$2,{open:b,title:"入住日历视图",onCancel:ce,footer:null,width:"95vw",style:{top:20},styles:{body:{padding:"24px",maxHeight:"85vh",overflow:"auto"}},destroyOnHidden:!0,children:jsxRuntimeExports.jsx(FollowupsCalendarView,{})}),jsxRuntimeExports.jsx(Drawer,{open:k,onClose:()=>{$(!1),I("")},title:"线索详情",width:800,destroyOnHidden:!0,placement:"right",children:T&&jsxRuntimeExports.jsx(LeadDetailDrawer,{leadid:T})}),jsxRuntimeExports.jsx(FollowupStageDrawer,{open:R,onClose:ee,record:S,onSave:Q,isFieldDisabled:i.isFieldDisabled,forceUpdate:t.forceUpdate,communityEnum:n.communityEnum,followupstageEnum:n.followupstageEnum,customerprofileEnum:n.customerprofileEnum,userratingEnum:n.userratingEnum,majorCategoryOptions:n.majorCategoryOptions,metroStationOptions:n.metroStationOptions})]})},_WecomAuthManager=class e{constructor(){}static getInstance(){return e.instance||(e.instance=new e),e.instance}async signInWithWecom(e){var t;try{if(console.log("开始企业微信登录（JWT令牌）:",e),!e.session)return console.error("❌ 缺少会话信息"),{data:null,error:new Error("缺少会话信息")};if(e.session.access_token&&e.session.refresh_token){console.log("🔄 使用后端返回的JWT令牌设置会话..."),console.log("🔑 令牌类型:",e.session.token_type);try{const{data:r,error:s}=await supabase.auth.setSession({access_token:e.session.access_token,refresh_token:e.session.refresh_token});return s?(console.error("❌ 设置会话失败:",s),{data:null,error:s}):(console.log("✅ 企业微信会话设置成功"),console.log("👤 会话用户:",null==(t=r.user)?void 0:t.email),console.log("🔑 会话类型:",e.session.token_type),{data:{user:e,session:r.session},error:null})}catch(r){return console.error("❌ 设置会话异常:",r),{data:null,error:r}}}return console.error("❌ 缺少有效的会话令牌:",e.session),{data:null,error:new Error("缺少有效的会话令牌")}}catch(r){return console.error("企业微信登录异常:",r),{data:null,error:r}}}};__publicField(_WecomAuthManager,"instance");let WecomAuthManager=_WecomAuthManager;const wecomAuthManager=WecomAuthManager.getInstance(),useAuth=()=>{const{user:e,loading:t,refreshUser:r}=useUser(),[s,n]=reactExports.useState(null),i=reactExports.useRef(!1),o=reactExports.useCallback(async()=>{try{n(null);const e=await tokenManager.checkAuthStatus();return e.isValid||n(e.error||"认证失败"),e}catch(e){console.error("useAuth - 认证检查失败:",e);const t=e instanceof Error?e.message:"认证检查异常";return n(t),{isValid:!1,error:t}}},[]),a=reactExports.useCallback(async(e,t,s)=>{try{if(n(null),s&&s.wechat_work_userid){console.log("企业微信登录:",{email:e,metadata:s});const{data:t,error:o}=await wecomAuthManager.signInWithWecom(s);if(o){const e=o instanceof Error?o.message:"企业微信登录失败";return n(e),{success:!1,error:e}}if(null==t?void 0:t.user){try{await r()}catch(i){console.error("企业微信登录成功后刷新用户状态失败:",i)}return{success:!0}}return n("企业微信登录响应异常"),{success:!1,error:"企业微信登录响应异常"}}{const{data:s,error:o}=await tokenManager.signInWithPassword(e,t);if(o){const e=o instanceof Error?o.message:"登录失败";return n(e),{success:!1,error:e}}if(null==s?void 0:s.user){try{await r()}catch(i){console.error("登录成功后刷新用户状态失败:",i)}return{success:!0}}return n("登录响应异常"),{success:!1,error:"登录响应异常"}}}catch(o){console.error("useAuth - 登录异常:",o);const e=o instanceof Error?o.message:"登录异常";return n(e),{success:!1,error:e}}},[]),l=reactExports.useCallback(async e=>{try{await tokenManager.logout(e),n(null)}catch(t){console.error("useAuth - 登出失败:",t),n(t instanceof Error?t.message:"登出失败")}},[]),c=reactExports.useCallback(async()=>{try{await r(),await o()}catch(e){console.error("useAuth - 刷新认证状态失败:",e)}},[r,o]);reactExports.useEffect(()=>{i.current||(i.current=!0,o())},[o]);return{isAuthenticated:!!e,isLoading:t,user:e,error:s,login:a,logout:l,checkAuth:o,refreshAuth:c}},LOG_LEVELS={DEBUG:0,INFO:1,WARN:2,ERROR:3};class Logger{constructor(){__publicField(this,"level"),__publicField(this,"isProduction"),this.isProduction=!0,this.level=(this.isProduction,LOG_LEVELS.DEBUG)}shouldLog(e){return e>=this.level}formatMessage(e,t,...r){return`${`[${(new Date).toISOString()}] [${e}]`} ${t}`}debug(e,...t){this.shouldLog(LOG_LEVELS.DEBUG)&&console.log(this.formatMessage("DEBUG",e),...t)}info(e,...t){this.shouldLog(LOG_LEVELS.INFO)&&console.info(this.formatMessage("INFO",e),...t)}warn(e,...t){this.shouldLog(LOG_LEVELS.WARN)&&console.warn(this.formatMessage("WARN",e),...t)}error(e,...t){this.shouldLog(LOG_LEVELS.ERROR)&&console.error(this.formatMessage("ERROR",e),...t)}wecom(e,...t){this.info(`[企业微信] ${e}`,...t)}api(e,...t){this.info(`[API] ${e}`,...t)}qr(e,...t){this.info(`[二维码] ${e}`,...t)}}const logger=new Logger,handleWecomCallbackPost=async e=>{try{const t="https://lead.vld.com.cn/api";console.log("发送POST请求到后端:",`${t}/auth/wecom/callback`),console.log("请求数据:",e);const r=await fetch(`${t}/auth/wecom/callback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("后端响应状态:",r.status,r.statusText),!r.ok){const e=await r.text();throw console.error("后端响应错误:",e),new Error(`HTTP error! status: ${r.status}, message: ${e}`)}const s=await r.json();return console.log("后端响应数据:",s),s}catch(t){return console.error("处理企业微信回调失败:",t),{success:!1,error:t instanceof Error?t.message:"处理回调失败"}}},getWecomQRCode=async()=>{var e;try{const t="https://lead.vld.com.cn/api",r=`${t}/auth/wecom/qrcode`;console.log("🌐 请求企业微信二维码API:",r),console.log("🔗 API基础URL:",t),logger.api("请求企业微信二维码API:",r),logger.api("API基础URL:",t);const s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(logger.api("API响应状态:",s.status,s.statusText),!s.ok){const e=await s.text();throw logger.error("API响应错误:",e),new Error(`HTTP error! status: ${s.status}, message: ${e}`)}const n=await s.json();return console.log("📡 API响应数据:",n),logger.api("API响应数据:",n),n.success&&(null==(e=n.data)?void 0:e.sessionId)&&(localStorage.setItem("wecom_session_id",n.data.sessionId),console.log("💾 保存会话ID到localStorage:",n.data.sessionId)),n}catch(t){return logger.error("获取企业微信二维码失败:",t),{success:!1,error:t instanceof Error?t.message:"获取二维码失败"}}};var browser={},canPromise$1=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$1={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$1.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},utils$1.getSymbolTotalCodewords=function(e){return CODEWORDS_COUNT[e]},utils$1.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},utils$1.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=e},utils$1.isKanjiModeEnabled=function(){return void 0!==toSJISFunction},utils$1.toSJIS=function(e){return toSJISFunction(e)};var errorCorrectionLevel={},exports2;function BitBuffer$1(){this.buffer=[],this.length=0}exports2=errorCorrectionLevel,exports2.L={bit:1},exports2.M={bit:0},exports2.Q={bit:3},exports2.H={bit:2},exports2.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},exports2.from=function(e,t){if(exports2.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return exports2.L;case"m":case"medium":return exports2.M;case"q":case"quartile":return exports2.Q;case"h":case"high":return exports2.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(e2){return t}},BitBuffer$1.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}BitMatrix$1.prototype.set=function(e,t,r,s){const n=e*this.size+t;this.data[n]=r,s&&(this.reservedBit[n]=!0)},BitMatrix$1.prototype.get=function(e,t){return this.data[e*this.size+t]},BitMatrix$1.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},BitMatrix$1.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var bitMatrix=BitMatrix$1,alignmentPattern={};!function(e){const t=utils$1.getSymbolSize;e.getRowColCoords=function(e){if(1===e)return[];const r=Math.floor(e/7)+2,s=t(e),n=145===s?26:2*Math.ceil((s-13)/(2*r-2)),i=[s-7];for(let t=1;t<r-1;t++)i[t]=i[t-1]-n;return i.push(6),i.reverse()},e.getPositions=function(t){const r=[],s=e.getRowColCoords(t),n=s.length;for(let e=0;e<n;e++)for(let t=0;t<n;t++)0===e&&0===t||0===e&&t===n-1||e===n-1&&0===t||r.push([s[e],s[t]]);return r}}(alignmentPattern);var finderPattern={};const getSymbolSize=utils$1.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function(e){const t=getSymbolSize(e);return[[0,0],[t-FINDER_PATTERN_SIZE,0],[0,t-FINDER_PATTERN_SIZE]]};var maskPattern={};!function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t=3,r=3,s=40,n=10;function i(t,r,s){switch(t){case e.Patterns.PATTERN000:return(r+s)%2==0;case e.Patterns.PATTERN001:return r%2==0;case e.Patterns.PATTERN010:return s%3==0;case e.Patterns.PATTERN011:return(r+s)%3==0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(s/3))%2==0;case e.Patterns.PATTERN101:return r*s%2+r*s%3==0;case e.Patterns.PATTERN110:return(r*s%2+r*s%3)%2==0;case e.Patterns.PATTERN111:return(r*s%3+(r+s)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){const r=e.size;let s=0,n=0,i=0,o=null,a=null;for(let l=0;l<r;l++){n=i=0,o=a=null;for(let c=0;c<r;c++){let r=e.get(l,c);r===o?n++:(n>=5&&(s+=t+(n-5)),o=r,n=1),r=e.get(c,l),r===a?i++:(i>=5&&(s+=t+(i-5)),a=r,i=1)}n>=5&&(s+=t+(n-5)),i>=5&&(s+=t+(i-5))}return s},e.getPenaltyN2=function(e){const t=e.size;let s=0;for(let r=0;r<t-1;r++)for(let n=0;n<t-1;n++){const t=e.get(r,n)+e.get(r,n+1)+e.get(r+1,n)+e.get(r+1,n+1);4!==t&&0!==t||s++}return s*r},e.getPenaltyN3=function(e){const t=e.size;let r=0,n=0,i=0;for(let s=0;s<t;s++){n=i=0;for(let o=0;o<t;o++)n=n<<1&2047|e.get(s,o),o>=10&&(1488===n||93===n)&&r++,i=i<<1&2047|e.get(o,s),o>=10&&(1488===i||93===i)&&r++}return r*s},e.getPenaltyN4=function(e){let t=0;const r=e.data.length;for(let s=0;s<r;s++)t+=e.data[s];return Math.abs(Math.ceil(100*t/r/5)-10)*n},e.applyMask=function(e,t){const r=t.size;for(let s=0;s<r;s++)for(let n=0;n<r;n++)t.isReserved(n,s)||t.xor(n,s,i(e,n,s))},e.getBestMask=function(t,r){const s=Object.keys(e.Patterns).length;let n=0,i=1/0;for(let o=0;o<s;o++){r(o),e.applyMask(o,t);const s=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(o,t),s<i&&(i=s,n=o)}return n}}(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function(e,t){switch(t){case ECLevel$1.L:return EC_BLOCKS_TABLE[4*(e-1)+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[4*(e-1)+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[4*(e-1)+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[4*(e-1)+3];default:return}},errorCorrectionCode.getTotalCodewordsCount=function(e,t){switch(t){case ECLevel$1.L:return EC_CODEWORDS_TABLE[4*(e-1)+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[4*(e-1)+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[4*(e-1)+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[4*(e-1)+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)EXP_TABLE[t]=e,LOG_TABLE[e]=t,e<<=1,256&e&&(e^=285);for(let t=255;t<512;t++)EXP_TABLE[t]=EXP_TABLE[t-255]}(),galoisField.log=function(e){if(e<1)throw new Error("log("+e+")");return LOG_TABLE[e]},galoisField.exp=function(e){return EXP_TABLE[e]},galoisField.mul=function(e,t){return 0===e||0===t?0:EXP_TABLE[LOG_TABLE[e]+LOG_TABLE[t]]},function(e){const t=galoisField;e.mul=function(e,r){const s=new Uint8Array(e.length+r.length-1);for(let n=0;n<e.length;n++)for(let i=0;i<r.length;i++)s[n+i]^=t.mul(e[n],r[i]);return s},e.mod=function(e,r){let s=new Uint8Array(e);for(;s.length-r.length>=0;){const e=s[0];for(let i=0;i<r.length;i++)s[i]^=t.mul(r[i],e);let n=0;for(;n<s.length&&0===s[n];)n++;s=s.slice(n)}return s},e.generateECPolynomial=function(r){let s=new Uint8Array([1]);for(let n=0;n<r;n++)s=e.mul(s,new Uint8Array([1,t.exp(n)]));return s}}(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function(e){this.degree=e,this.genPoly=Polynomial.generateECPolynomial(this.degree)},ReedSolomonEncoder$1.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const r=Polynomial.mod(t,this.genPoly),s=this.degree-r.length;if(s>0){const e=new Uint8Array(this.degree);return e.set(r,s),e}return r};var reedSolomonEncoder=ReedSolomonEncoder$1,version$1={},mode={},versionCheck={isValid:function(e){return!isNaN(e)&&e>=1&&e<=40}},regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+")(?:.|[\r\n]))+";regex.KANJI=new RegExp(kanji,"g"),regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),regex.BYTE=new RegExp(byte,"g"),regex.NUMERIC=new RegExp(numeric,"g"),regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function(e){return TEST_KANJI.test(e)},regex.testNumeric=function(e){return TEST_NUMERIC.test(e)},regex.testAlphanumeric=function(e){return TEST_ALPHANUMERIC.test(e)},function(e){const t=versionCheck,r=regex;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,r){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!t.isValid(r))throw new Error("Invalid version: "+r);return r>=1&&r<10?e.ccBits[0]:r<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return r.testNumeric(t)?e.NUMERIC:r.testAlphanumeric(t)?e.ALPHANUMERIC:r.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},e.isValid=function(e){return e&&e.bit&&e.ccBits},e.from=function(t,r){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch(e2){return r}}}(mode),function(e){const t=utils$1,r=errorCorrectionCode,s=errorCorrectionLevel,n=mode,i=versionCheck,o=t.getBCHDigit(7973);function a(e,t){return n.getCharCountIndicator(e,t)+4}function l(e,t){let r=0;return e.forEach(function(e){const s=a(e.mode,t);r+=s+e.getBitsLength()}),r}e.from=function(e,t){return i.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,s,o){if(!i.isValid(e))throw new Error("Invalid QR Code version");void 0===o&&(o=n.BYTE);const l=8*(t.getSymbolTotalCodewords(e)-r.getTotalCodewordsCount(e,s));if(o===n.MIXED)return l;const c=l-a(o,e);switch(o){case n.NUMERIC:return Math.floor(c/10*3);case n.ALPHANUMERIC:return Math.floor(c/11*2);case n.KANJI:return Math.floor(c/13);case n.BYTE:default:return Math.floor(c/8)}},e.getBestVersionForData=function(t,r){let i;const o=s.from(r,s.M);if(Array.isArray(t)){if(t.length>1)return function(t,r){for(let s=1;s<=40;s++)if(l(t,s)<=e.getCapacity(s,r,n.MIXED))return s}(t,o);if(0===t.length)return 1;i=t[0]}else i=t;return function(t,r,s){for(let n=1;n<=40;n++)if(r<=e.getCapacity(n,s,t))return n}(i.mode,i.getLength(),o)},e.getEncodedBits=function(e){if(!i.isValid(e)||e<7)throw new Error("Invalid QR Code version");let r=e<<12;for(;t.getBCHDigit(r)-o>=0;)r^=7973<<t.getBCHDigit(r)-o;return e<<12|r}}(version$1);var formatInfo={};const Utils$3=utils$1,G15=1335,G15_MASK=21522,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function(e,t){const r=e.bit<<3|t;let s=r<<10;for(;Utils$3.getBCHDigit(s)-G15_BCH>=0;)s^=G15<<Utils$3.getBCHDigit(s)-G15_BCH;return(r<<10|s)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(e){this.mode=Mode$4.NUMERIC,this.data=e.toString()}NumericData.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},NumericData.prototype.getLength=function(){return this.data.length},NumericData.prototype.getBitsLength=function(){return NumericData.getBitsLength(this.data.length)},NumericData.prototype.write=function(e){let t,r,s;for(t=0;t+3<=this.data.length;t+=3)r=this.data.substr(t,3),s=parseInt(r,10),e.put(s,10);const n=this.data.length-t;n>0&&(r=this.data.substr(t),s=parseInt(r,10),e.put(s,3*n+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(e){this.mode=Mode$3.ALPHANUMERIC,this.data=e}AlphanumericData.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},AlphanumericData.prototype.getLength=function(){return this.data.length},AlphanumericData.prototype.getBitsLength=function(){return AlphanumericData.getBitsLength(this.data.length)},AlphanumericData.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let r=45*ALPHA_NUM_CHARS.indexOf(this.data[t]);r+=ALPHA_NUM_CHARS.indexOf(this.data[t+1]),e.put(r,11)}this.data.length%2&&e.put(ALPHA_NUM_CHARS.indexOf(this.data[t]),6)};var alphanumericData=AlphanumericData;const Mode$2=mode;function ByteData(e){this.mode=Mode$2.BYTE,this.data="string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}ByteData.getBitsLength=function(e){return 8*e},ByteData.prototype.getLength=function(){return this.data.length},ByteData.prototype.getBitsLength=function(){return ByteData.getBitsLength(this.data.length)},ByteData.prototype.write=function(e){for(let t=0,r=this.data.length;t<r;t++)e.put(this.data[t],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$1;function KanjiData(e){this.mode=Mode$1.KANJI,this.data=e}KanjiData.getBitsLength=function(e){return 13*e},KanjiData.prototype.getLength=function(){return this.data.length},KanjiData.prototype.getBitsLength=function(){return KanjiData.getBitsLength(this.data.length)},KanjiData.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let r=Utils$2.toSJIS(this.data[t]);if(r>=33088&&r<=40956)r-=33088;else{if(!(r>=57408&&r<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13)}};var kanjiData=KanjiData,dijkstra={exports:{}},dijkstra2;dijkstra2={single_source_shortest_paths:function(e,t,r){var s={},n={};n[t]=0;var i,o,a,l,c,u,d,p=dijkstra2.PriorityQueue.make();for(p.push(t,0);!p.empty();)for(a in o=(i=p.pop()).value,l=i.cost,c=e[o]||{})c.hasOwnProperty(a)&&(u=l+c[a],d=n[a],(void 0===n[a]||d>u)&&(n[a]=u,p.push(a,u),s[a]=o));if(void 0!==r&&void 0===n[r]){var m=["Could not find a path from ",t," to ",r,"."].join("");throw new Error(m)}return s},extract_shortest_path_from_predecessor_list:function(e,t){for(var r=[],s=t;s;)r.push(s),e[s],s=e[s];return r.reverse(),r},find_path:function(e,t,r){var s=dijkstra2.single_source_shortest_paths(e,t,r);return dijkstra2.extract_shortest_path_from_predecessor_list(s,r)},PriorityQueue:{make:function(e){var t,r=dijkstra2.PriorityQueue,s={};for(t in e=e||{},r)r.hasOwnProperty(t)&&(s[t]=r[t]);return s.queue=[],s.sorter=e.sorter||r.default_sorter,s},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var r={value:e,cost:t};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}},dijkstra.exports=dijkstra2;var dijkstraExports=dijkstra.exports;!function(e){const t=mode,r=numericData,s=alphanumericData,n=byteData,i=kanjiData,o=regex,a=utils$1,l=dijkstraExports;function c(e){return unescape(encodeURIComponent(e)).length}function u(e,t,r){const s=[];let n;for(;null!==(n=e.exec(r));)s.push({data:n[0],index:n.index,mode:t,length:n[0].length});return s}function d(e){const r=u(o.NUMERIC,t.NUMERIC,e),s=u(o.ALPHANUMERIC,t.ALPHANUMERIC,e);let n,i;a.isKanjiModeEnabled()?(n=u(o.BYTE,t.BYTE,e),i=u(o.KANJI,t.KANJI,e)):(n=u(o.BYTE_KANJI,t.BYTE,e),i=[]);return r.concat(s,n,i).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function p(e,o){switch(o){case t.NUMERIC:return r.getBitsLength(e);case t.ALPHANUMERIC:return s.getBitsLength(e);case t.KANJI:return i.getBitsLength(e);case t.BYTE:return n.getBitsLength(e)}}function m(e,o){let l;const c=t.getBestModeForData(e);if(l=t.from(o,c),l!==t.BYTE&&l.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+t.toString(l)+".\n Suggested mode is: "+t.toString(c));switch(l!==t.KANJI||a.isKanjiModeEnabled()||(l=t.BYTE),l){case t.NUMERIC:return new r(e);case t.ALPHANUMERIC:return new s(e);case t.KANJI:return new i(e);case t.BYTE:return new n(e)}}e.fromArray=function(e){return e.reduce(function(e,t){return"string"==typeof t?e.push(m(t,null)):t.data&&e.push(m(t.data,t.mode)),e},[])},e.fromString=function(r,s){const n=function(e){const r=[];for(let s=0;s<e.length;s++){const n=e[s];switch(n.mode){case t.NUMERIC:r.push([n,{data:n.data,mode:t.ALPHANUMERIC,length:n.length},{data:n.data,mode:t.BYTE,length:n.length}]);break;case t.ALPHANUMERIC:r.push([n,{data:n.data,mode:t.BYTE,length:n.length}]);break;case t.KANJI:r.push([n,{data:n.data,mode:t.BYTE,length:c(n.data)}]);break;case t.BYTE:r.push([{data:n.data,mode:t.BYTE,length:c(n.data)}])}}return r}(d(r,a.isKanjiModeEnabled())),i=function(e,r){const s={},n={start:{}};let i=["start"];for(let o=0;o<e.length;o++){const a=e[o],l=[];for(let e=0;e<a.length;e++){const c=a[e],u=""+o+e;l.push(u),s[u]={node:c,lastCount:0},n[u]={};for(let e=0;e<i.length;e++){const o=i[e];s[o]&&s[o].node.mode===c.mode?(n[o][u]=p(s[o].lastCount+c.length,c.mode)-p(s[o].lastCount,c.mode),s[o].lastCount+=c.length):(s[o]&&(s[o].lastCount=c.length),n[o][u]=p(c.length,c.mode)+4+t.getCharCountIndicator(c.mode,r))}}i=l}for(let t=0;t<i.length;t++)n[i[t]].end=0;return{map:n,table:s}}(n,s),o=l.find_path(i.map,"start","end"),u=[];for(let e=1;e<o.length-1;e++)u.push(i.table[o[e]].node);return e.fromArray(function(e){return e.reduce(function(e,t){const r=e.length-1>=0?e[e.length-1]:null;return r&&r.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}(u))},e.rawSplit=function(t){return e.fromArray(d(t,a.isKanjiModeEnabled()))}}(segments);const Utils$1=utils$1,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version$1,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(e,t){const r=e.size,s=FinderPattern.getPositions(t);for(let n=0;n<s.length;n++){const t=s[n][0],i=s[n][1];for(let s=-1;s<=7;s++)if(!(t+s<=-1||r<=t+s))for(let n=-1;n<=7;n++)i+n<=-1||r<=i+n||(s>=0&&s<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===s||6===s)||s>=2&&s<=4&&n>=2&&n<=4?e.set(t+s,i+n,!0,!0):e.set(t+s,i+n,!1,!0))}}function setupTimingPattern(e){const t=e.size;for(let r=8;r<t-8;r++){const t=r%2==0;e.set(r,6,t,!0),e.set(6,r,t,!0)}}function setupAlignmentPattern(e,t){const r=AlignmentPattern.getPositions(t);for(let s=0;s<r.length;s++){const t=r[s][0],n=r[s][1];for(let r=-2;r<=2;r++)for(let s=-2;s<=2;s++)-2===r||2===r||-2===s||2===s||0===r&&0===s?e.set(t+r,n+s,!0,!0):e.set(t+r,n+s,!1,!0)}}function setupVersionInfo(e,t){const r=e.size,s=Version.getEncodedBits(t);let n,i,o;for(let a=0;a<18;a++)n=Math.floor(a/3),i=a%3+r-8-3,o=1==(s>>a&1),e.set(n,i,o,!0),e.set(i,n,o,!0)}function setupFormatInfo(e,t,r){const s=e.size,n=FormatInfo.getEncodedBits(t,r);let i,o;for(i=0;i<15;i++)o=1==(n>>i&1),i<6?e.set(i,8,o,!0):i<8?e.set(i+1,8,o,!0):e.set(s-15+i,8,o,!0),i<8?e.set(8,s-i-1,o,!0):i<9?e.set(8,15-i-1+1,o,!0):e.set(8,15-i-1,o,!0);e.set(s-8,8,1,!0)}function setupData(e,t){const r=e.size;let s=-1,n=r-1,i=7,o=0;for(let a=r-1;a>0;a-=2)for(6===a&&a--;;){for(let r=0;r<2;r++)if(!e.isReserved(n,a-r)){let s=!1;o<t.length&&(s=1==(t[o]>>>i&1)),e.set(n,a-r,s),i--,-1===i&&(o++,i=7)}if(n+=s,n<0||r<=n){n-=s,s=-s;break}}}function createData(e,t,r){const s=new BitBuffer;r.forEach(function(t){s.put(t.mode.bit,4),s.put(t.getLength(),Mode.getCharCountIndicator(t.mode,e)),t.write(s)});const n=8*(Utils$1.getSymbolTotalCodewords(e)-ECCode.getTotalCodewordsCount(e,t));for(s.getLengthInBits()+4<=n&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(0);const i=(n-s.getLengthInBits())/8;for(let o=0;o<i;o++)s.put(o%2?17:236,8);return createCodewords(s,e,t)}function createCodewords(e,t,r){const s=Utils$1.getSymbolTotalCodewords(t),n=s-ECCode.getTotalCodewordsCount(t,r),i=ECCode.getBlocksCount(t,r),o=i-s%i,a=Math.floor(s/i),l=Math.floor(n/i),c=l+1,u=a-l,d=new ReedSolomonEncoder(u);let p=0;const m=new Array(i),h=new Array(i);let x=0;const f=new Uint8Array(e.buffer);for(let j=0;j<i;j++){const e=j<o?l:c;m[j]=f.slice(p,p+e),h[j]=d.encode(m[j]),p+=e,x=Math.max(x,e)}const g=new Uint8Array(s);let y,v,E=0;for(y=0;y<x;y++)for(v=0;v<i;v++)y<m[v].length&&(g[E++]=m[v][y]);for(y=0;y<u;y++)for(v=0;v<i;v++)g[E++]=h[v][y];return g}function createSymbol(e,t,r,s){let n;if(Array.isArray(e))n=Segments.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let s=t;if(!s){const t=Segments.rawSplit(e);s=Version.getBestVersionForData(t,r)}n=Segments.fromString(e,s||40)}}const i=Version.getBestVersionForData(n,r);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<i)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+i+".\n")}else t=i;const o=createData(t,r,n),a=Utils$1.getSymbolSize(t),l=new BitMatrix(a);return setupFinderPattern(l,t),setupTimingPattern(l),setupAlignmentPattern(l,t),setupFormatInfo(l,r,0),t>=7&&setupVersionInfo(l,t),setupData(l,o),isNaN(s)&&(s=MaskPattern.getBestMask(l,setupFormatInfo.bind(null,l,r))),MaskPattern.applyMask(s,l),setupFormatInfo(l,r,s),{modules:l,version:t,errorCorrectionLevel:r,maskPattern:s,segments:n}}qrcode.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let r,s,n=ECLevel.M;return void 0!==t&&(n=ECLevel.from(t.errorCorrectionLevel,ECLevel.M),r=Version.from(t.version),s=MaskPattern.from(t.maskPattern),t.toSJISFunc&&Utils$1.setToSJISFunction(t.toSJISFunc)),createSymbol(e,r,n,s)};var canvas={},utils={};!function(e){function t(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const r=parseInt(t.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:255&r,hex:"#"+t.slice(0,6).join("")}}e.getOptions=function(e){e||(e={}),e.color||(e.color={});const r=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,s=e.width&&e.width>=21?e.width:void 0,n=e.scale||4;return{width:s,scale:s?4:n,margin:r,color:{dark:t(e.color.dark||"#000000ff"),light:t(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},e.getImageWidth=function(t,r){const s=e.getScale(t,r);return Math.floor((t+2*r.margin)*s)},e.qrToImageData=function(t,r,s){const n=r.modules.size,i=r.modules.data,o=e.getScale(n,s),a=Math.floor((n+2*s.margin)*o),l=s.margin*o,c=[s.color.light,s.color.dark];for(let e=0;e<a;e++)for(let r=0;r<a;r++){let u=4*(e*a+r),d=s.color.light;if(e>=l&&r>=l&&e<a-l&&r<a-l){d=c[i[Math.floor((e-l)/o)*n+Math.floor((r-l)/o)]?1:0]}t[u++]=d.r,t[u++]=d.g,t[u++]=d.b,t[u]=d.a}}}(utils),function(e){const t=utils;e.render=function(e,r,s){let n=s,i=r;void 0!==n||r&&r.getContext||(n=r,r=void 0),r||(i=function(){try{return document.createElement("canvas")}catch(e2){throw new Error("You need to specify a canvas element")}}()),n=t.getOptions(n);const o=t.getImageWidth(e.modules.size,n),a=i.getContext("2d"),l=a.createImageData(o,o);return t.qrToImageData(l.data,e,n),function(e,t,r){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=r,t.width=r,t.style.height=r+"px",t.style.width=r+"px"}(a,i,o),a.putImageData(l,0,0),i},e.renderToDataURL=function(t,r,s){let n=s;void 0!==n||r&&r.getContext||(n=r,r=void 0),n||(n={});const i=e.render(t,r,n),o=n.type||"image/png",a=n.rendererOpts||{};return i.toDataURL(o,a.quality)}}(canvas);var svgTag={};const Utils=utils;function getColorAttrib(e,t){const r=e.a/255,s=t+'="'+e.hex+'"';return r<1?s+" "+t+'-opacity="'+r.toFixed(2).slice(1)+'"':s}function svgCmd(e,t,r){let s=e+t;return void 0!==r&&(s+=" "+r),s}function qrToPath(e,t,r){let s="",n=0,i=!1,o=0;for(let a=0;a<e.length;a++){const l=Math.floor(a%t),c=Math.floor(a/t);l||i||(i=!0),e[a]?(o++,a>0&&l>0&&e[a-1]||(s+=i?svgCmd("M",l+r,.5+c+r):svgCmd("m",n,0),n=0,i=!1),l+1<t&&e[a+1]||(s+=svgCmd("h",o),o=0)):n++}return s}svgTag.render=function(e,t,r){const s=Utils.getOptions(t),n=e.modules.size,i=e.modules.data,o=n+2*s.margin,a=s.color.light.a?"<path "+getColorAttrib(s.color.light,"fill")+' d="M0 0h'+o+"v"+o+'H0z"/>':"",l="<path "+getColorAttrib(s.color.dark,"stroke")+' d="'+qrToPath(i,n,s.margin)+'"/>',c='viewBox="0 0 '+o+" "+o+'"',u='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+c+' shape-rendering="crispEdges">'+a+l+"</svg>\n";return"function"==typeof r&&r(null,u),u};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer=canvas,SvgRenderer=svgTag;function renderCanvas(e,t,r,s,n){const i=[].slice.call(arguments,1),o=i.length,a="function"==typeof i[o-1];if(!a&&!canPromise())throw new Error("Callback required as last argument");if(!a){if(o<1)throw new Error("Too few arguments provided");return 1===o?(r=t,t=s=void 0):2!==o||t.getContext||(s=r,r=t,t=void 0),new Promise(function(n,i){try{const i=QRCode.create(r,s);n(e(i,t,s))}catch(e2){i(e2)}})}if(o<2)throw new Error("Too few arguments provided");2===o?(n=r,r=t,t=s=void 0):3===o&&(t.getContext&&void 0===n?(n=s,s=void 0):(n=s,s=r,r=t,t=void 0));try{const i=QRCode.create(r,s);n(null,e(i,t,s))}catch(e2){n(e2)}}browser.create=QRCode.create,browser.toCanvas=renderCanvas.bind(null,CanvasRenderer.render),browser.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL),browser.toString=renderCanvas.bind(null,function(e,t,r){return SvgRenderer.render(e,r)});const{Text:Text$h}=Typography,WecomLogin=({onError:e})=>{const[t,r]=reactExports.useState(""),[s,n]=reactExports.useState(""),[i,o]=reactExports.useState(""),[a,l]=reactExports.useState(!1),[c,u]=reactExports.useState(!1),[d,p]=reactExports.useState(null),[m,h]=reactExports.useState(null),x=reactExports.useRef(null),f=reactExports.useRef(0);let g=null;try{const e=useAuth();g=e.login}catch(b){console.error("WecomLogin: 初始化认证失败:",b),p("组件初始化失败")}const y=async()=>{console.log("🚀 generateQRCode 函数被调用"),alert("🚀 generateQRCode 函数被调用"),l(!0);try{console.log("📝 开始获取企业微信二维码..."),logger.wecom("开始获取企业微信二维码...");const e=await getWecomQRCode();if(console.log("📋 后端API响应:",e),logger.wecom("后端API响应:",e),!e.success)throw logger.error("后端API返回失败:",e.error),new Error(e.error||"获取二维码失败");const{data:t}=e,s=null==t?void 0:t.authUrl,i=null==t?void 0:t.state;if(console.log("🔍 解析到的数据:",{authUrl:!!s,state:!!i}),logger.wecom("解析到的数据:",{authUrl:!!s,state:!!i}),alert(`解析结果: authUrl=${s?"有值":"无值"}, state=${i?"有值":"无值"}`),!s||!i)throw alert(`数据不完整: authUrl=${!!s}, state=${!!i}, 完整响应: ${JSON.stringify(e)}`),console.error("❌ 数据不完整:",{authUrl:!!s,state:!!i}),console.error("❌ 完整响应数据:",e),logger.error("数据不完整:",{authUrl:!!s,state:!!i}),logger.error("完整响应数据:",e),new Error("二维码数据不完整");console.log("🎨 开始生成二维码图片..."),logger.wecom("开始生成二维码图片...");const a=await(async e=>{try{logger.qr("准备生成二维码，数据长度:",e.length),logger.qr("数据内容:",e);const t=document.createElement("canvas");t.width=200,t.height=200,logger.qr("动态创建Canvas元素，开始生成二维码..."),await browser.toCanvas(t,e,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}}),logger.qr("二维码绘制完成，转换为Data URL...");const r=t.toDataURL("image/png");return logger.qr("Data URL生成成功，长度:",r.length),r}catch(t){throw logger.error("生成二维码图片失败:",t),new Error(`生成二维码图片失败: ${t instanceof Error?t.message:"未知错误"}`)}})(s);console.log("✅ 二维码图片生成成功"),logger.wecom("二维码图片生成成功"),r(s),n(a),o(i),v(i),staticMethods.success("二维码生成成功，请使用企业微信扫码登录（有效期10分钟）")}catch(t){logger.error("生成二维码失败:",t);const r=t instanceof Error?t.message:"生成二维码失败";staticMethods.error(`生成二维码失败: ${r}`),null==e||e(r)}finally{l(!1)}},v=t=>{x.current&&clearTimeout(x.current),u(!0),f.current=0,logger.wecom("开始长轮询，state:",t);const r=async()=>{try{const s="https://lead.vld.com.cn/api",n=localStorage.getItem("wecom_session_id"),i=`${s}/auth/wecom/poll?state=${encodeURIComponent(t)}${n?`&sessionId=${encodeURIComponent(n)}`:""}`;logger.wecom("发起长轮询请求:",i),logger.wecom("会话ID:",n);const o=await fetch(i,{method:"GET",headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const a=await o.json();switch(logger.wecom("长轮询响应:",a),f.current=0,a.type){case"login_success":logger.wecom("企业微信登录成功"),j(a.userInfo),E();break;case"login_failed":logger.error("企业微信登录失败:",a.error),staticMethods.error(a.error||"登录失败"),null==e||e(a.error||"登录失败"),E();break;case"expired":logger.error("二维码已过期:",a.error),staticMethods.error("二维码已过期，请重新生成"),null==e||e(a.error||"二维码已过期"),E();break;case"timeout":logger.wecom("长轮询超时，继续轮询"),x.current=setTimeout(r,2e3);break;case"not_found":logger.error("状态不存在:",a.error),staticMethods.error("登录状态异常，请重新生成二维码"),null==e||e(a.error||"状态异常"),E();break;default:logger.wecom("继续长轮询..."),x.current=setTimeout(r,2e3)}}catch(s){if(logger.error("长轮询请求失败:",s),f.current+=1,f.current>=5)return logger.error("长轮询失败，已达到最大重试次数 (5)"),staticMethods.error("网络连接异常，请检查网络后重新生成二维码"),null==e||e("网络连接异常"),void E();const t=Math.min(1e3*Math.pow(2,f.current-1),16e3);logger.wecom(`第${f.current}次重试，${t}ms后重试`),x.current=setTimeout(r,t)}};x.current=setTimeout(r,1e3)},E=()=>{x.current&&(clearTimeout(x.current),x.current=null),f.current=0,u(!1),logger.wecom("长轮询已停止")},j=async t=>{try{if(!g)throw new Error("认证服务未初始化");const{success:r,error:s}=await g(t.email,"",{wechat_work_userid:t.UserId,wechat_work_name:t.name,wechat_work_mobile:t.mobile,wechat_work_avatar:t.avatar||"",wechat_work_department:t.department,wechat_work_position:t.position,wechat_work_corpid:t.corpId});r?(staticMethods.success("企业微信登录成功！"),setTimeout(()=>{window.location.href="/"},1e3)):(staticMethods.error(s||"企业微信登录失败"),null==e||e(s||"企业微信登录失败"))}catch(r){console.error("处理企业微信登录成功失败:",r),staticMethods.error("处理登录结果失败"),null==e||e("处理登录结果失败")}};return reactExports.useEffect(()=>(y(),()=>{E()}),[]),d?jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"20px",color:"#ff4d4f"},children:[jsxRuntimeExports.jsx(Text$h,{type:"danger",children:d}),jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>window.location.reload(),children:"刷新页面"})]}):jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",style:{width:"100%"},size:"large",children:[jsxRuntimeExports.jsx("div",{style:{textAlign:"center"},children:a?jsxRuntimeExports.jsxs("div",{style:{padding:"40px 0"},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:jsxRuntimeExports.jsx(Text$h,{children:"正在生成二维码..."})})]}):s?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{display:"inline-block",padding:"20px",border:"1px solid #d9d9d9",borderRadius:"12px",backgroundColor:"#fff",marginBottom:12},children:jsxRuntimeExports.jsx("img",{src:s,alt:"企业微信登录二维码",style:{width:200,height:200,borderRadius:"8px"}})}),jsxRuntimeExports.jsx("div",{style:{marginTop:8,fontSize:12},children:c?jsxRuntimeExports.jsx(Text$h,{type:"success",children:"🔄 正在监听登录状态"}):jsxRuntimeExports.jsx(Text$h,{type:"secondary",children:"⏸️ 监听已停止"})})]}):jsxRuntimeExports.jsxs("div",{style:{padding:"40px 0"},children:[jsxRuntimeExports.jsx(Text$h,{type:"secondary",children:"二维码生成失败"}),jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:y,style:{marginTop:16},children:"重新生成"})]})}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"center"},children:[jsxRuntimeExports.jsx(Button$1,{type:"default",icon:jsxRuntimeExports.jsx(RefIcon$2,{}),size:"large",onClick:async()=>{try{const e=await getWecomQRCode();if(!e.success)throw new Error(e.error||"获取授权URL失败");const{data:t}=e,r=null==t?void 0:t.authUrl;if(!r)throw new Error("授权URL数据不完整");window.location.href=r}catch(e){staticMethods.error("生成授权链接失败，请重试")}},style:{height:48,fontSize:16,borderRadius:12,borderColor:"#d9d9d9",width:240,margin:"0 auto"},children:"企业微信授权登录"}),jsxRuntimeExports.jsx("p",{style:{fontSize:12,color:"#999",marginTop:8},children:"跳转企业微信完成授权"})]})]})},{TabPane:TabPane$4}=Tabs,Login=()=>{const[e,t]=reactExports.useState(!1),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState("login"),{user:o,loading:a}=useUser(),{isAuthenticated:l,login:c}=useAuth(),u=useNavigate(),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState(""),[x,f]=reactExports.useState(!1),g=reactExports.useRef(!1);reactExports.useEffect(()=>{console.log("Login useEffect - isAuthenticated:",l,"userLoading:",a,"hasNavigated:",g.current),!l||a||g.current||(console.log("触发登录成功跳转"),g.current=!0,u("/",{replace:!0}))},[l,a,u]);const y=e=>{const t=localStorage.getItem(`login_attempts_${e}`);return t?JSON.parse(t):{count:0,blockedUntil:null}},v=(e,t)=>{localStorage.setItem(`login_attempts_${e}`,JSON.stringify(t))},E=async()=>{if(m&&/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(m)){f(!0);try{const{data:e,error:t}=await supabase.from("users_profile").select("id, email, status, user_id").eq("email",m).single();if(t)return"PGRST116"===t.code?(staticMethods.error("该邮箱未注册，请检查邮箱地址"),void f(!1)):(console.error("查询用户档案失败:",t),staticMethods.error("检查邮箱时出现错误，请重试"),void f(!1));if("banned"===e.status||"deleted"===e.status)return staticMethods.error("该账号已被禁用或删除，请联系管理员"),void f(!1);if("pending"===e.status)return staticMethods.error("该邮箱尚未激活，请先激活账号"),void f(!1);const r=window.location.origin+"/set-password",{error:s}=await tokenManager.resetPasswordForEmail(m,r);s?staticMethods.error(s instanceof Error?s.message:"重置邮件发送失败"):(staticMethods.success("重置密码邮件已发送，请查收邮箱！"),p(!1))}catch(e){staticMethods.error("重置密码失败: "+e.message)}finally{f(!1)}}else staticMethods.error("请输入有效邮箱")};if(a||o||e){const t=o?"登录成功，正在跳转...":e?"正在验证登录信息...":"正在加载用户信息...",r=o?"正在为您跳转到主页面":e?"请稍候，我们正在验证您的身份":"请稍候，我们正在为您准备登录环境";return jsxRuntimeExports.jsx(LoadingScreen,{type:"auth",message:t,subtitle:r})}return jsxRuntimeExports.jsxs("div",{className:"login-bg",children:[jsxRuntimeExports.jsxs("div",{style:{position:"absolute",top:16,left:32,display:"flex",alignItems:"center",zIndex:10,userSelect:"none"},children:[jsxRuntimeExports.jsx(LottieLogo,{width:32,height:32}),jsxRuntimeExports.jsx("img",{src:"/VLINKER.svg",alt:"VLINKER",style:{height:28,marginLeft:4,verticalAlign:"middle"},onError:e=>e.currentTarget.style.display="none"})]}),jsxRuntimeExports.jsx("div",{className:"login-card",children:jsxRuntimeExports.jsxs(Tabs,{activeKey:n,onChange:i,centered:!0,style:{marginBottom:24},children:[jsxRuntimeExports.jsxs(TabPane$4,{tab:"登录",children:[jsxRuntimeExports.jsx("h2",{style:{color:"#222",textAlign:"left",paddingBottom:"16px"},children:"欢迎回来👏"}),jsxRuntimeExports.jsxs(Form$4,{onFinish:async e=>{const{email:r,password:s}=e;if((e=>{const t=y(e);return!!(t.blockedUntil&&new Date<new Date(t.blockedUntil))||(t.blockedUntil&&new Date>=new Date(t.blockedUntil)&&v(e,{count:0,blockedUntil:null}),!1)})(r)){const e=y(r),t=Math.ceil((new Date(e.blockedUntil).getTime()-Date.now())/1e3/60);return void staticMethods.error(`账户已被临时锁定，请${t}分钟后再试`)}t(!0);try{const{success:e,error:t}=await c(r,s);if(e)v(r,{count:0,blockedUntil:null}),staticMethods.success("登录成功！正在跳转..."),console.log("登录成功，等待状态更新和跳转..."),console.log("当前状态 - user:",o,"userLoading:",a,"isAuthenticated:",l);else{const e=y(r);e.count+=1,t&&t.includes("user_banned")?staticMethods.error("您的账号已被禁用或离职，如有疑问请联系管理员"):t&&t.includes("Invalid login credentials")?staticMethods.error("账号或密码错误，请重新输入"):staticMethods.error(t||"登录失败"),e.count>=5?(e.blockedUntil=new Date(Date.now()+9e5).toISOString(),staticMethods.error("登录失败次数过多，账户已被临时锁定15分钟")):t&&t.includes("Invalid login credentials")&&staticMethods.error(`账号或密码错误，还可尝试${5-e.count}次`),v(r,e)}}catch(e2){staticMethods.error("登录异常，请重试")}finally{t(!1)}},layout:"vertical",style:{width:"100%"},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"email",label:"邮箱",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入有效邮箱"}],style:{marginBottom:24},children:jsxRuntimeExports.jsx(Input$1,{autoComplete:"username",prefix:jsxRuntimeExports.jsx(RefIcon$o,{}),placeholder:"请输入邮箱"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],style:{marginBottom:8},children:jsxRuntimeExports.jsx(Input$1.Password,{autoComplete:"current-password",prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请输入密码"})}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:e,block:!0,className:"login-btn",children:"立即登录"}),jsxRuntimeExports.jsx("div",{style:{textAlign:"right",marginTop:8},children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>p(!0),style:{padding:0},className:"login-btn-forgot",children:"忘记密码？"})})]})]},"login"),jsxRuntimeExports.jsxs(TabPane$4,{tab:"注册",children:[jsxRuntimeExports.jsx("h2",{style:{color:"#222",textAlign:"left",paddingBottom:"16px"},children:"创建新账号🚀"}),jsxRuntimeExports.jsxs(Form$4,{onFinish:async e=>{var t;const{email:r,password:n,confirmPassword:o,fullName:a,inviteCode:l}=e;if(n===o)if(l&&"vlinker567"===l){s(!0);try{const{data:e,error:s}=await supabase.auth.signUp({email:r,password:n,options:{data:{full_name:a}}});if(s)s.message.includes("User already registered")?staticMethods.error("该邮箱已注册，请直接登录"):s.message.includes("Password should be at least")?staticMethods.error("密码长度不足，请确保密码至少6位"):staticMethods.error(`注册失败: ${s.message}`);else{if(e.user)try{const{data:r}=await supabase.from("users_profile").select("id").eq("user_id",e.user.id).limit(1);if(r&&r.length>0)console.log("用户profile已存在，跳过创建"),staticMethods.success("注册成功！");else{const{error:r}=await supabase.from("users_profile").insert({user_id:e.user.id,email:e.user.email,nickname:a||(null==(t=e.user.email)?void 0:t.split("@")[0])||"用户",status:"active"});r?(console.error("创建用户profile失败:",r),console.error("错误详情:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),staticMethods.error(`创建用户档案失败: ${r.message}`)):(console.log("成功创建用户profile:",e.user.id),staticMethods.success("注册成功！用户档案已创建"))}}catch(c){console.error("创建profile异常:",c),staticMethods.warning("注册成功，但创建用户档案失败，请联系管理员")}i("login"),staticMethods.info("请使用注册的邮箱和密码登录")}}catch(u){staticMethods.error(`注册异常: ${u.message}`)}finally{s(!1)}}else staticMethods.error("邀请码错误，请输入正确的邀请码");else staticMethods.error("两次输入的密码不一致")},layout:"vertical",style:{width:"100%"},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"fullName",label:"姓名",rules:[{required:!0,message:"请输入姓名"},{min:2,message:"姓名至少2个字符"}],style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1,{prefix:jsxRuntimeExports.jsx(RefIcon$5,{}),placeholder:"请输入真实姓名"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"email",label:"邮箱",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入有效邮箱"}],style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1,{prefix:jsxRuntimeExports.jsx(RefIcon$o,{}),placeholder:"请输入邮箱地址"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"inviteCode",label:"邀请码",rules:[{required:!0,message:"请输入邀请码"},{min:6,message:"邀请码至少6位"}],style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1,{prefix:jsxRuntimeExports.jsx(RefIcon$q,{}),placeholder:"请输入邀请码"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请输入密码"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请确认密码"},{min:6,message:"密码至少6位"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve()})],style:{marginBottom:8},children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请再次输入密码"})}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:r,block:!0,className:"login-btn",children:"立即注册"}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:16},children:[jsxRuntimeExports.jsx("span",{style:{color:"#666"},children:"已有账号？"}),jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>i("login"),style:{padding:0},children:"立即登录"})]})]})]},"register"),jsxRuntimeExports.jsxs(TabPane$4,{tab:"企业微信",children:[jsxRuntimeExports.jsx("h2",{style:{color:"#222",textAlign:"left",paddingBottom:"16px"},children:"企业微信登录🔐"}),jsxRuntimeExports.jsx(WecomLogin,{onSuccess:e=>{console.log("企业微信登录成功:",e),staticMethods.success("企业微信登录成功！")},onError:e=>{console.error("企业微信登录失败:",e),staticMethods.error(`企业微信登录失败: ${e}`)}})]},"wecom")]})}),jsxRuntimeExports.jsx(Modal$2,{title:"重置密码",open:d,onCancel:()=>p(!1),onOk:E,confirmLoading:x,okText:"发送重置邮件",cancelText:"取消",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入注册邮箱",value:m,onChange:e=>h(e.target.value),onPressEnter:E,autoFocus:!0})})]})},{Title:Title$d,Text:Text$g}=Typography,SetPassword=()=>{const[e]=Form$4.useForm(),[t,r]=reactExports.useState(!1),[s,n]=reactExports.useState(!0),[i,o]=reactExports.useState(!1),[a,l]=reactExports.useState(null),[c,u]=reactExports.useState(!1),[d]=reactExports.useState(null),p=useNavigate(),{user:m}=useUser();reactExports.useEffect(()=>{let e=!1;function t(){let t=window.location.hash;t&&"#"!==t||(t=localStorage.getItem("supabase_hash")||"");let r="";if(t){const e=new URLSearchParams(t.replace(/^#/,""));r=e.get("access_token")||e.get("token")||""}return r&&(e=!0,h(t)),!!r}t()||setTimeout(()=>{e||t()},100)},[]);const h=async e=>{try{if(n(!0),e){const r=new URLSearchParams(e.replace(/^#/,"")),s=r.get("access_token"),i=r.get("type");if(s&&"invite"===i)try{const{data:e,error:t}=await supabase.auth.setSession({access_token:s,refresh_token:r.get("refresh_token")||""});if(t)return console.error("❌ [SetPassword] setSession 错误:",t),x(t.message||"链接已失效或已被使用"),o(!1),void n(!1);if(e.user)return l(e.user),o(!0),n(!1),void localStorage.removeItem("supabase_hash")}catch(t){console.error("❌ [SetPassword] setSession 异常:",t)}}const r=new URLSearchParams(window.location.search),s=new URLSearchParams(window.location.hash.substring(1)),i=r.get("error")||s.get("error"),a=r.get("error_description")||s.get("error_description");if(i)return console.error("❌ [SetPassword] URL中包含错误信息:",{error:i,errorDescription:a}),void x(i,a||void 0);const c=r.get("token")||r.get("access_token")||s.get("access_token")||s.get("token"),u=r.get("type")||s.get("type"),d=r.get("email")||s.get("email");if(!c)return staticMethods.error("未找到有效的邀请令牌，请重新获取邀请邮件或联系管理员。"),setTimeout(()=>{p("/login")},1500),o(!1),void n(!1);if(!m&&c&&("recovery"===u||"invite"===u)&&d){const{data:e,error:t}=await supabase.auth.verifyOtp({email:d,type:u,token:c});return t?(console.error("❌ [SetPassword] verifyOtp 错误:",t),x(t.message||"链接已失效或已被使用"),o(!1),void n(!1)):(l(e.user),o(!0),n(!1),void localStorage.removeItem("supabase_hash"))}if(m)return l(m),o(!0),n(!1),void localStorage.removeItem("supabase_hash");o(!1),n(!1)}catch(e2){console.error("❌ [SetPassword] handleInviteFlow 异常:",e2),o(!1),n(!1)}},x=(e,t)=>{let r="邀请链接验证失败";r="server_error"===e||"unexpected_failure"===e?"邀请链接验证失败，可能是链接已过期或无效。请联系管理员重新发送邀请。":"access_denied"===e&&(null==t?void 0:t.includes("expired"))?"邀请链接已过期，请联系管理员重新发送邀请。":"access_denied"===e?"邀请链接无效或已被使用，请联系管理员重新发送邀请。":`邀请验证失败: ${t||e}`,staticMethods.error(r),o(!1),n(!1)},f=async e=>{var t,r;try{if(!d)return void staticMethods.error("邀请数据无效");const{data:s,error:n}=await supabase.auth.signUp({email:d.email,password:e,options:{data:{name:d.email.split("@")[0],organization_id:d.organization_id,organization_name:d.organization_name,password_set:!0,password_set_at:toBeijingDateTimeStr(new Date)}}});if(n)return console.error("❌ [SetPassword] 用户注册失败:",n),void staticMethods.error("账户创建失败: "+n.message);const{error:i}=await supabase.from("users_profile").update({status:"active",user_id:null==(t=s.user)?void 0:t.id}).eq("email",d.email);i&&console.error("❌ [SetPassword] 更新用户档案失败:",i);try{const t=await fetch("/functions/v1/activate-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.email,user_id:null==(r=s.user)?void 0:r.id,template_type:"welcome",template_vars:{name:d.email.split("@")[0]}})}),n=await t.json();if(n.success){staticMethods.success("账户已激活，正在登录...");const{error:t}=await supabase.auth.signInWithPassword({email:d.email,password:e});if(t)return staticMethods.error("自动登录失败，请手动登录"),u(!0),void setTimeout(()=>p("/login"),2e3);u(!0),setTimeout(()=>p("/"),2e3)}else staticMethods.warning(n.error||"账户已创建，但激活通知失败")}catch(e2){console.error("❌ [SetPassword] 调用activate-user异常:",e2),staticMethods.warning("账户已创建，但激活通知失败")}}catch(s){console.error("❌ [SetPassword] 自定义邀请处理失败:",s),staticMethods.error("密码设置失败，请重试")}},g=async e=>{try{const{error:t}=await supabase.auth.updateUser({password:e,data:{password_set:!0,password_set_at:toBeijingDateTimeStr(new Date)}});if(t)return console.error("❌ [SetPassword] 密码设置失败:",t),void staticMethods.error("密码设置失败: "+t.message);staticMethods.success("密码设置成功！正在登录...");const{error:r}=await supabase.auth.signInWithPassword({email:a.email,password:e});if(r)return console.error("❌ [SetPassword] 自动登录失败:",r),staticMethods.error("自动登录失败，请手动登录"),u(!0),void setTimeout(()=>{p("/login")},2e3);u(!0),setTimeout(()=>{p("/")},2e3)}catch(t){console.error("❌ [SetPassword] Supabase邀请处理失败:",t),staticMethods.error("密码设置失败，请重试")}};return s?jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:400,textAlign:"center"},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:jsxRuntimeExports.jsx(Text$g,{children:"正在验证邀请链接..."})})]})}):i?c?jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:400,textAlign:"center"},children:[jsxRuntimeExports.jsx(RefIcon$7,{style:{fontSize:48,color:"#52c41a",marginBottom:16}}),jsxRuntimeExports.jsx(Title$d,{level:3,children:"设置成功！"}),jsxRuntimeExports.jsx(Text$g,{children:"您的账户已激活，正在为您登录..."}),jsxRuntimeExports.jsx("div",{style:{marginTop:24},children:jsxRuntimeExports.jsx(Spin,{})})]})}):jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:450,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[jsxRuntimeExports.jsx(RefIcon$r,{style:{fontSize:48,color:"#1890ff",marginBottom:16}}),jsxRuntimeExports.jsx(Title$d,{level:2,children:"设置密码"})]}),jsxRuntimeExports.jsxs("div",{style:{background:"#f9f9f9",padding:16,borderRadius:8,marginBottom:16},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[jsxRuntimeExports.jsx(RefIcon$o,{style:{marginRight:8,color:"#1890ff"}}),jsxRuntimeExports.jsx(Text$g,{children:null==a?void 0:a.email})]}),(null==a?void 0:a.organization_name)&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{style:{marginRight:8,color:"#1890ff"},children:"🏢"}),jsxRuntimeExports.jsx(Text$g,{children:a.organization_name})]})]}),jsxRuntimeExports.jsxs(Form$4,{form:e,layout:"vertical",onFinish:async e=>{try{r(!0);const{password:t}=e;if(!a||!a.email)return staticMethods.error("用户信息无效，请刷新页面或重新获取邀请链接"),void r(!1);const s=new URLSearchParams(window.location.search);"custom_invite"===s.get("type")?await f(t):await g(t)}catch(t){console.error("❌ [SetPassword] 密码设置异常:",t),staticMethods.error("密码设置失败: "+t.message)}finally{r(!1)}},size:"large",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"password",label:"设置密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请输入密码",className:"custom-placeholder",autoComplete:"new-password"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"confirmPassword",label:"确认密码",dependencies:["password"],style:{marginTop:16},rules:[{required:!0,message:"请确认密码"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve()})],children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请再次输入密码",className:"custom-placeholder",autoComplete:"new-password"})}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginTop:32},children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:t,block:!0,size:"large",children:"设置密码并登录账户"})})]}),jsxRuntimeExports.jsx("div",{style:{textAlign:"center",marginTop:24},children:jsxRuntimeExports.jsx(Text$g,{type:"secondary",style:{fontSize:12},children:"请牢记密码，并妥善保管"})})]})}):jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:400,textAlign:"center"},children:[jsxRuntimeExports.jsx(Alert,{message:"邀请链接无效",description:"链接已失效或不正确，请联系管理员重新发送邀请。",type:"error",showIcon:!0}),jsxRuntimeExports.jsx(Button$1,{type:"primary",style:{marginTop:16},onClick:()=>{p("/login")},children:"返回登录"})]})})},UserMenu=()=>{const e=useNavigate(),{logout:t}=useAuth(),r={items:[{key:"profile",label:jsxRuntimeExports.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8},children:[jsxRuntimeExports.jsx(RefIcon$5,{}),"个人中心"]})},{type:"divider"},{key:"logout",label:jsxRuntimeExports.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8},children:[jsxRuntimeExports.jsx(RefIcon$s,{}),"退出登录"]})}],onClick:async r=>{"logout"===r.key&&await t(e)}};return jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Dropdown,{menu:r,placement:"bottomRight",children:jsxRuntimeExports.jsx("span",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"}})})})},VersionDisplay=({style:e,asTag:t=!1,showDetails:r=!1,showRefreshButton:s=!1,onRefresh:n})=>{const[i,o]=reactExports.useState(!1),a=cacheManager.getCurrentVersion(),l=cacheManager.getStoredVersionInfo(),c=cacheManager.checkForUpdates(),u=`v${a}`,d=jsxRuntimeExports.jsxs("div",{style:{maxWidth:300},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"当前版本："}),a]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"存储版本："}),(null==l?void 0:l.version)||"未知"]}),(null==l?void 0:l.timestamp)&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"最后更新："}),new Date(l.timestamp).toLocaleString()]}),c&&jsxRuntimeExports.jsxs("div",{style:{color:"#faad14",marginTop:8},children:[jsxRuntimeExports.jsx(RefIcon$t,{})," 检测到版本更新"]})]}),p=()=>{n?n():cacheManager.forceRefreshAll()};return t?jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Tooltip,{title:d,placement:"top",children:jsxRuntimeExports.jsxs(Tag$1,{color:c?"orange":"default",style:{cursor:"pointer",...e},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[u,c&&jsxRuntimeExports.jsx(RefIcon$t,{style:{marginLeft:4}})]})}),s&&jsxRuntimeExports.jsx(Tooltip,{title:"刷新缓存",children:jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{cursor:"pointer"},onClick:p,children:jsxRuntimeExports.jsx(RefIcon$9,{})})})]}):r?jsxRuntimeExports.jsx("div",{style:{...e},children:jsxRuntimeExports.jsx(Tooltip,{title:d,placement:"top",children:jsxRuntimeExports.jsxs("div",{style:{cursor:"pointer",display:"flex",alignItems:"center",gap:4},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[jsxRuntimeExports.jsx("span",{children:u}),c&&jsxRuntimeExports.jsx(RefIcon$t,{style:{color:"#faad14"}}),s&&jsxRuntimeExports.jsx(RefIcon$9,{style:{cursor:"pointer",color:i?"#1890ff":"#bbb",transition:"color 0.3s"},onClick:p})]})})}):jsxRuntimeExports.jsx(Tooltip,{title:d,placement:"top",children:jsxRuntimeExports.jsxs("div",{style:{cursor:"pointer",...e},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[u,c&&jsxRuntimeExports.jsx(RefIcon$t,{style:{marginLeft:4,color:"#faad14"}})]})})},useRolePermissions=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(!0),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(!1),[h,x]=reactExports.useState([]),f=reactExports.useRef(new Map),g=reactExports.useRef(new Map),y=3e5;reactExports.useEffect(()=>{v()},[]);const v=async()=>{var e;try{a(!0);const{data:r}=await supabase.auth.getUser(),n=null==(e=null==r?void 0:r.user)?void 0:e.id;if(!n)throw new Error("未获取到用户ID");const{data:o,error:l}=await supabase.rpc("get_user_roles",{p_user_id:n});if(l)throw l;const u=(o||[]).map(e=>({role_id:e.role_id,role_name:e.role_name,role_display_name:e.role_description||e.role_name,granted_at:"",is_active:!0}));t(u);const{data:p,error:m}=await supabase.rpc("get_user_permissions",{p_user_id:n});if(m)s([]);else{const e=(p||[]).map(e=>({permission_name:e.permission_name,permission_display_name:e.permission_description||e.permission_name,category:e.resource,resource:e.resource,action:e.action}));s(e)}const{data:h,error:x}=await supabase.from("roles").select("*").order("name");i(x?[]:h||[]);const f=(o||[]).map(e=>e.role_name)||[],g=f.includes("admin")||f.includes("super_admin"),y=f.includes("admin")||f.includes("system_admin");c(g),d(y),await E(n,g,f.includes("admin"))}catch(r){t([]),s([]),x([])}finally{a(!1)}},E=async(e,t,r)=>{try{let s=[];if(t||r){const{data:e}=await supabase.from("organizations").select("id, name").order("name");s=(null==e?void 0:e.map(e=>({id:e.id,name:e.name,is_admin:!0,level:0})))||[],m(!0)}else{const{data:t}=await supabase.rpc("get_managed_org_ids",{admin_id:e});if(t&&t.length>0){const{data:r}=await supabase.from("organizations").select("id, name, admin").in("id",t.map(e=>e.org_id));s=(null==r?void 0:r.map(t=>({id:t.id,name:t.name,is_admin:t.admin===e,level:0})))||[],m(s.length>0)}else m(!1)}x(s)}catch(s){x([]),m(!1)}},j=reactExports.useCallback(e=>{const t=f.current.get(e);if(t&&Date.now()-t.timestamp<y)return t.value;const s=l||r.some(t=>t.permission_name===e);return f.current.set(e,{value:s,timestamp:Date.now()}),s},[r,l,y]),b=reactExports.useCallback(async()=>{try{const{data:e,error:t}=await supabase.rpc("has_permission",{resource:"live_stream",action:"manage"});return t?(console.error("检查直播管理权限失败:",t),!1):!0===e}catch(e){return console.error("检查直播管理权限异常:",e),!1}},[]),w=reactExports.useCallback(e=>l||e.some(e=>j(e)),[j,l]),R=reactExports.useCallback(e=>l||e.every(e=>j(e)),[j,l]),_=reactExports.useCallback(t=>{const r=g.current.get(t);if(r&&Date.now()-r.timestamp<y)return r.value;const s=e.some(e=>e.role_name===t);return g.current.set(t,{value:s,timestamp:Date.now()}),s},[e,y]),S=reactExports.useCallback(e=>e.some(e=>_(e)),[_]),C=reactExports.useCallback(()=>e.map(e=>e.role_display_name),[e]),k=reactExports.useCallback(()=>{const e={};return r.forEach(t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)}),e},[r]),$=reactExports.useCallback((t=7)=>{const r=new Date;return r.setDate(r.getDate()+t),e.filter(e=>e.expires_at&&new Date(e.expires_at)<=r)},[e]),T=reactExports.useCallback(()=>{f.current.clear(),g.current.clear(),v()},[]),I=reactExports.useCallback(()=>{f.current.clear(),g.current.clear()},[]),P=reactExports.useCallback(e=>l||h.some(t=>t.id===e),[l,h]),A=reactExports.useCallback(e=>P(e),[P]),F=reactExports.useCallback(()=>h.map(e=>e.id),[h]),M=reactExports.useCallback(()=>h,[h]);return{userRoles:e,userPermissions:r,allRoles:n,loading:o,isSuperAdmin:l,isSystemAdmin:u,isDepartmentAdmin:p,manageableOrganizations:h,hasPermission:j,hasAnyPermission:w,hasAllPermissions:R,hasRole:_,hasAnyRole:S,getUserRoleDisplayNames:C,getPermissionsByCategory:k,getExpiringRoles:$,refreshPermissions:T,clearPermissionCache:I,canManageOrganization:P,canManageUser:A,getManageableOrganizationIds:F,getManageableOrganizations:M,hasLiveStreamManagePermission:b,checkPermission:j,checkRole:_,checkAnyPermission:w,checkAllPermissions:R,checkAnyRole:S}},NavigationMenu=({selectedKey:e,onMenuClick:t,collapsed:r=!1,onCollapse:s})=>{const[n,i]=React$2.useState(""),{hasPermission:o,hasRole:a,loading:l,isSuperAdmin:c}=useRolePermissions(),u=a("admin")||a("super_admin")||a("system_admin")||c;const d=function e(t,r){if(l)return[];if(!r){return t.filter(t=>{if(!u)return"live-stream-registration"===t.key;if(t.permission)if("admin"===t.permission){if(!(a("admin")||a("super_admin")||a("system_admin"))&&!c)return!1}else{if(!o(t.permission))return!1}if(t.children){const s=e(t.children,r);return 0!==s.length&&(t.children=s,!0)}return!0})}const s=r.toLowerCase();return t.map(t=>{if(!u)return"live-stream-registration"===t.key&&t.label&&String(t.label).toLowerCase().includes(s)?t:null;if(t.permission)if("admin"===t.permission){if(!(a("admin")||a("super_admin")||a("system_admin"))&&!c)return null}else if(!o(t.permission))return null;if(t.children){const n=e(t.children,r);return n.length>0||t.label&&String(t.label).toLowerCase().includes(s)?{...t,children:n}:null}return t.label&&String(t.label).toLowerCase().includes(s)?t:null}).filter(Boolean)}([{key:"index",icon:jsxRuntimeExports.jsx(RefIcon$u,{}),label:"首页",path:"/",className:"main-menu-item"},{key:"clues",icon:jsxRuntimeExports.jsx(RefIcon$w,{}),label:"线索管理",className:"main-menu-submenu-title",children:[{key:"leads",icon:jsxRuntimeExports.jsx(RefIcon$v,{}),label:"线索列表",path:"/leads",className:"main-menu-item",permission:"lead_manage"},{key:"followups",icon:jsxRuntimeExports.jsx(RefIcon$5,{}),label:"跟进记录",path:"/followups",className:"main-menu-item"},{key:"showings",icon:jsxRuntimeExports.jsx(RefIcon$6,{}),label:"带看记录",path:"/showings",className:"main-menu-item"},{key:"deals",icon:jsxRuntimeExports.jsx(RefIcon$7,{}),label:"成交记录",path:"/deals",className:"main-menu-item"}]},{key:"data-analysis",icon:jsxRuntimeExports.jsx(RefIcon$x,{}),label:"线索分析",path:"/data-analysis",className:"main-menu-item",permission:"data_analysis"},{key:"live-stream-registration",icon:jsxRuntimeExports.jsx(RefIcon$y,{}),label:"直播报名",path:"/live-stream-registration",className:"main-menu-item"},{key:"live-stream-management",icon:jsxRuntimeExports.jsx(RefIcon$y,{}),label:"直播管理",path:"/live-stream-management",className:"main-menu-item",permission:"live_stream_manage"},{key:"metro-tools",icon:jsxRuntimeExports.jsx(RefIcon$3,{}),label:"地铁工具",className:"main-menu-submenu-title",children:[{key:"metro-calculator",icon:jsxRuntimeExports.jsx(RefIcon$z,{}),label:"距离计算器",path:"/metro-calculator",className:"main-menu-item"}]},{key:"allocation-manage",icon:jsxRuntimeExports.jsx(RefIcon$A,{}),label:"分配管理",className:"main-menu-submenu-title",children:[{key:"allocation",icon:jsxRuntimeExports.jsx(RefIcon$A,{}),label:"线索分配",path:"/allocation",className:"main-menu-item",permission:"allocation_manage"},{key:"showings-queue",icon:jsxRuntimeExports.jsx(RefIcon$6,{}),label:"带看分配",path:"/showings-queue",className:"main-menu-item",permission:"allocation_manage"}]},{key:"points",icon:jsxRuntimeExports.jsx(RefIcon$C,{}),label:"积分管理",className:"main-menu-submenu-title",children:[{key:"points-summary",icon:jsxRuntimeExports.jsx(RefIcon$B,{}),label:"积分汇总",path:"/points-summary",className:"main-menu-item",permission:"points_manage"},{key:"points-exchange",icon:jsxRuntimeExports.jsx(RefIcon$q,{}),label:"积分兑换",path:"/points/exchange",className:"main-menu-item"}]},{key:"honor",icon:jsxRuntimeExports.jsx(RefIcon$D,{}),label:"荣誉系统",className:"main-menu-submenu-title",children:[{key:"honor-management",icon:jsxRuntimeExports.jsx(RefIcon$C,{}),label:"荣誉管理",path:"/honor",className:"main-menu-item",permission:"user_manage"},{key:"achievement-management",icon:jsxRuntimeExports.jsx(RefIcon$D,{}),label:"成就管理",path:"/achievement",className:"main-menu-item",permission:"user_manage"}]},{key:"departments",icon:jsxRuntimeExports.jsx(RefIcon$E,{}),label:"部门管理",path:"/departments",className:"main-menu-item"},{key:"system",icon:jsxRuntimeExports.jsx(RefIcon$I,{}),label:"系统管理",className:"main-menu-submenu-title",permission:"admin",children:[{key:"roles",icon:jsxRuntimeExports.jsx(RefIcon$F,{}),label:"角色权限",path:"/roles",className:"main-menu-item",permission:"admin"},{key:"announcements",icon:jsxRuntimeExports.jsx(RefIcon$G,{}),label:"公告配置",path:"/announcements",className:"main-menu-item",permission:"admin"},{key:"banner-management",icon:jsxRuntimeExports.jsx(RefIcon$u,{}),label:"资源位管理",path:"/banner-management",className:"main-menu-item",permission:"admin"},{key:"load-demo",icon:jsxRuntimeExports.jsx(RefIcon$H,{}),label:"加载演示",path:"/loading-demo",className:"main-menu-item",permission:"admin"},{key:"notification-templates",icon:jsxRuntimeExports.jsx(RefIcon$G,{}),label:"通知模板管理",path:"/notification-templates",className:"main-menu-item",permission:"admin"}]},{key:"approval-flows",icon:jsxRuntimeExports.jsx(RefIcon$w,{}),label:"审批管理",className:"main-menu-submenu-title",children:[{key:"approval-flows-list",icon:jsxRuntimeExports.jsx(RefIcon$w,{}),label:"审批流管理",path:"/approval-flows",className:"main-menu-item",permission:"approval_manage"},{key:"approval-details",icon:jsxRuntimeExports.jsx(RefIcon$J,{}),label:"审批明细",path:"/approval-details",className:"main-menu-item"},{key:"approval-performance",icon:jsxRuntimeExports.jsx(RefIcon$K,{}),label:"性能监控",path:"/approval-performance",className:"main-menu-item",permission:"approval_manage"}]}],n);return React$2.useEffect(()=>{},[l,c,o,a,d.length]),jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[!r&&jsxRuntimeExports.jsx("div",{style:{padding:"0px 12px 16px 12px",background:"#fff"},children:jsxRuntimeExports.jsx(Input$1,{className:"custom-search-input",placeholder:"搜索菜单",allowClear:!0,value:n,onChange:e=>i(e.target.value),size:r?"small":"middle",prefix:jsxRuntimeExports.jsx(RefIcon$8,{style:{color:"#bbb"}})})}),jsxRuntimeExports.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,width:"100%",padding:"0 8px"},children:[l&&jsxRuntimeExports.jsx("div",{style:{padding:"16px",textAlign:"center",color:"#999",fontSize:"12px"},children:"正在加载权限..."}),jsxRuntimeExports.jsx(Menu,{mode:"inline",selectedKeys:[e],onClick:e=>{t(e.key)},inlineCollapsed:r,items:d,style:{height:"100%",width:"100%",borderRadius:"0px",boxShadow:"none",border:"none"}})]}),jsxRuntimeExports.jsxs("div",{style:{flexShrink:0,borderTop:"1px solid #f0f0f0",backgroundColor:"#fafafa",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px"},children:[s&&jsxRuntimeExports.jsx(Button$1,{type:"text",icon:r?jsxRuntimeExports.jsx(RefIcon$m,{}):jsxRuntimeExports.jsx(RefIcon$l,{}),onClick:()=>s(!r),style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"}}),jsxRuntimeExports.jsx(VersionDisplay,{style:{color:"#bbb",fontSize:12},showDetails:!0,showRefreshButton:!0})]})]})},statusColorMap={active:"green",pending:"red",invited:"gold",disabled:"gray"},statusTextMap={active:"已激活",pending:"未激活",invited:"待注册",disabled:"已禁用"},DepartmentPage=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(null),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(!1),[l]=Form$4.useForm(),[c,u]=reactExports.useState(!1),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState(!1),[x]=Form$4.useForm(),[f]=Form$4.useForm(),[g,y]=reactExports.useState([]),[v,E]=reactExports.useState([]),{canManageOrganization:j,canManageUser:b}=useRolePermissions(),[w,R]=reactExports.useState(""),[_,S]=reactExports.useState([]);reactExports.useEffect(()=>{C(),k()},[]),reactExports.useEffect(()=>{$(r?r.id:null)},[r]),reactExports.useEffect(()=>{T()},[n]);const C=async()=>{const{data:e}=await supabase.from("organizations").select("*");if(!e)return void t([]);const r=e.map(e=>e.admin).filter(Boolean);let s=[];if(r.length>0){const{data:e}=await supabase.from("users_profile").select("user_id, nickname, email").in("user_id",r);s=e||[]}const n=e.map(e=>({...e,admin_profile:s.find(t=>t.user_id===e.admin)||null}));t(n)},k=async()=>{const{data:e}=await supabase.from("users_profile").select("user_id, nickname, email");y(e||[])},$=async t=>{if(u(!0),i([]),!t){const{data:e}=await supabase.from("users_profile").select("id, user_id, organization_id, nickname, email, status, organizations(name)"),t=(null==e?void 0:e.map(e=>e.id).filter(Boolean))||[];let r=[];if(t.length>0){const{data:e}=await supabase.from("user_points_wallet").select("user_id, total_points").in("user_id",t);r=e||[]}let s=[];if(t.length>0){const{data:e}=await supabase.from("users_list").select("id, groupname, list, allocation").overlaps("list",t),r=await Promise.all((e||[]).map(async e=>{const r=t.map(async e=>{const{data:t}=await supabase.rpc("get_user_allocation_status_multi",{p_user_id:e});return{profileId:e,status:t}});return{...e,user_statuses:await Promise.all(r)}}));s=r}const n=(null==e?void 0:e.map(e=>{const t=r.find(t=>t.user_id===e.id),n=s.filter(t=>t.list&&t.list.includes(e.id));return{...e,points:(null==t?void 0:t.total_points)||0,sales_groups:n}}))||[];return i(n),void u(!1)}const r=function(e,t){const r=[t],s=t=>{e.filter(e=>e.parent_id===t).forEach(e=>{r.push(e.id),s(e.id)})};return s(t),r}(e,t),{data:s}=await supabase.from("users_profile").select("id, user_id, organization_id, nickname, email, status, organizations(name)").in("organization_id",r),n=(null==s?void 0:s.map(e=>e.id).filter(Boolean))||[];let o=[];if(n.length>0){const{data:e}=await supabase.from("user_points_wallet").select("user_id, total_points").in("user_id",n);o=e||[]}let a=[];if(n.length>0){const{data:e}=await supabase.from("users_list").select("id, groupname, list, allocation").overlaps("list",n),t=await Promise.all((e||[]).map(async e=>{const t=n.map(async e=>{const{data:t}=await supabase.rpc("get_user_allocation_status_multi",{p_user_id:e});return{profileId:e,status:t}});return{...e,user_statuses:await Promise.all(t)}}));a=t}const l=(null==s?void 0:s.map(e=>{const t=o.find(t=>t.user_id===e.id),r=a.filter(t=>t.list&&t.list.includes(e.id));return{...e,points:(null==t?void 0:t.total_points)||0,sales_groups:r}}))||[];i(l),u(!1)},T=()=>{if(!w.trim())return void i(n);const e=w.toLowerCase(),t=n.filter(t=>{var r,s,n,i;return(null==(r=t.nickname)?void 0:r.toLowerCase().includes(e))||(null==(s=t.email)?void 0:s.toLowerCase().includes(e))||(null==(i=null==(n=t.organizations)?void 0:n.name)?void 0:i.toLowerCase().includes(e))});i(t)},I=(e,t,r=!1)=>{if(!t.trim()||!e)return e;const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${s})`,"gi");return e.split(n).map((e,t)=>n.test(e)?jsxRuntimeExports.jsx("span",{className:r?"tree-highlight-person":"tree-highlight-dept",children:e},t):e)},P=(e,t=null,r=[])=>{let s=[];return e.filter(e=>e.parent_id===t).forEach(t=>{const i=w&&t.name&&t.name.toLowerCase().includes(w.toLowerCase()),o=n.filter(e=>e.organization_id===t.id).some(e=>w&&e.nickname&&e.nickname.toLowerCase().includes(w.toLowerCase()));(i||o)&&(s=s.concat(r,[t.id])),s=s.concat(P(e,t.id,r.concat(t.id)))}),Array.from(new Set(s))};reactExports.useEffect(()=>{w.trim()?S(P(e)):S([])},[w,e,n]);const A=(e,t=null)=>e.filter(e=>e.parent_id===t).map(t=>{const r=n.filter(e=>e.organization_id===t.id),s=r.map(e=>({key:`user_${e.user_id||e.email}`,title:jsxRuntimeExports.jsx("span",{className:"tree-member-node",children:jsxRuntimeExports.jsx("span",{className:"tree-member-name",children:I(e.nickname||"未命名",w,!0)})}),isLeaf:!0,selectable:!1}));return{title:jsxRuntimeExports.jsxs("span",{className:"tree-dept-node",children:[I(t.name,w,!1),r.length>0&&jsxRuntimeExports.jsxs("span",{className:"dept-member-count",children:[r.length,"人"]})]}),key:t.id,children:[...s,...A(e,t.id)]}});const F=e=>!!e&&j(e),M=async()=>{try{const{error:e}=await supabase.from("organizations").update({admin:null}).eq("id",r.id).select().single();if(e)throw new Error(e.message);staticMethods.success("管理员移除成功"),C()}catch(e){staticMethods.error("移除失败: "+e.message)}},[D,O]=reactExports.useState(!1),N=React$2.useMemo(()=>{const e=n.filter(e=>"left"!==e.status),t=n.filter(e=>"left"===e.status);return D?[...e,...t]:e},[n,D]),[B,L]=reactExports.useState(1),[z,V]=reactExports.useState(20),U=React$2.useMemo(()=>{const e=(B-1)*z;return N.slice(e,e+z)},[N,B,z]);return jsxRuntimeExports.jsxs("div",{className:"dept-page-container",children:[jsxRuntimeExports.jsxs("div",{className:"dept-tree-container",style:{width:320},children:[jsxRuntimeExports.jsx("div",{className:"dept-search-section",children:jsxRuntimeExports.jsx(Input$1,{className:"dept-search-input",size:"middle",allowClear:!0,placeholder:"搜索部门或人员名称",value:w,onChange:e=>R(e.target.value),prefix:jsxRuntimeExports.jsx(RefIcon$8,{style:{color:"#bbb"}})})}),jsxRuntimeExports.jsx("div",{className:"dept-tree-wrapper",children:jsxRuntimeExports.jsx("div",{className:"dept-tree-content",children:jsxRuntimeExports.jsx(Tree,{className:"dept-tree",treeData:A(e),draggable:e=>!String(e.key).startsWith("user_"),showLine:!1,expandedKeys:w.trim()?_:v,onExpand:e=>E(e),selectedKeys:r?[r.id]:[],onSelect:(e,{node:t})=>{!t||void 0===t.key||null===t.key||String(t.key).startsWith("user_")?s(null):s({id:String(t.key),name:t.title})},onDrop:async t=>{const r=String(t.dragNode.key),s=String(t.node.key);if(String(r).startsWith("user_")||String(s).startsWith("user_"))return;if(!j(s))return void staticMethods.warning("无权限调整到该部门下");if((t=>{const r=[t],s=t=>{e.filter(e=>e.parent_id===t).forEach(e=>{r.push(e.id),s(e.id)})};return s(t),r})(r).includes(s))return void staticMethods.warning("不能拖拽到自身或子节点下");const n=t.dropToGap?null:s;await supabase.from("organizations").update({parent_id:n}).eq("id",r),staticMethods.success("部门关系已调整"),C()}})})}),jsxRuntimeExports.jsx("div",{className:"dept-tree-actions",children:F(null==r?void 0:r.id)&&jsxRuntimeExports.jsx(Button$1,{type:"primary",className:"dept-add-btn",onClick:()=>p(!0),children:"新增部门"})})]}),jsxRuntimeExports.jsxs("div",{className:"dept-content-area",children:[jsxRuntimeExports.jsxs("div",{className:"dept-page-header",children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[jsxRuntimeExports.jsx("h2",{className:"dept-page-title",children:(null==r?void 0:r.name)||"全部人员"}),r&&(()=>{const t=e.find(e=>e.id===r.id);return(null==t?void 0:t.admin_profile)?jsxRuntimeExports.jsxs(Tag$1,{color:"blue",className:"dept-status-badge",children:["管理员: ",t.admin_profile.nickname]}):null})()]}),jsxRuntimeExports.jsxs("div",{className:"dept-action-buttons",children:[F(null==r?void 0:r.id)&&jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"large",style:{borderRadius:"12px",fontWeight:600,height:"40px",padding:"0 20px",background:"linear-gradient(135deg, #1677ff 0%, #4096ff 100%)",border:"none",boxShadow:"0 4px 12px rgba(22, 119, 255, 0.3)"},onClick:()=>a(!0),disabled:!r,children:"邀请成员"}),r&&jsxRuntimeExports.jsx(Dropdown,{menu:{items:[...(()=>{const e=[];return F(null==r?void 0:r.id)&&(e.push({key:"set-admin",icon:jsxRuntimeExports.jsx(RefIcon$D,{}),label:"设置管理员",onClick:()=>h(!0)}),(null==r?void 0:r.admin)&&e.push({key:"remove-admin",icon:jsxRuntimeExports.jsx(RefIcon$b,{style:{color:"orange"}}),label:"移除管理员",danger:!0,onClick:()=>{Modal$2.confirm({title:"确认移除该部门管理员？",content:"移除后该部门将没有管理员，只有上级管理员可以管理。",okText:"移除",okType:"danger",cancelText:"取消",onOk:M})}}),e.push({key:"delete",icon:jsxRuntimeExports.jsx(RefIcon$b,{style:{color:"red"}}),label:"删除部门",danger:!0,onClick:()=>{Modal$2.confirm({title:"确认删除该部门？",content:"删除后该部门及其所有子部门将被移除，且该部门下成员将变为未分配状态。",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{await supabase.from("organizations").delete().eq("id",r.id),s(null),C(),$(null)}})}})),e})()]},trigger:["click"],children:jsxRuntimeExports.jsx(Button$1,{type:"text",icon:jsxRuntimeExports.jsx(RefIcon$L,{}),style:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"}})})]})]}),jsxRuntimeExports.jsxs("div",{className:"page-table-wrap",style:{width:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{width:"100%",overflow:"auto"},children:jsxRuntimeExports.jsx(ForwardTable,{className:"page-table",dataSource:U,loading:c,rowKey:e=>e.user_id||e.email||`temp_${e.email}_${e.nickname||"unknown"}`,scroll:{x:"max-content"},columns:[{title:"姓名",dataIndex:"nickname",className:"page-col-nowrap",width:120,render:e=>jsxRuntimeExports.jsx("span",{style:{fontWeight:600,color:"#262626"},children:e||"未命名"})},...F(null==r?void 0:r.id)?[{title:"邮箱",dataIndex:"email",className:"page-col-nowrap",width:200,render:e=>jsxRuntimeExports.jsx("span",{style:{color:"#595959",fontFamily:"monospace"},children:e||"-"})}]:[],{title:"部门",dataIndex:["organizations","name"],className:"page-col-nowrap",width:150,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{borderRadius:"8px",fontSize:"12px",fontWeight:500,padding:"4px 8px"},children:e||"未分配"})},...F(null==r?void 0:r.id)?[{title:"状态",dataIndex:"status",className:"page-col-nowrap",width:120,render:e=>jsxRuntimeExports.jsx(Badge$2,{color:"left"===e?"gray":statusColorMap[e]||"gray",text:"left"===e?"已离职":statusTextMap[e]||"未知",style:{fontSize:"12px"}})},{title:"剩余积分",dataIndex:"points",className:"page-col-nowrap",width:120,render:e=>jsxRuntimeExports.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",color:e>0?"#52c41a":"#ff4d4f",fontWeight:600,fontSize:"14px"},children:[jsxRuntimeExports.jsx(RefIcon$C,{style:{fontSize:"12px",marginRight:"4px"}}),e||0]})},{title:"销售组状态",dataIndex:"sales_groups",className:"page-col-nowrap",width:100,render:(e,t)=>{if(!e||0===e.length)return jsxRuntimeExports.jsx("span",{style:{color:"#8c8c8c",fontSize:"12px"},children:"未加入"});const r=e.filter(e=>e.list&&e.list.includes(t.id));if(0===r.length)return jsxRuntimeExports.jsx("span",{style:{color:"#8c8c8c",fontSize:"12px"},children:"未加入"});const s=r.some(e=>{var r;const s=null==(r=e.user_statuses)?void 0:r.find(e=>e.profileId===t.id);if(!(null==s?void 0:s.status)||!Array.isArray(s.status))return!1;const n=s.status.find(t=>t.groupname===e.groupname);return n&&!n.can_allocate});return jsxRuntimeExports.jsx(Badge$2,{color:s?"red":"green",text:s?"异常":"正常",style:{fontSize:"12px"}})}},{title:"销售组列表",dataIndex:"sales_groups",className:"page-col-nowrap",width:300,render:(e,t)=>{if(!e||0===e.length)return jsxRuntimeExports.jsx("span",{style:{color:"#8c8c8c"},children:"-"});const r=e.filter(e=>e.list&&e.list.includes(t.id));return 0===r.length?jsxRuntimeExports.jsx("span",{style:{color:"#8c8c8c"},children:"-"}):jsxRuntimeExports.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",minHeight:"24px",maxHeight:"80px",alignItems:"flex-start",overflowY:"auto",overflowX:"hidden"},children:r.map(e=>{var r;const s=null==(r=e.user_statuses)?void 0:r.find(e=>e.profileId===t.id);let n=!1,i=[];if((null==s?void 0:s.status)&&Array.isArray(s.status)){const t=s.status.find(t=>t.groupname===e.groupname);n=t&&!t.can_allocate,n&&(null==t?void 0:t.reason)&&Array.isArray(t.reason)&&(i=t.reason)}const o=n&&i.length>0?`${e.groupname}\n异常原因：\n${i.join("\n")}`:e.groupname;return jsxRuntimeExports.jsx(Tooltip,{title:o,placement:"top",styles:{root:{maxWidth:"350px",whiteSpace:"pre-line"}},children:jsxRuntimeExports.jsx(Tag$1,{color:n?"red":"blue",style:{fontSize:"11px",margin:0,padding:"3px 8px",borderRadius:"6px",lineHeight:"1.3",maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"help",display:"inline-block",verticalAlign:"middle"},children:e.groupname})},e.id)})})}},{title:"操作",dataIndex:"actions",width:180,render:(t,s)=>{var n;return!!(n=s.organization_id)&&b(n)?jsxRuntimeExports.jsxs("div",{className:"dept-table-actions",style:{display:"flex",gap:"8px"},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",type:"link",disabled:"left"===s.status,onClick:()=>{Modal$2.confirm({title:"调整部门",content:jsxRuntimeExports.jsx(Select,{style:{width:"100%"},defaultValue:s.organization_id,options:e.map(e=>({value:e.id,label:e.name})),onChange:async e=>{if(!s.user_id)return void staticMethods.error("用户未注册，无法调整部门");const{error:t}=await supabase.from("users_profile").update({organization_id:e}).eq("user_id",s.user_id);t?staticMethods.error("部门调整失败: "+t.message):(staticMethods.success("部门调整成功"),$((null==r?void 0:r.id)??null),Modal$2.destroyAll())}}),okButtonProps:{style:{display:"none"}},cancelText:"取消"})},children:"调整部门"}),jsxRuntimeExports.jsx(Button$1,{danger:!0,size:"small",type:"link",disabled:"left"===s.status,onClick:()=>{Modal$2.confirm({title:"确认将该成员标记为离职？",okText:"离职",okType:"danger",cancelText:"取消",onOk:async()=>{await supabase.from("users_profile").update({status:"left"}).eq("user_id",s.user_id),$((null==r?void 0:r.id)??null)}})},children:"离职"})]}):null}}]:[]],style:{marginTop:0,borderRadius:"12px",width:"100%"},pagination:!1})}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:8,width:"100%",flexWrap:"wrap",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{children:n.some(e=>"left"===e.status)&&!D&&jsxRuntimeExports.jsx(Button$1,{type:"link",className:"no-outline-btn",onClick:()=>O(!0),style:{paddingLeft:0},children:"显示离职成员"})}),jsxRuntimeExports.jsx("div",{style:{flex:1,display:"flex",justifyContent:"flex-end"},children:jsxRuntimeExports.jsx(Pagination,{current:B,pageSize:z,total:N.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:e=>L(e),onShowSizeChange:(e,t)=>{V(t),L(1)}})})]})]})]}),jsxRuntimeExports.jsx(Modal$2,{title:"邀请成员",open:o,onCancel:()=>a(!1),onOk:async()=>{try{const e=await l.validateFields();a(!1),l.resetFields();const{data:t}=await supabase.from("users_profile").select("user_id, status").eq("email",e.email).maybeSingle();if(t&&t.user_id)return void staticMethods.info("用户已注册，请使用“发送密码重置”功能");(async(e,t)=>{try{const{data:{session:s}}=await supabase.auth.getSession();if(!s||!s.user)return void staticMethods.error("用户未登录，请先登录后再邀请成员");const{data:n,error:i}=await supabase.from("users_profile").select("user_id, status").eq("email",e).maybeSingle();if(i&&i.code,n&&n.user_id)return void staticMethods.info('用户已注册，请使用"发送密码重置"功能来发送邮件');if(!(null==r?void 0:r.id))return void staticMethods.error("请先选择要邀请用户加入的部门");const o=`invite_${e}_${toBeijingTime(new Date).valueOf()}`;staticMethods.loading({content:"正在发送邀请邮件...",key:o,duration:0}),withRetry(async()=>{var s,n,i;const{data:a,error:l}=await supabase.functions.invoke("invite-user",{body:{email:e,name:t||e.split("@")[0],organizationId:r.id,redirectTo:`${window.location.origin}/set-password`}});if(l){let e="邀请用户失败";throw(null==(s=l.message)?void 0:s.includes("未授权"))?e="认证失败，请刷新页面重新登录":(null==(n=l.message)?void 0:n.includes("无权管理"))?e="您没有权限管理此部门":(null==(i=l.message)?void 0:i.includes("已被注册"))?e="该邮箱已被注册，无法重复邀请":l.message&&(e=l.message),staticMethods.error({content:e,key:o,duration:3}),new Error(e)}return staticMethods.success({content:"邀请邮件已发送！用户将收到注册邀请邮件。",key:o,duration:3}),setTimeout(()=>{$((null==r?void 0:r.id)??null)},1e3),a},supabaseRetryOptions).catch(e=>{staticMethods.error({content:"邀请发送失败: "+(e.message||"网络错误"),key:o,duration:3})})}catch(s){staticMethods.error("邀请用户失败: "+(s.message||"未知错误"))}})(e.email,e.name)}catch(e){staticMethods.error("邀请成员失败: "+e.message)}},okText:"发送邀请",children:jsxRuntimeExports.jsxs(Form$4,{form:l,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"email",label:"邮箱",rules:[{required:!0,type:"email"}],extra:"只有部门管理员可以查看和邀请成员",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入邮箱地址"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"姓名",rules:[{required:!0}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入姓名"})})]})}),F(null==r?void 0:r.id)&&jsxRuntimeExports.jsx(Modal$2,{title:"新增部门",open:d,onCancel:()=>p(!1),onOk:async()=>{const e=await x.validateFields(),{data:t,error:n}=await supabase.from("organizations").insert({name:e.name,parent_id:(null==r?void 0:r.id)??null}).select();!n&&t&&t[0]&&(p(!1),x.resetFields(),await C(),s({id:t[0].id,name:t[0].name}),$(t[0].id))},okText:"保存",children:jsxRuntimeExports.jsx(Form$4,{form:x,layout:"vertical",children:jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"部门名称",rules:[{required:!0,message:"请输入部门名称"}],children:jsxRuntimeExports.jsx(Input$1,{})})})}),jsxRuntimeExports.jsx(Modal$2,{title:"设置部门管理员",open:m,onCancel:()=>h(!1),onOk:async()=>{try{const e=await f.validateFields(),{error:t}=await supabase.from("organizations").update({admin:e.admin_id}).eq("id",r.id).select().single();if(t)throw new Error(t.message);staticMethods.success("管理员设置成功"),h(!1),f.resetFields(),C()}catch(e){staticMethods.error("设置失败: "+e.message)}},okText:"设置",children:jsxRuntimeExports.jsx(Form$4,{form:f,layout:"vertical",children:jsxRuntimeExports.jsx(Form$4.Item,{name:"admin_id",label:"选择管理员",rules:[{required:!0,message:"请选择管理员"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择管理员",options:g.map(e=>({value:e.user_id,label:`${e.nickname} (${e.email})`}))})})})})]})},{Title:Title$c,Text:Text$f}=Typography,RolePermissionManagement=()=>{const{isSuperAdmin:e,isSystemAdmin:t}=useRolePermissions(),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState([]),[l,c]=reactExports.useState(!0),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(null),[h]=Form$4.useForm(),[x,f]=reactExports.useState(!1),[g,y]=reactExports.useState(null),[v]=Form$4.useForm(),[E,j]=reactExports.useState([]),[b,w]=reactExports.useState([]),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState(null),[k]=Form$4.useForm(),[$,T]=reactExports.useState([]),[I,P]=reactExports.useState(""),[A,F]=reactExports.useState([]);reactExports.useEffect(()=>{M()},[]);const M=async()=>{try{c(!0);const{data:e,error:t}=await supabase.from("roles").select("*").order("name");if(t)throw t;s(e||[]);const{data:r,error:n}=await supabase.from("permissions").select("*").order("name");if(n)throw n;i(r||[]);const{data:o,error:l}=await supabase.from("users_profile").select("id, user_id, nickname, email, status").order("nickname");if(l)throw l;a(o||[]),F(o||[]);const{data:u,error:d}=await supabase.from("user_roles").select("\n          user_id,\n          role_id,\n          roles(name, description)\n        ");if(d)throw d;T(u||[]);const{data:p,error:m}=await supabase.from("role_permissions").select("\n          role_id,\n          permission_id,\n          roles(name),\n          permissions(name, resource, action)\n        ");m||j(p||[])}catch(e){staticMethods.error("获取数据失败")}finally{c(!1)}},D=e=>{if(P(e),!e.trim())return void F(o);const t=o.filter(t=>{var r,s;return(null==(r=t.nickname)?void 0:r.toLowerCase().includes(e.toLowerCase()))||(null==(s=t.email)?void 0:s.toLowerCase().includes(e.toLowerCase()))});F(t)},O=[{title:"权限信息",key:"permission_info",render:(e,t)=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"4px"},children:jsxRuntimeExports.jsx(Text$f,{strong:!0,style:{fontSize:"14px"},children:t.name})}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"6px"},children:t.description}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{marginRight:"4px"},children:t.resource}),jsxRuntimeExports.jsx(Tag$1,{color:"green",children:t.action})]})]})},{title:"操作",key:"action",width:120,render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>(async e=>{m(e),d(!0),setTimeout(()=>{h.setFieldsValue({name:e.name,description:e.description,resource:e.resource,action:e.action})},100)})(t),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定要删除这个权限点吗？",onConfirm:()=>(async e=>{try{const{error:t}=await supabase.from("permissions").delete().eq("id",e);if(t)throw t;staticMethods.success("权限点删除成功"),M()}catch(t){staticMethods.error(`删除权限点失败: ${t.message||"未知错误"}`)}})(t.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),children:"删除"})})]})}],N=[{title:"角色信息",key:"role_info",width:"25%",render:(e,t)=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"4px"},children:jsxRuntimeExports.jsx(Space$1,{children:jsxRuntimeExports.jsx(Text$f,{strong:!0,style:{fontSize:"14px"},children:t.name})})}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.description})]})},{title:"权限",key:"permissions",width:"50%",render:(e,t)=>{const r=(s=t.id,E.filter(e=>e.role_id===s).map(e=>e.permissions));var s;return jsxRuntimeExports.jsx("div",{children:r.length>0?(()=>{const e=r.reduce((e,t)=>{const r=t.resource;return e[r]||(e[r]=[]),e[r].push(t),e},{}),t=Object.keys(e).length,s=r.length;return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"4px"},children:[Object.entries(e).slice(0,2).map(([e,t])=>jsxRuntimeExports.jsxs(Tag$1,{color:"blue",style:{marginBottom:"2px"},children:[e," (",t.length,")"]},e)),t>2&&jsxRuntimeExports.jsxs(Tag$1,{color:"default",children:["+",t-2," 资源"]})]}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["共 ",s," 个权限"]})]})})():jsxRuntimeExports.jsx(Text$f,{type:"secondary",style:{fontSize:"12px"},children:"无权限"})})}},{title:"用户数量",key:"user_count",width:"10%",render:(e,t)=>{const r=$.filter(e=>e.role_id===t.id).length;return jsxRuntimeExports.jsxs(Text$f,{type:"secondary",style:{fontSize:"12px"},children:[r," 人"]})}},{title:"操作",key:"action",width:"15%",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>(async e=>{y(e),f(!0),setTimeout(async()=>{v.setFieldsValue({name:e.name,description:e.description});const{data:t,error:r}=await supabase.from("role_permissions").select("permission_id").eq("role_id",e.id);if(r)v.setFieldsValue({permissions:[]}),w([]);else{const e=(null==t?void 0:t.map(e=>e.permission_id))||[];v.setFieldsValue({permissions:e}),w(e)}},100)})(t),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定要删除这个角色吗？",onConfirm:()=>(async e=>{try{const{error:t}=await supabase.from("roles").delete().eq("id",e);if(t)throw t;staticMethods.success("角色删除成功"),M()}catch(t){staticMethods.error(`删除角色失败: ${t.message||"未知错误"}`)}})(t.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),children:"删除"})})]})}],B=[{title:"用户信息",key:"user",render:e=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"4px"},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#1890ff"}}),jsxRuntimeExports.jsx(Text$f,{strong:!0,style:{fontSize:"14px"},children:e.nickname||"未设置昵称"})]})}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.email})]})},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>jsxRuntimeExports.jsx(Badge$2,{status:"active"===e?"success":"default",text:"active"===e?"活跃":"非活跃"})},{title:"当前角色",key:"roles",render:e=>{const t=$.filter(t=>t.user_id===e.user_id);return jsxRuntimeExports.jsx("div",{style:{maxWidth:"250px"},children:t.length>0?jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[t.slice(0,2).map(e=>{var t;return jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:(null==(t=e.roles)?void 0:t.name)||"未知角色"},e.role_id)}),t.length>2&&jsxRuntimeExports.jsxs(Tag$1,{color:"default",children:["+",t.length-2," 更多"]})]}):jsxRuntimeExports.jsx(Text$f,{type:"secondary",style:{fontSize:"12px"},children:"无角色"})})}},{title:"操作",key:"action",width:120,render:e=>jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$N,{}),onClick:()=>{C(e),_(!0)},children:"分配角色"})}],L=jsxRuntimeExports.jsx(Card$1,{title:"权限点配置",extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{m(null),d(!0),setTimeout(()=>{h.resetFields()},100)},children:"创建权限点"}),children:(()=>{const e=n.reduce((e,t)=>{const r=t.resource;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.entries(e).map(([e,t])=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"24px"},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"12px",padding:"8px 0",borderBottom:"2px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$f,{strong:!0,style:{fontSize:"15px",color:"#262626"},children:e}),jsxRuntimeExports.jsxs(Text$f,{type:"secondary",style:{fontSize:"12px",marginLeft:"8px"},children:[t.length," 个权限"]})]})}),jsxRuntimeExports.jsx(ForwardTable,{columns:O,dataSource:t,rowKey:"id",loading:l,pagination:!1,size:"small",style:{backgroundColor:"white"}})]},e))})()}),z=jsxRuntimeExports.jsx(Card$1,{title:"角色管理",extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{y(null),f(!0),w([]),v.resetFields()},children:"创建角色"}),children:jsxRuntimeExports.jsx(ForwardTable,{columns:N,dataSource:r,rowKey:"id",loading:l,pagination:!1})}),V=jsxRuntimeExports.jsxs(Card$1,{title:"人员角色配置",children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"16px"},children:jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"搜索用户昵称或邮箱",allowClear:!0,enterButton:jsxRuntimeExports.jsx(RefIcon$8,{}),size:"large",value:I,onChange:e=>D(e.target.value),onSearch:D,style:{maxWidth:"400px"}})}),jsxRuntimeExports.jsx(ForwardTable,{columns:B,dataSource:A,rowKey:"id",loading:l,pagination:!1})]});return e||t?jsxRuntimeExports.jsxs("div",{style:{padding:"24px"},children:[jsxRuntimeExports.jsxs(Title$c,{level:3,style:{marginBottom:"24px"},children:[jsxRuntimeExports.jsx(RefIcon$F,{style:{marginRight:"8px"}}),"角色权限管理"]}),jsxRuntimeExports.jsx(Tabs,{defaultActiveKey:"1",items:[{key:"1",label:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$M,{}),"权限点配置"]}),children:L},{key:"2",label:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$F,{}),"角色管理"]}),children:z},{key:"3",label:jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx(RefIcon$N,{}),"人员角色配置"]}),children:V}]}),jsxRuntimeExports.jsx(Modal$2,{title:p?"编辑权限点":"创建权限点",open:u,onCancel:()=>{d(!1),m(null),h.resetFields()},onOk:()=>h.submit(),destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:h,onFinish:p?async e=>{try{const{error:t}=await supabase.from("permissions").update({name:e.name,description:e.description,resource:e.resource,action:e.action}).eq("id",p.id);if(t)throw t;staticMethods.success("权限点更新成功"),d(!1),m(null),h.resetFields(),M()}catch(t){staticMethods.error(`更新权限点失败: ${t.message||"未知错误"}`)}}:async e=>{try{const{error:t}=await supabase.from("permissions").insert({name:e.name,description:e.description,resource:e.resource,action:e.action});if(t)throw t;staticMethods.success("权限点创建成功"),d(!1),h.resetFields(),M()}catch(t){staticMethods.error(`创建权限点失败: ${t.message||"未知错误"}`)}},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"权限名称",rules:[{required:!0,message:"请输入权限名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：lead_manage"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"权限描述",rules:[{required:!0,message:"请输入权限描述"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：线索管理权限"})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"resource",label:"资源",rules:[{required:!0,message:"请输入资源名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：leads"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"action",label:"操作",rules:[{required:!0,message:"请输入操作名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：manage"})})})]})]})}),jsxRuntimeExports.jsx(Modal$2,{title:g?"编辑角色":"创建角色",open:x,onCancel:()=>{f(!1),y(null),w([]),v.resetFields()},onOk:()=>v.submit(),width:600,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:v,onFinish:g?async e=>{try{const{error:t}=await supabase.from("roles").update({name:e.name,description:e.description}).eq("id",g.id);if(t)throw t;const{data:r,error:s}=await supabase.from("role_permissions").select("\n          permission_id,\n          permissions(resource, action)\n        ").eq("role_id",g.id);let n=[];if(Array.isArray(b)&&b.length>0)n=b;else{const t=v.getFieldValue("permissions");Array.isArray(t)&&t.length>0?n=t:Array.isArray(e.permissions)&&e.permissions.length>0?n=e.permissions:e.permissions&&(n=[e.permissions])}const i=(null==r?void 0:r.map(e=>e.permission_id))||[],o=n,a=o.filter(e=>!i.includes(e)),l=i.filter(e=>!o.includes(e));if(l.length>0){const{error:e}=await supabase.from("role_permissions").delete().eq("role_id",g.id).in("permission_id",l)}if(a.length>0){const e=a.map(e=>({role_id:g.id,permission_id:e})),{error:t}=await supabase.from("role_permissions").insert(e).select()}0===a.length&&l.length;const{error:c}=await supabase.from("role_permissions").select("\n          role_id,\n          permission_id,\n          permissions(name, resource, action)\n        ").eq("role_id",g.id);staticMethods.success("角色更新成功"),f(!1),y(null),v.resetFields(),M()}catch(t){staticMethods.error(`更新角色失败: ${t.message||"未知错误"}`)}}:async e=>{try{const{data:t,error:r}=await supabase.from("roles").insert({name:e.name,description:e.description}).select().single();if(r)throw r;let s=[];if(Array.isArray(b)&&b.length>0)s=b;else{const t=v.getFieldValue("permissions");Array.isArray(t)&&t.length>0?s=t:Array.isArray(e.permissions)&&e.permissions.length>0?s=e.permissions:e.permissions&&(s=[e.permissions])}if(s.length>0){const e=s.map(e=>({role_id:t.id,permission_id:e})),{error:r}=await supabase.from("role_permissions").insert(e).select()}const{error:n}=await supabase.from("role_permissions").select("\n          role_id,\n          permission_id,\n          permissions(name, resource, action)\n        ").eq("role_id",t.id);staticMethods.success("角色创建成功"),f(!1),v.resetFields(),M()}catch(t){staticMethods.error(`创建角色失败: ${t.message||"未知错误"}`)}},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：manager"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"例如：部门经理角色"})}),jsxRuntimeExports.jsxs(Form$4.Item,{name:"permissions",label:"选择权限",children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:"8px",padding:"6px 10px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"11px",color:"#52c41a"},children:["✓ 已选择 ",b.length," 个权限"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",padding:"8px",backgroundColor:"#fafafa",borderRadius:"6px"},children:jsxRuntimeExports.jsx(Checkbox.Group,{style:{width:"100%"},value:b,onChange:e=>{v.setFieldsValue({permissions:e}),w(e)},children:(()=>{const e=n.reduce((e,t)=>{const r=t.resource;return e[r]||(e[r]=[]),e[r].push(t),e},{}),t=[];return Object.entries(e).forEach(([e,r])=>{t.push({type:"header",resource:e,perms:r}),r.forEach(r=>{t.push({type:"permission",permission:r,resource:e})})}),jsxRuntimeExports.jsx("div",{children:(()=>{let e=[];const r=[];return t.forEach(t=>{"header"===t.type?(e.length>0&&(r.push(e),e=[]),r.push([t])):(e.push(t),2===e.length&&(r.push(e),e=[]))}),e.length>0&&r.push(e),r.map((e,t)=>jsxRuntimeExports.jsx(Row,{gutter:[12,4],style:{marginBottom:"4px"},children:e.map((e,r)=>jsxRuntimeExports.jsx(Col,{span:"header"===e.type?24:12,children:"header"===e.type?jsxRuntimeExports.jsx("div",{style:{marginTop:t>0?"8px":"0",marginBottom:"4px",padding:"6px 10px",backgroundColor:"#f8f9fa",borderRadius:"4px"},children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$f,{strong:!0,style:{fontSize:"13px",color:"#262626"},children:e.resource}),jsxRuntimeExports.jsxs(Text$f,{type:"secondary",style:{fontSize:"11px",marginLeft:"6px"},children:[e.perms.length," 个权限"]})]})}):jsxRuntimeExports.jsx(Checkbox,{value:e.permission.id,style:{width:"100%"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 10px",backgroundColor:"white",borderRadius:"4px",transition:"all 0.2s",border:"1px solid transparent",marginBottom:"2px"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1,marginRight:"8px"},children:jsxRuntimeExports.jsx("div",{style:{fontWeight:"500",fontSize:"12px",color:"#262626",lineHeight:"1.3"},children:e.permission.description||e.permission.name})}),jsxRuntimeExports.jsx(Tag$1,{color:"green",style:{fontSize:"9px",padding:"0 4px",flexShrink:0},children:e.permission.action})]})})},r))},t))})()})})()})})]})]})}),jsxRuntimeExports.jsx(Modal$2,{title:"分配角色",open:R,onCancel:()=>{_(!1),C(null),k.resetFields()},footer:null,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:k,layout:"vertical",onFinish:async e=>{try{const{data:t,error:r}=await supabase.from("roles").select("id").eq("name",e.role_name).single();if(r||!t)throw new Error("角色不存在");const{error:s}=await supabase.from("user_roles").insert({user_id:S.user_id,role_id:t.id});if(s)throw s;staticMethods.success("角色分配成功"),_(!1),C(null),k.resetFields(),M()}catch(t){staticMethods.error(`分配角色失败: ${t.message||"未知错误"}`)}},children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"用户",children:jsxRuntimeExports.jsxs(Text$f,{children:[null==S?void 0:S.nickname," (",null==S?void 0:S.email,")"]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"role_name",label:"选择角色",rules:[{required:!0,message:"请选择角色"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择角色",children:r.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.name,children:e.name},e.name))})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"分配"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{_(!1),C(null),k.resetFields()},children:"取消"})]})})]})})]}):jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[jsxRuntimeExports.jsx(RefIcon$F,{style:{fontSize:"48px",color:"#d9d9d9",marginBottom:"16px"}}),jsxRuntimeExports.jsx(Title$c,{level:4,children:"您没有权限管理角色和权限"}),jsxRuntimeExports.jsx(Text$f,{type:"secondary",children:"请联系系统管理员获取相应权限"})]})})},rules$1={getRules:async()=>{try{const{data:e,error:t}=await supabase.from("simple_allocation_rules").select("*").order("priority");if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取分配规则失败"}}},createRule:async e=>{try{const{data:t,error:r}=await supabase.from("simple_allocation_rules").insert([e]).select().single();if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"创建分配规则失败"}}},updateRule:async(e,t)=>{try{const{data:r,error:s}=await supabase.from("simple_allocation_rules").update(t).eq("id",e).select().single();if(s)throw s;return{success:!0,data:r}}catch(r){return{success:!1,error:"更新分配规则失败"}}},deleteRule:async e=>{try{const{error:t}=await supabase.from("simple_allocation_rules").delete().eq("id",e);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:"删除分配规则失败"}}},testAllocation:async e=>{try{const{data:t,error:r}=await supabase.rpc("test_allocation",{p_source:e.source,p_leadtype:e.leadtype,p_community:e.community,p_test_mode:e.test_mode??!0});if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"测试分配失败",details:t instanceof Error?t.message:"未知错误"}}}},groups={getGroups:async()=>{try{const{data:e,error:t}=await supabase.from("users_list").select("*").order("groupname");if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取销售组失败"}}},createGroup:async e=>{try{const{data:t,error:r}=await supabase.from("users_list").insert([e]).select().single();if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"创建销售组失败",details:t instanceof Error?t.message:"未知错误"}}},updateGroup:async(e,t)=>{try{const{data:r,error:s}=await supabase.from("users_list").update(t).eq("id",e).select().single();if(s)throw s;return{success:!0,data:r}}catch(r){return{success:!1,error:"更新销售组失败"}}},deleteGroup:async e=>{try{const{error:t}=await supabase.from("users_list").delete().eq("id",e);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:"删除销售组失败"}}}},logs={getLogs:async({limit:e=50}={})=>{try{const{data:t,error:r}=await supabase.from("simple_allocation_logs").select("*").order("created_at",{ascending:!1}).limit(e);if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"获取分配日志失败"}}}},stats$1={getStats:async()=>{try{const{data:e,error:t}=await supabase.rpc("get_allocation_stats");if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取统计数据失败"}}}},enums={getSourceTypes:async()=>{try{const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"source"});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取来源类型失败"}}},getCommunityTypes:async()=>{try{const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"community"});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取社区类型失败"}}},getAllocationMethods:async()=>{try{const{data:e,error:t}=await supabase.rpc("get_enum_values",{enum_name:"allocation_method"});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取分配方式失败"}}},getCommunityKeywords:async()=>{try{const{data:e,error:t}=await supabase.from("community_keywords").select("*").order("priority",{ascending:!1});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取社区关键词失败"}}}},communityKeywords={getKeywords:async()=>{try{const{data:e,error:t}=await supabase.from("community_keywords").select("*").order("priority",{ascending:!1});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取社区关键词失败"}}},createKeyword:async e=>{try{const{data:t,error:r}=await supabase.from("community_keywords").insert([e]).select().single();if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"创建社区关键词失败"}}},updateKeyword:async(e,t)=>{try{const{data:r,error:s}=await supabase.from("community_keywords").update(t).eq("id",e).select().single();if(s)throw s;return{success:!0,data:r}}catch(r){return{success:!1,error:"更新社区关键词失败"}}},deleteKeyword:async e=>{try{const{error:t}=await supabase.from("community_keywords").delete().eq("id",e);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:"删除社区关键词失败"}}}},allocationApi={rules:rules$1,groups:groups,logs:logs,stats:stats$1,enums:enums,communityKeywords:communityKeywords},costRules={getRules:async()=>{try{const{data:e,error:t}=await supabase.from("lead_points_cost").select("*").eq("is_active",!0).order("priority",{ascending:!1});if(t)throw t;return{success:!0,data:e}}catch(e){return{success:!1,error:"获取积分成本规则失败"}}},createRule:async e=>{try{const{data:t,error:r}=await supabase.from("lead_points_cost").insert([e]).select().single();if(r)throw r;return{success:!0,data:t}}catch(t){return{success:!1,error:"创建积分成本规则失败"}}},updateRule:async(e,t)=>{try{const{data:r,error:s}=await supabase.from("lead_points_cost").update(t).eq("id",e).select().single();if(s)throw s;return{success:!0,data:r}}catch(r){return{success:!1,error:"更新积分成本规则失败"}}},deleteRule:async e=>{try{const{error:t}=await supabase.from("lead_points_cost").update({is_active:!1}).eq("id",e);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:"软删除积分成本规则失败"}}}},allocationRecords={getRecords:async(e={})=>{try{let t=supabase.from("simple_allocation_logs").select("*").order("created_at",{ascending:!1});e.leadid&&(t=t.ilike("leadid",`%${e.leadid}%`)),e.assigned_user_id&&(t=t.eq("assigned_user_id",e.assigned_user_id)),e.allocation_method&&(t=t.eq("allocation_method",e.allocation_method));const{data:r,error:s}=await t;if(s)throw s;return{success:!0,data:r}}catch(t){return{success:!1,error:"获取分配记录失败"}}}},stats={getStats:async()=>{try{return{success:!0,data:{total_rules:0,active_rules:0,total_allocations:0,total_points_cost:0}}}catch(e){return{success:!1,error:"获取统计数据失败"}}}},pointsAllocationApi={costRules:costRules,allocationRecords:allocationRecords,stats:stats},ALLOCATION_METHODS=[{value:"round_robin",label:"轮流分配",description:"按顺序轮流分配给销售组成员"},{value:"random",label:"随机分配",description:"随机分配给销售组成员"},{value:"workload",label:"工作量均衡",description:"根据当前工作量自动分配"},{value:"points",label:"积分分配",description:"基于用户积分余额进行分配"}],WEEKDAY_OPTIONS=[{value:1,label:"周一"},{value:2,label:"周二"},{value:3,label:"周三"},{value:4,label:"周四"},{value:5,label:"周五"},{value:6,label:"周六"},{value:7,label:"周日"}];function arrayMoveMutable(e,t,r){const s=t<0?e.length+t:t;if(s>=0&&s<e.length){const s=r<0?e.length+r:r,[n]=e.splice(t,1);e.splice(s,0,n)}}function arrayMoveImmutable(e,t,r){return arrayMoveMutable(e=[...e],t,r),e}const{Text:Text$e,Title:Title$b}=Typography,{Option:Option$8}=Select,AllocationFlowChart=({rules:e,userGroups:t,sourceOptions:r=[],communityOptions:s=[],onRuleDelete:n,onRuleTest:i,onRuleCreate:o,onRuleUpdate:a,onRulesReorder:l})=>{const[c,u]=reactExports.useState([]),[d,p]=reactExports.useState([]),[m,h]=reactExports.useState(null),[x,f]=reactExports.useState(null),[g,y]=reactExports.useState(null),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState(!1),[w,R]=reactExports.useState(null),[_,S]=reactExports.useState(null),[C]=Form$4.useForm(),[k]=Form$4.useForm(),[$,T]=reactExports.useState({});reactExports.useEffect(()=>{(async()=>{try{const e=t.reduce((e,t)=>(t.list&&t.list.length>0&&e.push(...t.list),e),[]);if(0===e.length)return;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname").in("id",e);if(s)throw s;const n=t.reduce((e,t)=>(t.list&&t.list.length>0&&(e[t.id]=t.list.map(e=>null==r?void 0:r.find(t=>t.id===e)).filter(e=>!!e)),e),{});T(n)}catch(e){console.error("加载销售组成员失败:",e),staticMethods.error("加载成员信息失败")}})()},[t]),reactExports.useEffect(()=>{const r=[...e].sort((e,t)=>0===e.priority?1:0===t.priority?-1:t.priority-e.priority),s=r.map(e=>({id:e.id,title:e.name,priority:e.priority,enabled:e.is_active,locked:0===e.priority,data:e})),n=r.map(e=>({triggerId:e.id,lists:(e.user_groups||[]).map((r,s)=>{const n=t.find(e=>e.id===r);return{id:`${e.id}_${r}_${s}`,title:(null==n?void 0:n.groupname)||`销售组${r}`,groupId:r,groupName:(null==n?void 0:n.groupname)||`销售组${r}`,data:n||{}}}).filter(e=>e.data.id)}));u(s),p(n)},[e,t]);const I=e=>{const{conditions:t}=e,r=[];if(t.sources&&t.sources.length>0&&r.push(`来源：${t.sources.join("、")}`),t.communities&&t.communities.length>0&&r.push(`社区：${t.communities.join("、")}`),t.lead_types&&t.lead_types.length>0&&r.push(`类型：${t.lead_types.join("、")}`),t.time_ranges){const{start:e,end:s,weekdays:n}=t.time_ranges,i=e&&s?`${e}-${s}`:"全天",o=null==n?void 0:n.map(e=>{var t;return(null==(t=WEEKDAY_OPTIONS.find(t=>t.value===e))?void 0:t.label)||e}).join("、");r.push(`时间：${i}`),o&&r.push(`工作日：${o}`)}return r.join("\n")},P=e=>{var t,r,s,n,i,o,a;let l=0;return(null==(t=e.conditions.sources)?void 0:t.length)&&l++,(null==(r=e.conditions.communities)?void 0:r.length)&&l++,(null==(s=e.conditions.lead_types)?void 0:s.length)&&l++,((null==(n=e.conditions.time_ranges)?void 0:n.start)||(null==(i=e.conditions.time_ranges)?void 0:i.end)||(null==(a=null==(o=e.conditions.time_ranges)?void 0:o.weekdays)?void 0:a.length))&&l++,0===l?"匹配全部":`已设置 ${l} 个条件`},A=e=>{const t=$[e.groupId]||[];return 0===t.length?"暂无成员":t.map(e=>e.nickname||`成员${e.id}`).join("\n")},F=()=>{b(!1),S(null),k.resetFields()},M=()=>{const e=Date.now(),t=Math.random().toString(36).substring(2,15),r={id:`trigger_${e}_${t}`,title:"新建触发条件",priority:c.length+1,enabled:!0,locked:!1,data:{id:`trigger_${e}_${t}`,name:"新建触发条件",description:"",is_active:!0,priority:c.length+1,conditions:{},user_groups:[],allocation_method:"round_robin",enable_permission_check:!1}};R(r),C.setFieldsValue({title:r.title,sources:[],communities:[],lead_types:[],weekdays:[],allocation_method:"round_robin",enable_permission_check:!1}),E(!0)},D=(t,r,s,n)=>{var i,o;return jsxRuntimeExports.jsx(Tooltip,{title:A(t),placement:"right",styles:{root:{maxWidth:"300px",whiteSpace:"pre-line",fontSize:"12px"}},children:jsxRuntimeExports.jsxs("div",{className:"flow-list-card "+((null==g?void 0:g.row)===s&&(null==g?void 0:g.from)===n?"dragging":""),draggable:!0,onDragStart:e=>{e.stopPropagation(),((e,t)=>{y({row:e,from:t})})(s,n)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),((e,t,r)=>{if(e.preventDefault(),e.stopPropagation(),g&&g.row===t&&g.from!==r){const e=[...d],s=e[t],n=arrayMoveImmutable(s.lists,g.from,r);s.lists=n,p(e),y({row:t,from:r})}})(e,s,n)},onDragEnd:e=>{e.stopPropagation(),(()=>{if(g&&a){const{row:e}=g,t=d[e],r=c[e],s=t.lists.map(e=>e.groupId),n=r.data.user_groups;if(!s.every((e,t)=>e===n[t])){const e={...r.data,user_groups:s};setTimeout(async()=>{try{await a(r.id,e),staticMethods.success(`规则 "${r.title}" 的人员组排序已保存`)}catch(t){staticMethods.error("保存排序失败")}},200)}}setTimeout(()=>{y(null)},100)})()},onClick:()=>(e=>{S(e),k.setFieldsValue({title:e.title,groupId:e.groupId}),b(!0)})(t),style:{cursor:"pointer"},children:[jsxRuntimeExports.jsxs("div",{className:"card-header",children:[jsxRuntimeExports.jsx(RefIcon$N,{className:"card-icon"}),jsxRuntimeExports.jsx("span",{className:"card-title",children:t.groupName}),jsxRuntimeExports.jsx("div",{className:"card-actions",children:jsxRuntimeExports.jsx(Button$1,{type:"text",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$O,{}),onClick:s=>{s.stopPropagation(),((t,r)=>{const s=d.find(e=>e.triggerId===t),n=null==s?void 0:s.lists.find(e=>e.id===r);if(!s||!n)return void staticMethods.error("找不到要删除的清单");if(s.lists.length<=1)return void staticMethods.warning("每条链路至少保留一个人员清单");p(e=>e.map(e=>e.triggerId!==t?e:{...e,lists:e.lists.filter(e=>e.id!==r)}));const i=e.map(e=>e.id===t?{...e,user_groups:e.user_groups.filter(e=>e!==n.groupId)}:e).find(e=>e.id===t);i&&a&&(a(t,i),staticMethods.success("已移除销售组绑定"))})(r,t.id)},title:"移除",className:"card-action-btn"})})]}),jsxRuntimeExports.jsxs("div",{className:"card-content",children:[jsxRuntimeExports.jsxs("div",{className:"config-item",children:[jsxRuntimeExports.jsx("span",{className:"config-label",children:"成员数："}),jsxRuntimeExports.jsxs("span",{className:"config-value",children:[(null==(i=$[t.groupId])?void 0:i.length)||0,"人"]})]}),jsxRuntimeExports.jsxs("div",{className:"config-item",children:[jsxRuntimeExports.jsx("span",{className:"config-label",children:"分配："}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:(null==(o=ALLOCATION_METHODS.find(e=>e.value===t.data.allocation))?void 0:o.label)||"轮流分配"})]})]})]})})},O=e=>{var t;const r=0===e.priority;return jsxRuntimeExports.jsx(Tooltip,{title:I(e.data),placement:"right",styles:{root:{maxWidth:"400px",whiteSpace:"pre-line",fontSize:"12px"}},children:jsxRuntimeExports.jsxs("div",{className:`flow-trigger-card ${e.enabled?"":"disabled"} ${r?"default-rule":""}`,onClick:t=>{m||r||(t.stopPropagation(),(e=>{if(!e.data)return void staticMethods.warning("规则数据不完整，无法编辑");R(e);const t=e.data.conditions||{},r=t.time_ranges||{};C.setFieldsValue({title:e.title||"",sources:t.sources||[],communities:t.communities||[],lead_types:t.lead_types||[],time_start:r.start?dayjs(r.start,"HH:mm"):void 0,time_end:r.end?dayjs(r.end,"HH:mm"):void 0,weekdays:r.weekdays||[],allocation_method:e.data.allocation_method||"round_robin",enable_permission_check:e.data.enable_permission_check||!1}),E(!0)})(e))},style:r?{cursor:"not-allowed",opacity:.8}:void 0,children:[jsxRuntimeExports.jsxs("div",{className:"card-header",children:[jsxRuntimeExports.jsx(RefIcon$A,{className:"card-icon"}),jsxRuntimeExports.jsx("span",{className:"card-title",children:e.title}),jsxRuntimeExports.jsx("div",{className:"card-actions",children:!r&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{type:"text",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$Q,{}),onClick:t=>{t.stopPropagation(),null==i||i(e.data)},title:"测试",className:"card-action-btn"}),c.length>1&&jsxRuntimeExports.jsx(Button$1,{type:"text",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$O,{}),onClick:t=>{var r;t.stopPropagation(),r=e.id,n&&n(r),staticMethods.success("触发条件已删除")},title:"删除",className:"card-action-btn"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"card-content",children:[jsxRuntimeExports.jsxs("div",{className:"config-item",children:[jsxRuntimeExports.jsx("span",{className:"config-label",children:"条件："}),jsxRuntimeExports.jsx("span",{className:"config-value",children:P(e.data)})]}),jsxRuntimeExports.jsxs("div",{className:"config-item",children:[jsxRuntimeExports.jsx("span",{className:"config-label",children:"方式："}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:null==(t=ALLOCATION_METHODS.find(t=>t.value===e.data.allocation_method))?void 0:t.label})]})]})]})})},N=({onInsert:e,showInsertButton:t=!0})=>jsxRuntimeExports.jsxs("div",{className:"flow-arrow",children:[jsxRuntimeExports.jsx(RefIcon$P,{}),t&&e&&jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",shape:"circle",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),className:"insert-btn",onClick:e})]});return jsxRuntimeExports.jsxs("div",{className:"allocation-flow",children:[(()=>{if(0===c.length)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[jsxRuntimeExports.jsx(RefIcon$A,{style:{fontSize:48,color:"#ccc",marginBottom:16}}),jsxRuntimeExports.jsx(Title$b,{level:4,type:"secondary",children:"暂无分配规则"}),jsxRuntimeExports.jsx(Text$e,{type:"secondary",children:"请先创建分配规则以查看流程图"}),jsxRuntimeExports.jsx("div",{className:"add-trigger-section",style:{marginTop:"24px"},children:jsxRuntimeExports.jsx(Button$1,{type:"dashed",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:M,size:"large",block:!0,children:"新增触发条件"})})]});return jsxRuntimeExports.jsxs("div",{className:"allocation-flow-container",children:[d.map((e,t)=>{const r=c[t];return r?jsxRuntimeExports.jsxs("div",{className:"allocation-flow-row "+(m===t?"dragging":""),draggable:0!==r.priority,onDragStart:e=>{0!==r.priority?(e.stopPropagation(),(e=>{0!==c[e].priority?(h(e),f(e)):staticMethods.warning("默认分配规则不可移动")})(t)):e.preventDefault()},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),((e,t)=>{if(e.preventDefault(),e.stopPropagation(),null!==m&&m!==t){if(0===c[t].priority)return;const e=arrayMoveImmutable(c,m,t),r=arrayMoveImmutable(d,m,t);u(e),p(r),h(t)}})(e,t)},onDragEnd:e=>{e.stopPropagation(),(()=>{if(null!==x&&l){const e=c.map((e,t)=>({...e.data,priority:0===e.priority?0:c.length-t}));setTimeout(async()=>{try{await l(e),staticMethods.success("规则优先级排序已保存")}catch(t){staticMethods.error("保存排序失败")}},200)}h(null),f(null)})()},onDrop:e=>{e.preventDefault(),e.stopPropagation()},onClick:e=>{m||e.stopPropagation()},style:{opacity:m===t?.8:1,transform:m===t?"scale(1.02)":"scale(1)",transition:m===t?"none":"all 0.2s ease",cursor:0===r.priority?"not-allowed":m===t?"grabbing":"grab",userSelect:"none"},children:[jsxRuntimeExports.jsxs("div",{className:"flow-priority",children:[jsxRuntimeExports.jsx("div",{className:"priority-number",children:"默认分配规则"===r.title?0:r.priority}),jsxRuntimeExports.jsx("div",{className:"priority-label",children:"优先级"}),"默认分配规则"===r.title&&jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#999",marginTop:"2px"},children:"不可修改"})]}),O(r),jsxRuntimeExports.jsx("div",{className:"flow-arrow",children:jsxRuntimeExports.jsx(RefIcon$P,{})}),jsxRuntimeExports.jsxs("div",{className:"flow-lists-chain",children:[e.lists.map((r,s)=>jsxRuntimeExports.jsxs(React$2.Fragment,{children:[D(r,e.triggerId,t,s),s<e.lists.length-1&&jsxRuntimeExports.jsx(N,{onInsert:()=>((e,t)=>{const r={id:`${e}_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,title:"新建人员清单",groupId:0,groupName:"未配置",data:{},insertIndex:t+1};S(r),k.setFieldsValue({title:r.title,groupId:void 0}),b(!0)})(e.triggerId,s)})]},r.id)),jsxRuntimeExports.jsx(Button$1,{type:"dashed",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>(e=>{const t={id:`${e}_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,title:"新建人员清单",groupId:0,groupName:"未配置",data:{}};S(t),k.setFieldsValue({title:t.title,groupId:void 0}),b(!0)})(e.triggerId),style:{marginLeft:8},children:"添加销售组"})]})]},e.triggerId):null}),jsxRuntimeExports.jsx("div",{className:"add-trigger-section",children:jsxRuntimeExports.jsx(Button$1,{type:"dashed",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:M,size:"large",block:!0,children:"新增触发条件"})})]})})(),jsxRuntimeExports.jsx(Modal$2,{title:w?"编辑触发器":"新增触发器",open:v,onCancel:()=>{E(!1),R(null),C.resetFields()},footer:null,width:800,children:jsxRuntimeExports.jsxs(Form$4,{form:C,layout:"vertical",onFinish:async e=>{var t,r,s;const n={name:e.title,description:(null==(t=null==w?void 0:w.data)?void 0:t.description)||"",is_active:!0,priority:(null==(r=null==w?void 0:w.data)?void 0:r.priority)||c.length+1,conditions:(e=>{const t={};return Array.isArray(e.sources)&&e.sources.length>0&&(t.sources=e.sources),Array.isArray(e.communities)&&e.communities.length>0&&(t.communities=e.communities),Array.isArray(e.lead_types)&&e.lead_types.length>0&&(t.lead_types=e.lead_types),(e.time_start||e.time_end||Array.isArray(e.weekdays)&&e.weekdays.length>0)&&(t.time_ranges={start:e.time_start?dayjs(e.time_start).format("HH:mm"):void 0,end:e.time_end?dayjs(e.time_end).format("HH:mm"):void 0,weekdays:e.weekdays&&e.weekdays.length>0?e.weekdays:void 0}),t})(e),user_groups:(null==(s=null==w?void 0:w.data)?void 0:s.user_groups)||[],allocation_method:e.allocation_method||"round_robin",enable_permission_check:e.enable_permission_check||!1};try{(!w||w.id.startsWith("trigger_"))&&o?await o(n):a&&w&&await a(w.id,n),E(!1),R(null),C.resetFields(),staticMethods.success("触发条件已保存")}catch(i){console.error("保存触发条件失败:",i),staticMethods.error("保存失败")}},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"title",label:"条件名称",rules:[{required:!0,message:"请输入条件名称"}],children:jsxRuntimeExports.jsx(Input$1,{})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"sources",label:"来源条件",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"不选择则匹配所有来源",allowClear:!0,maxTagCount:"responsive",children:r.map(e=>jsxRuntimeExports.jsx(Option$8,{value:e,children:e},e))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"communities",label:"社区条件",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"不选择则匹配所有社区",allowClear:!0,maxTagCount:"responsive",children:s.map(e=>jsxRuntimeExports.jsx(Option$8,{value:e,children:e},e))})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"lead_types",label:"线索类型条件",children:jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"不选择则匹配所有类型",allowClear:!0,maxTagCount:"responsive",children:[jsxRuntimeExports.jsx(Option$8,{value:"意向客户",children:"意向客户"}),jsxRuntimeExports.jsx(Option$8,{value:"潜在客户",children:"潜在客户"}),jsxRuntimeExports.jsx(Option$8,{value:"高意向客户",children:"高意向客户"})]})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"weekdays",label:"工作日",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"选择工作日",children:WEEKDAY_OPTIONS.map(e=>jsxRuntimeExports.jsx(Option$8,{value:e.value,children:e.label},e.value))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{label:"时间区间",children:jsxRuntimeExports.jsxs(Input$1.Group,{compact:!0,children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"time_start",noStyle:!0,children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",placeholder:"开始时间",style:{width:100}})}),jsxRuntimeExports.jsx("span",{style:{margin:"0 8px",lineHeight:"32px"},children:"至"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"time_end",noStyle:!0,children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",placeholder:"结束时间",style:{width:100}})})]})})})]}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"allocation_method",label:"分配方式",children:jsxRuntimeExports.jsx(Select,{placeholder:"选择分配方式",children:ALLOCATION_METHODS.map(e=>jsxRuntimeExports.jsx(Option$8,{value:e.value,children:e.label},e.value))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"enable_permission_check",label:"启用权限检查",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"保存"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{E(!1),R(null),C.resetFields()},children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:_?"编辑销售组":"新增销售组",open:j,onCancel:F,footer:null,width:500,children:jsxRuntimeExports.jsxs(Form$4,{form:k,layout:"vertical",onFinish:async e=>{if(!_)return;const{groupId:r}=e,s=t.find(e=>e.id===r);if(s)try{const e={..._,title:s.groupname,groupId:s.id,groupName:s.groupname,data:s},t=_.id.split("_")[0],r=c.find(e=>e.id===t);if(!r)return void staticMethods.error("找不到对应的分配规则");const n=[...r.data.user_groups||[]];if(void 0!==_.insertIndex)n.splice(_.insertIndex,0,s.id);else{const e=n.indexOf(_.groupId);-1!==e?n[e]=s.id:n.push(s.id)}const i={...r.data,user_groups:n};if(a&&(await a(t,i),staticMethods.success("销售组已保存到分配规则")),void 0!==_.insertIndex){const r=d.findIndex(e=>e.triggerId===t);if(-1!==r){const t=[...d];t[r].lists.splice(_.insertIndex,0,e),p(t)}}else{const t=d.map(t=>({...t,lists:t.lists.map(t=>t.id===_.id?e:t)}));p(t)}b(!1),S(null),k.resetFields()}catch(n){console.error("保存销售组失败:",n),staticMethods.error(`保存失败: ${n.message}`)}else staticMethods.error("请选择有效的销售组")},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"groupId",label:"选择销售组",rules:[{required:!0,message:"请选择销售组"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择销售组",showSearch:!0,filterOption:(e,t)=>((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:t.map(e=>jsxRuntimeExports.jsx(Option$8,{value:e.id,children:e.groupname},e.id))})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"确认"}),jsxRuntimeExports.jsx(Button$1,{onClick:F,children:"取消"})]})})]})})]})},{Title:Title$a,Text:Text$d}=Typography,{Option:Option$7}=Select,AllocationManagement=()=>{const[e]=Form$4.useForm(),[t]=Form$4.useForm(),[r]=Form$4.useForm(),[s]=Form$4.useForm(),[n]=Form$4.useForm(),[i,o]=reactExports.useState("1"),[a,l]=reactExports.useState([]),[c,u]=reactExports.useState([]),[,d]=reactExports.useState([]),[,p]=reactExports.useState(!1),[m,h]=reactExports.useState([]),[x,f]=reactExports.useState([]),[g,y]=reactExports.useState([]),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState(!1),[w,R]=reactExports.useState(null),[_,S]=reactExports.useState(null),[C,k]=reactExports.useState(null),[$,T]=reactExports.useState([]),[I,P]=reactExports.useState(!1),[A,F]=reactExports.useState(null),[M,D]=reactExports.useState([]),[O,N]=reactExports.useState(!1),[B,L]=reactExports.useState(null);reactExports.useEffect(()=>{z()},[]);const z=async()=>{await Promise.all([V(),Y(),Z(),Q(),ee(),te()])},V=async()=>{p(!0);try{const e=await allocationApi.rules.getRules();e.success&&e.data&&l(e.data)}catch(e){console.error("加载规则失败:",e)}finally{p(!1)}},[U,H]=reactExports.useState(""),[W,q]=reactExports.useState({}),G=reactExports.useMemo(()=>{const e=c.filter(e=>!e.community);return U?e.filter(e=>{const t=e.groupname.toLowerCase().includes(U.toLowerCase()),r=(W[e.id]||[]).some(e=>e.nickname.toLowerCase().includes(U.toLowerCase()));return t||r}):e},[c,U,W]),Y=async()=>{try{const e=await allocationApi.groups.getGroups();e.success&&e.data?(u(e.data),await(async e=>{try{const t=e.reduce((e,t)=>(t.list&&t.list.length>0&&e.push(...t.list),e),[]);if(0===t.length)return;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, status").in("id",t);if(s)throw s;const n=e.reduce((e,t)=>(t.list&&t.list.length>0?e[t.id]=t.list.map(e=>{const t=null==r?void 0:r.find(t=>t.id===e);return t?{id:String(e),nickname:t.nickname||`用户${e}`}:null}).filter(e=>null!==e):e[t.id]=[],e),{});q(e=>({...e,...n}))}catch(t){staticMethods.error("加载成员信息失败")}})(e.data)):staticMethods.error("获取销售组失败")}catch(e){staticMethods.error("加载销售组异常")}},[K,X]=reactExports.useState({}),J=async e=>{try{const t=e.filter(e=>null!=e&&!isNaN(e));if(0===t.length)return;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, status").in("id",t);if(s)throw s;const n=(r||[]).reduce((e,t)=>({...e,[String(t.id)]:{nickname:t.nickname||`用户${t.id}`,status:t.status}}),{});X(e=>({...e,...n}))}catch(t){staticMethods.error("加载用户信息失败")}},Z=async()=>{try{p(!0);const e=await allocationApi.logs.getLogs();if((null==e?void 0:e.success)&&(null==e?void 0:e.data)){const t=e.data.map(e=>e.assigned_user_id).filter(Boolean);t.length>0&&await J(t),d(e.data)}else staticMethods.error("获取分配日志失败")}catch(e){staticMethods.error("加载分配日志失败")}finally{p(!1)}},Q=async()=>{try{const[e,t,r]=await Promise.all([allocationApi.enums.getSourceTypes(),allocationApi.enums.getCommunityTypes(),allocationApi.enums.getAllocationMethods()]);e.success&&e.data&&h(e.data),t.success&&t.data&&f(t.data),r.success&&r.data&&y(r.data)}catch(e){console.error("加载枚举选项失败:",e)}},ee=async()=>{try{const e=await pointsAllocationApi.costRules.getRules();e.success&&e.data&&T(e.data)}catch(e){console.error("加载积分成本规则失败:",e)}},te=async()=>{try{const e=await allocationApi.communityKeywords.getKeywords();e.success&&e.data&&D(e.data)}catch(e){console.error("加载社区关键词失败:",e)}},re=[{title:"规则名称",dataIndex:"name",key:"name",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Text$d,{strong:!0,children:t.name}),t.is_active?jsxRuntimeExports.jsx(Tag$1,{color:"green",children:"启用"}):jsxRuntimeExports.jsx(Tag$1,{color:"red",children:"禁用"})]})},{title:"基础积分成本",dataIndex:"base_points_cost",key:"base_points_cost",render:e=>jsxRuntimeExports.jsxs(Text$d,{strong:!0,style:{color:"#1890ff"},children:[e," 积分"]})},{title:"优先级",dataIndex:"priority",key:"priority",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e>=200?"red":e>=150?"orange":"blue",children:e})},{title:"条件配置",dataIndex:"conditions",key:"conditions",render:e=>{var t,r,s;const n=[];return(null==(t=null==e?void 0:e.sources)?void 0:t.length)>0&&n.push(`来源: ${e.sources.join(", ")}`),(null==(r=null==e?void 0:e.lead_types)?void 0:r.length)>0&&n.push(`类型: ${e.lead_types.join(", ")}`),(null==(s=null==e?void 0:e.communities)?void 0:s.length)>0&&n.push(`社区: ${e.communities.join(", ")}`),n.length>0?jsxRuntimeExports.jsx(Tooltip,{title:n.join("; "),children:jsxRuntimeExports.jsxs(Text$d,{type:"secondary",children:[n.length," 个条件"]})}):jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"无特殊条件"})}},{title:"动态调整",dataIndex:"dynamic_cost_config",key:"dynamic_cost_config",render:e=>{const t=[];return(null==e?void 0:e.source_adjustments)&&t.push(`来源调整: ${Object.keys(e.source_adjustments).length} 项`),(null==e?void 0:e.keyword_adjustments)&&t.push(`关键词调整: ${Object.keys(e.keyword_adjustments).length} 项`),(null==e?void 0:e.time_adjustments)&&t.push(`时间调整: ${Object.keys(e.time_adjustments).length} 项`),t.length>0?jsxRuntimeExports.jsx(Tooltip,{title:t.join("; "),children:jsxRuntimeExports.jsxs(Text$d,{type:"secondary",children:[t.length," 项调整"]})}):jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"无动态调整"})}},{title:"操作",key:"action",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>ce(t),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除这个积分成本规则吗？",onConfirm:()=>ue(t.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),children:"删除"})})]})}],se=e=>{const t=a.filter(t=>t.user_groups&&t.user_groups.includes(e));return{isUsed:t.length>0,usedRules:t,ruleNames:t.map(e=>e.name).join("、")}},ne=[{title:"组名称",dataIndex:"groupname",key:"groupname",render:(e,t)=>{const r=se(t.id);return jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:4,children:[jsxRuntimeExports.jsx(Text$d,{strong:!0,children:e}),r.isUsed&&jsxRuntimeExports.jsx(Tooltip,{title:`该销售组正在被以下分配规则使用：${r.ruleNames}`,placement:"top",children:jsxRuntimeExports.jsx(Tag$1,{color:"orange",icon:jsxRuntimeExports.jsx(RefIcon$b,{}),children:"已绑定"})})]})}},{title:"描述",dataIndex:"description",key:"description"},{title:"分配方式",dataIndex:"allocation",key:"allocation",render:e=>{const t=ALLOCATION_METHODS.find(t=>t.value===e),r=g.includes(e);return jsxRuntimeExports.jsx(Tooltip,{title:(null==t?void 0:t.description)||`分配方式: ${e}`,children:jsxRuntimeExports.jsx(Tag$1,{color:r?"blue":"orange",children:(null==t?void 0:t.label)||e})})}},{title:"质量控制",key:"quality_control",render:(e,t)=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Tag$1,{color:t.enable_quality_control?"green":"gray",children:t.enable_quality_control?"启用":"禁用"})}),jsxRuntimeExports.jsxs("div",{style:{fontSize:12,color:"#666",lineHeight:1.6},children:[jsxRuntimeExports.jsxs("div",{children:["日限制: ",void 0!==t.daily_lead_limit&&null!==t.daily_lead_limit?t.daily_lead_limit:"-"]}),jsxRuntimeExports.jsxs("div",{children:["转化率: ",void 0!==t.conversion_rate_requirement&&null!==t.conversion_rate_requirement?t.conversion_rate_requirement+"%":"-"]}),jsxRuntimeExports.jsxs("div",{children:["最大待处理: ",void 0!==t.max_pending_leads&&null!==t.max_pending_leads?t.max_pending_leads:"-"]})]})]})},{title:"社区匹配",dataIndex:"enable_community_matching",key:"enable_community_matching",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e?"blue":"gray",children:e?"启用":"禁用"})},{title:"成员列表",key:"members",width:300,render:(e,t)=>{const r=W[t.id]||[];return jsxRuntimeExports.jsx("div",{style:{maxWidth:280,minHeight:32},children:r.length>0?jsxRuntimeExports.jsx(Space$1,{size:[0,4],wrap:!0,children:r.map(e=>jsxRuntimeExports.jsx(Tag$1,{style:{margin:"2px"},children:e.nickname},e.id))}):jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"暂无成员"})})}},{title:"成员数量",dataIndex:"list",key:"member_count",width:100,render:e=>(null==e?void 0:e.length)||0},{title:"操作",key:"action",width:120,fixed:"right",render:(e,t)=>{const r=se(t.id);return jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:0,children:[jsxRuntimeExports.jsx(Button$1,{type:"link",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>oe(t),children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{type:"link",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>le(t),children:"复制"}),r.isUsed?jsxRuntimeExports.jsx(Tooltip,{title:`该销售组正在被以下分配规则使用：${r.ruleNames}。请先从分配规则中移除该销售组，然后再删除。`,placement:"left",children:jsxRuntimeExports.jsx(Button$1,{type:"link",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),disabled:!0,style:{color:"#d9d9d9",cursor:"not-allowed",opacity:.6},children:"删除"})}):jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除这个销售组吗？",onConfirm:()=>ae(t.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),children:"删除"})})]})}}],ie=[{title:"线索ID",dataIndex:"leadid",key:"leadid",width:120,render:e=>jsxRuntimeExports.jsx(Tag$1,{children:e})},{title:"分配销售",dataIndex:"assigned_user_id",key:"assigned_user_id",width:150,render:e=>{const t=K[String(e)]||{};return jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$5,{}),jsxRuntimeExports.jsx(Text$d,{children:t.nickname||(e?`用户${e}`:"未分配")}),"inactive"===t.status&&jsxRuntimeExports.jsx(Tag$1,{color:"red",children:"已离职"})]})}},{title:"分配方式",dataIndex:"allocation_method",key:"allocation_method",width:120,render:e=>{const t=ALLOCATION_METHODS.find(t=>t.value===e),r=g.includes(e);return jsxRuntimeExports.jsx(Tag$1,{color:r?"purple":"orange",children:(null==t?void 0:t.label)||e})}},{title:"使用规则",key:"rule_name",width:150,render:(e,t)=>{var r;const s=null==(r=t.processing_details)?void 0:r.rule_name;return s?jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:s}):jsxRuntimeExports.jsx(Tag$1,{color:"gray",children:"默认分配"})}},{title:"处理详情",key:"processing_details",width:100,render:(e,t)=>{const r=t.processing_details;return r?jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:4,style:{width:"100%"},children:[r.rule_name&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"使用规则："}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:r.rule_name})]}),r.conditions&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"匹配条件："}),jsxRuntimeExports.jsxs("div",{style:{marginLeft:8},children:[r.conditions.sources&&r.conditions.sources.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"来源："}),r.conditions.sources.map(e=>jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:e},e))]}),r.conditions.communities&&r.conditions.communities.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"社区："}),r.conditions.communities.map(e=>jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e},e))]}),r.conditions.lead_types&&r.conditions.lead_types.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"类型："}),r.conditions.lead_types.map(e=>jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:e},e))]})]})]}),r.group_info&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"销售组："}),jsxRuntimeExports.jsx(Tag$1,{color:"purple",children:r.group_info.groupname})]}),r.allocation_steps&&r.allocation_steps.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"分配步骤："}),jsxRuntimeExports.jsx("div",{style:{marginLeft:8},children:r.allocation_steps.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:4},children:[jsxRuntimeExports.jsxs(Text$d,{type:"secondary",children:[t+1,". ",e.step]}),e.result&&jsxRuntimeExports.jsx("div",{style:{marginLeft:16,fontSize:"12px",color:"#666"},children:"object"==typeof e.result?jsxRuntimeExports.jsx("pre",{style:{margin:0},children:JSON.stringify(e.result,null,2)}):e.result})]},t))})]}),!r.rule_name&&!r.conditions&&!r.group_info&&!r.allocation_steps&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"原始数据："}),jsxRuntimeExports.jsx("div",{style:{marginLeft:8,fontSize:"12px",color:"#666"},children:jsxRuntimeExports.jsx("pre",{style:{margin:0,maxHeight:"100px",overflow:"auto"},children:JSON.stringify(r,null,2)})})]})]}):jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"无处理详情"})}},{title:"分配时间",dataIndex:"created_at",key:"created_at",width:180,render:e=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$R,{}),jsxRuntimeExports.jsx(Text$d,{children:toBeijingDateTimeStr(e)})]})}],oe=e=>{S(e),r.setFieldsValue({...e,enable_quality_control:e.enable_quality_control||!1,enable_community_matching:e.enable_community_matching||!1,list:e.list||[]}),b(!0)},ae=async e=>{try{const t=se(e);if(t.isUsed)return void staticMethods.error(`无法删除销售组，该销售组已被以下分配规则使用：${t.ruleNames}。请先从分配规则中移除该销售组，然后再删除。`);const r=await allocationApi.groups.deleteGroup(e);r.success?(staticMethods.success("销售组已删除"),Y()):staticMethods.error(r.error||"删除失败")}catch(t){staticMethods.error("删除失败")}},le=e=>{const t={...e,groupname:e.groupname+"（复制）",enable_quality_control:e.enable_quality_control||!1,enable_community_matching:e.enable_community_matching||!1,list:e.list||[]};S(null),r.setFieldsValue(t),b(!0)},ce=e=>{F(e),s.setFieldsValue({name:e.name,description:e.description,base_points_cost:e.base_points_cost,priority:e.priority,is_active:e.is_active,conditions:JSON.stringify(e.conditions,null,2),dynamic_cost_config:JSON.stringify(e.dynamic_cost_config,null,2)}),P(!0)},ue=async e=>{try{const t=await pointsAllocationApi.costRules.deleteRule(e);t.success?(staticMethods.success("积分成本规则已删除"),ee()):staticMethods.error(t.error||"删除失败")}catch(t){staticMethods.error("删除失败")}},de=async e=>{try{p(!0);const t=await allocationApi.rules.testAllocation({source:e.source,leadtype:e.leadtype,community:e.community,test_mode:!0});(null==t?void 0:t.success)&&(null==t?void 0:t.data)?(t.data.assigned_user_id&&await J([t.data.assigned_user_id]),k({success:!0,assigned_user_id:t.data.assigned_user_id,allocation_method:t.data.allocation_method,rule_name:t.data.rule_name,processing_details:{matched_rule:t.data.matched_rule,allocation_steps:t.data.allocation_steps||[],final_group:t.data.final_group,conditions_matched:t.data.conditions_matched}}),staticMethods.success("分配测试完成")):(k({success:!1,message:(null==t?void 0:t.error)||"分配测试失败",details:null==t?void 0:t.details}),staticMethods.error("分配测试失败"))}catch(t){k({success:!1,message:"测试执行异常",details:t instanceof Error?t.message:"未知错误"}),staticMethods.error("测试执行异常")}finally{p(!1)}},[,pe]=reactExports.useState([]);reactExports.useEffect(()=>{(async()=>{try{const{data:e}=await supabase.from("users_profile").select("id, nickname").eq("status","active");pe(e||[])}catch(e){console.error("加载所有用户失败:",e)}})()},[]);const[me,he]=reactExports.useState([]);reactExports.useEffect(()=>{if(_&&_.list){const e=(_.list||[]).map(e=>String(e));he(e);const t=e.filter(e=>!K[e]);t.length>0&&J(t.map(e=>Number(e))),r.setFieldsValue({list:e,enable_quality_control:_.enable_quality_control,enable_community_matching:_.enable_community_matching})}else he([])},[_,j,K]);const xe=jsxRuntimeExports.jsx(Card$1,{title:jsxRuntimeExports.jsx(Title$a,{level:4,style:{margin:0,textAlign:"left"},children:"积分分配规则"}),styles:{header:{padding:"0 24px",borderBottom:"1px solid #f0f0f0"}},extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{F(null),s.resetFields(),P(!0)},children:"新增积分规则"}),children:jsxRuntimeExports.jsx(ForwardTable,{columns:re,dataSource:$,rowKey:"id",scroll:{x:1200},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`}})}),fe=jsxRuntimeExports.jsx(Card$1,{title:jsxRuntimeExports.jsx(Title$a,{level:4,style:{margin:0,textAlign:"left"},children:"销售组管理"}),styles:{header:{padding:"0 24px",borderBottom:"1px solid #f0f0f0"}},extra:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"搜索组名称或成员昵称",allowClear:!0,style:{width:240},onChange:e=>H(e.target.value)}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{S(null),he([]),r.resetFields(),r.setFieldsValue({enable_quality_control:!1,enable_community_matching:!1,list:[]}),b(!0)},children:"新增销售组"})]}),children:jsxRuntimeExports.jsx(ForwardTable,{columns:ne,dataSource:G,rowKey:"id",scroll:{x:1300},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`}})}),[ge,ye]=reactExports.useState({leadid:"",allocationMethod:"",assignedUserId:"",ruleName:"",page:1,pageSize:10,sortBy:"created_at",sortOrder:"desc"}),[ve,Ee]=reactExports.useState(!1),[je,be]=reactExports.useState([]),[we,Re]=reactExports.useState(0),_e=async(e=ge)=>{Ee(!0);try{const t=await(async(e=ge)=>{let t=supabase.from("simple_allocation_logs").select("*",{count:"exact"});e.leadid&&(t=t.ilike("leadid",`%${e.leadid}%`)),e.allocationMethod&&(t=t.ilike("allocation_method",`%${e.allocationMethod}%`)),e.assignedUserId&&(t=t.eq("assigned_user_id",parseInt(e.assignedUserId))),t=t.order(e.sortBy,{ascending:"asc"===e.sortOrder});const r=(e.page-1)*e.pageSize,s=r+e.pageSize-1;t=t.range(r,s);const{data:n,count:i,error:o}=await t;if(o)throw o;const l=(null==n?void 0:n.map(e=>{const t=a.find(t=>t.id===e.rule_id);let r=e.processing_details;if("string"==typeof r)try{r=JSON.parse(r)}catch(e2){r={}}return{...e,processing_details:r||{},rule_name:(null==t?void 0:t.name)||"默认分配"}}))||[];let c=l;return e.ruleName&&(c=l.filter(t=>t.rule_name.toLowerCase().includes(e.ruleName.toLowerCase()))),{data:c,total:i||0,page:e.page,pageSize:e.pageSize,totalPages:Math.ceil((i||0)/e.pageSize)}})(e);be(t.data),Re(t.total),ye(e=>({...e,page:t.page,pageSize:t.pageSize}))}catch(t){staticMethods.error("日志查询失败")}finally{Ee(!1)}};reactExports.useEffect(()=>{_e()},[ge.leadid,ge.allocationMethod,ge.assignedUserId,ge.ruleName,ge.page,ge.pageSize,ge.sortBy,ge.sortOrder]);const Se=jsxRuntimeExports.jsxs(Card$1,{title:"分配历史记录",extra:jsxRuntimeExports.jsx(Space$1,{children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:()=>_e(),children:"刷新"})}),children:[jsxRuntimeExports.jsxs(Form$4,{layout:"inline",onFinish:e=>{ye(t=>({...t,...e,page:1}))},initialValues:ge,style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"leadid",label:"线索编号",children:jsxRuntimeExports.jsx(Input$1,{allowClear:!0,placeholder:"请输入线索编号"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"allocationMethod",label:"分配方式",children:jsxRuntimeExports.jsx(Select,{allowClear:!0,style:{width:120},placeholder:"选择分配方式",children:ALLOCATION_METHODS.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"assignedUserId",label:"分配销售",children:jsxRuntimeExports.jsx(Select,{allowClear:!0,style:{width:150},placeholder:"选择销售",showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:Object.entries(K).map(([e,t])=>jsxRuntimeExports.jsx(Option$7,{value:e,children:t.nickname||`用户${e}`},e))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"ruleName",label:"使用规则",children:jsxRuntimeExports.jsx(Select,{allowClear:!0,style:{width:150},placeholder:"选择规则",showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:a.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e.name,children:e.name},e.id))})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"筛选"})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{onClick:()=>{ye({leadid:"",allocationMethod:"",assignedUserId:"",ruleName:"",page:1,pageSize:10,sortBy:"created_at",sortOrder:"desc"})},children:"重置"})})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:ie,dataSource:je,loading:ve,rowKey:"id",scroll:{x:1300},pagination:{current:ge.page,pageSize:ge.pageSize,total:we,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{ye(r=>({...r,page:e,pageSize:t}))}},onChange:(e,t,r)=>{ye(t=>({...t,page:e.current||1,pageSize:e.pageSize||10,sortBy:r.field||"created_at",sortOrder:"ascend"===r.order?"asc":"desc"}))}})]}),Ce=[{title:"关键词",dataIndex:"keyword",key:"keyword",render:e=>jsxRuntimeExports.jsx(Space$1,{size:[0,4],wrap:!0,children:e.map((e,t)=>jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:e},t))})},{title:"对应社区",dataIndex:"community",key:"community",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e})},{title:"优先级",dataIndex:"priority",key:"priority",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e>=100?"red":e>=50?"orange":"blue",children:e})},{title:"操作",key:"action",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>ke(t),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除这个社区关键词映射吗？",onConfirm:()=>$e(t.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),children:"删除"})})]})}],ke=e=>{L(e),n.setFieldsValue({keyword:e.keyword,community:e.community,priority:e.priority}),N(!0)},$e=async e=>{try{const t=await allocationApi.communityKeywords.deleteKeyword(e);t.success?(staticMethods.success("社区关键词映射已删除"),te()):staticMethods.error(t.error||"删除失败")}catch(t){staticMethods.error("删除失败")}},Te=jsxRuntimeExports.jsx(Card$1,{title:jsxRuntimeExports.jsx(Title$a,{level:4,style:{margin:0,textAlign:"left"},children:"社区关键词匹配"}),styles:{header:{padding:"0 24px",borderBottom:"1px solid #f0f0f0"}},extra:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{L(null),n.resetFields(),N(!0)},children:"新增社区映射"}),children:jsxRuntimeExports.jsx(ForwardTable,{columns:Ce,dataSource:M,rowKey:"id",scroll:{x:800},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`}})});return jsxRuntimeExports.jsxs("div",{className:"allocation-management",children:[jsxRuntimeExports.jsx(Tabs,{activeKey:i,onChange:o,items:[{key:"1",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$A,{}),"分配流程"]}),children:jsxRuntimeExports.jsx(AllocationFlowChart,{rules:a,userGroups:c,sourceOptions:m,communityOptions:x,onRuleEdit:e=>{var r,s,n;R(e);const i={...e,priority:"默认分配规则"===e.name?0:e.priority,time_start:(null==(r=e.conditions.time_ranges)?void 0:r.start)?dayjs(e.conditions.time_ranges.start,"HH:mm"):void 0,time_end:(null==(s=e.conditions.time_ranges)?void 0:s.end)?dayjs(e.conditions.time_ranges.end,"HH:mm"):void 0,weekdays:null==(n=e.conditions.time_ranges)?void 0:n.weekdays,user_groups:Array.isArray(e.user_groups)?e.user_groups:[],sources:e.conditions.sources||[],communities:e.conditions.communities||[],lead_types:e.conditions.lead_types||[]};t.setFieldsValue(i),E(!0)},onRuleDelete:async e=>{try{const t=await allocationApi.rules.deleteRule(e);t.success?(staticMethods.success("分配规则已删除"),V()):staticMethods.error(t.error||"删除失败")}catch(t){staticMethods.error("删除失败")}},onRuleTest:de,onRuleCreate:async e=>{try{const t=await allocationApi.rules.createRule(e);t.success?(staticMethods.success("规则创建成功"),V()):staticMethods.error(t.error||"创建失败")}catch(t){staticMethods.error("创建失败")}},onRuleUpdate:async(e,t)=>{try{const r=await allocationApi.rules.updateRule(e,t);r.success?(staticMethods.success("规则更新成功"),V()):staticMethods.error(r.error||"更新失败")}catch(r){staticMethods.error("更新失败")}},onRulesReorder:async e=>{try{const t=e.filter(e=>"默认分配规则"!==e.name),r=e.find(e=>"默认分配规则"===e.name);l(e);const s=t.map(e=>allocationApi.rules.updateRule(e.id,{...e,priority:e.priority}));r&&s.push(allocationApi.rules.updateRule(r.id,{...r,priority:0})),await Promise.all(s),staticMethods.success("规则顺序已更新")}catch(t){staticMethods.error("更新顺序失败"),V()}}})},{key:"3",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$N,{}),"销售组"]}),children:fe},{key:"6",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$C,{}),"积分规则"]}),children:xe},{key:"4",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$Q,{}),"分配测试"]}),children:jsxRuntimeExports.jsxs(Card$1,{title:"分配测试",children:[jsxRuntimeExports.jsxs(Form$4,{form:e,layout:"vertical",onFinish:de,style:{marginBottom:16},children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"source",label:"来源",rules:[{required:!0,message:"请选择来源"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"选择来源",children:m.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e,children:e},e))})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"leadtype",label:"线索类型",children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择类型",allowClear:!0,children:[jsxRuntimeExports.jsx(Option$7,{value:"意向客户",children:"意向客户"}),jsxRuntimeExports.jsx(Option$7,{value:"潜在客户",children:"潜在客户"}),jsxRuntimeExports.jsx(Option$7,{value:"高意向客户",children:"高意向客户"})]})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"community",label:"社区",children:jsxRuntimeExports.jsx(Select,{placeholder:"选择社区",allowClear:!0,children:x.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e,children:e},e))})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",icon:jsxRuntimeExports.jsx(RefIcon$Q,{}),children:"开始测试"})})]}),C?jsxRuntimeExports.jsx(Alert,{message:C.success?"分配测试结果":"分配失败",description:C.success?jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs(Row,{gutter:[0,8],children:[jsxRuntimeExports.jsx(Col,{span:24,children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"分配给销售："}),jsxRuntimeExports.jsx(Tag$1,{icon:jsxRuntimeExports.jsx(RefIcon$5,{}),color:"blue",children:C.assigned_user_id?(null==(Ie=K[String(C.assigned_user_id)])?void 0:Ie.nickname)||`用户${C.assigned_user_id}`:"未分配"})]})}),jsxRuntimeExports.jsx(Col,{span:24,children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"分配方式："}),jsxRuntimeExports.jsx(Tag$1,{color:g.includes(C.allocation_method)?"purple":"orange",children:(null==(Pe=ALLOCATION_METHODS.find(e=>e.value===C.allocation_method))?void 0:Pe.label)||C.allocation_method})]})}),C.rule_name&&jsxRuntimeExports.jsx(Col,{span:24,children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"使用规则："}),jsxRuntimeExports.jsx(Tag$1,{color:"green",children:C.rule_name})]})}),C.processing_details&&jsxRuntimeExports.jsx(Col,{span:24,children:jsxRuntimeExports.jsxs("div",{style:{marginTop:8},children:[jsxRuntimeExports.jsx(Text$d,{type:"secondary",children:"处理详情："}),jsxRuntimeExports.jsx("div",{style:{marginLeft:16,marginTop:4},children:null==(Ae=C.processing_details.allocation_steps)?void 0:Ae.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:4},children:[jsxRuntimeExports.jsxs(Text$d,{type:"secondary",children:[t+1,". ",e.step]}),e.result&&jsxRuntimeExports.jsx("div",{style:{marginLeft:16,fontSize:"12px",color:"#666"},children:"object"==typeof e.result?jsxRuntimeExports.jsx("pre",{style:{margin:0},children:JSON.stringify(e.result,null,2)}):e.result})]},t))})]})})]})}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$d,{type:"danger",children:C.message}),C.details&&jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:jsxRuntimeExports.jsx("pre",{children:JSON.stringify(C.details,null,2)})})]}),type:C.success?"success":"error",showIcon:!0}):null]})},{key:"5",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$R,{}),"分配历史"]}),children:Se},{key:"7",label:jsxRuntimeExports.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(RefIcon$3,{}),"社区匹配"]}),children:Te}]}),jsxRuntimeExports.jsx(Modal$2,{title:w?"编辑分配规则":"新增分配规则",open:v,onCancel:()=>{E(!1),R(null),t.resetFields()},footer:null,width:800,children:jsxRuntimeExports.jsxs(Form$4,{form:t,layout:"vertical",onFinish:async e=>{try{const r=validateRuleForm(e);let s;if(s=w?await allocationApi.rules.updateRule(w.id,r):await allocationApi.rules.createRule(r),s.success)staticMethods.success(w?"规则更新成功":"规则创建成功"),E(!1),t.resetFields(),R(null),V();else{const e=s.error||"保存失败",t=s.details?` (${s.details})`:"";staticMethods.error(`${e}${t}`)}}catch(r){staticMethods.error(`保存失败: ${r.message}`)}},onValuesChange:e=>{e.user_groups},children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入规则名称"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"priority",label:"优先级",children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,max:100,placeholder:"优先级",disabled:"默认分配规则"===(null==w?void 0:w.name),addonAfter:"默认分配规则"===(null==w?void 0:w.name)?"固定为0":""})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"规则描述",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入规则描述"})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"sources",label:"来源条件",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"不选择则匹配所有来源",allowClear:!0,maxTagCount:"responsive",children:m.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e,children:e},e))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"communities",label:"社区条件",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"不选择则匹配所有社区",allowClear:!0,maxTagCount:"responsive",children:x.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e,children:e},e))})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"lead_types",label:"线索类型条件",children:jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"不选择则匹配所有类型",allowClear:!0,maxTagCount:"responsive",children:[jsxRuntimeExports.jsx(Option$7,{value:"意向客户",children:"意向客户"}),jsxRuntimeExports.jsx(Option$7,{value:"潜在客户",children:"潜在客户"}),jsxRuntimeExports.jsx(Option$7,{value:"高意向客户",children:"高意向客户"})]})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"time_start",label:"开始时间",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"HH:mm 格式，如 09:00"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"time_end",label:"结束时间",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"HH:mm 格式，如 18:00"})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"weekdays",label:"工作日",children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"选择工作日",children:WEEKDAY_OPTIONS.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"user_groups",label:"销售组",rules:[{required:!0,message:"请选择销售组"}],children:jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"选择销售组",showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),onSelect:()=>{},onDeselect:()=>{},children:c.map(e=>{const t=se(e.id),r=w&&w.user_groups&&w.user_groups.includes(e.id);return jsxRuntimeExports.jsx(Option$7,{value:e.id,children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx("span",{children:e.groupname}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:4},children:[t.isUsed&&!r&&jsxRuntimeExports.jsx(Tag$1,{color:"orange",style:{fontSize:"10px",lineHeight:"12px"},children:"已被使用"}),r&&jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{fontSize:"10px",lineHeight:"12px"},children:"当前规则"})]})]})},e.id)})})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"allocation_method",label:"分配方式",children:jsxRuntimeExports.jsx(Select,{placeholder:"选择分配方式",children:g.length>0?g.map(e=>{const t=ALLOCATION_METHODS.find(t=>t.value===e);return jsxRuntimeExports.jsx(Option$7,{value:e,children:(null==t?void 0:t.label)||e},e)}):ALLOCATION_METHODS.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e.value,children:e.label},e.value))})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"enable_permission_check",label:"启用权限检查",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"启用规则",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:w?"更新规则":"创建规则"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{E(!1),R(null),t.resetFields()},children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:_?"编辑销售组":"新增销售组",open:j,onCancel:()=>{b(!1),S(null),he([]),r.resetFields()},footer:null,width:600,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:r,layout:"vertical",onValuesChange:(e,t)=>{Object.prototype.hasOwnProperty.call(e,"enable_quality_control")&&r.setFieldsValue({daily_lead_limit:t.daily_lead_limit,conversion_rate_requirement:t.conversion_rate_requirement,max_pending_leads:t.max_pending_leads})},onFinish:async e=>{try{const t={...e,list:(e.list||[]).map(e=>Number(e))},s=validateGroupForm(t);let n;if(n=_?await allocationApi.groups.updateGroup(_.id,s):await allocationApi.groups.createGroup(s),n.success)staticMethods.success(_?"销售组更新成功":"销售组创建成功"),b(!1),r.resetFields(),S(null),u([]),q({}),await Y();else{const e=n.error||"保存失败",t=n.details?` (${n.details})`:"";staticMethods.error(`${e}${t}`)}}catch(t){staticMethods.error(`保存失败: ${t.message}`)}},children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"groupname",label:"组名称",rules:[{required:!0,message:"请输入组名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入组名称"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"allocation",label:"分配方式",children:jsxRuntimeExports.jsx(Select,{placeholder:"选择分配方式",children:g.length>0?g.map(e=>{const t=ALLOCATION_METHODS.find(t=>t.value===e);return jsxRuntimeExports.jsx(Option$7,{value:e,children:(null==t?void 0:t.label)||e},e)}):ALLOCATION_METHODS.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e.value,children:e.label},e.value))})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"描述",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入组描述"})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"daily_lead_limit",label:"日限制",dependencies:["enable_quality_control"],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,placeholder:"最大分配",style:{width:"100%"},disabled:!r.getFieldValue("enable_quality_control")})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"conversion_rate_requirement",label:"转化率(%)",dependencies:["enable_quality_control"],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,max:100,step:.1,placeholder:"最低转化率",style:{width:"100%"},disabled:!r.getFieldValue("enable_quality_control")})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"max_pending_leads",label:"最大待处理",dependencies:["enable_quality_control"],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,placeholder:"最大待处理数量",style:{width:"100%"},disabled:!r.getFieldValue("enable_quality_control")})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"list",label:"成员ID列表",rules:[{required:!0,message:"请选择成员"}],children:jsxRuntimeExports.jsx(UserTreeSelect,{value:me,onChange:e=>{he(e),r.setFieldsValue({list:e})},placeholder:"请选择成员",style:{width:"100%"}})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"enable_quality_control",label:"启用质量控制",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"enable_community_matching",label:"启用社区匹配",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:_?"更新销售组":"创建销售组"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{b(!1),S(null),he([]),r.resetFields()},children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:A?"编辑积分成本规则":"新增积分成本规则",open:I,onCancel:()=>{P(!1),F(null),s.resetFields()},footer:null,width:800,children:jsxRuntimeExports.jsxs(Form$4,{form:s,layout:"vertical",onFinish:async e=>{try{const t={...e,conditions:e.conditions?JSON.parse(e.conditions):{},dynamic_cost_config:e.dynamic_cost_config?JSON.parse(e.dynamic_cost_config):{}};let r;r=A?await pointsAllocationApi.costRules.updateRule(A.id,t):await pointsAllocationApi.costRules.createRule(t),r.success?(staticMethods.success(A?"积分成本规则更新成功":"积分成本规则创建成功"),P(!1),s.resetFields(),F(null),ee()):staticMethods.error(r.error||"保存失败")}catch(t){staticMethods.error("保存失败，请检查JSON格式是否正确")}},children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入规则名称"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"base_points_cost",label:"基础积分成本",rules:[{required:!0,message:"请输入基础积分成本"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,max:1e3,placeholder:"请输入积分成本",style:{width:"100%"},addonAfter:"积分"})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"规则描述",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入规则描述"})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"priority",label:"优先级",initialValue:100,children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,max:999,placeholder:"数字越大优先级越高",style:{width:"100%"}})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"是否启用",valuePropName:"checked",initialValue:!0,children:jsxRuntimeExports.jsx(Switch$1,{})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"conditions",label:"触发条件",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入JSON格式的触发条件，例如：{'sources': ['抖音'], 'lead_types': ['基础']}",rows:4})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"dynamic_cost_config",label:"动态调整配置",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入JSON格式的动态调整配置，例如：{'source_adjustments': {'抖音': 15}}",rows:4})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:A?"更新规则":"创建规则"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{P(!1),F(null),s.resetFields()},children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:B?"编辑社区关键词映射":"新增社区关键词映射",open:O,onCancel:()=>{N(!1),L(null),n.resetFields()},footer:null,width:600,children:jsxRuntimeExports.jsxs(Form$4,{form:n,layout:"vertical",onFinish:async e=>{try{let t;t=B?await allocationApi.communityKeywords.updateKeyword(B.id,e):await allocationApi.communityKeywords.createKeyword(e),t.success?(staticMethods.success(B?"社区关键词映射更新成功":"社区关键词映射创建成功"),N(!1),n.resetFields(),L(null),te()):staticMethods.error(t.error||"保存失败")}catch(t){staticMethods.error("保存失败")}},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"keyword",label:"关键词",rules:[{required:!0,message:"请输入关键词"}],children:jsxRuntimeExports.jsx(Select,{mode:"tags",placeholder:"请输入关键词，可添加多个",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"community",label:"对应社区",rules:[{required:!0,message:"请选择对应社区"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择社区",children:x.map(e=>jsxRuntimeExports.jsx(Option$7,{value:e,children:e},e))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"priority",label:"优先级",initialValue:0,children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,max:999,placeholder:"数字越大优先级越高",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:B?"更新映射":"创建映射"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{N(!1),L(null),n.resetFields()},children:"取消"})]})})]})})]});var Ie,Pe,Ae},{Title:Title$9,Text:Text$c}=Typography,ResetPassword=()=>{const[e]=Form$4.useForm(),[t,r]=reactExports.useState(!1),[s,n]=reactExports.useState(!1),i=useNavigate();return s?jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:400,textAlign:"center"},children:[jsxRuntimeExports.jsx(RefIcon$7,{style:{fontSize:48,color:"#52c41a",marginBottom:16}}),jsxRuntimeExports.jsx(Title$9,{level:3,children:"密码重置成功！"}),jsxRuntimeExports.jsx(Text$c,{children:"即将跳转到登录页面..."}),jsxRuntimeExports.jsx("div",{style:{marginTop:24},children:jsxRuntimeExports.jsx(LoadingScreen,{type:"auth"})})]})}):jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f7f8fa"},children:jsxRuntimeExports.jsxs(Card$1,{style:{width:400,textAlign:"center"},children:[jsxRuntimeExports.jsx(Title$9,{level:3,children:"重置密码"}),jsxRuntimeExports.jsx(Text$c,{type:"secondary",children:"请输入新密码以完成重置"}),jsxRuntimeExports.jsxs(Form$4,{form:e,layout:"vertical",onFinish:async e=>{try{r(!0);const{password:t}=e,{error:s}=await supabase.auth.updateUser({password:t});if(s)return void staticMethods.error("密码重置失败: "+s.message);staticMethods.success("密码重置成功！正在跳转登录..."),n(!0),setTimeout(()=>{i("/login")},2e3)}catch(t){staticMethods.error("密码重置失败: "+(t.message||"未知错误"))}finally{r(!1)}},style:{marginTop:32},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请输入新密码"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"confirmPassword",label:"确认新密码",dependencies:["password"],rules:[{required:!0,message:"请确认新密码"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve()})],children:jsxRuntimeExports.jsx(Input$1.Password,{prefix:jsxRuntimeExports.jsx(RefIcon$p,{}),placeholder:"请再次输入新密码"})}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginTop:32},children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:t,block:!0,size:"large",children:"重置密码"})})]})]})})};class AchievementApi{async getUserAchievements(e){const{data:t,error:r}=await supabase.rpc("get_user_achievements",{p_user_id:e});if(r)throw r;return t||[]}async updateAchievementProgress(e,t,r,s,n){const{data:i,error:o}=await supabase.rpc("update_achievement_progress",{p_user_id:e,p_achievement_code:t,p_progress_change:r,p_trigger_source:s,p_trigger_data:n});if(o)throw o;return i}async getUserAvatarFrames(e){const{data:t,error:r}=await supabase.rpc("get_user_avatar_frames",{p_user_id:e});if(r)throw r;return t||[]}async getUserBadges(e){const{data:t,error:r}=await supabase.rpc("get_user_badges",{p_user_id:e});if(r)throw r;return t||[]}async equipAvatarFrame(e,t){const{error:r}=await supabase.from("user_avatar_frames").update({is_equipped:!1}).eq("user_id",e);if(r)throw r;if(t&&""!==t.trim()){const{error:r}=await supabase.from("user_avatar_frames").update({is_equipped:!0}).eq("user_id",e).eq("frame_id",t);if(r)throw r}return!0}async equipBadge(e,t){const{error:r}=await supabase.from("user_badges").update({is_equipped:!1}).eq("user_id",e);if(r)throw r;const{error:s}=await supabase.from("user_badges").update({is_equipped:!0}).eq("user_id",e).eq("badge_id",t);if(s)throw s;return!0}async getAchievementStats(e){const t=await this.getUserAchievements(e),r=await this.getUserAvatarFrames(e),s=await this.getUserBadges(e),n=t.filter(e=>e.is_completed).length,i=t.filter(e=>!e.is_completed&&e.progress>0).length,o=t.reduce((e,t)=>e+t.points_earned,0);return{total:t.length,completed:n,in_progress:i,completion_rate:t.length>0?Math.round(n/t.length*100):0,total_points_earned:o,total_avatar_frames:r.length,total_badges:s.length}}getRarityColor(e){return{common:"#52c41a",rare:"#1890ff",epic:"#fa8c16",legendary:"#722ed1"}[e]||"#666"}getRarityText(e){return{common:"基础",rare:"稀有",epic:"史诗",legendary:"传说"}[e]||"未知"}getCategoryText(e){return{milestone:"里程碑",skill:"技能",social:"社交",special:"特殊"}[e]||"未知"}getCategoryColor(e){return{milestone:"#52c41a",skill:"#1890ff",social:"#fa8c16",special:"#722ed1"}[e]||"#666"}}const achievementApi=new AchievementApi,useAchievements=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(!0),[u,d]=reactExports.useState(null),{profile:p}=useUser();reactExports.useEffect(()=>{(null==p?void 0:p.id)&&d(p.id)},[p]);const m=reactExports.useCallback(async e=>{try{c(!0);const[r,n,o,l]=await Promise.all([achievementApi.getUserAchievements(e),achievementApi.getUserAvatarFrames(e),achievementApi.getUserBadges(e),achievementApi.getAchievementStats(e)]);t(r),s(n),i(o),a(l)}catch(r){console.error("加载成就数据失败:",r)}finally{c(!1)}},[]);reactExports.useEffect(()=>{u&&m(u)},[u,m]);const h=reactExports.useCallback(async(e,t,r,s)=>{if(u)try{const n=await achievementApi.updateAchievementProgress(u,e,t,r,s);return n.success&&(await m(u),n.is_completed&&n.points_reward&&n.points_reward),n}catch(n){throw console.error("更新成就进度失败:",n),n}},[u,m]),x=reactExports.useCallback(async e=>{if(u)try{await achievementApi.equipAvatarFrame(u,e);const t=await achievementApi.getUserAvatarFrames(u);s(t)}catch(t){throw console.error("装备头像框失败:",t),t}},[u]),f=reactExports.useCallback(async e=>{if(u)try{await achievementApi.equipBadge(u,e);const t=await achievementApi.getUserBadges(u);i(t)}catch(t){throw console.error("装备勋章失败:",t),t}},[u]),g=reactExports.useCallback(()=>{const t={};return["milestone","skill","social","special"].forEach(r=>{t[r]=e.filter(e=>e.category===r)}),t},[e]),y=reactExports.useCallback(()=>e.filter(e=>e.is_completed),[e]),v=reactExports.useCallback(()=>e.filter(e=>!e.is_completed&&e.progress>0),[e]),E=reactExports.useCallback(()=>e.filter(e=>!e.is_completed&&0===e.progress),[e]),j=reactExports.useCallback(()=>r.find(e=>e.is_equipped),[r]),b=reactExports.useCallback(()=>n.find(e=>e.is_equipped),[n]),w=reactExports.useCallback(()=>{u&&m(u)},[u,m]);return reactExports.useEffect(()=>{const e=e=>{"avatar_refresh_token"===e.key&&w()},t=()=>{w()};return window.addEventListener("storage",e),window.addEventListener("avatar_refresh_token",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("avatar_refresh_token",t)}},[w]),{achievements:e,avatarFrames:r,badges:n,stats:o,loading:l,profileId:u,updateProgress:h,equipAvatarFrame:x,equipBadge:f,refresh:w,getAchievementsByCategory:g,getCompletedAchievements:y,getInProgressAchievements:v,getNotStartedAchievements:E,getEquippedAvatarFrame:j,getEquippedBadge:b,getRarityColor:achievementApi.getRarityColor,getRarityText:achievementApi.getRarityText,getCategoryText:achievementApi.getCategoryText,getCategoryColor:achievementApi.getCategoryColor}},LockIcon=({color:e="#666",size:t=16})=>jsxRuntimeExports.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"16",r:"1"}),jsxRuntimeExports.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),UnlockIcon=({color:e="#ff6b35",size:t=16})=>jsxRuntimeExports.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"16",r:"1"}),jsxRuntimeExports.jsx("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"})]}),CheckIcon=({color:e="#52c41a",size:t=16,strokeWidth:r=2})=>jsxRuntimeExports.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:e,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20,6 9,17 4,12"})}),AchievementCard=({achievement:e})=>{const[t,r]=reactExports.useState(null),[s,n]=reactExports.useState(new Set),i=e.is_completed;let o="locked";i?o="unlocked":e.progress>0&&(o="unlockable");const a=t===e.achievement_id,l=s.has(e.achievement_id),c=l?"unlocked":o,u=(e=>{switch(e){case"locked":return{iconColor:"#999",buttonBg:"#ccc",buttonColor:"#666",buttonDisabled:!0};case"unlockable":default:return{iconColor:"#ff6b35",buttonBg:"#ff6b35",buttonColor:"white",buttonDisabled:!1};case"unlocked":return{iconColor:"#ff6b35",buttonBg:"transparent",buttonColor:"#52c41a",buttonDisabled:!1}}})(c);return jsxRuntimeExports.jsx("div",{style:{textAlign:"center"},children:jsxRuntimeExports.jsxs("div",{style:{width:"200px",height:"180px",backgroundImage:"url(/achievement_card.svg?v="+Date.now()+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",margin:"0 auto",position:"relative",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",color:"#333",padding:"16px 16px 20px 16px",boxSizing:"border-box"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"48px",marginBottom:"10px",lineHeight:"1",filter:"locked"===c?"grayscale(100%)":"none",opacity:"locked"===c?.5:1},children:e.icon}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"4px",lineHeight:"1.2",color:"locked"===c?"#999":"#333"},children:e.name}),jsxRuntimeExports.jsx("div",{style:{fontSize:"11px",color:"locked"===c?"#ccc":"#666",marginBottom:"3px",lineHeight:"1.2"},children:e.description}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"12px",color:"locked"===c?"#ccc":"#ff6b35",fontWeight:"bold",lineHeight:"1.2",marginTop:"2px"},children:["+",e.points_reward," 积分"]})]}),jsxRuntimeExports.jsxs("button",{disabled:u.buttonDisabled,style:{backgroundColor:u.buttonBg,color:u.buttonColor,border:"none",borderRadius:"12px",padding:"6px 14px",fontSize:"11px",fontWeight:"bold",cursor:"unlocked"===c?"default":u.buttonDisabled?"not-allowed":"pointer",boxShadow:"unlocked"===c||u.buttonDisabled?"none":"0 2px 4px rgba(0,0,0,0.2)",transition:"unlocked"===c?"none":"all 0.3s ease",minWidth:"80px",opacity:u.buttonDisabled?.6:1,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",margin:"auto",marginTop:"12px",outline:"none"},onClick:t=>{t.stopPropagation(),(e=>{if("locked"!==o)if("unlockable"===o)r(e.achievement_id),setTimeout(()=>{n(t=>new Set([...t,e.achievement_id])),r(null)},1e3);else if("unlocked"===o);})(e)},children:["unlockable"===c&&!l&&jsxRuntimeExports.jsx("div",{style:{animation:a?"achievementLockOpen 1s ease-in-out":"none",display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(UnlockIcon,{color:u.buttonColor,size:12})}),(l||"unlocked"===c)&&!a&&jsxRuntimeExports.jsx("div",{style:{animation:l?"achievementCheckAppear 0.6s ease-out":"none",display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(CheckIcon,{color:u.buttonColor,size:20,strokeWidth:3})}),"locked"===c&&jsxRuntimeExports.jsx(LockIcon,{color:u.buttonColor,size:12})]})]})})},unlockAnimationStyle="\n  @keyframes achievementLockOpen {\n    0% {\n      transform: scale(1) rotate(0deg);\n      opacity: 1;\n    }\n    20% {\n      transform: scale(1.3) rotate(-3deg);\n      opacity: 1;\n    }\n    40% {\n      transform: scale(1.4) rotate(2deg);\n      opacity: 0.8;\n    }\n    60% {\n      transform: scale(1.5) rotate(-1deg);\n      opacity: 0.5;\n    }\n    80% {\n      transform: scale(1.6) rotate(0deg);\n      opacity: 0.2;\n    }\n    100% {\n      transform: scale(1.7) rotate(0deg);\n      opacity: 0;\n    }\n  }\n  \n  @keyframes achievementCheckAppear {\n    0% {\n      transform: scale(0) rotate(-90deg);\n      opacity: 0;\n    }\n    20% {\n      transform: scale(1.4) rotate(-45deg);\n      opacity: 0.7;\n    }\n    40% {\n      transform: scale(1.1) rotate(-15deg);\n      opacity: 0.9;\n    }\n    60% {\n      transform: scale(0.95) rotate(5deg);\n      opacity: 1;\n    }\n    80% {\n      transform: scale(1.05) rotate(-2deg);\n      opacity: 1;\n    }\n    100% {\n      transform: scale(1) rotate(0deg);\n      opacity: 1;\n    }\n  }\n";let styleSheet=null;document.getElementById("achievement-animations")||(styleSheet=document.createElement("style"),styleSheet.id="achievement-animations",styleSheet.textContent=unlockAnimationStyle,document.head.appendChild(styleSheet));const AchievementSystem=({showHeader:e=!0})=>{const{achievements:t,stats:r,loading:s,getAchievementsByCategory:n}=useAchievements(),[i,o]=reactExports.useState("all"),a=({key:e})=>{o(e)};return s?jsxRuntimeExports.jsx("div",{className:"achievement-system",children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",flexDirection:"column",gap:"16px"},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{color:"rgba(0, 0, 0, 0.6)",fontSize:"14px"},children:"加载成就数据中..."})]})}):jsxRuntimeExports.jsxs("div",{className:"achievement-system",children:[e&&jsxRuntimeExports.jsxs("div",{style:{marginBottom:24},children:[jsxRuntimeExports.jsxs("div",{className:"achievement-title",children:[jsxRuntimeExports.jsx(RefIcon$C,{className:"achievement-title-icon"}),"成就系统"]}),r&&jsxRuntimeExports.jsxs("div",{className:"achievement-stats",children:[jsxRuntimeExports.jsxs("div",{className:"stat-card",children:[jsxRuntimeExports.jsx("div",{className:"stat-title",children:"总成就"}),jsxRuntimeExports.jsxs("div",{className:"stat-value",children:[jsxRuntimeExports.jsx(RefIcon$C,{}),r.total]})]}),jsxRuntimeExports.jsxs("div",{className:"stat-card",children:[jsxRuntimeExports.jsx("div",{className:"stat-title",children:"已完成"}),jsxRuntimeExports.jsxs("div",{className:"stat-value completed",children:[jsxRuntimeExports.jsx(RefIcon$7,{}),r.completed]})]}),jsxRuntimeExports.jsxs("div",{className:"stat-card",children:[jsxRuntimeExports.jsx("div",{className:"stat-title",children:"完成率"}),jsxRuntimeExports.jsxs("div",{className:"stat-value rate",children:[jsxRuntimeExports.jsx(RefIcon$S,{}),r.completion_rate,"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"stat-card",children:[jsxRuntimeExports.jsx("div",{className:"stat-title",children:"获得积分"}),jsxRuntimeExports.jsxs("div",{className:"stat-value points",children:[jsxRuntimeExports.jsx(RefIcon$T,{}),r.total_points_earned]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"achievement-layout",children:[jsxRuntimeExports.jsxs("div",{className:"achievement-menu",children:[jsxRuntimeExports.jsx("div",{className:"menu-item "+("all"===i?"selected":""),onClick:()=>a({key:"all"}),children:"全部成就"}),jsxRuntimeExports.jsx("div",{className:"menu-item "+("milestone"===i?"selected":""),onClick:()=>a({key:"milestone"}),children:"里程碑"}),jsxRuntimeExports.jsx("div",{className:"menu-item "+("skill"===i?"selected":""),onClick:()=>a({key:"skill"}),children:"技能"}),jsxRuntimeExports.jsx("div",{className:"menu-item "+("social"===i?"selected":""),onClick:()=>a({key:"social"}),children:"社交"}),jsxRuntimeExports.jsx("div",{className:"menu-item "+("special"===i?"selected":""),onClick:()=>a({key:"special"}),children:"特殊"})]}),jsxRuntimeExports.jsx("div",{className:"achievement-cards",children:(()=>{switch(i){case"all":default:return t;case"milestone":return n().milestone||[];case"skill":return n().skill||[];case"social":return n().social||[];case"special":return n().special||[]}})().map(e=>jsxRuntimeExports.jsx(AchievementCard,{achievement:e},e.achievement_id))})]})]})},{Text:Text$b}=Typography;function PointsExchange(){const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(!0),[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(0),[u,d]=reactExports.useState(null),[p,m]=reactExports.useState("achievements"),[h,x]=reactExports.useState(null),[f,g]=reactExports.useState(null),[y,v]=reactExports.useState(!1),[E,j]=reactExports.useState(null),[b,w]=reactExports.useState({visible:!1,goodsId:"",pointsRequired:0,description:"",goodsName:""}),R=reactExports.useRef(null),_=reactExports.useRef(!1),{profile:S}=useUser();reactExports.useEffect(()=>{(null==S?void 0:S.id)&&d(S.id)},[S]),reactExports.useEffect(()=>{u&&(C(u),k(u),$(u))},[u]),reactExports.useEffect(()=>{_.current=!1,v(!1),R.current&&R.current.goToAndStop(0,!0)},[p]),reactExports.useEffect(()=>{fetch("/points.json").then(e=>e.json()).then(e=>x(e)).catch(e=>console.error("加载积分动画失败:",e))},[]),reactExports.useEffect(()=>{fetch("/coin.json").then(e=>e.json()).then(e=>g(e)).catch(e=>console.error("加载金币动画失败:",e))},[]);const C=async e=>{try{const{data:t,error:r}=await supabase.from("user_points_wallet").select("total_points").eq("user_id",e).single();if(r)throw console.error("直接查询积分失败:",r),r;c(t.total_points)}catch(t){console.error("获取用户积分失败:",t),console.error("错误详情:",{message:t instanceof Error?t.message:"未知错误",stack:t instanceof Error?t.stack:void 0})}},k=async e=>{try{i(!0);const r=await filterPointsTransactions(e,{orderBy:"created_at",ascending:!1,limit:50});t(r)}catch(r){console.error("加载积分明细失败:",r),console.error("错误详情:",{message:r instanceof Error?r.message:"未知错误",stack:r instanceof Error?r.stack:void 0}),a(r instanceof Error?r.message:"加载积分明细失败")}finally{i(!1)}},$=async e=>{try{const t=await getExchangeGoods(void 0,e);s(t)}catch(t){console.error("加载兑换商品失败:",t)}},T=async(e,t)=>{try{if(j(e),!u)return console.error("兑换失败: profileId 为空"),void staticMethods.error("用户信息获取失败");const r=await exchangeGoodsItem(u,e,t);if(r.success){let e=`兑换成功！消耗 ${r.points_used} 积分`;if(r.reward_issued){let t="";switch(r.reward_type){case"direct":t="带看直通卡";break;case"gift":t="礼品";break;case"privilege":t="特权";break;case"achievement":t="成就";break;default:t="奖励"}e+=`，已发放${t}`}staticMethods.success(e),await C(u),await k(u),await $(u)}else console.error("兑换失败:",r.error),staticMethods.error(`兑换失败：${r.error}`)}catch(r){console.error("兑换过程中发生异常:",r),console.error("异常详情:",{message:r instanceof Error?r.message:"未知错误",stack:r instanceof Error?r.stack:void 0}),staticMethods.error("兑换失败："+(r instanceof Error?r.message:"未知错误"))}finally{j(null)}},I=()=>{w({...b,visible:!1})},P=reactExports.useMemo(()=>{const t=[...new Set(e.map(e=>e.transaction_type))],r=[...new Set(e.map(e=>e.source_type))];return[{title:"时间",dataIndex:"created_at",key:"created_at",sorter:(e,t)=>toBeijingTime(e.created_at).valueOf()-toBeijingTime(t.created_at).valueOf(),defaultSortOrder:"descend",render:e=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"exchange-time-date",children:toBeijingDateStr(e)}),jsxRuntimeExports.jsx("div",{className:"exchange-time-time",children:toBeijingTimeStr(e)})]})},{title:"交易类型",dataIndex:"transaction_type",key:"transaction_type",filters:t.map(e=>({text:"EARN"===e?"获得积分":"EXCHANGE"===e?"积分兑换":"DEDUCT"===e?"积分扣除":e,value:e})),onFilter:(e,t)=>t.transaction_type===e,render:e=>{const t="EARN"===e?"green":"EXCHANGE"===e?"blue":"red",r="EARN"===e?"获得":"EXCHANGE"===e?"兑换":"扣分";return jsxRuntimeExports.jsx(Tag$1,{color:t,className:"exchange-tag",children:r})}},{title:"来源类型",dataIndex:"source_type",key:"source_type",filters:r.map(e=>({text:"FOLLOWUP"===e?"跟进任务":"DEAL"===e?"成交订单":"SIGNIN"===e?"每日签到":"EXCHANGE_LEAD"===e?"兑换线索":"ALLOCATION_LEAD"===e?"线索分配":"ROLLBACK_REFUND"===e?"积分回退":"MANUAL_ADJUST"===e?"手动调整":"POINTS_ADJUST"===e?"积分调整":e,value:e})),onFilter:(e,t)=>t.source_type===e,render:e=>{const t="FOLLOWUP"===e?"跟进":"DEAL"===e?"成交":"SIGNIN"===e?"签到":"EXCHANGE_LEAD"===e?"兑换线索":"ALLOCATION_LEAD"===e?"线索分配":"ROLLBACK_REFUND"===e?"积分回退":"MANUAL_ADJUST"===e?"手动调整":"POINTS_ADJUST"===e?"积分调整":e;return jsxRuntimeExports.jsx(Tag$1,{color:"default",className:"exchange-tag",children:t})}},{title:"积分变动",dataIndex:"points_change",key:"points_change",sorter:(e,t)=>e.points_change-t.points_change,render:e=>jsxRuntimeExports.jsxs(Text$b,{type:e>0?"success":"danger",strong:!0,className:"exchange-points-text",children:[e>0?"+":"",e]})},{title:"余额",dataIndex:"balance_after",key:"balance_after",sorter:(e,t)=>e.balance_after-t.balance_after,render:e=>jsxRuntimeExports.jsx(Text$b,{strong:!0,children:e})},{title:"说明",dataIndex:"description",key:"description",ellipsis:!0,render:e=>jsxRuntimeExports.jsx(Text$b,{type:"secondary",ellipsis:{tooltip:e},children:e||"无"})}]},[e]),A=()=>{};return n?jsxRuntimeExports.jsx("div",{className:"loading-container",children:jsxRuntimeExports.jsx(Spin,{size:"default",indicator:jsxRuntimeExports.jsx(RefIcon$U,{className:"loading-icon",spin:!0})})}):o?jsxRuntimeExports.jsx(Alert,{message:"加载失败",description:o,type:"error",showIcon:!0,action:jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,onClick:()=>u&&k(u),children:"重试"}),className:"alert-margin"}):jsxRuntimeExports.jsxs("div",{className:"points-exchange-container",children:[jsxRuntimeExports.jsx("div",{className:"points-summary-card",children:jsxRuntimeExports.jsxs("div",{className:"points-summary-content",children:[jsxRuntimeExports.jsxs("div",{className:"points-info",children:[jsxRuntimeExports.jsxs("div",{className:"points-value",children:[f&&jsxRuntimeExports.jsx(Lottie,{animationData:f,style:{width:50,height:50,marginRight:6},loop:!0,autoplay:!0}),l]}),jsxRuntimeExports.jsx("div",{className:"points-label",children:"剩余积分"})]}),jsxRuntimeExports.jsx("div",{className:"points-icon-container",onMouseEnter:()=>{y||_.current||(v(!0),_.current=!0,R.current&&R.current.play())},onMouseLeave:()=>{v(!1)},children:h&&jsxRuntimeExports.jsx(Lottie,{lottieRef:R,animationData:h,className:"points-animation",loop:!1,autoplay:!1,onComplete:()=>{_.current=!1,R.current&&R.current.goToAndStop(0,!0)},onLoad:()=>{}})})]})}),jsxRuntimeExports.jsx("div",{className:"main-content-card",children:jsxRuntimeExports.jsxs("div",{className:"custom-tabs",children:[jsxRuntimeExports.jsxs("div",{className:"tab-nav",children:[jsxRuntimeExports.jsx("button",{className:"tab-button "+("achievements"===p?"active":""),onClick:()=>m("achievements"),children:jsxRuntimeExports.jsxs("span",{className:"tab-text",children:[jsxRuntimeExports.jsx(RefIcon$V,{className:"tab-icon achievement"}),"我的成就"]})}),jsxRuntimeExports.jsx("button",{className:"tab-button "+("exchange"===p?"active":""),onClick:()=>m("exchange"),children:jsxRuntimeExports.jsxs("span",{className:"tab-text",children:[jsxRuntimeExports.jsx(RefIcon$W,{className:"tab-icon exchange"}),"积分兑换"]})}),jsxRuntimeExports.jsx("button",{className:"tab-button "+("records"===p?"active":""),onClick:()=>m("records"),children:jsxRuntimeExports.jsxs("span",{className:"tab-text",children:[jsxRuntimeExports.jsx(RefIcon$X,{className:"tab-icon records"}),"积分明细"]})})]}),jsxRuntimeExports.jsxs("div",{className:"tab-content",children:["achievements"===p&&jsxRuntimeExports.jsx("div",{className:"tab-pane active",children:jsxRuntimeExports.jsx(AchievementSystem,{showHeader:!1})}),"exchange"===p&&jsxRuntimeExports.jsx("div",{className:"tab-pane active",children:jsxRuntimeExports.jsx("div",{className:"exchange-wrapper",children:jsxRuntimeExports.jsxs("div",{className:"exchange-cards-container",children:[r.map(e=>jsxRuntimeExports.jsx("div",{className:"exchange-card-wrapper",children:jsxRuntimeExports.jsxs("div",{className:"exchange-card",children:[jsxRuntimeExports.jsx("div",{className:"exchange-icon lead",children:"emoji"===e.icon_type?jsxRuntimeExports.jsx("span",{style:{fontSize:"24px"},children:e.icon}):e.icon_url?jsxRuntimeExports.jsx("img",{src:e.icon_url,alt:e.name,style:{width:"24px",height:"24px"}}):jsxRuntimeExports.jsx(RefIcon$5,{})}),jsxRuntimeExports.jsxs("div",{className:`price-tag ${e.category.toLowerCase()} font-bitcount`,children:[e.points_cost,jsxRuntimeExports.jsx("img",{src:"/coin2.svg",alt:"coin",className:"coin-icon",style:{width:36,height:36}})]}),jsxRuntimeExports.jsx("div",{className:`exchange-title ${e.category.toLowerCase()}`,children:e.name}),jsxRuntimeExports.jsx("div",{className:"exchange-description",children:e.description}),e.daily_limit&&jsxRuntimeExports.jsxs("div",{style:{fontSize:"11px",color:"rgba(101, 67, 33, 0.5)",marginTop:"4px",marginBottom:"8px"},children:["每日限制: ",e.remaining_daily_limit,"/",e.daily_limit]}),jsxRuntimeExports.jsx("button",{className:"exchange-button "+(!e.can_exchange||l<e.points_cost||E===e.id?"disabled":""),disabled:!e.can_exchange||l<e.points_cost||E===e.id,onClick:()=>(async(e,t,r,s)=>{E||(s.includes("带看直通卡")||s.includes("带看卡")?w({visible:!0,goodsId:e,pointsRequired:t,description:r,goodsName:s}):await T(e,r))})(e.id,e.points_cost,`兑换${e.name}`,e.name),children:E===e.id?"兑换中...":e.can_exchange?l>=e.points_cost?"立即兑换":"积分不足":"已达限制"})]})},e.id)),r.length<3&&jsxRuntimeExports.jsx("div",{className:"exchange-card-wrapper empty-slot"})]})})}),"records"===p&&jsxRuntimeExports.jsx("div",{className:"tab-pane active",children:jsxRuntimeExports.jsx("div",{className:"exchange-records-container",children:e.length>0?jsxRuntimeExports.jsx(ForwardTable,{className:"exchange-records-table",dataSource:e,columns:P,onChange:A,pagination:{pageSize:15,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,size:"small"},size:"small",rowKey:"id"}):jsxRuntimeExports.jsxs("div",{className:"empty-state-enhanced",children:[jsxRuntimeExports.jsx("div",{className:"empty-state-icon",children:jsxRuntimeExports.jsx(RefIcon$B,{})}),jsxRuntimeExports.jsxs("div",{className:"empty-state-content",children:[jsxRuntimeExports.jsx("h3",{className:"empty-state-title",children:"暂无积分明细"}),jsxRuntimeExports.jsx("p",{className:"empty-state-description",children:"您还没有积分变动记录，完成以下操作即可获得积分："}),jsxRuntimeExports.jsxs("div",{className:"empty-state-tips",children:[jsxRuntimeExports.jsxs("div",{className:"tip-item",children:[jsxRuntimeExports.jsx(RefIcon$W,{className:"tip-icon"}),jsxRuntimeExports.jsx("span",{children:"参与直播"})]}),jsxRuntimeExports.jsxs("div",{className:"tip-item",children:[jsxRuntimeExports.jsx(RefIcon$X,{className:"tip-icon"}),jsxRuntimeExports.jsx("span",{children:"完成新人勤奋度任务"})]})]})]})]})})})]})]})}),jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(RefIcon$b,{style:{color:"#faad14"}}),jsxRuntimeExports.jsx("span",{children:"确认兑换"})]}),open:b.visible,onCancel:I,footer:null,width:480,className:"confirm-modal-glass",styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.1)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)"}},children:jsxRuntimeExports.jsxs("div",{style:{padding:"16px 0"},children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:"16px",fontWeight:500,marginBottom:"16px",color:"#262626"},children:["是否使用 ",b.pointsRequired," 积分兑换",b.goodsName,"？"]}),jsxRuntimeExports.jsxs("div",{style:{backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",padding:"12px 16px",marginBottom:"16px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",color:"#ff4d4f",fontWeight:500,marginBottom:"8px"},children:"⚠️ 重要提醒"}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"13px",color:"#666",lineHeight:"1.5"},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"6px"},children:"• 带看佣金跳点为5%～15%"}),jsxRuntimeExports.jsx("div",{children:"• 带看直通卡发送至组长账户内"})]})]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999",lineHeight:"1.4"},children:"兑换后将立即扣除相应积分，组长可在带看记录中查看自己的直通卡数量。"}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:I,style:{borderColor:"#d9d9d9"},children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:E===b.goodsId,onClick:async()=>{const{goodsId:e,description:t}=b;w({...b,visible:!1}),await T(e,t)},style:{backgroundColor:"#000000",borderColor:"#000000"},children:"确认兑换"})]})]})})]})}const{Title:Title$8,Text:Text$a}=Typography,{TextArea:TextArea$4}=Input$1,{Option:Option$6}=Select,AnnouncementManagement=()=>{const{user:e}=useUser(),[t,r]=reactExports.useState([]),[s,n]=reactExports.useState(!1),[i,o]=reactExports.useState(!1),[a,l]=reactExports.useState(null),[c]=Form$4.useForm(),[u,d]=reactExports.useState({total:0,active:0,inactive:0}),p=async()=>{n(!0);try{const{data:e,error:t}=await supabase.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;r(e||[]);const s=e.filter(e=>e.is_active).length;d({total:e.length,active:s,inactive:e.length-s})}catch(e){staticMethods.error("获取公告列表失败"),console.error("获取公告列表失败:",e)}finally{n(!1)}};reactExports.useEffect(()=>{p()},[]);const m=()=>{c.resetFields(),l(null)},h=e=>{switch(e){case"info":return jsxRuntimeExports.jsx(RefIcon$t,{style:{color:"#1890ff"}});case"warning":return jsxRuntimeExports.jsx(RefIcon$Y,{style:{color:"#faad14"}});case"success":return jsxRuntimeExports.jsx(RefIcon$7,{style:{color:"#52c41a"}});case"error":return jsxRuntimeExports.jsx(RefIcon$b,{style:{color:"#ff4d4f"}});default:return jsxRuntimeExports.jsx(RefIcon$t,{})}},x=e=>{const t={info:{color:"blue",text:"信息"},warning:{color:"orange",text:"警告"},success:{color:"green",text:"成功"},error:{color:"red",text:"错误"}},r=t[e]||t.info;return jsxRuntimeExports.jsx(Tag$1,{color:r.color,children:r.text})},f=[{title:"标题",dataIndex:"title",key:"title",width:200,render:e=>jsxRuntimeExports.jsx(Text$a,{strong:!0,style:{fontSize:14},children:e})},{title:"类型",dataIndex:"type",key:"type",width:100,render:e=>jsxRuntimeExports.jsxs(Space$1,{children:[h(e),x(e)]})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e>1?"red":e>0?"orange":"default",children:e})},{title:"状态",dataIndex:"is_active",key:"is_active",width:100,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e?"green":"red",children:e?"启用":"停用"})},{title:"生效时间",dataIndex:"start_time",key:"start_time",width:150,render:e=>dayjs(e).format("YYYY-MM-DD HH:mm")},{title:"过期时间",dataIndex:"end_time",key:"end_time",width:150,render:e=>e?dayjs(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:150,render:e=>dayjs(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"actions",width:200,render:(e,s)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Tooltip,{title:"编辑",children:jsxRuntimeExports.jsx(Button$1,{type:"text",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>(e=>{l(e),c.setFieldsValue({...e,start_time:e.start_time?dayjs(e.start_time):void 0,end_time:e.end_time?dayjs(e.end_time):void 0}),o(!0)})(s)})}),jsxRuntimeExports.jsx(Tooltip,{title:s.is_active?"停用":"启用",children:jsxRuntimeExports.jsx(Button$1,{type:"text",icon:s.is_active?jsxRuntimeExports.jsx(RefIcon$6,{}):jsxRuntimeExports.jsx(RefIcon$G,{}),onClick:()=>(async e=>{try{const{error:s}=await supabase.from("announcements").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;staticMethods.success("公告已"+(e.is_active?"停用":"启用")),r(t=>t.map(t=>t.id===e.id?{...t,is_active:!e.is_active}:t));const n=t.map(t=>t.id===e.id?{...t,is_active:!e.is_active}:t),i=n.filter(e=>e.is_active).length;d({total:n.length,active:i,inactive:n.length-i})}catch(s){staticMethods.error("状态更新失败"),console.error("状态更新失败:",s)}})(s)})}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定要删除这个公告吗？",description:"删除后无法恢复",onConfirm:()=>(async e=>{try{const{error:s}=await supabase.from("announcements").delete().eq("id",e);if(s)throw console.error("数据库删除失败:",s),s;staticMethods.success("公告删除成功"),r(t=>t.filter(t=>t.id!==e));const n=t.filter(t=>t.id!==e),i=n.filter(e=>e.is_active).length;d({total:n.length,active:i,inactive:n.length-i})}catch(s){console.error("删除公告失败，ID:",e,"错误详情:",s),staticMethods.error("删除公告失败")}})(s.id),okText:"确定",cancelText:"取消",children:jsxRuntimeExports.jsx(Tooltip,{title:"删除",children:jsxRuntimeExports.jsx(Button$1,{type:"text",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{})})})})]})}];return jsxRuntimeExports.jsxs("div",{style:{padding:"24px"},children:[jsxRuntimeExports.jsxs(Card$1,{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:jsxRuntimeExports.jsxs(Row,{gutter:16,align:"middle",children:[jsxRuntimeExports.jsxs(Col,{flex:"auto",children:[jsxRuntimeExports.jsxs(Title$8,{level:3,style:{margin:0},children:[jsxRuntimeExports.jsx(RefIcon$G,{style:{marginRight:8}}),"公告配置管理"]}),jsxRuntimeExports.jsx(Text$a,{type:"secondary",children:"管理系统公告，面向全体人员的通知配置"})]}),jsxRuntimeExports.jsx(Col,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{m(),o(!0)},size:"large",children:"创建公告"})})]})}),jsxRuntimeExports.jsxs(Row,{gutter:16,style:{marginBottom:24},children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx(Statistic,{title:"总公告数",value:u.total,prefix:jsxRuntimeExports.jsx(RefIcon$G,{})})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx(Statistic,{title:"启用公告",value:u.active,valueStyle:{color:"#3f8600"},prefix:jsxRuntimeExports.jsx(RefIcon$7,{})})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx(Statistic,{title:"停用公告",value:u.inactive,valueStyle:{color:"#cf1322"},prefix:jsxRuntimeExports.jsx(RefIcon$b,{})})})})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:f,dataSource:t,rowKey:"id",loading:s,pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条公告`},scroll:{x:1200}})]}),jsxRuntimeExports.jsx(Modal$2,{title:a?"编辑公告":"创建公告",open:i,onCancel:()=>{o(!1),m()},footer:null,width:800,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:c,layout:"vertical",onFinish:async t=>{var s,n;try{const i={...t,start_time:null==(s=t.start_time)?void 0:s.toISOString(),end_time:null==(n=t.end_time)?void 0:n.toISOString()};if(a){const{error:e}=await supabase.from("announcements").update(i).eq("id",a.id);if(e)throw e;staticMethods.success("公告更新成功"),r(e=>e.map(e=>e.id===a.id?{...e,...i}:e))}else{const{error:t}=await supabase.from("announcements").insert({...i,created_by:(null==e?void 0:e.id)?parseInt(e.id):void 0});if(t)throw t;staticMethods.success("公告创建成功"),p()}o(!1),m()}catch(i){staticMethods.error(a?"更新公告失败":"创建公告失败"),console.error("提交失败:",i)}},initialValues:{type:"info",priority:0,is_active:!0},children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"title",label:"公告标题",rules:[{required:!0,message:"请输入公告标题"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入公告标题"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"type",label:"公告类型",rules:[{required:!0,message:"请选择公告类型"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择公告类型",children:[jsxRuntimeExports.jsx(Option$6,{value:"info",children:"信息"}),jsxRuntimeExports.jsx(Option$6,{value:"warning",children:"警告"}),jsxRuntimeExports.jsx(Option$6,{value:"success",children:"成功"}),jsxRuntimeExports.jsx(Option$6,{value:"error",children:"错误"})]})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"content",label:"公告内容",rules:[{required:!0,message:"请输入公告内容"}],children:jsxRuntimeExports.jsx(TextArea$4,{rows:6,placeholder:"请输入公告内容",showCount:!0,maxLength:1e3})}),jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择优先级",children:[jsxRuntimeExports.jsx(Option$6,{value:0,children:"基础"}),jsxRuntimeExports.jsx(Option$6,{value:1,children:"重要"}),jsxRuntimeExports.jsx(Option$6,{value:2,children:"紧急"}),jsxRuntimeExports.jsx(Option$6,{value:3,children:"特急"})]})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"start_time",label:"生效时间",rules:[{required:!0,message:"请选择生效时间"}],children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择生效时间",style:{width:"100%"}})})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"end_time",label:"过期时间",children:jsxRuntimeExports.jsx(DatePicker$2,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择过期时间（可选）",style:{width:"100%"}})})})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"状态",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{checkedChildren:"启用",unCheckedChildren:"停用"})}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginBottom:0,textAlign:"right"},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>{o(!1),m()},children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:a?"更新":"创建"})]})})]})})]})};class AchievementTriggers{static async getUserId(){return await getCurrentProfileId()}static async onFollowupCompleted(e){const t=await this.getUserId();if(t)try{await achievementApi.updateAchievementProgress(t,"first_followup",1,"followup_completed",e),await achievementApi.updateAchievementProgress(t,"followup_master",1,"followup_completed",e)}catch(r){console.error("❌ 更新跟进成就失败:",r)}}static async onDealCompleted(e){const t=await this.getUserId();if(t)try{await achievementApi.updateAchievementProgress(t,"first_deal",1,"deal_completed",e),await achievementApi.updateAchievementProgress(t,"deal_master",1,"deal_completed",e)}catch(r){console.error("❌ 更新成交成就失败:",r)}}static async onConversionRateCheck(e){const t=await this.getUserId();if(t)try{e>=20&&await achievementApi.updateAchievementProgress(t,"conversion_master",1,"conversion_rate_check",{conversion_rate:e})}catch(r){console.error("❌ 更新转化率成就失败:",r)}}static async onPointsEarned(e,t){const r=await this.getUserId();if(r)try{t>=1e3&&await achievementApi.updateAchievementProgress(r,"points_collector",1,"points_earned",{points_earned:e,total_points_earned:t})}catch(s){console.error("❌ 更新积分成就失败:",s)}}static async onDailyCheckin(e){const t=await this.getUserId();if(t)try{e>=30&&await achievementApi.updateAchievementProgress(t,"daily_checkin",1,"daily_checkin",{consecutive_days:e})}catch(r){console.error("❌ 更新签到成就失败:",r)}}static async onHelpColleague(e){const t=await this.getUserId();if(t)try{await achievementApi.updateAchievementProgress(t,"team_helper",1,"help_colleague",e)}catch(r){console.error("❌ 更新团队助手成就失败:",r)}}static async onHonorGranted(e,t,r,s,n){try{await achievementApi.updateAchievementProgress(e,t,1,"honor_grant",{frame_id:t,frame_name:r,granted_by:s,notes:n,granted_at:(new Date).toISOString()})}catch(i){console.error("❌ 创建荣誉发放记录失败:",i)}}static async onEventParticipation(e,t,r,s){try{await achievementApi.updateAchievementProgress(e,"event_participation",1,"event_participation",{event_id:t,event_name:r,participation_type:s,participated_at:(new Date).toISOString()})}catch(n){console.error("❌ 创建活动参与记录失败:",n)}}static async onFirstLogin(e){try{await achievementApi.updateAchievementProgress(e,"first_login",1,"first_login",{login_time:(new Date).toISOString(),user_agent:navigator.userAgent})}catch(t){console.error("❌ 记录首次登录失败:",t)}}static async onProfileComplete(e,t){try{await achievementApi.updateAchievementProgress(e,"profile_complete",1,"profile_complete",{completed_fields:Object.keys(t),completed_at:(new Date).toISOString()})}catch(r){console.error("❌ 记录资料完善失败:",r)}}static async onReferralSuccess(e,t,r){try{await achievementApi.updateAchievementProgress(e,"referral_success",1,"referral_success",{referred_user_id:t,referral_type:r,success_at:(new Date).toISOString()})}catch(s){console.error("❌ 记录推荐成功失败:",s)}}static async onManualGrant(e,t,r,s){try{await achievementApi.updateAchievementProgress(e,t,1,"manual_grant",{granted_by:r,reason:s,granted_at:(new Date).toISOString()})}catch(n){console.error("❌ 创建手动发放记录失败:",n)}}static async checkAllAchievements(){await this.getUserId()}}var _populated=!1,_ie,_firefox,_opera,_webkit,_chrome,_ie_real_version,_osx,_windows,_linux,_android,_win64,_iphone,_ipad,_native,_mobile;function _populate(){if(!_populated){_populated=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),r=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(_iphone=/\b(iPhone|iP[ao]d)/.exec(e),_ipad=/\b(iP[ao]d)/.exec(e),_android=/Android/i.exec(e),_native=/FBAN\/\w+;/i.exec(e),_mobile=/Mobile/i.exec(e),_win64=!!/Win64/.exec(e),t){(_ie=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(_ie=document.documentMode);var s=/(?:Trident\/(\d+.\d+))/.exec(e);_ie_real_version=s?parseFloat(s[1])+4:_ie,_firefox=t[2]?parseFloat(t[2]):NaN,_opera=t[3]?parseFloat(t[3]):NaN,(_webkit=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),_chrome=t&&t[1]?parseFloat(t[1]):NaN):_chrome=NaN}else _ie=_firefox=_opera=_chrome=_webkit=NaN;if(r){if(r[1]){var n=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);_osx=!n||parseFloat(n[1].replace("_","."))}else _osx=!1;_windows=!!r[2],_linux=!!r[3]}else _osx=_windows=_linux=!1}}var UserAgent_DEPRECATED$1={ie:function(){return _populate()||_ie},ieCompatibilityMode:function(){return _populate()||_ie_real_version>_ie},ie64:function(){return UserAgent_DEPRECATED$1.ie()&&_win64},firefox:function(){return _populate()||_firefox},opera:function(){return _populate()||_opera},webkit:function(){return _populate()||_webkit},safari:function(){return UserAgent_DEPRECATED$1.webkit()},chrome:function(){return _populate()||_chrome},windows:function(){return _populate()||_windows},osx:function(){return _populate()||_osx},linux:function(){return _populate()||_linux},iphone:function(){return _populate()||_iphone},mobile:function(){return _populate()||_iphone||_ipad||_android||_mobile},nativeApp:function(){return _populate()||_native},android:function(){return _populate()||_android},ipad:function(){return _populate()||_ipad}},UserAgent_DEPRECATED_1=UserAgent_DEPRECATED$1,canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement),ExecutionEnvironment$1={canUseDOM:canUseDOM},ExecutionEnvironment_1=ExecutionEnvironment$1,ExecutionEnvironment=ExecutionEnvironment_1,useHasFeature;
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */
function isEventSupported$1(e,t){if(!ExecutionEnvironment.canUseDOM||t&&!("addEventListener"in document))return!1;var r="on"+e,s=r in document;if(!s){var n=document.createElement("div");n.setAttribute(r,"return;"),s="function"==typeof n[r]}return!s&&useHasFeature&&"wheel"===e&&(s=document.implementation.hasFeature("Events.wheel","3.0")),s}ExecutionEnvironment.canUseDOM&&(useHasFeature=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""));var isEventSupported_1=isEventSupported$1,UserAgent_DEPRECATED=UserAgent_DEPRECATED_1,isEventSupported=isEventSupported_1,PIXEL_STEP=10,LINE_HEIGHT$1=40,PAGE_HEIGHT$1=800;function normalizeWheel$2(e){var t=0,r=0,s=0,n=0;return"detail"in e&&(r=e.detail),"wheelDelta"in e&&(r=-e.wheelDelta/120),"wheelDeltaY"in e&&(r=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=r,r=0),s=t*PIXEL_STEP,n=r*PIXEL_STEP,"deltaY"in e&&(n=e.deltaY),"deltaX"in e&&(s=e.deltaX),(s||n)&&e.deltaMode&&(1==e.deltaMode?(s*=LINE_HEIGHT$1,n*=LINE_HEIGHT$1):(s*=PAGE_HEIGHT$1,n*=PAGE_HEIGHT$1)),s&&!t&&(t=s<1?-1:1),n&&!r&&(r=n<1?-1:1),{spinX:t,spinY:r,pixelX:s,pixelY:n}}normalizeWheel$2.getEventType=function(){return UserAgent_DEPRECATED.firefox()?"DOMMouseScroll":isEventSupported("wheel")?"wheel":"mousewheel"};var normalizeWheel_1=normalizeWheel$2,normalizeWheel=normalizeWheel_1;const normalizeWheel$1=getDefaultExportFromCjs(normalizeWheel);function getCropSize(e,t,r,s,n,i){void 0===i&&(i=0);var o=rotateSize(e,t,i),a=o.width,l=o.height,c=Math.min(a,r),u=Math.min(l,s);return c>u*n?{width:u*n,height:u}:{width:c,height:c/n}}function getMediaZoom(e){return e.width>e.height?e.width/e.naturalWidth:e.height/e.naturalHeight}function restrictPosition(e,t,r,s,n){void 0===n&&(n=0);var i=rotateSize(t.width,t.height,n),o=i.width,a=i.height;return{x:restrictPositionCoord(e.x,o,r.width,s),y:restrictPositionCoord(e.y,a,r.height,s)}}function restrictPositionCoord(e,t,r,s){var n=t*s/2-r/2;return clamp$2(e,-n,n)}function getDistanceBetweenPoints(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function getRotationBetweenPoints(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}function computeCroppedArea(e,t,r,s,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!0);var a=o?limitArea:noOp,l=rotateSize(t.width,t.height,i),c=rotateSize(t.naturalWidth,t.naturalHeight,i),u={x:a(100,((l.width-r.width/n)/2-e.x/n)/l.width*100),y:a(100,((l.height-r.height/n)/2-e.y/n)/l.height*100),width:a(100,r.width/l.width*100/n),height:a(100,r.height/l.height*100/n)},d=Math.round(a(c.width,u.width*c.width/100)),p=Math.round(a(c.height,u.height*c.height/100)),m=c.width>=c.height*s?{width:Math.round(p*s),height:p}:{width:d,height:Math.round(d/s)};return{croppedAreaPercentages:u,croppedAreaPixels:__assign(__assign({},m),{x:Math.round(a(c.width-m.width,u.x*c.width/100)),y:Math.round(a(c.height-m.height,u.y*c.height/100))})}}function limitArea(e,t){return Math.min(e,Math.max(0,t))}function noOp(e,t){return t}function getInitialCropFromCroppedAreaPercentages(e,t,r,s,n,i){var o=rotateSize(t.width,t.height,r),a=clamp$2(s.width/o.width*(100/e.width),n,i);return{crop:{x:a*o.width/2-s.width/2-o.width*a*(e.x/100),y:a*o.height/2-s.height/2-o.height*a*(e.y/100)},zoom:a}}function getZoomFromCroppedAreaPixels(e,t,r){var s=getMediaZoom(t);return r.height>r.width?r.height/(e.height*s):r.width/(e.width*s)}function getInitialCropFromCroppedAreaPixels(e,t,r,s,n,i){void 0===r&&(r=0);var o=rotateSize(t.naturalWidth,t.naturalHeight,r),a=clamp$2(getZoomFromCroppedAreaPixels(e,t,s),n,i),l=s.height>s.width?s.height/e.height:s.width/e.width;return{crop:{x:((o.width-e.width)/2-e.x)*l,y:((o.height-e.height)/2-e.y)*l},zoom:a}}function getCenter(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function getRadianAngle(e){return e*Math.PI/180}function rotateSize(e,t,r){var s=getRadianAngle(r);return{width:Math.abs(Math.cos(s)*e)+Math.abs(Math.sin(s)*t),height:Math.abs(Math.sin(s)*e)+Math.abs(Math.cos(s)*t)}}function clamp$2(e,t,r){return Math.min(Math.max(e,t),r)}function classNames(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return"string"==typeof e&&e.length>0}).join(" ").trim()}var css_248z$1=".reactEasyCrop_Container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  user-select: none;\n  touch-action: none;\n  cursor: move;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.reactEasyCrop_Image,\n.reactEasyCrop_Video {\n  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */\n}\n\n.reactEasyCrop_Contain {\n  max-width: 100%;\n  max-height: 100%;\n  margin: auto;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n}\n.reactEasyCrop_Cover_Horizontal {\n  width: 100%;\n  height: auto;\n}\n.reactEasyCrop_Cover_Vertical {\n  width: auto;\n  height: 100%;\n}\n\n.reactEasyCrop_CropArea {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  box-sizing: border-box;\n  box-shadow: 0 0 0 9999em;\n  color: rgba(0, 0, 0, 0.5);\n  overflow: hidden;\n}\n\n.reactEasyCrop_CropAreaRound {\n  border-radius: 50%;\n}\n\n.reactEasyCrop_CropAreaGrid::before {\n  content: ' ';\n  box-sizing: border-box;\n  position: absolute;\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  top: 0;\n  bottom: 0;\n  left: 33.33%;\n  right: 33.33%;\n  border-top: 0;\n  border-bottom: 0;\n}\n\n.reactEasyCrop_CropAreaGrid::after {\n  content: ' ';\n  box-sizing: border-box;\n  position: absolute;\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  top: 33.33%;\n  bottom: 33.33%;\n  left: 0;\n  right: 0;\n  border-left: 0;\n  border-right: 0;\n}\n",MIN_ZOOM=1,MAX_ZOOM=3,KEYBOARD_STEP=1,Cropper=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.cropperRef=reactExports.createRef(),r.imageRef=reactExports.createRef(),r.videoRef=reactExports.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc="undefined"!=typeof document?document:null,r.currentWindow="undefined"!=typeof window?window:null,r.resizeObserver=null,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(void 0!==window.ResizeObserver&&r.containerRef){var e=!0;r.resizeObserver=new window.ResizeObserver(function(t){e?e=!1:r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(e){return e.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var e=r.computeSizes();e&&(r.emitCropData(),r.setInitialCrop(e)),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(e){if(r.props.initialCroppedAreaPercentages){var t=getInitialCropFromCroppedAreaPercentages(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,e,r.props.minZoom,r.props.maxZoom),s=t.crop,n=t.zoom;r.props.onCropChange(s),r.props.onZoomChange&&r.props.onZoomChange(n)}else if(r.props.initialCroppedAreaPixels){var i=getInitialCropFromCroppedAreaPixels(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,e,r.props.minZoom,r.props.maxZoom);s=i.crop,n=i.zoom;r.props.onCropChange(s),r.props.onZoomChange&&r.props.onZoomChange(n)}},r.computeSizes=function(){var e,t,s,n,i,o,a=r.imageRef.current||r.videoRef.current;if(a&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var l=r.containerRect.width/r.containerRect.height,c=(null===(e=r.imageRef.current)||void 0===e?void 0:e.naturalWidth)||(null===(t=r.videoRef.current)||void 0===t?void 0:t.videoWidth)||0,u=(null===(s=r.imageRef.current)||void 0===s?void 0:s.naturalHeight)||(null===(n=r.videoRef.current)||void 0===n?void 0:n.videoHeight)||0,d=c/u,p=void 0;if(a.offsetWidth<c||a.offsetHeight<u)switch(r.state.mediaObjectFit){default:case"contain":p=l>d?{width:r.containerRect.height*d,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/d};break;case"horizontal-cover":p={width:r.containerRect.width,height:r.containerRect.width/d};break;case"vertical-cover":p={width:r.containerRect.height*d,height:r.containerRect.height}}else p={width:a.offsetWidth,height:a.offsetHeight};r.mediaSize=__assign(__assign({},p),{naturalWidth:c,naturalHeight:u}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var m=r.props.cropSize?r.props.cropSize:getCropSize(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(null===(i=r.state.cropSize)||void 0===i?void 0:i.height)===m.height&&(null===(o=r.state.cropSize)||void 0===o?void 0:o.width)===m.width||r.props.onCropSizeChange&&r.props.onCropSizeChange(m),r.setState({cropSize:m},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(m),m}},r.saveContainerPosition=function(){if(r.containerRef){var e=r.containerRef.getBoundingClientRect();r.containerPosition={x:e.left,y:e.top}}},r.onMouseDown=function(e){r.currentDoc&&(e.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(t.getMousePoint(e)))},r.onMouseMove=function(e){return r.onDrag(t.getMousePoint(e))},r.onScroll=function(e){r.currentDoc&&(e.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(e){r.currentDoc&&(r.isTouching=!0,r.props.onTouchRequest&&!r.props.onTouchRequest(e)||(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),2===e.touches.length?r.onPinchStart(e):1===e.touches.length&&r.onDragStart(t.getTouchPoint(e.touches[0]))))},r.onTouchMove=function(e){e.preventDefault(),2===e.touches.length?r.onPinchMove(e):1===e.touches.length&&r.onDrag(t.getTouchPoint(e.touches[0]))},r.onGestureStart=function(e){r.currentDoc&&(e.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(e){if(e.preventDefault(),!r.isTouching){var s=t.getMousePoint(e),n=r.gestureZoomStart-1+e.scale;if(r.setNewZoom(n,s,{shouldUpdatePosition:!0}),r.props.onRotationChange){var i=r.gestureRotationStart+e.rotation;r.props.onRotationChange(i)}}},r.onGestureEnd=function(e){r.cleanEvents()},r.onDragStart=function(e){var t,s,n=e.x,i=e.y;r.dragStartPosition={x:n,y:i},r.dragStartCrop=__assign({},r.props.crop),null===(s=(t=r.props).onInteractionStart)||void 0===s||s.call(t)},r.onDrag=function(e){var t=e.x,s=e.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&void 0!==t&&void 0!==s){var e=t-r.dragStartPosition.x,n=s-r.dragStartPosition.y,i={x:r.dragStartCrop.x+e,y:r.dragStartCrop.y+n},o=r.props.restrictPosition?restrictPosition(i,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):i;r.props.onCropChange(o)}}))},r.onDragStopped=function(){var e,t;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),null===(t=(e=r.props).onInteractionEnd)||void 0===t||t.call(e)},r.onWheel=function(e){if(r.currentWindow&&(!r.props.onWheelRequest||r.props.onWheelRequest(e))){e.preventDefault();var s=t.getMousePoint(e),n=normalizeWheel$1(e).pixelY,i=r.props.zoom-n*r.props.zoomSpeed/200;r.setNewZoom(i,s,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var e,t;return null===(t=(e=r.props).onInteractionStart)||void 0===t?void 0:t.call(e)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var e,t;return null===(t=(e=r.props).onInteractionEnd)||void 0===t?void 0:t.call(e)})},250)}},r.getPointOnContainer=function(e,t){var s=e.x,n=e.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(s-t.x),y:r.containerRect.height/2-(n-t.y)}},r.getPointOnMedia=function(e){var t=e.x,s=e.y,n=r.props,i=n.crop,o=n.zoom;return{x:(t+i.x)/o,y:(s+i.y)/o}},r.setNewZoom=function(e,t,s){var n=(void 0===s?{}:s).shouldUpdatePosition,i=void 0===n||n;if(r.state.cropSize&&r.props.onZoomChange){var o=clamp$2(e,r.props.minZoom,r.props.maxZoom);if(i){var a=r.getPointOnContainer(t,r.containerPosition),l=r.getPointOnMedia(a),c={x:l.x*o-a.x,y:l.y*o-a.y},u=r.props.restrictPosition?restrictPosition(c,r.mediaSize,r.state.cropSize,o,r.props.rotation):c;r.props.onCropChange(u)}r.props.onZoomChange(o)}},r.getCropData=function(){return r.state.cropSize?computeCroppedArea(r.props.restrictPosition?restrictPosition(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition):null},r.emitCropData=function(){var e=r.getCropData();if(e){var t=e.croppedAreaPercentages,s=e.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(t,s),r.props.onCropAreaChange&&r.props.onCropAreaChange(t,s)}},r.emitCropAreaChange=function(){var e=r.getCropData();if(e){var t=e.croppedAreaPercentages,s=e.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(t,s)}},r.recomputeCropPosition=function(){if(r.state.cropSize){var e=r.props.restrictPosition?restrictPosition(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;r.props.onCropChange(e),r.emitCropData()}},r.onKeyDown=function(e){var t,s,n=r.props,i=n.crop,o=n.onCropChange,a=n.keyboardStep,l=n.zoom,c=n.rotation,u=a;if(r.state.cropSize){e.shiftKey&&(u*=.2);var d=__assign({},i);switch(e.key){case"ArrowUp":d.y-=u,e.preventDefault();break;case"ArrowDown":d.y+=u,e.preventDefault();break;case"ArrowLeft":d.x-=u,e.preventDefault();break;case"ArrowRight":d.x+=u,e.preventDefault();break;default:return}r.props.restrictPosition&&(d=restrictPosition(d,r.mediaSize,r.state.cropSize,l,c)),e.repeat||null===(s=(t=r.props).onInteractionStart)||void 0===s||s.call(t),o(d)}},r.onKeyUp=function(e){var t,s;switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.preventDefault();break;default:return}r.emitCropData(),null===(s=(t=r.props).onInteractionEnd)||void 0===s||s.call(t)},r}return __extends(t,e),t.prototype.componentDidMount=function(){this.currentDoc&&this.currentWindow&&(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),void 0===window.ResizeObserver&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=css_248z$1,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},t.prototype.componentWillUnmount=function(){var e,t;this.currentDoc&&this.currentWindow&&(void 0===window.ResizeObserver&&this.currentWindow.removeEventListener("resize",this.computeSizes),null===(e=this.resizeObserver)||void 0===e||e.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&(null===(t=this.styleRef.parentNode)||void 0===t||t.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},t.prototype.componentDidUpdate=function(e){var t,r,s,n,i,o,a,l,c;e.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):e.aspect!==this.props.aspect||e.objectFit!==this.props.objectFit?this.computeSizes():e.zoom!==this.props.zoom?this.recomputeCropPosition():(null===(t=e.cropSize)||void 0===t?void 0:t.height)!==(null===(r=this.props.cropSize)||void 0===r?void 0:r.height)||(null===(s=e.cropSize)||void 0===s?void 0:s.width)!==(null===(n=this.props.cropSize)||void 0===n?void 0:n.width)?this.computeSizes():(null===(i=e.crop)||void 0===i?void 0:i.x)===(null===(o=this.props.crop)||void 0===o?void 0:o.x)&&(null===(a=e.crop)||void 0===a?void 0:a.y)===(null===(l=this.props.crop)||void 0===l?void 0:l.y)||this.emitCropAreaChange(),e.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),e.video!==this.props.video&&(null===(c=this.videoRef.current)||void 0===c||c.load());var u=this.getObjectFit();u!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:u},this.computeSizes)},t.prototype.getAspect=function(){var e=this.props,t=e.cropSize,r=e.aspect;return t?t.width/t.height:r},t.prototype.getObjectFit=function(){var e,t,r,s;if("cover"===this.props.objectFit){if((this.imageRef.current||this.videoRef.current)&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var n=this.containerRect.width/this.containerRect.height;return((null===(e=this.imageRef.current)||void 0===e?void 0:e.naturalWidth)||(null===(t=this.videoRef.current)||void 0===t?void 0:t.videoWidth)||0)/((null===(r=this.imageRef.current)||void 0===r?void 0:r.naturalHeight)||(null===(s=this.videoRef.current)||void 0===s?void 0:s.videoHeight)||0)<n?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},t.prototype.onPinchStart=function(e){var r=t.getTouchPoint(e.touches[0]),s=t.getTouchPoint(e.touches[1]);this.lastPinchDistance=getDistanceBetweenPoints(r,s),this.lastPinchRotation=getRotationBetweenPoints(r,s),this.onDragStart(getCenter(r,s))},t.prototype.onPinchMove=function(e){var r=this;if(this.currentDoc&&this.currentWindow){var s=t.getTouchPoint(e.touches[0]),n=t.getTouchPoint(e.touches[1]),i=getCenter(s,n);this.onDrag(i),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var e=getDistanceBetweenPoints(s,n),t=r.props.zoom*(e/r.lastPinchDistance);r.setNewZoom(t,i,{shouldUpdatePosition:!1}),r.lastPinchDistance=e;var o=getRotationBetweenPoints(s,n),a=r.props.rotation+(o-r.lastPinchRotation);r.props.onRotationChange&&r.props.onRotationChange(a),r.lastPinchRotation=o})}},t.prototype.render=function(){var e,t=this,r=this.props,s=r.image,n=r.video,i=r.mediaProps,o=r.cropperProps,a=r.transform,l=r.crop,c=l.x,u=l.y,d=r.rotation,p=r.zoom,m=r.cropShape,h=r.showGrid,x=r.roundCropAreaPixels,f=r.style,g=f.containerStyle,y=f.cropAreaStyle,v=f.mediaStyle,E=r.classes,j=E.containerClassName,b=E.cropAreaClassName,w=E.mediaClassName,R=null!==(e=this.state.mediaObjectFit)&&void 0!==e?e:this.getObjectFit();return reactExports.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(e){return t.containerRef=e},"data-testid":"container",style:g,className:classNames("reactEasyCrop_Container",j)},s?reactExports.createElement("img",__assign({alt:"",className:classNames("reactEasyCrop_Image","contain"===R&&"reactEasyCrop_Contain","horizontal-cover"===R&&"reactEasyCrop_Cover_Horizontal","vertical-cover"===R&&"reactEasyCrop_Cover_Vertical",w)},i,{src:s,ref:this.imageRef,style:__assign(__assign({},v),{transform:a||"translate(".concat(c,"px, ").concat(u,"px) rotate(").concat(d,"deg) scale(").concat(p,")")}),onLoad:this.onMediaLoad})):n&&reactExports.createElement("video",__assign({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:classNames("reactEasyCrop_Video","contain"===R&&"reactEasyCrop_Contain","horizontal-cover"===R&&"reactEasyCrop_Cover_Horizontal","vertical-cover"===R&&"reactEasyCrop_Cover_Vertical",w)},i,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:__assign(__assign({},v),{transform:a||"translate(".concat(c,"px, ").concat(u,"px) rotate(").concat(d,"deg) scale(").concat(p,")")}),controls:!1}),(Array.isArray(n)?n:[{src:n}]).map(function(e){return reactExports.createElement("source",__assign({key:e.src},e))})),this.state.cropSize&&reactExports.createElement("div",__assign({ref:this.cropperRef,style:__assign(__assign({},y),{width:x?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:x?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:classNames("reactEasyCrop_CropArea","round"===m&&"reactEasyCrop_CropAreaRound",h&&"reactEasyCrop_CropAreaGrid",b)},o)))},t.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:MAX_ZOOM,minZoom:MIN_ZOOM,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:KEYBOARD_STEP},t.getMousePoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t.getTouchPoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t}(reactExports.Component);const{Title:Title$7,Text:Text$9}=Typography,{Option:Option$5}=Select,{TextArea:TextArea$3}=Input$1;function getCroppedImg(e,t){return new Promise((r,s)=>{const n=new window.Image;n.crossOrigin="anonymous",n.onload=()=>{const e=document.createElement("canvas");e.width=450,e.height=450;const i=e.getContext("2d");if(!i)return s("canvas context is null");i.clearRect(0,0,e.width,e.height),i.drawImage(n,t.x,t.y,t.width,t.height,0,0,e.width,e.height),e.toBlob(e=>{e?r(e):s("裁剪导出失败")},"image/png")},n.onerror=s,n.src=e})}const CROP_BOX_SIZE=360,FRAME_CROP_PX=300,AVATAR_PLACEHOLDER_PX=150,AvatarFrameCropper=({open:e,image:t,onClose:r,onCropComplete:s})=>{const[n,i]=reactExports.useState({x:0,y:0}),[o,a]=reactExports.useState(1),[l,c]=reactExports.useState(null),[u,d]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(Modal$2,{open:e,onCancel:r,title:"裁剪头像框",width:CROP_BOX_SIZE+80,footer:null,destroyOnHidden:!0,children:[jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:CROP_BOX_SIZE,height:CROP_BOX_SIZE,margin:"0 auto"},children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:(CROP_BOX_SIZE-FRAME_CROP_PX)/2,top:(CROP_BOX_SIZE-FRAME_CROP_PX)/2,width:FRAME_CROP_PX,height:FRAME_CROP_PX,border:"2px solid #1890ff",borderRadius:"16px",boxSizing:"border-box",zIndex:4,pointerEvents:"none"}}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:(CROP_BOX_SIZE-AVATAR_PLACEHOLDER_PX)/2,top:(CROP_BOX_SIZE-AVATAR_PLACEHOLDER_PX)/2,width:AVATAR_PLACEHOLDER_PX,height:AVATAR_PLACEHOLDER_PX,borderRadius:"50%",background:"#e0e0e0",boxShadow:"0 0 0 2px #fff",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:jsxRuntimeExports.jsxs("svg",{width:.64*AVATAR_PLACEHOLDER_PX,height:.64*AVATAR_PLACEHOLDER_PX,viewBox:"0 0 80 80",fill:"none",style:{opacity:.5},children:[jsxRuntimeExports.jsx("circle",{cx:"40",cy:"40",r:"40",fill:"none"}),jsxRuntimeExports.jsx("ellipse",{cx:"40",cy:"34",rx:"16",ry:"16",fill:"#bdbdbd"}),jsxRuntimeExports.jsx("ellipse",{cx:"40",cy:"62",rx:"24",ry:"14",fill:"#bdbdbd"})]})}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:0,top:0,width:CROP_BOX_SIZE,height:CROP_BOX_SIZE,zIndex:3},children:jsxRuntimeExports.jsx(Cropper,{image:t,crop:n,zoom:o,aspect:1,cropShape:"rect",showGrid:!1,restrictPosition:!1,cropSize:{width:FRAME_CROP_PX,height:FRAME_CROP_PX},onCropChange:i,onZoomChange:a,onCropComplete:(e,t)=>c(t)})})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:24,display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{style:{minWidth:48},children:"缩放："}),jsxRuntimeExports.jsx(Slider,{min:.5,max:5,step:.01,value:o,onChange:a,style:{flex:1,marginLeft:8}})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:24,textAlign:"right"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:r,style:{marginRight:8},children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:u,onClick:async()=>{if(t&&l){d(!0);try{const e=await getCroppedImg(t,l);s(e)}catch(e2){}finally{d(!1)}}},children:"确定"})]})]})},AvatarFrameUploadButton=({editingFrame:e,uploading:t,cropperVisible:r,setCropperVisible:s,cropperImage:n,setCropperImage:i,handleCropComplete:o,renderFramePreview:a,setPendingFrameId:l})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("input",{type:"file",accept:"image/png,image/webp,image/jpeg,image/jpg",style:{display:"none"},id:"add"===(null==e?void 0:e.id)?"avatar-frame-add-upload-input":"avatar-frame-upload-input",onChange:t=>{var r;if(!e)return;const n=null==(r=t.target.files)?void 0:r[0];if(!n)return;"add"!==e.id&&l&&l(e.id);const o=new FileReader;o.onload=e=>{var t;i(null==(t=e.target)?void 0:t.result),s(!0)},o.readAsDataURL(n)},disabled:!e}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$f,{}),size:"small",loading:t===(null==e?void 0:e.id),style:{marginBottom:8},onClick:()=>{if(e){const t=document.getElementById("add"===e.id?"avatar-frame-add-upload-input":"avatar-frame-upload-input");t&&t.click()}},disabled:!e,children:(null==e?void 0:e.icon_url)?"更换图片":"上传图片"}),jsxRuntimeExports.jsx(AvatarFrameCropper,{open:r,image:n,onClose:()=>s(!1),onCropComplete:e=>{o(e)}}),a()]}),HonorManagement=()=>{const{user:e}=useUser(),[t,r]=reactExports.useState([]),[s,n]=reactExports.useState([]),[i,o]=reactExports.useState([]),[a,l]=reactExports.useState(!1),[c,u]=reactExports.useState(null),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState(""),[x,f]=reactExports.useState(""),[,g]=reactExports.useState(!1),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState([]),[b,w]=reactExports.useState(""),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState(null),[k,$]=reactExports.useState({scale:1,rotate:0,x:0,y:0,opacity:1}),[T]=Form$4.useForm(),[I,P]=reactExports.useState(!1),[A]=Form$4.useForm(),F=reactExports.useRef(null),[M,D]=reactExports.useState(null),[O,N]=reactExports.useState(!1),[B,L]=reactExports.useState(void 0),[z,V]=reactExports.useState(!1),[U,H]=reactExports.useState(""),[W,q]=reactExports.useState("all"),G={title:"头像框设计规范",specs:["建议图像框尺寸：450x450px（正方形），头像和头像框画布比例为1:2尺寸","文件格式：PNG（支持透明背景）"]},[Y,K]=reactExports.useState(!1),[X,J]=reactExports.useState(void 0),[Z,Q]=reactExports.useState(null),ee=t.filter(e=>{const t=e.name.toLowerCase().includes(U.toLowerCase())||e.description&&e.description.toLowerCase().includes(U.toLowerCase()),r="all"===W||e.rarity===W;return t&&r});reactExports.useEffect(()=>{te()},[]);const te=async()=>{l(!0);try{const{data:e,error:t}=await supabase.from("avatar_frames").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;const{data:s,error:i}=await supabase.from("users_profile").select("id, nickname, email, avatar_url").eq("status","active").order("nickname");if(i)throw i;const{data:a,error:l}=await supabase.from("achievement_progress_logs").select("\n          id, user_id, achievement_id, old_progress, new_progress, progress_change,\n          trigger_source, trigger_data, created_at,\n          users_profile!inner(nickname),\n          achievements!inner(name)\n        ").eq("trigger_source","honor_grant").order("created_at",{ascending:!1}).limit(50);if(l)throw l;const c=(a||[]).map(e=>{var t,r;return{id:e.id,user_id:e.user_id,achievement_id:e.achievement_id,old_progress:e.old_progress,new_progress:e.new_progress,progress_change:e.progress_change,trigger_source:e.trigger_source,trigger_data:e.trigger_data,created_at:e.created_at,user_name:(null==(t=e.users_profile)?void 0:t.nickname)||"未知用户",frame_name:(null==(r=e.achievements)?void 0:r.name)||"未知头像框"}});r(e||[]),n(s||[]),o(c)}catch(e){console.error("加载数据失败:",e),staticMethods.error("加载数据失败")}finally{l(!1)}},re=async(e,t)=>{u(t);try{const{data:r,error:s}=await supabase.from("avatar_frames").select("icon_url").eq("id",t).single();if(s)throw s;const n=null==r?void 0:r.icon_url;if(n){const e=n.split("/").pop();e&&await supabase.storage.from("achievement-icons").remove([`avatar-frames/${e}`])}const i={maxSizeMB:.2,useWebWorker:!0,fileType:"image/png"},o=await imageCompression(e,i),a=o.name.split(".").pop()||"png",l=`avatar-frames/${`avatar-frame-${t}-${Date.now()}.${a}`}`,{error:c}=await supabase.storage.from("achievement-icons").upload(l,o);if(c&&console.error("[handleFrameImageUpload] 上传出错",c),c)throw c;const{data:{publicUrl:u}}=supabase.storage.from("achievement-icons").getPublicUrl(l),{error:d}=await supabase.from("avatar_frames").update({icon_url:u,updated_at:toBeijingDateTimeStr(new Date)}).eq("id",t);if(d)throw d;staticMethods.success("头像框图片上传成功"),await te()}catch(r){console.error("头像框图片上传失败:",r),staticMethods.error("图片上传失败")}finally{u(null)}},se=e=>{var t,r,s,n,i;C(e),$({scale:(null==(t=e.frame_data)?void 0:t.scale)||1,rotate:(null==(r=e.frame_data)?void 0:r.rotate)||0,x:(null==(s=e.frame_data)?void 0:s.x)||0,y:(null==(n=e.frame_data)?void 0:n.y)||0,opacity:(null==(i=e.frame_data)?void 0:i.opacity)||1}),T.setFieldsValue({name:e.name,description:e.description,frame_type:e.frame_type,rarity:e.rarity,code:e.code}),_(!0)},ne=e=>jsxRuntimeExports.jsxs(Card$1,{hoverable:!0,style:{marginBottom:16,height:300,display:"flex",flexDirection:"column",justifyContent:"space-between",overflow:"hidden"},styles:{body:{flex:1,display:"flex",flexDirection:"column",padding:"16px",height:"100%"}},children:[jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:12,height:120,display:"flex",alignItems:"center",justifyContent:"center"},children:e.icon_url?jsxRuntimeExports.jsx(Image$2,{src:e.icon_url,alt:e.name,width:90,height:90,style:{objectFit:"contain"},preview:!1}):jsxRuntimeExports.jsx("div",{style:{width:90,height:90,borderRadius:"50%",border:"2px solid #d9d9d9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",...e.frame_data},children:"👤"})}),jsxRuntimeExports.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:80,overflow:"hidden"},children:[jsxRuntimeExports.jsx(Title$7,{level:5,style:{margin:"8px 0",fontSize:"14px",lineHeight:"1.4"},children:e.name}),jsxRuntimeExports.jsx(Text$9,{type:"secondary",style:{fontSize:"12px",marginBottom:8,lineHeight:"1.3",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",maxHeight:36},children:e.description||"暂无描述"}),jsxRuntimeExports.jsx(Tag$1,{color:ie(e.rarity),style:{marginBottom:8,alignSelf:"center"},children:oe(e.rarity)})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",borderTop:"1px solid #f0f0f0",paddingTop:8,marginTop:8},children:[jsxRuntimeExports.jsx(Tooltip,{title:"预览",children:jsxRuntimeExports.jsx(RefIcon$6,{onClick:()=>{e.icon_url&&(h(e.icon_url),f(e.name),p(!0))},style:{fontSize:16,color:"#888",cursor:"pointer"}})}),jsxRuntimeExports.jsx(Tooltip,{title:"编辑设置",children:jsxRuntimeExports.jsx(RefIcon$c,{onClick:()=>se(e),style:{fontSize:16,color:"#1890ff",cursor:"pointer"}})}),jsxRuntimeExports.jsx(Tooltip,{title:"删除图片",children:jsxRuntimeExports.jsx(RefIcon$O,{onClick:()=>e.icon_url&&(async(e,t)=>{try{const r=t.split("/").pop();if(r){const{error:e}=await supabase.storage.from("achievement-icons").remove([`avatar-frames/${r}`]);e&&console.warn("删除存储文件失败:",e)}const{error:s}=await supabase.from("avatar_frames").update({icon_url:null,updated_at:toBeijingDateTimeStr(new Date)}).eq("id",e);if(s)throw s;staticMethods.success("头像框图片删除成功"),await te()}catch(r){console.error("删除头像框图片失败:",r),staticMethods.error("删除失败")}})(e.id,e.icon_url),style:{fontSize:16,color:"#ff4d4f",cursor:"pointer"}})})]})]},e.id),ie=e=>({common:"#52c41a",rare:"#1890ff",epic:"#fa8c16",legendary:"#722ed1"}[e]||"#666"),oe=e=>({common:"基础",rare:"稀有",epic:"史诗",legendary:"传说"}[e]||"未知"),ae=[{title:"用户",dataIndex:"user_name",key:"user_name"},{title:"头像框",dataIndex:"frame_name",key:"frame_name"},{title:"发放时间",dataIndex:"created_at",key:"created_at",render:e=>toBeijingDateTimeStr(e)},{title:"发放说明",dataIndex:"trigger_data",key:"notes",render:e=>(null==e?void 0:e.notes)||"-"}];return a?jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:40},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:"加载荣誉系统数据中..."})]}):jsxRuntimeExports.jsxs("div",{style:{padding:"20px"},children:[jsxRuntimeExports.jsx(Card$1,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$C,{}),jsxRuntimeExports.jsx("span",{children:"荣誉系统管理"})]}),extra:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>P(!0),children:"新增头像框"}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:te,loading:a,children:"刷新"})]}),children:jsxRuntimeExports.jsx(Tabs,{defaultActiveKey:"frames",items:[{key:"frames",label:"头像框管理",children:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Alert,{message:G.title,description:jsxRuntimeExports.jsx("ul",{style:{margin:0,paddingLeft:20},children:G.specs.map((e,t)=>jsxRuntimeExports.jsx("li",{children:e},t))}),type:"info",showIcon:!0,style:{marginBottom:24}}),jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"搜索头像框名称或描述",value:U,onChange:e=>H(e.target.value),style:{width:300},allowClear:!0})}),jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx("span",{children:"稀有度筛选："}),jsxRuntimeExports.jsxs(Select,{value:W,onChange:q,style:{width:120},placeholder:"选择稀有度",children:[jsxRuntimeExports.jsx(Option$5,{value:"all",children:"全部"}),jsxRuntimeExports.jsx(Option$5,{value:"common",children:"基础"}),jsxRuntimeExports.jsx(Option$5,{value:"rare",children:"稀有"}),jsxRuntimeExports.jsx(Option$5,{value:"epic",children:"史诗"}),jsxRuntimeExports.jsx(Option$5,{value:"legendary",children:"传说"})]})]})}),jsxRuntimeExports.jsx(Row,{gutter:16,children:ee.map(e=>jsxRuntimeExports.jsx(Col,{span:4.8,children:ne(e)},e.id))}),0===ee.length&&U&&jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"未找到匹配的头像框"})]})},{key:"grants",label:"活动发放",children:jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",style:{width:"100%"},children:[jsxRuntimeExports.jsxs(Card$1,{title:"批量发放头像框",size:"small",children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsxs(Col,{span:12,children:[jsxRuntimeExports.jsx(Text$9,{strong:!0,children:"选择用户："}),jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"选择要发放的用户",style:{width:"100%",marginTop:8},value:y,onChange:v,showSearch:!0,filterOption:(e,t)=>{var r;return null==(r=null==t?void 0:t.children)?void 0:r.toLowerCase().includes(e.toLowerCase())},children:s.map(e=>jsxRuntimeExports.jsx(Option$5,{value:e.id,children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Avatar$1,{size:"small",src:e.avatar_url}),e.nickname," (",e.email,")"]})},e.id))})]}),jsxRuntimeExports.jsxs(Col,{span:12,children:[jsxRuntimeExports.jsx(Text$9,{strong:!0,children:"选择头像框："}),jsxRuntimeExports.jsx(Select,{mode:"multiple",placeholder:"选择要发放的头像框",style:{width:"100%",marginTop:8},value:E,onChange:j,children:t.map(e=>jsxRuntimeExports.jsx(Option$5,{value:e.id,children:jsxRuntimeExports.jsxs(Space$1,{children:[e.icon_url?jsxRuntimeExports.jsx(Image$2,{src:e.icon_url,width:16,height:16}):jsxRuntimeExports.jsx("div",{style:{width:16,height:16,fontSize:12},children:"👤"}),e.name]})},e.id))})]})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:16},children:[jsxRuntimeExports.jsx(Text$9,{strong:!0,children:"发放说明："}),jsxRuntimeExports.jsx(TextArea$3,{placeholder:"可选：添加发放说明",value:b,onChange:e=>w(e.target.value),style:{marginTop:8},rows:3})]}),jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:jsxRuntimeExports.jsxs(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$q,{}),onClick:async()=>{if(0!==y.length&&0!==E.length)try{const r=null==e?void 0:e.id,s=y.flatMap(e=>E.map(async t=>{const{data:r,error:s,status:n,statusText:i}=await supabase.from("user_avatar_frames").upsert({user_id:e,frame_id:t,unlocked_at:toBeijingDateTimeStr(new Date)},{onConflict:"user_id,frame_id"});return s&&console.error("[发放头像框] 插入失败:",{error:s,status:n,statusText:i,user_id:e,frame_id:t}),{data:r,error:s}})),n=y.flatMap(e=>E.map(async s=>{const n=t.find(e=>e.id===s);try{await AchievementTriggers.onHonorGranted(e,s,(null==n?void 0:n.name)||"未知头像框",Number(r)||0,b)}catch(i){console.error("[发放头像框] 发放日志写入失败:",i)}}));await Promise.all([...s,...n]),staticMethods.success(`成功发放 ${y.length*E.length} 个头像框`),g(!1),v([]),j([]),w(""),await te()}catch(r){console.error("发放头像框失败:",r),staticMethods.error("发放失败")}else staticMethods.warning("请选择用户和头像框")},disabled:0===y.length||0===E.length,children:["发放 ",y.length*E.length," 个头像框"]})})]}),jsxRuntimeExports.jsx(Card$1,{title:"发放记录",size:"small",children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:i,columns:ae,rowKey:"id",pagination:{pageSize:10},size:"small"})})]})}]})}),jsxRuntimeExports.jsx(Modal$2,{title:"新增头像框",open:I,onCancel:()=>P(!1),onOk:async()=>{try{const e=await A.validateFields(),t={border:"2px solid #e0e0e0",borderRadius:"50%"},{data:r,error:s}=await supabase.from("avatar_frames").insert({name:e.name,description:e.description,frame_type:e.frame_type,rarity:e.rarity,code:e.code,frame_data:t,is_active:!0,sort_order:0,icon_url:M||null}).select("id").single();if(s)throw s;staticMethods.success("新增头像框成功"),P(!1),A.resetFields(),D(null),F.current=r.id,await te();const n=(await supabase.from("avatar_frames").select("*").eq("id",r.id).single()).data;n&&se(n)}catch(e){console.error("新增头像框失败:",e),staticMethods.error("新增失败")}},okText:"提交",cancelText:"取消",destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:A,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"头像框名称",name:"name",rules:[{required:!0,message:"请输入名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入头像框名称"})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"描述",name:"description",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入描述（可选）"})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"类型",name:"frame_type",rules:[{required:!0,message:"请选择类型"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择头像框类型",children:[jsxRuntimeExports.jsx(Option$5,{value:"border",children:"边框"}),jsxRuntimeExports.jsx(Option$5,{value:"background",children:"背景"}),jsxRuntimeExports.jsx(Option$5,{value:"overlay",children:"覆盖"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"稀有度",name:"rarity",rules:[{required:!0,message:"请选择稀有度"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择稀有度",children:[jsxRuntimeExports.jsx(Option$5,{value:"common",children:"基础"}),jsxRuntimeExports.jsx(Option$5,{value:"rare",children:"稀有"}),jsxRuntimeExports.jsx(Option$5,{value:"epic",children:"史诗"}),jsxRuntimeExports.jsx(Option$5,{value:"legendary",children:"传说"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"代码",name:"code",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"唯一代码（可选）"})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"头像框图片",children:jsxRuntimeExports.jsx(AvatarFrameUploadButton,{editingFrame:{id:"add",name:"",frame_type:"border",frame_data:{},rarity:"common",is_active:!0,sort_order:0,created_at:""},uploading:z?"add":null,setUploading:e=>V(!!e),cropperVisible:O,setCropperVisible:N,cropperImage:B,setCropperImage:L,handleCropComplete:e=>{(async e=>{V(!0);try{const t=new File([e],`avatar-frame-add-${Date.now()}.png`,{type:"image/png"}),r=`avatar-frames/avatar-frame-add-${Date.now()}.png`,{error:s}=await supabase.storage.from("achievement-icons").upload(r,t);if(s&&console.error("[handleAddCropComplete] 上传出错",s),s)throw s;const{data:{publicUrl:n}}=supabase.storage.from("achievement-icons").getPublicUrl(r);D(n),staticMethods.success("图片上传成功")}catch(e2){console.error("[handleAddCropComplete] catch",e2),staticMethods.error("图片上传失败")}finally{V(!1),N(!1),L(void 0)}})(e)},renderFramePreview:()=>M&&jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:jsxRuntimeExports.jsx(Image$2,{src:M,width:80,height:80,style:{objectFit:"contain"},preview:!0})})})})]})}),jsxRuntimeExports.jsx(Modal$2,{open:d,title:x,footer:null,onCancel:()=>p(!1),destroyOnHidden:!0,children:jsxRuntimeExports.jsx("img",{alt:"preview",style:{width:"100%"},src:m})}),jsxRuntimeExports.jsx(Modal$2,{title:"编辑头像框设置",open:R,onCancel:()=>_(!1),width:800,footer:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>_(!1),children:"取消"},"cancel"),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$Z,{}),onClick:async()=>{try{const e=await T.validateFields();if(!S)return;const t={...S.frame_data,...k,...e},{error:r}=await supabase.from("avatar_frames").update({name:e.name,description:e.description,frame_type:e.frame_type,rarity:e.rarity,code:e.code,frame_data:t,updated_at:toBeijingDateTimeStr(new Date)}).eq("id",S.id);if(r)throw r;staticMethods.success("头像框设置保存成功"),_(!1),await te()}catch(e){console.error("保存头像框设置失败:",e),staticMethods.error("保存失败")}},children:"保存"},"save")],destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Row,{gutter:24,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsxs(Form$4,{form:T,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"头像框名称",name:"name",rules:[{required:!0}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入头像框名称"})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"描述",name:"description",children:jsxRuntimeExports.jsx(TextArea$3,{placeholder:"请输入头像框描述",rows:3})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"类型",name:"frame_type",rules:[{required:!0}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择头像框类型",children:[jsxRuntimeExports.jsx(Option$5,{value:"border",children:"边框"}),jsxRuntimeExports.jsx(Option$5,{value:"background",children:"背景"}),jsxRuntimeExports.jsx(Option$5,{value:"overlay",children:"覆盖"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"稀有度",name:"rarity",rules:[{required:!0}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择稀有度",children:[jsxRuntimeExports.jsx(Option$5,{value:"common",children:"基础"}),jsxRuntimeExports.jsx(Option$5,{value:"rare",children:"稀有"}),jsxRuntimeExports.jsx(Option$5,{value:"epic",children:"史诗"}),jsxRuntimeExports.jsx(Option$5,{value:"legendary",children:"传说"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"代码",name:"code",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入唯一代码（可选）"})})]})}),jsxRuntimeExports.jsxs(Col,{span:12,children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:jsxRuntimeExports.jsx(Text$9,{strong:!0,children:"预览效果："})}),jsxRuntimeExports.jsx(AvatarFrameUploadButton,{editingFrame:S,uploading:c,setUploading:u,cropperVisible:Y,setCropperVisible:K,cropperImage:X,setCropperImage:J,handleCropComplete:async e=>{if(Z){u(Z);try{const t=new File([e],`avatar-frame-${Z}.png`,{type:"image/png"});await re(t,Z)}catch(e2){staticMethods.error("图片上传失败")}finally{u(null),K(!1),J(void 0),Q(null)}}else console.warn("[handleCropComplete] pendingFrameId is null, abort upload")},renderFramePreview:()=>{if(!(null==S?void 0:S.icon_url))return null;const e=120;return jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:200,height:200,margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:e,height:e,transform:"translate(-50%, -50%)",borderRadius:"50%",background:"#e0e0e0",boxShadow:"0 0 0 2px #fff",zIndex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsxs("svg",{width:60,height:60,viewBox:"0 0 80 80",fill:"none",style:{opacity:.5},children:[jsxRuntimeExports.jsx("circle",{cx:"40",cy:"40",r:"40",fill:"none"}),jsxRuntimeExports.jsx("ellipse",{cx:"40",cy:"34",rx:"16",ry:"16",fill:"#bdbdbd"}),jsxRuntimeExports.jsx("ellipse",{cx:"40",cy:"62",rx:"24",ry:"14",fill:"#bdbdbd"})]})}),jsxRuntimeExports.jsx("img",{src:S.icon_url,alt:"frame",style:{position:"absolute",left:"50%",top:"50%",width:180,height:180,transform:"translate(-50%, -50%)",objectFit:"contain",zIndex:2,pointerEvents:"none"}})]})},setPendingFrameId:Q})]})]})})]})};function __rest(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}function __awaiter(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(e2){i(e2)}}function a(e){try{l(s.throw(e))}catch(e2){i(e2)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const PREFIX="img-crop",ZOOM_INITIAL=1,ZOOM_STEP=.1,ROTATION_INITIAL=0,ROTATION_MIN=-180,ROTATION_MAX=180,ROTATION_STEP=1,ASPECT_STEP=.01,EasyCrop=reactExports.forwardRef((e,t)=>{const{cropperRef:r,zoomSlider:s,rotationSlider:n,aspectSlider:i,showReset:o,resetBtnText:a,modalImage:l,aspect:c,minZoom:u,maxZoom:d,minAspect:p,maxAspect:m,cropShape:h,showGrid:x,cropperProps:f}=e,[g,y]=reactExports.useState(ZOOM_INITIAL),[v,E]=reactExports.useState(ROTATION_INITIAL),[j,b]=reactExports.useState(c),w=reactExports.useRef(c);w.current!==c&&(w.current=c,b(c));const R=g!==ZOOM_INITIAL||v!==ROTATION_INITIAL||j!==c,_=()=>{y(ZOOM_INITIAL),E(ROTATION_INITIAL),b(c)},[S,C]=reactExports.useState({x:0,y:0}),k=reactExports.useRef({width:0,height:0,x:0,y:0}),$=reactExports.useCallback((e,t)=>{k.current=t},[]);reactExports.useImperativeHandle(t,()=>({rotation:v,cropPixelsRef:k,onReset:_}));const T="[display:flex] [align-items:center] [width:60%] [margin-inline:auto]",I="[display:flex] [align-items:center] [justify-content:center] [height:32px] [width:32px] [background:transparent] [border:0] [font-family:inherit] [font-size:18px] [cursor:pointer] disabled:[opacity:20%] disabled:[cursor:default]",P="[flex:1]";return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Cropper,Object.assign({},f,{ref:r,image:l,crop:S,zoom:g,rotation:v,aspect:j,minZoom:u,maxZoom:d,zoomWithScroll:s,cropShape:h,showGrid:x,onCropChange:C,onZoomChange:y,onRotationChange:E,onCropComplete:$,classes:{containerClassName:`${PREFIX}-container ![position:relative] [width:100%] [height:40vh] [&~section:first-of-type]:[margin-top:16px] [&~section:last-of-type]:[margin-bottom:16px]`,mediaClassName:`${PREFIX}-media`}})),s&&jsxRuntimeExports.jsxs("section",{className:`${PREFIX}-control ${PREFIX}-control-zoom ${T}`,children:[jsxRuntimeExports.jsx("button",{className:I,onClick:()=>y(+(g-ZOOM_STEP).toFixed(1)),disabled:g-ZOOM_STEP<u,children:"－"}),jsxRuntimeExports.jsx(Slider,{className:P,min:u,max:d,step:ZOOM_STEP,value:g,onChange:y}),jsxRuntimeExports.jsx("button",{className:I,onClick:()=>y(+(g+ZOOM_STEP).toFixed(1)),disabled:g+ZOOM_STEP>d,children:"＋"})]}),n&&jsxRuntimeExports.jsxs("section",{className:`${PREFIX}-control ${PREFIX}-control-rotation ${T}`,children:[jsxRuntimeExports.jsx("button",{className:`${I} [font-size:16px]`,onClick:()=>E(v-ROTATION_STEP),disabled:v===ROTATION_MIN,children:"↺"}),jsxRuntimeExports.jsx(Slider,{className:P,min:ROTATION_MIN,max:ROTATION_MAX,step:ROTATION_STEP,value:v,onChange:E}),jsxRuntimeExports.jsx("button",{className:`${I} [font-size:16px]`,onClick:()=>E(v+ROTATION_STEP),disabled:v===ROTATION_MAX,children:"↻"})]}),i&&jsxRuntimeExports.jsxs("section",{className:`${PREFIX}-control ${PREFIX}-control-aspect ${T}`,children:[jsxRuntimeExports.jsx("button",{className:I,onClick:()=>b(+(j-ASPECT_STEP).toFixed(2)),disabled:j-ASPECT_STEP<p,children:"↕"}),jsxRuntimeExports.jsx(Slider,{className:P,min:p,max:m,step:ASPECT_STEP,value:j,onChange:b}),jsxRuntimeExports.jsx("button",{className:I,onClick:()=>b(+(j+ASPECT_STEP).toFixed(2)),disabled:j+ASPECT_STEP>m,children:"↔"})]}),o&&(s||n||i)&&jsxRuntimeExports.jsx(Button$1,{className:"[position:absolute] [bottom:20px]",style:R?{}:{opacity:.3,pointerEvents:"none"},onClick:_,children:a})]})});var EasyCrop$1=reactExports.memo(EasyCrop);function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if("undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===r&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var css_248z="/*! tailwindcss v4.1.4 | MIT License | https://tailwindcss.com */.visible{visibility:visible}.\\!\\[position\\:relative\\]{position:relative!important}.\\[position\\:absolute\\]{position:absolute}.\\[bottom\\:20px\\]{bottom:20px}.container{width:100%}.\\[margin-inline\\:auto\\]{margin-inline:auto}.\\[display\\:flex\\]{display:flex}.grid{display:grid}.\\[height\\:32px\\]{height:32px}.\\[height\\:40vh\\]{height:40vh}.\\[width\\:32px\\]{width:32px}.\\[width\\:60\\%\\]{width:60%}.\\[width\\:100\\%\\]{width:100%}.\\[flex\\:1\\]{flex:1}.\\[cursor\\:pointer\\]{cursor:pointer}.\\[align-items\\:center\\]{align-items:center}.\\[justify-content\\:center\\]{justify-content:center}.\\[font-family\\:inherit\\]{font-family:inherit}.\\[font-size\\:16px\\]{font-size:16px}.\\[font-size\\:18px\\]{font-size:18px}.\\[background\\:transparent\\]{background:transparent}.\\[border\\:0\\]{border:0}.disabled\\:\\[cursor\\:default\\]{&:disabled{cursor:default}}.disabled\\:\\[opacity\\:20\\%\\]{&:disabled{opacity:20%}}.\\[\\&\\~section\\:first-of-type\\]\\:\\[margin-top\\:16px\\]{&~section:first-of-type{margin-top:16px}}.\\[\\&\\~section\\:last-of-type\\]\\:\\[margin-bottom\\:16px\\]{&~section:last-of-type{margin-bottom:16px}}";styleInject(css_248z,{insertAt:"top"});const ImgCrop=reactExports.forwardRef((e,t)=>{const{quality:r=.4,fillColor:s="white",zoomSlider:n=!0,rotationSlider:i=!1,aspectSlider:o=!1,showReset:a=!1,resetText:l,aspect:c=1,minZoom:u=1,maxZoom:d=3,minAspect:p=.5,maxAspect:m=2,cropShape:h="rect",showGrid:x=!1,cropperProps:f,modalClassName:g,modalTitle:y,modalWidth:v,modalOk:E,modalCancel:j,onModalOk:b,onModalCancel:w,modalProps:R,beforeCrop:_,children:S}=e,C=reactExports.useRef({});C.current.onModalOk=b,C.current.onModalCancel=w,C.current.beforeCrop=_;const k=reactExports.useRef(null),$=reactExports.useCallback(e=>{var t;const r=document.createElement("canvas"),n=r.getContext("2d"),o=((null===(t=null==e?void 0:e.getRootNode)||void 0===t?void 0:t.call(e))||document).querySelector(`.${PREFIX}-media`),{width:a,height:l,x:c,y:u}=k.current.cropPixelsRef.current;if(i&&k.current.rotation!==ROTATION_INITIAL){const{naturalWidth:e,naturalHeight:t}=o,i=k.current.rotation*(Math.PI/180),d=Math.abs(Math.sin(i)),p=Math.abs(Math.cos(i)),m=e*p+t*d,h=t*p+e*d;r.width=m,r.height=h,n.fillStyle=s,n.fillRect(0,0,m,h);const x=m/2,f=h/2;n.translate(x,f),n.rotate(i),n.translate(-x,-f);const g=(m-e)/2,y=(h-t)/2;n.drawImage(o,0,0,e,t,g,y,e,t);const v=n.getImageData(0,0,m,h);r.width=a,r.height=l,n.putImageData(v,-c,-u)}else r.width=a,r.height=l,n.fillStyle=s,n.fillRect(0,0,a,l),n.drawImage(o,c,u,a,l,0,0,a,l);return r},[s,i]),[T,I]=reactExports.useState(""),P=reactExports.useRef(void 0),A=reactExports.useRef(void 0),F=reactExports.useCallback(e=>__awaiter(void 0,[e],void 0,function*({beforeUpload:e,file:t,resolve:r,reject:s}){const n=t;if("function"==typeof e)try{const s=yield e(t,[t]);r(!1!==s&&(!0!==s&&s||n))}catch(i){s(i)}else r(n)}),[]),M=reactExports.useCallback(e=>(t,s)=>new Promise((n,i)=>__awaiter(void 0,void 0,void 0,function*(){let o=t;if("function"==typeof C.current.beforeCrop)try{const r=yield C.current.beforeCrop(t,s);if(!1===r)return F({beforeUpload:e,file:t,resolve:n,reject:i});!0!==r&&(o=r||t)}catch(l){return F({beforeUpload:e,file:t,resolve:n,reject:i})}const a=new FileReader;a.addEventListener("load",()=>{"string"==typeof a.result&&I(a.result)}),a.readAsDataURL(o),P.current=()=>{var e,t;I(""),k.current.onReset();let r=!1;null===(t=(e=C.current).onModalCancel)||void 0===t||t.call(e,e=>{n(e),r=!0}),r||n(Upload.LIST_IGNORE)},A.current=t=>__awaiter(void 0,void 0,void 0,function*(){I(""),k.current.onReset();const s=$(t.target),{type:a,name:l,uid:c}=o;s.toBlob(t=>__awaiter(void 0,void 0,void 0,function*(){const r=new File([t],l,{type:a});Object.assign(r,{uid:c}),F({beforeUpload:e,file:r,resolve:e=>{var t,r;n(e),null===(r=(t=C.current).onModalOk)||void 0===r||r.call(t,e)},reject:e=>{var t,r;i(e),null===(r=(t=C.current).onModalOk)||void 0===r||r.call(t,e)}})}),a,r)})})),[$,r,F]),D=reactExports.useCallback(e=>{const t=Array.isArray(e)?e[0]:e,r=t.props,{beforeUpload:s,accept:n}=r,i=__rest(r,["beforeUpload","accept"]);return Object.assign(Object.assign({},t),{props:Object.assign(Object.assign({},i),{accept:n||"image/*",beforeUpload:M(s)})})},[M]),O=reactExports.useMemo(()=>{const e={};return void 0!==v&&(e.width=v),void 0!==E&&(e.okText=E),void 0!==j&&(e.cancelText=j),e},[j,E,v]),N=`${PREFIX}-modal${g?` ${g}`:""}`,B="zh-CN"===("undefined"==typeof window?"":window.navigator.language),L=y||(B?"编辑图片":"Edit image"),z=l||(B?"重置":"Reset");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[D(S),T&&jsxRuntimeExports.jsx(Modal$2,Object.assign({},R,O,{open:!0,title:L,onCancel:P.current,onOk:A.current,wrapClassName:N,maskClosable:!1,destroyOnClose:!0,children:jsxRuntimeExports.jsx(EasyCrop$1,{ref:k,cropperRef:t,zoomSlider:n,rotationSlider:i,aspectSlider:o,showReset:a,resetBtnText:z,modalImage:T,aspect:c,minZoom:u,maxZoom:d,minAspect:p,maxAspect:m,cropShape:h,showGrid:x,cropperProps:f})}))]})}),{Title:Title$6,Text:Text$8}=Typography,{Option:Option$4}=Select,AchievementIconManager=({onIconUpdate:e})=>{const[t,r]=reactExports.useState([]),[s,n]=reactExports.useState([]),[i,o]=reactExports.useState([]),[a,l]=reactExports.useState(!1),[c,u]=reactExports.useState(null),[d,p]=reactExports.useState(!1),m={achievements:{first_followup:["📋","📝","📄"],followup_master:["📊","📈","📉"],first_deal:["💎","🏆","⭐"],deal_master:["🏆","👑","💎"],conversion_master:["📈","📊","🎯"],points_collector:["💰","💎","🏅"],team_helper:["🤝","👥","👨‍👩‍👧‍👦"],daily_checkin:["📅","📆","🗓️"]},badges:{"新手销售":["🎖️","🏅","⭐"],"成交达人":["💎","🏆","👑"],"转化大师":["🏆","👑","💎"],"团队领袖":["👑","🏆","⭐"],"连续签到":["📅","📆","🗓️"]}};reactExports.useEffect(()=>{h()},[]);const h=async()=>{l(!0);try{const{data:e,error:t}=await supabase.from("achievements").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;const{data:s,error:i}=await supabase.from("badges").select("*").eq("is_active",!0).order("sort_order");if(i)throw i;const{data:a,error:l}=await supabase.from("avatar_frames").select("*").eq("is_active",!0).order("sort_order");if(l)throw l;r(e||[]),n(s||[]),o(a||[])}catch(e){console.error("加载图标数据失败:",e),staticMethods.error("加载数据失败")}finally{l(!1)}},x=async(t,r,s="emoji",n,i)=>{u(t);try{const o={icon:r,icon_type:s,updated_at:(new Date).toISOString()};n&&(o.icon_url=n),i&&(o.color=i);const{error:a}=await supabase.from("achievements").update(o).eq("id",t);if(a)throw a;staticMethods.success("成就图标更新成功"),await h(),null==e||e()}catch(o){console.error("更新成就图标失败:",o),staticMethods.error("更新失败")}finally{u(null)}},f=async(t,r,s="emoji",n,i)=>{u(t);try{const o={icon:r,icon_type:s,updated_at:(new Date).toISOString()};n&&(o.icon_url=n),i&&(o.color=i);const{error:a}=await supabase.from("badges").update(o).eq("id",t);if(a)throw a;staticMethods.success("勋章图标更新成功"),await h(),null==e||e()}catch(o){console.error("更新勋章图标失败:",o),staticMethods.error("更新失败")}finally{u(null)}},g=async(e,t,r)=>{try{const s=e.name.split(".").pop(),n=`${t}-${r}-${Date.now()}.${s}`,i=`achievement-icons/${n}`,{error:o}=await supabase.storage.from("achievement-icons").upload(i,e);if(o)throw o;const{data:{publicUrl:a}}=supabase.storage.from("achievement-icons").getPublicUrl(i);"achievement"===t?await x(r,n,"png",a):await f(r,n,"png",a),staticMethods.success("图片上传成功")}catch(s){console.error("图片上传失败:",s),staticMethods.error("图片上传失败")}},y=e=>"png"===e.icon_type||"jpg"===e.icon_type||"webp"===e.icon_type?jsxRuntimeExports.jsx(Image$2,{src:e.icon_url||`/images/achievements/${e.icon}`,alt:e.name,width:32,height:32,style:{objectFit:"contain"},preview:{visible:d,src:e.icon_url||`/images/achievements/${e.icon}`,title:e.name,onVisibleChange:e=>p(e)}}):jsxRuntimeExports.jsx("span",{className:"current-icon",style:{color:e.color},children:e.icon});return a?jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"20px"},children:jsxRuntimeExports.jsx(Text$8,{children:"加载中..."})})}):jsxRuntimeExports.jsxs("div",{className:"achievement-icon-manager",children:[jsxRuntimeExports.jsxs(Card$1,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$6,{}),jsxRuntimeExports.jsx("span",{children:"成就系统图标管理"})]}),extra:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:h,loading:a,children:"刷新"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$Z,{}),onClick:async()=>{u("batch");try{const e={first_followup:"📋",followup_master:"📊",first_deal:"💎",deal_master:"🏆",conversion_master:"📈",points_collector:"💰",team_helper:"🤝",daily_checkin:"📅"};for(const[r,s]of Object.entries(e)){const e=t.find(e=>e.code===r);e&&await x(e.id,s,"emoji")}staticMethods.success("批量更新完成")}catch(e){console.error("批量更新失败:",e),staticMethods.error("批量更新失败")}finally{u(null)}},loading:"batch"===c,children:"批量更新"})]}),children:[jsxRuntimeExports.jsxs("div",{className:"section",children:[jsxRuntimeExports.jsx(Title$6,{level:4,children:"🎯 成就图标"}),jsxRuntimeExports.jsx("div",{className:"icon-grid",children:t.map(e=>jsxRuntimeExports.jsx(Card$1,{size:"small",style:{marginBottom:"10px"},children:jsxRuntimeExports.jsxs("div",{className:"icon-item",children:[jsxRuntimeExports.jsxs("div",{className:"icon-display",children:[y(e),jsxRuntimeExports.jsx(Text$8,{strong:!0,children:e.name}),jsxRuntimeExports.jsxs(Text$8,{type:"secondary",style:{fontSize:"12px"},children:[e.code," (",e.icon_type,")"]})]}),jsxRuntimeExports.jsxs("div",{className:"icon-controls",children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"新图标 (emoji或文件名)",defaultValue:e.icon,onPressEnter:t=>{const r=t.target;x(e.id,r.value,e.icon_type)},style:{marginBottom:"5px"}}),jsxRuntimeExports.jsxs(Select,{placeholder:"图标类型",defaultValue:e.icon_type,style:{width:"100%",marginBottom:"5px"},onChange:t=>x(e.id,e.icon,t),children:[jsxRuntimeExports.jsx(Option$4,{value:"emoji",children:"Emoji"}),jsxRuntimeExports.jsx(Option$4,{value:"png",children:"PNG图片"}),jsxRuntimeExports.jsx(Option$4,{value:"svg",children:"SVG图标"}),jsxRuntimeExports.jsx(Option$4,{value:"jpg",children:"JPG图片"}),jsxRuntimeExports.jsx(Option$4,{value:"webp",children:"WebP图片"})]}),jsxRuntimeExports.jsxs(Select,{placeholder:"选择颜色",defaultValue:e.color,style:{width:"100%",marginBottom:"5px"},onChange:t=>x(e.id,e.icon,e.icon_type,void 0,t),children:[jsxRuntimeExports.jsx(Option$4,{value:"#52c41a",children:"绿色"}),jsxRuntimeExports.jsx(Option$4,{value:"#1890ff",children:"蓝色"}),jsxRuntimeExports.jsx(Option$4,{value:"#fa8c16",children:"橙色"}),jsxRuntimeExports.jsx(Option$4,{value:"#722ed1",children:"紫色"}),jsxRuntimeExports.jsx(Option$4,{value:"#eb2f96",children:"粉色"}),jsxRuntimeExports.jsx(Option$4,{value:"#f5222d",children:"红色"})]}),"emoji"!==e.icon_type&&jsxRuntimeExports.jsx(ImgCrop,{cropShape:"round",aspect:1,quality:1,showGrid:!1,showReset:!0,modalTitle:"裁剪图标",children:jsxRuntimeExports.jsx(Upload,{accept:"image/*",showUploadList:!1,beforeUpload:async t=>{const r={maxSizeMB:.2,maxWidthOrHeight:128,useWebWorker:!0};try{const s=await imageCompression(t,r);return await g(s,"achievement",e.id),!1}catch(e2){return console.error("图片压缩失败:",e2),staticMethods.error("图片压缩失败"),!1}},children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$f,{}),size:"small",style:{width:"100%",marginBottom:"5px"},children:"上传图片"})})}),"emoji"===e.icon_type&&m.achievements[e.code]&&jsxRuntimeExports.jsxs("div",{className:"icon-suggestions",children:[jsxRuntimeExports.jsx(Text$8,{type:"secondary",style:{fontSize:"12px"},children:"建议:"}),jsxRuntimeExports.jsx(Space$1,{children:m.achievements[e.code].map((t,r)=>jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>x(e.id,t,"emoji"),loading:c===e.id,children:t},r))})]})]})]})},e.id))})]}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsxs("div",{className:"section",children:[jsxRuntimeExports.jsx(Title$6,{level:4,children:"🏅 勋章图标"}),jsxRuntimeExports.jsx("div",{className:"icon-grid",children:s.map(e=>jsxRuntimeExports.jsx(Card$1,{size:"small",style:{marginBottom:"10px"},children:jsxRuntimeExports.jsxs("div",{className:"icon-item",children:[jsxRuntimeExports.jsxs("div",{className:"icon-display",children:[y(e),jsxRuntimeExports.jsx(Text$8,{strong:!0,children:e.name}),jsxRuntimeExports.jsxs(Text$8,{type:"secondary",style:{fontSize:"12px"},children:[e.rarity," (",e.icon_type,")"]})]}),jsxRuntimeExports.jsxs("div",{className:"icon-controls",children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"新图标 (emoji或文件名)",defaultValue:e.icon,onPressEnter:t=>{const r=t.target;f(e.id,r.value,e.icon_type)},style:{marginBottom:"5px"}}),jsxRuntimeExports.jsxs(Select,{placeholder:"图标类型",defaultValue:e.icon_type,style:{width:"100%",marginBottom:"5px"},onChange:t=>f(e.id,e.icon,t),children:[jsxRuntimeExports.jsx(Option$4,{value:"emoji",children:"Emoji"}),jsxRuntimeExports.jsx(Option$4,{value:"png",children:"PNG图片"}),jsxRuntimeExports.jsx(Option$4,{value:"svg",children:"SVG图标"}),jsxRuntimeExports.jsx(Option$4,{value:"jpg",children:"JPG图片"}),jsxRuntimeExports.jsx(Option$4,{value:"webp",children:"WebP图片"})]}),jsxRuntimeExports.jsxs(Select,{placeholder:"选择颜色",defaultValue:e.color,style:{width:"100%",marginBottom:"5px"},onChange:t=>f(e.id,e.icon,e.icon_type,void 0,t),children:[jsxRuntimeExports.jsx(Option$4,{value:"#52c41a",children:"绿色"}),jsxRuntimeExports.jsx(Option$4,{value:"#1890ff",children:"蓝色"}),jsxRuntimeExports.jsx(Option$4,{value:"#fa8c16",children:"橙色"}),jsxRuntimeExports.jsx(Option$4,{value:"#722ed1",children:"紫色"}),jsxRuntimeExports.jsx(Option$4,{value:"#eb2f96",children:"粉色"}),jsxRuntimeExports.jsx(Option$4,{value:"#f5222d",children:"红色"})]}),"emoji"!==e.icon_type&&jsxRuntimeExports.jsx(ImgCrop,{cropShape:"round",aspect:1,quality:1,showGrid:!1,showReset:!0,modalTitle:"裁剪图标",children:jsxRuntimeExports.jsx(Upload,{accept:"image/*",showUploadList:!1,beforeUpload:async t=>{const r={maxSizeMB:.2,maxWidthOrHeight:128,useWebWorker:!0};try{const s=await imageCompression(t,r);return await g(s,"badge",e.id),!1}catch(e2){return console.error("图片压缩失败:",e2),staticMethods.error("图片压缩失败"),!1}},children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$f,{}),size:"small",style:{width:"100%",marginBottom:"5px"},children:"上传图片"})})}),"emoji"===e.icon_type&&m.badges[e.name]&&jsxRuntimeExports.jsxs("div",{className:"icon-suggestions",children:[jsxRuntimeExports.jsx(Text$8,{type:"secondary",style:{fontSize:"12px"},children:"建议:"}),jsxRuntimeExports.jsx(Space$1,{children:m.badges[e.name].map((t,r)=>jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>f(e.id,t,"emoji"),loading:c===e.id,children:t},r))})]})]})]})},e.id))})]}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsxs("div",{className:"section",children:[jsxRuntimeExports.jsx(Title$6,{level:4,children:"🖼️ 头像框样式"}),jsxRuntimeExports.jsx("div",{className:"icon-grid",children:i.map(t=>jsxRuntimeExports.jsx(Card$1,{size:"small",style:{marginBottom:"10px"},children:jsxRuntimeExports.jsxs("div",{className:"icon-item",children:[jsxRuntimeExports.jsxs("div",{className:"icon-display",children:[jsxRuntimeExports.jsx("div",{className:"frame-preview",style:{width:"40px",height:"40px",borderRadius:"50%",border:"2px solid #d9d9d9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",...t.frame_data},children:"👤"}),jsxRuntimeExports.jsx(Text$8,{strong:!0,children:t.name}),jsxRuntimeExports.jsx(Text$8,{type:"secondary",style:{fontSize:"12px"},children:t.rarity})]}),jsxRuntimeExports.jsx("div",{className:"icon-controls",children:jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>{(async(t,r)=>{u(t);try{const{error:s}=await supabase.from("avatar_frames").update({frame_data:r,updated_at:(new Date).toISOString()}).eq("id",t);if(s)throw s;staticMethods.success("头像框样式更新成功"),await h(),null==e||e()}catch(s){console.error("更新头像框失败:",s),staticMethods.error("更新失败")}finally{u(null)}})(t.id,{border:"3px solid #ff6b35",borderRadius:"50%",boxShadow:"0 0 15px #ff6b35",background:"linear-gradient(45deg, #ff6b35, #f7931e)"})},loading:c===t.id,children:"更新样式"})})]})},t.id))})]})]}),jsxRuntimeExports.jsx("style",{children:"\n        .achievement-icon-manager {\n          margin: 20px 0;\n        }\n        \n        .section {\n          margin-bottom: 20px;\n        }\n        \n        .icon-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 10px;\n        }\n        \n        .icon-item {\n          display: flex;\n          align-items: flex-start;\n          gap: 15px;\n        }\n        \n        .icon-display {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          min-width: 80px;\n        }\n        \n        .current-icon {\n          font-size: 32px;\n          margin-bottom: 5px;\n        }\n        \n        .icon-controls {\n          flex: 1;\n        }\n        \n        .icon-suggestions {\n          margin-top: 5px;\n        }\n        \n        .frame-preview {\n          margin-bottom: 5px;\n        }\n      "})]})},PermissionGate=({children:e,permission:t,permissions:r=[],requireAllPermissions:s=!1,role:n,roles:i=[],requireAllRoles:o=!1,fallback:a=null,loading:l=jsxRuntimeExports.jsx(LoadingScreen,{type:"auth"}),organizationId:c})=>{const{hasPermission:u,hasAnyPermission:d,hasAllPermissions:p,hasRole:m,hasAnyRole:h,canManageOrganization:x,loading:f}=useRolePermissions();if(f)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:l});if(t){if(!u(t))return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a})}if(r.length>0){if(!(s?p(r):d(r)))return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a})}if(n){if(!m(n))return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a})}if(i.length>0){if(!(o?i.every(e=>m(e)):h(i)))return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a})}if(c){if(!x(c))return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:a})}return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e})},{TabPane:TabPane$3}=Tabs,AchievementManagement=()=>{const[e,t]=reactExports.useState("overview"),[r,s]=reactExports.useState(0);return jsxRuntimeExports.jsx("div",{style:{padding:"20px"},children:jsxRuntimeExports.jsx(Card$1,{title:"成就系统管理",style:{marginBottom:"20px"},children:jsxRuntimeExports.jsxs(Tabs,{activeKey:e,onChange:t,children:[jsxRuntimeExports.jsx(TabPane$3,{tab:"成就概览",children:jsxRuntimeExports.jsx(AchievementSystem,{},r)},"overview"),jsxRuntimeExports.jsx(TabPane$3,{tab:"图标管理",children:jsxRuntimeExports.jsx(PermissionGate,{permissions:["admin"],children:jsxRuntimeExports.jsx(AchievementIconManager,{onIconUpdate:()=>{s(e=>e+1),staticMethods.success("图标已更新，成就系统将刷新")}})})},"icons")]})})})};var zh_CN$6={},interopRequireDefault={exports:{}},module2;module2=interopRequireDefault,module2.exports=function(e){return e&&e.__esModule?e:{default:e}},module2.exports.__esModule=!0,module2.exports.default=module2.exports;var interopRequireDefaultExports=interopRequireDefault.exports,zh_CN$5={};Object.defineProperty(zh_CN$5,"__esModule",{value:!0}),zh_CN$5.default=void 0;var locale$3={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};zh_CN$5.default=locale$3;var zh_CN$4={},zh_CN$3={},zh_CN$2={},common={};Object.defineProperty(common,"__esModule",{value:!0}),common.commonLocale=void 0,common.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var _interopRequireDefault$4=interopRequireDefaultExports.default;Object.defineProperty(zh_CN$2,"__esModule",{value:!0}),zh_CN$2.default=void 0;var _objectSpread2$1=_interopRequireDefault$4(objectSpread2Exports),_common=common,locale$2=(0,_objectSpread2$1.default)((0,_objectSpread2$1.default)({},_common.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});zh_CN$2.default=locale$2;var zh_CN$1={};Object.defineProperty(zh_CN$1,"__esModule",{value:!0}),zh_CN$1.default=void 0;const locale$1={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};zh_CN$1.default=locale$1;var _interopRequireDefault$3=interopRequireDefaultExports.default;Object.defineProperty(zh_CN$3,"__esModule",{value:!0}),zh_CN$3.default=void 0;var _zh_CN$2=_interopRequireDefault$3(zh_CN$2),_zh_CN2$1=_interopRequireDefault$3(zh_CN$1);const locale={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},_zh_CN$2.default),timePickerLocale:Object.assign({},_zh_CN2$1.default)};locale.lang.ok="确定",zh_CN$3.default=locale;var _interopRequireDefault$2=interopRequireDefaultExports.default;Object.defineProperty(zh_CN$4,"__esModule",{value:!0}),zh_CN$4.default=void 0;var _zh_CN$1=_interopRequireDefault$2(zh_CN$3);zh_CN$4.default=_zh_CN$1.default;var _interopRequireDefault$1=interopRequireDefaultExports.default;Object.defineProperty(zh_CN$6,"__esModule",{value:!0}),zh_CN$6.default=void 0;var _zh_CN=_interopRequireDefault$1(zh_CN$5),_zh_CN2=_interopRequireDefault$1(zh_CN$4),_zh_CN3=_interopRequireDefault$1(zh_CN$3),_zh_CN4=_interopRequireDefault$1(zh_CN$1);const typeTemplate$2="${label}不是一个有效的${type}",localeValues={locale:"zh-cn",Pagination:_zh_CN.default,DatePicker:_zh_CN3.default,TimePicker:_zh_CN4.default,Calendar:_zh_CN2.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:typeTemplate$2,method:typeTemplate$2,array:typeTemplate$2,object:typeTemplate$2,number:typeTemplate$2,date:typeTemplate$2,boolean:typeTemplate$2,integer:typeTemplate$2,float:typeTemplate$2,regexp:typeTemplate$2,email:typeTemplate$2,url:typeTemplate$2,hex:typeTemplate$2},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};zh_CN$6.default=localeValues;var zh_CN=zh_CN$6;const zhCN$1=getDefaultExportFromCjs(zh_CN);function PrivateRoute({children:e}){const{isAuthenticated:t,isLoading:r,user:s}=useAuth(),{profile:n,loading:i}=useUser();return r?jsxRuntimeExports.jsx(LoadingScreen,{type:"auth",message:"正在验证用户身份...",subtitle:"请稍候，我们正在检查您的登录状态"}):i?jsxRuntimeExports.jsx(LoadingScreen,{type:"auth",message:"正在加载用户信息...",subtitle:"请稍候，我们正在获取您的个人资料"}):t&&s?n?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e}):(console.log("用户已认证但profile还在加载中，显示加载屏幕"),jsxRuntimeExports.jsx(LoadingScreen,{type:"auth",message:"正在初始化用户档案...",subtitle:"请稍候，我们正在为您设置个人资料"})):jsxRuntimeExports.jsx(Navigate,{to:"/login",replace:!0})}class CacheManager{constructor(){__publicField(this,"cache",new Map)}set(e,t,r=3e5){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}clear(){this.cache.clear()}clearByPattern(e){for(const t of this.cache.keys())t.includes(e)&&this.cache.delete(t)}}class NotificationApi{constructor(){__publicField(this,"baseUrl","https://lead-service.vld.com.cn/supabase/functions/v1/notification-system"),__publicField(this,"cache",new CacheManager)}async request(e,t={}){return withRetry(async()=>{const{data:{session:r}}=await supabase.auth.getSession();if(!r)return{data:[],total:0};const s=await fetch(`${this.baseUrl}?action=${e}`,{...t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`,...t.headers}});if(!s.ok){if(401===s.status)return{data:[],total:0};const e=await s.json();throw new Error(e.error||e.details||"请求失败")}return s.json()},supabaseRetryOptions)}async getNotifications(e){const{status:t,limit:r=50,offset:s=0,useCache:n=!0}=e||{},i=`notifications_${t||"all"}_${r}_${s}`;if(n){const e=this.cache.get(i);if(e)return e}try{let e=supabase.from("notifications").select("*").order("created_at",{ascending:!1});t&&(e=e.eq("status",t)),e=e.range(s,s+r-1);const{data:n,error:o}=await e;if(o)return console.error("获取通知失败:",o),{data:[],total:0,hasMore:!1};const a={data:n||[],total:(null==n?void 0:n.length)||0,hasMore:(n||[]).length===r};return this.cache.set(i,a,3e5),a}catch(o){return console.error("获取通知时发生错误:",o),{data:[],total:0,hasMore:!1}}}async getAnnouncements(e){const{unread_only:t,useCache:r=!0}=e||{},s="announcements_"+(t?"unread":"all");if(r){const e=this.cache.get(s);if(e)return e}try{let e=supabase.from("announcements").select("*").eq("is_active",!0).order("created_at",{ascending:!1});t&&(e=e.eq("is_read",!1));const{data:r,error:n}=await e;if(n)return console.error("获取公告失败:",n),[];const i=r||[];return this.cache.set(s,i,6e5),i}catch(n){return console.error("获取公告时发生错误:",n),[]}}async getAllAnnouncements(e){const{status:t,limit:r,offset:s,useCache:n=!0}=e||{},i=`all_announcements_${t||"all"}_${r||50}_${s||0}`;if(n){const e=this.cache.get(i);if(e)return e}try{let e=supabase.from("announcements").select("*").order("created_at",{ascending:!1});t&&"all"!==t&&("active"===t?e=e.eq("is_active",!0):"inactive"===t&&(e=e.eq("is_active",!1))),r&&(e=e.range(s||0,(s||0)+r-1));const{data:n,error:o}=await e;if(o)return console.error("获取所有公告失败:",o),[];const a=n||[];return this.cache.set(i,a,3e5),a}catch(o){return console.error("获取所有公告时发生错误:",o),[]}}async getNotificationStats(e=!0){const t="notification_stats";if(e){const e=this.cache.get(t);if(e)return e}try{const{data:e,error:r}=await supabase.from("notifications").select("status");if(r)return console.error("获取通知统计失败:",r),{total:0,unread:0,read:0,handled:0};const s=e||[],n={total:s.length,unread:s.filter(e=>"unread"===e.status).length,read:s.filter(e=>"read"===e.status).length,handled:s.filter(e=>"handled"===e.status).length};return this.cache.set(t,n,12e4),n}catch(r){return console.error("获取通知统计时发生错误:",r),{total:0,unread:0,read:0,handled:0}}}async createNotification(e){const t=await this.request("create_notification",{method:"POST",body:JSON.stringify(e)});return this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats"),t.data}async createAnnouncement(e){const t=await this.request("create_announcement",{method:"POST",body:JSON.stringify(e)});return this.cache.clearByPattern("announcements"),t.data}async markNotificationRead(e){await this.request("mark_read",{method:"POST",body:JSON.stringify({notification_id:e})}),this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats")}async markNotificationHandled(e){await this.request("mark_handled",{method:"POST",body:JSON.stringify({notification_id:e})}),this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats")}async markAnnouncementRead(e){await this.request("mark_announcement_read",{method:"POST",body:JSON.stringify({announcement_id:e})}),this.cache.clearByPattern("announcements")}async deleteNotification(e){await this.request(`delete_notification&id=${e}`,{method:"DELETE"}),this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats")}async deleteAnnouncement(e){try{await this.request(`delete_announcement&id=${e}`,{method:"DELETE"}),this.cache.clearByPattern("announcements")}catch(t){throw console.error("deleteAnnouncement API 错误:",t),t}}async updateAnnouncement(e){const t=await this.request("update_announcement",{method:"PUT",body:JSON.stringify(e)});return this.cache.clearByPattern("announcements"),t.data}async createLeadAssignmentNotification(e,t){await this.createNotification({target_user_id:e,type:"lead_assignment",title:"新线索分配",content:`线索 ${t} 已分配给您`,priority:1,metadata:{leadId:t,assignedAt:(new Date).toISOString()}})}async createDuplicateCustomerNotification(e,t){await this.createNotification({target_user_id:e,type:"duplicate_customer",title:"重复客户提醒",content:`发现重复客户：${t.new_leadid} 与 ${t.original_leadid}`,priority:2,metadata:t})}async createSystemAnnouncement(e){await this.createAnnouncement({...e,type:e.type||"info",priority:e.priority||0})}async batchMarkAsRead(e){await this.request("batch_mark_read",{method:"POST",body:JSON.stringify({notification_ids:e})}),this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats")}async batchDelete(e){await this.request("batch_delete",{method:"DELETE",body:JSON.stringify({notification_ids:e})}),this.cache.clearByPattern("notifications"),this.cache.clearByPattern("notification_stats")}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.cache.size,keys:Array.from(this.cache.cache.keys())}}}const notificationApi=new NotificationApi,{TabPane:TabPane$2}=Tabs,typeMap={all:"全部",announcement:"公告",system:"系统",task_reminder:"任务",duplicate_customer:"客户",lead_assignment:"线索",followup_assignment:"线索"},debounce$4=(e,t)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout(()=>e(...s),t)}},NotificationCenter=({notifications:e,unreadCount:t,markAsRead:r,markAsHandled:s,deleteNotification:n,loading:i,onNotificationChange:o,simple:a=!1,onViewAll:l})=>{var c,u,d,p,m,h,x,f,g;const y=e??[],v=t??0,E=r??(async()=>{}),j=s??(async()=>{}),b=n??(async()=>{}),w=i??!1,[R,_]=reactExports.useState([]),[S,C]=reactExports.useState(null),[k,$]=reactExports.useState(!1),[T,I]=reactExports.useState(null),[P,A]=reactExports.useState(!1),[F,M]=reactExports.useState("all"),[D,O]=reactExports.useState(!1),[N,B]=reactExports.useState(0),L=reactExports.useCallback(debounce$4(e=>{null==o||o(e)},100),[o]);reactExports.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("announcements_cache"),t=localStorage.getItem("announcements_timestamp");if(e&&t){if(Date.now()-parseInt(t)<3e5)return void _(JSON.parse(e))}const r=await notificationApi.getAnnouncements();_(r),localStorage.setItem("announcements_cache",JSON.stringify(r)),localStorage.setItem("announcements_timestamp",Date.now().toString())}catch(e){const t=localStorage.getItem("announcements_cache");t&&_(JSON.parse(t))}})()},[]);const z=reactExports.useMemo(()=>["all","announcement",...Array.from(new Set(y.map(e=>e.type)))],[y]);reactExports.useEffect(()=>{L(v)},[v,L]),reactExports.useEffect(()=>{B(e=>e+1)},[y]);const V=reactExports.useCallback(e=>{I(e),A(!0),"unread"===e.status&&E(e.id)},[E]),U=reactExports.useCallback(async(e,t)=>{try{"read"===t?await E(e):"handled"===t?await j(e):"delete"===t&&await b(e),A(!1),"delete"===t&&staticMethods.success("已删除通知")}catch(r){staticMethods$1.error({message:"操作失败",description:r instanceof Error?r.message:"未知错误"})}},[E,j,b]),H=reactExports.useCallback(e=>({lead_assignment:{icon:"🎯",color:"#1890ff"},duplicate_customer:{icon:"🔄",color:"#fa8c16"},system:{icon:"🔔",color:"#52c41a"},task_reminder:{icon:"⏰",color:"#722ed1"}}[e]||{icon:"📢",color:"#666"}),[]),W=reactExports.useCallback(e=>({unread:"red",read:"blue",handled:"green"}[e]||"default"),[]),q=reactExports.useCallback(e=>({unread:"未读",read:"已读",handled:"已接收"}[e]||e),[]),G=reactExports.useCallback(e=>{const t=H(e.type),r="unread"===e.status;return jsxRuntimeExports.jsxs(List$3.Item,{onClick:()=>V(e),style:{cursor:"pointer",backgroundColor:r?"#f6ffed":"transparent",border:r?"1px solid #b7eb8f":"1px solid transparent",borderRadius:"6px",marginBottom:"8px",padding:"12px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=r?"#f0f9ff":"#f5f5f5"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=r?"#f6ffed":"transparent"},children:[jsxRuntimeExports.jsx(List$3.Item.Meta,{avatar:jsxRuntimeExports.jsx(Avatar$1,{style:{backgroundColor:t.color},icon:jsxRuntimeExports.jsx("span",{style:{fontSize:"16px"},children:t.icon})}),title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Typography.Text,{strong:r,children:e.title}),jsxRuntimeExports.jsx(Tag$1,{color:W(e.status),children:q(e.status)})]}),description:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"4px"},children:jsxRuntimeExports.jsx(Typography.Text,{type:"secondary",children:e.content})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Typography.Text,{type:"secondary",style:{fontSize:"12px"},children:dayjs(e.created_at).format("YYYY-MM-DD HH:mm:ss")})})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Tooltip,{title:"查看详情",children:jsxRuntimeExports.jsx(Button$1,{type:"text",icon:jsxRuntimeExports.jsx(RefIcon$6,{})})}),jsxRuntimeExports.jsx(Tooltip,{title:"删除通知",children:jsxRuntimeExports.jsx(Button$1,{type:"text",icon:jsxRuntimeExports.jsx(RefIcon$O,{}),danger:!0,onClick:t=>{t.stopPropagation(),U(e.id,"delete")}})})]})]},e.id)},[V,U,H,W,q]),Y=reactExports.useCallback(e=>"announcement"===e._type?jsxRuntimeExports.jsx(List$3.Item,{onClick:()=>{C(e),$(!0)},style:{cursor:"pointer",backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"6px",marginBottom:"8px",padding:"12px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f9ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#e6f7ff"},children:jsxRuntimeExports.jsx(List$3.Item.Meta,{avatar:jsxRuntimeExports.jsx(Avatar$1,{style:{backgroundColor:"#1890ff"},icon:jsxRuntimeExports.jsx("span",{style:{fontSize:"16px"},children:"📢"})}),title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Typography.Text,{strong:!0,children:e.title}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:"公告"})]}),description:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"4px"},children:jsxRuntimeExports.jsx(Typography.Text,{type:"secondary",children:e.content})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Typography.Text,{type:"secondary",style:{fontSize:"12px"},children:dayjs(e.created_at).format("YYYY-MM-DD HH:mm:ss")})})]})})},e.id):G(e),[G]),K=reactExports.useMemo(()=>"all"===F?y:y.filter(e=>e.type===F),[F,y]),X=reactExports.useCallback(e=>{const t="all"===e?v:y.filter(t=>t.type===e&&"unread"===t.status).length;return jsxRuntimeExports.jsx(TabPane$2,{tab:jsxRuntimeExports.jsxs("span",{children:[typeMap[e]||e,t>0&&jsxRuntimeExports.jsx(Tag$1,{color:"red",style:{marginLeft:6},children:t})]}),children:w?jsxRuntimeExports.jsx(Skeleton,{active:!0,paragraph:{rows:4}}):0===K.length?jsxRuntimeExports.jsx(Empty$1,{description:"暂无通知",image:Empty$1.PRESENTED_IMAGE_SIMPLE}):jsxRuntimeExports.jsx(List$3,{dataSource:K,renderItem:G,pagination:!1,style:{maxHeight:"600px",overflow:"auto"}})},e)},[F,y,v,w,K,G]),J=reactExports.useCallback(e=>{const t=H(e.type),r="unread"===e.status;return jsxRuntimeExports.jsx("div",{style:{padding:"8px 12px",backgroundColor:r?"#f6ffed":"#f8f9fa",border:r?"1px solid #b7eb8f":"1px solid #e9ecef",borderRadius:"6px",marginBottom:"6px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=r?"#f0f9ff":"#f5f5f5"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=r?"#f6ffed":"#f8f9fa"},onClick:()=>V(e),children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:t.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"},children:t.icon}),jsxRuntimeExports.jsxs("div",{style:{flex:1,minWidth:0},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"13px",fontWeight:r?600:400,color:r?"#000":"#666",marginBottom:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),jsxRuntimeExports.jsx("div",{style:{fontSize:"11px",color:"#999",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:dayjs(e.created_at).format("MM-DD HH:mm")})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"4px",flexShrink:0,alignItems:"center",minWidth:"20px",justifyContent:"flex-end"},children:[r&&jsxRuntimeExports.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#ff4d4f",marginRight:"5px"}}),"handled"===e.status?jsxRuntimeExports.jsx(RefIcon$7,{style:{fontSize:"14px",color:"#52c41a"}}):"read"===e.status?jsxRuntimeExports.jsx(RefIcon$R,{style:{fontSize:"14px",color:"#d9d9d9"}}):null]})]})},e.id)},[V,H]),Z=reactExports.useCallback(()=>{const e=y.length;return w?jsxRuntimeExports.jsxs("div",{style:{padding:"12px"},children:[jsxRuntimeExports.jsx("div",{style:{height:"20px",backgroundColor:"#f0f0f0",borderRadius:"4px",marginBottom:"8px"}}),jsxRuntimeExports.jsx("div",{style:{height:"20px",backgroundColor:"#f0f0f0",borderRadius:"4px",marginBottom:"8px"}}),jsxRuntimeExports.jsx("div",{style:{height:"20px",backgroundColor:"#f0f0f0",borderRadius:"4px"}})]}):0===e?jsxRuntimeExports.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999",fontSize:"12px"},children:"暂无通知"}):jsxRuntimeExports.jsx("div",{style:{padding:"0",maxHeight:224,overflow:"auto"},children:jsxRuntimeExports.jsx(List$3,{dataSource:y,renderItem:e=>J(e),pagination:!1,style:{maxHeight:224}},`notification-list-${N}`)})},[y,w,J,N]),Q=reactExports.useCallback(e=>{var t,r,s,n;if("approval"===e.type){if(e.related_id)return e.related_id;if(null==(t=e.metadata)?void 0:t.operation_id)return e.metadata.operation_id;const i=null==(r=e.content)?void 0:r.match(/操作编号：\s*([a-f0-9-]+)/i);if(i)return i[1];const o=null==(s=e.content)?void 0:s.match(/实例\s*ID:\s*([a-f0-9-]+)/i);if(o)return o[1];const a=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i,l=null==(n=e.content)?void 0:n.match(a);if(l)return l[0]}return null},[]),ee=useNavigate(),te=reactExports.useCallback(()=>{const e=Q(T);if(e){ee(`/approval-details?tab=all&filter_target_id=${e}`),A(!1)}else staticMethods.warning("无法获取操作编号，无法跳转到审批详情")},[T,Q]);return jsxRuntimeExports.jsxs("div",{className:"notification-center-main",children:[a?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontWeight:600,fontSize:14,marginBottom:8,color:"#333"},children:[jsxRuntimeExports.jsx("span",{children:"通知中心"}),jsxRuntimeExports.jsxs(Button$1,{type:"link",size:"small",style:{padding:0},onClick:l,children:["查看全部",y.length>0?` (${y.length})`:""]})]}),Z()]}):jsxRuntimeExports.jsx(Tabs,{activeKey:F,onChange:M,className:"notification-center-tabs",children:z.map(e=>"announcement"===e?jsxRuntimeExports.jsx(TabPane$2,{tab:jsxRuntimeExports.jsx("span",{children:typeMap[e]}),children:w?jsxRuntimeExports.jsx(Skeleton,{active:!0,paragraph:{rows:4}}):0===R.length?jsxRuntimeExports.jsx(Empty$1,{description:"暂无公告",image:Empty$1.PRESENTED_IMAGE_SIMPLE}):jsxRuntimeExports.jsx(List$3,{dataSource:R.map(e=>({...e,_type:"announcement"})),renderItem:Y,pagination:!1,style:{maxHeight:"600px",overflow:"auto"}})},e):X(e))}),jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx("span",{style:{fontSize:20},children:H((null==T?void 0:T.type)||"").icon}),jsxRuntimeExports.jsx("span",{children:null==T?void 0:T.title}),jsxRuntimeExports.jsx(Tag$1,{color:W((null==T?void 0:T.status)||""),children:q((null==T?void 0:T.status)||"")})]}),open:P,onCancel:()=>A(!1),footer:T?jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("div",{children:"followup_assignment"===T.type&&"handled"!==T.status&&jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$_,{}),onClick:async()=>{var e,t;(null==(e=null==T?void 0:T.metadata)?void 0:e.leadid)&&("待接收"===(null==(t=T.metadata)?void 0:t.followupstage)&&await(async e=>{try{const{error:t}=await supabase.from("followups").update({followupstage:"确认需求"}).eq("leadid",e);t?staticMethods.error("推进失败: "+t.message):(staticMethods.success('已推进到"确认需求"阶段'),A(!1))}catch(e2){staticMethods.error("推进失败: "+(e2 instanceof Error?e2.message:"未知错误"))}})(T.metadata.leadid),await U(T.id,"handled"))},children:"接收线索"})}),jsxRuntimeExports.jsxs("div",{children:["approval"===T.type&&jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$6,{}),onClick:te,children:"查看审批详情"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>A(!1),style:{marginLeft:8},children:"关闭"})]})]}):null,width:"followup_assignment"===(null==T?void 0:T.type)?500:400,children:T&&"followup_assignment"===T.type?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs(Descriptions,{column:1,bordered:!0,size:"small",styles:{label:{width:100},content:{fontWeight:500}},children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"线索ID",children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:null==(c=T.metadata)?void 0:c.leadid}),(null==(u=T.metadata)?void 0:u.leadid)&&jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>{navigator.clipboard.writeText(T.metadata.leadid),staticMethods.success("线索编号已复制")}})]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"分配人",children:jsxRuntimeExports.jsxs("span",{children:["👤 ",null==(d=T.metadata)?void 0:d.assigned_user_nickname]})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"手机号",children:(null==(p=T.metadata)?void 0:p.phone)?jsxRuntimeExports.jsxs(Space$1,{children:["📞 ",T.metadata.phone,jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),style:{marginLeft:4},onClick:()=>{navigator.clipboard.writeText(T.metadata.phone),staticMethods.success("手机号已复制")}})]}):"--"}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"微信号",children:(null==(m=T.metadata)?void 0:m.wechat)?jsxRuntimeExports.jsxs(Space$1,{children:["💬 ",T.metadata.wechat,jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),style:{marginLeft:4},onClick:()=>{navigator.clipboard.writeText(T.metadata.wechat),staticMethods.success("微信号已复制")}})]}):"--"}),(null==(h=T.metadata)?void 0:h.source)&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"来源",children:jsxRuntimeExports.jsx("span",{children:null==(x=T.metadata)?void 0:x.source})}),(null==(f=T.metadata)?void 0:f.leadtype)&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"类型",children:jsxRuntimeExports.jsx("span",{children:null==(g=T.metadata)?void 0:g.leadtype})}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:dayjs(T.created_at).format("YYYY-MM-DD HH:mm:ss")}),T.read_at&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"已读时间",children:dayjs(T.read_at).format("YYYY-MM-DD HH:mm:ss")}),T.handled_at&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"接收时间",children:dayjs(T.handled_at).format("YYYY-MM-DD HH:mm:ss")})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:12},children:[jsxRuntimeExports.jsx(Button$1,{type:"link",onClick:()=>O(!D),children:D?"隐藏原始数据":"显示原始数据"}),D&&jsxRuntimeExports.jsx("pre",{style:{fontSize:12,background:"#f6f6f6",padding:8,borderRadius:4},children:JSON.stringify(T.metadata,null,2)})]})]}):T?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs(Descriptions,{column:1,bordered:!0,size:"small",styles:{label:{width:100},content:{fontWeight:500}},children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"标题",children:T.title}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"内容",children:T.content}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"类型",children:typeMap[T.type]||T.type}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:dayjs(T.created_at).format("YYYY-MM-DD HH:mm:ss")}),T.read_at&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"已读时间",children:dayjs(T.read_at).format("YYYY-MM-DD HH:mm:ss")}),T.handled_at&&jsxRuntimeExports.jsx(Descriptions.Item,{label:"处理时间",children:dayjs(T.handled_at).format("YYYY-MM-DD HH:mm:ss")})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:12},children:[jsxRuntimeExports.jsx(Button$1,{type:"link",onClick:()=>O(!D),children:D?"隐藏原始数据":"显示原始数据"}),D&&jsxRuntimeExports.jsx("pre",{style:{fontSize:12,background:"#f6f6f6",padding:8,borderRadius:4},children:JSON.stringify(T.metadata,null,2)})]})]}):null}),jsxRuntimeExports.jsx(Modal$2,{title:"公告详情",open:k,onCancel:()=>$(!1),footer:jsxRuntimeExports.jsx(Button$1,{onClick:()=>$(!1),children:"关闭"}),children:S&&jsxRuntimeExports.jsxs(Descriptions,{column:1,bordered:!0,size:"small",children:[jsxRuntimeExports.jsx(Descriptions.Item,{label:"标题",children:S.title}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"内容",children:S.content}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"类型",children:S.type}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"生效时间",children:dayjs(S.start_time).format("YYYY-MM-DD HH:mm:ss")}),jsxRuntimeExports.jsx(Descriptions.Item,{label:"创建时间",children:dayjs(S.created_at).format("YYYY-MM-DD HH:mm:ss")})]})})]})},debounce$3=(e,t)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout(()=>e(...s),t)}},useRealtimeNotifications=()=>{const{user:e,getCachedUserInfo:t}=useUser(),[r,s]=reactExports.useState(null),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(0),[l,c]=reactExports.useState(!0),[u,d]=reactExports.useState(Date.now());reactExports.useEffect(()=>{if(!e)return;const t=localStorage.getItem(`profileId_${e.id}`);t?s(parseInt(t)):(console.log("[useRealtimeNotifications] 查询用户档案:",{userId:e.id,userType:typeof e.id}),supabase.from("users_profile").select("id").eq("user_id",e.id).single().then(({data:t,error:r})=>{if(r)console.error("[useRealtimeNotifications] 查询用户档案失败:",r),s(null);else{const r=(null==t?void 0:t.id)||null;console.log("[useRealtimeNotifications] 查询用户档案成功:",{profileId:r,data:t}),s(r),r&&localStorage.setItem(`profileId_${e.id}`,r.toString())}}))},[e]),reactExports.useEffect(()=>{r&&h(r)},[r]);const p=reactExports.useCallback(e=>{if(!e||0===e.length)return;const t=e.filter(e=>"unread"===e.status).length;a(t)},[]),m=reactExports.useCallback(debounce$3(e=>{p(e)},500),[p]),h=reactExports.useCallback(async e=>{c(!0);try{const{data:t,error:r}=await supabase.rpc("get_user_notifications",{p_user_id:e});if(r)throw console.error("[loadNotifications] error",r),r;i(t||[]),p(t||[]),localStorage.setItem(`notifications_${e}`,JSON.stringify(t||[])),localStorage.setItem(`notifications_timestamp_${e}`,Date.now().toString())}catch(t){const r=localStorage.getItem(`notifications_${e}`);if(r){const e=JSON.parse(r);i(e),p(e)}}finally{c(!1)}},[]),x=reactExports.useCallback(async e=>{if(r){i(t=>{const r=t.map(t=>t.id===e?{...t,status:"read",read_at:(new Date).toISOString()}:t);return m(r),r}),a(e=>Math.max(0,e-1));try{const{error:t}=await supabase.rpc("mark_notification_read",{p_notification_id:e,p_user_id:r});if(t)throw t}catch(t){i(t=>t.map(t=>t.id===e?{...t,status:"unread",read_at:void 0}:t)),a(e=>e+1)}}},[r,m]),f=reactExports.useCallback(async e=>{if(!r)return;i(t=>t.map(t=>t.id===e?{...t,status:"handled",handled_at:(new Date).toISOString()}:t));const t=n.find(t=>t.id===e);t&&"unread"===t.status&&a(e=>Math.max(0,e-1));try{const{error:t}=await supabase.rpc("mark_notification_handled",{p_notification_id:e,p_user_id:r});if(t)throw t}catch(s){i(t=>t.map(t=>t.id===e?{...t,status:"read",handled_at:void 0}:t))}},[r,n,m]),g=reactExports.useCallback(async e=>{if(!r)return;const t=n,s=n.find(t=>t.id===e),o="unread"===(null==s?void 0:s.status);i(t=>t.filter(t=>t.id!==e)),o&&a(e=>Math.max(0,e-1));try{await notificationApi.deleteNotification(e)}catch(l){throw i(t),o&&a(e=>e+1),l}},[n,r,m]);reactExports.useCallback((e,t)=>{"Notification"in window&&"granted"===Notification.permission&&new Notification(e,{body:t,icon:"/favicon.ico",badge:"/badge.png"})},[]);const y=reactExports.useMemo(()=>({total:n.length,unread:n.filter(e=>"unread"===e.status).length,read:n.filter(e=>"read"===e.status).length,handled:n.filter(e=>"handled"===e.status).length}),[n]);return{notifications:n,unreadCount:o,markAsRead:x,markAsHandled:f,deleteNotification:g,loadNotifications:h,loading:l,lastUpdate:u,notificationStats:y}},{Text:Text$7}=Typography,{TabPane:TabPane$1}=Tabs;function ShowingsQueueManagement(){const[e,t]=reactExports.useState([]),[r]=reactExports.useState(""),[s,n]=reactExports.useState("base"),[i,o]=reactExports.useState([]),[a,l]=reactExports.useState([]),[c,u]=reactExports.useState([]),[d,p]=reactExports.useState(!1),[m,h]=reactExports.useState({visible:!1,type:"",record:null}),[x]=Form$4.useForm(),[f,g]=reactExports.useState({}),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState(null),[b,w]=reactExports.useState({community:"",allocationMethod:"",assignedUserId:"",queueType:"",page:1,pageSize:10,sortBy:"created_at",sortOrder:"desc"}),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState([]),[k,$]=reactExports.useState(0),[T,I]=reactExports.useState({});reactExports.useEffect(()=>{fetchEnumValues("community").then(e=>{const r=e.map(e=>({label:e,value:e}));t(r)}).catch(()=>staticMethods.error("获取社区列表失败"))},[]);const P=async()=>{const{data:e,error:t}=await supabase.from("users_profile").select("id, nickname");if(!t&&e){const t={};e.forEach(e=>{t[e.id]=e.nickname}),g(t)}},A=async(e=b)=>{_(!0);try{const t=await(async(e=b)=>{let t=supabase.from("showings_allocation_logs").select("*",{count:"exact"});e.community&&(t=t.eq("community",e.community)),e.allocationMethod&&(t=t.eq("allocation_method",e.allocationMethod)),e.queueType&&(t=t.eq("queue_type",e.queueType)),e.assignedUserId&&(t=t.eq("assigned_user_id",parseInt(e.assignedUserId))),t=t.order(e.sortBy,{ascending:"asc"===e.sortOrder});const r=(e.page-1)*e.pageSize,s=r+e.pageSize-1;t=t.range(r,s);const{data:n,count:i,error:o}=await t;if(o)throw o;return{data:n||[],total:i||0,page:e.page,pageSize:e.pageSize,totalPages:Math.ceil((i||0)/e.pageSize)}})(e);C(t.data),$(t.total),w(e=>({...e,page:t.page,pageSize:t.pageSize}));const r=t.data.map(e=>e.assigned_user_id).filter(Boolean);r.length>0&&await(async e=>{try{const t=e.filter(e=>null!=e&&!isNaN(e));if(0===t.length)return;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, status").in("id",t);if(s)throw s;const n=(r||[]).reduce((e,t)=>({...e,[String(t.id)]:{nickname:t.nickname||`用户${t.id}`,status:t.status}}),{});I(e=>({...e,...n}))}catch(t){staticMethods.error("加载用户信息失败")}})(r)}catch(t){staticMethods.error("带看分配日志查询失败")}finally{_(!1)}};reactExports.useEffect(()=>{"history"===s&&A()},[b.community,b.allocationMethod,b.assignedUserId,b.queueType,b.page,b.pageSize,b.sortBy,b.sortOrder]),reactExports.useEffect(()=>{var e;if(!m.visible||"base"!==m.type)return;const t=(null==(e=m.record)?void 0:e.list)||[];if(Array.isArray(t))v(t.map(String)),x.setFieldsValue({list:t.map(String)});else if("string"==typeof t){const e=t.split(",").map(e=>e.trim()).filter(Boolean);v(e),x.setFieldsValue({list:e})}else v([]),x.setFieldsValue({list:[]})},[m]),reactExports.useEffect(()=>{"history"!==s?(p(!0),allocationApi.groups.getGroups().then(e=>{e.success&&e.data?o(e.data.filter(e=>e.community)):o([])}),supabase.from("showings_queue_record").select("*").eq("queue_type","direct").order("created_at",{ascending:!1}).then(async({data:e,error:t})=>{!t&&e?(await P(),l(e.filter(e=>e.community))):l([])}),supabase.from("showings_queue_record").select("*").eq("queue_type","skip").order("created_at",{ascending:!1}).then(async({data:e,error:t})=>{!t&&e?(await P(),u(e.filter(e=>e.community))):u([]),p(!1)})):A()},[s]);const F=[{title:"社区",dataIndex:"community",key:"community",width:120,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e})},{title:"分配销售",dataIndex:"assigned_user_id",key:"assigned_user_id",width:150,render:e=>{const t=T[String(e)]||{};return jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$5,{}),jsxRuntimeExports.jsx(Text$7,{children:t.nickname||(e?`用户${e}`:"未分配")}),"inactive"===t.status&&jsxRuntimeExports.jsx(Tag$1,{color:"red",children:"已离职"})]})}},{title:"分配方式",dataIndex:"allocation_method",key:"allocation_method",width:120,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"purple",children:{assigned:"指定人",direct:"直通队列",basic:"基础队列"}[e]||e})},{title:"队列类型",dataIndex:"queue_type",key:"queue_type",width:120,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:{direct:"直通队列",skip:"轮空队列",basic:"基础队列"}[e]||e})},{title:"卡片消耗",key:"card_consumption",width:150,render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:4,children:[t.skip_card_consumed&&jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:"轮空卡已消耗"}),t.direct_card_consumed&&jsxRuntimeExports.jsx(Tag$1,{color:"green",children:"直通卡已消耗"}),!t.skip_card_consumed&&!t.direct_card_consumed&&jsxRuntimeExports.jsx(Tag$1,{color:"gray",children:"无卡片消耗"})]})},{title:"质量控制",dataIndex:"quality_check_passed",key:"quality_check_passed",width:100,render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e?"green":"red",children:e?"通过":"未通过"})},{title:"处理详情",key:"processing_details",width:200,render:(e,t)=>{const r=t.processing_details;return r?jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:4,style:{width:"100%"},children:[r.step&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$7,{type:"secondary",children:"处理步骤："}),jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:r.step})]}),r.assigned_user_id&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$7,{type:"secondary",children:"指定用户："}),jsxRuntimeExports.jsx(Tag$1,{color:"purple",children:r.assigned_user_id})]}),!r.step&&!r.assigned_user_id&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Text$7,{type:"secondary",children:"原始数据："}),jsxRuntimeExports.jsx("div",{style:{marginLeft:8,fontSize:"12px",color:"#666"},children:jsxRuntimeExports.jsx("pre",{style:{margin:0,maxHeight:"100px",overflow:"auto"},children:JSON.stringify(r,null,2)})})]})]}):jsxRuntimeExports.jsx(Text$7,{type:"secondary",children:"无处理详情"})}},{title:"备注",dataIndex:"remark",key:"remark",width:150,render:e=>jsxRuntimeExports.jsx(Text$7,{type:"secondary",children:e||"-"})},{title:"分配时间",dataIndex:"created_at",key:"created_at",width:180,render:e=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$R,{}),jsxRuntimeExports.jsx(Text$7,{children:toBeijingDateTimeStr(e)})]})}],M=[{title:"队列名",dataIndex:"groupname"},{title:"社区",dataIndex:"community",filters:e.map(e=>({text:e.label,value:e.value})),filteredValue:E?[E]:null,onFilter:(e,t)=>t.community===e},{title:"分配方式",dataIndex:"allocation"},{title:"成员数",render:(e,t)=>t.list.length},{title:"成员名称",render:(e,t)=>t.list&&Array.isArray(t.list)?t.list.map(e=>f[Number(e)]||`用户${e}`).join("，"):"-"},{title:"描述",dataIndex:"description"},{title:"操作",render:(e,t)=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>h({visible:!0,type:"base",record:t}),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除该队列？",onConfirm:()=>O("base",t),children:jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,style:{marginLeft:8},children:"删除"})})]})}],D=[{title:"用户ID",dataIndex:"user_id"},{title:"用户名",dataIndex:"username",render:(e,t)=>e||f[t.user_id]||"-"},{title:"社区",dataIndex:"community",filters:e.map(e=>({text:e.label,value:e.value})),filteredValue:E?[E]:null,onFilter:(e,t)=>t.community===e},{title:"创建时间",dataIndex:"created_at",render:e=>e?toBeijingDateTimeStr(e):"-"},{title:"已消耗",dataIndex:"consumed",render:e=>e?"是":"否"},{title:"消耗时间",dataIndex:"consumed_at",render:e=>e?toBeijingDateTimeStr(e):"-"},{title:"操作理由",dataIndex:"remark",width:200,render:e=>e||"-",ellipsis:!0},{title:"操作",render:(e,t)=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>h({visible:!0,type:t.queue_type,record:t}),children:"编辑"}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除该卡？",onConfirm:()=>O(t.queue_type,t),children:jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,style:{marginLeft:8},children:"删除"})})]})}],O=async(e,t)=>{p(!0);try{"base"===e?(await allocationApi.groups.deleteGroup(t.id),staticMethods.success("删除基础队列成功")):(await supabase.from("showings_queue_record").delete().eq("id",t.id),staticMethods.success("删除卡片成功")),h({visible:!1,type:"",record:null}),setTimeout(()=>N(),500)}catch(e2){staticMethods.error("删除失败: "+(e2.message||e2))}finally{p(!1)}},N=()=>{p(!0),allocationApi.groups.getGroups().then(e=>{e.success&&e.data?o(e.data.filter(e=>e.community)):o([])}),supabase.from("showings_queue_record").select("*").eq("queue_type","direct").order("created_at",{ascending:!1}).then(async({data:e,error:t})=>{!t&&e?(await P(),l(e.filter(e=>e.community))):l([])}),supabase.from("showings_queue_record").select("*").eq("queue_type","skip").order("created_at",{ascending:!1}).then(async({data:e,error:t})=>{!t&&e?(await P(),u(e.filter(e=>e.community))):u([]),p(!1)})};return jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsx("h2",{children:"带看分配管理"}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>h({visible:!0,type:"base",record:null}),children:"新增基础队列"}),jsxRuntimeExports.jsx(Button$1,{style:{marginLeft:8},onClick:()=>h({visible:!0,type:"direct",record:null}),children:"新增直通卡"}),jsxRuntimeExports.jsx(Button$1,{style:{marginLeft:8},onClick:()=>h({visible:!0,type:"skip",record:null}),children:"新增轮空卡"})]}),jsxRuntimeExports.jsxs(Tabs,{activeKey:s,onChange:n,children:[jsxRuntimeExports.jsx(TabPane$1,{tab:"基础队列",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:M,dataSource:i,loading:d,pagination:!1,onChange:(e,t)=>{const r=t.community?t.community[0]:null;j("string"==typeof r?r:r?String(r):null)}})},"base"),jsxRuntimeExports.jsx(TabPane$1,{tab:"直通卡",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:D,dataSource:a,loading:d,pagination:!1,onChange:(e,t)=>{const r=t.community?t.community[0]:null;j("string"==typeof r?r:r?String(r):null)}})},"direct"),jsxRuntimeExports.jsx(TabPane$1,{tab:"轮空卡",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:D,dataSource:c,loading:d,pagination:!1,onChange:(e,t)=>{const r=t.community?t.community[0]:null;j("string"==typeof r?r:r?String(r):null)}})},"skip"),jsxRuntimeExports.jsx(TabPane$1,{tab:"分配历史",children:jsxRuntimeExports.jsxs(Card$1,{title:"带看分配历史记录",extra:jsxRuntimeExports.jsx(Space$1,{children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$9,{}),onClick:()=>A(),children:"刷新"})}),children:[jsxRuntimeExports.jsxs(Form$4,{layout:"inline",onFinish:e=>{w(t=>({...t,...e,page:1}))},initialValues:b,style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"community",label:"社区",children:jsxRuntimeExports.jsx(Select,{allowClear:!0,style:{width:120},placeholder:"选择社区",children:e.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.value,children:e.label},e.value))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"allocationMethod",label:"分配方式",children:jsxRuntimeExports.jsxs(Select,{allowClear:!0,style:{width:120},placeholder:"选择分配方式",children:[jsxRuntimeExports.jsx(Select.Option,{value:"assigned",children:"指定人"}),jsxRuntimeExports.jsx(Select.Option,{value:"direct",children:"直通队列"}),jsxRuntimeExports.jsx(Select.Option,{value:"basic",children:"基础队列"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"queueType",label:"队列类型",children:jsxRuntimeExports.jsxs(Select,{allowClear:!0,style:{width:120},placeholder:"选择队列类型",children:[jsxRuntimeExports.jsx(Select.Option,{value:"direct",children:"直通队列"}),jsxRuntimeExports.jsx(Select.Option,{value:"skip",children:"轮空队列"}),jsxRuntimeExports.jsx(Select.Option,{value:"basic",children:"基础队列"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"assignedUserId",label:"分配销售",children:jsxRuntimeExports.jsx(Select,{allowClear:!0,style:{width:150},placeholder:"选择销售",showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:Object.entries(T).map(([e,t])=>jsxRuntimeExports.jsx(Select.Option,{value:e,children:t.nickname||`用户${e}`},e))})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"筛选"})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{onClick:()=>{w({community:"",allocationMethod:"",assignedUserId:"",queueType:"",page:1,pageSize:10,sortBy:"created_at",sortOrder:"desc"})},children:"重置"})})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:F,dataSource:S,loading:R,rowKey:"id",scroll:{x:1300},pagination:{current:b.page,pageSize:b.pageSize,total:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{w(r=>({...r,page:e,pageSize:t}))}},onChange:(e,t,r)=>{w(t=>({...t,page:e.current||1,pageSize:e.pageSize||10,sortBy:r.field||"created_at",sortOrder:"ascend"===r.order?"asc":"desc"}))}})]})},"history")]}),(()=>{var t,s;if(!m.visible)return null;const{type:n,record:i}=m,o="base"===n;return jsxRuntimeExports.jsx(Modal$2,{open:!0,title:"编辑"+(o?"基础队列":"direct"===n?"直通卡":"轮空卡"),onCancel:()=>h({visible:!1,type:"",record:null}),footer:null,children:jsxRuntimeExports.jsxs(Form$4,{form:x,initialValues:o?{...i,list:(null==(s=(t=(null==i?void 0:i.list)||[]).map)?void 0:s.call(t,String))||[]}:{...i,user_ids:(null==i?void 0:i.user_id)?[String(i.user_id)]:[]},layout:"vertical",onFinish:async e=>{var t;p(!0);try{if(o){const t={...e,list:y.map(Number),community:e.community||r};(null==i?void 0:i.id)?(await allocationApi.groups.updateGroup(i.id,t),staticMethods.success("更新基础队列成功")):(await allocationApi.groups.createGroup(t),staticMethods.success("新增基础队列成功"))}else{const s=Number(e.add_count)||1,{add_count:i,user_ids:o,...a}=e,l=Array.isArray(o)?o:[];if(0===l.length)return void staticMethods.error("请至少选择一个用户");const c={...a,community:e.community||r,queue_type:n,remark:e.remark||null},u=[];for(const e of l)for(let t=0;t<s;t++)u.push({...c,user_id:Number(e),consumed:!1});const{error:d}=await supabase.from("showings_queue_record").insert(u);if(d){console.error("❌ 插入记录失败:",d);let e="插入失败";return"403"===d.code||(null==(t=d.message)?void 0:t.includes("Forbidden"))?e="权限不足：您没有 allocation_manage 权限，请联系管理员授予此权限":d.message&&(e=`插入失败: ${d.message}`),void staticMethods.error(e)}staticMethods.success(`成功为 ${l.length} 个用户各创建 ${s} 张${"direct"===n?"直通卡":"轮空卡"}`)}h({visible:!1,type:"",record:null}),N()}catch(e2){console.error("❌ 保存失败:",e2),staticMethods.error("保存失败: "+(e2.message||e2))}finally{p(!1)}},children:[o&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"队列名",name:"groupname",rules:[{required:!0}],children:jsxRuntimeExports.jsx(Input$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"社区",name:"community",children:jsxRuntimeExports.jsx(Select,{options:e})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"分配方式",name:"allocation",children:jsxRuntimeExports.jsx(Select,{options:[{label:"轮询",value:"round_robin"},{label:"随机",value:"random"}],allowClear:!0,placeholder:"分配方式"})}),jsxRuntimeExports.jsx("div",{style:{color:"#888",fontSize:13,margin:"-8px 0 8px 0"},children:"如不选择，默认采用轮询分配（顺序循环分配）；仅当需要随机分配时才需选择“随机”。"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"list",label:"成员ID列表",rules:[{required:!0,message:"请选择成员"}],children:jsxRuntimeExports.jsx(UserTreeSelect,{value:y,onChange:e=>{v(e),x.setFieldsValue({list:e})},placeholder:"请选择成员",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"描述",name:"description",children:jsxRuntimeExports.jsx(Input$1.TextArea,{})})]}),!o&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"选择用户",name:"user_ids",rules:[{required:!0,message:"请选择用户"}],children:jsxRuntimeExports.jsx(UserTreeSelect,{value:(()=>{const e=x.getFieldValue("user_ids");return Array.isArray(e)?e.map(String):[]})(),multiple:!0,onChange:e=>{let t=[];Array.isArray(e)&&(t=e.filter(e=>!String(e).startsWith("dept_"))),x.setFieldsValue({user_ids:t})},placeholder:"请选择用户（可多选）",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"添加数量",name:"add_count",initialValue:1,rules:[{required:!0,type:"number",min:1,message:"请输入大于0的数量"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,step:1,placeholder:"请输入要添加的数量",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"社区",name:"community",children:jsxRuntimeExports.jsx(Select,{options:e})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"操作理由",name:"remark",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入发放该卡片的理由，如：带看回退补偿、手动发放等",rows:3,maxLength:500,showCount:!0})})]}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:d,children:"保存"})]})})})()]})}async function compressImageTo3x(e,t){return new Promise((r,s)=>{const n=new window.Image;n.onload=()=>{const e=document.createElement("canvas");let i,o,a;"live_stream_registration"===t?(i=5760,o=600,a=9.6):(i=5760,o=1500,a=3.84),e.width=i,e.height=o;const l=e.getContext("2d");if(!l)return s("canvas context error");l.fillStyle="#fff",l.fillRect(0,0,e.width,e.height);let c=0,u=0,d=n.width,p=n.height;const m=n.width/n.height;m>a?(d=n.height*a,c=(n.width-d)/2):m<a&&(p=n.width/a,u=(n.height-p)/2),l.drawImage(n,c,u,d,p,0,0,e.width,e.height),e.toBlob(e=>{e?r(e):s("canvas toBlob error")},"image/jpeg",.92)},n.onerror=s,n.src=URL.createObjectURL(e)})}const BannerManagement=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(null),[l]=Form$4.useForm(),[c,u]=reactExports.useState(!1),[d,p]=reactExports.useState(""),[m,h]=reactExports.useState(!1),[x,f]=reactExports.useState("home"),g=[{key:"home",label:"首页轮播图",description:"首页顶部轮播图展示"},{key:"live_stream_registration",label:"直播报名页",description:"直播报名页面顶部banner"},{key:"other",label:"其他页面",description:"其他页面的banner"}],y=async e=>{s(!0);try{const r=e?await fetchBannersByPageType(e):await fetchBanners();t(r)}catch(e2){staticMethods.error("获取轮播图失败")}s(!1)};reactExports.useEffect(()=>{y(x)},[x]);const v=()=>{a(null),p(""),i(!0),h(!1)};reactExports.useEffect(()=>{n&&!m&&(o?l.setFieldsValue({title:o.title||"",description:o.description||"",sort_order:o.sort_order??0,is_active:o.is_active??!0,page_type:o.page_type||x,jump_type:o.jump_type||"none",jump_target:o.jump_target||""}):l.setFieldsValue({title:"",description:"",sort_order:0,is_active:!0,page_type:x,jump_type:"none",jump_target:""}),h(!0))},[n,o,l,m,x]);const E={title:"",description:"",sort_order:0,is_active:!0,page_type:x,jump_type:"none",jump_target:""};React$2.useEffect(()=>{n&&!o&&l.setFieldsValue(E)},[n,o,l]);const j=[{title:"图片",dataIndex:"image_url",render:(e,t)=>jsxRuntimeExports.jsx(Image$2,{src:e,width:120})},{title:"标题",dataIndex:"title",render:(e,t)=>e},{title:"页面类型",dataIndex:"page_type",render:(e,t)=>{const r=g.find(t=>t.key===e);return r?r.label:e}},{title:"排序",dataIndex:"sort_order",render:(e,t)=>e},{title:"状态",dataIndex:"is_active",render:(e,t)=>e?"上架":"下架"},{title:"点击后动作",dataIndex:"jump_type",render:(e,t)=>"none"!==e&&e?`${e}：${t.jump_target||""}`:"无"},{title:"操作",render:(e,t)=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$c,{}),size:"small",onClick:()=>(e=>{a(e),p(e.image_url),i(!0),h(!1)})(t),style:{marginRight:8},children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$O,{}),size:"small",danger:!0,onClick:()=>(async e=>{await deleteBanner(e),staticMethods.success("删除成功"),y(x)})(t.id),children:"删除"})]})}];return jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsx(Tabs,{activeKey:x,onChange:f,items:g.map(t=>({key:t.key,label:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600"},children:t.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999"},children:t.description})]}),children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:v,style:{marginBottom:16},children:["新建",t.label]}),jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:j,dataSource:e,loading:r})]})}))}),jsxRuntimeExports.jsx(Modal$2,{title:o?"编辑轮播图":"新建轮播图",open:n,onOk:async()=>{try{const e=await l.validateFields();if(!d)return void staticMethods.error("请上传图片");const t={...e,image_url:d};o?(await updateBanner(o.id,t),staticMethods.success("编辑成功")):(await createBanner(t),staticMethods.success("新建成功")),i(!1),p(""),l.resetFields(),y(x)}catch(e){}},onCancel:()=>{i(!1),p(""),l.resetFields()},destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:l,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:jsxRuntimeExports.jsx(Input$1,{autoComplete:"off"})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"描述",name:"description",children:jsxRuntimeExports.jsx(Input$1.TextArea,{})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"页面类型",name:"page_type",rules:[{required:!0,message:"请选择页面类型"}],children:jsxRuntimeExports.jsx(Select,{children:g.map(e=>jsxRuntimeExports.jsx(Select.Option,{value:e.key,children:e.label},e.key))})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"排序（越大越靠前）",name:"sort_order",rules:[{required:!0,message:"请输入排序"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"是否上架",name:"is_active",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"点击后动作类型",name:"jump_type",rules:[{required:!0,message:"请选择类型"}],children:jsxRuntimeExports.jsxs(Select,{children:[jsxRuntimeExports.jsx(Select.Option,{value:"none",children:"无"}),jsxRuntimeExports.jsx(Select.Option,{value:"url",children:"外链"}),jsxRuntimeExports.jsx(Select.Option,{value:"route",children:"站内路由"}),jsxRuntimeExports.jsx(Select.Option,{value:"iframe",children:"iframe"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"目标地址",name:"jump_target",children:jsxRuntimeExports.jsx(Input$1,{placeholder:"如 https://example.com 或 /internal/page"})}),jsxRuntimeExports.jsxs(Form$4.Item,{label:`图片（${"live_stream_registration"===x?"3x精度5760x600":"3x精度5760x1500"}，支持裁剪）`,children:[jsxRuntimeExports.jsx(ImgCrop,{aspect:"live_stream_registration"===x?9.6:3.84,quality:1,modalTitle:`裁剪图片为${"live_stream_registration"===x?"5760x600":"5760x1500"}比例`,showGrid:!0,children:jsxRuntimeExports.jsx(Upload,{name:"file",showUploadList:!1,accept:"image/*",beforeUpload:async e=>{u(!0);try{const t=await compressImageTo3x(e,x),r="jpg",s=`banner/${toBeijingTime(new Date).valueOf()}.${r}`,{error:n}=await supabase.storage.from("banners").upload(s,t,{upsert:!0,contentType:"image/jpeg"});if(n)throw n;const{data:i}=supabase.storage.from("banners").getPublicUrl(s);p(i.publicUrl),staticMethods.success("上传成功")}catch(e2){staticMethods.error("上传失败")}return u(!1),!1},disabled:c,children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$f,{}),loading:c,children:"上传图片"})})}),d&&jsxRuntimeExports.jsx(Image$2,{src:d,width:240,style:{marginTop:8}})]})]})})]})},NotificationTemplateManager=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(null),[l]=Form$4.useForm(),c=async()=>{s(!0);const{data:e,error:r}=await supabase.from("notification_templates").select("*").order("created_at",{ascending:!1});s(!1),r?(console.error("[TEMPLATE][fetchTemplates] 获取模板失败:",r),staticMethods.error("获取模板失败")):t(e||[])};reactExports.useEffect(()=>{c()},[]);const u=e=>{a(e||null),i(!0),e?l.setFieldsValue(e):(l.resetFields(),l.setFieldsValue({is_active:!0}))},d=[{title:"类型(type)",dataIndex:"type",key:"type",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:e})},{title:"标题(title)",dataIndex:"title",key:"title"},{title:"内容(content)",dataIndex:"content",key:"content",ellipsis:!0},{title:"启用",dataIndex:"is_active",key:"is_active",render:e=>e?jsxRuntimeExports.jsx(Tag$1,{color:"green",children:"启用"}):jsxRuntimeExports.jsx(Tag$1,{children:"停用"})},{title:"操作",key:"action",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>u(t)}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除？",onConfirm:()=>(async e=>{const{error:t}=await supabase.from("notification_templates").delete().eq("id",e);t?(console.error("[TEMPLATE][handleDelete] 删除失败:",t),staticMethods.error("删除失败")):(staticMethods.success("删除成功"),c())})(t.id),children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$O,{}),danger:!0})})]})}];return jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsx("h2",{children:"通知模板管理"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),style:{marginBottom:16},onClick:()=>u(),children:"新增模板"}),jsxRuntimeExports.jsx(ForwardTable,{columns:d,dataSource:e,rowKey:"id",loading:r,bordered:!0,pagination:{pageSize:10}}),jsxRuntimeExports.jsx(Modal$2,{title:o?"编辑模板":"新增模板",open:n,onOk:async()=>{try{const e=await l.validateFields();if(o){const{error:t}=await supabase.from("notification_templates").update(e).eq("id",o.id);if(t)throw console.error("[TEMPLATE][handleOk] 更新失败:",t),t;staticMethods.success("模板更新成功")}else{const{error:t}=await supabase.from("notification_templates").insert([e]);if(t)throw console.error("[TEMPLATE][handleOk] 新增失败:",t),t;staticMethods.success("模板创建成功")}i(!1),a(null),l.resetFields(),c()}catch(e2){console.error("[TEMPLATE][handleOk] 操作失败:",e2),staticMethods.error(e2.message||"操作失败")}},onCancel:()=>{i(!1),a(null)},destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:l,layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"type",label:"类型(type)",rules:[{required:!0,message:"请输入类型"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"如 welcome, first_login, reset_success"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"title",label:"标题(title)",rules:[{required:!0,message:"请输入标题"}],children:jsxRuntimeExports.jsx(Input$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"content",label:"内容(content)",rules:[{required:!0,message:"请输入内容"}],children:jsxRuntimeExports.jsx(Input$1.TextArea,{rows:4,placeholder:"支持 {{name}} 等变量"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"启用",valuePropName:"checked",initialValue:!0,children:jsxRuntimeExports.jsx(Switch$1,{})})]})})]})};async function getApprovalInstances(e={}){try{const{page:t=1,pageSize:r=10,sortField:s="created_at",sortOrder:n="DESC",statusFilter:i,targetIdFilter:o,flowNameFilter:a,creatorNameFilter:l,dateFrom:c,dateTo:u}=e,d={p_page:t,p_page_size:r,p_sort_field:s,p_sort_order:n,p_status_filter:i||null,p_target_id_filter:o||null,p_flow_name_filter:a||null,p_creator_name_filter:l||null,p_date_from:c||null,p_date_to:u||null},[p,m]=await Promise.all([supabase.rpc("get_approval_instances_with_sorting",d),supabase.rpc("get_approval_instances_count",{p_status_filter:i||null,p_target_id_filter:o||null,p_flow_name_filter:a||null,p_creator_name_filter:l||null,p_date_from:c||null,p_date_to:u||null})]);return p.error?(console.error("获取审批实例失败:",p.error),{data:[],total:0,error:p.error.message}):m.error?(console.error("获取审批实例总数失败:",m.error),{data:[],total:0,error:m.error.message}):{data:p.data||[],total:m.data||0}}catch(t){return console.error("获取审批实例异常:",t),{data:[],total:0,error:String(t)}}}async function getApprovalStatistics(){try{const{data:e,error:t}=await supabase.rpc("get_approval_statistics");return t?(console.error("获取审批统计失败:",t),{data:null,error:t.message}):{data:(null==e?void 0:e[0])||null}}catch(e){return console.error("获取审批统计异常:",e),{data:null,error:String(e)}}}async function getUserApprovalStatistics(e){try{const{data:t,error:r}=await supabase.rpc("get_user_approval_statistics",{p_user_id:e});return r?(console.error("获取用户审批统计失败:",r),{data:null,error:r.message}):{data:(null==t?void 0:t[0])||null}}catch(t){return console.error("获取用户审批统计异常:",t),{data:null,error:String(t)}}}async function getApprovalPerformanceMetrics(){try{const{data:e,error:t}=await supabase.rpc("get_approval_performance_metrics");return t?(console.error("获取审批性能指标失败:",t),{data:[],error:t.message}):{data:e||[]}}catch(e){return console.error("获取审批性能指标异常:",e),{data:[],error:String(e)}}}function formatToBeijingTime$1(e){if(!e)return"-";const t=new Date(e);return new Date(t.getTime()+288e5).toISOString().replace("T"," ").substring(0,19)}const{Step:Step}=Steps,ApprovalFlowManagement=()=>{const{user:e,profile:t}=useUser(),[r]=Form$4.useForm(),[s,n]=reactExports.useState([]),[i,o]=reactExports.useState(!1),[a,l]=reactExports.useState(null),[c,u]=reactExports.useState([]),[d,p]=reactExports.useState(null),[m,h]=reactExports.useState([]),[x,f]=reactExports.useState(!1),[g,y]=reactExports.useState(!1),[v,E]=reactExports.useState({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`}),[j,b]=reactExports.useState(null),[w,R]=reactExports.useState([]),[_,S]=reactExports.useState([]);async function C(){const{data:e,error:t}=await supabase.from("approval_flows").select("*");t?staticMethods.error("获取审批流模板失败"):n(e||[])}async function k(e=1,t=10,r,s){y(!0);try{const n={page:e,pageSize:t,sortField:(null==s?void 0:s.field)||"created_at",sortOrder:"ascend"===(null==s?void 0:s.order)?"ASC":"DESC",statusFilter:null==r?void 0:r.status,targetIdFilter:null==r?void 0:r.target_id,flowNameFilter:null==r?void 0:r.flow_name,creatorNameFilter:null==r?void 0:r.creator_name,dateFrom:null==r?void 0:r.date_from,dateTo:null==r?void 0:r.date_to},{data:i,total:o,error:a}=await getApprovalInstances(n);if(a)return void staticMethods.error(`获取审批实例失败: ${a}`);u(i||[]),E(t=>({...t,current:e,total:o||0}))}finally{y(!1)}}async function $(e){const{data:t,error:r}=await supabase.from("approval_steps").select("*").eq("instance_id",e);r?staticMethods.error("获取审批节点失败"):h(t||[])}function T(e,t,r){R(w.map((s,n)=>n===e?{...s,[t]:r}:s))}React$2.useEffect(()=>{C(),k(1,v.pageSize),async function(){try{const{data:e}=await supabase.from("organizations").select("id, name, parent_id"),{data:t}=await supabase.from("users_profile").select("id, nickname, organization_id").eq("status","active"),r=s=>(e||[]).filter(e=>e.parent_id===s).map(e=>{const s=(t||[]).filter(t=>t.organization_id===e.id),n=r(e.id);return{title:`${e.name} (${s.length}人)`,value:`dept_${e.id}`,key:`dept_${e.id}`,children:[...s.map(e=>({title:e.nickname,value:String(e.id),key:String(e.id),isLeaf:!0})),...n]}}),s=(t||[]).filter(e=>!e.organization_id).map(e=>({title:e.nickname,value:String(e.id),key:String(e.id),isLeaf:!0})),n=r(null);s.length>0&&n.push({title:`未分配部门 (${s.length}人)`,value:"dept_none",key:"dept_none",children:s}),S(n)}catch(e2){staticMethods.error("加载组织成员树失败")}}(),async function(){try{const{data:e,error:t}=await getApprovalStatistics();if(t)return;b(e)}catch(e2){}}()},[]),React$2.useEffect(()=>{i&&(a&&a.config&&Array.isArray(a.config.steps)?R(a.config.steps):R([]))},[i,a]),React$2.useEffect(()=>{i&&(r.resetFields(),a?r.setFieldsValue({name:a.name,type:a.type,config:a.config||{}}):r.setFieldsValue({name:"",type:"",config:{}}))},[i,a,r]);const I=[{title:"名称",dataIndex:"name"},{title:"类型",dataIndex:"type"},{title:"操作",render:(e,t)=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>(l(t),void o(!0)),children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,style:{marginLeft:8},onClick:()=>async function(e){Modal$2.confirm({title:"确认删除该审批流模板？",onOk:async()=>{const{error:t}=await supabase.from("approval_flows").delete().eq("id",e);t||staticMethods.success("已删除"),C()}})}(t.id),children:"删除"})]})}];const P=[{title:"业务类型",dataIndex:"flow_name",key:"flow_name",sorter:!0},{title:"操作编号",dataIndex:"target_id",key:"target_id",sorter:!0},{title:"当前状态",dataIndex:"status",key:"status",render:e=>function(e){let t="default",r=e;return"pending"===e?(t="blue",r="待审批"):"approved"===e?(t="green",r="已同意"):"rejected"===e?(t="red",r="已拒绝"):(t="default",r=e),jsxRuntimeExports.jsx(Tag$1,{color:t,children:r})}(e),sorter:!0},{title:"审批时长",dataIndex:"approval_duration_minutes",key:"approval_duration_minutes",sorter:!0,render:e=>{if(!e)return"-";if(e>=1440){return Math.floor(e/1440)+"天"}return Math.floor(e)+"分钟"}},{title:"发起时间",dataIndex:"created_at",key:"created_at",render:e=>formatToBeijingTime$1(e),sorter:!0},{title:"完成时间",dataIndex:"latest_action_time",key:"latest_action_time",sorter:!0,render:(e,t)=>"pending"===t.status?"-":formatToBeijingTime$1(e||void 0)},{title:"发起人",dataIndex:"creator_nickname",key:"creator_nickname",sorter:!0},{title:"操作",key:"action",render:(e,t)=>jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:jsxRuntimeExports.jsx(Button$1,{size:"small",style:{width:60},onClick:()=>async function(e){p(e),await $(e.id),f(!0)}(t),children:"详情"})})}];async function A(r,s){try{if(!e||!t)return void staticMethods.error("用户信息获取失败");if("pending"!==r.status)return void staticMethods.error("该步骤已处理，无法重复审批");if(t.id!==r.approver_id)return void staticMethods.error("您不是该步骤的审批人");const n={status:s,action_time:(new Date).toISOString(),updated_at:(new Date).toISOString()},{error:i}=await supabase.from("approval_steps").update(n).eq("id",r.id);if(i)return void staticMethods.error(`审批操作失败: ${i.message}`);staticMethods.success(`已${"approved"===s?"同意":"拒绝"}该节点`),await $(r.instance_id)}catch(e2){staticMethods.error(`审批操作异常: ${e2.message||e2}`)}}return jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsx("h2",{children:"审批流模板管理"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:function(){l(null),o(!0)},style:{marginBottom:16},children:"新建审批流模板"}),jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:I,dataSource:s,pagination:!1,style:{marginBottom:32}}),jsxRuntimeExports.jsx("h2",{children:"审批实例管理"}),jsxRuntimeExports.jsxs(Row,{gutter:16,style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"总审批实例",value:(null==j?void 0:j.total_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$v,{})})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"待审批实例",value:(null==j?void 0:j.pending_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$R,{}),valueStyle:{color:"#1890ff"}})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"已完成审批",value:((null==j?void 0:j.approved_instances)||0)+((null==j?void 0:j.rejected_instances)||0),prefix:jsxRuntimeExports.jsx(RefIcon$7,{}),valueStyle:{color:"#52c41a"}})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"平均审批时长",value:(null==j?void 0:j.avg_approval_duration_minutes)?(j.avg_approval_duration_minutes/60).toFixed(1):0,suffix:"小时",prefix:jsxRuntimeExports.jsx(RefIcon$R,{}),valueStyle:{color:"#722ed1"}})})})]}),jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:P,dataSource:c,loading:g,pagination:v,onChange:(e,t,r)=>{const{current:s,pageSize:n}=e,i=Array.isArray(r)?r[0]:r;s&&n&&k(s,n,t,i)}}),jsxRuntimeExports.jsx(Modal$2,{title:a?"编辑审批流模板":"新建审批流模板",open:i,onCancel:()=>o(!1),footer:null,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:r,onFinish:async function(e){const t={steps:w};if(a){const{error:r}=await supabase.from("approval_flows").update({...e,config:t}).eq("id",a.id);r||staticMethods.success("保存成功")}else{const{error:r}=await supabase.from("approval_flows").insert([{...e,config:t}]);r||staticMethods.success("新建成功")}o(!1),C()},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称"}],validateStatus:r.getFieldValue("name")?void 0:"error",help:r.getFieldValue("name")?void 0:"请输入名称"}),jsxRuntimeExports.jsx(Form$4.Item,{label:"类型",name:"type",rules:[{required:!0,message:"请输入类型"}],validateStatus:r.getFieldValue("type")?void 0:"error",help:r.getFieldValue("type")?void 0:"请输入类型"}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,background:"#fafafa",padding:12,borderRadius:8},children:[jsxRuntimeExports.jsx("b",{children:"流程设计"}),w.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,background:"#fff",padding:8,borderRadius:4},children:[jsxRuntimeExports.jsx(Select,{value:e.type,style:{width:100},onChange:e=>T(t,"type",e),options:[{label:"审批",value:"approval"}]}),jsxRuntimeExports.jsx(Input$1,{placeholder:"权限/角色标识",value:e.permission,style:{width:120},onChange:e=>T(t,"permission",e.target.value)}),jsxRuntimeExports.jsx(Select,{value:e.mode,style:{width:100},onChange:e=>T(t,"mode",e),options:[{label:"任一同意",value:"any"},{label:"全部同意",value:"all"}]}),jsxRuntimeExports.jsx(TreeSelect,{style:{width:220},value:e.default_approver_id||[],treeData:_,placeholder:"选择默认审批人",allowClear:!0,treeDefaultExpandAll:!0,showSearch:!0,multiple:!0,treeCheckable:!0,filterTreeNode:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),onChange:e=>T(t,"default_approver_id",Array.isArray(e)?e:[e]),maxTagCount:"responsive"}),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$O,{}),danger:!0,size:"small",onClick:()=>function(e){R(w.filter((t,r)=>r!==e))}(t)})]},t)),jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$a,{}),type:"dashed",onClick:function(){R([...w,{type:"approval",permission:"",mode:"any",default_approver_id:[]}])},style:{width:"100%"},children:"添加节点"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:500,marginBottom:4},children:"配置(JSON)"}),jsxRuntimeExports.jsx(Input$1.TextArea,{rows:4,value:JSON.stringify({steps:w},null,2),readOnly:!0})]}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"保存"})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:"审批进度",open:x,onCancel:()=>f(!1),footer:null,width:600,destroyOnHidden:!0,children:d&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx("b",{children:"业务类型："}),d.target_table," ",jsxRuntimeExports.jsx("b",{children:"业务ID："}),d.target_id," ",jsxRuntimeExports.jsx("b",{children:"状态："}),jsxRuntimeExports.jsx(Tag$1,{children:d.status})]}),jsxRuntimeExports.jsx(Steps,{direction:"vertical",current:d.current_step,children:m.map((e,t)=>jsxRuntimeExports.jsx(Step,{title:`节点${t+1} 审批人ID: ${e.approver_id}`,status:"approved"===e.status?"finish":"rejected"===e.status?"error":"process",description:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:["状态: ",jsxRuntimeExports.jsx(Tag$1,{children:e.status})]}),jsxRuntimeExports.jsxs("div",{children:["意见: ",e.comment||"-"]}),jsxRuntimeExports.jsxs("div",{children:["时间: ",e.action_time||"-"]}),"pending"===e.status&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>A(e,"approved"),children:"同意"}),jsxRuntimeExports.jsx(Button$1,{danger:!0,size:"small",style:{marginLeft:8},onClick:()=>A(e,"rejected"),children:"拒绝"})]})]})},e.id))})]})})]})};function PointsSummary(){const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(!0),[l,c]=reactExports.useState(null),[u,d]=reactExports.useState(),[p,m]=reactExports.useState(),[h,x]=reactExports.useState(),[f,g]=reactExports.useState(!1),[y]=Form$4.useForm(),[v,E]=reactExports.useState(!1),{profile:j}=useUser(),[b,w]=reactExports.useState(null);reactExports.useEffect(()=>{(null==j?void 0:j.id)&&w(j.id)},[j]);reactExports.useEffect(()=>{!async function(){a(!0);try{const e=await getAllUserPointsWallets();t(e||[]);const{data:r,error:n}=await supabase.from("users_profile").select("id, nickname, email, organization_id");if(n)throw n;s(r||[]);const{data:o,error:a}=await supabase.from("organizations").select("id, name, parent_id, admin");if(a)throw a;i(o||[])}catch(e){c(e.message||"加载失败")}finally{a(!1)}}()},[]);const R=n.filter(e=>e.parent_id===p).map(e=>({label:e.name,value:e.id})),_=Object.fromEntries(n.map(e=>[e.id,e]));function S(e){if(!e)return{};const t=_[e];if(!t)return{};if(!t.parent_id)return{dept1:t};const r=_[t.parent_id];if(r&&!r.parent_id)return{dept1:r,dept2:t};if(r&&r.parent_id){const e=_[r.parent_id];return e?{dept1:e,dept2:r,dept3:t}:{dept1:r,dept2:t}}return{dept1:t}}const C=n.filter(e=>!e.parent_id).map(e=>({label:e.name,value:e.id})),k=n.filter(e=>e.parent_id===u).map(e=>({label:e.name,value:e.id})),$=r.filter(e=>{var t,r,s;const n=S(e.organization_id);return(!u||(null==(t=n.dept1)?void 0:t.id)===u)&&((!p||(null==(r=n.dept2)?void 0:r.id)===p)&&(!h||(null==(s=n.dept3)?void 0:s.id)===h))}).map(e=>e.id);const T=e.filter(e=>$.includes(e.user_id)).map(e=>{var t,s;const n=r.find(t=>t.id===e.user_id),i=S(null==n?void 0:n.organization_id);return{key:e.id,user_id:e.user_id,nickname:(null==n?void 0:n.nickname)||"-",dept1:(null==(t=i.dept1)?void 0:t.name)||"-",dept2:(null==(s=i.dept2)?void 0:s.name)||"-",dept3:i.dept3?i.dept3.name:"-",total_points:e.total_points,total_earned_points:e.total_earned_points,total_consumed_points:e.total_consumed_points,updated_at:(o=e.updated_at,o?toBeijingDateTimeStr(o):"-")};var o});function I(e){return Array.from(new Set(T.map(t=>t[e]))).filter(e=>e&&"-"!==e).map(e=>({text:e,value:e}))}const P=[{title:"用户ID",dataIndex:"user_id",key:"user_id",sorter:(e,t)=>e.user_id-t.user_id},{title:"昵称",dataIndex:"nickname",key:"nickname",sorter:(e,t)=>e.nickname.localeCompare(t.nickname),filters:I("nickname"),onFilter:(e,t)=>("string"==typeof e||"number"==typeof e||"bigint"==typeof e)&&t.nickname===e},{title:"一级部门",dataIndex:"dept1",key:"dept1",sorter:(e,t)=>e.dept1.localeCompare(t.dept1),filters:I("dept1"),onFilter:(e,t)=>("string"==typeof e||"number"==typeof e||"bigint"==typeof e)&&t.dept1===e},{title:"二级部门",dataIndex:"dept2",key:"dept2",sorter:(e,t)=>e.dept2.localeCompare(t.dept2),filters:I("dept2"),onFilter:(e,t)=>("string"==typeof e||"number"==typeof e||"bigint"==typeof e)&&t.dept2===e},{title:"三级部门",dataIndex:"dept3",key:"dept3",sorter:(e,t)=>e.dept3.localeCompare(t.dept3),filters:I("dept3"),onFilter:(e,t)=>("string"==typeof e||"number"==typeof e||"bigint"==typeof e)&&t.dept3===e},{title:"剩余积分",dataIndex:"total_points",key:"total_points",sorter:(e,t)=>e.total_points-t.total_points},{title:"累计获得",dataIndex:"total_earned_points",key:"total_earned_points",sorter:(e,t)=>e.total_earned_points-t.total_earned_points},{title:"累计消耗",dataIndex:"total_consumed_points",key:"total_consumed_points",sorter:(e,t)=>e.total_consumed_points-t.total_consumed_points},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",sorter:(e,t)=>e.updated_at.localeCompare(t.updated_at)}];return o?jsxRuntimeExports.jsx(Spin,{tip:"加载中...",style:{marginTop:40}}):l?jsxRuntimeExports.jsx(Alert,{type:"error",message:l,style:{marginTop:40}}):jsxRuntimeExports.jsxs("div",{className:"page-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-bold text-gray-800",children:"积分汇总"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx(Select,{allowClear:!0,className:"w-45",placeholder:"选择一级部门",options:C,value:u,onChange:e=>{d(e),m(void 0),x(void 0)}}),jsxRuntimeExports.jsx(Select,{allowClear:!0,className:"w-45",placeholder:"选择二级部门",options:k,value:p,onChange:e=>{x(void 0)},disabled:!u}),jsxRuntimeExports.jsx(Select,{allowClear:!0,className:"w-45",placeholder:"选择三级部门",options:R,value:h,onChange:x,disabled:!p}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>g(!0),className:"rounded-md font-medium",children:"积分调整"})]})]}),jsxRuntimeExports.jsx("div",{className:"page-table-wrap",children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:T,columns:P,pagination:{pageSize:20},bordered:!0})}),jsxRuntimeExports.jsx(Modal$2,{title:"积分调整",open:f,onCancel:()=>g(!1),footer:null,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:y,layout:"vertical",onFinish:async e=>{E(!0);try{if(!b)throw new Error("无法获取当前操作人");await submitPointsAdjustApproval({...e,created_by:b}),staticMethods.success("已提交审批，待通过后自动发放"),g(!1),y.resetFields()}catch(t){staticMethods.error("积分调整申请失败："+(t.message||"未知错误"))}finally{E(!1)}},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"user_id",label:"人员",rules:[{required:!0,message:"请选择人员"}],children:jsxRuntimeExports.jsx(Select,{showSearch:!0,placeholder:"输入姓名或ID搜索",optionFilterProp:"label",filterOption:(e,t)=>{var r;return(null==(r=null==t?void 0:t.label)?void 0:r.toLowerCase().includes(e.toLowerCase()))||String(null==t?void 0:t.value).includes(e)},children:r.map(e=>jsxRuntimeExports.jsxs(Select.Option,{value:e.id,label:`${e.nickname||"-"}（ID:${e.id}）`,children:[e.nickname||"-","（ID:",e.id,"）"]},e.id))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"points",label:"积分",rules:[{required:!0,message:"请输入积分"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:-999999,max:999999,style:{width:"100%"},placeholder:"可正可负"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"remark",label:"备注",children:jsxRuntimeExports.jsx(Input$1.TextArea,{rows:3,maxLength:200,showCount:!0,placeholder:"请输入备注（可选）"})}),jsxRuntimeExports.jsxs(Form$4.Item,{style:{textAlign:"right",marginBottom:0},children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>g(!1),style:{marginRight:12},disabled:v,children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:v,children:"确定"})]})]})})]})}function formatToBeijingTime(e){return e?toBeijingDateTimeStr(e):"-"}const ApprovalDetails=()=>{const{user:e,profile:t}=useUser(),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState([]),[l,c]=reactExports.useState([]),[u,d]=reactExports.useState(null),[p,m]=reactExports.useState(!0),[h,x]=reactExports.useState(new Map),[f,g]=reactExports.useState(0),[y,v]=reactExports.useState(null),[E,j]=reactExports.useState(!1),[b,w]=reactExports.useState(null);function R(e){return/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(e)}const[_,S]=React$2.useState(!1),[C,k]=React$2.useState([]),[$,T]=React$2.useState(0);function I(e){if(!e)return"-";if("string"==typeof e)try{e=JSON.parse(e)}catch{return e}return e.steps&&Array.isArray(e.steps)?jsxRuntimeExports.jsx("div",{style:{maxWidth:400},children:e.steps.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{background:"#f6f6f6",borderRadius:4,padding:"4px 8px",marginBottom:4,fontSize:13,lineHeight:1.6},children:[jsxRuntimeExports.jsxs("b",{children:["节点",t+1,"："]}),"类型: ",e.type,e.permission&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["，权限: ",e.permission]}),e.mode&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["，模式: ","any"===e.mode?"任一同意":"all"===e.mode?"全部同意":e.mode]}),e.default_approver_id&&e.default_approver_id.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["，审批人: ",Array.isArray(e.default_approver_id)?e.default_approver_id.join(","):e.default_approver_id]}),e.notifiers&&e.notifiers.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["，知会: ",Array.isArray(e.notifiers)?e.notifiers.join(","):e.notifiers]})]},t))}):"object"==typeof e?jsxRuntimeExports.jsx("div",{style:{maxWidth:400},children:Object.entries(e).map(([e,t])=>{let r=[];return Array.isArray(t)&&(r=t.filter(e=>"string"==typeof e&&R(e))),jsxRuntimeExports.jsxs("div",{style:{background:"#f6f6f6",borderRadius:4,padding:"4px 8px",marginBottom:4,fontSize:13,lineHeight:1.6},children:[jsxRuntimeExports.jsxs("b",{children:[e,"："]}),Array.isArray(t)?t.map((e,t)=>"string"==typeof e&&e.startsWith("http")?R(e)?jsxRuntimeExports.jsx("img",{src:e,alt:`evidence-${t}`,style:{maxWidth:80,maxHeight:60,margin:4,borderRadius:4,border:"1px solid #eee",cursor:"pointer"},onClick:()=>{return t=r,s=r.indexOf(e),k(t),T(s),void S(!0);var t,s}},t):jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e})},t):jsxRuntimeExports.jsx("div",{children:String(e)},t)):String(t)]},e)})}):String(e)}function P(e){let t="default",r=e;return"pending"===e?(t="blue",r="待审批"):"approved"===e?(t="green",r="已同意"):"rejected"===e?(t="red",r="已拒绝"):(t="default",r=e),jsxRuntimeExports.jsx(Tag$1,{color:t,children:r})}const{Step:A}=Steps,{TextArea:F}=Input$1,M=async(e,t,r)=>{try{const s={status:t,action_time:(new Date).toISOString()};void 0!==r&&(s.comment=r);const{error:n}=await supabase.from("approval_steps").update(s).eq("id",e);n?staticMethods.error("审批操作失败: "+n.message):(staticMethods.success(`已${"approved"===t?"同意":"拒绝"}该节点`),g(e=>e+1))}catch(e2){staticMethods.error("审批操作异常: "+(e2.message||e2))}},[D,O]=reactExports.useState([]);reactExports.useEffect(()=>{O(r)},[r]);const N=async(e,t,r)=>{if(t===r)return;O(r=>r.map(r=>r.step_id===e?{...r,comment:t}:r));const{error:s}=await supabase.from("approval_steps").update({comment:t}).eq("id",e);s?(staticMethods.error("批注保存失败: "+s.message),O(t=>t.map(t=>t.step_id===e?{...t,comment:r}:t))):staticMethods.success("批注已保存")},B=[{title:"业务类型",dataIndex:"name",key:"name",sorter:!0,filters:[]},{title:"状态",dataIndex:"status",key:"status",render:P,sorter:!0,filters:[{text:"待审批",value:"pending"},{text:"已同意",value:"approved"},{text:"已拒绝",value:"rejected"}]},{title:"发起人昵称",dataIndex:"initiator_nickname",key:"initiator_nickname",sorter:!0,filters:[]},{title:"发起时间",dataIndex:"created_at",key:"created_at",render:e=>formatToBeijingTime(e),sorter:!0},{title:"等待时长",dataIndex:"created_at",key:"wait_duration",render:e=>{if(!e)return"-";const t=new Date,r=new Date(e),s=t.getTime()-r.getTime(),n=Math.floor(s/6e4);if(n>=1440){return Math.floor(n/1440)+"天"}return n+"分钟"},sorter:!0},{title:"操作编号",dataIndex:"target_id",key:"target_id",sorter:!0,filters:[]},{title:"流程配置",dataIndex:"config",key:"config",render:I,sorter:!0,filters:[]},{title:"批注",dataIndex:"comment",key:"comment",render:(e,t)=>jsxRuntimeExports.jsx(Input$1.TextArea,{defaultValue:e,rows:2,style:{resize:"none"},placeholder:"请输入批注",onBlur:r=>N(t.id,r.target.value,e)})},{title:"操作",key:"action",fixed:"right",render:(e,t)=>jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",type:"primary",style:{width:60},onClick:()=>M(t.id,"approved",t.comment),children:"同意"}),jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,style:{width:60},onClick:()=>M(t.id,"rejected"),children:"拒绝"}),jsxRuntimeExports.jsx(Button$1,{size:"small",style:{width:60},onClick:()=>L(t),children:"详情"})]})}],L=async e=>{w(e.target_id);const{data:t}=await supabase.from("approval_steps").select("*").eq("instance_id",e.id);v({...e,approval_steps:t||[]}),j(!0)},z=[{title:"业务类型",dataIndex:"name",key:"name",sorter:!0,filters:[]},{title:"操作编号",dataIndex:"target_id",key:"target_id",sorter:!0,filters:[]},{title:"当前状态",dataIndex:"status",key:"status",render:e=>P(e),sorter:!0,filters:[{text:"待审批",value:"pending"},{text:"已同意",value:"approved"},{text:"已拒绝",value:"rejected"}]},{title:"审批时长",key:"duration",sorter:!0,render:(e,t)=>{const r=t.created_at?new Date(t.created_at):null,s=t.action_time?new Date(t.action_time):null;if(!r||!s)return"-";const n=s.getTime()-r.getTime(),i=Math.floor(n/6e4);if(i>=1440){return Math.floor(i/1440)+"天"}return i+"分钟"}},{title:"发起时间",dataIndex:"created_at",key:"created_at",render:e=>formatToBeijingTime(e),sorter:!0},{title:"完成时间",dataIndex:"action_time",key:"action_time",render:(e,t)=>"pending"===t.status?"-":formatToBeijingTime(e),sorter:!0},{title:"发起人昵称",dataIndex:"initiator_nickname",key:"initiator_nickname",sorter:!0,filters:[]},{title:"操作",key:"action",fixed:"right",render:(e,t)=>jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:jsxRuntimeExports.jsx(Button$1,{size:"small",style:{width:60},onClick:()=>L(t),children:"详情"})})}];reactExports.useEffect(()=>{!async function(){m(!0);try{if(!e||!t)return;d(t.id);const{data:r}=await supabase.from("users_profile").select("id, nickname"),n=new Map;(r||[]).forEach(e=>n.set(Number(e.id),e.nickname)),x(n);const{data:o}=await supabase.from("approval_flows").select("id, name"),l=new Map;(o||[]).forEach(e=>l.set(e.id,e.name));const u="id, comment, step_index, approver_id, status, action_time, approval_instances!inner(id, flow_id, target_id, created_by, created_at, config, users_profile:created_by(nickname))",{data:p}=await supabase.from("approval_steps").select("*, approval_instances!inner(flow_id, target_id, created_by, created_at, config, users_profile:created_by(nickname))").eq("approver_id",t.id).eq("status","pending"),m=(p||[]).map(e=>{var t,r,s;return{...e,...e.approval_instances,initiator_nickname:null==(r=null==(t=e.approval_instances)?void 0:t.users_profile)?void 0:r.nickname,name:l.get(null==(s=e.approval_instances)?void 0:s.flow_id)||"",action_time:e.action_time,id:e.id}});s(m);const{data:h}=await supabase.from("approval_steps").select(u).eq("approver_id",t.id).in("status",["approved","rejected"]),f=(h||[]).map(e=>{var t;return{...e.approval_instances,status:e.status,initiator_nickname:null==(t=e.approval_instances.users_profile)?void 0:t.nickname,config:e.approval_instances.config,name:l.get(e.approval_instances.flow_id)||"",action_time:e.action_time,comment:e.comment}});i(f);const{data:g}=await supabase.from("approval_instances").select("*, approval_steps(id, step_index, approver_id), users_profile:created_by(nickname)").eq("created_by",t.id),y=(g||[]).map(e=>{var t;return{...e,name:l.get(e.flow_id)||"",config:"string"==typeof e.config?(()=>{try{return JSON.parse(e.config)}catch{return{}}})():e.config,action_time:e.updated_at,approval_steps:e.approval_steps||[],initiator_nickname:(null==(t=e.users_profile)?void 0:t.nickname)||"未知用户"}});a(y);const v=new Map;[...m,...f,...y].forEach(e=>{const t={...e,target_id:e.target_id||e.id||"",operation_id:e.target_id||e.id||""};v.set(e.id,t)});const E=Array.from(v.values());c(E)}finally{m(!1)}}()},[f,e,t]);const[V,U]=useSearchParams(),H=V.get("tab")||"pending",W=V.get("filter_target_id"),q=reactExports.useMemo(()=>{if(W){return l.filter(e=>{const t=e.target_id||e.operation_id||e.id;return!!t&&(t===W||!!t.toLowerCase().includes(W.toLowerCase()))})}return l},[l,W]);if("undefined"!=typeof window){const e=document.createElement("style");e.innerHTML=".ant-table-cell { white-space: normal !important; vertical-align: middle; }",document.head.appendChild(e)}const G=[{title:"业务类型",dataIndex:"name",key:"name",sorter:!0,filters:[]},{title:"状态",dataIndex:"status",key:"status",render:P,sorter:!0,filters:[{text:"待审批",value:"pending"},{text:"已同意",value:"approved"},{text:"已拒绝",value:"rejected"}]},{title:"发起人昵称",dataIndex:"initiator_nickname",key:"initiator_nickname",sorter:!0,filters:[]},{title:"发起时间",dataIndex:"created_at",key:"created_at",render:e=>formatToBeijingTime(e),sorter:!0},{title:"完成时间",dataIndex:"action_time",key:"action_time",render:e=>formatToBeijingTime(e),sorter:!0},{title:"操作编号",dataIndex:"target_id",key:"target_id",sorter:!0,filters:[]},{title:"流程配置",dataIndex:"config",key:"config",render:I,sorter:!0,filters:[]},{title:"批注",dataIndex:"comment",key:"comment",render:e=>jsxRuntimeExports.jsx("span",{style:{whiteSpace:"pre-wrap"},children:e||"-"})},{title:"操作",key:"action",fixed:"right",render:(e,t)=>jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:jsxRuntimeExports.jsx(Button$1,{size:"small",style:{width:60},onClick:()=>L(t),children:"详情"})})}];return jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsx("h2",{children:"审批明细"}),jsxRuntimeExports.jsx(Tabs,{activeKey:H,onChange:e=>{const t=new URLSearchParams(V);t.set("tab",e),U(t)},items:[{key:"pending",label:"未审批",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:B,dataSource:D,loading:p,pagination:!1,scroll:{x:"max-content"}})},{key:"approved",label:"已审批",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:G,dataSource:n,loading:p,pagination:!1,scroll:{x:"max-content"}})},{key:"initiated",label:"已发起",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:z,dataSource:o,loading:p,pagination:!1,scroll:{x:"max-content"}})},{key:"all",label:"全部",children:jsxRuntimeExports.jsx(ForwardTable,{rowKey:"id",columns:z,dataSource:q,loading:p,pagination:!1,scroll:{x:"max-content"},onChange:(e,t,r)=>{}})}]}),jsxRuntimeExports.jsx(Modal$2,{open:_,onCancel:()=>S(!1),footer:null,width:void 0,styles:{body:{textAlign:"center",padding:0,background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh"}},children:C.length>0&&jsxRuntimeExports.jsxs("div",{style:{width:"100%"},children:[jsxRuntimeExports.jsx("img",{src:C[$],alt:"预览",style:{width:"100%",maxWidth:"80vw",maxHeight:"80vh",borderRadius:12,margin:"auto",display:"block",objectFit:"contain",background:"#fff"}}),C.length>1&&jsxRuntimeExports.jsxs("div",{style:{position:"absolute",top:"50%",left:0,right:0,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[jsxRuntimeExports.jsx(Button$1,{style:{pointerEvents:"auto",opacity:0===$?.3:1},disabled:0===$,onClick:()=>T($-1),children:"上一张"}),jsxRuntimeExports.jsx(Button$1,{style:{pointerEvents:"auto",opacity:$===C.length-1?.3:1},disabled:$===C.length-1,onClick:()=>T($+1),children:"下一张"})]})]})}),jsxRuntimeExports.jsx(Drawer,{open:E,onClose:()=>j(!1),title:"线索与审批详情",width:900,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Tabs,{defaultActiveKey:"flow",size:"large",children:[jsxRuntimeExports.jsx(Tabs.TabPane,{tab:"审批流详情",children:y?function(e){if(!e)return null;const t=e.approval_steps||[];return jsxRuntimeExports.jsxs("div",{style:{padding:12},children:[jsxRuntimeExports.jsx("h3",{children:"审批流进度"}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:8},children:[jsxRuntimeExports.jsx("b",{children:"业务类型："}),e.name," ",jsxRuntimeExports.jsx("b",{children:"操作编号："}),e.target_id]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:8},children:[jsxRuntimeExports.jsx("b",{children:"当前状态："}),P(e.status)," ",jsxRuntimeExports.jsx("b",{children:"当前步骤："}),"number"==typeof e.current_step&&t.length?`第${e.current_step+1}步/共${t.length}步`:"-"]}),jsxRuntimeExports.jsx(Steps,{direction:"vertical",current:e.current_step,children:t.map((e,t)=>jsxRuntimeExports.jsx(A,{title:`节点${t+1} 审批人: ${h.get(Number(e.approver_id))||e.approver_id}`,status:"approved"===e.status?"finish":"rejected"===e.status?"error":"process",description:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:["状态: ",P(e.status)]}),jsxRuntimeExports.jsxs("div",{children:["批注: ","pending"===e.status&&e.approver_id===u?jsxRuntimeExports.jsx(F,{defaultValue:e.comment,rows:2,style:{resize:"none"},placeholder:"请输入批注",onBlur:t=>N(e.id,t.target.value,e.comment)}):jsxRuntimeExports.jsx("span",{style:{whiteSpace:"pre-wrap"},children:e.comment||"-"})]}),jsxRuntimeExports.jsxs("div",{children:["时间: ",formatToBeijingTime(e.action_time)||"-"]})]})},e.id))})]})}(y):jsxRuntimeExports.jsx("div",{style:{color:"#999",textAlign:"center",marginTop:48},children:"无审批流数据"})},"flow"),jsxRuntimeExports.jsx(Tabs.TabPane,{tab:"线索详情",children:b&&jsxRuntimeExports.jsx(LeadDetailDrawer,{leadid:b})},"lead")]})})]})},{Title:Title$5,Text:Text$6}=Typography,ApprovalPerformance=()=>{const{user:e}=useUser(),[t,r]=reactExports.useState(!0),[s,n]=reactExports.useState(null),[i,o]=reactExports.useState([]),[a,l]=reactExports.useState(null);reactExports.useEffect(()=>{c()},[]);const c=async()=>{r(!0);try{const[t,r,s]=await Promise.all([getApprovalStatistics(),getApprovalPerformanceMetrics(),(null==e?void 0:e.id)?getUserApprovalStatistics(Number(e.id)):Promise.resolve({data:null,error:null})]);t.data&&n(t.data),r.data&&o(r.data),s.data&&l(s.data)}catch(t){console.error("获取性能数据失败:",t)}finally{r(!1)}},u=[{title:"指标名称",dataIndex:"description",key:"description"},{title:"数值",dataIndex:"metric_value",key:"metric_value",render:(e,t)=>{if(null===e)return"-";switch(t.metric_name){case"avg_approval_duration_hours":return`${e.toFixed(2)} 小时`;case"pending_instances_ratio":return`${e.toFixed(1)}%`;case"avg_steps_per_instance":return e.toFixed(1);default:return e.toFixed(2)}}},{title:"状态",key:"status",render:(e,t)=>{const r=t.metric_value;if(null===r)return"-";let s="green",n="正常";switch(t.metric_name){case"avg_approval_duration_hours":r>24?(s="red",n="需要优化"):r>8&&(s="orange",n="注意");break;case"pending_instances_ratio":r>50?(s="red",n="积压严重"):r>30&&(s="orange",n="需要关注");break;case"avg_steps_per_instance":r>5&&(s="orange",n="流程复杂")}return jsxRuntimeExports.jsx(Text$6,{style:{color:s},children:n})}}];return t?jsxRuntimeExports.jsxs("div",{style:{padding:24,textAlign:"center"},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:"加载性能数据中..."})]}):jsxRuntimeExports.jsxs("div",{style:{padding:24},children:[jsxRuntimeExports.jsxs(Title$5,{level:2,children:[jsxRuntimeExports.jsx(RefIcon$K,{})," 审批性能监控"]}),jsxRuntimeExports.jsxs(Row,{gutter:16,style:{marginBottom:24},children:[jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"总审批实例",value:(null==s?void 0:s.total_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$v,{}),valueStyle:{color:"#1890ff"}})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"待审批实例",value:(null==s?void 0:s.pending_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$R,{}),valueStyle:{color:"#faad14"}})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"已同意",value:(null==s?void 0:s.approved_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$7,{}),valueStyle:{color:"#52c41a"}})})}),jsxRuntimeExports.jsx(Col,{span:6,children:jsxRuntimeExports.jsx(Card$1,{bordered:!1,children:jsxRuntimeExports.jsx(Statistic,{title:"已拒绝",value:(null==s?void 0:s.rejected_instances)||0,prefix:jsxRuntimeExports.jsx(RefIcon$$,{}),valueStyle:{color:"#ff4d4f"}})})})]}),jsxRuntimeExports.jsx(Card$1,{title:"性能指标",style:{marginBottom:24},children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:i,columns:u,rowKey:"metric_name",pagination:!1,size:"small"})}),jsxRuntimeExports.jsxs(Row,{gutter:16,style:{marginBottom:24},children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsxs(Card$1,{title:"审批效率分析",children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Text$6,{children:"平均审批时长"}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:jsxRuntimeExports.jsx(Progress,{percent:(null==s?void 0:s.avg_approval_duration_minutes)?Math.min(s.avg_approval_duration_minutes/60/24*100,100):0,status:(null==s?void 0:s.avg_approval_duration_minutes)&&s.avg_approval_duration_minutes>1440?"exception":"active",format:()=>((null==s?void 0:s.avg_approval_duration_minutes)||0)/60+" 小时"})})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Text$6,{children:"待审批占比"}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:jsxRuntimeExports.jsx(Progress,{percent:(null==s?void 0:s.total_instances)?s.pending_instances/s.total_instances*100:0,status:(null==s?void 0:s.pending_instances)&&s.pending_instances>.5*s.total_instances?"exception":"active"})})]})]})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Card$1,{title:"个人统计",extra:jsxRuntimeExports.jsx(RefIcon$5,{}),children:a?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Statistic,{title:"待处理",value:a.total_pending,valueStyle:{color:"#faad14"}})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Statistic,{title:"已处理",value:a.total_approved+a.total_rejected,valueStyle:{color:"#52c41a"}})}),jsxRuntimeExports.jsx(Col,{span:8,children:jsxRuntimeExports.jsx(Statistic,{title:"平均响应时间",value:a.avg_response_time_minutes?(a.avg_response_time_minutes/60).toFixed(1):0,suffix:"小时",valueStyle:{color:"#722ed1"}})})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:16},children:[jsxRuntimeExports.jsx(Text$6,{children:"处理效率"}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:jsxRuntimeExports.jsx(Progress,{percent:a.total_pending+a.total_approved+a.total_rejected>0?(a.total_approved+a.total_rejected)/(a.total_pending+a.total_approved+a.total_rejected)*100:0,status:"active"})})]})]}):jsxRuntimeExports.jsx(Alert,{message:"未获取到个人统计数据",description:"请确保已登录并具有相应权限",type:"info",showIcon:!0})})})]}),jsxRuntimeExports.jsx(Card$1,{title:"优化建议",style:{marginBottom:24},children:jsxRuntimeExports.jsx(Row,{gutter:16,children:jsxRuntimeExports.jsx(Col,{span:24,children:i.map(e=>{let t="",r="info";switch(e.metric_name){case"avg_approval_duration_hours":e.metric_value&&e.metric_value>24?(t="建议优化审批流程，减少审批环节，提高审批效率",r="error"):e.metric_value&&e.metric_value>8?(t="审批时长较长，建议检查审批流程是否合理",r="warning"):(t="审批效率良好，继续保持",r="success");break;case"pending_instances_ratio":e.metric_value&&e.metric_value>50?(t="待审批积压严重，建议增加审批人员或优化流程",r="error"):e.metric_value&&e.metric_value>30?(t="待审批比例较高，建议及时处理",r="warning"):(t="待审批比例合理",r="success");break;case"avg_steps_per_instance":e.metric_value&&e.metric_value>5?(t="审批步骤较多，建议简化流程",r="warning"):(t="审批步骤合理",r="success")}return t?jsxRuntimeExports.jsx(Alert,{message:e.description,description:t,type:r,showIcon:!0,style:{marginBottom:8}},e.metric_name):null})})})})]})};dayjs.extend(utc),dayjs.extend(timezone);const TIME_FIELDS=["created_at","updata_at","moveintime","followup_scheduletime","arrivaltime","showing_moveintime","showing_scheduletime","showing_created_at","showing_updated_at","contractdate","deal_created_at","deal_updated_at"],formatTimeField=e=>{if(!e||"0"===e||"空值"===e)return String(e);try{return dayjs(e).tz("Asia/Shanghai").format("YYYY-MM-DD")}catch(e2){return String(e)}},formatDateRange=(e,t)=>{try{const r=dayjs(e).format("MM-DD");return`${r} ~ ${dayjs(t).format("MM-DD")}`}catch(e2){return`${e} ~ ${t}`}},pivotTableStyles="\n  .pivot-table .ant-table-summary {\n    background-color: #fafafa;\n  }\n  \n\n  \n  .pivot-table .ant-table-thead > tr > th {\n    background-color: #fafafa;\n    font-weight: bold;\n    text-align: center;\n    font-size: 12px;\n  }\n  \n  .pivot-table .ant-table-tbody > tr > td {\n    text-align: center;\n    font-size: 12px;\n  }\n  \n  .pivot-table .ant-table-tbody > tr:last-child > td {\n    background-color: #f0f8ff;\n    font-weight: bold;\n  }\n",{Title:Title$4,Text:Text$5}=Typography,{Option:Option$3}=Select,{RangePicker:RangePicker}=DatePicker$2,DataAnalysis=()=>{var e,t;const{user:r}=useUser(),[s,n]=reactExports.useState(!1),[i,o]=reactExports.useState([]),[a,l]=reactExports.useState(null),[c,u]=reactExports.useState(null),[d,p]=reactExports.useState("pivot"),[m,h]=reactExports.useState(null),[x,f]=reactExports.useState(null),[g,y]=reactExports.useState([]),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState(null),[w]=Form$4.useForm(),[R,_]=reactExports.useState(!1),[S,C]=reactExports.useState(null),[k,$]=reactExports.useState(""),[T,I]=reactExports.useState(!1),[P,A]=reactExports.useState(null),[F]=Form$4.useForm(),[M,D]=reactExports.useState(!1),[O,N]=reactExports.useState(null),[B]=Form$4.useForm(),[L,z]=reactExports.useState(""),V=e=>["interviewsales_user_name","showingsales_user_name","trueshowingsales_nickname","staffname"].includes(e);reactExports.useEffect(()=>{y([{name:"followup_id",label:"跟进记录ID",type:"dimension",table:"followups",dataType:"string"},{name:"leadid",label:"线索编号",type:"dimension",table:"followups",dataType:"string"},{name:"followupstage",label:"跟进阶段",type:"dimension",table:"followups"},{name:"customerprofile",label:"客户画像",type:"dimension",table:"followups"},{name:"worklocation",label:"工作地点",type:"dimension",table:"followups"},{name:"userbudget",label:"用户预算",type:"dimension",table:"followups"},{name:"moveintime",label:"跟进入住时间",type:"dimension",table:"followups",dataType:"date"},{name:"userrating",label:"来访意向",type:"dimension",table:"followups"},{name:"majorcategory",label:"跟进结果",type:"dimension",table:"followups"},{name:"followupresult",label:"跟进结果详情",type:"dimension",table:"followups"},{name:"scheduledcommunity",label:"意向社区",type:"dimension",table:"followups"},{name:"interviewsales_user_id",label:"约访销售ID",type:"dimension",table:"followups"},{name:"interviewsales_user_name",label:"跟进约访销售",type:"dimension",table:"followups",dataType:"person"},{name:"followup_created_at",label:"跟进创建时间",type:"dimension",table:"followups",dataType:"date"},{name:"phone",label:"线索手机号",type:"dimension",table:"leads",dataType:"string"},{name:"wechat",label:"线索微信号",type:"dimension",table:"leads",dataType:"string"},{name:"qq",label:"QQ号",type:"dimension",table:"leads",dataType:"string"},{name:"location",label:"位置",type:"dimension",table:"leads",dataType:"string"},{name:"budget",label:"线索预算",type:"dimension",table:"leads",dataType:"string"},{name:"remark",label:"线索备注",type:"dimension",table:"leads",dataType:"string"},{name:"source",label:"线索渠道",type:"dimension",table:"leads",dataType:"string"},{name:"staffname",label:"员工姓名",type:"dimension",table:"leads",dataType:"person"},{name:"area",label:"线索来源区域",type:"dimension",table:"leads",dataType:"string"},{name:"leadtype",label:"线索类型",type:"dimension",table:"leads",dataType:"string"},{name:"leadstatus",label:"线索状态",type:"dimension",table:"leads",dataType:"string"},{name:"lead_created_at",label:"线索创建时间",type:"dimension",table:"leads",dataType:"date"},{name:"showing_id",label:"看房记录ID",type:"dimension",table:"showings",dataType:"string"},{name:"showing_community",label:"看房社区",type:"dimension",table:"showings"},{name:"viewresult",label:"看房结果",type:"dimension",table:"showings"},{name:"arrivaltime",label:"到达时间",type:"dimension",table:"showings",dataType:"date"},{name:"showingsales_user_name",label:"分配带看销售",type:"dimension",table:"showings",dataType:"person"},{name:"trueshowingsales_nickname",label:"实际带看销售",type:"dimension",table:"showings",dataType:"person"},{name:"showing_budget",label:"看房预算",type:"dimension",table:"showings",dataType:"number"},{name:"showing_moveintime",label:"看房入住时间",type:"dimension",table:"showings",dataType:"date"},{name:"showing_remark",label:"看房备注",type:"dimension",table:"showings"},{name:"renttime",label:"租期",type:"dimension",table:"showings",dataType:"string"},{name:"showing_scheduletime",label:"看房预约时间",type:"dimension",table:"showings",dataType:"date"},{name:"showing_created_at",label:"看房创建时间",type:"dimension",table:"showings",dataType:"date"},{name:"deal_id",label:"成交记录ID",type:"dimension",table:"deals",dataType:"string"},{name:"contractdate",label:"签约日期",type:"dimension",table:"deals",dataType:"date"},{name:"deal_community",label:"成交社区",type:"dimension",table:"deals"},{name:"contractnumber",label:"合同编号",type:"dimension",table:"deals"},{name:"roomnumber",label:"房间号",type:"dimension",table:"deals"},{name:"deal_created_at",label:"成交创建时间",type:"dimension",table:"deals",dataType:"date"}])},[]);const U=(e,t)=>{if(!e||!e.result)return{headers:[],rows:[],totals:{},summary:{totalRows:0,totalColumns:0,totalValue:0}};const r=e.result;if(0===r.length)return{headers:[],rows:[],totals:{},summary:{totalRows:0,totalColumns:0,totalValue:0}};return t&&t.columnFields&&t.columnFields.length>0?W(r,t):H(r,t)},H=(e,t)=>{const r=Object.keys(e[0]),s=r,n=(null==t?void 0:t.valueFields)||[],i=e.map((e,t)=>{const s={};r.forEach(t=>{const r=e[t];s[t]=G(r,t)});let i=0;return n.forEach(t=>{const r=`${t.field}_${t.aggregation}`,s=Number(e[r]);isNaN(s)||(i+=s)}),s["总计"]=i,{key:t.toString(),...s}}),o={totalRows:i.length,totalColumns:s.length,totalValue:i.length>0?i.length:0},a={};if(i.length>0){s.forEach(t=>{const r=n.find(e=>t===`${e.field}_${e.aggregation}`);if(r){const s=e.map(e=>e[t]).filter(e=>null!=e),n=s.filter(e=>!isNaN(Number(e)));if(n.length>0){let e;switch(r.aggregation){case"sum":case"count":default:e=n.reduce((e,t)=>e+Number(t),0);break;case"avg":e=n.reduce((e,t)=>e+Number(t),0)/n.length;break;case"max":e=Math.max(...n.map(e=>Number(e)));break;case"min":e=Math.min(...n.map(e=>Number(e)));break;case"count_distinct":e=new Set(s).size}a[t]=e}else a[t]=0}else{const r=e.map(e=>e[t]).filter(e=>null!=e).filter(e=>null!=e&&""!==e);a[t]=r.length}});let t=0;n.forEach(e=>{const r=`${e.field}_${e.aggregation}`,s=a[r];null!=s&&(t+=Number(s))}),a["总计"]=t}return{headers:s,rows:i,totals:a,summary:o}},W=(e,t)=>{const r=t.rowFields||[],s=t.columnFields||[],n=t.valueFields||[];if(0===s.length)return H(e,t);const i=new Map;e.forEach(e=>{if(1===s.length){const t=q(e[s[0]]),r=G(t,s[0]);i.has(r)||i.set(r,new Map);const n=i.get(r);n.has(r)||n.set(r,new Set),n.get(r).add(r)}else{const t=q(e[s[0]]),r=q(e[s[1]]),n=G(t,s[0]),o=G(r,s[1]);i.has(n)||i.set(n,new Map);const a=i.get(n);a.has(o)||a.set(o,new Set),a.get(o).add(o)}});const o=[],a=Array.from(i.keys()).sort(),l=new Set,c=[...r];a.forEach(e=>{const t=i.get(e).size;for(let r=0;r<t;r++)c.push(e)}),c.push("总计"),o.push(c);const u=r.map(()=>"");a.forEach(e=>{const t=i.get(e);Array.from(t.keys()).sort().forEach(e=>{u.push(e),l.add(e)})}),u.push(""),o.push(u);const d=new Map;e.forEach(e=>{const t=r.map(t=>{const r=q(e[t]);return G(r,t)}).join("|");let i,o;if(1===s.length){const t=q(e[s[0]]);i=G(t,s[0]),o=i}else{const t=q(e[s[0]]),r=q(e[s[1]]);i=G(t,s[0]),o=G(r,s[1])}d.has(t)||d.set(t,{key:t,...r.reduce((t,r)=>{const s=q(e[r]);return t[r]=G(s,r),t},{})});const a=d.get(t);let l;l=1===s.length?i:`${i}_${o}`,n.forEach(t=>{const r=`${t.field}_${t.aggregation}`;a[l]||(a[l]=0),a[l]+=Number(e[r]||0)})});const p=Array.from(d.values()).map((e,t)=>({...e,key:`row-${t}`})),m=[];a.forEach(e=>{const t=i.get(e);Array.from(t.keys()).sort().forEach(t=>{let r;r=1===s.length?e:`${e}_${t}`,m.push(r)})}),p.forEach(e=>{m.forEach(t=>{t in e||(e[t]=0)}),e["总计"]=m.reduce((t,r)=>t+Number(e[r]||0),0)});const h={};r.forEach(e=>{h[e]="总计"}),n.forEach(e=>{a.forEach(t=>{const r=i.get(t);Array.from(r.keys()).sort().forEach(r=>{let n;n=1===s.length?t:`${t}_${r}`;const i=p.map(e=>e[n]).filter(e=>null!=e),o=i.filter(e=>!isNaN(Number(e)));let a;if(o.length>0)switch(e.aggregation){case"sum":case"count":default:a=o.reduce((e,t)=>e+Number(t),0);break;case"avg":a=o.reduce((e,t)=>e+Number(t),0)/o.length;break;case"max":a=Math.max(...o.map(e=>Number(e)));break;case"min":a=Math.min(...o.map(e=>Number(e)));break;case"count_distinct":a=new Set(i).size}else a=0;h[n]=a})})});let x=0;p.forEach(e=>{x+=Number(e["总计"]||0)}),h["总计"]=x;const f={totalRows:p.length,totalColumns:o[0].length,totalValue:x};return{headers:o[0],headerRows:o,rows:p,totals:h,summary:f}},q=e=>null==e?"null":"string"==typeof e&&e.includes("-")?toBeijingDateStr(e):String(e),G=(e,t)=>{if(null==e)return"null";const r=String(e);if("leads.phone"===t||"phone"===t){if(r.length>=7){return r.substring(0,3)+"*".repeat(r.length-7)+r.substring(r.length-4)}return r}if("leads.wechat"===t||"wechat"===t){if(r.length>=4){return r.substring(0,2)+"*".repeat(r.length-4)+r.substring(r.length-2)}return r}return r},Y=(e,t)=>{h(t),e.dataTransfer.effectAllowed="move"},K=()=>{f(null)},X=()=>{h(null),f(null)},J=(e,t)=>{if(e.preventDefault(),!m)return;let r;switch(r=a?{...a}:{name:"新建透视表",rowFields:[],columnFields:[],valueFields:[],filters:[],sortBy:[]},t){case"rows":r.rowFields.includes(m.name)||r.rowFields.push(m.name);break;case"columns":r.columnFields.includes(m.name)||r.columnFields.push(m.name);break;case"values":r.valueFields.some(e=>e.field===m.name)||r.valueFields.push({field:m.name,aggregation:"count"});break;case"filters":r.filters.some(e=>e.field===m.name)||r.filters.push({field:m.name,operator:V(m.name)?"contains":"equals",value:""})}l(r),h(null),f(null)},Z=(e,t,r)=>{if(!a)return;const{sourceArea:s,index:n}=e,i={...a};if(s===t){const e=Q(i,s),[t]=e.splice(n,1);e.splice(r,0,t),ee(i,s,e)}else{const e=Q(i,s),o=Q(i,t),[a]=e.splice(n,1);ee(i,s,e),o.splice(r,0,a),ee(i,t,o)}l(i)},Q=(e,t)=>{switch(t){case"rows":return e.rowFields;case"columns":return e.columnFields;case"values":return e.valueFields.map(e=>e.field);case"filters":return e.filters.map(e=>e.field);default:return[]}},ee=(e,t,r)=>{switch(t){case"rows":e.rowFields=r;break;case"columns":e.columnFields=r;break;case"values":{const t=r.map(t=>e.valueFields.find(e=>e.field===t)||{field:t,aggregation:"sum"});e.valueFields=t;break}case"filters":{const t=r.map(t=>e.filters.find(e=>e.field===t)||{field:t,operator:"equals",value:""});e.filters=t;break}}},te=async()=>{try{const{data:e,error:t}=await supabase.from("bi_pivot_configs").select("*").order("created_at",{ascending:!1});if(t){if("42P01"!==t.code)throw t;return staticMethods.info("BI透视表配置表不存在，请先创建表。当前可以正常使用透视表功能，但无法保存配置。"),void o([])}o(e||[])}catch(e){staticMethods.error("加载配置失败")}},re=async e=>{try{const{error:t}=await supabase.from("bi_pivot_configs").delete().eq("id",e);if(t){if("42P01"===t.code)return void staticMethods.warning("BI透视表配置表不存在，无法删除配置。");throw t}staticMethods.success("配置删除成功"),te()}catch(t){staticMethods.error("删除配置失败")}},se=e=>{l(e.config),_(!1),C(null),staticMethods.success(`已加载配置: ${e.name}`)};reactExports.useEffect(()=>{te();const e=()=>{h(null),f(null)};return document.addEventListener("dragend",e),()=>{document.removeEventListener("dragend",e)}},[]);const ne=reactExports.useMemo(()=>{if(!c||!c.headers)return[];const e=(null==a?void 0:a.rowFields)||[],t=(null==a?void 0:a.columnFields)||[],r=[];if(e.forEach(e=>{r.push({title:e,dataIndex:e,key:e,width:150,fixed:"left",render:(t,r)=>{if(null==t)return"";if("null"===t)return"null";if("totals"===r.key)return"总计"===t?"总计":"number"==typeof t?t.toLocaleString():t;if(TIME_FIELDS.some(t=>e.includes(t))&&t&&"0"!==t&&"空值"!==t){return formatTimeField(t)}return"number"==typeof t?t.toLocaleString():t}})}),t.length>0&&c.headerRows&&c.headerRows.length>1){if(t.length>1){const t=c.headerRows,s=t[0],n=t[1],i=s.slice(e.length,-1),o=n.slice(e.length,-1),a=new Map;for(let e=0;e<i.length;e++){const t=i[e],r=o[e];a.has(t)||a.set(t,new Set),a.get(t).add(r)}Array.from(a.keys()).sort().forEach(e=>{const t=Array.from(a.get(e)||[]).sort();if(1===t.length){const s=t[0],n=`${e}_${s}`;r.push({title:e,dataIndex:n,key:n,width:120,render:e=>{if(null==e)return"";return"number"==typeof e?e.toLocaleString():e}})}else{const s=t.map(t=>{const r=`${e}_${t}`;return{title:t,dataIndex:r,key:r,width:120,render:e=>{if(null==e)return"";return"number"==typeof e?e.toLocaleString():e}}});r.push({title:e,children:s})}})}else{c.headers.filter(t=>!e.includes(t)&&"总计"!==t).forEach(e=>{r.push({title:e,dataIndex:e,key:e,width:120,render:e=>{if(null==e)return"";return"number"==typeof e?e.toLocaleString():e}})})}}else{c.headers.filter(t=>!e.includes(t)&&"总计"!==t).forEach(e=>{r.push({title:e,dataIndex:e,key:e,width:120,render:e=>{if(null==e)return"";return"number"==typeof e?e.toLocaleString():e}})})}return r.push({title:"总计",dataIndex:"总计",key:"总计",width:120,fixed:"right",render:(e,t)=>t["总计"]}),r},[c,a]),ie=reactExports.useMemo(()=>{if(!c)return[];const e=c.rows.map((e,t)=>{let r=e["总计"];return null==r&&(r=0,(null==a?void 0:a.valueFields)&&a.valueFields.forEach(t=>{const s=`${t.field}_${t.aggregation}`,n=e[s];if(null!=n){const e=Number(n);isNaN(e)||(r+=e)}})),{key:`row-${t}`,...e,"总计":r}});if(c.totals&&Object.keys(c.totals).length>0){let t=0;(null==a?void 0:a.valueFields)&&a.valueFields.forEach(e=>{const r=`${e.field}_${e.aggregation}`,s=c.totals[r];if(null!=s){const e=Number(s);isNaN(e)||(t+=e)}});const r={key:"totals",...c.totals,"总计":t};e.push(r)}return e},[c,a]),oe=reactExports.useMemo(()=>{var e;if(!c||!a)return{x:"max-content"};return((null==(e=a.rowFields)?void 0:e.length)||0)>0?{x:"max-content",y:400}:{x:"max-content"}},[c,a]),ae=(e,t,r,s)=>{const n=x===e;return jsxRuntimeExports.jsxs("div",{className:"drop-zone "+(n?"drag-over":""),onDragOver:t=>{t.preventDefault(),((e,t)=>{e.preventDefault(),f(t)})(t,e)},onDragLeave:K,onDrop:t=>{t.preventDefault();try{const s=JSON.parse(t.dataTransfer.getData("text/plain"));"config-field"===s.type?Z(s,e,r.length):J(t,e)}catch(s){J(t,e)}},style:{border:"1px solid #e8e8e8",borderRadius:"4px",padding:"8px 12px",minHeight:"60px",backgroundColor:n?"#f0f8ff":"#fafafa",transition:"all 0.2s ease",marginBottom:"8px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"6px",fontSize:"12px"},children:[s,jsxRuntimeExports.jsx(Text$5,{strong:!0,style:{marginLeft:"6px",fontSize:"12px"},children:t})]}),r.length>0?jsxRuntimeExports.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:r.map((t,r)=>{var s,n;const i=g.find(e=>e.name===t),o=null==(s=null==a?void 0:a.filters)?void 0:s.find(e=>e.field===t),c=null==(n=null==a?void 0:a.valueFields)?void 0:n.find(e=>e.field===t);return jsxRuntimeExports.jsxs(Tag$1,{closable:!0,onClose:()=>((e,t)=>{if(!a)return;const r={...a};switch(e){case"rows":r.rowFields=r.rowFields.filter(e=>e!==t);break;case"columns":r.columnFields=r.columnFields.filter(e=>e!==t);break;case"values":r.valueFields=r.valueFields.filter(e=>e.field!==t);break;case"filters":r.filters=r.filters.filter(e=>e.field!==t)}l(r)})(e,t),className:"field-tag",draggable:!0,onDragStart:s=>{s.dataTransfer.setData("text/plain",JSON.stringify({type:"config-field",sourceArea:e,field:t,index:r}))},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.opacity="0.5"},onDragLeave:e=>{e.currentTarget.style.opacity="1"},onDrop:t=>{t.preventDefault(),t.currentTarget.style.opacity="1";try{const s=JSON.parse(t.dataTransfer.getData("text/plain"));"config-field"===s.type&&Z(s,e,r)}catch(s){console.error("处理拖拽数据失败:",s)}},style:{cursor:"grab",backgroundColor:"filters"===e&&((null==o?void 0:o.value)||"date_between"===(null==o?void 0:o.operator)||"is_null"===(null==o?void 0:o.operator)||"is_not_null"===(null==o?void 0:o.operator)||"contains"===(null==o?void 0:o.operator)||"not_contains"===(null==o?void 0:o.operator))||"values"===e&&(null==c?void 0:c.aggregation)?"#f0f8ff":"#fafafa",border:"1px solid #e8e8e8",borderRadius:"4px",padding:"4px 8px",fontSize:"11px",margin:"2px 0",transition:"all 0.2s ease"},onClick:"filters"===e?()=>{const e=o||{field:t,operator:"equals",value:""};"date_between"===(null==o?void 0:o.operator)&&o.value&&o.value2&&(e.dateRange=[o.value,o.value2]),e.operator||(e.operator="equals"),A(e),I(!0)}:"values"===e?()=>{N(c||{field:t,aggregation:"sum"}),D(!0)}:void 0,children:[(null==i?void 0:i.label)||t,"filters"===e&&((null==o?void 0:o.value)||"date_between"===(null==o?void 0:o.operator)||"is_null"===(null==o?void 0:o.operator)||"is_not_null"===(null==o?void 0:o.operator)||"contains"===(null==o?void 0:o.operator)||"not_contains"===(null==o?void 0:o.operator))&&jsxRuntimeExports.jsxs("span",{style:{marginLeft:4,fontSize:"10px",color:"#666"},children:["(","date_between"===o.operator?"日期范围":"equals"===o.operator?"等于":"not_equals"===o.operator?"不等于":"contains"===o.operator?"包含":"not_contains"===o.operator?"不包含":"greater_than"===o.operator?"大于":"less_than"===o.operator?"小于":"between"===o.operator?"介于":"is_null"===o.operator?"为空":"is_not_null"===o.operator?"不为空":o.operator,": ","date_between"===o.operator?formatDateRange(o.value,o.value2):"between"===o.operator?`${o.value} ~ ${o.value2}`:"is_null"===o.operator||"is_not_null"===o.operator?"":("contains"===o.operator||"not_contains"===o.operator)&&o.value&&o.value.length>20?`${o.value.substring(0,20)}...`:o.value,")"]}),"values"===e&&(null==c?void 0:c.aggregation)&&jsxRuntimeExports.jsxs("span",{style:{marginLeft:4,fontSize:"10px",color:"#666"},children:["(","sum"===c.aggregation?"求和":"count"===c.aggregation?"计数":"count_distinct"===c.aggregation?"去重计数":"avg"===c.aggregation?"平均值":"max"===c.aggregation?"最大值":"min"===c.aggregation?"最小值":c.aggregation,")"]})]},t)})}):jsxRuntimeExports.jsx(Text$5,{type:"secondary",style:{fontSize:"12px"},children:"rows"===e?"拖拽字段到行维度区域":"columns"===e?"拖拽字段到列维度区域":"values"===e?"拖拽字段到值字段区域（支持所有聚合方式）":"拖拽字段到此区域"})]})},le=e=>{try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",t.style.opacity="0",t.style.pointerEvents="none",t.style.zIndex="-1",document.body.appendChild(t),t.focus(),t.select();const r=document.execCommand("copy");document.body.removeChild(t),r?staticMethods.success("数据已复制到剪贴板，可直接粘贴到Excel"):staticMethods.error("复制失败，请手动复制数据")}catch(t){staticMethods.error("复制失败，请手动复制数据")}},ce=(e,t)=>{try{const r=document.createElement("a");r.href=e,r.download=t,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",r.style.opacity="0",r.style.pointerEvents="none",r.style.zIndex="-1",document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(e)},100)}catch(r){staticMethods.error("下载失败，请重试")}};return s?jsxRuntimeExports.jsx(LoadingScreen,{type:"data"}):jsxRuntimeExports.jsxs("div",{className:"page-card",children:[jsxRuntimeExports.jsx("style",{children:pivotTableStyles}),m&&jsxRuntimeExports.jsxs("div",{className:"drag-hint show",children:['拖拽 "',m.label,'" 到目标区域']}),jsxRuntimeExports.jsx("div",{className:"flex justify-between items-center mb-6",children:jsxRuntimeExports.jsx(Title$4,{level:4,className:"ml-[-10px] mt-[10px] font-bold text-gray-800",children:"数据分析"})}),jsxRuntimeExports.jsx(Alert,{description:"每个线索只显示最新的看房和成交记录。如果数据与预期不符，可能是因为线索有多个记录只显示最新一条，或某些记录被标记为无效。",type:"info",showIcon:!0,style:{marginBottom:8,padding:"6px 12px"},message:null}),jsxRuntimeExports.jsx(Tabs,{activeKey:d,onChange:p,items:[{key:"pivot",label:"透视表",children:jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:15,children:jsxRuntimeExports.jsx(Card$1,{title:"透视表结果",className:"result-panel",styles:{header:{background:"transparent",borderBottom:"1px solid #e8e8e8",padding:"8px 12px"},body:{padding:"8px 12px"}},children:c?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon,{}),onClick:()=>{if(c)try{let e="";const t=c.headerRows&&c.headerRows.length>0,r=(null==a?void 0:a.columnFields)&&a.columnFields.length>1;if(t&&c.headerRows&&r?c.headerRows.forEach(t=>{e+=t.map(e=>e||"").join("\t")+"\n"}):e+=c.headers.map(e=>e||"").join("\t")+"\n",c.rows.forEach(s=>{const n=[],i=(null==a?void 0:a.rowFields)||[];if(i.forEach(e=>{const t=s[e];n.push(null==t?"":String(t))}),t&&c.headerRows&&c.headerRows.length>1&&r){const e=c.headerRows[0],t=c.headerRows[1],r=e.slice(i.length,-1),o=t.slice(i.length,-1);for(let i=0;i<r.length;i++){const e=r[i],t=o[i],a=s[`${e}_${t}`];n.push(null==a?"":String(a))}}else{c.headers.filter(e=>!i.includes(e)&&"总计"!==e).forEach(e=>{const t=s[e];if(null==t)n.push("");else{const e=String(t);n.push(e.replace(/\n/g," ").replace(/\r/g,""))}})}const o=s["总计"];n.push(null==o?"":String(o)),e+=n.join("\t")+"\n"}),c.totals&&Object.keys(c.totals).length>0){const s=[],n=(null==a?void 0:a.rowFields)||[];if(n.forEach(e=>{const t=c.totals[e];s.push(null==t?"":String(t))}),t&&c.headerRows&&c.headerRows.length>1&&r){const e=c.headerRows[0],t=c.headerRows[1],r=e.slice(n.length,-1),i=t.slice(n.length,-1);for(let n=0;n<r.length;n++){const e=r[n],t=`${e}_${i[n]}`,o=c.totals[t];s.push(null==o?"":String(o))}}else{c.headers.filter(e=>!n.includes(e)&&"总计"!==e).forEach(e=>{const t=c.totals[e];if(null==t)s.push("");else{const e=String(t);s.push(e.replace(/\n/g," ").replace(/\r/g,""))}})}const i=c.totals["总计"];s.push(null==i?"":String(i)),e+=s.join("\t")+"\n"}navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{staticMethods.success("数据已复制到剪贴板，可直接粘贴到Excel中")}).catch(()=>{le(e)}):le(e)}catch(e){staticMethods.error("复制失败，请重试")}else staticMethods.warning("没有可复制的数据")},disabled:!c,title:"复制数据到剪贴板，可直接粘贴到Excel",children:"复制数据"}),jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$10,{}),onClick:()=>{if(c)try{let e="";const t=(null==a?void 0:a.columnFields)&&a.columnFields.length>1;if(c.headerRows&&c.headerRows.length>1&&t?c.headerRows.forEach(t=>{e+=t.map(e=>`"${e}"`).join(",")+"\n"}):e+=c.headers.map(e=>`"${e}"`).join(",")+"\n",c.rows.forEach(t=>{const r=(null==a?void 0:a.columnFields)&&a.columnFields.length>1;if(c.headerRows&&c.headerRows.length>1&&r){const r=[],s=(null==a?void 0:a.rowFields)||[];s.forEach(e=>{const s=t[e];r.push(null==s?'""':`"${String(s)}"`)});const n=c.headerRows[0],i=c.headerRows[1],o=n.slice(s.length,-1),l=i.slice(s.length,-1);for(let e=0;e<o.length;e++){const s=o[e],n=l[e],i=t[`${s}_${n}`];if(null==i)r.push('""');else{const e=String(i);r.push(`"${e}"`)}}const u=t["总计"];r.push(null==u?'""':`"${String(u)}"`),e+=r.join(",")+"\n"}else{const r=[],s=(null==a?void 0:a.rowFields)||[];s.forEach(e=>{const s=t[e];r.push(null==s?'""':`"${String(s)}"`)});c.headers.filter(e=>!s.includes(e)&&"总计"!==e).forEach(e=>{const s=t[e];if(null==s)r.push('""');else{const e=String(s);r.push(`"${e}"`)}});const n=t["总计"];r.push(null==n?'""':`"${String(n)}"`),e+=r.join(",")+"\n"}}),c.totals&&Object.keys(c.totals).length>0){const t=(null==a?void 0:a.columnFields)&&a.columnFields.length>1;if(c.headerRows&&c.headerRows.length>1&&t){const t=[],r=(null==a?void 0:a.rowFields)||[];r.forEach(e=>{const r=c.totals[e];t.push(null==r?'""':`"${String(r)}"`)});const s=c.headerRows[0],n=c.headerRows[1],i=s.slice(r.length,-1),o=n.slice(r.length,-1);for(let e=0;e<i.length;e++){const r=i[e],s=`${r}_${o[e]}`,n=c.totals[s];t.push(null==n?'""':`"${String(n)}"`)}const l=c.totals["总计"];t.push(null==l?'""':`"${String(l)}"`),e+=t.join(",")+"\n"}else{const t=[],r=(null==a?void 0:a.rowFields)||[];r.forEach(e=>{const r=c.totals[e];t.push(null==r?'""':`"${String(r)}"`)});c.headers.filter(e=>!r.includes(e)&&"总计"!==e).forEach(e=>{const r=c.totals[e];if(null==r)t.push('""');else{const e=String(r);t.push(`"${e}"`)}});const s=c.totals["总计"];t.push(null==s?'""':`"${String(s)}"`),e+=t.join(",")+"\n"}}const r=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),n=toBeijingDateStr(dayjs()).replace(/[-:]/g,"_"),i=(null==a?void 0:a.name)||"pivot_data";ce(s,`${i}_${n}.csv`),staticMethods.success("数据已下载为CSV文件")}catch(e){staticMethods.error("下载数据失败")}else staticMethods.warning("没有可下载的数据")},disabled:!c,title:"下载数据为CSV文件",children:"下载CSV"})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:ne,dataSource:ie,pagination:!1,size:"small",bordered:!0,className:"pivot-table",scroll:oe,rowClassName:e=>"totals"===e.key?"totals-row":""})]}):jsxRuntimeExports.jsxs("div",{className:"empty-state",children:[jsxRuntimeExports.jsx(RefIcon$11,{}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Text$5,{type:"secondary",children:"请先配置并执行透视表"})})]})})}),jsxRuntimeExports.jsx(Col,{span:9,children:jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsxs(Card$1,{title:"可用字段",size:"small",className:"field-panel",styles:{header:{background:"transparent",borderBottom:"1px solid #e8e8e8",padding:"8px 12px"},body:{padding:"8px 12px"}},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:8},children:jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"搜索字段...",size:"small",allowClear:!0,style:{fontSize:"11px"},value:L,onChange:e=>{z(e.target.value)}})}),jsxRuntimeExports.jsx(Tabs,{size:"small",type:"card",tabBarGutter:2,tabBarStyle:{marginBottom:8,fontSize:"11px"},hideAdd:!0,moreIcon:null,tabBarExtraContent:null,destroyOnHidden:!1,className:"no-more-tabs",items:[{key:"all",label:"全部",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.filter(e=>""===L||e.label.toLowerCase().includes(L.toLowerCase())||e.name.toLowerCase().includes(L.toLowerCase())).map(e=>jsxRuntimeExports.jsx("div",{draggable:!0,onDragStart:t=>Y(t,e),onDragEnd:X,className:"draggable-field",style:{padding:"8px 12px",border:"1px solid #e8e8e8",margin:"3px 0",borderRadius:"4px",backgroundColor:"#fafafa",display:"block",fontSize:"12px",cursor:"grab",transition:"all 0.2s ease",textAlign:"left"},children:jsxRuntimeExports.jsxs("div",{style:{lineHeight:"1.4"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",color:"#333",marginBottom:"2px"},children:e.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#666",marginBottom:"1px"},children:e.name}),jsxRuntimeExports.jsx("div",{style:{fontSize:"9px",color:"#999"},children:e.table})]})},e.name))})},{key:"leads",label:"线索",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.filter(e=>"leads"===e.table).filter(e=>""===L||e.label.toLowerCase().includes(L.toLowerCase())||e.name.toLowerCase().includes(L.toLowerCase())).map(e=>jsxRuntimeExports.jsx("div",{draggable:!0,onDragStart:t=>Y(t,e),onDragEnd:X,className:"draggable-field",style:{padding:"8px 12px",border:"1px solid #e8e8e8",margin:"3px 0",borderRadius:"4px",backgroundColor:"#fafafa",display:"block",fontSize:"12px",cursor:"grab",transition:"all 0.2s ease",textAlign:"left"},children:jsxRuntimeExports.jsxs("div",{style:{lineHeight:"1.4"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",color:"#333",marginBottom:"2px"},children:e.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#666"},children:e.name})]})},e.name))})},{key:"followups",label:"跟进",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.filter(e=>"followups"===e.table).filter(e=>""===L||e.label.toLowerCase().includes(L.toLowerCase())||e.name.toLowerCase().includes(L.toLowerCase())).map(e=>jsxRuntimeExports.jsx("div",{draggable:!0,onDragStart:t=>Y(t,e),onDragEnd:X,className:"draggable-field",style:{padding:"8px 12px",border:"1px solid #e8e8e8",margin:"3px 0",borderRadius:"4px",backgroundColor:"#fafafa",display:"block",fontSize:"12px",cursor:"grab",transition:"all 0.2s ease",textAlign:"left"},children:jsxRuntimeExports.jsxs("div",{style:{lineHeight:"1.4"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",color:"#333",marginBottom:"2px"},children:e.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#666"},children:e.name})]})},e.name))})},{key:"showings",label:"看房",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.filter(e=>"showings"===e.table).filter(e=>""===L||e.label.toLowerCase().includes(L.toLowerCase())||e.name.toLowerCase().includes(L.toLowerCase())).map(e=>jsxRuntimeExports.jsx("div",{draggable:!0,onDragStart:t=>Y(t,e),onDragEnd:X,className:"draggable-field",style:{padding:"8px 12px",border:"1px solid #e8e8e8",margin:"3px 0",borderRadius:"4px",backgroundColor:"#fafafa",display:"block",fontSize:"12px",cursor:"grab",transition:"all 0.2s ease",textAlign:"left"},children:jsxRuntimeExports.jsxs("div",{style:{lineHeight:"1.4"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",color:"#333",marginBottom:"2px"},children:e.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#666"},children:e.name})]})},e.name))})},{key:"deals",label:"成交",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.filter(e=>"deals"===e.table).filter(e=>""===L||e.label.toLowerCase().includes(L.toLowerCase())||e.name.toLowerCase().includes(L.toLowerCase())).map(e=>jsxRuntimeExports.jsx("div",{draggable:!0,onDragStart:t=>Y(t,e),onDragEnd:X,className:"draggable-field",style:{padding:"8px 12px",border:"1px solid #e8e8e8",margin:"3px 0",borderRadius:"4px",backgroundColor:"#fafafa",display:"block",fontSize:"12px",cursor:"grab",transition:"all 0.2s ease",textAlign:"left"},children:jsxRuntimeExports.jsxs("div",{style:{lineHeight:"1.4"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",color:"#333",marginBottom:"2px"},children:e.label}),jsxRuntimeExports.jsx("div",{style:{fontSize:"10px",color:"#666"},children:e.name})]})},e.name))})}]})]})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsxs(Card$1,{title:"透视表配置",size:"small",className:"config-panel",styles:{header:{background:"transparent",borderBottom:"1px solid #e8e8e8",padding:"8px 12px"},body:{padding:"8px 0px"}},children:[ae("rows","行维度",(null==a?void 0:a.rowFields)||[],jsxRuntimeExports.jsx(RefIcon$11,{})),ae("columns","列维度",(null==a?void 0:a.columnFields)||[],jsxRuntimeExports.jsx(RefIcon$11,{})),ae("values","值字段",(null==a?void 0:a.valueFields.map(e=>e.field))||[],jsxRuntimeExports.jsx(RefIcon$x,{})),ae("filters","筛选条件",(null==a?void 0:a.filters.map(e=>e.field))||[],jsxRuntimeExports.jsx(RefIcon$12,{})),jsxRuntimeExports.jsx("div",{style:{marginTop:12},children:jsxRuntimeExports.jsxs("div",{className:"action-buttons",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>a&&(async e=>{n(!0);try{let t;t=e.columnFields&&e.columnFields.length>1?{p_data_source:"joined_data",p_row_fields:e.rowFields,p_column_fields:e.columnFields,p_value_fields:e.valueFields,p_filters:e.filters,p_show_totals:!0}:{p_data_source:"joined_data",p_row_fields:e.rowFields,p_column_fields:e.columnFields,p_value_fields:e.valueFields,p_filters:e.filters};const r="execute_multi_level_pivot_analysis",{data:s,error:n}=await supabase.rpc(r,t);if(n)return void staticMethods.error("透视表计算失败: "+n.message);if(s){if(s.error)return void staticMethods.error("透视表计算失败: "+s.error);if(s.result){const t=U(s,e);u(t),staticMethods.success("透视表计算完成")}else staticMethods.error("透视表计算失败: 无效的返回数据")}else staticMethods.error("透视表计算失败: 无效的返回数据")}catch(t){staticMethods.error("透视表计算失败")}finally{n(!1)}})(a),disabled:!a,size:"small",style:{fontSize:"12px",height:"30px",borderRadius:"4px"},title:a?"点击执行透视表分析":"请先拖拽字段到配置区域",children:"执行透视表"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>l(null),size:"small",style:{fontSize:"12px",height:"30px",borderRadius:"4px"},children:"清空配置"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>{a&&(b(null),E(!0))},size:"small",style:{fontSize:"12px",height:"30px",borderRadius:"4px"},children:"保存配置"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>_(!0),size:"small",style:{fontSize:"12px",height:"30px",borderRadius:"4px"},children:"读取配置"})]})})]})})]})})]})},{key:"saved",label:"保存的配置",children:jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx(ForwardTable,{dataSource:i,columns:[{title:"配置名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"行维度",dataIndex:"config",key:"row_fields",render:(e,t)=>{var r;const s=t.config;return(null==(r=null==s?void 0:s.rowFields)?void 0:r.join(", "))||"-"}},{title:"列维度",dataIndex:"config",key:"column_fields",render:(e,t)=>{var r;const s=t.config;return(null==(r=null==s?void 0:s.columnFields)?void 0:r.join(", "))||"-"}},{title:"值字段",dataIndex:"config",key:"value_fields",render:(e,t)=>{var r;const s=t.config;return(null==(r=null==s?void 0:s.valueFields)?void 0:r.map(e=>`${e.field}(${e.aggregation})`).join(", "))||"-"}},{title:"创建时间",dataIndex:"created_at",key:"created_at",render:e=>dayjs(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"actions",render:(e,t)=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$6,{}),onClick:()=>{t.config&&(l(t.config),p("pivot"))},children:"使用"}),jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>{b(t.config),E(!0)},children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),onClick:()=>re(t.id||""),children:"删除"})]})}],rowKey:"id",pagination:{pageSize:10}})})}]}),jsxRuntimeExports.jsx(Modal$2,{title:j?"编辑透视表配置":"保存透视表配置",open:v,onCancel:()=>E(!1),footer:null,children:jsxRuntimeExports.jsxs(Form$4,{form:w,layout:"vertical",initialValues:j||{},onFinish:async e=>{if(a){const t={...a,...e};await(async e=>{var t;try{if(!r)return staticMethods.error("用户信息获取失败"),null;const{data:s,error:n}=await supabase.from("bi_pivot_configs").insert([{name:e.name,description:e.description,config:e,data_source:"joined_data",created_by:r.id}]).select();if(n){if("42P01"===n.code)return staticMethods.warning("BI透视表配置表不存在，无法保存配置。请先创建表。"),null;throw n}return staticMethods.success("配置保存成功"),te(),null==(t=null==s?void 0:s[0])?void 0:t.id}catch(s){staticMethods.error("保存配置失败")}})(t),E(!1),b(null),w.resetFields()}},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"name",label:"配置名称",rules:[{required:!0,message:"请输入配置名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入配置名称"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"配置描述",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入配置描述"})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"保存"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>E(!1),children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:"读取透视表配置",open:R,onCancel:()=>_(!1),footer:null,width:600,className:"load-config-modal",children:jsxRuntimeExports.jsx("div",{style:{maxHeight:500,overflowY:"auto"},children:i.length>0?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:jsxRuntimeExports.jsx(Input$1.Search,{placeholder:"搜索配置名称、描述或字段...",allowClear:!0,value:k,onChange:e=>$(e.target.value),style:{width:"100%"}})}),jsxRuntimeExports.jsx("div",{style:{display:"grid",gap:"8px"},children:(()=>{const e=i.filter(e=>{var t,r,s;if(!k)return!0;const n=k.toLowerCase();return e.name.toLowerCase().includes(n)||e.description&&e.description.toLowerCase().includes(n)||(null==(t=e.config.rowFields)?void 0:t.some(e=>e.toLowerCase().includes(n)))||(null==(r=e.config.columnFields)?void 0:r.some(e=>e.toLowerCase().includes(n)))||(null==(s=e.config.valueFields)?void 0:s.some(e=>e.field.toLowerCase().includes(n)))});return 0===e.length?jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"20px"},children:[jsxRuntimeExports.jsx("div",{style:{color:"#666",marginBottom:"8px"},children:k?"未找到匹配的配置":"暂无保存的配置"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999"},children:k?"请尝试其他搜索关键词":"请先保存一些透视表配置"})]}):e.map(e=>jsxRuntimeExports.jsx(Card$1,{size:"small",onClick:()=>se(e),className:"config-card "+((null==S?void 0:S.id)===e.id?"selected":""),style:{cursor:"pointer",padding:"8px 12px"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsxs("div",{style:{flex:1,minWidth:0},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",marginBottom:"4px",color:"#333",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),jsxRuntimeExports.jsx("div",{style:{fontSize:"11px",color:"#666",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description||"无描述"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"6px",marginLeft:"8px",flexShrink:0},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$6,{}),onClick:t=>{t.stopPropagation(),se(e)},style:{fontSize:"11px",height:"28px",padding:"0 8px"},children:"加载"}),jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:t=>{t.stopPropagation(),b(e.config),E(!0),_(!1)},style:{fontSize:"11px",height:"28px",padding:"0 8px"},children:"编辑"}),jsxRuntimeExports.jsx(Button$1,{size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{}),onClick:t=>{t.stopPropagation(),re(e.id||"")},style:{fontSize:"11px",height:"28px",padding:"0 8px"},children:"删除"})]})]})},e.id))})()})]}):jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 20px"},children:[jsxRuntimeExports.jsx(RefIcon$11,{style:{fontSize:"48px",color:"#d9d9d9",marginBottom:"16px"}}),jsxRuntimeExports.jsx("div",{style:{color:"#666"},children:"暂无保存的配置"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"8px"},children:"请先保存一些透视表配置"})]})})}),jsxRuntimeExports.jsx(Modal$2,{title:"配置值字段聚合",open:M,onCancel:()=>D(!1),footer:null,children:jsxRuntimeExports.jsxs(Form$4,{form:B,layout:"vertical",initialValues:O||{},onFinish:e=>{if(a&&O){const t={...a},r=t.valueFields.findIndex(e=>e.field===O.field);r>=0?t.valueFields[r]={...t.valueFields[r],...e}:t.valueFields.push({field:O.field,aggregation:e.aggregation}),l(t),D(!1),N(null),B.resetFields()}},children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"aggregation",label:"聚合方式",rules:[{required:!0,message:"请选择聚合方式"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择聚合方式",children:[jsxRuntimeExports.jsx(Option$3,{value:"sum",children:"求和 (Sum)"}),jsxRuntimeExports.jsx(Option$3,{value:"count",children:"计数 (Count)"}),jsxRuntimeExports.jsx(Option$3,{value:"count_distinct",children:"去重计数 (Count Distinct)"}),jsxRuntimeExports.jsx(Option$3,{value:"avg",children:"平均值 (Average)"}),jsxRuntimeExports.jsx(Option$3,{value:"max",children:"最大值 (Max)"}),jsxRuntimeExports.jsx(Option$3,{value:"min",children:"最小值 (Min)"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"format",label:"显示格式",children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择显示格式（可选）",children:[jsxRuntimeExports.jsx(Option$3,{value:"number",children:"数字"}),jsxRuntimeExports.jsx(Option$3,{value:"percentage",children:"百分比"}),jsxRuntimeExports.jsx(Option$3,{value:"currency",children:"货币"}),jsxRuntimeExports.jsx(Option$3,{value:"decimal",children:"小数"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:"确定"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>D(!1),children:"取消"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(RefIcon$12,{}),jsxRuntimeExports.jsx("span",{children:"配置筛选条件"}),P&&jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{marginLeft:"auto"},children:(null==(e=g.find(e=>e.name===P.field))?void 0:e.label)||P.field})]}),open:T,onCancel:()=>I(!1),footer:null,width:500,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:F,layout:"vertical",initialValues:{...P,dateRange:"date_between"===(null==P?void 0:P.operator)&&(null==P?void 0:P.value)&&(null==P?void 0:P.value2)?[P.value,P.value2]:void 0,operator:(null==P?void 0:P.operator)||(P&&V(P.field)?"contains":"equals")},onFinish:e=>{if(a&&P){const t={...a},r=t.filters.findIndex(e=>e.field===P.field),s={...e};"date_between"===e.operator&&e.dateRange&&(s.value=e.dateRange[0],s.value2=e.dateRange[1],delete s.dateRange);const n={field:P.field,operator:s.operator,value:s.value,value2:s.value2};r>=0?t.filters[r]=n:t.filters.push(n),l(t),I(!1),A(null),F.resetFields()}},children:[P&&jsxRuntimeExports.jsx(Alert,{message:`正在配置字段：${(null==(t=g.find(e=>e.name===P.field))?void 0:t.label)||P.field}`,type:"info",showIcon:!0,style:{marginBottom:16}}),jsxRuntimeExports.jsx(Form$4.Item,{name:"operator",label:"筛选操作符",rules:[{required:!0,message:"请选择筛选操作符"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"选择筛选操作符",size:"large",onChange:e=>{"date_between"===e?F.setFieldsValue({value:void 0,value2:void 0}):"between"===e?F.setFieldsValue({dateRange:void 0}):"is_null"===e||"is_not_null"===e?F.setFieldsValue({value:void 0,value2:void 0,dateRange:void 0}):F.setFieldsValue({value2:void 0,dateRange:void 0})},children:[jsxRuntimeExports.jsx(Option$3,{value:"equals",children:"等于"}),jsxRuntimeExports.jsx(Option$3,{value:"not_equals",children:"不等于"}),jsxRuntimeExports.jsx(Option$3,{value:"contains",children:"包含"}),jsxRuntimeExports.jsx(Option$3,{value:"not_contains",children:"不包含"}),jsxRuntimeExports.jsx(Option$3,{value:"greater_than",children:"大于"}),jsxRuntimeExports.jsx(Option$3,{value:"less_than",children:"小于"}),jsxRuntimeExports.jsx(Option$3,{value:"between",children:"介于"}),jsxRuntimeExports.jsx(Option$3,{value:"date_between",children:"日期范围"}),jsxRuntimeExports.jsx(Option$3,{value:"is_null",children:"为空"}),jsxRuntimeExports.jsx(Option$3,{value:"is_not_null",children:"不为空"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{dependencies:["operator"],noStyle:!0,children:({getFieldValue:e})=>{const t=e("operator"),r=P&&V(P.field);return"date_between"===t?jsxRuntimeExports.jsx(Form$4.Item,{name:"dateRange",label:"日期范围",rules:[{required:!0,message:"请选择日期范围"}],children:jsxRuntimeExports.jsx(RangePicker,{style:{width:"100%"},placeholder:["开始日期","结束日期"],format:"YYYY-MM-DD",allowClear:!0,size:"large"})}):"between"===t?jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"value",label:"最小值",rules:[{required:!0,message:"请输入最小值"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入最小值",size:"large"})})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Form$4.Item,{name:"value2",label:"最大值",rules:[{required:!0,message:"请输入最大值"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入最大值",size:"large"})})})]}):"is_null"===t||"is_not_null"===t?jsxRuntimeExports.jsx(Alert,{message:"is_null"===t?"将筛选出空值记录":"将筛选出非空值记录",type:"success",showIcon:!0,style:{marginBottom:16}}):"contains"===t||"not_contains"===t?jsxRuntimeExports.jsx(Form$4.Item,{name:"value",label:"筛选值",rules:[{required:!0,message:"请输入筛选值"}],extra:r?"支持多个人员名称，用逗号分隔。例如：张三,李四":"支持多个值，用逗号分隔。例如：值1,值2,值3",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:r?"请输入人员名称，多个名称用逗号分隔":"请输入筛选值，多个值用逗号分隔",size:"large",style:{width:"100%"},rows:3,showCount:!0,maxLength:500})}):t&&"date_between"!==t&&"between"!==t&&"is_null"!==t&&"is_not_null"!==t&&"contains"!==t&&"not_contains"!==t?jsxRuntimeExports.jsx(Form$4.Item,{name:"value",label:"筛选值",rules:[{required:!0,message:"请输入筛选值"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:r?"请输入人员名称":"请输入筛选值",size:"large",style:{width:"100%"}})}):jsxRuntimeExports.jsx(Alert,{message:"请先选择筛选操作符",type:"info",showIcon:!0,style:{marginBottom:16}})}}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginTop:24,marginBottom:0},children:jsxRuntimeExports.jsxs(Row,{gutter:16,children:[jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",size:"large",style:{width:"100%"},children:"确定"})}),jsxRuntimeExports.jsx(Col,{span:12,children:jsxRuntimeExports.jsx(Button$1,{onClick:()=>I(!1),size:"large",style:{width:"100%"},children:"取消"})})]})})]})})]})},{Title:Title$3,Paragraph:Paragraph,Text:Text$4}=Typography,{TextArea:TextArea$2}=Input$1,{Panel:Panel}=Collapse,OnboardingPage=()=>{const[e,t]=reactExports.useState(null),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(!0),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState({}),[u,d]=reactExports.useState(0),[p,m]=reactExports.useState(0),[h,x]=reactExports.useState(new Set),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState([]),[E,j]=reactExports.useState(0),[b,w]=reactExports.useState(900),[R,_]=reactExports.useState(null),[S,C]=reactExports.useState([]),[k,$]=reactExports.useState(null),T=[{id:"1-1",module:"1",moduleTitle:"新人期基础",type:"single",title:"新人期针对入职多少天内的新人？",options:["15","30","45","60"],answer:"B",keywords:"30天",explanation:"新人期是公司针对新入职员工的特殊培训阶段，目的是帮助新人快速上手。根据政策，新人期覆盖入职后的30天内，之后将进入常规考核。选项B正确。"},{id:"1-2",module:"1",moduleTitle:"新人期基础",type:"single",title:"新人期完成任务可获得什么奖励？",options:["现金","积分","奖品","荣誉证书"],answer:"B",keywords:"积分奖励",explanation:"在新人期内，完成任务的主要激励是积分奖励，而非现金或其他形式。积分可用于兑换线索等资源，帮助新人积累初始资源。选项B正确。"},{id:"1-3",module:"1",moduleTitle:"新人期基础",type:"multiple",title:"新人期获得积分的前置条件包括哪些？",options:["政策考试通过","销讲通过","微聊答题通过","完成视频模拟直播考核"],answer:["A","B","C"],keywords:"政策考试、销讲、微聊答题",explanation:"新人获得积分前必须满足三个前置条件：通过政策考试（确保了解公司规则）、通过销讲（销售演讲能力考核）、以及通过微聊答题（在线沟通技能测试）。选项D是额外任务，非前置条件，因此正确答案是A、B、C。"},{id:"1-4",module:"1",moduleTitle:"新人期基础",type:"single",title:"新人期的新媒体积分加分和绩效提报方式是？",options:["每周提报链接","联系片区市场运营","新媒体沟通群内提报","以上都不是"],answer:"A",keywords:"每周链接",explanation:"新人期任务提报需通过公司提供的每周专用链接进行，这确保数据统一管理和跟踪。其他选项如联系运营或在群内提报，仅作为补充方式，非主要途径。选项A正确。"},{id:"1-5",module:"1",moduleTitle:"新人期基础",type:"multiple",title:"小红书提报加分的要求是？",options:["完成3个账号的发帖","内容符合获客要求","核查时内容不违规","一个账号发满5条帖子"],answer:["A","B","C"],keywords:"3个账号发帖、内容符合要求、内容不违规",explanation:"小红书提报加分需要同时满足多个要求：A（完成3个账号的发帖是基础要求）、B（内容必须符合获客要求）、C（核查时内容不能违规）。选项D错误，因为要求是3个账号而不是一个账号发满5条。正确答案是A、B、C。"},{id:"1-6",module:"1",moduleTitle:"新人期基础",type:"multiple",title:"短视频提报加分的要求是？",options:["定位在重点商圈","定位在社区附近","文案包含价格","文案包含社区的加法优势"],answer:["A","C","D"],keywords:"重点商圈定位、价格信息、社区优势",explanation:"短视频提报加分要求：A（定位在重点商圈，提高曝光度）、C（文案包含价格，提供明确信息）、D（文案包含社区的加法优势，突出卖点）。选项B错误，定位在社区附近是没有流量的。正确答案是A、C、D。"},{id:"1-7",module:"1",moduleTitle:"新人期基础",type:"multiple",title:"在小红书平台获客的关键是？",options:["打造真实人设，获得用户信任","多个账号持续发帖","明亮整洁的房间照片和有吸引力的文案","内容注意不要涉及违规词"],answer:["A","B","C","D"],keywords:"真实人设、持续发帖、优质内容、合规要求",explanation:"小红书平台获客需要全面策略：A（打造真实人设，建立信任关系）、B（多个账号持续发帖，扩大曝光）、C（明亮整洁的房间照片和有吸引力的文案，提升吸引力）、D（内容注意不要涉及违规词，确保合规）。所有选项都是获客的关键要素。正确答案是A、B、C、D。"},{id:"1-8",module:"1",moduleTitle:"新人期基础",type:"multiple",title:"在抖音渠道获客的关键是？",options:["持续更新，建立账号人设","每周发1条视频","直播+短视频同时获客","每天发布同样的视频"],answer:["A","C"],keywords:"持续更新、人设建设、直播短视频结合",explanation:"抖音渠道获客关键要素：A（持续更新，建立账号人设，提高用户粘性）、C（直播+短视频同时获客，多渠道引流）。选项B错误，每周1条视频频率太低；选项D错误，重复内容不利于账号发展。正确答案是A、C。"},{id:"1-9",module:"1",moduleTitle:"新人期基础",type:"single",title:"在发放线索过程中，系统会如何处理7天内的重复客户？",options:["分配给新的销售人员","优先分配给原销售人员","随机分配给任何销售人员","暂停分配等待处理"],answer:"B",keywords:"优先分配给原销售",explanation:"系统会自动检测7天内相同手机号或微信号的重复客户，优先分配给原销售人员，确保客户关系的连续性和服务质量。选项B正确。"},{id:"1-10",module:"1",moduleTitle:"新人期基础",type:"single",title:"加入销售组后，线索多久会发放？",options:["立即发放","1天内发放","3天内发放","一周内发放"],answer:"C",keywords:"3天内发放",explanation:"线索发放根据市场客户量情况，只要线索状态保持正常（跟进状态正常、有积分、转化率合格），一般3天内会发放到销售人员。选项C正确。"},{id:"1-11",module:"1",moduleTitle:"新人期基础",type:"single",title:"添加官网客户后，应该如何追踪客户跟进和成交情况？",options:["无需备注，系统自动追踪","添加微信时必须为客户备注线索编号","只在成交时备注编号","随意备注即可"],answer:"B",keywords:"备注线索编号",explanation:'添加官网客户后，添加微信时必须为客户备注线索编号。线索ID采用"年份+月份+序号"格式，例如25J00005表示2025年1月第5个线索，便于识别和管理。同时如果盘客时发现未更新，会扣除积分。选项B正确。'},{id:"2-1",module:"2",moduleTitle:"积分系统",type:"multiple",title:"获得积分的途径包括哪些？",options:["直播积分","业绩激励","新人期积分","以上都不是"],answer:["A","B","C"],keywords:"直播、业绩、新人期",explanation:"积分可通过三种主要途径获取：参与直播活动（如勤奋度任务）、完成业绩目标（如签约激励）、以及新人期任务奖励。选项D错误，因为A、B、C都是有效途径。"},{id:"2-2",module:"2",moduleTitle:"积分系统",type:"multiple",title:"直播的参与前需要完成什么？",options:["每周在链接内报名","联系片区市场运营","新媒体沟通群内提报","以上都不是"],answer:["A","B"],keywords:"每周在链接内报名、联系片区市场运营",explanation:"参与直播活动需先联系片区市场运营人员完成报名任务，任务完成后每周做链接内报名。选项A和C是其他任务的提报方式，不适用于直播。选项B正确。"},{id:"2-3",module:"2",moduleTitle:"积分系统",type:"single",title:"每周完成勤奋度任务，新手期最多可以获得多少积分？",options:["1200","1400","1600","1800"],answer:"D",keywords:"1800积分",explanation:"每周勤奋度任务包括小红书（300积分）和短视频（150积分），合计450积分/周。按月计算（4周），最多可获得1800积分，并可兑换约60条线索。选项D正确。"},{id:"2-4",module:"2",moduleTitle:"积分系统",type:"multiple",title:"积分在工作中有什么作用？",options:["换奶茶","换带看","换线索","换钱"],answer:["B","C"],keywords:"兑换线索/带看",explanation:"积分主要用于业务资源兑换，如换取带看机会或销售线索，直接支持业绩提升。选项A和D是错误干扰项，积分不能兑换非业务物品或现金。正确答案是B和C。"},{id:"2-5",module:"2",moduleTitle:"积分系统",type:"single",title:"如果连续3天都是【线索未接受状态】，每天扣多少积分？",options:["500","600","700","800"],answer:"B",keywords:"600积分",explanation:'根据积分管理规则，线索状态未及时更新（如连续3天"未接受"）会被视为低效，每天扣600积分，以督促及时跟进。选项B正确。'},{id:"3-1",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"盘客时，未通过线索不进行电话联系（48小时内）扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"盘客环节中，未在48小时内对未通过线索进行电话联系，视为跟进延迟，扣100积分。这确保销售动作及时性。选项B正确。"},{id:"3-2",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"盘客时，无效线索未及时反馈（24小时）扣多少积分？",options:["30","50","80","100"],answer:"B",keywords:"50积分",explanation:"无效线索需在24小时内反馈至系统，否则扣50积分。这避免资源浪费，并保持数据准确性。选项B正确。"},{id:"3-3",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"盘客时，线索未添加扣多少积分？",options:["200","300","400","500"],answer:"B",keywords:"300积分",explanation:"线索未添加至跟进系统，表示基础操作缺失，扣300积分。这强调数据录入的重要性。选项B正确。"},{id:"3-4",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，未询问客户需求（入住时间/工作地点/预算）扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"SOP要求必须询问客户关键需求（入住时间、工作地点、预算），未执行扣100积分，以确保需求匹配和转化率。选项B正确。"},{id:"3-5",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，客户未备注线索编号扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"线索编号备注是跟踪客户的基础，未备注扣100积分，防止数据混乱。选项B正确。"},{id:"3-6",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，不进行洗客环节（1小时内通勤，1000元预算差距）扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"洗客环节（筛选符合通勤和预算的客户）是SOP核心，未执行扣100积分，以优化资源分配。选项B正确。"},{id:"3-7",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，外社区意向客户不推荐扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"外社区客户推荐是交叉销售机会，不推荐扣100积分，鼓励团队协作。选项B正确。"},{id:"3-8",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，5天内未进行回访动作扣多少积分？",options:["50","100","150","200"],answer:"B",keywords:"100积分",explanation:"回访是维护客户关系的关键，5天内未执行扣100积分，确保跟进连续性。选项B正确。"},{id:"3-9",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，工作日9~21点消息不回复超过2小时扣多少积分？",options:["200","300","400","500"],answer:"B",keywords:"300积分",explanation:"及时回复消息（工作时段内超2小时未回复）影响客户体验，扣300积分，强调响应速度。选项B正确。"},{id:"3-10",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，主动删除客户扣多少积分？",options:["500","600","700","800"],answer:"B",keywords:"600积分",explanation:"主动删除客户视为资源浪费，扣600积分，以保留潜在销售机会。选项B正确。"},{id:"3-11",module:"3",moduleTitle:"SOP执行与扣分规则",type:"single",title:"SOP执行中，态度恶劣（辱骂客户/客诉反馈）会如何处理？",options:["扣1000积分","积分清零","扣500积分","扣200积分"],answer:"B",keywords:"积分清零",explanation:"态度恶劣（如辱骂或客诉）是严重违规，直接导致积分清零，维护公司形象。选项B正确。"},{id:"3-12",module:"3",moduleTitle:"SOP执行与扣分规则",type:"multiple",title:"SOP执行中，哪些行为会导致扣积分？",options:["未询问客户需求","客户未备注线索编号","不进行洗客环节","外社区意向客户不推荐","5天内未进行回访动作"],answer:["A","B","C","D","E"],keywords:"多种扣分行为",explanation:"SOP执行中，所有选项行为都会导致扣分：A（扣100分）、B（扣100分）、C（扣100分）、D（扣100分）、E（扣100分）。这强调全面遵守流程。"},{id:"4-1",module:"4",moduleTitle:"线索管理",type:"single",title:"跟进表中，可根据个人需要进行哪些操作？",options:["筛选","排序","分组","以上都是"],answer:"D",keywords:"筛选、排序、分组",explanation:"跟进表支持筛选（按条件过滤数据）、排序（按字段排列）和分组（分类管理），方便个性化数据操作。选项D正确。"},{id:"4-2",module:"4",moduleTitle:"线索管理",type:"single",title:"丢单流程适用于哪种客户？",options:["已签约客户","无效客户","潜在客户","以上都不是"],answer:"B",keywords:"无效客户",explanation:"终止流程用于标记无效客户（即无法成交的客户），以便释放资源。其他选项不适用。选项B正确。"},{id:"4-3",module:"4",moduleTitle:"线索管理",type:"single",title:"成交上传是在哪个阶段填写社区/房间号/合同号？",options:["已到店阶段","跟进中阶段","潜在客户阶段","以上都不是"],answer:"A",keywords:"已到店阶段",explanation:"成交数据（如社区、房间号、合同号）必须在已到店阶段上传，确保信息及时回传系统。选项A正确。"},{id:"4-4",module:"4",moduleTitle:"线索管理",type:"multiple",title:"有哪些情况会导致积分线索无法发放？",options:["转化率过低","未完成跟进","积分余额不足","当日线索达到上限"],answer:["A","B","C","D"],keywords:"多种原因",explanation:"所有选项都会导致线索停发：A（转化率低表示效率问题）、B（跟进不全影响数据质量）、C（积分不足无法兑换）、D（达到每日上限）。"},{id:"4-5",module:"4",moduleTitle:"线索管理",type:"multiple",title:"关于成交客户上传，以下说法正确的是：",options:["成交后需在线索表内完成已签约阶段","预定或者成交都应上传","成交2小时内需要上传结果","有空了再上传"],answer:["A","B","C"],keywords:"及时上传",explanation:"成交上传要求：A（必须完成已签约阶段填写）、B（预定和成交都需上传）、C（2小时内及时上传确保数据新鲜）。选项D错误，上传不可延迟。"},{id:"4-6",module:"4",moduleTitle:"线索管理",type:"single",title:"以下哪种情况可回退线索？",options:["在住客户","不符合入住条件","线索重复","手机空号或停机/微信不存在","以上都是"],answer:"E",keywords:"多种回退理由",explanation:"回退线索适用于所有情况：A（在住客户无需跟进）、B（条件不符）、C（重复数据）、D（无效联系方式）。选项E正确。"},{id:"4-7",module:"4",moduleTitle:"线索管理",type:"single",title:"线索回退的操作步骤有哪些？",options:["在线索跟进表自助回退","联系市场运营退线索","联系客户反馈无效线索","在跟进表操作丢单"],answer:"A",keywords:"在线索跟进表自助回退",explanation:"回退操作只有一种方式：A（直接点击界面回退按钮）。上传回退证据后，会有人专人负责审批。选项B、C和D错误。"},{id:"4-8",module:"4",moduleTitle:"线索管理",type:"single",title:"线索接收阶段，最多发送多少个新线索？",options:["2","3","4","5"],answer:"A",keywords:"2个",explanation:"线索接收阶段，系统每次最多发送2个新线索。需在通知内确认接收后，才能继续发送，避免信息过载。选项A正确。"},{id:"5-1",module:"5",moduleTitle:"综合应用",type:"fill",title:"大于100个线索时，转化率低于______%会导致线索停发",answer:"3",keywords:"3%",explanation:"当线索量超过100条时，如果转化率（成交率）低于3%，系统会自动停发新线索。这鼓励优化跟进效率，避免资源浪费。"},{id:"5-2",module:"5",moduleTitle:"综合应用",type:"single",title:"在销售过程中，转化率最重要的作用是什么？",options:["直接制定公寓的市场定价","衡量跟进效果并识别销售漏斗中的瓶颈","了解市场人群变化","优化组织架构"],answer:"B",keywords:"衡量跟进效果、识别瓶颈",explanation:"转化率是销售过程中的核心指标，最重要的作用是衡量跟进效果并识别销售漏斗中的瓶颈。通过分析转化率，可以了解在哪个环节客户流失最多，从而针对性地优化销售流程，提高整体效率。选项A、C、D虽然也是重要指标，但不如转化率更能直接反映销售效果和问题所在。选项B正确。"},{id:"5-3",module:"5",moduleTitle:"综合应用",type:"essay",title:"跟进中，如何提高成交率？",answer:"提高成交率需要：及时回复客户消息（工作时段内响应）、按时进行回访和预约看房、提供优质的客户服务（如解决疑问）、深入了解客户需求（入住时间、预算等）并针对性地解决问题、建立良好的客户关系（如定期跟进）。关键是通过SOP执行减少失误，并利用积分系统兑换高质量线索。",keywords:"及时回复、回访、了解需求",explanation:"成交率是销售核心指标，提升方法包括：快速响应（避免超时扣分）、主动回访（5天内动作）、需求分析（如未询问需求会扣分），以及关系维护。新人应结合积分规则（如兑换线索）和SOP避免扣分，以数据驱动决策。"},{id:"5-4",module:"5",moduleTitle:"综合应用",type:"essay",title:"积分扣减规则中，如何避免扣分？",answer:"避免扣分需要：及时跟进线索（48小时内电话联系）、快速反馈无效线索（24小时内）、正确添加线索到系统、询问客户关键需求（入住时间、工作地点、预算）、备注线索编号、执行洗客环节、推荐外社区客户、定期回访（5天内）、及时回复消息（工作时段内2小时内）、不主动删除客户、保持良好的服务态度。关键是要严格按照SOP执行，避免违规操作。",keywords:"及时跟进、SOP执行、良好态度",explanation:"积分扣减规则严格，避免扣分需要全面遵守SOP流程：及时性（48小时电话、24小时反馈、2小时回复）、完整性（添加线索、备注编号、询问需求）、规范性（洗客、推荐、回访）、态度性（不删除客户、不辱骂客户）。只有全面执行才能避免扣分。"}],I=()=>{const e=localStorage.getItem("onboarding_exam_status");return e?JSON.parse(e):{status:"pending",answeredQuestions:[],examAttempts:0,progressPercentage:0}},P=e=>{localStorage.setItem("onboarding_exam_status",JSON.stringify(e)),t(e)},A=(e,t)=>{if("single"===e.type)return t===e.answer;if("multiple"===e.type){const r=Array.isArray(e.answer)?e.answer:[e.answer],s=Array.isArray(t)?t:[t];return r.length===s.length&&r.every(e=>s.includes(e))}return"fill"===e.type?(null==t?void 0:t.toString().toLowerCase().trim())===e.answer.toString().toLowerCase().trim():"essay"===e.type},F=e=>{const t=f?y.find(t=>t.id===e):r.find(t=>t.id===e);t&&((e=>{const t=I();if(!f&&!t.answeredQuestions.includes(e)){const s=[...t.answeredQuestions,e],n=Math.round(s.length/r.length*100),i={...t,status:"studying",answeredQuestions:s,progressPercentage:n};P(i)}})(e),x(t=>new Set([...t,e])),f&&localStorage.setItem("formal_exam_answers",JSON.stringify(l)),f||a(!0),t.type)},M=e=>{f&&(F(e),setTimeout(()=>{const e=p;e<y.length-1&&m(e+1)},500))},D=e=>{var t,s;const n=h.has(e.id),i=l[e.id],o=f?y:r,a=p;return jsxRuntimeExports.jsxs(Card$1,{style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"},title:jsxRuntimeExports.jsx("div",{style:{wordBreak:"break-word",lineHeight:"1.4",whiteSpace:"normal",textAlign:"left"},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",fontWeight:500,flex:1,textAlign:"left"},children:e.title})})}),extra:jsxRuntimeExports.jsx(Space$1,{style:{marginRight:"-4px"},children:jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:"single"===e.type?"单选题":"multiple"===e.type?"多选题":"fill"===e.type?"填空题":"问答题"})}),children:[jsxRuntimeExports.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",paddingBottom:"100px"},children:["single"===e.type&&jsxRuntimeExports.jsx(Radio.Group,{value:i,onChange:t=>{c({...l,[e.id]:t.target.value})},children:jsxRuntimeExports.jsx(Space$1,{direction:"vertical",style:{width:"100%"},children:null==(t=e.options)?void 0:t.map((t,r)=>jsxRuntimeExports.jsxs(Radio,{value:String.fromCharCode(65+r),style:{padding:"8px 12px",border:n&&i===String.fromCharCode(65+r)&&!A(e,i)?"1px solid #ff4d4f":"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"6px",width:"100%",fontSize:"13px",backgroundColor:n&&i===String.fromCharCode(65+r)&&!A(e,i)?"#fff2f0":"transparent"},children:[String.fromCharCode(65+r),". ",t]},r))})}),"multiple"===e.type&&jsxRuntimeExports.jsx(Checkbox.Group,{value:i||[],onChange:t=>{c({...l,[e.id]:t})},children:jsxRuntimeExports.jsx(Space$1,{direction:"vertical",style:{width:"100%"},children:null==(s=e.options)?void 0:s.map((t,r)=>jsxRuntimeExports.jsxs(Checkbox,{value:String.fromCharCode(65+r),style:{padding:"8px 12px",border:n&&i&&i.includes(String.fromCharCode(65+r))&&!A(e,i)?"1px solid #ff4d4f":"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"6px",width:"100%",fontSize:"13px",backgroundColor:n&&i&&i.includes(String.fromCharCode(65+r))&&!A(e,i)?"#fff2f0":"transparent"},children:[String.fromCharCode(65+r),". ",t]},r))})}),"fill"===e.type&&jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入答案",value:i||"",onChange:t=>{c({...l,[e.id]:t.target.value})},onPressEnter:()=>{f&&i&&i.toString().trim()&&M(e.id)},size:"middle",style:{fontSize:"13px",borderColor:n&&i&&!A(e,i)?"#ff4d4f":void 0,backgroundColor:n&&i&&!A(e,i)?"#fff2f0":void 0}}),"essay"===e.type&&jsxRuntimeExports.jsx(TextArea$2,{rows:4,placeholder:"请输入您的答案",value:i||"",onChange:t=>{c({...l,[e.id]:t.target.value})},onPressEnter:()=>{f&&i&&i.toString().trim()&&M(e.id)},style:{fontSize:"13px",borderColor:n&&i&&!A(e,i)?"#ff4d4f":void 0,backgroundColor:n&&i&&!A(e,i)?"#fff2f0":void 0}})]}),jsxRuntimeExports.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:"white",padding:"12px 16px",borderTop:"1px solid #f0f0f0",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px"},children:[!f&&jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"middle",disabled:!i||Array.isArray(i)&&0===i.length,onClick:()=>F(e.id),style:{width:"100%",fontSize:"13px",borderRadius:"6px"},children:n?"已提交":"提交答案"}),f&&jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"middle",disabled:!i||Array.isArray(i)&&0===i.length,onClick:()=>M(e.id),style:{width:"100%",fontSize:"13px",borderRadius:"6px"},children:n?"已提交":"提交答案并下一题"}),jsxRuntimeExports.jsxs("div",{style:{marginTop:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",disabled:0===a,onClick:()=>{if(f){const e=Math.max(0,a-1);m(e)}else m(Math.max(0,p-1))},icon:jsxRuntimeExports.jsx(RefIcon$14,{}),style:{fontSize:"12px",borderRadius:"4px"},children:"上一题"}),jsxRuntimeExports.jsxs("span",{style:{fontSize:"12px",color:"#666"},children:["第 ",a+1," 题 / 共 ",o.length," 题"]}),jsxRuntimeExports.jsx(Button$1,{size:"small",disabled:a===o.length-1,onClick:()=>{if(f){const e=Math.min(y.length-1,a+1);m(e)}else m(Math.min(r.length-1,p+1))},icon:jsxRuntimeExports.jsx(RefIcon$15,{}),style:{fontSize:"12px",borderRadius:"4px"},children:"下一题"})]})]})]})},O=e=>{const t=h.has(e.id),r=l[e.id];if(f)return jsxRuntimeExports.jsx(Card$1,{style:{height:"100%"},title:jsxRuntimeExports.jsx("div",{style:{wordBreak:"break-word",lineHeight:"1.4",whiteSpace:"normal",textAlign:"center"},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:"正式考试模式"})})}),bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",padding:"24px",height:"calc(100% - 57px)"},children:jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",color:"#999"},children:[jsxRuntimeExports.jsx(RefIcon$v,{style:{fontSize:48,marginBottom:16}}),jsxRuntimeExports.jsx(Title$3,{level:4,children:"正式考试进行中"}),jsxRuntimeExports.jsx(Paragraph,{children:"考试完成后将显示成绩"})]})});if(!t||!o)return jsxRuntimeExports.jsx(Card$1,{style:{height:"100%"},title:jsxRuntimeExports.jsx("div",{style:{wordBreak:"break-word",lineHeight:"1.4",whiteSpace:"normal",textAlign:"center"},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:"答案与解析"})})}),bodyStyle:{display:"flex",alignItems:"center",justifyContent:"center",padding:"24px",height:"calc(100% - 57px)"},children:jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",color:"#999"},children:[jsxRuntimeExports.jsx(RefIcon$16,{style:{fontSize:48,marginBottom:16}}),jsxRuntimeExports.jsx(Title$3,{level:4,children:"请先提交答案"}),jsxRuntimeExports.jsx(Paragraph,{children:"提交答案后将显示正确答案和解析"})]})});const s=A(e,r),n=Array.isArray(r)?r.join("、"):r;return jsxRuntimeExports.jsx(Card$1,{style:{height:"100%"},title:jsxRuntimeExports.jsx("div",{style:{wordBreak:"break-word",lineHeight:"1.4",whiteSpace:"normal",textAlign:"center"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:"答案与解析"}),s?jsxRuntimeExports.jsx(Tag$1,{color:"success",children:"正确"}):jsxRuntimeExports.jsx(Tag$1,{color:"error",children:"错误"})]})}),children:jsxRuntimeExports.jsxs("div",{style:{height:"100%",overflow:"auto",padding:"16px",fontSize:"13px"},children:["essay"!==e.type&&jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"您的答案："}),jsxRuntimeExports.jsx(Text$4,{style:{color:s?"#52c41a":"#ff4d4f"},children:n||"未作答"})]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"正确答案："}),Array.isArray(e.answer)?e.answer.join("、"):e.answer]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"关键字："}),jsxRuntimeExports.jsx(Text$4,{code:!0,children:e.keywords})]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"解析："}),e.explanation]})]})})},N=async()=>{try{const e=await getCurrentProfileId();if(!e)return!1;const{data:t,error:r}=await supabase.rpc("get_user_allocation_status_multi",{p_user_id:e});return r?(console.error("获取用户销售组状态失败:",r),!1):!!(Array.isArray(t)&&t.length>0)&&($(t[0]),!0)}catch(e){return console.error("检查用户销售组状态失败:",e),!1}};reactExports.useEffect(()=>{(async()=>{s(T);const e=I();t(e);if(await N())return d(2),void i(!1);if("formal_exam"===e.status&&e.formalExamStartTime){const t=Math.floor((toBeijingTime(new Date).valueOf()-e.formalExamStartTime)/1e3),r=Math.max(0,900-t);if(r>0){g(!0),w(r),v(T.filter(t=>{var r;return null==(r=e.formalExamQuestions)?void 0:r.includes(t.id)})),m(0);const t=localStorage.getItem("formal_exam_answers");t&&c(JSON.parse(t)),e.formalExamQuestions&&x(new Set(e.formalExamQuestions))}else staticMethods.error("考试时间已到，系统自动提交！"),B().catch(e=>{console.error("初始化时自动提交考试失败:",e)})}else e.answeredQuestions.length>0&&x(new Set(e.answeredQuestions));a(!1),i(!1)})()},[]);const B=async()=>{R&&(clearInterval(R),_(null)),localStorage.setItem("formal_exam_answers",JSON.stringify(l));let t=0;const r=[];if(y.forEach(e=>{const s=l[e.id];"essay"===e.type?s&&s.trim().length>0?t+=5:r.push(e):(e.type,A(e,s)?t+=5:r.push(e))}),j(t),C(r),t>=95){try{const e=await getCurrentProfileId();if(e){const{data:r,error:s}=await supabase.from("users_list").select("list").eq("id",1).single();if(s)return console.error("获取销售组信息失败:",s),void staticMethods.warning(`恭喜！正式考试通过！得分：${t}分，但销售组分配失败，请联系管理员。`);const n=r.list||[];if(n.includes(e))staticMethods.success(`恭喜！正式考试通过！得分：${t}分，已自动加入销售组！`);else{const r=[...n,e],{error:s}=await supabase.from("users_list").update({list:r}).eq("id",1).select();s?(console.error("分配销售组失败:",s),staticMethods.warning(`恭喜！正式考试通过！得分：${t}分，但销售组分配失败，请联系管理员。`)):staticMethods.success(`恭喜！正式考试通过！得分：${t}分，已自动加入销售组！`)}}else console.error("无法获取用户profile ID"),staticMethods.warning(`恭喜！正式考试通过！得分：${t}分，但销售组分配失败，请联系管理员。`)}catch(s){console.error("分配销售组异常:",s),staticMethods.warning(`恭喜！正式考试通过！得分：${t}分，但销售组分配失败，请联系管理员。`)}const r={...e,status:"completed",formalExamScore:t,assignedSalesGroupId:1};P(r),await N()}else{const r={...e,status:"exam_passed",formalExamScore:t};P(r),staticMethods.error(`考试未通过！得分：${t}分，需要95分才能通过。`)}g(!1),w(900),a(!1),v([]),x(new Set),c({}),localStorage.removeItem("formal_exam_answers")};reactExports.useEffect(()=>()=>{R&&clearInterval(R)},[]),reactExports.useEffect(()=>{if(!f)return;const e=()=>{document.hidden&&(staticMethods.error("页面失去焦点，考试自动结束！"),B().catch(e=>{console.error("页面失去焦点时提交考试失败:",e)}))},t=e=>{if(f)return e.preventDefault(),e.returnValue="考试进行中，关闭页面将自动结束考试！","考试进行中，关闭页面将自动结束考试！"},r=()=>{f&&(staticMethods.error("页面被关闭，考试自动结束！"),B().catch(e=>{console.error("页面关闭时提交考试失败:",e)}))};return document.addEventListener("visibilitychange",e),window.addEventListener("beforeunload",t),window.addEventListener("pagehide",r),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",t),window.removeEventListener("pagehide",r)}},[f]);const L=reactExports.useCallback(()=>{e?"completed"===e.status&&e.assignedSalesGroupId?d(2):"formal_exam"===e.status||f||e.progressPercentage&&100===e.progressPercentage?d(1):d(0):d(0)},[e,f]);if(reactExports.useEffect(()=>{L()},[L]),reactExports.useEffect(()=>{2===u&&"completed"===(null==e?void 0:e.status)&&(null==e?void 0:e.assignedSalesGroupId)&&(k||N().catch(e=>{console.error("获取销售组信息失败:",e)}))},[u,e,k]),n)return jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"50px"},children:"加载中..."});const z=[{title:"模拟考试",icon:jsxRuntimeExports.jsx(RefIcon$13,{}),content:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:0},children:[jsxRuntimeExports.jsx(Alert,{message:h.size===r.length?"模拟考试完成：恭喜！您已完成所有模拟题目，现在可以进入正式考试了。":"模拟考试：掌握新人期政策、积分规则、SOP执行要求。预估学习时间：约30分钟。",type:"success",showIcon:!0,style:{marginBottom:8},action:h.size===r.length?jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"small",onClick:()=>d(1),children:"进入正式考试"}):void 0}),jsxRuntimeExports.jsx(Progress,{percent:Math.round(h.size/r.length*100),status:h.size===r.length?"success":"active",format:e=>`${h.size}/${r.length} (${e}%)`,style:{marginBottom:8}})]}),jsxRuntimeExports.jsxs("div",{className:"exam-layout",children:[jsxRuntimeExports.jsx("div",{className:"exam-question-area",children:r[p]&&D(r[p])}),jsxRuntimeExports.jsx("div",{className:"exam-answer-area",children:r[p]&&O(r[p])})]})]})},{title:"正式考试",icon:jsxRuntimeExports.jsx(RefIcon$v,{}),content:jsxRuntimeExports.jsx("div",{children:f?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:0},children:[jsxRuntimeExports.jsxs(Card$1,{style:{marginBottom:16,borderRadius:"8px",border:"1px solid #ffd591",backgroundColor:"#fff7e6"},bodyStyle:{padding:"16px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[h.size===y.length?jsxRuntimeExports.jsx(RefIcon$7,{style:{color:"#52c41a",fontSize:"16px"}}):jsxRuntimeExports.jsx(RefIcon$v,{style:{color:"#fa8c16",fontSize:"16px"}}),jsxRuntimeExports.jsx("span",{style:{fontWeight:500,color:h.size===y.length?"#52c41a":"#fa8c16"},children:h.size===y.length?"考试完成，点击查看成绩":"正式考试进行中"})]}),jsxRuntimeExports.jsx("div",{style:{backgroundColor:h.size===y.length?"#52c41a":"#fa8c16",color:"white",padding:"4px 12px",borderRadius:"16px",fontSize:"14px",fontWeight:500,cursor:h.size===y.length?"pointer":"default"},onClick:h.size===y.length?B:void 0,children:h.size===y.length?"查看成绩":`剩余时间：${(e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`})(b)}`})]}),jsxRuntimeExports.jsx(Progress,{percent:Math.round(h.size/y.length*100),status:h.size===y.length?"success":"active",format:e=>`${h.size}/${y.length} (${e}%)`,strokeColor:h.size===y.length?"#52c41a":"#fa8c16"})]}),jsxRuntimeExports.jsx(Alert,{message:"考试安全提醒：请勿切换标签页、最小化窗口或关闭浏览器，否则考试将自动结束",type:"warning",showIcon:!0,style:{marginBottom:16}})]}),jsxRuntimeExports.jsxs("div",{className:"exam-layout",children:[jsxRuntimeExports.jsx("div",{className:"exam-question-area",children:y[p]&&D(y[p])}),jsxRuntimeExports.jsx("div",{className:"exam-answer-area",children:y[p]&&O(y[p])})]})]}):jsxRuntimeExports.jsx("div",{children:E>0?jsxRuntimeExports.jsxs("div",{style:{padding:"20px"},children:[jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[jsxRuntimeExports.jsx(RefIcon$v,{style:{fontSize:48,color:E>=95?"#52c41a":"#ff4d4f",marginBottom:16}}),jsxRuntimeExports.jsx(Title$3,{level:3,style:{color:E>=95?"#52c41a":"#ff4d4f"},children:E>=95?"考试通过！":"考试未通过"}),jsxRuntimeExports.jsxs(Paragraph,{style:{fontSize:"16px",marginBottom:8},children:["得分：",jsxRuntimeExports.jsxs(Text$4,{strong:!0,style:{color:E>=95?"#52c41a":"#ff4d4f"},children:[E,"分"]})," / 100分"]}),jsxRuntimeExports.jsx(Paragraph,{style:{color:"#666"},children:E>=95?"恭喜您通过了正式考试！":"需要95分才能通过考试，请继续努力！"})]}),S.length>0&&jsxRuntimeExports.jsxs("div",{style:{marginTop:24},children:[jsxRuntimeExports.jsxs(Title$3,{level:4,style:{marginBottom:16},children:["错题回顾 (",S.length,"题)"]}),jsxRuntimeExports.jsx(Collapse,{children:S.map((e,t)=>{const r=l[e.id],s=Array.isArray(r)?r.join("、"):r;return jsxRuntimeExports.jsx(Panel,{header:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsxs("span",{children:["第",t+1,"题：",e.title]}),jsxRuntimeExports.jsx(Tag$1,{color:"error",children:"错误"})]}),children:jsxRuntimeExports.jsxs("div",{style:{fontSize:"13px"},children:[jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"您的答案："}),jsxRuntimeExports.jsx(Text$4,{style:{color:"#ff4d4f"},children:s||"未作答"})]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"正确答案："}),Array.isArray(e.answer)?e.answer.join("、"):e.answer]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"关键字："}),jsxRuntimeExports.jsx(Text$4,{code:!0,children:e.keywords})]}),jsxRuntimeExports.jsxs(Paragraph,{children:[jsxRuntimeExports.jsx(Text$4,{strong:!0,children:"解析："}),e.explanation]})]})},e.id)})})]}),jsxRuntimeExports.jsx("div",{style:{textAlign:"center",marginTop:24},children:jsxRuntimeExports.jsx(Space$1,{children:jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>{j(0),C([]),c({})},children:"重新考试"})})})]}):jsxRuntimeExports.jsxs("div",{style:{maxWidth:600,margin:"0 auto",padding:"24px"},children:[jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[jsxRuntimeExports.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#f0f8ff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:jsxRuntimeExports.jsx(RefIcon$v,{style:{fontSize:28,color:"#1890ff"}})}),jsxRuntimeExports.jsx(Title$3,{level:3,style:{marginBottom:"4px",color:"#262626"},children:"正式考试"}),jsxRuntimeExports.jsx(Paragraph,{style:{color:"#8c8c8c",fontSize:"13px",marginBottom:0},children:"完成模拟考试后，进入正式考试阶段"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"20px"},children:[jsxRuntimeExports.jsx(Title$3,{level:5,style:{marginBottom:"12px",color:"#262626"},children:"📋 考试规则"}),jsxRuntimeExports.jsx("div",{style:{backgroundColor:"#fafafa",padding:"16px",borderRadius:"6px",border:"1px solid #f0f0f0"},children:jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:"small",style:{width:"100%"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#1890ff"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px",color:"#595959"},children:"从40道题目中随机抽取20道"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#1890ff"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px",color:"#595959"},children:"考试时间15分钟"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#1890ff"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px",color:"#595959"},children:"大于等于95分才能通过考试"})]})]})})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"20px"},children:[jsxRuntimeExports.jsx(Title$3,{level:5,style:{marginBottom:"12px",color:"#262626"},children:"⚠️ 重要提醒"}),jsxRuntimeExports.jsx("div",{style:{backgroundColor:"#fff7e6",padding:"12px",borderRadius:"6px",border:"1px solid #ffd591"},children:jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:"small",style:{width:"100%"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#fa8c16",fontSize:"12px"},children:"•"}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px",color:"#595959"},children:"考试开始后无法暂停，请确保有充足时间"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#fa8c16",fontSize:"12px"},children:"•"}),jsxRuntimeExports.jsx("span",{style:{fontSize:"13px",color:"#595959"},children:"考试过程中请勿切换页面或关闭浏览器，否则将自动结束考试"})]})]})})]}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"center"},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"large",disabled:!e||(e.progressPercentage||0)<100,onClick:()=>{const t=[...T].sort(()=>Math.random()-.5).slice(0,20);v(t),g(!0),m(0),x(new Set),c({}),a(!1),w(900);const r=setInterval(()=>{w(e=>e<=1?(clearInterval(r),staticMethods.error("考试时间已到，系统自动提交！"),B().catch(e=>{console.error("自动提交考试失败:",e)}),0):e-1)},1e3);_(r);const s={...e,status:"formal_exam",formalExamQuestions:t.map(e=>e.id),formalExamAttempts:((null==e?void 0:e.formalExamAttempts)||0)+1,formalExamStartTime:toBeijingTime(new Date).valueOf(),formalExamTimeLimit:900};P(s),staticMethods.success("正式考试开始！共20道题目（从40道题目中随机抽取），15分钟内完成，必须95分才能通过。")},style:{height:"40px",padding:"0 24px",fontSize:"14px",borderRadius:"6px"},icon:jsxRuntimeExports.jsx(RefIcon$v,{}),children:"开始正式考试"}),(!e||(e.progressPercentage||0)<100)&&jsxRuntimeExports.jsx("div",{style:{marginTop:"8px"},children:jsxRuntimeExports.jsx(Text$4,{type:"secondary",style:{fontSize:"11px"},children:"请先完成模拟考试"})})]})]})})})},{title:"加入销售组",icon:jsxRuntimeExports.jsx(RefIcon$N,{}),content:jsxRuntimeExports.jsx("div",{style:{maxWidth:800,margin:"0 auto",padding:"0px 0px",textAlign:"center"},children:jsxRuntimeExports.jsxs("div",{style:{maxWidth:600,margin:"0 auto",padding:"0 12px"},className:"success-content-container",children:[jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"24px",color:"#52c41a",marginBottom:"12px",fontWeight:600},children:"🎉 恭喜您加入销售组！"}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"16px",color:"#595959",lineHeight:"1.5"},children:["您已成功通过新人培训考试，正式成为",jsxRuntimeExports.jsx("span",{style:{color:"#52c41a",fontWeight:600,margin:"0 4px"},children:(null==k?void 0:k.groupname)||"销售组 #1"}),"的一员"]})]}),jsxRuntimeExports.jsx("div",{style:{width:"100%",borderRadius:12,overflow:"hidden",marginBottom:"32px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:jsxRuntimeExports.jsx("img",{src:"https://lead-service.vld.com.cn/supabase/storage/v1/object/public/banners/banner/welcome.jpg",alt:"欢迎加入销售组",style:{width:"100%",height:"auto",display:"block"}})}),jsxRuntimeExports.jsx(Card$1,{style:{borderRadius:12,border:"1px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontWeight:600},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"18px"},children:"💡"}),"接下来您可以"]}),bodyStyle:{padding:"16px"},children:jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:"middle",style:{width:"100%"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px",backgroundColor:"#fafafa",borderRadius:8,border:"1px solid #f0f0f0"},children:[jsxRuntimeExports.jsx("div",{style:{width:36,height:36,borderRadius:"50%",backgroundColor:"#e6f7ff",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"20px"},children:"📋"})}),jsxRuntimeExports.jsxs("div",{style:{flex:1},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:"#262626",marginBottom:"4px"},children:"查看并跟进线索"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c"},children:"及时处理新分配的客户线索，提高转化率"})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px",backgroundColor:"#fafafa",borderRadius:8,border:"1px solid #f0f0f0"},children:[jsxRuntimeExports.jsx("div",{style:{width:36,height:36,borderRadius:"50%",backgroundColor:"#fff7e6",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"20px"},children:"🎁"})}),jsxRuntimeExports.jsxs("div",{style:{flex:1},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:"#262626",marginBottom:"4px"},children:"完成更多任务"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c"},children:"获得积分奖励，兑换更多优质线索"})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px",backgroundColor:"#fafafa",borderRadius:8,border:"1px solid #f0f0f0"},children:[jsxRuntimeExports.jsx("div",{style:{width:36,height:36,borderRadius:"50%",backgroundColor:"#f6ffed",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"20px"},children:"🏆"})}),jsxRuntimeExports.jsxs("div",{style:{flex:1},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:"#262626",marginBottom:"4px"},children:"查看成交数据"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c"},children:"分析销售漏斗，提升销售业绩"})]})]})]})})]})})}];return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{children:"\n        /* 新手入门页面响应式样式 */\n        .onboarding-container {\n          padding: 24px;\n          max-width: 1200px;\n          margin: 0 auto;\n        }\n        \n        .onboarding-layout {\n          display: flex;\n          gap: 24px;\n        }\n        \n        .onboarding-sidebar {\n          width: 200px;\n          flex-shrink: 0;\n        }\n        \n        .onboarding-content {\n          flex: 1;\n        }\n        \n        .exam-layout {\n          display: flex;\n          gap: 24px;\n          height: 60vh;\n          margin-top: 0;\n        }\n        \n        .exam-question-area {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          min-width: 0;\n        }\n        \n        .exam-answer-area {\n          flex: 1;\n          min-width: 0;\n        }\n        \n        /* 考试区域卡片统一样式 */\n        .exam-question-area .ant-card,\n        .exam-answer-area .ant-card {\n          border-radius: 8px !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06) !important;\n          border: 1px solid #f0f0f0 !important;\n          height: 100% !important;\n          overflow: hidden !important;\n        }\n        \n        .exam-question-area .ant-card .ant-card-head,\n        .exam-answer-area .ant-card .ant-card-head {\n          border-bottom: 1px solid #f0f0f0 !important;\n          padding: 16px 24px !important;\n          min-height: 60px !important;\n        }\n        \n        .exam-question-area .ant-card .ant-card-body,\n        .exam-answer-area .ant-card .ant-card-body {\n          padding: 24px !important;\n        }\n        \n        /* 题型标签样式优化 */\n        .exam-question-area .ant-card .ant-card-head .ant-card-extra {\n          margin-right: -8px !important;\n        }\n        \n        .exam-question-area .ant-card .ant-card-head .ant-card-extra .ant-tag {\n          margin-right: 0 !important;\n          border-radius: 4px !important;\n        }\n        \n        /* 小屏幕响应式布局 */\n        @media (max-width: 768px) {\n          .onboarding-container {\n            padding: 4px 4px;\n          }\n          \n          .onboarding-layout {\n            flex-direction: column;\n            gap: 12px;\n          }\n          \n          .onboarding-sidebar {\n            width: 100%;\n            order: 1;\n          }\n          \n          .onboarding-content {\n            order: 2;\n          }\n          \n          .exam-layout {\n            flex-direction: column;\n            height: auto;\n            gap: 16px;\n          }\n          \n          .exam-question-area,\n          .exam-answer-area {\n            min-height: 300px;\n          }\n          \n          /* 步骤条在小屏幕上强制横向显示 */\n          .onboarding-sidebar .onboarding-steps.ant-steps {\n            display: flex !important;\n            flex-direction: row !important;\n            justify-content: space-between !important;\n            align-items: flex-start !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            width: 100% !important;\n            min-height: auto !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item {\n            flex: 1 !important;\n            margin: 0 !important;\n            padding: 0 4px !important;\n            display: flex !important;\n            flex-direction: column !important;\n            align-items: center !important;\n            text-align: center !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item .ant-steps-item-container {\n            display: flex !important;\n            flex-direction: column !important;\n            align-items: center !important;\n            width: 100% !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item .ant-steps-item-content {\n            width: 100% !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            display: flex !important;\n            flex-direction: column !important;\n            align-items: center !important;\n            text-align: center !important;\n            margin-top: 2px !important;\n            min-height: auto !important;\n            height: auto !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item .ant-steps-item-title {\n            font-size: 11px !important;\n            text-align: center !important;\n            margin-top: 2px !important;\n            margin-bottom: 0 !important;\n            white-space: nowrap !important;\n            overflow: hidden !important;\n            text-overflow: ellipsis !important;\n            max-width: 100% !important;\n            line-height: 1.1 !important;\n            width: 100% !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item .ant-steps-item-icon {\n            margin-right: 0 !important;\n            margin-bottom: 2px !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n          }\n          \n          /* 完全隐藏步骤连接线 */\n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item .ant-steps-item-tail {\n            display: none !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item::after {\n            display: none !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item:not(:last-child)::after {\n            display: none !important;\n          }\n          \n          /* 步骤条标题简化 */\n          .onboarding-sidebar .ant-card .ant-card-head-title {\n            font-size: 14px !important;\n            text-align: center !important;\n          }\n          \n          /* 隐藏小屏幕端的新手入门标题 */\n          .onboarding-sidebar .ant-card .ant-card-head {\n            display: none !important;\n          }\n          \n          /* 大幅减少步骤条卡片的内边距 */\n          .onboarding-sidebar .ant-card .ant-card-body {\n            padding: 4px !important;\n          }\n          \n          .onboarding-sidebar .ant-card .ant-card-head {\n            padding: 0 8px !important;\n            min-height: 40px !important;\n          }\n          \n          /* 强制移除步骤条的所有默认边距 */\n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item-container {\n            padding: 0 !important;\n            margin: 0 !important;\n          }\n          \n          .onboarding-sidebar .onboarding-steps.ant-steps .ant-steps-item-container .ant-steps-item-content {\n            margin: 0 !important;\n            padding: 0 !important;\n            min-height: auto !important;\n          }\n          \n          /* 非常小屏幕的优化 */\n          @media (max-width: 375px) {\n            .onboarding-sidebar .ant-steps .ant-steps-item .ant-steps-item-title {\n              font-size: 10px !important;\n            }\n            \n            .onboarding-sidebar .ant-steps .ant-steps-item {\n              padding: 0 2px !important;\n            }\n          }\n          \n          /* 移动端优化考试界面底部按钮 */\n          .exam-question-area .ant-card .ant-card-body {\n            padding-bottom: 120px !important;\n          }\n          \n          /* 移动端题目导航按钮优化 */\n          .exam-question-area .ant-btn {\n            font-size: 14px !important;\n            padding: 8px 16px !important;\n            height: auto !important;\n            min-height: 40px !important;\n          }\n          \n          /* 移动端卡片标题优化 */\n          .onboarding-content .ant-card .ant-card-head-title {\n            font-size: 16px !important;\n          }\n          \n          /* 移动端答案解析区域优化 */\n          .exam-answer-area .ant-card .ant-card-body {\n            padding: 12px !important;\n            font-size: 14px !important;\n          }\n          \n          /* 移动端主要内容卡片优化 */\n          .onboarding-content .ant-card .ant-card-body {\n            padding: 8px !important;\n          }\n          \n          /* 移动端考试题目卡片优化 */\n          .exam-question-area .ant-card .ant-card-body {\n            padding: 12px !important;\n            padding-bottom: 100px !important;\n          }\n          \n          /* 移动端加入销售组阶段卡片优化 */\n          .onboarding-content .ant-card .ant-card-body .ant-card {\n            margin: 0 !important;\n            border-radius: 8px !important;\n          }\n          \n          .onboarding-content .ant-card .ant-card-body .ant-card .ant-card-body {\n            padding: 12px !important;\n          }\n          \n          /* 移动端操作指南卡片间距优化 */\n          .onboarding-content .ant-card .ant-card-body .ant-card .ant-card-body .ant-space-item {\n            margin-bottom: 8px !important;\n          }\n          \n          .onboarding-content .ant-card .ant-card-body .ant-card .ant-card-body .ant-space-item .ant-card {\n            margin: 0 !important;\n            border-radius: 6px !important;\n          }\n          \n          /* 移动端成功页面内容容器优化 */\n          .success-content-container {\n            padding: 0 4px !important;\n          }\n          \n          /* 移动端指南卡片内边距优化 */\n          .success-content-container .ant-card .ant-card-body {\n            padding: 8px !important;\n          }\n          \n          /* 移动端题型标签优化 */\n          .exam-question-area .ant-card .ant-card-head .ant-card-extra {\n            margin-right: -4px !important;\n          }\n          \n          .exam-question-area .ant-card .ant-card-head .ant-card-extra .ant-tag {\n            font-size: 11px !important;\n            padding: 2px 6px !important;\n            line-height: 1.2 !important;\n          }\n        }\n      "}),jsxRuntimeExports.jsx("div",{className:"onboarding-container",children:jsxRuntimeExports.jsxs("div",{className:"onboarding-layout",children:[jsxRuntimeExports.jsx("div",{className:"onboarding-sidebar",children:jsxRuntimeExports.jsx(Card$1,{title:"新手入门",style:{height:"fit-content"},children:jsxRuntimeExports.jsx(Steps,{direction:"vertical",size:"small",current:u,onChange:t=>{f||(0===t?d(0):1===t&&((null==e?void 0:e.progressPercentage)||0)>=100?d(1):2===t&&"completed"===(null==e?void 0:e.status)&&(null==e?void 0:e.assignedSalesGroupId)&&d(2))},className:"onboarding-steps",items:[{title:"模拟考试",disabled:f},{title:"正式考试",disabled:(h.size||0)<r.length&&!f},{title:"加入销售组",disabled:"completed"!==(null==e?void 0:e.status)||!(null==e?void 0:e.assignedSalesGroupId)}]})})}),jsxRuntimeExports.jsx("div",{className:"onboarding-content",children:jsxRuntimeExports.jsx(Card$1,{children:z[u].content})})]})})]})},getTimeSlots=async()=>{try{return[{id:"morning-10-12",startTime:"10:00",endTime:"12:00",period:"morning",duration:2},{id:"afternoon-14-16",startTime:"14:00",endTime:"16:00",period:"afternoon",duration:2},{id:"afternoon-16-18",startTime:"16:00",endTime:"18:00",period:"afternoon",duration:2},{id:"evening-19-21",startTime:"19:00",endTime:"21:00",period:"evening",duration:2},{id:"evening-21-23",startTime:"21:00",endTime:"23:00",period:"evening",duration:2}]}catch(e){return console.error("获取时间段失败:",e),[]}},getWeeklySchedule=async(e,t)=>{try{let r=supabase.from("live_stream_schedules").select("*").order("date, time_slot_id");e&&t&&(r=r.gte("date",e).lte("date",t));const{data:s,error:n}=await r;if(n)throw n;const i=new Set;(s||[]).forEach(e=>{e.participant_ids&&Array.isArray(e.participant_ids)&&e.participant_ids.forEach(e=>i.add(e))});let o=new Map;if(i.size>0){const{data:e,error:t}=await supabase.from("users_profile").select("id, nickname, email").in("id",Array.from(i));if(t)throw t;o=new Map((e||[]).map(e=>[e.id,e]))}return(s||[]).map(e=>({id:e.id.toString(),date:e.date,timeSlotId:e.time_slot_id,managers:(e.participant_ids&&Array.isArray(e.participant_ids)?e.participant_ids:[]).map(e=>{const t=o.get(e);return{id:e.toString(),name:t?t.nickname||t.email:"未知用户",department:"",avatar:void 0}}),location:{id:e.location||"default",name:e.location||""},propertyType:{id:e.notes||"",name:e.notes||""},status:e.status,createdAt:e.created_at,updatedAt:e.updated_at,createdBy:e.created_by,editingBy:e.editing_by,editingAt:e.editing_at,editingExpiresAt:e.editing_expires_at,lockType:e.lock_type,lockReason:e.lock_reason,lockEndTime:e.lock_end_time,scoring_status:e.scoring_status||"not_scored",average_score:(()=>{if(e.scoring_data)try{const t=JSON.parse(e.scoring_data);if(t.calculation&&void 0!==t.calculation.weighted_average)return Number(t.calculation.weighted_average)}catch(e2){console.warn("解析scoring_data失败:",e2)}return null!==e.average_score&&void 0!==e.average_score&&""!==e.average_score?Number(e.average_score):null})(),scored_by:e.scored_by||null,scored_at:e.scored_at||null,scoring_data:e.scoring_data||null}))}catch(r){return console.error("获取直播安排失败:",r),[]}},createLiveStreamSchedule=async e=>{var t,r;try{const{data:{user:s}}=await supabase.auth.getUser();if(!s)throw new Error("用户未登录");const{data:n,error:i}=await supabase.from("users_profile").select("id").eq("user_id",s.id).single();if(i)throw i;const o={date:e.date,time_slot_id:e.timeSlotId,participant_ids:e.managers&&e.managers.length>0?e.managers.map(e=>parseInt(e.id)):[],location:(null==(t=e.location)?void 0:t.name)||null,notes:(null==(r=e.propertyType)?void 0:r.name)||null,status:e.status||void 0,created_by:n.id,..."editing"===e.status&&{editing_by:n.id,editing_at:(new Date).toISOString(),editing_expires_at:new Date(Date.now()+3e5).toISOString()}},{data:a,error:l}=await supabase.from("live_stream_schedules").insert(o).select().single();if(l)throw l;return{id:a.id.toString(),date:a.date,timeSlotId:a.time_slot_id,managers:e.managers,location:e.location,propertyType:e.propertyType,status:a.status,createdAt:a.created_at,updatedAt:a.updated_at,createdBy:a.created_by,editingBy:a.editing_by,editingAt:a.editing_at,editingExpiresAt:a.editing_expires_at,lockType:a.lock_type,lockReason:a.lock_reason,lockEndTime:a.lock_end_time}}catch(s){throw console.error("创建直播安排失败:",s),s}},updateLiveStreamSchedule=async(e,t)=>{try{const r={};if(t.managers&&(r.participant_ids=t.managers.length>0?t.managers.map(e=>parseInt(e.id)):[]),t.location&&(r.location=t.location.name||null),t.propertyType&&(r.notes=t.propertyType.name||null),t.status){if(r.status=t.status,"editing"===t.status){const{data:{user:e}}=await supabase.auth.getUser();if(e){const{data:t,error:s}=await supabase.from("users_profile").select("id").eq("user_id",e.id).single();!s&&t&&(r.editing_by=t.id,r.editing_at=(new Date).toISOString(),r.editing_expires_at=new Date(Date.now()+3e5).toISOString())}}"booked"===t.status&&(r.editing_by=null,r.editing_at=null,r.editing_expires_at=null,t.managers&&(r.participant_ids=t.managers.length>0?t.managers.map(e=>parseInt(e.id)):[]))}const{data:s,error:n}=await supabase.from("live_stream_schedules").update(r).eq("id",parseInt(e)).select().maybeSingle();if(n)throw console.error("❌ 数据库更新失败:",n),n;if(!s)throw console.error("❌ 未找到要更新的直播安排"),new Error("未找到要更新的直播安排");const{data:i,error:o}=await supabase.from("live_stream_schedules").select("*").eq("id",parseInt(e)).single();if(o)throw console.error("❌ 获取完整数据失败:",o),o;const a=i.participant_ids||[];let l=[];if(a.length>0){const{data:e}=await supabase.from("users_profile").select("id, nickname, email").in("id",a);l=(e||[]).map(e=>({id:e.id.toString(),name:e.nickname||e.email,department:"",avatar:void 0}))}return{id:i.id.toString(),date:i.date,timeSlotId:i.time_slot_id,managers:l,location:{id:i.location||"default",name:i.location||""},propertyType:{id:i.notes||"",name:i.notes||""},status:i.status,createdAt:i.created_at,updatedAt:i.updated_at,createdBy:i.created_by,editingBy:i.editing_by,editingAt:i.editing_at,editingExpiresAt:i.editing_expires_at,lockType:i.lock_type,lockReason:i.lock_reason,lockEndTime:i.lock_end_time}}catch(r){throw console.error("❌ 更新直播安排失败:",r),r}},cleanupExpiredEditingStatus=async()=>{try{console.log("🧹 [Cleanup] 开始清理过期的编辑状态");const e=3e4,t=new Date(Date.now()-e).toISOString();console.log("🧹 [Cleanup] 清理条件:",{status:"editing",editing_expires_at_lt:t,current_time:(new Date).toISOString()});const{data:r,error:s}=await supabase.from("live_stream_schedules").update({status:"available",editing_by:null,editing_at:null,editing_expires_at:null}).eq("status","editing").lt("editing_expires_at",(new Date).toISOString()).select();if(s)throw console.error("❌ 清理过期编辑状态失败:",s),s}catch(e){throw console.error("❌ 清理过期编辑状态时发生异常:",e),e}},lockLiveStreamSchedule=async(e,t,r,s)=>{var n;try{const i={status:"locked",lock_type:t,lock_reason:r||null,lock_end_time:s||null,updated_at:(new Date).toISOString()},{data:o,error:a}=await supabase.from("live_stream_schedules").update(i).eq("id",parseInt(e)).select("*").single();if(a)throw a;return{id:o.id.toString(),date:o.date,timeSlotId:o.time_slot_id,managers:(null==(n=o.participant_ids)?void 0:n.map(e=>({id:e.toString(),name:`用户${e}`,department:"",avatar:void 0})))||[],location:{id:o.location||"",name:o.location||""},propertyType:{id:o.notes||"",name:o.notes||""},status:o.status,createdAt:o.created_at,updatedAt:o.updated_at,createdBy:o.created_by,editingBy:o.editing_by,editingAt:o.editing_at,editingExpiresAt:o.editing_expires_at,lockType:o.lock_type,lockReason:o.lock_reason,lockEndTime:o.lock_end_time}}catch(i){throw console.error("锁定直播场次失败:",i),i}},unlockLiveStreamSchedule=async e=>{var t;try{const r={status:"available",lock_type:"none",lock_reason:null,lock_end_time:null,updated_at:(new Date).toISOString()},{data:s,error:n}=await supabase.from("live_stream_schedules").update(r).eq("id",parseInt(e)).select("*").single();if(n)throw n;return{id:s.id.toString(),date:s.date,timeSlotId:s.time_slot_id,managers:(null==(t=s.participant_ids)?void 0:t.map(e=>({id:e.toString(),name:`用户${e}`,department:"",avatar:void 0})))||[],location:{id:s.location||"",name:s.location||""},propertyType:{id:s.notes||"",name:s.notes||""},status:s.status,createdAt:s.created_at,updatedAt:s.updated_at,createdBy:s.created_by,editingBy:s.editing_by,editingAt:s.editing_at,editingExpiresAt:s.editing_expires_at,lockType:s.lock_type,lockReason:s.lock_reason,lockEndTime:s.lock_end_time}}catch(r){throw console.error("解锁直播场次失败:",r),r}},_RealtimeManager=class e{constructor(){__publicField(this,"connections",new Map),__publicField(this,"subscriptions",new Map),__publicField(this,"dataChangeListeners",new Map),__publicField(this,"subscriptionCallbacks",new Map),__publicField(this,"config"),__publicField(this,"isEnabled",!0),__publicField(this,"cleanupTimer",null),__publicField(this,"visibilityChangeHandler",null),__publicField(this,"poolHits",0),__publicField(this,"poolMisses",0),__publicField(this,"reconnects",0),__publicField(this,"errors",0),__publicField(this,"eventTarget",new EventTarget),__publicField(this,"processedEvents",new Set),this.config={maxConnections:5,minConnections:1,pageIdleTimeout:6e4,pageMaxAge:3e5,longTermIdleTimeout:18e5,longTermMaxAge:72e5,enabled:!0},this.setupVisibilityChangeHandler(),this.startCleanupTimer()}static getInstance(){return e.instance||(e.instance=new e),e.instance}setupVisibilityChangeHandler(){"undefined"!=typeof document&&(this.visibilityChangeHandler=()=>{document.hidden?(console.log("🔍 [RealtimeManager] 页面不可见，暂停页面连接"),this.pausePageConnections()):(console.log("🔍 [RealtimeManager] 页面可见，恢复页面连接"),this.resumePageConnections())},document.addEventListener("visibilitychange",this.visibilityChangeHandler))}pausePageConnections(){this.connections.forEach((e,t)=>{"page"===e.connectionType&&e.isActive&&(console.log(`⏸️ [RealtimeManager] 暂停页面连接: ${t}`),e.isActive=!1,e.lastUsed=Date.now())})}resumePageConnections(){this.connections.forEach((e,t)=>{"page"!==e.connectionType||e.isActive||(console.log(`▶️ [RealtimeManager] 恢复页面连接: ${t}`),e.isActive=!0,e.lastUsed=Date.now(),this.resubscribeConnection(e))})}async resubscribeConnection(e){console.log(`🔄 [RealtimeManager] 重新订阅连接: ${e.id}`);const t=Array.from(this.subscriptions.values()).filter(t=>t.userId===e.userId&&t.source===e.source&&t.connectionType===e.connectionType);console.log(`🔄 [RealtimeManager] 找到 ${t.length} 个需要重新订阅的订阅`);try{supabase.removeChannel(e.channel);const r=supabase.channel(e.id);e.channel=r;for(const s of t)await this.resubscribeSingleSubscription(e,s);console.log(`✅ [RealtimeManager] 连接重新订阅完成: ${e.id}`)}catch(r){console.error(`❌ [RealtimeManager] 重新订阅连接失败: ${e.id}`,r)}}async resubscribeSingleSubscription(e,t){try{console.log(`🔄 [RealtimeManager] 重新订阅: ${t.id}`);const r=this.subscriptionCallbacks.get(t.id);e.channel.on("postgres_changes",{event:t.event,schema:"public",table:t.table,filter:t.filter},e=>{try{console.log(`📡 [RealtimeManager] 收到数据变化: table=${t.table}, event=${t.event}`),r&&r(e),this.notifyDataChangeListeners(t.table,t.event,e)}catch(s){console.error("❌ [RealtimeManager] 回调执行失败:",s),this.errors++}}),e.channel.subscribe(e=>{console.log(`📡 [RealtimeManager] 重新订阅状态变化: ${t.id}, 状态: ${e}`),"SUBSCRIBED"===e?console.log(`✅ [RealtimeManager] 重新订阅成功: ${t.id}`):"CHANNEL_ERROR"===e?(console.error(`❌ [RealtimeManager] 重新订阅失败: ${t.id}, 状态: ${e}`),this.errors++,this.reconnects++,this.scheduleReconnect(t.id,{table:t.table,event:t.event,filter:t.filter,source:t.source},t.userId,t.connectionType||"page")):"TIMED_OUT"===e&&(console.error(`❌ [RealtimeManager] 重新订阅超时: ${t.id}, 状态: ${e}`),this.errors++,this.reconnects++,this.scheduleReconnect(t.id,{table:t.table,event:t.event,filter:t.filter,source:t.source},t.userId,t.connectionType||"page"))})}catch(r){console.error(`❌ [RealtimeManager] 重新订阅单个订阅失败: ${t.id}`,r)}}startCleanupTimer(){this.cleanupTimer=setInterval(()=>{this.cleanupConnections()},3e4)}determineConnectionType(e){if(e.includes("page")||e.includes("component")||e.includes("Page"))return"page";if(e.includes("service")||e.includes("api")||e.includes("Service"))return"long-term";try{const e=(new Error).stack||"";if(e.includes("useRealtime")||e.includes("useEffect")||e.includes("component"))return"page"}catch(t){}return"page"}async getOrCreateConnection(e,t){if(!this.isEnabled)return console.warn("⚠️ [RealtimeManager] Realtime功能已禁用"),null;const r=this.determineConnectionType(t);for(const[n,i]of this.connections)if(i.userId===e&&i.source===t&&i.connectionType===r&&i.isActive)return i.lastUsed=Date.now(),this.poolHits++,console.log(`🎯 [RealtimeManager] 连接池命中: ${n}`),i;if(this.connections.size>=this.config.maxConnections)return console.warn("⚠️ [RealtimeManager] 已达到最大连接数限制"),this.poolMisses++,null;try{const s=`conn_${e}_${t}_${Date.now()}`,n={id:s,channel:supabase.channel(s),userId:e,createdAt:Date.now(),lastUsed:Date.now(),isActive:!0,subscriptionCount:0,source:t,connectionType:r};return this.connections.set(s,n),this.poolMisses++,this.emitStateChange(),n}catch(s){return console.error("❌ [RealtimeManager] 创建连接失败:",s),this.errors++,null}}async requestSubscriptionPermission(e,t,r){if(!this.isEnabled)return{allowed:!1,reason:"Realtime功能已禁用"};if(!(await this.getOrCreateConnection(e,t.source||"unknown")))return{allowed:!1,reason:"无法获取连接，连接池已满或功能被禁用",connectionAvailable:!1};const s=Array.from(this.subscriptions.values()).filter(r=>r.userId===e&&r.table===t.table&&r.event===t.event&&r.filter===t.filter&&r.source===t.source);if(s.length>0){const e=s.reduce((e,t)=>t.lastUsed&&t.lastUsed>(e.lastUsed||0)?t:e);return console.log(`🔄 [RealtimeManager] 发现重复订阅，使用现有订阅: ${e.id}`),r&&(this.subscriptionCallbacks.set(e.id,r),console.log(`🔄 [RealtimeManager] 更新现有订阅的回调函数: ${e.id}`)),{allowed:!1,reason:"已存在相同的订阅",existingSubscriptionId:e.id,connectionAvailable:!0}}return{allowed:!0,connectionAvailable:!0}}async subscribe(e,t,r){console.log("🔧 [RealtimeManager] 创建订阅:",{userId:e,table:t.table,event:t.event,source:t.source,hasCallback:!!r});const s=await this.requestSubscriptionPermission(e,t,r);if(!s.allowed){if(s.existingSubscriptionId){console.log(`🔄 [RealtimeManager] 使用现有订阅: ${s.existingSubscriptionId}`);const e=this.subscriptions.get(s.existingSubscriptionId);return e&&(e.lastUsed=Date.now(),r&&(console.log(`🔄 [RealtimeManager] 更新现有订阅的回调函数: ${s.existingSubscriptionId}`),this.subscriptionCallbacks.set(s.existingSubscriptionId,r))),s.existingSubscriptionId}throw new Error(s.reason||"订阅被拒绝")}const n=await this.getOrCreateConnection(e,t.source||"unknown");if(!n)throw new Error("无法获取连接");const i=Array.from(this.subscriptions.values()).filter(r=>r.userId===e&&r.table===t.table&&r.event===t.event&&r.filter===t.filter&&r.source===t.source);if(i.length>0){const e=i.reduce((e,t)=>t.lastUsed&&t.lastUsed>(e.lastUsed||0)?t:e);return console.log(`🔄 [RealtimeManager] 创建订阅前发现重复订阅，使用现有订阅: ${e.id}`),r&&(this.subscriptionCallbacks.set(e.id,r),console.log(`🔄 [RealtimeManager] 更新现有订阅的回调函数: ${e.id}`)),e.lastUsed=Date.now(),e.id}const o=`sub_${t.table}_${t.event}_${Date.now()}`;r&&(this.subscriptionCallbacks.set(o,r),console.log(`🔗 [RealtimeManager] 预存储回调函数: ${o}`));try{n.channel.on("postgres_changes",{event:t.event,schema:"public",table:t.table,filter:t.filter},e=>{try{console.log(`📡 [RealtimeManager] 收到数据变化: table=${t.table}, event=${t.event}`);const s=this.subscriptionCallbacks.get(o);console.log("📡 [RealtimeManager] 回调状态:",{hasDirectCallback:!!r,hasStoredCallback:!!s,subscriptionId:o,totalStoredCallbacks:this.subscriptionCallbacks.size});const n=s||r;n?(console.log("📡 [RealtimeManager] 执行回调函数"),n(e)):(console.warn("⚠️ [RealtimeManager] 没有回调函数，跳过直接回调"),console.warn("⚠️ [RealtimeManager] 调试信息:",{subscriptionId:o,allStoredCallbacks:Array.from(this.subscriptionCallbacks.keys()),dataChangeCallback:!!r})),this.notifyDataChangeListeners(t.table,t.event,e)}catch(s){console.error("❌ [RealtimeManager] 回调执行失败:",s),this.errors++}}),n.channel.subscribe(r=>{console.log(`📡 [RealtimeManager] 订阅状态变化: ${o}, 状态: ${r}`),"SUBSCRIBED"===r?console.log(`✅ [RealtimeManager] 订阅成功: ${o}`):"CHANNEL_ERROR"===r?(console.error(`❌ [RealtimeManager] 订阅失败: ${o}, 状态: ${r}`),console.error("❌ [RealtimeManager] 连接信息:",{connectionId:n.id,userId:n.userId,source:n.source,isActive:n.isActive,subscriptionCount:n.subscriptionCount}),this.errors++,this.reconnects++,this.scheduleReconnect(o,t,e,n.connectionType)):"TIMED_OUT"===r?(console.error(`❌ [RealtimeManager] 订阅超时: ${o}, 状态: ${r}`),this.errors++,this.reconnects++,this.scheduleReconnect(o,t,e,n.connectionType)):console.log(`📡 [RealtimeManager] 订阅状态: ${o}, 状态: ${r}`)});const s={id:o,userId:e,createdAt:Date.now(),connectionType:n.connectionType,...t};return this.subscriptions.set(o,s),n.subscriptionCount++,n.lastUsed=Date.now(),console.log(`🔗 [RealtimeManager] 新增订阅: ${o}`),this.emitStateChange(),this.emitSubscriptionChange(),o}catch(a){throw console.error("❌ [RealtimeManager] 创建订阅失败:",a),this.errors++,a}}unsubscribe(e){const t=this.subscriptions.get(e);if(t){for(const[s,n]of this.connections)if(n.userId===t.userId&&n.source===t.source&&n.connectionType===t.connectionType){if(n.subscriptionCount--,n.lastUsed=Date.now(),n.subscriptionCount<=0)try{supabase.removeChannel(n.channel),this.connections.delete(s),console.log(`🗑️ [RealtimeManager] 已清理连接和订阅: ${s} - ${e}`)}catch(r){console.warn(`⚠️ [RealtimeManager] 清理连接失败: ${s}`,r)}else console.log(`🗑️ [RealtimeManager] 已取消订阅: ${e} (连接仍有其他订阅)`);break}this.subscriptions.delete(e),this.subscriptionCallbacks.delete(e),this.emitStateChange(),this.emitSubscriptionChange()}else console.warn(`⚠️ [RealtimeManager] 订阅不存在: ${e}`)}unsubscribeAll(e){Array.from(this.subscriptions.entries()).filter(([t,r])=>r.userId===e).forEach(([e,t])=>{this.unsubscribe(e)})}cleanupConnections(){const e=Date.now(),t=[];this.connections.forEach((r,s)=>{const n=e-r.createdAt,i=e-r.lastUsed;let o=!1;o="page"===r.connectionType?i>this.config.pageIdleTimeout||n>this.config.pageMaxAge:i>this.config.longTermIdleTimeout||n>this.config.longTermMaxAge,0===r.subscriptionCount&&i>6e4&&(o=!0),o&&t.push(s)}),t.forEach(e=>{const t=this.connections.get(e);if(t){try{supabase.removeChannel(t.channel)}catch(r){console.warn("⚠️ [RealtimeManager] 移除连接失败:",r)}this.connections.delete(e)}}),this.connections.size,this.config.minConnections}findDuplicateSubscriptions(){const e=new Map;this.subscriptions.forEach(t=>{const r=`${t.table}_${t.event}_${t.filter||"no-filter"}`;e.has(r)||e.set(r,[]),e.get(r).push(t)});const t=[];return e.forEach((e,r)=>{if(e.length>1){const[s,n,i]=r.split("_");t.push({table:s,event:n,filter:"no-filter"===i?void 0:i,duplicates:e})}}),t}getStats(){const e=Date.now(),t=Array.from(this.connections.values()),r=t.filter(e=>e.isActive).length,s=t.filter(e=>!e.isActive).length;return{totalConnections:this.connections.size,activeSubscriptions:this.subscriptions.size,reconnects:this.reconnects,errors:this.errors,isConnected:this.connections.size>0,config:this.config,subscriptions:Array.from(this.subscriptions.values()).map(e=>({id:e.id,table:e.table,event:e.event,source:e.source||"unknown",userId:e.userId})),connectionPool:{totalConnections:this.connections.size,activeConnections:r,idleConnections:s,queuedRequests:0,poolHits:this.poolHits,poolMisses:this.poolMisses,connections:t.map(t=>({...t,age:e-t.createdAt,idleTime:e-t.lastUsed}))},dataChangeListeners:{totalListeners:this.dataChangeListeners.size,processedEvents:this.processedEvents.size,listeners:Array.from(this.dataChangeListeners.values()).map(e=>({id:e.id,table:e.table,event:e.event,source:e.source||"unknown"}))}}}setEnabled(e){this.isEnabled=e,e||this.cleanupAll()}scheduleReconnect(e,t,r,s){console.log(`🔄 [RealtimeManager] 安排重连: ${e}`);const n=this.subscriptionCallbacks.get(e);console.log(`🔄 [RealtimeManager] 保存回调函数用于重连: ${e}`,!!n),setTimeout(async()=>{try{this.subscriptions.delete(e);for(const[e,n]of this.connections)if(n.userId===r&&n.source===t.source&&n.connectionType===s){try{supabase.removeChannel(n.channel),this.connections.delete(e),console.log(`🗑️ [RealtimeManager] 清理失败连接: ${e}`)}catch(i){console.warn(`⚠️ [RealtimeManager] 清理连接失败: ${e}`,i)}break}const o=await this.subscribe(r,t,n||void 0);o?(console.log(`✅ [RealtimeManager] 重连成功: ${o}`),n&&(this.subscriptionCallbacks.delete(e),console.log(`🗑️ [RealtimeManager] 清理旧回调函数: ${e}`))):console.error(`❌ [RealtimeManager] 重连失败: ${e}`)}catch(i){console.error("❌ [RealtimeManager] 重连过程中出错:",i)}},5e3)}cleanupAll(){console.log("🗑️ [RealtimeManager] 开始清理所有连接和订阅"),this.connections.forEach((e,t)=>{try{supabase.removeChannel(e.channel),console.log(`🗑️ [RealtimeManager] 已清理连接: ${t}`)}catch(r){console.warn("⚠️ [RealtimeManager] 移除连接失败:",r)}}),this.connections.clear(),this.subscriptions.clear(),this.cleanupAllDataChangeListeners(),this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.visibilityChangeHandler&&"undefined"!=typeof document&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.visibilityChangeHandler=null)}cleanupUserSubscriptions(e){console.log(`🗑️ [RealtimeManager] 清理用户 ${e} 的所有订阅`);const t=Array.from(this.subscriptions.entries()).filter(([t,r])=>r.userId===e);t.forEach(([e,t])=>{this.unsubscribe(e)}),console.log(`✅ [RealtimeManager] 已清理用户 ${e} 的 ${t.length} 个订阅`)}cleanupByConnectionType(e){console.log(`🗑️ [RealtimeManager] 清理 ${e} 类型的所有订阅`);const t=Array.from(this.subscriptions.entries()).filter(([t,r])=>r.connectionType===e);t.forEach(([e,t])=>{this.unsubscribe(e)}),console.log(`✅ [RealtimeManager] 已清理 ${e} 类型的 ${t.length} 个订阅`)}cleanupBySource(e){console.log(`🗑️ [RealtimeManager] 清理来源 ${e} 的所有订阅`);const t=Array.from(this.subscriptions.entries()).filter(([t,r])=>r.source===e);t.forEach(([e,t])=>{this.unsubscribe(e)}),console.log(`✅ [RealtimeManager] 已清理来源 ${e} 的 ${t.length} 个订阅`)}cleanupExpiredSubscriptions(e=18e5){console.log(`🗑️ [RealtimeManager] 清理超过 ${e/1e3/60} 分钟的订阅`);const t=Date.now(),r=Array.from(this.subscriptions.entries()).filter(([r,s])=>t-s.createdAt>e);r.forEach(([e,t])=>{this.unsubscribe(e)}),console.log(`✅ [RealtimeManager] 已清理 ${r.length} 个过期订阅`)}forceCleanupSubscriptions(){console.log("🗑️ [RealtimeManager] 强制清理所有订阅"),this.subscriptions.forEach((e,t)=>{this.subscriptions.delete(t)}),this.connections.forEach(e=>{e.subscriptionCount=0}),console.log("✅ [RealtimeManager] 已强制清理所有订阅")}cleanupAllDataChangeListeners(){console.log("🗑️ [RealtimeManager] 清理所有数据变化监听器"),this.dataChangeListeners.clear(),this.processedEvents.clear(),console.log("✅ [RealtimeManager] 已清理所有数据变化监听器")}cleanupDataChangeListenersBySource(e){console.log(`🗑️ [RealtimeManager] 清理来源 ${e} 的数据变化监听器`);const t=[];this.dataChangeListeners.forEach((r,s)=>{r.source===e&&t.push(s)}),t.forEach(e=>{this.dataChangeListeners.delete(e)}),console.log(`✅ [RealtimeManager] 已清理 ${t.length} 个数据变化监听器`)}registerDataChangeListener(e){const t=this.findDuplicateListener(e);if(t)return console.log(`🔄 [RealtimeManager] 发现重复监听器，返回现有ID: ${t.id}`),t.id;const r=`listener_${e.table}_${e.event}_${Date.now()}`,s={id:r,...e};return this.dataChangeListeners.set(r,s),console.log(`📡 [RealtimeManager] 注册数据变化监听器: ${r}`),console.log(`📡 [RealtimeManager] 当前监听器总数: ${this.dataChangeListeners.size}`),r}findDuplicateListener(e){for(const t of this.dataChangeListeners.values())if(t.table===e.table&&t.event===e.event&&t.source===e.source&&t.callback===e.callback)return t;return null}unregisterDataChangeListener(e){this.dataChangeListeners.delete(e)?(console.log(`🗑️ [RealtimeManager] 取消数据变化监听器: ${e}`),console.log(`🗑️ [RealtimeManager] 剩余监听器数量: ${this.dataChangeListeners.size}`)):console.warn(`⚠️ [RealtimeManager] 监听器不存在: ${e}`)}notifyDataChangeListeners(e,t,r){const s=`${e}_${t}_${r.commit_timestamp||Date.now()}_${JSON.stringify(r.new||r.old)}`;if(this.processedEvents.has(s))console.log(`⏭️ [RealtimeManager] 跳过重复事件: ${s}`);else{if(this.processedEvents.add(s),this.processedEvents.size>100){const e=Array.from(this.processedEvents).slice(-50);this.processedEvents=new Set(e)}console.log(`📡 [RealtimeManager] 通知数据变化监听器: table=${e}, event=${t}, listeners=${this.dataChangeListeners.size}`),console.log("📡 [RealtimeManager] 监听器列表:",Array.from(this.dataChangeListeners.values()).map(e=>({id:e.id,table:e.table,event:e.event,source:e.source}))),this.dataChangeListeners.forEach(s=>{if(console.log(`📡 [RealtimeManager] 检查监听器: ${s.id}, table=${s.table}, event=${s.event}`),s.table!==e||s.event!==t&&"*"!==s.event)console.log(`📡 [RealtimeManager] 不匹配监听器: ${s.id}, table=${s.table} vs ${e}, event=${s.event} vs ${t}`);else{console.log(`📡 [RealtimeManager] 匹配监听器: ${s.id}, 执行回调`);try{s.callback(r)}catch(n){console.error(`❌ [RealtimeManager] 数据变化监听器执行失败: ${s.id}`,n)}}})}}emitStateChange(){this.eventTarget.dispatchEvent(new CustomEvent("stateChange",{detail:this.getStats()}))}emitSubscriptionChange(){this.eventTarget.dispatchEvent(new CustomEvent("subscriptionChange",{detail:this.getStats()}))}addEventListener(e,t){this.eventTarget.addEventListener(e,t)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}};__publicField(_RealtimeManager,"instance");let RealtimeManager=_RealtimeManager;const realtimeManager=RealtimeManager.getInstance(),useRealtimeConcurrencyControl=e=>{const[t,r]=reactExports.useState({}),[s,n]=reactExports.useState({}),[i,o]=reactExports.useState(new Set),[a,l]=reactExports.useState(!1),c=reactExports.useRef({}),{getCachedUserInfo:u,user:d,profile:p}=useUser(),m=reactExports.useRef(null),h=reactExports.useRef(null);reactExports.useEffect(()=>{var e;const t=()=>{const e=realtimeManager.getStats(),t=e.isConnected;l(t),console.log("🔄 [Realtime] 连接状态变化:",{connected:t,activeSubscriptions:e.activeSubscriptions,hasActiveSubscription:v.current.hasActiveSubscription})};t();const r=()=>{t()};return null==(e=realtimeManager.addEventListener)||e.call(realtimeManager,"stateChange",r),()=>{var e;null==(e=realtimeManager.removeEventListener)||e.call(realtimeManager,"stateChange",r)}},[]),reactExports.useCallback(e=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{l(e)},1e3)},[]),reactExports.useCallback(()=>{console.log("🔄 [Realtime] 连接断开，等待 RealtimeManager 自动重连...")},[]);const x=async()=>{if(!d)return null;const{data:e}=await supabase.from("users_profile").select("id").eq("user_id",d.id).single();return null==e?void 0:e.id},f=reactExports.useCallback(async e=>{var r;console.log("🔒 [acquireEditLock] 开始获取编辑锁定:",{scheduleId:e,timestamp:(new Date).toISOString()});try{const n=await x();if(!n)throw new Error("用户未登录");console.log("🔒 [acquireEditLock] 当前用户ID:",n);const i=t[e];if(console.log("🔒 [acquireEditLock] 检查现有锁定:",{scheduleId:e,existingLock:i,isExpired:!i||i.editing_expires_at<=(new Date).toISOString()}),i&&i.editing_expires_at>(new Date).toISOString())throw console.warn("⚠️ [acquireEditLock] 时间段已被锁定:",i),new Error(`该时间段正在被 ${i.user_name} 编辑`);const a=s[e];if(console.log("🔒 [acquireEditLock] 检查时间段锁定:",{scheduleId:e,timeSlotLock:a}),a)throw console.warn("⚠️ [acquireEditLock] 时间段被锁定:",a),new Error(`该时间段已被锁定: ${a.lock_reason}`);null==(r=(await supabase.from("live_stream_schedules").select("created_by").eq("id",parseInt(e)).single()).data)||r.created_by;const l=(new Date).toISOString(),u=new Date(Date.now()+3e5).toISOString();console.log("🔒 [acquireEditLock] 更新数据库状态为editing:",{scheduleId:e,currentUserId:n,editing_at:l,editing_expires_at:u,lock_duration_minutes:5});const{data:d,error:p}=await supabase.from("live_stream_schedules").update({status:"editing",editing_by:n,editing_at:l,editing_expires_at:u}).eq("id",parseInt(e)).select().single();if(console.log("🔒 [acquireEditLock] 数据库更新结果:",{success:!p,error:null==p?void 0:p.message,data:d}),p)throw p;console.log("🔒 [acquireEditLock] 设置本地锁定状态:",e),o(t=>new Set([...t,e]));const m=setTimeout(()=>{g(e),staticMethods.warning("编辑超时，已自动释放锁定")},3e5);return c.current[e]=m,{success:!0,data:d}}catch(n){return{success:!1,error:n.message}}},[t,s]),g=reactExports.useCallback(async e=>{var t;try{console.log("🔓 [releaseEditLock] 开始释放编辑锁定:",{scheduleId:e,timestamp:(new Date).toISOString(),stack:null==(t=(new Error).stack)?void 0:t.split("\n").slice(1,5).join("\n")});const r=await x();if(!r)return void console.log("🔓 [releaseEditLock] 用户未登录，跳过释放锁定:",e);console.log("🔓 [releaseEditLock] 当前用户ID:",r),c.current[e]&&(clearTimeout(c.current[e]),delete c.current[e],console.log("🔓 [releaseEditLock] 清除定时器:",e));const{data:s}=await supabase.from("live_stream_schedules").select("status").eq("id",parseInt(e)).single();console.log("🔓 [releaseEditLock] 当前记录状态:",{scheduleId:e,currentRecord:s,status:null==s?void 0:s.status});const n="booked"!==(null==s?void 0:s.status);console.log("🔓 [releaseEditLock] 是否重置状态:",{scheduleId:e,shouldResetStatus:n,currentStatus:null==s?void 0:s.status});const i={editing_by:null,editing_at:null,editing_expires_at:null};n&&(i.status="available"),console.log("🔓 [releaseEditLock] 准备更新数据库:",{scheduleId:e,updateData:i,currentUserId:r});const{error:a}=await supabase.from("live_stream_schedules").update(i).eq("id",parseInt(e)).eq("editing_by",r).select();if(a)throw console.error("❌ [releaseEditLock] 释放编辑锁定失败:",a),a;console.log("✅ [releaseEditLock] 数据库更新成功:",e),o(t=>{const r=new Set(t);return r.delete(e),console.log("🔓 [releaseEditLock] 更新本地锁定状态:",{scheduleId:e,beforeSize:t.size,afterSize:r.size,removedLock:e}),r}),console.log("✅ [releaseEditLock] 编辑锁定释放完成:",e)}catch(r){console.error("❌ [releaseEditLock] 释放锁定失败:",r)}},[]),y=reactExports.useCallback(async e=>{try{const t=await x();if(!t)return;await supabase.from("live_stream_schedules").update({editing_expires_at:new Date(Date.now()+3e5).toISOString()}).eq("id",parseInt(e)).eq("editing_by",t),c.current[e]&&clearTimeout(c.current[e]);const r=setTimeout(()=>{g(e),staticMethods.warning("编辑超时，已自动释放锁定")},3e5);c.current[e]=r}catch(t){console.error("延长锁定失败:",t)}},[g]),v=reactExports.useRef({isSubscribing:!1,subscriptionIds:[],hasActiveSubscription:!1,lastSubscriptionAttempt:0});reactExports.useEffect(()=>(v.current.hasActiveSubscription&&(console.log("🗑️ [Realtime] 组件挂载时清理旧订阅"),console.log("🗑️ [Realtime] 清理旧订阅状态"),v.current={isSubscribing:!1,subscriptionIds:[],hasActiveSubscription:!1,lastSubscriptionAttempt:0}),()=>{h.current&&clearTimeout(h.current),console.log("🗑️ [Realtime] 组件卸载时清理订阅"),v.current={isSubscribing:!1,subscriptionIds:[],hasActiveSubscription:!1,lastSubscriptionAttempt:0}}),[]),reactExports.useEffect(()=>{var e;if(!(null==p?void 0:p.id))return;const t=()=>{const e=realtimeManager.getStats(),t=e.activeSubscriptions>0,r=v.current.hasActiveSubscription;if(console.log("🔄 [Realtime] 状态检查:",{managerActiveSubscriptions:e.activeSubscriptions,localHasActive:r,localSubscriptionIds:v.current.subscriptionIds.length,isSubscribing:v.current.isSubscribing}),!t||r||v.current.isSubscribing)!t&&r&&(console.log("🔄 [Realtime] 检测到订阅被清理，重置状态"),v.current={isSubscribing:!1,subscriptionIds:[],hasActiveSubscription:!1,lastSubscriptionAttempt:0});else if(console.log("🔄 [Realtime] 检测到 RealtimeManager 创建的订阅，同步状态"),v.current.hasActiveSubscription=!0,e.subscriptions){const t=e.subscriptions.filter(e=>"ConcurrencyControl"===e.source&&"live_stream_schedules"===e.table);v.current.subscriptionIds=t.map(e=>e.id),console.log("✅ [Realtime] 同步订阅状态:",v.current.subscriptionIds)}};t();const r=()=>{t()};return null==(e=realtimeManager.addEventListener)||e.call(realtimeManager,"subscriptionChange",r),()=>{var e;null==(e=realtimeManager.removeEventListener)||e.call(realtimeManager,"subscriptionChange",r)}},[null==p?void 0:p.id]);const E=reactExports.useCallback(async t=>{if(!t||!t.id)return void console.warn("⚠️ [Realtime] INSERT 事件数据无效:",t);const r=performance.now();try{console.log("📢 [Realtime] INSERT 事件处理完成，卡片已更新:",{scheduleId:t.id,date:t.date,timeSlotId:t.time_slot_id}),(null==e?void 0:e.onDataChange)&&(console.log("🔄 [Realtime] 通知主组件数据变化 (INSERT)"),e.onDataChange({eventType:"INSERT",scheduleId:t.id.toString(),schedule:t}))}finally{const e=performance.now()-r;e>100&&console.warn(`⚠️ [实时性能] INSERT 事件处理耗时 ${e.toFixed(2)}ms`)}},[u,e]),j=reactExports.useCallback(async(t,s)=>{if(!t||!t.id)return void console.warn("⚠️ [Realtime] UPDATE 事件数据无效:",t);const n=t.status,i=null==s?void 0:s.status;console.log("🔄 [Realtime] 状态变化检测:",{schedule_id:t.id,old_status:i,new_status:n,has_status_change:i!==n}),i!==n?("editing"===n&&t.editing_by?await S(t):"available"===n?await C(t):"booked"===n?await k(t):"locked"===n&&await $(t),"editing"===i&&"editing"!==n&&r(e=>{const r={...e},s=r[t.id];return delete r[t.id],console.log("🔓 [Realtime] 清除编辑锁定状态:",{schedule_id:t.id,deleted_lock:s,remaining_locks:r}),r}),(null==e?void 0:e.onDataChange)&&(console.log("🔄 [Realtime] 通知主组件状态变化:",{scheduleId:t.id.toString(),oldStatus:i,newStatus:n}),e.onDataChange({eventType:"STATUS_CHANGE",scheduleId:t.id.toString(),schedule:t,oldSchedule:s,statusChange:{from:i,to:n}}))):console.log("🔄 [Realtime] 状态未变化，跳过处理:",t.id)},[e]),b=reactExports.useCallback(async t=>{t&&t.id?(console.log("🗑️ [Realtime] 处理 DELETE 事件:",t.id),(null==e?void 0:e.onDataChange)&&(console.log("🔄 [Realtime] 通知主组件数据变化 (DELETE)"),e.onDataChange({eventType:"DELETE",scheduleId:t.id.toString(),schedule:t}))):console.warn("⚠️ [Realtime] DELETE 事件数据无效:",t)},[e]),w=reactExports.useRef(null),R=reactExports.useCallback(async e=>{console.log("📡 [Realtime] 收到原始 payload:",e);const t=e.eventType,r=e.new||e.old;console.log(`📡 [Realtime] 处理数据变化: ${t}`,{eventType:t,table:"live_stream_schedules",schedule_id:null==r?void 0:r.id,status:null==r?void 0:r.status,editing_by:null==r?void 0:r.editing_by,editing_at:null==r?void 0:r.editing_at,editing_expires_at:null==r?void 0:r.editing_expires_at,payload:{old:e.old,new:e.new,commit_timestamp:e.commit_timestamp}}),"INSERT"===t?await E(r):"UPDATE"===t?await j(r,e.old):"DELETE"===t&&await b(e.old)},[E,j,b]);reactExports.useEffect(()=>{w.current=R},[R]);const _=reactExports.useRef(null);reactExports.useEffect(()=>{var e;if(!(null==p?void 0:p.id))return;console.log("🔄 [Realtime] 订阅数据变化",{profileId:p.id,existingSubscriptionId:_.current,stack:null==(e=(new Error).stack)?void 0:e.split("\n").slice(1,5).join("\n")}),_.current&&(console.log("🗑️ [Realtime] 取消现有订阅:",_.current),realtimeManager.unsubscribe(_.current),_.current=null);return realtimeManager.subscribe(p.id.toString(),{table:"live_stream_schedules",event:"*",source:"ConcurrencyControl"},e=>{console.log("📡 [Realtime] 稳定回调函数被调用:",e),w.current?w.current(e):console.warn("⚠️ [Realtime] handleDataChangeRef.current 为空")}).then(e=>{_.current=e,console.log("✅ [Realtime] 数据变化订阅成功:",e)}).catch(e=>{console.error("❌ [Realtime] 数据变化订阅失败:",e)}),()=>{console.log("🗑️ [Realtime] 取消数据变化订阅"),_.current&&(realtimeManager.unsubscribe(_.current),_.current=null)}},[null==p?void 0:p.id]);const S=reactExports.useCallback(async e=>{console.log("👤 [Realtime] 开始获取编辑用户信息:",{editing_by:e.editing_by});const{data:t}=await supabase.from("users_profile").select("nickname, email").eq("id",e.editing_by).single(),s=(null==t?void 0:t.nickname)||(null==t?void 0:t.email)||"未知用户";console.log("✅ [Realtime] 获取到用户信息:",{editing_by:e.editing_by,user_name:s,user_profile:t}),r(t=>{const r={...t,[e.id]:{editing_by:e.editing_by,editing_at:e.editing_at,editing_expires_at:e.editing_expires_at,user_name:s}};return console.log("🔒 [Realtime] 更新编辑锁定状态:",{schedule_id:e.id,new_lock:r[e.id],all_locks:r}),r}),console.log("📢 [Realtime] 编辑状态更新，卡片已渲染:",{scheduleId:e.id,userName:s,date:e.date,timeSlotId:e.time_slot_id})},[]),C=reactExports.useCallback(async e=>{console.log("📢 [Realtime] 可用状态更新，卡片已渲染:",{scheduleId:e.id,date:e.date,timeSlotId:e.time_slot_id})},[]),k=reactExports.useCallback(async e=>{console.log("👤 [Realtime] 开始获取报名用户信息:",{created_by:e.created_by});const{data:t}=await supabase.from("users_profile").select("nickname, email").eq("id",e.created_by).single(),r=(null==t?void 0:t.nickname)||(null==t?void 0:t.email)||"未知用户";console.log("✅ [Realtime] 获取到报名用户信息:",{created_by:e.created_by,user_name:r,user_profile:t}),console.log("📢 [Realtime] 报名状态更新，卡片已渲染:",{scheduleId:e.id,userName:r,date:e.date,timeSlotId:e.time_slot_id})},[]),$=reactExports.useCallback(async e=>{n(t=>{const r={...t,[e.id]:{lock_type:e.lock_type,lock_reason:e.lock_reason,lock_end_time:e.lock_end_time}};return console.log("🔒 [Realtime] 更新时间段锁定状态:",{schedule_id:e.id,new_lock:r[e.id],all_locks:r}),r}),console.log("📢 [Realtime] 锁定状态更新，卡片已渲染:",{scheduleId:e.id,date:e.date,timeSlotId:e.time_slot_id,lockType:e.lock_type,lockReason:e.lock_reason})},[]);reactExports.useEffect(()=>{const e=setInterval(async()=>{for(const e of i)await y(e)},6e4);return()=>clearInterval(e)},[i,y]);const T=reactExports.useRef(new Set);return reactExports.useEffect(()=>{T.current=i},[i]),reactExports.useEffect(()=>()=>{console.log("🗑️ [Cleanup] 组件卸载，释放所有编辑锁定:",Array.from(T.current)),T.current.forEach(e=>{g(e)})},[]),{editLocks:t,timeSlotLocks:s,currentUserLocks:i,isConnected:a,acquireEditLock:f,releaseEditLock:g,isBeingEdited:e=>{const r=t[e];return r&&r.editing_expires_at>(new Date).toISOString()},isLocked:e=>!!s[e],isBeingEditedByCurrentUser:e=>i.has(e),getEditLockInfo:e=>t[e],getTimeSlotLockInfo:e=>s[e]}},LiveStreamCardContextMenu=({children:e,onEdit:t,onHistory:r,onRate:s,onRelease:n,onLock:i,onUnlock:o,onCreate:a,isLocked:l=!1})=>{const{hasLiveStreamManagePermission:c}=useRolePermissions(),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{try{const e=await c();d(e),m(!0)}catch(e){console.error("检查直播管理权限失败:",e),d(!1),m(!0)}})()},[c]);const h=[...a?[{key:"create",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),label:"创建新场次"}]:[],...t?[{key:"edit",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),label:"编辑记录"}]:[],...r?[{key:"history",icon:jsxRuntimeExports.jsx(RefIcon$R,{}),label:"查看记录历史"}]:[],...u&&s?[{key:"rate",icon:jsxRuntimeExports.jsx(RefIcon$S,{}),label:"直播评分"}]:[],...u&&n?[{key:"release",icon:jsxRuntimeExports.jsx(RefIcon$O,{}),label:"释放场次",danger:!0}]:[],...u&&(i||o)?[{type:"divider"}]:[],...u&&(i||o)?[{key:l?"unlock":"lock",icon:l?jsxRuntimeExports.jsx(RefIcon$17,{}):jsxRuntimeExports.jsx(RefIcon$p,{}),label:l?"解锁场次":"锁定场次",danger:l}]:[]];return jsxRuntimeExports.jsx(Dropdown,{menu:{items:h,onClick:({key:e})=>{const l=()=>!!u||(staticMethods.warning("您没有直播管理权限，无法执行此操作"),!1);switch(e){case"edit":null==t||t();break;case"history":null==r||r();break;case"rate":if(!l())return;null==s||s();break;case"release":if(!l())return;Modal$2.confirm({title:"确认释放场次？",content:"释放后该场次将变为可报名状态，确定要释放吗？",okText:"确认",cancelText:"取消",onOk:()=>null==n?void 0:n()});break;case"lock":if(!l())return;Modal$2.confirm({title:"确认锁定场次？",content:"锁定后该场次将无法被编辑或报名，确定要锁定吗？",okText:"确认",cancelText:"取消",onOk:()=>null==i?void 0:i()});break;case"unlock":if(!l())return;Modal$2.confirm({title:"确认解锁场次？",content:"解锁后该场次将变为可报名状态，确定要解锁吗？",okText:"确认",cancelText:"取消",onOk:()=>null==o?void 0:o()});break;case"create":null==a||a()}}},trigger:["contextMenu"],children:jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",pointerEvents:"auto"},children:e})})};var relativeTime$1={exports:{}};relativeTime$1.exports=function(e,t,r){e=e||{};var s=t.prototype,n={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function i(e,t,r,n){return s.fromToBase(e,t,r,n)}r.en.relativeTime=n,s.fromToBase=function(t,s,i,o,a){for(var l,c,u,d=i.$locale().relativeTime||n,p=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],m=p.length,h=0;h<m;h+=1){var x=p[h];x.d&&(l=o?r(t).diff(i,x.d,!0):i.diff(t,x.d,!0));var f=(e.rounding||Math.round)(Math.abs(l));if(u=l>0,f<=x.r||!x.r){f<=1&&h>0&&(x=p[h-1]);var g=d[x.l];a&&(f=a(""+f)),c="string"==typeof g?g.replace("%d",f):g(f,s,x.l,u);break}}if(s)return c;var y=u?d.future:d.past;return"function"==typeof y?y(c):y.replace("%s",c)},s.to=function(e,t){return i(e,t,this,!0)},s.from=function(e,t){return i(e,t,this)};var o=function(e){return e.$u?r.utc():r()};s.toNow=function(e){return this.to(o(this),e)},s.fromNow=function(e){return this.from(o(this),e)}};var relativeTimeExports=relativeTime$1.exports;const relativeTime=getDefaultExportFromCjs(relativeTimeExports);dayjs.extend(relativeTime),dayjs.extend(utc),dayjs.extend(timezone),dayjs.tz.setDefault("Asia/Shanghai");const{Text:Text$3}=Typography,LiveStreamHistoryDrawer=({visible:e,onClose:t,scheduleId:r,scheduleTitle:s="直播场次历史记录"})=>{const[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState({}),[u,d]=reactExports.useState({}),[p,m]=reactExports.useState({}),h=e=>dayjs.tz(e,"Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss"),x=reactExports.useMemo(()=>[{title:"操作时间",dataIndex:"operation_time",key:"operation_time",width:180,render:e=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"500"},children:h(e)}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999"},children:dayjs.tz(e,"Asia/Shanghai").fromNow()})]})},{title:"操作类型",key:"operation_type",width:120,render:(e,t)=>{return(r=t).participants&&0!==r.participants.length?2===r.participants.length?jsxRuntimeExports.jsx(Tag$1,{color:"green",children:"报名成功"}):jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:"编辑记录"}):jsxRuntimeExports.jsx(Tag$1,{color:"red",children:"释放场次"});var r}},{title:"操作者",dataIndex:"operator_name",key:"operator_name",width:120,render:(e,t)=>{const r=t.operator_id&&l[t.operator_id]?l[t.operator_id]:e||`用户${t.operator_id}`||"未知用户";return jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{color:"#1890ff"}}),jsxRuntimeExports.jsx("span",{children:r})]})}},{title:"参与者",key:"participants",render:(e,t)=>{const r=p[t.id.toString()]||[];return t.participants&&0!==t.participants.length?r.length>0?jsxRuntimeExports.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:r.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:"120px"},children:[jsxRuntimeExports.jsx(Tag$1,{color:"blue",style:{marginBottom:"2px"},children:e.nickname}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.department})]},t))}):jsxRuntimeExports.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:t.participants.map((e,t)=>jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:"120px"},children:[jsxRuntimeExports.jsxs(Tag$1,{color:"orange",style:{marginBottom:"2px"},children:["用户",e]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"未知部门"})]},t))}):jsxRuntimeExports.jsx(Text$3,{type:"secondary",children:"无参与者"})}}],[u]);return reactExports.useEffect(()=>{e&&r&&(console.log("📋 打开历史记录抽屉，scheduleId:",r),(async()=>{if(r){a(!0);try{console.log("🔄 开始获取历史记录，scheduleId:",r);const{data:e,error:t}=await supabase.from("live_stream_schedule_logs").select("*").eq("schedule_id",parseInt(r)).order("operation_time",{ascending:!1});if(t)return void console.error("❌ 获取日志记录失败:",t);console.log("📊 获取到日志记录:",(null==e?void 0:e.length)||0,"条"),i(e||[]);const s=[...new Set((null==e?void 0:e.map(e=>e.operator_id).filter(Boolean))||[])];if(console.log("👥 操作者ID列表:",s),s.length>0){const{data:e,error:t}=await supabase.from("users_profile").select("id, nickname").in("id",s);if(!t&&e){const t={};e.forEach(e=>{t[e.id]=e.nickname||`用户${e.id}`}),console.log("💾 操作者姓名映射:",t),c(t)}else console.error("❌ 获取操作者信息失败:",t)}const n=new Set;if(null==e||e.forEach(e=>{console.log(`📋 日志 ${e.id} 的参与者:`,e.participants),e.participants&&Array.isArray(e.participants)&&e.participants.forEach(e=>{e&&"number"==typeof e&&n.add(e)})}),console.log("👥 参与者ID列表:",Array.from(n)),n.size>0){const t=Array.from(n),{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, organization_id").in("id",t);if(!s&&r){const t={},s={};r.forEach(e=>{t[e.id]=e.nickname||`用户${e.id}`,s[e.id]={id:e.id,nickname:e.nickname||`用户${e.id}`,department:"未知部门"}}),console.log("💾 参与者姓名映射:",t);const n=[...new Set(r.map(e=>e.organization_id).filter(Boolean))];if(n.length>0){const{data:e,error:t}=await supabase.from("organizations").select("id, name").in("id",n);if(!t&&e){const t={};e.forEach(e=>{t[e.id]=e.name}),r.forEach(e=>{e.organization_id&&t[e.organization_id]&&(s[e.id].department=t[e.organization_id])})}}const i={},o={};null==e||e.forEach(e=>{const t=`${e.id}`;if(e.participants&&Array.isArray(e.participants)){const r=[],n=[];e.participants.forEach(e=>{if(e&&"number"==typeof e){const t=s[e];t?(r.push(t),n.push(t.nickname)):(r.push({id:e,nickname:`用户${e}`,department:"未知部门"}),n.push(`用户${e}`))}}),i[t]=r,o[t]=n}else i[t]=[],o[t]=[]}),console.log("📋 日志参与者详情映射:",i),d(o),m(i)}else console.error("❌ 获取参与者信息失败:",s)}else console.log("ℹ️ 没有参与者信息需要获取")}catch(e){console.error("❌ 获取日志记录异常:",e)}finally{a(!1)}}})())},[e,r]),reactExports.useEffect(()=>{n.length>0&&(console.log("📊 日志数据示例:",n[0]),console.log("👥 用户姓名缓存:",l),console.log("👥 参与者姓名缓存:",u),console.log("👥 参与者详情缓存:",p))},[n,l,u,p]),jsxRuntimeExports.jsx(Drawer,{title:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(RefIcon$R,{style:{color:"#1890ff"}}),jsxRuntimeExports.jsx("span",{children:s})]}),placement:"right",width:600,onClose:t,open:e,styles:{header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},body:{padding:"24px"}},children:o?jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[jsxRuntimeExports.jsx(Spin,{size:"large"}),jsxRuntimeExports.jsx("div",{style:{marginTop:"16px",color:"#999"},children:"加载历史记录中..."})]}):0===n.length?jsxRuntimeExports.jsx(Empty$1,{description:"暂无历史记录",image:Empty$1.PRESENTED_IMAGE_SIMPLE}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:"16px"},children:jsxRuntimeExports.jsxs(Text$3,{type:"secondary",children:["共找到 ",n.length," 条历史记录"]})}),jsxRuntimeExports.jsx(ForwardTable,{columns:x,dataSource:n,rowKey:"id",pagination:!1,size:"small",scroll:{y:400},style:{"--ant-table-row-hover-bg":"transparent"}})]})})},getScoringDimensions=async()=>{try{const{data:e,error:t}=await supabase.from("live_stream_scoring_dimensions").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;return e||[]}catch(e){throw console.error("获取评分维度失败:",e),e}},getScoringOptions=async()=>{try{const{data:e,error:t}=await supabase.from("live_stream_scoring_options").select("*").eq("is_active",!0).order("sort_order");if(t)throw t;return e||[]}catch(e){throw console.error("获取评分选项失败:",e),e}},getLiveStreamScheduleScoring=async e=>{var t;try{const{data:r,error:s}=await supabase.from("live_stream_schedules").select("\n        id,\n        date,\n        time_slot_id,\n        created_by,\n        average_score,\n        scoring_status,\n        scored_by,\n        scored_at,\n        scoring_data,\n        users_profile!live_stream_schedules_scored_by_fkey(nickname)\n      ").eq("id",e).single();if(s)throw s;return r?{...r,evaluator_name:(null==(t=r.users_profile)?void 0:t.nickname)||null}:null}catch(r){throw console.error("获取直播日程评分信息失败:",r),r}},saveScoringData=async(e,t,r)=>{try{console.log("API - 准备保存评分数据:",{scheduleId:e,evaluatorId:r,scoringData:JSON.stringify(t,null,2)});const n={scoring_version:String(t.scoring_version),evaluator_id:Number(t.evaluator_id),evaluation_date:String(t.evaluation_date),dimensions:Object.fromEntries(Object.entries(t.dimensions).map(([e,t])=>[e,{selected_option:String(t.selected_option),score:Number(t.score),notes:String(t.notes)}])),calculation:{total_score:Number(t.calculation.total_score),average_score:Number(t.calculation.average_score),weighted_average:Number(t.calculation.weighted_average)},metadata:{created_at:String(t.metadata.created_at),updated_at:String(t.metadata.updated_at),evaluation_notes:String(t.metadata.evaluation_notes||"")}},i=JSON.stringify(n);console.log("API - JSON字符串:",i);try{JSON.parse(i),console.log("API - JSON格式验证通过")}catch(s){throw console.error("API - JSON格式验证失败:",s),new Error("JSON格式无效")}console.log("API - 清理后的评分数据:",JSON.stringify(n,null,2));const{error:o}=await supabase.from("live_stream_schedules").update({scoring_data:i,scored_by:r,scored_at:(new Date).toISOString(),average_score:n.calculation.weighted_average,scoring_status:"scored"}).eq("id",e);if(o)throw console.error("API - 更新失败:",o),o;console.log("API - 直接更新成功"),console.log("API - 直播日程表更新成功");const{error:a}=await supabase.from("live_stream_scoring_log").insert({schedule_id:e,evaluator_id:r,scoring_data:i,average_score:n.calculation.weighted_average,evaluation_notes:n.metadata.evaluation_notes||null});if(a)throw console.error("API - 插入评分日志失败:",a),a;return console.log("API - 评分日志插入成功"),!0}catch(s){throw console.error("保存评分数据失败:",s),s}},updateScoringStatus=async(e,t)=>{try{const{error:r}=await supabase.from("live_stream_schedules").update({scoring_status:t}).eq("id",e);if(r)throw r;return!0}catch(r){throw console.error("更新评分状态失败:",r),r}},createScoringDimension=async e=>{try{const{data:t,error:r}=await supabase.from("live_stream_scoring_dimensions").insert(e).select().single();if(r)throw r;return t}catch(t){throw console.error("创建评分维度失败:",t),t}},updateScoringDimension=async(e,t)=>{try{const{data:r,error:s}=await supabase.from("live_stream_scoring_dimensions").update({...t,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return r}catch(r){throw console.error("更新评分维度失败:",r),r}},deleteScoringDimension=async e=>{try{const{error:t}=await supabase.from("live_stream_scoring_dimensions").delete().eq("id",e);if(t)throw t;return!0}catch(t){throw console.error("删除评分维度失败:",t),t}},createScoringOption=async e=>{try{const{data:t,error:r}=await supabase.from("live_stream_scoring_options").insert(e).select().single();if(r)throw r;return t}catch(t){throw console.error("创建评分选项失败:",t),t}},updateScoringOption=async(e,t)=>{try{const{data:r,error:s}=await supabase.from("live_stream_scoring_options").update({...t,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return r}catch(r){throw console.error("更新评分选项失败:",r),r}},deleteScoringOption=async e=>{try{const{error:t}=await supabase.from("live_stream_scoring_options").delete().eq("id",e);if(t)throw t;return!0}catch(t){throw console.error("删除评分选项失败:",t),t}},{TextArea:TextArea$1}=Input$1,{Option:Option$2}=Select,LiveStreamScoringDrawer=({visible:e,schedule:t,onClose:r,onRefresh:s})=>{var n;const[i,o]=reactExports.useState(null),[a,l]=reactExports.useState(!1),[c,u]=reactExports.useState(!1),[d,p]=reactExports.useState([]),[m,h]=reactExports.useState([]),[x,f]=reactExports.useState(""),[g,y]=reactExports.useState(null),{profile:v}=useUser(),{hasLiveStreamManagePermission:E}=useRolePermissions(),[j,b]=reactExports.useState(!1),[w,R]=reactExports.useState(!1);reactExports.useEffect(()=>{e&&(async()=>{try{const e=await E();b(e),R(!0)}catch(e){console.error("检查直播管理权限失败:",e),b(!1),R(!0)}})()},[e,E]),reactExports.useEffect(()=>{e&&(async()=>{try{const[e,t]=await Promise.all([getScoringDimensions(),getScoringOptions()]);p(e),h(t)}catch(e){console.error("加载评分配置失败:",e),staticMethods.error("加载评分配置失败")}})()},[e]),reactExports.useEffect(()=>{(async()=>{var r;if(t&&e){console.log("加载评分数据 - 日程:",t),console.log("加载评分数据 - 日程ID:",t.id);try{u(!0);const e=await getLiveStreamScheduleScoring(parseInt(t.id));if(console.log("获取到的评分数据:",e),e)if(y(e),e.scoring_data){let t;try{t="string"==typeof e.scoring_data?JSON.parse(e.scoring_data):e.scoring_data,o(t),f((null==(r=t.metadata)?void 0:r.evaluation_notes)||"")}catch(s){console.error("解析评分数据失败:",s),o(null),f("")}}else o(null),f("");else{const e={id:parseInt(t.id),date:t.date,time_slot_id:t.timeSlotId,created_by:t.createdBy||0,average_score:null,scoring_status:null,scored_by:null,scored_at:null,scoring_data:null};console.log("创建基础数据结构:",e),y(e),o(null),f("")}l(!1)}catch(s){console.error("加载评分数据失败:",s),staticMethods.error("加载评分数据失败")}finally{u(!1)}}})()},[t,e]);const _=()=>({scoring_version:"1.0",evaluator_id:(null==v?void 0:v.id)||0,evaluation_date:toBeijingDateStr(dayjs()),dimensions:{},calculation:{total_score:0,average_score:0,weighted_average:0},metadata:{created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),evaluation_notes:""}}),S=(e,t)=>{const r=Object.entries(e).map(([e,r])=>{const s=t.find(t=>t.dimension_code===e);return{score:r.score,weight:(null==s?void 0:s.weight)||1}}),s=r.reduce((e,t)=>e+t.score,0),n=r.length>0?s/r.length:0,i=r.reduce((e,t)=>e+t.score*t.weight,0),o=r.reduce((e,t)=>e+t.weight,0);return{total_score:s,average_score:n,weighted_average:o>0?i/o:0}},C=()=>{if(!j)return void staticMethods.warning("您没有直播管理权限，无法执行评分操作");console.log("开始评分 - 用户ID:",null==v?void 0:v.id),console.log("开始评分 - 日程ID:",null==t?void 0:t.id);const e=_();console.log("初始评分数据:",e),o(e),l(!0)},k=async()=>{if(t&&i&&(null==v?void 0:v.id))if(j){u(!0);try{const e={...i,metadata:{...i.metadata,evaluation_notes:x,updated_at:(new Date).toISOString()}};console.log("准备保存的评分数据:",JSON.stringify(e,null,2)),await saveScoringData(parseInt(t.id),e,v.id),await updateScoringStatus(parseInt(t.id),"scored"),staticMethods.success("评分保存成功"),l(!1),null==s||s()}catch(e){console.error("保存评分失败:",e),staticMethods.error("评分保存失败")}finally{u(!1)}}else staticMethods.warning("您没有直播管理权限，无法执行评分操作")},$=async()=>{if(t&&i&&(null==v?void 0:v.id)){u(!0);try{const e={...i,metadata:{...i.metadata,evaluation_notes:x,updated_at:(new Date).toISOString()}};console.log("准备提交的评分数据:",JSON.stringify(e,null,2)),await saveScoringData(parseInt(t.id),e,v.id),await updateScoringStatus(parseInt(t.id),"approved"),staticMethods.success("评分提交成功"),l(!1),null==s||s()}catch(e){console.error("提交评分失败:",e),staticMethods.error("评分提交失败")}finally{u(!1)}}};return jsxRuntimeExports.jsx(Drawer,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$S,{}),jsxRuntimeExports.jsx("span",{children:"直播评分"})]}),placement:"right",width:500,open:e,onClose:r,extra:j?i?"approved"===(null==g?void 0:g.scoring_status)?jsxRuntimeExports.jsx(Button$1,{onClick:()=>l(!0),children:"编辑评分"}):a?jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>l(!1),children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:c,onClick:k,children:"保存评分"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",loading:c,onClick:$,children:"提交评分"})]}):jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>l(!0),children:"编辑评分"}):jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:C,children:"开始评分"}):jsxRuntimeExports.jsx("div",{style:{padding:"16px",textAlign:"center",color:"#999",background:"#f5f5f5",borderRadius:"6px"},children:"您没有直播管理权限，无法进行评分操作"}),children:t&&jsxRuntimeExports.jsxs("div",{style:{padding:"0 16px",height:"100%",display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsxs("div",{className:"schedule-info",children:[jsxRuntimeExports.jsxs("div",{className:"info-row",style:{justifyContent:"flex-start"},children:[jsxRuntimeExports.jsx(RefIcon$4,{style:{marginRight:"8px"}}),jsxRuntimeExports.jsxs("span",{children:[dayjs(null==t?void 0:t.date).format("YYYY-MM-DD")," ","morning-10-12"===(null==t?void 0:t.timeSlotId)?"10-12点":"afternoon-14-16"===(null==t?void 0:t.timeSlotId)?"14-16点":"afternoon-16-18"===(null==t?void 0:t.timeSlotId)?"16-18点":"evening-19-21"===(null==t?void 0:t.timeSlotId)?"19-21点":"evening-21-23"===(null==t?void 0:t.timeSlotId)?"21-23点":null==t?void 0:t.timeSlotId]})]}),(null==t?void 0:t.managers)&&t.managers.length>0&&jsxRuntimeExports.jsxs("div",{className:"info-row",style:{justifyContent:"flex-start"},children:[jsxRuntimeExports.jsx(RefIcon$5,{style:{marginRight:"8px"}}),jsxRuntimeExports.jsxs("span",{children:["参与人: ",t.managers.map(e=>e.name).join(" / ")]})]})]}),jsxRuntimeExports.jsx("div",{style:{flex:1,overflow:"auto"},children:c?jsxRuntimeExports.jsx("div",{className:"loading-scoring",children:jsxRuntimeExports.jsx("div",{className:"loading-text",children:"加载中..."})}):i?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"scoring-form",children:[jsxRuntimeExports.jsx("div",{className:"dimensions-list",children:d.map(e=>{var t,r;return jsxRuntimeExports.jsxs("div",{className:"dimension-row",children:[jsxRuntimeExports.jsxs("div",{className:"dimension-label",children:[e.dimension_name,jsxRuntimeExports.jsxs("span",{className:"dimension-weight",children:["(权重: ",e.weight,")"]})]}),jsxRuntimeExports.jsx("div",{className:"dimension-select",children:jsxRuntimeExports.jsx(Select,{value:null==(t=null==i?void 0:i.dimensions[e.dimension_code])?void 0:t.selected_option,onChange:t=>((e,t)=>{console.log("处理维度选择变化:",{dimensionCode:e,optionCode:t});const r=d.find(t=>t.dimension_code===e),s=m.find(r=>r.option_code===t&&r.dimension_code===e);if(!r||!s)return void console.error("未找到维度或选项:",{dimensionCode:e,optionCode:t,dimension:r,option:s});const n=i||_(),a=n.dimensions||{};if(!e||"string"!=typeof e)return void console.error("无效的维度代码:",e);const l={...n,evaluator_id:(null==v?void 0:v.id)||0,dimensions:{...a,[e]:{selected_option:t,score:s.score,notes:s.option_text}},calculation:S({...a,[e]:{selected_option:t,score:s.score,notes:s.option_text}},d),metadata:{...n.metadata,updated_at:(new Date).toISOString(),evaluation_notes:x}};console.log("维度选择变化 - 新数据:",JSON.stringify(l,null,2)),o(l)})(e.dimension_code,t),placeholder:`请选择${e.dimension_name}选项`,disabled:!a,size:"small",style:{width:"100%"},children:(r=e.dimension_code,m.filter(e=>e.dimension_code===r)).map(e=>jsxRuntimeExports.jsxs(Option$2,{value:e.option_code,children:[e.option_text," (",e.score,"分)"]},e.option_code))})})]},e.dimension_code)})}),a&&jsxRuntimeExports.jsxs("div",{className:"dimension-row evaluation-row",children:[jsxRuntimeExports.jsx("div",{className:"dimension-label",children:"评分备注"}),jsxRuntimeExports.jsx("div",{className:"dimension-select",children:jsxRuntimeExports.jsx(TextArea$1,{value:x,onChange:e=>f(e.target.value),placeholder:"请输入评分备注...",rows:3})})]}),(null==i?void 0:i.metadata.evaluation_notes)&&!a&&jsxRuntimeExports.jsxs("div",{className:"evaluation-notes-display",children:[jsxRuntimeExports.jsx("div",{className:"notes-label",children:"评分备注"}),jsxRuntimeExports.jsx("div",{className:"notes-content",children:i.metadata.evaluation_notes})]})]})}):jsxRuntimeExports.jsxs("div",{className:"empty-scoring",children:[jsxRuntimeExports.jsx(RefIcon$S,{className:"empty-icon"}),jsxRuntimeExports.jsx("div",{className:"empty-text",children:"暂无评分数据"})]})}),i&&jsxRuntimeExports.jsx("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:"16px",marginTop:"16px",padding:"16px"},children:i.calculation&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",color:"#333",fontSize:"16px"},children:"综合评分"}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"18px",fontWeight:"bold",color:"#1890ff"},children:(null==(n=i.calculation.weighted_average)?void 0:n.toFixed(1))||"0.0"}),jsxRuntimeExports.jsx("span",{style:{color:"#666",fontSize:"14px"},children:"分"}),(e=>{if(!e)return null;const t=e.calculation.weighted_average;return t>=8?jsxRuntimeExports.jsx(Tag$1,{color:"green",children:"优秀"}):t>=6?jsxRuntimeExports.jsx(Tag$1,{color:"blue",children:"良好"}):t>=4?jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:"一般"}):jsxRuntimeExports.jsx(Tag$1,{color:"red",children:"需改进"})})(i)]})]}),(null==g?void 0:g.evaluator_name)&&jsxRuntimeExports.jsxs("div",{style:{marginTop:"4px",fontSize:"12px",color:"#999",textAlign:"left"},children:["评分人: ",g.evaluator_name]})]})})]})})},CountdownTimer=({targetTime:e,onExpire:t,format:r="full",showIcon:s=!0,className:n="",style:i={}})=>{const[o,a]=reactExports.useState({days:0,hours:0,minutes:0,seconds:0,total:0}),[l,c]=reactExports.useState(!1),u=reactExports.useCallback(()=>{const t=(new Date).getTime(),r=e.getTime()-t;return r<=0?{days:0,hours:0,minutes:0,seconds:0,total:0}:{days:Math.floor(r/864e5),hours:Math.floor(r%864e5/36e5),minutes:Math.floor(r%36e5/6e4),seconds:Math.floor(r%6e4/1e3),total:r}},[e]);reactExports.useEffect(()=>{const e=()=>{const e=u();a(e),e.total<=0&&!l&&(c(!0),null==t||t())};e();const r=setInterval(e,1e3);return()=>clearInterval(r)},[u,t,l]);const d=e=>e.toString().padStart(2,"0");return jsxRuntimeExports.jsxs("div",{className:`countdown-timer ${n}`,style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",fontWeight:"500",color:l||o.total<=3e5?"#ff4d4f":o.total<=18e5?"#fa8c16":"#52c41a",...i},children:[s&&jsxRuntimeExports.jsx(RefIcon$R,{style:{fontSize:"12px"}}),jsxRuntimeExports.jsx("span",{children:(()=>{if(l)return jsxRuntimeExports.jsx("span",{style:{color:"#ff4d4f",fontWeight:"600"},children:"已截止"});switch(r){case"minimal":return o.days>0?`${o.days}天${d(o.hours)}:${d(o.minutes)}:${d(o.seconds)}`:o.hours>0?`${d(o.hours)}:${d(o.minutes)}:${d(o.seconds)}`:`${d(o.minutes)}:${d(o.seconds)}`;case"compact":return o.days>0?`${o.days}天${o.hours}小时`:o.hours>0?`${o.hours}小时${d(o.minutes)}分钟`:`${d(o.minutes)}分钟${d(o.seconds)}秒`;default:return o.days>0?`${o.days}天 ${d(o.hours)}:${d(o.minutes)}:${d(o.seconds)}`:o.hours>0?`${d(o.hours)}小时 ${d(o.minutes)}分钟 ${d(o.seconds)}秒`:`${d(o.minutes)}分钟 ${d(o.seconds)}秒`}})()})]})},_LiveStreamRegistrationService=class e{constructor(){__publicField(this,"configCache",null),__publicField(this,"configCacheTime",0),__publicField(this,"CACHE_DURATION",3e5)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async getRegistrationConfig(){const e=Date.now();if(this.configCache&&e-this.configCacheTime<this.CACHE_DURATION)return this.configCache;try{const{data:t,error:r}=await supabase.from("livestream_registration_config").select("*").eq("is_active",!0).eq("is_emergency_closed",!1).order("created_at",{ascending:!1}).limit(1);if(r)return console.error("❌ [配置] 查询报名配置失败:",r),null;if(!t||0===t.length)return console.warn("⚠️ [配置] 未找到有效的报名配置，请检查数据库配置"),null;const s=t[0];return this.configCache=s,this.configCacheTime=e,s}catch(t){return console.error("❌ [配置] 获取报名配置失败:",t),null}}async checkUserLimit(e,t,r,s){try{const n=await this.getRegistrationConfig();if(!n)return console.warn(`⚠️ [限制检查] 用户 ${e} 检查失败：报名配置未启用`),{success:!1,is_privilege_user:!1,user_weekly_count:0,weekly_limit:0,privilege_advance_limit:0,week_start:"",week_end:"",error:"报名配置未启用"};let i,o;if(r&&s)i=new Date(r),o=new Date(s);else{const e=new Date((new Date).getTime()+288e5);i=new Date(e);const t=0===e.getUTCDay()?7:e.getUTCDay();i.setUTCDate(e.getUTCDate()-t+1),i.setUTCHours(0,0,0,0),o=new Date(i),o.setUTCDate(i.getUTCDate()+6),o.setUTCHours(23,59,59,999)}const a=n.privilege_managers.includes(e),{data:l,error:c}=await supabase.from("live_stream_schedules").select("id, participant_ids, date, status, created_by").eq("status","booked").gte("date",i.toISOString().split("T")[0]).lte("date",o.toISOString().split("T")[0]);if(c)throw console.error(`❌ [限制检查] 查询用户 ${e} 的报名记录失败:`,c),c;const u=((null==l?void 0:l.filter(t=>t.participant_ids&&t.participant_ids.includes(e)))||[]).length;let d,p;"vip"===t?(d=n.privilege_advance_limit,p="VIP主播权益限制"):"normal"===t?(d=n.weekly_limit_per_user,p="基础权益限制"):(d=n.weekly_limit_per_user,p="默认限制（无权益）");return{success:u<d,is_privilege_user:a,user_weekly_count:u,weekly_limit:d,privilege_advance_limit:n.privilege_advance_limit,week_start:i.toISOString().split("T")[0],week_end:o.toISOString().split("T")[0]}}catch(n){return console.error(`❌ [限制检查] 检查用户 ${e} 限制失败:`,n),null}}checkRegistrationWindow(e){const t=new Date((new Date).getTime()+288e5),r=0===t.getUTCDay()?7:t.getUTCDay(),s=`${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}:${t.getUTCSeconds().toString().padStart(2,"0")}`;return{inNormalWindow:this.checkTimeWindow(r,s,e.registration_open_day_of_week,e.registration_close_day_of_week,e.registration_open_time,e.registration_close_time),inPrivilegeWindow:this.checkTimeWindow(r,s,e.privilege_advance_open_day_of_week,e.privilege_advance_close_day_of_week,e.privilege_advance_open_time,e.privilege_advance_close_time)}}checkTimeWindow(e,t,r,s,n,i){if(r<=s){if(e<r||e>s)return!1}else if(e<r&&e>s)return!1;return!(t<n||t>i)}canUserRegister(e,t){if(!e||!t)return!1;const{inNormalWindow:r,inPrivilegeWindow:s}=this.checkRegistrationWindow(t);return e.is_privilege_user?(r||s)&&e.success:r&&e.success}getRegistrationStatusMessage(e,t){if(!e||!t)return"";const{inNormalWindow:r,inPrivilegeWindow:s}=this.checkRegistrationWindow(t);return e.is_privilege_user?r||s?`可报名 (${e.user_weekly_count}/${e.weekly_limit})`:"报名已结束，修改请联系片区市场运营":r?`可报名 (${e.user_weekly_count}/${e.weekly_limit})`:"报名已结束，修改请联系片区市场运营"}getCurrentPrivilegeType(e,t){if(!e)return"none";const{inNormalWindow:r,inPrivilegeWindow:s}=this.checkRegistrationWindow(e);return t&&s&&!r?"vip":r?"normal":"none"}async getRegistrationStatus(e,t=!1,r,s){const n=await this.getRegistrationConfig(),i=this.getCurrentPrivilegeType(n,(null==n?void 0:n.privilege_managers.includes(e))||!1),o=await this.checkUserLimit(e,i,r,s);let a,l;if(t)if(n){const{inNormalWindow:e,inPrivilegeWindow:t}=this.checkRegistrationWindow(n);(null==o?void 0:o.is_privilege_user)?(a=e||t,l=a?"可编辑已报名场次":"报名时间已截止，无法修改报名信息"):(a=e,l=a?"可编辑已报名场次":"报名时间已截止，无法修改报名信息")}else a=!1,l="配置不可用，无法编辑";else"none"===i?(a=!1,l="当前不在报名时间窗口内"):"vip"===i||"normal"===i?(a=(null==o?void 0:o.success)||!1,l=`可报名 (${(null==o?void 0:o.user_weekly_count)||0}/${(null==o?void 0:o.weekly_limit)||0})`):(a=!1,l="当前不在报名时间窗口内");return{canRegister:a,statusMessage:l,isPrivilegeUser:(null==o?void 0:o.is_privilege_user)||!1,currentCount:(null==o?void 0:o.user_weekly_count)||0,limit:(null==o?void 0:o.weekly_limit)||0,currentPrivilegeType:i}}clearConfigCache(){this.configCache=null,this.configCacheTime=0}checkDateRange(e){try{const t=new Date((new Date).getTime()+288e5),r=new Date(t),s=0===t.getUTCDay()?7:t.getUTCDay();r.setUTCDate(t.getUTCDate()-s+1),r.setUTCHours(0,0,0,0);const n=new Date(r);n.setUTCDate(r.getUTCDate()+13),n.setUTCHours(23,59,59,999);const i=new Date(e+"T00:00:00.000Z");if(!(i>=r&&i<=n)){const e=`只能报名本周和下周的场次，当前可报名日期范围：${r.toISOString().split("T")[0]} 至 ${n.toISOString().split("T")[0]}`;return console.warn("❌ [日期范围检查] 日期超出允许范围:",e),{isValid:!1,message:e}}return{isValid:!0}}catch(t){return console.error("❌ [日期范围检查] 检查失败:",t),{isValid:!1,message:"日期范围检查失败"}}}canCancelRegistration(e,t){if(!e)return console.warn("⚠️ [取消检查] 配置为空，无法取消报名"),!1;const r=new Date((new Date).getTime()+288e5),s=0===r.getUTCDay()?7:r.getUTCDay(),n=`${r.getUTCHours().toString().padStart(2,"0")}:${r.getUTCMinutes().toString().padStart(2,"0")}:${r.getUTCSeconds().toString().padStart(2,"0")}`;let i,o;t?(i=e.privilege_advance_close_day_of_week,o=e.privilege_advance_close_time):(i=e.registration_close_day_of_week,o=e.registration_close_time);return this.checkTimeWindow(s,n,1,i,"00:00:00",o)}async getUserRegisteredSchedules(e){try{const t=new Date((new Date).getTime()+288e5),r=new Date(t),s=0===t.getUTCDay()?7:t.getUTCDay();r.setUTCDate(t.getUTCDate()-s+1),r.setUTCHours(0,0,0,0);const n=new Date(r);n.setUTCDate(r.getUTCDate()+6),n.setUTCHours(23,59,59,999);const{data:i,error:o}=await supabase.from("live_stream_schedules").select("id, date, time_slot_id, participant_ids, status, created_at, created_by").eq("status","booked").gte("date",r.toISOString().split("T")[0]).lte("date",n.toISOString().split("T")[0]).order("date",{ascending:!0});if(o)return void console.error(`❌ [已报名场次] 查询用户 ${e} 的报名记录失败:`,o);const a=(null==i?void 0:i.filter(t=>t.participant_ids&&t.participant_ids.includes(e)))||[];if(a.length>0){a.forEach((t,r)=>{t.participant_ids.indexOf(e),t.participant_ids[0],t.participant_ids.filter(t=>t!==e)});const t=a.filter(t=>t.participant_ids[0]===e).length;a.length,new Set(a.flatMap(e=>e.participant_ids).filter(t=>t!==e))}}catch(t){console.error(`❌ [已报名场次] 获取用户 ${e} 已报名场次失败:`,t)}}getTimeWindowInfo(e){return e?`开放报名时间：周${e.registration_open_day_of_week}至周${e.registration_close_day_of_week} ${e.registration_open_time}-${e.registration_close_time} | 提前报名时间：周${e.privilege_advance_open_day_of_week}至周${e.privilege_advance_close_day_of_week} ${e.privilege_advance_open_time}-${e.privilege_advance_close_time}`:""}async testPrivilegeSwitching(e){const t=await this.getRegistrationConfig();if(!t)throw new Error("配置不可用");const r=t.privilege_managers.includes(e),s=r?"VIP主播用户":"基础用户",n=await this.checkUserLimit(e,"normal"),i=await this.checkUserLimit(e,"vip"),o=this.getCurrentPrivilegeType(t,r),a=await this.checkUserLimit(e,o);return{userIdentity:s,normalPrivilege:{type:"normal",limit:(null==n?void 0:n.weekly_limit)||0,currentCount:(null==n?void 0:n.user_weekly_count)||0,canRegister:(null==n?void 0:n.success)||!1},vipPrivilege:{type:"vip",limit:(null==i?void 0:i.weekly_limit)||0,currentCount:(null==i?void 0:i.user_weekly_count)||0,canRegister:(null==i?void 0:i.success)||!1},currentPrivilege:{type:o,limit:(null==a?void 0:a.weekly_limit)||0,currentCount:(null==a?void 0:a.user_weekly_count)||0,canRegister:(null==a?void 0:a.success)||!1}}}getCurrentTimeWindowStatus(e){if(!e)return{currentTime:"",currentDay:0,inNormalWindow:!1,inPrivilegeWindow:!1,privilegeType:"none"};const t=new Date((new Date).getTime()+288e5),r=0===t.getUTCDay()?7:t.getUTCDay(),s=`${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}:${t.getUTCSeconds().toString().padStart(2,"0")}`,{inNormalWindow:n,inPrivilegeWindow:i}=this.checkRegistrationWindow(e);return{currentTime:s,currentDay:r,inNormalWindow:n,inPrivilegeWindow:i,privilegeType:this.getCurrentPrivilegeType(e,!0)}}};__publicField(_LiveStreamRegistrationService,"instance");let LiveStreamRegistrationService=_LiveStreamRegistrationService;const liveStreamRegistrationService=LiveStreamRegistrationService.getInstance(),RegistrationCountdown=({config:e,isPrivilegeUser:t,onTimeWindowChange:r,className:s="",style:n={}})=>{const[i,o]=reactExports.useState({nextOpenTime:null,nextCloseTime:null,currentWindow:null,isCurrentlyOpen:!1}),a=reactExports.useRef(r);a.current=r;const l=reactExports.useCallback(()=>{if(!e)return{nextOpenTime:null,nextCloseTime:null,currentWindow:null,isCurrentlyOpen:!1};const r=(new Date).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),[s,n]=r.split(" "),[i,o,a]=s.split("/").map(Number),[l,c,u]=n.split(":").map(Number),d=new Date(i,o-1,a,l,c,u),p=0===d.getDay()?7:d.getDay();l.toString().padStart(2,"0"),c.toString().padStart(2,"0");const m=(e,t)=>{const{hours:r,minutes:s}=(e=>{const[t,r]=e.split(":").map(Number);return{hours:t,minutes:r}})(t),n=(e-p+7)%7,i=new Date(d);return i.setDate(d.getDate()+n),i.setHours(r,s,0,0),i.getTime()<=d.getTime()&&i.setDate(i.getDate()+7),i},h=(()=>{if(t){const t=m(e.privilege_advance_open_day_of_week,e.privilege_advance_open_time),r=m(e.privilege_advance_close_day_of_week,e.privilege_advance_close_time);if(d>=t&&d<=r)return{currentWindow:"privilege",isCurrentlyOpen:!0,nextCloseTime:r}}const r=m(e.registration_open_day_of_week,e.registration_open_time),s=m(e.registration_close_day_of_week,e.registration_close_time);if(d>=r&&d<=s)return{currentWindow:"normal",isCurrentlyOpen:!0,nextCloseTime:s};let n;if(t){const t=m(e.privilege_advance_open_day_of_week,e.privilege_advance_open_time),r=m(e.registration_open_day_of_week,e.registration_open_time);n=t.getTime()<r.getTime()?t:r}else n=m(e.registration_open_day_of_week,e.registration_open_time);return{currentWindow:"closed",isCurrentlyOpen:!1,nextOpenTime:n}})();return{...h,nextOpenTime:h.nextOpenTime||null,nextCloseTime:h.nextCloseTime||null}},[e,t]);reactExports.useEffect(()=>{const e=()=>{const e=l();o(t=>{var r;return t.isCurrentlyOpen!==e.isCurrentlyOpen&&(null==(r=a.current)||r.call(a,e.isCurrentlyOpen)),e})};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[e,t]);const c=reactExports.useCallback(()=>{const e=l();o(t=>{var r;return t.isCurrentlyOpen!==e.isCurrentlyOpen&&(null==(r=a.current)||r.call(a,e.isCurrentlyOpen)),e})},[e,t]);return e?jsxRuntimeExports.jsxs("div",{className:`registration-countdown ${s}`,style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"4px",...n},children:[i.isCurrentlyOpen&&i.nextCloseTime&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#666"},children:"距离截止还有："}),jsxRuntimeExports.jsx(CountdownTimer,{targetTime:i.nextCloseTime,onExpire:c,format:"compact",showIcon:!0,style:{fontSize:"12px",fontWeight:"600"}})]}),!i.isCurrentlyOpen&&i.nextOpenTime&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#666"},children:"下次开放还有："}),jsxRuntimeExports.jsx(CountdownTimer,{targetTime:i.nextOpenTime,onExpire:c,format:"compact",showIcon:!0,style:{fontSize:"12px",fontWeight:"600"}})]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999",textAlign:"right"},children:liveStreamRegistrationService.getTimeWindowInfo(e)})]}):null},{Option:Option$1}=Select,ScheduleCard=reactExports.memo(({schedule:e,timeSlot:t,dateInfo:r,onCardClick:s,userAvatars:n,avatarFrames:i,getCardColor:o,cardUpdateKey:a,currentProfileId:l,timeSlots:c,onContextMenuEdit:u,onContextMenuHistory:d,onContextMenuRate:p,onContextMenuRelease:m,onContextMenuLock:h,onContextMenuUnlock:x,canRegister:f=!1})=>{const g=!e||"available"===e.status||"editing"===e.status||!e.status&&"editing"!==e.status,y=e&&l&&"available"!==e.status&&(e.createdBy===l||e.managers.some(e=>parseInt(e.id)===l)),v=e&&"booked"===e.status&&(()=>{const t=dayjs(),r=dayjs(e.date),s=c.find(t=>t.id===e.timeSlotId);if(!s)return!1;if(!r.isSame(t,"day"))return!1;const n=t.format("HH:mm");return n>=s.startTime&&n<=s.endTime})(),E=v,j=y&&!v,b=n=>jsxRuntimeExports.jsx(LiveStreamCardContextMenu,{onEdit:e?()=>null==u?void 0:u(e):void 0,onHistory:e?()=>null==d?void 0:d(e):void 0,onRate:e?()=>null==p?void 0:p(e):void 0,onRelease:e?()=>null==m?void 0:m(e):void 0,onLock:()=>null==h?void 0:h(e,t,r),onUnlock:e?()=>null==x?void 0:x(e):void 0,onCreate:e?void 0:()=>s(e,t,r),isLocked:"locked"===(null==e?void 0:e.status),children:jsxRuntimeExports.jsx("div",{"data-testid":"schedule-card","data-date":r.date,"data-time-slot":t.id,onClick:()=>s(e,t,r),style:{background:"white",border:"editing"===(null==e?void 0:e.status)?"1px solid #52c41a":"locked"===(null==e?void 0:e.status)?"1px solid #ff4d4f":"1px solid #1890ff",borderRadius:"8px",margin:"1px",boxShadow:"none",cursor:f?"pointer":"not-allowed",transition:"all 0.3s ease",height:"100px",width:"160px",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",opacity:f?1:.6},onMouseEnter:e=>{f&&(e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:e=>{f&&(e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)")},children:n},`${(null==e?void 0:e.id)||"empty"}-${a||0}`)});return g?e&&"editing"===(null==e?void 0:e.status)?b(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{background:"#ffffff",padding:"2px 2px",margin:"0",borderBottom:"1px solid #52c41a",width:"100%",minHeight:"48px",display:"flex",alignItems:"center",gap:"1px",overflow:"hidden",boxSizing:"border-box"},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",flex:1,width:"100%"},children:jsxRuntimeExports.jsxs("span",{style:{fontSize:"12px",color:"#52c41a",fontWeight:"600",lineHeight:"1.2",display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxRuntimeExports.jsx(RefIcon$18,{style:{marginRight:"4px",fontSize:"20px",color:"#52c41a"}}),"报名中",jsxRuntimeExports.jsxs("span",{style:{display:"inline-block",marginLeft:"2px"},children:[jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0s"},children:"."}),jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0.2s"},children:"."}),jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0.4s"},children:"."})]})]})})}),jsxRuntimeExports.jsxs("div",{style:{padding:"8px 8px",flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",background:"white",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#999",lineHeight:"1.2",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:(null==(w=null==e?void 0:e.location)?void 0:w.name)||"",children:(null==(R=null==e?void 0:e.location)?void 0:R.name)||""})}),jsxRuntimeExports.jsx("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column"},children:(null==(_=null==e?void 0:e.propertyType)?void 0:_.name)&&""!==e.propertyType.name&&jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#999",lineHeight:"1.2",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.propertyType.name,children:e.propertyType.name})})]})]})):b((()=>{var t,r,s;const n="locked"===(null==e?void 0:e.status);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{background:"#ffffff",padding:"2px 2px",margin:"0",borderBottom:n?"1px solid #ff4d4f":"1px solid #1890ff",width:"100%",minHeight:"48px",display:"flex",alignItems:"center",gap:"1px",overflow:"hidden",boxSizing:"border-box"},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",flex:1,width:"100%"},children:n?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefIcon$p,{style:{color:"#ff4d4f",fontSize:"14px"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#ff4d4f",fontWeight:"600",lineHeight:"1.2"},children:"已锁定"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(RefIcon$a,{style:{color:f?"#1890ff":"#ccc",fontSize:"14px"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:f?"#1890ff":"#ccc",fontWeight:"600",lineHeight:"1.2"},children:f?"立即报名":"无法报名"})]})})}),jsxRuntimeExports.jsxs("div",{style:{padding:"8px 8px",flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",background:"white",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#999",lineHeight:"1.2",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:(null==(t=null==e?void 0:e.location)?void 0:t.name)||"",children:(null==(r=null==e?void 0:e.location)?void 0:r.name)||""})}),jsxRuntimeExports.jsx("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column"},children:(null==(s=null==e?void 0:e.propertyType)?void 0:s.name)&&""!==e.propertyType.name&&jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#999",lineHeight:"1.2",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.propertyType.name,children:e.propertyType.name})})]}),E&&jsxRuntimeExports.jsxs("div",{style:{background:"#1890ff",color:"white",fontSize:"10px",padding:"2px 6px 2px 10px",textAlign:"left",fontWeight:"500",lineHeight:"1.2",borderBottomLeftRadius:"7px",borderBottomRightRadius:"7px",display:"flex",alignItems:"center",gap:"4px"},children:[jsxRuntimeExports.jsx("span",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"white",flexShrink:0}}),"正在直播中..."]}),j&&jsxRuntimeExports.jsxs("div",{style:{background:"#faad14",color:"white",fontSize:"10px",padding:"2px 6px 2px 10px",textAlign:"left",fontWeight:"500",lineHeight:"1.2",borderBottomLeftRadius:"7px",borderBottomRightRadius:"7px",display:"flex",alignItems:"center",gap:"4px"},children:[jsxRuntimeExports.jsx("span",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"white",flexShrink:0}}),"我报名的"]})]})})()):b((()=>{var r,s,a,l,c,u;return jsxRuntimeExports.jsxs(Tooltip,{title:"locked"===(null==e?void 0:e.status)?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"状态:"})," 已锁定"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"锁定原因:"})," ",(null==e?void 0:e.lockReason)||"管理员手动锁定"]}),(null==e?void 0:e.lockEndTime)&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"锁定结束时间:"})," ",new Date(e.lockEndTime).toLocaleString()]})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"直播管家:"})," ",(null==(r=null==e?void 0:e.managers)?void 0:r.map(e=>e.name).join(", "))||"未知"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"地点:"})," ",(null==(s=null==e?void 0:e.location)?void 0:s.name)||"未知"]}),(null==(a=null==e?void 0:e.propertyType)?void 0:a.name)&&""!==e.propertyType.name&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"户型:"})," ",e.propertyType.name]})]}),placement:"top",children:[jsxRuntimeExports.jsx("div",{style:{background:"available"!==(null==e?void 0:e.status)&&(null==e?void 0:e.status)&&"editing"!==(null==e?void 0:e.status)&&"locked"!==(null==e?void 0:e.status)?o((null==e?void 0:e.id)||"").bg:"#ffffff",padding:"2px 2px",margin:"0",borderBottom:"editing"===(null==e?void 0:e.status)?"1px solid #52c41a":"locked"===(null==e?void 0:e.status)?"1px solid #ff4d4f":"available"!==(null==e?void 0:e.status)&&(null==e?void 0:e.status)?"1px solid #e8e8e8":"1px solid #1890ff",width:"100%",minHeight:"48px",display:"flex",alignItems:"center",gap:"1px",overflow:"hidden",boxSizing:"border-box"},children:"locked"===(null==e?void 0:e.status)?jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",flex:1,width:"100%"},children:[jsxRuntimeExports.jsx(RefIcon$p,{style:{color:"#ff4d4f",fontSize:"14px"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#ff4d4f",fontWeight:"600",lineHeight:"1.2"},children:"已锁定"})]}):"available"!==(null==e?void 0:e.status)&&(null==e?void 0:e.status)&&0!==(null==(l=null==e?void 0:e.managers)?void 0:l.length)?"editing"===(null==e?void 0:e.status)?jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",flex:1,width:"100%"},children:jsxRuntimeExports.jsxs("span",{style:{fontSize:"12px",color:"#52c41a",fontWeight:"600",lineHeight:"1.2",display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxRuntimeExports.jsx(RefIcon$18,{style:{marginRight:"4px",fontSize:"20px",color:"#52c41a"}}),"报名中",jsxRuntimeExports.jsxs("span",{style:{display:"inline-block",marginLeft:"2px"},children:[jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0s"},children:"."}),jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0.2s"},children:"."}),jsxRuntimeExports.jsx("span",{style:{animation:"wave 1.5s infinite",display:"inline-block",animationDelay:"0.4s"},children:"."})]})]})}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",flex:1,width:"100%",overflow:"hidden",padding:"0 2px"},children:[null==(c=null==e?void 0:e.managers)?void 0:c.slice(0,3).map((e,t)=>{var r;const s=parseInt(e.id),o=n[s],a=i[s];return jsxRuntimeExports.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"50%",overflow:"hidden",border:"1px solid #e8e8e8",backgroundColor:"#f5f5f5",zIndex:3-t},title:e.name,children:[o?jsxRuntimeExports.jsx("img",{src:o,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):jsxRuntimeExports.jsx("span",{style:{fontSize:"10px",color:"#666",fontWeight:"600"},children:(null==(r=e.name)?void 0:r.charAt(0))||"?"}),a&&jsxRuntimeExports.jsx("img",{src:a,alt:"frame",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"}})]},e.id)}),(null==e?void 0:e.managers)&&e.managers.length>3&&jsxRuntimeExports.jsxs("span",{style:{fontSize:"10px",color:"#666",fontWeight:"600",marginLeft:"2px"},children:["+",(null==e?void 0:e.managers.length)-3]})]}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",flex:1,width:"100%"},children:[jsxRuntimeExports.jsx(RefIcon$a,{style:{color:"#1890ff",fontSize:"14px"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#1890ff",fontWeight:"600",lineHeight:"1.2"},children:"立即报名"})]})}),jsxRuntimeExports.jsxs("div",{style:{padding:"8px 8px",flex:1,display:"flex",flexDirection:"column",gap:"4px",overflow:"hidden"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"10px",color:"#666",fontWeight:"500"},children:[jsxRuntimeExports.jsx(RefIcon$R,{style:{fontSize:"10px"}}),jsxRuntimeExports.jsxs("span",{children:[(null==t?void 0:t.startTime)||""," - ",(null==t?void 0:t.endTime)||""]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"10px",color:"#666",fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[jsxRuntimeExports.jsx(RefIcon$3,{style:{fontSize:"10px"}}),jsxRuntimeExports.jsx("span",{children:(null==(u=null==e?void 0:e.location)?void 0:u.name)||"未知地点"})]})]}),(E||j)&&jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:"2px",right:"2px",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"600",color:"white",backgroundColor:E?"#ff4d4f":"#52c41a",zIndex:10},children:E?"直播中":"我报名的"})]})})());var w,R,_});ScheduleCard.displayName="ScheduleCard";const LiveStreamRegistrationBase=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(!1),{getCachedUserInfo:l}=useUser(),[c,u]=reactExports.useState(null),[d,p]=reactExports.useState(dayjs()),[m]=Form$4.useForm(),{user:h}=useUser(),[x,f]=reactExports.useState(null),{hasLiveStreamManagePermission:g}=useRolePermissions(),{editLocks:y,currentUserLocks:v,acquireEditLock:E,releaseEditLock:j}=useRealtimeConcurrencyControl({onDataChange:e=>{if(console.log("🔄 [LiveStreamRegistrationBase] 收到实时数据变化通知:",e),"INSERT"===e.eventType){if(e.schedule){const r=de(e.schedule);t(t=>{const s=t.findIndex(t=>t.id===e.scheduleId);if(s>=0){const e=[...t];return e[s]=r,e}return[...t,r]}),ue(e.scheduleId)}}else"STATUS_CHANGE"===e.eventType?pe(e):"DELETE"===e.eventType&&(t(t=>t.filter(t=>t.id!==e.scheduleId)),ue(e.scheduleId))}}),[b,w]=reactExports.useState({isRetrying:!1,retryCount:0,nextRetryTime:null}),R=reactExports.useCallback((e,t)=>{if(b.retryCount>=5)return void console.error("❌ [Realtime] 重试次数已达上限，停止重试");const r=Math.min(2e3*Math.pow(1.5,b.retryCount),15e3),s=Date.now()+r;w(e=>({...e,isRetrying:!0,retryCount:e.retryCount+1,nextRetryTime:s})),setTimeout(async()=>{try{await e(),w(e=>({...e,isRetrying:!1,retryCount:0,nextRetryTime:null}))}catch(t){console.error("❌ [Realtime] 重试失败:",t),R(e,t)}},r)},[b.retryCount]);reactExports.useCallback(()=>{w(e=>({...e,isRetrying:!1,retryCount:0,nextRetryTime:null}))},[]),reactExports.useCallback(()=>{w(e=>({...e,retryCount:0,nextRetryTime:null}))},[]),reactExports.useCallback(async e=>{w(e=>({...e,retryCount:0})),await e()},[]);const _=reactExports.useCallback(async e=>{if(null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d));liveStreamRegistrationService.clearConfigCache();const r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r);const s=await liveStreamRegistrationService.getRegistrationConfig();$(s)}catch(t){console.error("❌ [时间窗口变化] 刷新报名状态失败:",t)}},[null==x?void 0:x.id,d]),[S,C]=reactExports.useState(null),[k,$]=reactExports.useState(null),[T,I]=reactExports.useState({}),[P,A]=reactExports.useState({}),[F,M]=reactExports.useState(!1),[D,O]=reactExports.useState(""),[N,B]=reactExports.useState(""),[L,z]=reactExports.useState(null),[V,U]=reactExports.useState(!1),[H,W]=reactExports.useState(null),[q,G]=reactExports.useState(!1),[Y,K]=reactExports.useState(null),[X,J]=reactExports.useState({}),[Z,Q]=reactExports.useState([]),ee=e=>{ge(e)},te=e=>{W(e),U(!0)},re=async e=>{try{if(!(null==x?void 0:x.id))return void staticMethods.warning("用户未登录");if(!(await g()))return void staticMethods.warning("您没有直播管理权限，无法执行评分操作");K(e),G(!0)}catch(t){console.error("检查评分权限失败:",t),staticMethods.error("权限检查失败")}},se=async(e,r,s)=>{try{if(!(null==x?void 0:x.id))return void staticMethods.warning("用户未登录");if(!(await g()))return void staticMethods.warning("您没有直播管理权限，无法执行此操作");let n=e;if(!e){const e={date:s.date,timeSlotId:r.id,managers:[],location:{id:"",name:""},propertyType:{id:"",name:""},status:"locked"};n=await createLiveStreamSchedule(e)}const i=await lockLiveStreamSchedule(n.id,"manual","管理员手动锁定",void 0);i?(t(t=>{if(e){return t.map(t=>t.id===e.id?{...t,...i,status:"locked"}:t)}return[...t,i]}),staticMethods.success("场次锁定成功"),ue(i.id),setTimeout(async()=>{try{await xe()}catch(e){console.warn("⚠️ [锁定场次] 数据重新加载失败:",e)}},500)):console.error("❌ [锁定场次] updatedSchedule为空，无法更新本地状态")}catch(n){console.error("锁定场次失败:",n),staticMethods.error("锁定场次失败")}},ne=async e=>{try{if(!(null==x?void 0:x.id))return void staticMethods.warning("用户未登录");if(!(await g()))return void staticMethods.warning("您没有直播管理权限，无法执行此操作");const r=await unlockLiveStreamSchedule(e.id);r?(t(t=>t.map(t=>t.id===e.id?{...t,...r,status:"available"}:t)),staticMethods.success("场次解锁成功"),ue(e.id),setTimeout(async()=>{try{await xe()}catch(e){console.warn("⚠️ [解锁场次] 数据重新加载失败:",e)}},500)):console.error("❌ [解锁场次] updatedSchedule为空，无法更新本地状态")}catch(r){console.error("解锁场次失败:",r),staticMethods.error("解锁场次失败")}},ie=async e=>{try{if(!(null==x?void 0:x.id))return void staticMethods.warning("用户未登录");if(!(await g()))return void staticMethods.warning("您没有直播管理权限，无法执行此操作");const s=await updateLiveStreamSchedule((null==e?void 0:e.id)||"",{...e,status:"available",managers:[]});if(s){if(t(t=>t.map(t=>t.id===(null==e?void 0:e.id)?{...t,...s,status:"available",managers:[]}:t)),staticMethods.success("场次释放成功"),null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r)}catch(r){console.warn("⚠️ [释放场次] 更新用户报名状态失败:",r)}ue((null==e?void 0:e.id)||""),setTimeout(async()=>{try{await xe()}catch(r){console.warn("⚠️ [释放场次] 数据重新加载失败:",r)}},500)}else console.error("❌ [释放场次] updatedSchedule为空，无法更新本地状态")}catch(r){console.error("释放场次失败:",r),staticMethods.error("释放场次失败")}},oe=async()=>{if(c)try{const r=await ae(c);if(!r.hasPermission)return void staticMethods.warning(r.message||"无权限取消此报名");if(!liveStreamRegistrationService.canCancelRegistration(k,"vip"===(null==S?void 0:S.currentPrivilegeType)))return void staticMethods.warning("报名截止时间已过，无法取消报名");if(await updateLiveStreamSchedule(c.id,{...c,status:"available",managers:[]})){if(t(e=>e.map(e=>e.id===(null==c?void 0:c.id)?{...e,status:"available",managers:[]}:e)),null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r)}catch(e){console.warn("⚠️ [取消报名] 更新用户报名状态失败:",e)}staticMethods.success("取消报名成功"),a(!1),u(null),Q([]),m.resetFields(),ue(c.id),setTimeout(async()=>{try{await xe()}catch(e){console.warn("⚠️ [取消报名] 数据重新加载失败:",e)}},500)}}catch(e){console.error("取消报名失败:",e),staticMethods.error("取消报名失败")}else staticMethods.error("没有找到要取消的报名记录")};reactExports.useEffect(()=>{const e=async()=>{try{if(v.size>0)return void console.log("⏸️ [Cleanup] 检测到当前用户正在编辑，跳过自动清理",{activeLocks:Array.from(v)});if(Object.keys(y).length>0)return void console.log("⏸️ [Cleanup] 检测到其他用户正在编辑，跳过自动清理",{otherLocks:Object.keys(y).length});console.log("🧹 [Cleanup] 执行自动清理过期编辑状态"),await cleanupExpiredEditingStatus()}catch(e){console.error("❌ [Cleanup] 自动清理失败:",e)}},t=setTimeout(e,15e3),r=setInterval(e,3e5);return()=>{clearTimeout(t),clearInterval(r)}},[v,y]);const ae=async e=>{if(!h)return console.error("❌ 用户未登录"),{hasPermission:!1,message:"用户未登录"};try{const{data:t,error:r}=await supabase.from("users_profile").select("id").eq("user_id",h.id).single();if(r)return console.error("❌ 获取用户profile失败:",r),{hasPermission:!1,message:"用户信息不完整"};if(!t)return console.error("❌ 用户profile不存在"),{hasPermission:!1,message:"用户信息不完整"};const{data:s,error:n}=await supabase.from("live_stream_schedules").select("id, status, created_by, participant_ids, editing_by, editing_expires_at").eq("id",parseInt(e.id)).single();if(n)return console.error("❌ 获取最新记录状态失败:",n),{hasPermission:!1,message:"无法获取记录状态"};if(!s)return console.error("❌ 记录不存在"),{hasPermission:!1,message:"记录不存在"};const i=s.status;if(s.editing_expires_at){const t=new Date(s.editing_expires_at);new Date>t&&(await supabase.from("live_stream_schedules").update({editing_by:null,editing_at:null,editing_expires_at:null,status:"available"}).eq("id",parseInt(e.id)),s.status="available",s.editing_by=null)}if("booked"===i){const e=s.created_by===t.id,r=s.participant_ids&&s.participant_ids.includes(t.id);if(!e&&!r)return{hasPermission:!1,message:"只有记录创建者或报名人可以编辑已报名的记录"};const n=await liveStreamRegistrationService.getRegistrationConfig();if(n){const e=n.privilege_managers.includes(t.id),r=liveStreamRegistrationService.getCurrentPrivilegeType(n,e);if(!liveStreamRegistrationService.canCancelRegistration(n,"vip"===r))return{hasPermission:!1,message:"报名时间已截止，无法修改报名信息"}}else console.warn("⚠️ [权限检查] 无法获取配置，跳过时间窗口检查");return{hasPermission:!0}}if("editing"===i){const e=s.editing_by===t.id;return null===s.editing_by||e?{hasPermission:!0}:{hasPermission:!1,message:"该记录正在被其他用户编辑，请稍后再试"}}return"available"!==i&&i?{hasPermission:!1,message:"该记录状态不允许编辑"}:{hasPermission:!0}}catch(t){return console.error("❌ 权限检查失败:",t),{hasPermission:!1,message:"权限检查失败"}}},le=async e=>{try{const t=e.filter(e=>e>0);if(0===t.length)return;const{data:r,error:s}=await supabase.from("users_profile").select("id, avatar_url").in("id",t);if(s)throw s;const n={};(r||[]).forEach(e=>{e.avatar_url&&(n[e.id]=e.avatar_url)}),I(e=>({...e,...n}))}catch(t){console.error("获取用户头像失败:",t)}},ce=async e=>{try{const r={},s=e.filter(e=>e>0);if(0===s.length)return;try{const{data:e,error:t}=await supabase.from("user_avatar_frames").select("user_id, frame_id").in("user_id",s).eq("is_equipped",!0);if(t)return;if(!e||0===e.length)return;const n=e.map(e=>e.frame_id),{data:i,error:o}=await supabase.from("avatar_frames").select("id, name, icon_url, frame_data").in("id",n);if(o)return void console.error("批量查询头像框详情失败:",o);const a=new Map;null==i||i.forEach(e=>{a.set(e.id,e)}),e.forEach(e=>{var t;const s=a.get(e.frame_id);if(s){const n=s.icon_url||(null==(t=s.frame_data)?void 0:t.icon_url);n&&(r[e.user_id]=n)}})}catch(t){console.error("获取头像框失败:",t)}A(e=>({...e,...r}))}catch(t){console.error("获取头像框失败:",t)}},ue=e=>{J(t=>{const r=(t[e]||0)+1;return{...t,[e]:r}})},de=e=>({id:e.id.toString(),date:e.date,timeSlotId:e.time_slot_id,status:e.status,managers:e.participant_ids?e.participant_ids.map(e=>({id:e.toString(),name:"未知用户",department:"",avatar:void 0})):[],location:{id:e.location||"",name:e.location||""},propertyType:{id:e.notes||"",name:e.notes||""},createdAt:e.created_at,updatedAt:e.updated_at,createdBy:e.created_by,editingBy:e.editing_by,editingAt:e.editing_at,editingExpiresAt:e.editing_expires_at,lockType:e.lock_type,lockReason:e.lock_reason,lockEndTime:e.lock_end_time}),pe=e=>{if(console.log("🔄 [状态变化] 处理状态变化:",{scheduleId:e.scheduleId,statusChange:e.statusChange,schedule:e.schedule}),!e.schedule)return void console.warn("⚠️ [状态变化] 缺少 schedule 数据");const r=de(e.schedule);t(t=>{var s,n;const i=t.findIndex(t=>t.id===e.scheduleId);if(i>=0){const o=[...t];return o[i]=r,console.log("🔄 [状态变化] 更新现有记录:",{scheduleId:e.scheduleId,oldStatus:null==(s=e.statusChange)?void 0:s.from,newStatus:null==(n=e.statusChange)?void 0:n.to}),o}return console.log("🔄 [状态变化] 添加新记录:",e.scheduleId),[...t,r]}),ue(e.scheduleId)},me=[{bg:"#e6f7ff",text:"#1890ff"},{bg:"#f6ffed",text:"#52c41a"},{bg:"#fff7e6",text:"#fa8c16"},{bg:"#fff1f0",text:"#f5222d"},{bg:"#f9f0ff",text:"#722ed1"},{bg:"#e6fffb",text:"#13c2c2"}],he=e=>{const t=e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0);return me[Math.abs(t)%me.length]};reactExports.useEffect(()=>{const e=setTimeout(()=>{xe(),fe()},100);return()=>clearTimeout(e)},[d]),reactExports.useEffect(()=>{},[d]);const xe=async()=>{try{i(!0);const e=toBeijingDateStr(getWeekStart(d)),r=toBeijingDateStr(getWeekEnd(d)),[n,o]=await Promise.all([getWeeklySchedule(e,r),getTimeSlots()]);t(n),s(o);const a=new Set;n.forEach(e=>{e.managers.forEach(e=>{const t=parseInt(e.id);isNaN(t)||a.add(t)})}),a.size>0&&await Promise.all([le(Array.from(a)),ce(Array.from(a))])}catch(e){staticMethods.error("加载数据失败"),console.error("加载数据失败:",e)}finally{i(!1)}},fe=async()=>{try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),{data:r,error:s}=await supabase.from("live_stream_schedules").select("*").gte("date",e).lte("date",t).order("date, time_slot_id");if(s)return void console.error("❌ [testDatabaseRecords] 查询数据库失败:",s);((null==r?void 0:r.filter(e=>"editing"===e.status))||[]).length}catch(e){console.error("❌ [testDatabaseRecords] 测试数据库记录失败:",e)}},ge=async e=>{console.log("🔧 [LiveStreamEdit] 开始处理编辑安排:",{scheduleId:e.id,currentStatus:e.status,managers:e.managers,timestamp:(new Date).toISOString()});try{const t=await ae(e);if(!t.hasPermission)return console.warn("⚠️ 权限检查失败:",t.message),void staticMethods.warning(t.message||"无权限编辑此记录");if(e.id&&"available"!==e.status&&e.status){if("booked"===e.status&&(null==x?void 0:x.id)){const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!0,e,t);if(!r.canRegister)return console.warn("⚠️ [编辑安排] 用户当前无法编辑:",r.statusMessage),void staticMethods.warning(r.statusMessage||"当前无法编辑")}}else{if(null==x?void 0:x.id){const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);if(!r.canRegister)return void staticMethods.warning(r.statusMessage||"当前无法报名")}if(e.id&&("available"===e.status||!e.status)){console.log("🔒 [LiveStreamEdit] 获取编辑锁定:",{scheduleId:e.id,currentStatus:e.status,timestamp:(new Date).toISOString()});const t=await E(e.id);if(console.log("🔒 [LiveStreamEdit] 锁定结果:",{success:t.success,error:t.error,timestamp:(new Date).toISOString()}),!t.success)return console.warn("⚠️ [LiveStreamEdit] 获取编辑锁定失败:",t.error),void staticMethods.warning(t.error||"无法获取编辑权限");console.log("✅ [LiveStreamEdit] 编辑锁定获取成功:",{scheduleId:e.id,timestamp:(new Date).toISOString()})}}console.log("🔧 [LiveStreamEdit] 设置编辑状态:",{scheduleId:e.id,modalVisible:!0,timestamp:(new Date).toISOString()}),u(e),a(!0),setTimeout(()=>{let t=e.managers.filter(e=>e&&e.id&&"undefined"!==e.id&&"null"!==e.id).map(e=>String(e.id));if(("available"===e.status||!e.status)&&0===t.length){const e=(null==x?void 0:x.id)?String(x.id):null;e&&(t=[e])}Q(t);const r={timeSlot:e.timeSlotId,managers:t,location:e.location.id||void 0,propertyType:e.propertyType.id||void 0};m.setFieldsValue(r)},100)}catch(t){console.error("❌ 获取编辑权限失败:",t),console.error("🔍 错误详情:",{message:t instanceof Error?t.message:"未知错误",stack:t instanceof Error?t.stack:void 0}),staticMethods.error("获取编辑权限失败")}},ye=async()=>{if(c){const r=0===c.managers.length,s="editing"===c.status,n="available"===c.status||!c.status;if(r)try{const e=parseInt(c.id);if(isNaN(e))throw console.error("❌ 记录ID无效:",c.id),new Error("记录ID无效");const{data:r,error:s}=await supabase.from("live_stream_schedules").delete().eq("id",e).select();s?(console.error("❌ 删除记录失败:",s),console.error("🔍 错误详情:",{message:s.message,details:s.details,hint:s.hint,code:s.code})):(r&&r.length,t(e=>e.filter(e=>e.id!==c.id)),ue(c.id))}catch(e){console.error("❌ 删除记录时发生异常:",e),console.error("🔍 异常详情:",{message:e instanceof Error?e.message:"未知错误",stack:e instanceof Error?e.stack:void 0})}else if(n){console.log("🔓 [LiveStreamEdit] 释放编辑锁定:",{scheduleId:c.id,currentStatus:c.status,timestamp:(new Date).toISOString()});try{await j(c.id),console.log("✅ [LiveStreamEdit] 编辑锁定释放成功:",{scheduleId:c.id,timestamp:(new Date).toISOString()})}catch(e){console.error("❌ [LiveStreamEdit] 释放编辑锁定失败:",e)}}else{const r=await ae(c);if(!r.hasPermission)return console.warn("⚠️ 删除权限检查失败:",r.message),staticMethods.warning(r.message||"无权限删除此记录"),a(!1),u(null),void m.resetFields();if(s)try{const e=parseInt(c.id);if(isNaN(e))throw console.error("❌ 记录ID无效:",c.id),new Error("记录ID无效");const{error:r}=await supabase.from("live_stream_schedules").delete().eq("id",e).select();r?console.error("❌ 删除editing状态记录失败:",r):(t(e=>e.filter(e=>e.id!==c.id)),ue(c.id))}catch(e){console.error("❌ 删除editing状态记录时发生异常:",e)}}}if(a(!1),u(null),Q([]),m.resetFields(),staticMethods.info("已取消编辑"),await xe(),null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r)}catch(e){console.error("更新报名状态失败:",e)}},ve=async(e,t,r)=>{if("locked"!==(null==e?void 0:e.status)){if(e&&"available"!==e.status&&e.status){if("booked"===e.status&&(null==x?void 0:x.id))try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!0,e,t);if(!r.canRegister)return console.warn("⚠️ [卡片点击] 用户当前无法编辑:",r.statusMessage),void staticMethods.warning(r.statusMessage||"当前无法编辑")}catch(s){return console.error("❌ [卡片点击] 编辑权限检查失败:",s),void staticMethods.error("权限检查失败")}}else if(!(null==S?void 0:S.canRegister))return console.warn("⚠️ [卡片点击] 用户当前无法报名:",null==S?void 0:S.statusMessage),void staticMethods.warning((null==S?void 0:S.statusMessage)||"当前无法报名");if(e){const t=await ae(e);if(!t.hasPermission)return console.warn("⚠️ 权限检查失败:",t.message),void staticMethods.warning(t.message||"无权限编辑此记录");ge(e)}else{const e=liveStreamRegistrationService.checkDateRange(r.date);if(!e.isValid)return console.warn("⚠️ [卡片点击] 报名日期超出允许范围:",e.message),void staticMethods.error(e.message||"报名日期超出允许范围");try{const e={date:r.date,timeSlotId:t.id,managers:[],location:{id:"",name:""},propertyType:{id:"",name:""},status:"editing"},s=await createLiveStreamSchedule(e);if(console.log("🔧 [LiveStreamEdit] 临时记录创建成功:",{scheduleId:s.id,status:s.status,timestamp:(new Date).toISOString()}),s.id){console.log("🔒 [LiveStreamEdit] 为新创建的临时记录获取编辑锁定:",{scheduleId:s.id,timestamp:(new Date).toISOString()});const e=await E(s.id);if(console.log("🔒 [LiveStreamEdit] 临时记录锁定结果:",{success:e.success,error:e.error,timestamp:(new Date).toISOString()}),!e.success)return console.warn("⚠️ [LiveStreamEdit] 获取临时记录编辑锁定失败:",e.error),void staticMethods.warning(e.error||"无法获取编辑权限");console.log("✅ [LiveStreamEdit] 临时记录编辑锁定获取成功:",{scheduleId:s.id,timestamp:(new Date).toISOString()})}u(s),a(!0);const n=(null==x?void 0:x.id)?String(x.id):null,i=n?[n]:[];Q(i),setTimeout(()=>{m.setFieldsValue({timeSlot:t.id,managers:i})},100)}catch(s){console.error("❌ 创建临时记录失败:",s),console.error("🔍 错误详情:",{message:s instanceof Error?s.message:"未知错误",stack:s instanceof Error?s.stack:void 0}),staticMethods.error("创建临时记录失败")}}}else staticMethods.warning("该场次已被锁定，无法进行报名或编辑操作")},Ee=(e,t,r)=>{B(e),O(t),z(()=>r),M(!0)},je=()=>{L&&L(),M(!1),z(null)},be=()=>{M(!1),z(null)};return reactExports.useEffect(()=>{(async()=>{if(h)try{const{data:e,error:t}=await supabase.from("users_profile").select("id, nickname, avatar_url").eq("user_id",h.id).single();t?(console.error("❌ 获取用户profile失败:",t),f(null)):f(e)}catch(e){console.error("❌ 获取用户profile异常:",e),f(null)}else f(null)})()},[h]),reactExports.useEffect(()=>{(async()=>{if(null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),[r,s]=await Promise.all([liveStreamRegistrationService.getRegistrationConfig(),liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t)]);$(r),C(s),await liveStreamRegistrationService.getUserRegisteredSchedules(x.id)}catch(e){console.error(`❌ [组件] 用户 ${x.id} 初始化报名状态失败:`,e)}})()},[null==x?void 0:x.id,d]),reactExports.useEffect(()=>{const e=setInterval(async()=>{if(null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d));liveStreamRegistrationService.clearConfigCache();const r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r)}catch(e){console.error("更新报名状态失败:",e)}},6e4);return()=>clearInterval(e)},[null==x?void 0:x.id,d]),jsxRuntimeExports.jsxs("div",{"data-testid":"live-stream-registration",children:[S&&jsxRuntimeExports.jsxs("div",{"data-testid":"registration-status",style:{background:S.canRegister?"#f6ffed":"#fff2e8",border:"1px solid "+(S.canRegister?"#b7eb8f":"#ffbb96"),borderRadius:"6px",padding:"12px 16px",marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx(RefIcon$7,{style:{color:S.canRegister?"#52c41a":"#fa8c16",fontSize:"16px"}}),jsxRuntimeExports.jsx("span",{style:{color:S.canRegister?"#52c41a":"#fa8c16",fontWeight:"500"},children:S.statusMessage}),"vip"===S.currentPrivilegeType&&jsxRuntimeExports.jsx("span",{style:{background:"#722ed1",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:"提前报名权益"}),"normal"===S.currentPrivilegeType&&jsxRuntimeExports.jsx("span",{style:{background:"#1890ff",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:"基础权益"}),"none"===S.currentPrivilegeType&&jsxRuntimeExports.jsx("span",{style:{background:"#d9d9d9",color:"#666",padding:"2px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:"无权益"})]}),jsxRuntimeExports.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"4px"},children:k&&jsxRuntimeExports.jsx(RegistrationCountdown,{config:k,isPrivilegeUser:(null==S?void 0:S.isPrivilegeUser)||!1,onTimeWindowChange:_,style:{marginTop:"4px"}})})]}),jsxRuntimeExports.jsx("style",{children:"\n          .ant-table-tbody > tr:hover > td {\n            transform: none !important;\n            scale: none !important;\n            box-shadow: none !important;\n          }\n          .ant-table-tbody > tr:hover {\n            transform: none !important;\n            scale: none !important;\n            box-shadow: none !important;\n          }\n          .ant-table-tbody > tr > td {\n            transform: none !important;\n            scale: none !important;\n            box-shadow: none !important;\n            padding: 4px 8px !important;\n          }\n          .ant-table-tbody > tr {\n            box-shadow: none !important;\n          }\n          .compact-row {\n            height: auto !important;\n          }\n          .compact-row td {\n            padding: 4px 8px !important;\n            vertical-align: top !important;\n                      }\n            @keyframes wave {\n              0%, 60%, 100% {\n                transform: translateY(0);\n              }\n              30% {\n                transform: translateY(-4px);\n              }\n            }\n          "}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[jsxRuntimeExports.jsxs("h2",{style:{margin:0,fontSize:"18px",fontWeight:"600"},children:["直播报名表 W",(e=>{const t=e.startOf("year"),r=e.diff(t,"day");return Math.ceil((r+t.day())/7)})(d)]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"12px"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>p(d.subtract(1,"week")),children:"上一周"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>p(dayjs()),children:"本周"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>p(d.add(1,"week")),children:"下一周"})]})]}),(()=>{const t=(()=>{const e=[],t=d.startOf("week");for(let r=0;r<7;r++){const s=t.add(r,"day");e.push({date:s.format("YYYY-MM-DD"),day:s.format("MM-DD"),weekday:s.format("ddd"),isToday:s.isSame(dayjs(),"day")})}return e})(),s=[{title:jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"600"},children:jsxRuntimeExports.jsx("span",{children:"时间段"})}),dataIndex:"timeSlot",key:"timeSlot",width:100,fixed:"left",render:(e,t,r)=>jsxRuntimeExports.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.2"},children:[jsxRuntimeExports.jsxs("div",{style:{fontWeight:"600",marginBottom:"2px"},children:[e.startTime,"-",e.endTime]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999"},children:"morning"===e.period?"上午":"afternoon"===e.period?"下午":"晚上"})]})},...t.map(e=>({title:jsxRuntimeExports.jsxs("div",{style:{fontSize:"14px",fontWeight:"600"},children:[jsxRuntimeExports.jsx("div",{children:e.day}),jsxRuntimeExports.jsx("div",{style:{color:"#999",fontWeight:"normal"},children:e.weekday})]}),dataIndex:e.date,key:e.date,width:170,render:(t,s)=>jsxRuntimeExports.jsx(ScheduleCard,{schedule:t,timeSlot:s.timeSlot,dateInfo:e,onCardClick:ve,userAvatars:T,avatarFrames:P,getCardColor:he,cardUpdateKey:X[(null==t?void 0:t.id)||`${e.date}-${s.timeSlot.id}`]||0,currentUserId:null==h?void 0:h.id,currentProfileId:null==x?void 0:x.id,timeSlots:r,onContextMenuEdit:ee,onContextMenuHistory:te,onContextMenuRate:re,onContextMenuRelease:ie,onContextMenuLock:se,onContextMenuUnlock:ne,canRegister:(null==S?void 0:S.canRegister)||!1})}))],i=r.map(r=>{const s={timeSlot:r,key:r.id};return t.forEach(t=>{var n,i;s[t.date]=(n=t.date,i=r.id,e.find(e=>e.date===n&&e.timeSlotId===i))}),s});return jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(ForwardTable,{columns:s,dataSource:i,pagination:!1,scroll:{x:"max-content"},size:"small",loading:n,style:{"--ant-table-row-hover-bg":"transparent","--ant-table-row-hover-transform":"none",borderRadius:"8px",overflow:"hidden"},rowClassName:()=>"compact-row"})})})()]}),jsxRuntimeExports.jsx(Modal$2,{title:c?0===c.managers.length&&""===c.location.name&&""===c.propertyType.name?"立即报名":"编辑直播安排":"立即报名",open:o,maskClosable:!1,onCancel:async()=>{var e;const t=m.getFieldsValue().managers||[],r=(null==(e=null==c?void 0:c.managers)?void 0:e.map(e=>e.id))||[];t.length!==r.length||t.some(e=>!r.includes(e))||r.some(e=>!t.includes(e))?Ee("温馨提示","您有未保存的更改，确定要关闭吗？",async()=>{await ye()}):await ye()},footer:null,width:600,destroyOnHidden:!0,children:jsxRuntimeExports.jsxs(Form$4,{form:m,layout:"vertical",onFinish:async e=>{try{if(i(!0),c){const e=await ae(c);if(!e.hasPermission)return console.warn("⚠️ 提交权限检查失败:",e.message),staticMethods.warning(e.message||"无权限提交此编辑"),void i(!1)}if(!Z||2!==Z.length)return void staticMethods.error("请选择2名直播管家");const n=Z.filter(e=>e&&"undefined"!==e&&"null"!==e);if(2!==n.length)return console.warn("⚠️ 检测到无效的管家数据:",Z),void staticMethods.error("请选择2名有效的直播管家");const o={date:c?c.date:toBeijingDateStr(dayjs()),timeSlotId:e.timeSlot,managers:n.map(e=>{const t=T[parseInt(e)]?{nickname:`用户${e}`}:null;return{id:e,name:(null==t?void 0:t.nickname)||`用户${e}`,department:"",avatar:void 0}}),location:{id:"",name:""},propertyType:{id:"",name:""},status:"booked"};if(c){const e=0===c.managers.length;try{if(e){const e=await updateLiveStreamSchedule(c.id,{...o,status:"booked"});if(!e||"booked"!==e.status)throw console.error("❌ 报名状态更新失败"),console.error("  - 期望状态: booked"),console.error("  - 实际状态:",null==e?void 0:e.status),new Error("报名状态更新失败");staticMethods.success("报名成功！")}else{const e=await updateLiveStreamSchedule(c.id,{...o,status:"booked"});if(!e||"booked"!==e.status)throw console.error("❌ 报名状态更新失败"),console.error("  - 期望状态: booked"),console.error("  - 实际状态:",null==e?void 0:e.status),new Error("报名状态更新失败");staticMethods.success("报名更新成功！")}const s=c.id;if(t(e=>e.map(e=>e.id===s?{...e,...o,status:"booked",managers:o.managers}:e)),null==x?void 0:x.id)try{const e=toBeijingDateStr(getWeekStart(d)),t=toBeijingDateStr(getWeekEnd(d)),r=await liveStreamRegistrationService.getRegistrationStatus(x.id,!1,e,t);C(r)}catch(r){console.warn("⚠️ [状态更新] 更新用户报名状态失败:",r)}a(!1),u(null),Q([]),m.resetFields(),setTimeout(async()=>{try{await xe()}catch(r){console.warn("⚠️ [状态更新] 数据重新加载失败:",r)}},500)}catch(s){return console.error("❌ 更新直播安排失败:",s),console.error("  - 错误详情:",s),void(s instanceof Error?s.message.includes("权限")?staticMethods.error("权限不足，无法报名"):s.message.includes("网络")?staticMethods.error("网络连接失败，请检查网络后重试"):staticMethods.error(`报名失败：${s.message}`):staticMethods.error("报名失败，请重试"))}}else console.error("❌ 编辑状态异常"),staticMethods.error("编辑状态异常，请刷新页面重试")}catch(r){console.error("❌ 报名操作失败:",r),staticMethods.error("报名失败，请检查网络连接后重试")}finally{i(!1)}},children:[jsxRuntimeExports.jsx(Form$4.Item,{label:"时间段",name:"timeSlot",rules:[{required:!0,message:"请选择时间段"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"选择时间段",disabled:!0,style:{backgroundColor:"#f5f5f5"},children:r.map(e=>{const t=(null==c?void 0:c.date)||toBeijingDateStr(dayjs()),r=dayjs(t),s=r.format("ddd"),n=r.format("MM-DD");return jsxRuntimeExports.jsxs(Option$1,{value:e.id,children:[n," ",s," ",e.startTime,"-",e.endTime," (","morning"===e.period?"上午":"afternoon"===e.period?"下午":"晚上",")"]},e.id)})})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"直播管家",name:"managers",extra:"请选择2名直播管家（您已自动被选中，请再选择1名）",rules:[{validator:(e,t)=>{const r=Z.length>0?Z:t||[];if(!r||0===r.length)return Promise.reject(new Error("请选择直播管家"));const s=(null==x?void 0:x.id)?String(x.id):null;return s&&!r.includes(s)?Promise.reject(new Error("您必须参与直播")):r.length<2?Promise.reject(new Error("请选择2名直播管家")):r.length>2?Promise.reject(new Error("最多只能选择2名直播管家")):Promise.resolve()}}],children:jsxRuntimeExports.jsx(UserTreeSelect,{value:Z,currentUserId:(null==x?void 0:x.id)?String(x.id):void 0,onChange:e=>{const t=(null==x?void 0:x.id)?String(x.id):null;let r=e;t&&!e.includes(t)&&(r=[t,...e.filter(e=>e!==t)]);const s=r.slice(0,2);r.length>2&&staticMethods.warning("最多只能选择2名直播管家，已自动保留前2名"),Q(s),m.setFieldsValue({managers:s})},placeholder:"请选择2名直播管家",maxTagCount:2,style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"space-between"},children:[c&&c.managers.length>0&&"booked"===c.status&&liveStreamRegistrationService.canCancelRegistration(k,"vip"===(null==S?void 0:S.currentPrivilegeType))&&jsxRuntimeExports.jsx(Button$1,{danger:!0,onClick:()=>{Ee("确认取消报名","确定要取消此次直播报名吗？取消后将释放该时间段供其他用户报名。",oe)},disabled:n,children:"取消报名"}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"12px"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:async()=>{var e;const t=m.getFieldsValue().managers||[],r=(null==(e=null==c?void 0:c.managers)?void 0:e.map(e=>e.id))||[];t.length!==r.length||t.some(e=>!r.includes(e))||r.some(e=>!t.includes(e))?Ee("温馨提示","您有未保存的更改，确定要取消吗？",async()=>{await ye()}):await ye()},disabled:n,children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:n,icon:jsxRuntimeExports.jsx(RefIcon$7,{}),children:c?"更新":"创建"})]})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:N,open:F,onOk:je,onCancel:be,okText:"确认",cancelText:"取消",width:500,zIndex:2e3,styles:{mask:{zIndex:1999}},footer:jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",alignItems:"center"},children:[jsxRuntimeExports.jsx(Button$1,{onClick:be,style:{minWidth:"80px"},children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:je,style:{minWidth:"80px"},children:"确认"})]}),children:jsxRuntimeExports.jsx("div",{style:{whiteSpace:"pre-line",lineHeight:"1.6",fontSize:"14px"},children:D})}),jsxRuntimeExports.jsx(LiveStreamHistoryDrawer,{scheduleId:(null==H?void 0:H.id)||"",visible:V,onClose:()=>{U(!1),W(null)},scheduleTitle:H?`${H.date} ${H.managers.map(e=>e.name).join(" / ")} 的历史记录`:"直播场次历史记录"}),jsxRuntimeExports.jsx(LiveStreamScoringDrawer,{visible:q,schedule:Y,onClose:()=>{G(!1),K(null)},onRefresh:()=>{xe(),G(!1)}})]})},LiveStreamBanner=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState(0);reactExports.useEffect(()=>{(async()=>{try{const e=await fetchBannersByPageType("live_stream_registration");t(e)}catch(e){console.error("加载banner失败:",e)}})()},[]),reactExports.useEffect(()=>{if(e.length>1){const t=setTimeout(()=>{s(t=>(t+1)%e.length)},5e3);return()=>clearTimeout(t)}},[r,e.length]);return(()=>{if(0===e.length)return null;const t=e[r];return jsxRuntimeExports.jsxs("div",{style:{width:"100%",aspectRatio:"9.6/1",position:"relative",background:"#364d79",borderRadius:10,overflow:"hidden",boxShadow:"0 4px 16px rgba(52,107,255,0.08)",marginBottom:16},children:[jsxRuntimeExports.jsx("img",{src:t.image_url,alt:t.title,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:10,background:"#222",cursor:t.jump_type&&"none"!==t.jump_type?"pointer":"default",display:"block"},onClick:()=>{var e;(e=t).jump_type&&"none"!==e.jump_type&&("url"===e.jump_type&&e.jump_target?window.open(e.jump_target,"_blank"):"route"===e.jump_type&&e.jump_target||"iframe"===e.jump_type&&e.jump_target)}}),e.length>1&&jsxRuntimeExports.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:8,width:"100%",textAlign:"center",zIndex:10,display:"flex",justifyContent:"center",gap:12},children:e.map((e,t)=>jsxRuntimeExports.jsx("span",{onClick:()=>s(t),style:{display:"inline-block",width:24,height:4,borderRadius:2,background:t===r?"#fff":"rgba(255,255,255,0.3)",cursor:"pointer",transition:"background 0.3s"}},t))})]})})()},LiveStreamRegistration=()=>jsxRuntimeExports.jsxs("div",{className:"page-card",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-between items-center mb-6",children:jsxRuntimeExports.jsx("h4",{className:"m-0 font-bold text-gray-800 text-lg",children:"直播报名管理"})}),jsxRuntimeExports.jsxs("div",{className:"page-table-wrap",children:[jsxRuntimeExports.jsx(LiveStreamBanner,{}),jsxRuntimeExports.jsx(LiveStreamRegistrationBase,{})]})]});var isBetween$1={exports:{}};isBetween$1.exports=function(e,t,r){t.prototype.isBetween=function(e,t,s,n){var i=r(e),o=r(t),a="("===(n=n||"()")[0],l=")"===n[1];return(a?this.isAfter(i,s):!this.isBefore(i,s))&&(l?this.isBefore(o,s):!this.isAfter(o,s))||(a?this.isBefore(i,s):!this.isAfter(i,s))&&(l?this.isAfter(o,s):!this.isBefore(o,s))}};var isBetweenExports=isBetween$1.exports;const isBetween=getDefaultExportFromCjs(isBetweenExports);dayjs.extend(isBetween);const{TabPane:TabPane}=Tabs,{Option:Option}=Select,LiveStreamManagement=()=>{const[e,t]=reactExports.useState([]),[r,s]=reactExports.useState([]),[n,i]=reactExports.useState([]),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState(null),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(!1),[h,x]=reactExports.useState(!1),[f,g]=reactExports.useState(null),[y,v]=reactExports.useState(null),[E]=Form$4.useForm(),[j]=Form$4.useForm(),[b,w]=reactExports.useState([]),[R,_]=reactExports.useState({dateRange:{start:dayjs().subtract(1,"month").format("YYYY-MM-DD"),end:toBeijingDateStr(dayjs())},scoreRange:{min:0,max:10},page:1,pageSize:10}),[S,C]=reactExports.useState(0),[k,$]=reactExports.useState(1),[T,I]=reactExports.useState(10),[P,A]=reactExports.useState(null),[F]=Form$4.useForm(),[M,D]=reactExports.useState(!1),[O,N]=reactExports.useState(!1),[B,L]=reactExports.useState([]);reactExports.useEffect(()=>{V(),z()},[R]);const z=async()=>{try{const{data:e,error:t}=await supabase.from("livestream_registration_config").select("*").order("created_at",{ascending:!1}).limit(1);if(t)return void console.error("查询配置失败:",t);if(e&&e.length>0){const t=e[0];if(A(t),t.privilege_managers&&t.privilege_managers.length>0){const{data:e,error:r}=await supabase.from("users_profile").select("id, nickname").in("id",t.privilege_managers);!r&&e&&L(e.map(e=>e.nickname||`用户${e.id}`))}else L([])}else A(null),L([])}catch(e){console.error("加载报名配置失败:",e)}},V=async()=>{var e,r,n,o;a(!0);try{let a=await getWeeklySchedule();(null==(e=R.dateRange)?void 0:e.start)&&(null==(r=R.dateRange)?void 0:r.end)&&(a=a.filter(e=>dayjs(e.date).isBetween(toBeijingTime(R.dateRange.start),toBeijingTime(R.dateRange.end),"day","[]"))),void 0===(null==(n=R.scoreRange)?void 0:n.min)&&void 0===(null==(o=R.scoreRange)?void 0:o.max)||(a=a.filter(e=>{var t,r;if(!e.average_score)return!0;const s=e.average_score,n=(null==(t=R.scoreRange)?void 0:t.min)??0,i=(null==(r=R.scoreRange)?void 0:r.max)??10;return s>=n&&s<=i})),R.statuses&&R.statuses.length>0&&(a=a.filter(e=>R.statuses.includes(e.status))),R.timeSlots&&R.timeSlots.length>0&&(a=a.filter(e=>R.timeSlots.includes(e.timeSlotId))),R.scoringStatuses&&R.scoringStatuses.length>0&&(a=a.filter(e=>R.scoringStatuses.includes(e.scoring_status||"not_scored"))),R.lockTypes&&R.lockTypes.length>0&&(a=a.filter(e=>R.lockTypes.includes(e.lockType||"none"))),R.participants&&R.participants.length>0&&(a=a.filter(e=>e.managers.some(e=>R.participants.some(t=>e.name.toLowerCase().includes(t.toLowerCase())))));const l=R.page||1,c=R.pageSize||10,u=(l-1)*c,d=u+c,p=a.slice(u,d),[m,h]=await Promise.all([getScoringDimensions(),getScoringOptions()]);t(p),C(a.length),$(l),I(c),s(m),i(h)}catch(l){console.error("加载数据失败:",l),staticMethods.error("加载数据失败")}finally{a(!1)}},U=[{title:"日期",dataIndex:"date",key:"date",width:120,render:e=>dayjs(e).format("MM-DD"),filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:8},children:[jsxRuntimeExports.jsx("span",{children:"日期范围："}),jsxRuntimeExports.jsx(DatePicker$2.RangePicker,{value:t[0]?[dayjs(t[0][0]),dayjs(t[0][1])]:void 0,onChange:t=>{t&&t[0]&&t[1]&&e([[t[0].format("YYYY-MM-DD"),t[1].format("YYYY-MM-DD")]])},style:{width:200,marginBottom:8}})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:8},children:[jsxRuntimeExports.jsx("span",{children:"快捷选择："}),jsxRuntimeExports.jsxs(Select,{placeholder:"选择快捷日期范围",style:{width:200,marginTop:4},onChange:t=>{const r=dayjs();let s,n;switch(t){case"today":s=r.format("YYYY-MM-DD"),n=r.format("YYYY-MM-DD");break;case"week":s=r.subtract(7,"day").format("YYYY-MM-DD"),n=r.format("YYYY-MM-DD");break;case"month":s=r.subtract(1,"month").format("YYYY-MM-DD"),n=r.format("YYYY-MM-DD");break;case"quarter":s=r.subtract(3,"month").format("YYYY-MM-DD"),n=r.format("YYYY-MM-DD");break;case"year":s=r.subtract(1,"year").format("YYYY-MM-DD"),n=r.format("YYYY-MM-DD");break;default:return}e([[s,n]])},children:[jsxRuntimeExports.jsx(Option,{value:"today",children:"今天"}),jsxRuntimeExports.jsx(Option,{value:"week",children:"最近一周"}),jsxRuntimeExports.jsx(Option,{value:"month",children:"最近一月"}),jsxRuntimeExports.jsx(Option,{value:"quarter",children:"最近三月"}),jsxRuntimeExports.jsx(Option,{value:"year",children:"最近一年"})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>{if(!e||!Array.isArray(e)||2!==e.length)return!0;const r=dayjs(t.date),s=dayjs(e[0]),n=dayjs(e[1]);return r.isBetween(toBeijingTime(s),toBeijingTime(n),"day","[]")}},{title:"时间段",dataIndex:"timeSlotId",key:"timeSlotId",width:100,render:e=>({"morning-10-12":"10-12点","afternoon-14-16":"14-16点","afternoon-16-18":"16-18点","evening-19-21":"19-21点","evening-21-23":"21-23点"}[e]||e),filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"选择时间段",value:t,onChange:t=>e(t),style:{width:200,marginBottom:8},children:[jsxRuntimeExports.jsx(Option,{value:"morning-10-12",children:"10-12点"}),jsxRuntimeExports.jsx(Option,{value:"afternoon-14-16",children:"14-16点"}),jsxRuntimeExports.jsx(Option,{value:"afternoon-16-18",children:"16-18点"}),jsxRuntimeExports.jsx(Option,{value:"evening-19-21",children:"19-21点"}),jsxRuntimeExports.jsx(Option,{value:"evening-21-23",children:"21-23点"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>Array.isArray(e)?e.includes(t.timeSlotId):t.timeSlotId===e},{title:"参与人",dataIndex:"managers",key:"managers",width:150,render:e=>e&&0!==e.length?e.map(e=>e.name).join(" / "):"-",filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(Input$1,{placeholder:"搜索参与人",value:t[0],onChange:t=>e(t.target.value?[t.target.value]:[]),onPressEnter:()=>r(),style:{width:188,marginBottom:8,display:"block"}}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"搜索"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>{var r;return(null==(r=t.managers)?void 0:r.some(t=>t.name.toLowerCase().includes(e.toLowerCase())))||!1}},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>(e=>{const t={available:{color:"green",text:"可报名"},booked:{color:"blue",text:"已报名"},completed:{color:"orange",text:"已完成"},cancelled:{color:"red",text:"已取消"},editing:{color:"processing",text:"编辑中"},locked:{color:"red",text:"已锁定"}}[e]||{color:"default",text:e};return jsxRuntimeExports.jsx(Tag$1,{color:t.color,children:t.text})})(e),filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"选择状态",value:t,onChange:t=>e(t),style:{width:200,marginBottom:8},children:[jsxRuntimeExports.jsx(Option,{value:"available",children:"可报名"}),jsxRuntimeExports.jsx(Option,{value:"booked",children:"已报名"}),jsxRuntimeExports.jsx(Option,{value:"completed",children:"已完成"}),jsxRuntimeExports.jsx(Option,{value:"cancelled",children:"已取消"}),jsxRuntimeExports.jsx(Option,{value:"editing",children:"编辑中"}),jsxRuntimeExports.jsx(Option,{value:"locked",children:"已锁定"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>Array.isArray(e)?e.includes(t.status):t.status===e},{title:"评分状态",key:"scoring_status",width:100,render:e=>(e=>{if(!e.scoring_status)return jsxRuntimeExports.jsx(Tag$1,{color:"default",children:"未评分"});const t={not_scored:{color:"default",text:"未评分"},scoring_in_progress:{color:"processing",text:"评分中"},scored:{color:"blue",text:"已评分"},approved:{color:"green",text:"已确认"}}[e.scoring_status]||{color:"default",text:e.scoring_status};return jsxRuntimeExports.jsx(Tag$1,{color:t.color,children:t.text})})(e),filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"选择评分状态",value:t,onChange:t=>e(t),style:{width:200,marginBottom:8},children:[jsxRuntimeExports.jsx(Option,{value:"not_scored",children:"未评分"}),jsxRuntimeExports.jsx(Option,{value:"scoring_in_progress",children:"评分中"}),jsxRuntimeExports.jsx(Option,{value:"scored",children:"已评分"}),jsxRuntimeExports.jsx(Option,{value:"approved",children:"已确认"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>Array.isArray(e)?e.includes(t.scoring_status):t.scoring_status===e},{title:"综合评分",key:"average_score",width:100,render:e=>null!==e.average_score&&void 0!==e.average_score?jsxRuntimeExports.jsxs("span",{style:{color:"#1890ff",fontWeight:"bold"},children:[e.average_score.toFixed(1),"分"]}):"-",filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:8},children:[jsxRuntimeExports.jsx("span",{children:"评分范围："}),jsxRuntimeExports.jsx(Slider,{range:!0,min:0,max:10,step:.1,value:t[0]?t[0]:[0,10],onChange:t=>e([t]),style:{width:200}})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>t.average_score?t.average_score>=e[0]&&t.average_score<=e[1]:0===e[0]&&10===e[1]},{title:"锁定状态",key:"lock_status",width:100,render:e=>e.lockType&&"none"!==e.lockType?jsxRuntimeExports.jsx(Tooltip,{title:e.lockReason||"系统锁定",children:jsxRuntimeExports.jsx(Tag$1,{color:"red",children:e.lockType})}):"-",filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsxs(Select,{mode:"multiple",placeholder:"选择锁定状态",value:t,onChange:t=>e(t),style:{width:200,marginBottom:8},children:[jsxRuntimeExports.jsx(Option,{value:"none",children:"无锁定"}),jsxRuntimeExports.jsx(Option,{value:"manual",children:"手动锁定"}),jsxRuntimeExports.jsx(Option,{value:"system",children:"系统锁定"}),jsxRuntimeExports.jsx(Option,{value:"maintenance",children:"维护锁定"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>Array.isArray(e)?e.includes(t.lockType):t.lockType===e},{title:"评分时间",key:"scored_at",width:120,render:e=>e.scored_at?dayjs(e.scored_at).format("MM-DD HH:mm"):"-",filterDropdown:({setSelectedKeys:e,selectedKeys:t,confirm:r,clearFilters:s})=>jsxRuntimeExports.jsxs("div",{style:{padding:8},children:[jsxRuntimeExports.jsx(DatePicker$2.RangePicker,{value:t[0]?[dayjs(t[0][0]),dayjs(t[0][1])]:void 0,onChange:t=>{t&&t[0]&&t[1]&&e([[t[0].format("YYYY-MM-DD"),t[1].format("YYYY-MM-DD")]])},style:{width:200,marginBottom:8}}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:8},children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",onClick:()=>r(),icon:jsxRuntimeExports.jsx(RefIcon$12,{}),size:"small",style:{flex:1},children:"筛选"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>null==s?void 0:s(),size:"small",style:{flex:1},children:"重置"})]})]}),onFilter:(e,t)=>{if(!t.scored_at)return!1;return dayjs(t.scored_at).isBetween(toBeijingTime(e[0]),toBeijingTime(e[1]),"day","[]")}},{title:"操作",key:"action",width:120,render:e=>jsxRuntimeExports.jsx("div",{style:{textAlign:"left"},children:jsxRuntimeExports.jsx(Tooltip,{title:"查看评分",children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",onClick:()=>(c(e),void d(!0)),children:"评分"})})})}];return jsxRuntimeExports.jsxs("div",{className:"live-stream-management",children:[jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsxs(Tabs,{defaultActiveKey:"schedules",children:[jsxRuntimeExports.jsx(TabPane,{tab:"直播数据",children:jsxRuntimeExports.jsx(ForwardTable,{columns:U,dataSource:e,rowKey:"id",loading:o,pagination:{current:k,pageSize:T,total:S,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},onChange:e=>{var t;t={page:e.current,pageSize:e.pageSize},_(e=>({...e,...t,page:1}))},scroll:{x:1e3}})},"schedules"),jsxRuntimeExports.jsx(TabPane,{tab:"评分规则管理",children:jsxRuntimeExports.jsxs("div",{className:"rules-management",children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("h3",{style:{margin:0},children:"评分维度管理"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{g(null),E.resetFields(),w([]),m(!0)},children:"添加维度"})]}),jsxRuntimeExports.jsx(ForwardTable,{columns:[{title:"维度名称",dataIndex:"dimension_name",key:"dimension_name"},{title:"维度代码",dataIndex:"dimension_code",key:"dimension_code"},{title:"权重",dataIndex:"weight",key:"weight",render:e=>e.toFixed(2)},{title:"排序",dataIndex:"sort_order",key:"sort_order"},{title:"状态",dataIndex:"is_active",key:"is_active",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e?"green":"red",children:e?"启用":"禁用"})},{title:"操作",key:"action",render:e=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>(e=>{g(e),E.setFieldsValue(e);const t=n.filter(t=>t.dimension_code===e.dimension_code);w(t),m(!0)})(e)}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除此维度吗？",onConfirm:()=>(async e=>{try{await deleteScoringDimension(e),staticMethods.success("删除成功"),V()}catch(t){staticMethods.error("删除失败")}})(e.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{})})})]})}],dataSource:r,rowKey:"id",pagination:!1})]})},"rules"),jsxRuntimeExports.jsx(TabPane,{tab:"直播设置",children:jsxRuntimeExports.jsxs("div",{className:"settings-management",children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("h3",{style:{margin:0},children:"报名配置管理"}),jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"default",onClick:async()=>{try{const{error:e}=await supabase.from("livestream_registration_config").insert([{registration_open_time:"09:00:00",registration_close_time:"18:00:00",registration_open_day_of_week:1,registration_close_day_of_week:5,privilege_advance_open_time:"08:00:00",privilege_advance_close_time:"20:00:00",privilege_advance_open_day_of_week:1,privilege_advance_close_day_of_week:7,weekly_limit_per_user:3,privilege_advance_limit:2,privilege_managers:[],is_active:!0,is_emergency_closed:!1}]);if(e)throw e;staticMethods.success("默认配置创建成功"),await z()}catch(e){console.error("创建默认配置失败:",e),staticMethods.error("创建默认配置失败")}},children:"创建默认配置"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$I,{}),onClick:()=>{P&&F.setFieldsValue({registration_open_time:dayjs(P.registration_open_time,"HH:mm:ss"),registration_close_time:dayjs(P.registration_close_time,"HH:mm:ss"),registration_open_day_of_week:P.registration_open_day_of_week,registration_close_day_of_week:P.registration_close_day_of_week,privilege_advance_open_time:dayjs(P.privilege_advance_open_time,"HH:mm:ss"),privilege_advance_close_time:dayjs(P.privilege_advance_close_time,"HH:mm:ss"),privilege_advance_open_day_of_week:P.privilege_advance_open_day_of_week,privilege_advance_close_day_of_week:P.privilege_advance_close_day_of_week,weekly_limit_per_user:P.weekly_limit_per_user,privilege_advance_limit:P.privilege_advance_limit,privilege_managers:P.privilege_managers,is_active:P.is_active,is_emergency_closed:P.is_emergency_closed}),N(!0)},children:P?"编辑配置":"创建配置"})]})]}),P?jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"基础报名时间"}),jsxRuntimeExports.jsxs("p",{children:["开放时间: ",P.registration_open_time]}),jsxRuntimeExports.jsxs("p",{children:["关闭时间: ",P.registration_close_time]}),jsxRuntimeExports.jsxs("p",{children:["开放星期: 周",P.registration_open_day_of_week," 至 周",P.registration_close_day_of_week]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"特权报名时间"}),jsxRuntimeExports.jsxs("p",{children:["开放时间: ",P.privilege_advance_open_time]}),jsxRuntimeExports.jsxs("p",{children:["关闭时间: ",P.privilege_advance_close_time]}),jsxRuntimeExports.jsxs("p",{children:["开放星期: 周",P.privilege_advance_open_day_of_week," 至 周",P.privilege_advance_close_day_of_week]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"报名限制"}),jsxRuntimeExports.jsxs("p",{children:["基础用户限制: ",P.weekly_limit_per_user,"场/周"]}),jsxRuntimeExports.jsxs("p",{children:["提前报名限制: ",P.privilege_advance_limit,"场/周"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"状态"}),jsxRuntimeExports.jsxs("p",{children:["配置状态: ",P.is_active?"启用":"禁用"]}),jsxRuntimeExports.jsxs("p",{children:["紧急关闭: ",P.is_emergency_closed?"是":"否"]}),jsxRuntimeExports.jsxs("p",{children:["VIP主播: ",B.length>0?B.join(", "):"无"]}),jsxRuntimeExports.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:"💡 系统会根据当前时间自动切换用户权益类型"}),P&&jsxRuntimeExports.jsxs("div",{style:{marginTop:"12px",padding:"8px",background:"#f0f2f5",borderRadius:"4px",fontSize:"12px"},children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"600",marginBottom:"4px"},children:"当前时间窗口状态："}),(()=>{const e=liveStreamRegistrationService.getCurrentTimeWindowStatus(P);return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:["当前时间: 周",e.currentDay," ",e.currentTime]}),jsxRuntimeExports.jsxs("div",{children:["基础窗口: ",e.inNormalWindow?"✅ 开放":"❌ 关闭"]}),jsxRuntimeExports.jsxs("div",{children:["VIP主播窗口: ",e.inPrivilegeWindow?"✅ 开放":"❌ 关闭"]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:"4px",fontWeight:"600",color:"vip"===e.privilegeType?"#722ed1":"normal"===e.privilegeType?"#1890ff":"#999"},children:["当前权益类型: ","vip"===e.privilegeType?"提前报名权益":"normal"===e.privilegeType?"基础权益":"无权益"]})]})})()]})]})]})}):jsxRuntimeExports.jsx(Card$1,{children:jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"40px"},children:jsxRuntimeExports.jsx("p",{children:'暂无配置，请点击"创建配置"按钮进行设置'})})})]})},"settings")]})}),jsxRuntimeExports.jsx(LiveStreamScoringDrawer,{visible:u,schedule:l,onClose:()=>{d(!1),c(null)},onRefresh:()=>{V()}}),jsxRuntimeExports.jsx(Modal$2,{title:"直播报名配置",open:O,onCancel:()=>N(!1),footer:null,width:800,children:jsxRuntimeExports.jsxs(Form$4,{form:F,onFinish:async e=>{D(!0);try{let t=[];e.privilege_managers&&Array.isArray(e.privilege_managers)&&(t=e.privilege_managers.map(e=>parseInt(e)).filter(e=>!isNaN(e)));const r={...e,registration_open_time:e.registration_open_time.format("HH:mm:ss"),registration_close_time:e.registration_close_time.format("HH:mm:ss"),privilege_advance_open_time:e.privilege_advance_open_time.format("HH:mm:ss"),privilege_advance_close_time:e.privilege_advance_close_time.format("HH:mm:ss"),privilege_managers:t,updated_at:(new Date).toISOString()};if(P){const{error:e}=await supabase.from("livestream_registration_config").update(r).eq("id",P.id);if(e)throw e;staticMethods.success("配置更新成功")}else{const{error:e}=await supabase.from("livestream_registration_config").insert([r]);if(e)throw e;staticMethods.success("配置创建成功")}N(!1),F.resetFields(),await z(),liveStreamRegistrationService.clearConfigCache();const s=`\n配置保存成功！\n\n📅基础报名时间：\n   • 开放时间：${r.registration_open_time}\n   • 关闭时间：${r.registration_close_time}\n   • 开放星期：周${r.registration_open_day_of_week} 至 周${r.registration_close_day_of_week}\n\n⭐ 提前报名时间：\n   • 开放时间：${r.privilege_advance_open_time}\n   • 关闭时间：${r.privilege_advance_close_time}\n   • 开放星期：周${r.privilege_advance_open_day_of_week} 至 周${r.privilege_advance_close_day_of_week}\n\n📊 报名限制：\n   • 基础用户：${r.weekly_limit_per_user}场/周\n   • VIP主播：${r.privilege_advance_limit}场/周\n\n👥 VIP主播：${t.length}人\n🔧 配置状态：${r.is_active?"启用":"禁用"}\n🚨 紧急关闭：${r.is_emergency_closed?"是":"否"}\n      `;Modal$2.info({title:"配置保存成功",content:jsxRuntimeExports.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:s}),width:600,okText:"确定"})}catch(t){console.error("保存配置失败:",t),staticMethods.error("保存配置失败")}finally{D(!1)}},layout:"vertical",children:[jsxRuntimeExports.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"基础报名时间设置"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"registration_open_time",label:"开放时间",rules:[{required:!0,message:"请选择开放时间"}],children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"registration_close_time",label:"关闭时间",rules:[{required:!0,message:"请选择关闭时间"}],children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"registration_open_day_of_week",label:"开放星期",rules:[{required:!0,message:"请选择开放星期"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择开放星期",children:[jsxRuntimeExports.jsx(Option,{value:1,children:"周一"}),jsxRuntimeExports.jsx(Option,{value:2,children:"周二"}),jsxRuntimeExports.jsx(Option,{value:3,children:"周三"}),jsxRuntimeExports.jsx(Option,{value:4,children:"周四"}),jsxRuntimeExports.jsx(Option,{value:5,children:"周五"}),jsxRuntimeExports.jsx(Option,{value:6,children:"周六"}),jsxRuntimeExports.jsx(Option,{value:7,children:"周日"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"registration_close_day_of_week",label:"关闭星期",rules:[{required:!0,message:"请选择关闭星期"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择关闭星期",children:[jsxRuntimeExports.jsx(Option,{value:1,children:"周一"}),jsxRuntimeExports.jsx(Option,{value:2,children:"周二"}),jsxRuntimeExports.jsx(Option,{value:3,children:"周三"}),jsxRuntimeExports.jsx(Option,{value:4,children:"周四"}),jsxRuntimeExports.jsx(Option,{value:5,children:"周五"}),jsxRuntimeExports.jsx(Option,{value:6,children:"周六"}),jsxRuntimeExports.jsx(Option,{value:7,children:"周日"})]})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"特权报名时间设置"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_advance_open_time",label:"特权开放时间",rules:[{required:!0,message:"请选择特权开放时间"}],children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_advance_close_time",label:"特权关闭时间",rules:[{required:!0,message:"请选择特权关闭时间"}],children:jsxRuntimeExports.jsx(TimePicker,{format:"HH:mm",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_advance_open_day_of_week",label:"特权开放星期",rules:[{required:!0,message:"请选择特权开放星期"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择特权开放星期",children:[jsxRuntimeExports.jsx(Option,{value:1,children:"周一"}),jsxRuntimeExports.jsx(Option,{value:2,children:"周二"}),jsxRuntimeExports.jsx(Option,{value:3,children:"周三"}),jsxRuntimeExports.jsx(Option,{value:4,children:"周四"}),jsxRuntimeExports.jsx(Option,{value:5,children:"周五"}),jsxRuntimeExports.jsx(Option,{value:6,children:"周六"}),jsxRuntimeExports.jsx(Option,{value:7,children:"周日"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_advance_close_day_of_week",label:"特权关闭星期",rules:[{required:!0,message:"请选择特权关闭星期"}],children:jsxRuntimeExports.jsxs(Select,{placeholder:"请选择特权关闭星期",children:[jsxRuntimeExports.jsx(Option,{value:1,children:"周一"}),jsxRuntimeExports.jsx(Option,{value:2,children:"周二"}),jsxRuntimeExports.jsx(Option,{value:3,children:"周三"}),jsxRuntimeExports.jsx(Option,{value:4,children:"周四"}),jsxRuntimeExports.jsx(Option,{value:5,children:"周五"}),jsxRuntimeExports.jsx(Option,{value:6,children:"周六"}),jsxRuntimeExports.jsx(Option,{value:7,children:"周日"})]})})]})]}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"报名限制设置"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"weekly_limit_per_user",label:"基础用户每周限制",rules:[{required:!0,message:"请输入每周限制"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,max:10,style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_advance_limit",label:"提前报名限制",rules:[{required:!0,message:"请输入提前报名限制"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:1,max:10,style:{width:"100%"}})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{children:"状态设置"}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"启用配置",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_emergency_closed",label:"紧急关闭报名",valuePropName:"checked",children:jsxRuntimeExports.jsx(Switch$1,{})})]})]}),jsxRuntimeExports.jsx(Form$4.Item,{name:"privilege_managers",label:"VIP主播",help:"选择可提前报名的VIP主播",children:jsxRuntimeExports.jsx(UserTreeSelect,{placeholder:"请选择VIP主播",multiple:!0,showSearch:!0,allowClear:!0,style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{style:{marginBottom:0,textAlign:"right"},children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{onClick:()=>N(!1),children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",loading:M,icon:jsxRuntimeExports.jsx(RefIcon$Z,{}),children:"保存配置"})]})})]})}),jsxRuntimeExports.jsx(Modal$2,{title:f?"编辑评分维度":"添加评分维度",open:p,onCancel:()=>m(!1),footer:null,width:800,children:jsxRuntimeExports.jsxs(Tabs,{defaultActiveKey:"dimension",children:[jsxRuntimeExports.jsx(TabPane,{tab:"维度信息",children:jsxRuntimeExports.jsxs(Form$4,{form:E,onFinish:async e=>{try{f?(await updateScoringDimension(f.id,e),staticMethods.success("编辑成功")):(await createScoringDimension(e),staticMethods.success("添加成功")),m(!1),V()}catch(t){staticMethods.error(f?"编辑失败":"添加失败")}},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"dimension_name",label:"维度名称",rules:[{required:!0,message:"请输入维度名称"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入维度名称"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"dimension_code",label:"维度代码",rules:[{required:!0,message:"请输入维度代码"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入维度代码"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"description",label:"描述",children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入描述"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"weight",label:"权重",rules:[{required:!0,message:"请输入权重"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,max:9.99,step:.01,placeholder:"请输入权重",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"sort_order",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,placeholder:"请输入排序",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"状态",initialValue:!0,children:jsxRuntimeExports.jsxs(Select,{children:[jsxRuntimeExports.jsx(Option,{value:!0,children:"启用"}),jsxRuntimeExports.jsx(Option,{value:!1,children:"禁用"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:f?"保存":"添加"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>m(!1),children:"取消"})]})})]})},"dimension"),f&&jsxRuntimeExports.jsxs(TabPane,{tab:"评分选项",children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:jsxRuntimeExports.jsx(Button$1,{type:"primary",icon:jsxRuntimeExports.jsx(RefIcon$a,{}),onClick:()=>{return e=f.dimension_code,v(null),j.resetFields(),e&&j.setFieldsValue({dimension_code:e}),void x(!0);var e},children:"添加选项"})}),jsxRuntimeExports.jsx(ForwardTable,{columns:[{title:"选项代码",dataIndex:"option_code",key:"option_code"},{title:"选项文本",dataIndex:"option_text",key:"option_text"},{title:"分数",dataIndex:"score",key:"score"},{title:"排序",dataIndex:"sort_order",key:"sort_order"},{title:"状态",dataIndex:"is_active",key:"is_active",render:e=>jsxRuntimeExports.jsx(Tag$1,{color:e?"green":"red",children:e?"启用":"禁用"})},{title:"操作",key:"action",render:e=>jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",icon:jsxRuntimeExports.jsx(RefIcon$c,{}),onClick:()=>{return v(t=e),j.setFieldsValue(t),void x(!0);var t}}),jsxRuntimeExports.jsx(Popconfirm,{title:"确定删除此选项吗？",onConfirm:()=>(async e=>{try{await deleteScoringOption(e),staticMethods.success("删除成功"),V()}catch(t){staticMethods.error("删除失败")}})(e.id),children:jsxRuntimeExports.jsx(Button$1,{type:"link",size:"small",danger:!0,icon:jsxRuntimeExports.jsx(RefIcon$O,{})})})]})}],dataSource:b,rowKey:"id",pagination:!1,size:"small"})]},"options")]})}),jsxRuntimeExports.jsx(Modal$2,{title:y?"编辑评分选项":"添加评分选项",open:h,onCancel:()=>x(!1),footer:null,children:jsxRuntimeExports.jsxs(Form$4,{form:j,onFinish:async e=>{try{y?(await updateScoringOption(y.id,e),staticMethods.success("编辑成功")):(await createScoringOption(e),staticMethods.success("添加成功")),x(!1),V()}catch(t){staticMethods.error(y?"编辑失败":"添加失败")}},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"dimension_code",label:"所属维度",rules:[{required:!0,message:"请选择所属维度"}],children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择所属维度",children:r.map(e=>jsxRuntimeExports.jsx(Option,{value:e.dimension_code,children:e.dimension_name},e.dimension_code))})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"option_code",label:"选项代码",rules:[{required:!0,message:"请输入选项代码"}],children:jsxRuntimeExports.jsx(Input$1,{placeholder:"请输入选项代码"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"option_text",label:"选项文本",rules:[{required:!0,message:"请输入选项文本"}],children:jsxRuntimeExports.jsx(Input$1.TextArea,{placeholder:"请输入选项文本"})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"score",label:"分数",rules:[{required:!0,message:"请输入分数"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,max:10,step:.1,placeholder:"请输入分数",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"sort_order",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:jsxRuntimeExports.jsx(TypedInputNumber,{min:0,placeholder:"请输入排序",style:{width:"100%"}})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"is_active",label:"状态",initialValue:!0,children:jsxRuntimeExports.jsxs(Select,{children:[jsxRuntimeExports.jsx(Option,{value:!0,children:"启用"}),jsxRuntimeExports.jsx(Option,{value:!1,children:"禁用"})]})}),jsxRuntimeExports.jsx(Form$4.Item,{children:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",children:y?"保存":"添加"}),jsxRuntimeExports.jsx(Button$1,{onClick:()=>x(!1),children:"取消"})]})})]})})]})},{Title:Title$2,Text:Text$2}=Typography,MetroDistanceCalculator=()=>{const[e,t]=reactExports.useState(""),[r,s]=reactExports.useState(""),[n,i]=reactExports.useState(null),[o,a]=reactExports.useState([]),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(null);reactExports.useEffect(()=>{p(),m()},[]);const p=async()=>{try{const{data:e,error:t}=await supabase.rpc("get_metrostations");if(t)throw t;if(e){const t=e.reduce((e,t)=>{const r=t.line||"其他";return e[r]||(e[r]=[]),e[r].push(t),e},{}),r=Object.entries(t).sort(([e],[t])=>{const r=e=>{const t=e.match(/^(\d+)号线$/);return t?parseInt(t[1]):999999};return r(e)-r(t)}).map(([e,t])=>({value:e,label:e,children:t.map(e=>({value:e.name,label:e.name}))}));a(r)}}catch(e){console.error("获取地铁站数据失败:",e),staticMethods.error("获取地铁站数据失败")}},m=async()=>{try{const{count:e}=await supabase.from("metrostations").select("*",{count:"exact",head:!0}),{data:t}=await supabase.from("metrostations").select("line").not("line","is",null),r=t?[...new Set(t.map(e=>e.line))]:[];d({totalStations:e||0,totalLines:r.length})}catch(e){console.error("获取系统统计信息失败:",e)}},h=async()=>{if(e&&r){c(!0);try{const{data:t,error:s}=await supabase.rpc("calculate_metro_commute_time",{p_start_station:e,p_end_station:r});if(s)throw s;t&&(i(t),staticMethods.success("计算完成！"))}catch(t){console.error("计算通勤信息时出错:",t),staticMethods.error(`计算失败: ${t.message||"未知错误"}`)}finally{c(!1)}}},x=(e,r,n)=>{let i="";r&&r.length>1?i=r[1].label:r&&1===r.length&&(i=r[0].label),"from"===n?t(i):s(i)},f=(e,t)=>{if(!t||!e)return[];for(const r of e){if(r.value===t)return[r.value];if(r.children){const e=f(r.children,t);if(e.length>0)return[r.value,...e]}}return[]};return jsxRuntimeExports.jsxs("div",{className:"metro-distance-calculator",children:[jsxRuntimeExports.jsxs(Title$2,{level:2,className:"calculator-title",children:[jsxRuntimeExports.jsx(RefIcon$19,{})," 上海地铁通勤时间计算器",jsxRuntimeExports.jsx(Text$2,{type:"secondary",style:{fontSize:"14px",marginLeft:"16px"},children:"使用数据库函数计算，性能优化版本"})]}),u&&jsxRuntimeExports.jsx(Alert,{message:`系统状态: ${u.totalStations}个站点, ${u.totalLines}条线路`,type:"info",showIcon:!0,icon:jsxRuntimeExports.jsx(RefIcon$t,{}),style:{marginBottom:16},action:jsxRuntimeExports.jsx(Space$1,{children:jsxRuntimeExports.jsx(Button$1,{size:"small",onClick:()=>{p(),m(),staticMethods.success("数据已刷新")},children:"刷新数据"})})}),jsxRuntimeExports.jsxs("div",{className:"calculator-container",children:[jsxRuntimeExports.jsx(Card$1,{title:"选择站点",className:"station-selection-card",children:jsxRuntimeExports.jsxs(Space$1,{direction:"vertical",size:"large",style:{width:"100%"},children:[jsxRuntimeExports.jsxs("div",{className:"station-input-group",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"起始站点："}),jsxRuntimeExports.jsx(Cascader,{options:o,value:e?f(o,e):void 0,onChange:(e,t)=>x(0,t,"from"),placeholder:"请选择起始站点",style:{width:"100%"},showSearch:!0,changeOnSelect:!1,allowClear:!0,expandTrigger:"hover"})]}),jsxRuntimeExports.jsxs("div",{className:"station-input-group",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"终点站点："}),jsxRuntimeExports.jsx(Cascader,{options:o,value:r?f(o,r):void 0,onChange:(e,t)=>x(0,t,"to"),placeholder:"请选择终点站点",style:{width:"100%"},showSearch:!0,changeOnSelect:!1,allowClear:!0,expandTrigger:"hover"})]}),jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"large",onClick:h,disabled:!e||!r||l,icon:jsxRuntimeExports.jsx(RefIcon$8,{}),style:{width:"100%"},loading:l,children:l?"计算中...":"计算通勤时间"}),jsxRuntimeExports.jsx(Button$1,{type:"dashed",size:"large",onClick:()=>{t("莘庄"),s("人民广场"),setTimeout(()=>{h()},100)},style:{width:"100%"},children:"测试：莘庄 → 人民广场"}),jsxRuntimeExports.jsx(Button$1,{type:"dashed",size:"large",onClick:()=>{t("顾村公园"),s("人民广场"),setTimeout(()=>{h()},100)},style:{width:"100%"},children:"测试：顾村公园 → 人民广场"})]})}),n&&n.success&&jsxRuntimeExports.jsx(Card$1,{title:"通勤信息",className:"result-card",children:jsxRuntimeExports.jsxs("div",{className:"result-content",children:[jsxRuntimeExports.jsx("div",{className:"route-info",children:jsxRuntimeExports.jsxs("div",{className:"route-item",children:[jsxRuntimeExports.jsx(Tag$1,{color:"blue",icon:jsxRuntimeExports.jsx(RefIcon$3,{}),children:n.start_station}),jsxRuntimeExports.jsx(Text$2,{className:"route-arrow",children:"→"}),jsxRuntimeExports.jsx(Tag$1,{color:"green",icon:jsxRuntimeExports.jsx(RefIcon$3,{}),children:n.end_station})]})}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsxs("div",{className:"result-details",children:[jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(RefIcon$R,{className:"detail-icon"}),jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"预计通勤时间："}),jsxRuntimeExports.jsx(Text$2,{className:"detail-value",children:(e=>{if(e<60)return`${e}分钟`;const t=e%60;return`${Math.floor(e/60)}小时${t>0?t+"分钟":""}`})(n.total_time_minutes)}),jsxRuntimeExports.jsxs(Text$2,{type:"secondary",style:{fontSize:"12px",marginLeft:"8px"},children:["(",n.total_time_formatted,")"]})]}),jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(RefIcon$3,{className:"detail-icon"}),jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"站点数量："}),jsxRuntimeExports.jsxs(Text$2,{className:"detail-value",children:[n.stations_count," 站"]})]}),jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(RefIcon$3,{className:"detail-icon"}),jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"换乘次数："}),jsxRuntimeExports.jsxs(Text$2,{className:"detail-value",children:[n.transfer_count," 次"]}),n.transfer_count>0&&jsxRuntimeExports.jsx(Text$2,{type:"secondary",style:{fontSize:"12px",marginLeft:"8px"},children:"(每次换乘+5分钟)"})]}),jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"路线摘要："}),jsxRuntimeExports.jsx(Text$2,{className:"detail-value",style:{marginLeft:"8px"},children:n.route_summary})]}),n.transfers&&n.transfers.length>0&&jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"换乘详情："}),jsxRuntimeExports.jsx("div",{className:"transfer-details",children:n.transfers.map((e,t)=>jsxRuntimeExports.jsxs("div",{className:"transfer-detail",children:[jsxRuntimeExports.jsx(Tag$1,{color:"orange",children:"换乘"}),jsxRuntimeExports.jsxs(Text$2,{children:["在 ",e.station," 从 ",e.from_line," 换乘到 ",e.to_line]})]},t))})]}),jsxRuntimeExports.jsxs("div",{className:"detail-item",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,children:"完整路径："}),jsxRuntimeExports.jsx("div",{className:"path-details",children:n.path.map((e,t)=>jsxRuntimeExports.jsx(Tag$1,{color:0===t?"blue":t===n.path.length-1?"green":"default",children:e},t))})]})]})]})}),n&&!n.success&&jsxRuntimeExports.jsx(Alert,{message:"计算失败",description:n.error||"未知错误",type:"error",showIcon:!0,style:{marginBottom:16}}),jsxRuntimeExports.jsx(Card$1,{title:"所有站点列表",className:"stations-list-card",children:jsxRuntimeExports.jsx("div",{className:"stations-grid",children:o.map(n=>{var i;return jsxRuntimeExports.jsxs("div",{className:"line-group",children:[jsxRuntimeExports.jsx(Text$2,{strong:!0,style:{display:"block",marginBottom:"8px",color:"#1890ff"},children:n.label}),jsxRuntimeExports.jsx("div",{className:"stations-in-line",children:null==(i=n.children)?void 0:i.map(n=>jsxRuntimeExports.jsx(Tag$1,{className:"station-tag",onClick:()=>{e?r||s(n.value):t(n.value)},children:n.label},n.value))})]},n.value)})})})]})]})},MetroDistanceCalculatorPage=()=>jsxRuntimeExports.jsx("div",{className:"metro-calculator-page",children:jsxRuntimeExports.jsx(MetroDistanceCalculator,{})}),{Text:Text$1,Title:Title$1}=Typography,WecomCallback=()=>{const[e]=useSearchParams(),t=useNavigate(),{login:r}=useAuth(),[s,n]=reactExports.useState("loading"),[i,o]=reactExports.useState(""),[a,l]=reactExports.useState("");reactExports.useEffect(()=>{c()},[]);const c=async()=>{try{console.log("=== 企业微信回调处理开始 ==="),console.log("当前URL:",window.location.href),console.log("URL参数:",window.location.search);const s=e.get("code"),i=e.get("state"),a=e.get("error");if(console.log("解析到的参数:",{code:s,state:i,errorParam:a}),a)return console.error("企业微信回调包含错误参数:",a),n("error"),void l(decodeURIComponent(a));if(!s||!i)return console.error("缺少必要的授权参数:",{code:!!s,state:!!i}),n("error"),void l("缺少必要的授权参数");console.log("开始调用后端API处理企业微信回调...");const c=await handleWecomCallbackPost({code:s,state:i});if(console.log("后端API响应:",c),!c.success)return console.error("后端API返回失败:",c.error),n("error"),void l(c.error||"企业微信认证失败");const{userInfo:u}=c.data||{};if(!u)return console.error("后端返回的用户信息为空"),n("error"),void l("获取用户信息失败");console.log("企业微信用户信息:",u),console.log("开始使用用户信息进行登录...");const{success:d,error:p}=await r(u.email,"",u);console.log("登录结果:",{success:d,error:p}),d?(console.log("企业微信登录成功！"),n("success"),o("企业微信登录成功！正在跳转..."),setTimeout(()=>{t("/",{replace:!0})},2e3)):(console.error("企业微信登录失败:",p),n("error"),l(p||"企业微信登录失败"))}catch(s){console.error("处理企业微信回调失败:",s),n("error"),l(s.message||"处理回调时发生错误")}};return jsxRuntimeExports.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5"},children:jsxRuntimeExports.jsxs("div",{style:{maxWidth:500,width:"100%",padding:"40px",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[(()=>{switch(s){case"loading":return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[jsxRuntimeExports.jsx(Spin,{size:"large",indicator:jsxRuntimeExports.jsx(RefIcon$U,{style:{fontSize:48},spin:!0})}),jsxRuntimeExports.jsxs("div",{style:{marginTop:24},children:[jsxRuntimeExports.jsx(Title$1,{level:4,children:"正在处理企业微信登录..."}),jsxRuntimeExports.jsx(Text$1,{type:"secondary",children:"请稍候，我们正在验证您的身份"})]})]});case"success":return jsxRuntimeExports.jsx(Result,{icon:jsxRuntimeExports.jsx(RefIcon$7,{style:{color:"#52c41a"}}),status:"success",title:"企业微信登录成功！",subTitle:i,extra:[jsxRuntimeExports.jsx(Text$1,{type:"secondary",children:"正在为您跳转到主页面..."},"redirect")]});case"error":return jsxRuntimeExports.jsx(Result,{icon:jsxRuntimeExports.jsx(RefIcon$$,{style:{color:"#ff4d4f"}}),status:"error",title:"企业微信登录失败",subTitle:a,extra:[jsxRuntimeExports.jsx(Text$1,{type:"secondary",children:"请返回登录页面重新尝试"},"retry")]});default:return null}})(),"error"===s&&jsxRuntimeExports.jsx("div",{style:{textAlign:"center",marginTop:24},children:jsxRuntimeExports.jsx("button",{onClick:()=>t("/login"),style:{padding:"8px 16px",backgroundColor:"#1890ff",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"返回登录页面"})})]})})},canUseDom=!("undefined"==typeof window||"undefined"==typeof document||!window.document||!window.document.createElement);canUseDom&&document.addEventListener("touchstart",()=>{},!0);const typeTemplate$1="${label}不是一个有效的${type}",zhCN={locale:"zh-CH",common:{confirm:"确定",cancel:"取消",loading:"加载中",close:"关闭"},Calendar:{title:"日期选择",confirm:"确认",start:"开始",end:"结束",today:"今日",markItems:["一","二","三","四","五","六","日"],yearAndMonth:"${year}年${month}月"},Cascader:{placeholder:"请选择"},Dialog:{ok:"我知道了"},DatePicker:{tillNow:"至今"},ErrorBlock:{default:{title:"页面遇到一些小问题",description:"待会来试试"},busy:{title:"前方拥堵",description:"刷新试试"},disconnected:{title:"网络有点忙",description:"动动手指帮忙修复"},empty:{title:"没有找到你需要的东西",description:"找找其他的吧"}},Form:{required:"必填",optional:"选填",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:typeTemplate$1,method:typeTemplate$1,array:typeTemplate$1,object:typeTemplate$1,number:typeTemplate$1,date:typeTemplate$1,boolean:typeTemplate$1,integer:typeTemplate$1,float:typeTemplate$1,regexp:typeTemplate$1,email:typeTemplate$1,url:typeTemplate$1,hex:typeTemplate$1},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},ImageUploader:{uploading:"上传中...",upload:"上传"},InfiniteScroll:{noMore:"没有更多了",failedToLoad:"加载失败",retry:"重新加载"},Input:{clear:"清除"},Mask:{name:"背景蒙层"},Modal:{ok:"我知道了"},PasscodeInput:{name:"密码输入框"},PullToRefresh:{pulling:"下拉刷新",canRelease:"释放立即刷新",complete:"刷新成功"},SearchBar:{name:"搜索框"},Slider:{name:"滑动输入条"},Stepper:{decrease:"减少",increase:"增加"},Switch:{name:"开关"},Selector:{name:"选择组"}},defaultConfigRef={current:{locale:zhCN}};function getDefaultConfig(){return defaultConfigRef.current}const ConfigContext=React$2.createContext(null);function useConfig(){var e;return null!==(e=reactExports.useContext(ConfigContext))&&void 0!==e?e:getDefaultConfig()}function attachPropertiesToComponent(e,t){const r=e;for(const s in t)t.hasOwnProperty(s)&&(r[s]=t[s]);return r}function withNativeProps(e,t){const r=Object.assign({},t.props);e.className&&(r.className=classNames$1(t.props.className,e.className)),e.style&&(r.style=Object.assign(Object.assign({},r.style),e.style)),void 0!==e.tabIndex&&(r.tabIndex=e.tabIndex);for(const s in e)e.hasOwnProperty(s)&&(s.startsWith("data-")||s.startsWith("aria-"))&&(r[s]=e[s]);return React$2.cloneElement(t,r)}function mergeProps(...e){const t={};return e.forEach(e=>{e&&Object.keys(e).forEach(r=>{void 0!==e[r]&&(t[r]=e[r])})}),t}function mergeProp(e,...t){for(let r=t.length-1;r>=0;r-=1)if(void 0!==t[r])return t[r];return e}var createUpdateEffect=function(e){return function(t,r){var s=reactExports.useRef(!1);e(function(){return function(){s.current=!1}},[]),e(function(){if(s.current)return t();s.current=!0},r)}},isFunction=function(e){return"function"==typeof e},useMemoizedFn=function(e){var t=reactExports.useRef(e);t.current=reactExports.useMemo(function(){return e},[e]);var r=reactExports.useRef(void 0);return r.current||(r.current=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.current.apply(this,e)}),r.current};const useUpdateEffect=createUpdateEffect(reactExports.useEffect);function depsAreSame(e,t){if(e===t)return!0;for(var r=0;r<e.length;r++)if(!Object.is(e[r],t[r]))return!1;return!0}function useLatest(e){var t=reactExports.useRef(e);return t.current=e,t}var useUnmount=function(e){var t=useLatest(e);reactExports.useEffect(function(){return function(){t.current()}},[])},isObject$1=isObject_1,now=now_1,toNumber=toNumber_1,FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce$1(e,t,r){var s,n,i,o,a,l,c=0,u=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);function m(t){var r=s,i=n;return s=n=void 0,c=t,o=e.apply(i,r)}function h(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-c>=i}function x(){var e=now();if(h(e))return f(e);a=setTimeout(x,function(e){var r=t-(e-l);return d?nativeMin(r,i-(e-c)):r}(e))}function f(e){return a=void 0,p&&s?m(e):(s=n=void 0,o)}function g(){var e=now(),r=h(e);if(s=arguments,n=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(x,t),u?m(e):o}(l);if(d)return clearTimeout(a),a=setTimeout(x,t),m(l)}return void 0===a&&(a=setTimeout(x,t)),o}return t=toNumber(t)||0,isObject$1(r)&&(u=!!r.leading,i=(d="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):i,p="trailing"in r?!!r.trailing:p),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,s=l=n=a=void 0},g.flush=function(){return void 0===a?o:f(now())},g}var debounce_1=debounce$1;const debounce$2=getDefaultExportFromCjs(debounce_1);var isBrowser$1=!("undefined"==typeof window||!window.document||!window.document.createElement),debounce=debounce_1,isObject=isObject_1,FUNC_ERROR_TEXT="Expected a function";function throttle(e,t,r){var s=!0,n=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject(r)&&(s="leading"in r?!!r.leading:s,n="trailing"in r?!!r.trailing:n),debounce(e,t,{leading:s,maxWait:t,trailing:n})}var throttle_1=throttle;const throttle$1=getDefaultExportFromCjs(throttle_1);var useUpdate=function(){var e=__read(reactExports.useState({}),2)[1];return reactExports.useCallback(function(){return e({})},[])};function getTargetElement(e,t){if(isBrowser$1)return e?isFunction(e)?e():"current"in e?e.current:e:t}var checkIfAllInShadow=function(e){return e.every(function(e){var t=getTargetElement(e);return!!t&&t.getRootNode()instanceof ShadowRoot})},getShadow=function(e){return e?e.getRootNode():document},getDocumentOrShadow=function(e){if(!e||!document.getRootNode)return document;var t=Array.isArray(e)?e:[e];return checkIfAllInShadow(t)?getShadow(getTargetElement(t[0])):document},createEffectWithTarget=function(e){return function(t,r,s){var n=reactExports.useRef(!1),i=reactExports.useRef([]),o=reactExports.useRef([]),a=reactExports.useRef(void 0);e(function(){var e,l=(Array.isArray(s)?s:[s]).map(function(e){return getTargetElement(e)});if(!n.current)return n.current=!0,i.current=l,o.current=r,void(a.current=t());l.length===i.current.length&&depsAreSame(i.current,l)&&depsAreSame(o.current,r)||(null===(e=a.current)||void 0===e||e.call(a),i.current=l,o.current=r,a.current=t())}),useUnmount(function(){var e;null===(e=a.current)||void 0===e||e.call(a),n.current=!1})}},useEffectWithTarget$1=createEffectWithTarget(reactExports.useEffect);function useClickAway(e,t,r){void 0===r&&(r="click");var s=useLatest(e);useEffectWithTarget$1(function(){var e=function(e){(Array.isArray(t)?t:[t]).some(function(t){var r=getTargetElement(t);return!r||r.contains(e.target)})||s.current(e)},n=getDocumentOrShadow(t),i=Array.isArray(r)?r:[r];return i.forEach(function(t){return n.addEventListener(t,e)}),function(){i.forEach(function(t){return n.removeEventListener(t,e)})}},Array.isArray(r)?r:[r],t)}function isNodeOrWeb(){var e="object"==("undefined"==typeof global?"undefined":typeof global)&&global&&global.Object===Object&&global,t="object"==typeof self&&self&&self.Object===Object&&self;return e||t}function useDebounceFn(e,t){var r,s=useLatest(e),n=null!==(r=null==t?void 0:t.wait)&&void 0!==r?r:1e3,i=reactExports.useMemo(function(){return debounce$2(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.current.apply(s,__spreadArray([],__read(e),!1))},n,t)},[]);return useUnmount(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}function useDebounceEffect(e,t,r){var s=__read(reactExports.useState({}),2),n=s[0],i=s[1],o=useDebounceFn(function(){i({})},r).run;reactExports.useEffect(function(){return o()},t),useUpdateEffect(e,[n])}isNodeOrWeb()||(global.Date=Date);var hasElementType="undefined"!=typeof Element,hasMap="function"==typeof Map,hasSet="function"==typeof Set,hasArrayBuffer="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function equal(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var r,s,n,i;if(Array.isArray(e)){if((r=e.length)!=t.length)return!1;for(s=r;0!==s--;)if(!equal(e[s],t[s]))return!1;return!0}if(hasMap&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i=e.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;for(i=e.entries();!(s=i.next()).done;)if(!equal(s.value[1],t.get(s.value[0])))return!1;return!0}if(hasSet&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i=e.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(hasArrayBuffer&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if((r=e.length)!=t.length)return!1;for(s=r;0!==s--;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"==typeof e.valueOf&&"function"==typeof t.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&"function"==typeof e.toString&&"function"==typeof t.toString)return e.toString()===t.toString();if((r=(n=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(s=r;0!==s--;)if(!Object.prototype.hasOwnProperty.call(t,n[s]))return!1;if(hasElementType&&e instanceof Element)return!1;for(s=r;0!==s--;)if(("_owner"!==n[s]&&"__v"!==n[s]&&"__o"!==n[s]||!e.$$typeof)&&!equal(e[n[s]],t[n[s]]))return!1;return!0}return e!=e&&t!=t}var reactFastCompare=function(e,t){try{return equal(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const isEqual$1=getDefaultExportFromCjs(reactFastCompare);function useInViewport(e,t){var r={},s=r.callback,n=__rest$1(r,["callback"]),i=__read(reactExports.useState(),2),o=i[0],a=i[1],l=__read(reactExports.useState(),2),c=l[0],u=l[1];return useEffectWithTarget$1(function(){var t=(Array.isArray(e)?e:[e]).map(function(e){return getTargetElement(e)}).filter(Boolean);if(t.length){var r=new IntersectionObserver(function(e){var t,r;try{for(var n=__values(e),i=n.next();!i.done;i=n.next()){var o=i.value;u(o.intersectionRatio),a(o.isIntersecting),null==s||s(o)}}catch(l){t={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},__assign(__assign({},n),{root:getTargetElement(void 0)}));return t.forEach(function(e){return r.observe(e)}),function(){r.disconnect()}}},[void 0,void 0,s],e),[o,c]}!function(){if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var e=function(){for(var e=window.document,t=n(e);t;)t=n(e=t.ownerDocument);return e}(),t=[],r=null,s=null;o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.USE_MUTATION_OBSERVER=!0,o._setupCrossOriginUpdater=function(){return r||(r=function(e,r){s=e&&r?p(e,r):{top:0,bottom:0,left:0,right:0,width:0,height:0},t.forEach(function(e){e._checkForIntersections()})}),r},o._resetCrossOriginUpdater=function(){r=null,s=null},o.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(e.ownerDocument),this._checkForIntersections()}},o.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._unmonitorIntersections(e.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},o.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,r){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==r[t-1]})},o.prototype._parseRootMargin=function(e){var t=(e||"0px").split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},o.prototype._monitorIntersections=function(t){var r=t.defaultView;if(r&&-1==this._monitoringDocuments.indexOf(t)){var s=this._checkForIntersections,i=null,o=null;this.POLL_INTERVAL?i=r.setInterval(s,this.POLL_INTERVAL):(a(r,"resize",s,!0),a(t,"scroll",s,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in r&&(o=new r.MutationObserver(s)).observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(t),this._monitoringUnsubscribes.push(function(){var e=t.defaultView;e&&(i&&e.clearInterval(i),l(e,"resize",s,!0)),l(t,"scroll",s,!0),o&&o.disconnect()});var c=this.root&&(this.root.ownerDocument||this.root)||e;if(t!=c){var u=n(t);u&&this._monitorIntersections(u.ownerDocument)}}},o.prototype._unmonitorIntersections=function(t){var r=this._monitoringDocuments.indexOf(t);if(-1!=r){var s=this.root&&(this.root.ownerDocument||this.root)||e;if(!this._observationTargets.some(function(e){var r=e.element.ownerDocument;if(r==t)return!0;for(;r&&r!=s;){var i=n(r);if((r=i&&i.ownerDocument)==t)return!0}return!1})){var i=this._monitoringUnsubscribes[r];if(this._monitoringDocuments.splice(r,1),this._monitoringUnsubscribes.splice(r,1),i(),t!=s){var o=n(t);o&&this._unmonitorIntersections(o.ownerDocument)}}}},o.prototype._unmonitorAllIntersections=function(){var e=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var t=0;t<e.length;t++)e[t]()},o.prototype._checkForIntersections=function(){if(this.root||!r||s){var e=this._rootIsInDom(),t=e?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(s){var n=s.element,o=u(n),a=this._rootContainsTarget(n),l=s.entry,c=e&&a&&this._computeTargetAndRootIntersection(n,o,t),d=null;this._rootContainsTarget(n)?r&&!this.root||(d=t):d={top:0,bottom:0,left:0,right:0,width:0,height:0};var p=s.entry=new i({time:window.performance&&performance.now&&performance.now(),target:n,boundingClientRect:o,rootBounds:d,intersectionRect:c});l?e&&a?this._hasCrossedThreshold(l,p)&&this._queuedEntries.push(p):l&&l.isIntersecting&&this._queuedEntries.push(p):this._queuedEntries.push(p)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},o.prototype._computeTargetAndRootIntersection=function(t,n,i){if("none"!=window.getComputedStyle(t).display){for(var o=n,a=h(t),l=!1;!l&&a;){var d=null,m=1==a.nodeType?window.getComputedStyle(a):{};if("none"==m.display)return null;if(a==this.root||9==a.nodeType)if(l=!0,a==this.root||a==e)r&&!this.root?!s||0==s.width&&0==s.height?(a=null,d=null,o=null):d=s:d=i;else{var x=h(a),f=x&&u(x),g=x&&this._computeTargetAndRootIntersection(x,f,i);f&&g?(a=x,d=p(f,g)):(a=null,o=null)}else{var y=a.ownerDocument;a!=y.body&&a!=y.documentElement&&"visible"!=m.overflow&&(d=u(a))}if(d&&(o=c(d,o)),!o)break;a=a&&h(a)}return o}},o.prototype._getRootRect=function(){var t;if(this.root&&!x(this.root))t=u(this.root);else{var r=x(this.root)?this.root:e,s=r.documentElement,n=r.body;t={top:0,left:0,right:s.clientWidth||n.clientWidth,width:s.clientWidth||n.clientWidth,bottom:s.clientHeight||n.clientHeight,height:s.clientHeight||n.clientHeight}}return this._expandRectByRootMargin(t)},o.prototype._expandRectByRootMargin=function(e){var t=this._rootMarginValues.map(function(t,r){return"px"==t.unit?t.value:t.value*(r%2?e.width:e.height)/100}),r={top:e.top-t[0],right:e.right+t[1],bottom:e.bottom+t[2],left:e.left-t[3]};return r.width=r.right-r.left,r.height=r.bottom-r.top,r},o.prototype._hasCrossedThreshold=function(e,t){var r=e&&e.isIntersecting?e.intersectionRatio||0:-1,s=t.isIntersecting?t.intersectionRatio||0:-1;if(r!==s)for(var n=0;n<this.thresholds.length;n++){var i=this.thresholds[n];if(i==r||i==s||i<r!=i<s)return!0}},o.prototype._rootIsInDom=function(){return!this.root||m(e,this.root)},o.prototype._rootContainsTarget=function(t){var r=this.root&&(this.root.ownerDocument||this.root)||e;return m(r,t)&&(!this.root||r==t.ownerDocument)},o.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},o.prototype._unregisterInstance=function(){var e=t.indexOf(this);-1!=e&&t.splice(e,1)},window.IntersectionObserver=o,window.IntersectionObserverEntry=i}function n(e){try{return e.defaultView&&e.defaultView.frameElement||null}catch(e2){return null}}function i(e){this.time=e.time,this.target=e.target,this.rootBounds=d(e.rootBounds),this.boundingClientRect=d(e.boundingClientRect),this.intersectionRect=d(e.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,r=t.width*t.height,s=this.intersectionRect,n=s.width*s.height;this.intersectionRatio=r?Number((n/r).toFixed(4)):this.isIntersecting?1:0}function o(e,t){var r,s,n,i=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(i.root&&1!=i.root.nodeType&&9!=i.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(r=this._checkForIntersections.bind(this),s=this.THROTTLE_TIMEOUT,n=null,function(){n||(n=setTimeout(function(){r(),n=null},s))}),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(i.rootMargin),this.thresholds=this._initThresholds(i.threshold),this.root=i.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function a(e,t,r,s){"function"==typeof e.addEventListener?e.addEventListener(t,r,s):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,r)}function l(e,t,r,s){"function"==typeof e.removeEventListener?e.removeEventListener(t,r,s):"function"==typeof e.detachEvent&&e.detachEvent("on"+t,r)}function c(e,t){var r=Math.max(e.top,t.top),s=Math.min(e.bottom,t.bottom),n=Math.max(e.left,t.left),i=Math.min(e.right,t.right),o=i-n,a=s-r;return o>=0&&a>=0&&{top:r,bottom:s,left:n,right:i,width:o,height:a}||null}function u(e){var t;try{t=e.getBoundingClientRect()}catch(r){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function d(e){return!e||"x"in e?e:{top:e.top,y:e.top,bottom:e.bottom,left:e.left,x:e.left,right:e.right,width:e.width,height:e.height}}function p(e,t){var r=t.top-e.top,s=t.left-e.left;return{top:r,left:s,height:t.height,width:t.width,bottom:r+t.height,right:s+t.width}}function m(e,t){for(var r=t;r;){if(r==e)return!0;r=h(r)}return!1}function h(t){var r=t.parentNode;return 9==t.nodeType&&t!=e?n(t):(r&&r.assignedSlot&&(r=r.assignedSlot.parentNode),r&&11==r.nodeType&&r.host?r.host:r)}function x(e){return e&&9===e.nodeType}}();var useIsomorphicLayoutEffect$1=isBrowser$1?reactExports.useLayoutEffect:reactExports.useEffect;function useLockFn(e){var t=this,r=reactExports.useRef(!1);return reactExports.useCallback(function(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];return __awaiter$1(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:if(r.current)return[2];r.current=!0,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,e.apply(void 0,__spreadArray([],__read(s),!1))];case 2:return[2,t.sent()];case 3:throw t.sent();case 4:return r.current=!1,[7];case 5:return[2]}})})},[e])}function useRafState(e){var t=reactExports.useRef(0),r=__read(reactExports.useState(e),2),s=r[0],n=r[1],i=reactExports.useCallback(function(e){cancelAnimationFrame(t.current),t.current=requestAnimationFrame(function(){n(e)})},[]);return useUnmount(function(){cancelAnimationFrame(t.current)}),[s,i]}var useUnmountedRef=function(){var e=reactExports.useRef(!1);return reactExports.useEffect(function(){return e.current=!1,function(){e.current=!0}},[]),e},useEffectWithTarget=createEffectWithTarget(reactExports.useLayoutEffect),useIsomorphicLayoutEffectWithTarget=isBrowser$1?useEffectWithTarget:useEffectWithTarget$1;function useSize(e){var t=__read(useRafState(function(){var t=getTargetElement(e);return t?{width:t.clientWidth,height:t.clientHeight}:void 0}),2),r=t[0],s=t[1];return useIsomorphicLayoutEffectWithTarget(function(){var t=getTargetElement(e);if(t){var r=new index(function(e){e.forEach(function(e){var t=e.target,r=t.clientWidth,n=t.clientHeight;s({width:r,height:n})})});return r.observe(t),function(){r.disconnect()}}},[],e),r}function useThrottleFn(e,t){var r,s=useLatest(e),n=null!==(r=null==t?void 0:t.wait)&&void 0!==r?r:1e3,i=reactExports.useMemo(function(){return throttle$1(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.current.apply(s,__spreadArray([],__read(e),!1))},n,t)},[]);return useUnmount(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}const MIN_DISTANCE=10;function getDirection(e,t){return e>t&&e>MIN_DISTANCE?"horizontal":t>e&&t>MIN_DISTANCE?"vertical":""}function useTouch(){const e=reactExports.useRef(0),t=reactExports.useRef(0),r=reactExports.useRef(0),s=reactExports.useRef(0),n=reactExports.useRef(0),i=reactExports.useRef(0),o=reactExports.useRef(""),a=()=>{r.current=0,s.current=0,n.current=0,i.current=0,o.current=""};return{move:a=>{const l=a.touches[0];r.current=l.clientX<0?0:l.clientX-e.current,s.current=l.clientY-t.current,n.current=Math.abs(r.current),i.current=Math.abs(s.current),o.current||(o.current=getDirection(n.current,i.current))},start:r=>{a(),e.current=r.touches[0].clientX,t.current=r.touches[0].clientY},reset:a,startX:e,startY:t,deltaX:r,deltaY:s,offsetX:n,offsetY:i,direction:o,isVertical:()=>"vertical"===o.current,isHorizontal:()=>"horizontal"===o.current}}const defaultRoot=canUseDom?window:void 0,overflowStylePatterns=["scroll","auto","overlay"];function isElement$1(e){return 1===e.nodeType}function getScrollParent(e,t=defaultRoot){let r=e;for(;r&&r!==t&&isElement$1(r);){if(r===document.body)return t;const{overflowY:e}=window.getComputedStyle(r);if(overflowStylePatterns.includes(e)&&r.scrollHeight>r.clientHeight)return r;r=r.parentNode}return t}let supportsPassive=!1;if(canUseDom)try{const e={};Object.defineProperty(e,"passive",{get(){supportsPassive=!0}}),window.addEventListener("test-passive",null,e)}catch(e2){}let totalLockCount=0;const BODY_LOCK_CLASS="adm-overflow-hidden";function getScrollableElement(e){let t=null==e?void 0:e.parentElement;for(;t;){if(t.clientHeight<t.scrollHeight)return t;t=t.parentElement}return null}function useLockScroll(e,t){const r=useTouch(),s=s=>{r.move(s);const n=r.deltaY.current>0?"10":"01",i=getScrollParent(s.target,e.current);if(!i)return;if("strict"===t){const e=getScrollableElement(s.target);if(e===document.body||e===document.documentElement)return void s.preventDefault()}const{scrollHeight:o,offsetHeight:a,scrollTop:l}=i,{height:c}=i.getBoundingClientRect();let u="11";0===l?u=a>=o?"00":"01":o<=Math.round(c+l)&&(u="10"),"11"===u||!r.isVertical()||parseInt(u,2)&parseInt(n,2)||s.cancelable&&supportsPassive&&s.preventDefault()};reactExports.useEffect(()=>{if(t)return document.addEventListener("touchstart",r.start),document.addEventListener("touchmove",s,!!supportsPassive&&{passive:!1}),totalLockCount||document.body.classList.add(BODY_LOCK_CLASS),totalLockCount++,()=>{totalLockCount&&(document.removeEventListener("touchstart",r.start),document.removeEventListener("touchmove",s),totalLockCount--,totalLockCount||document.body.classList.remove(BODY_LOCK_CLASS))}},[t])}let updateQueue=makeQueue();const raf=e=>schedule(e,updateQueue);let writeQueue=makeQueue();raf.write=e=>schedule(e,writeQueue);let onStartQueue=makeQueue();raf.onStart=e=>schedule(e,onStartQueue);let onFrameQueue=makeQueue();raf.onFrame=e=>schedule(e,onFrameQueue);let onFinishQueue=makeQueue();raf.onFinish=e=>schedule(e,onFinishQueue);let timeouts=[];raf.setTimeout=(e,t)=>{let r=raf.now()+t,s=()=>{let e=timeouts.findIndex(e=>e.cancel==s);~e&&timeouts.splice(e,1),pendingCount-=~e?1:0},n={time:r,handler:e,cancel:s};return timeouts.splice(findTimeout(r),0,n),pendingCount+=1,start(),n};let findTimeout=e=>~(~timeouts.findIndex(t=>t.time>e)||~timeouts.length);raf.cancel=e=>{onStartQueue.delete(e),onFrameQueue.delete(e),onFinishQueue.delete(e),updateQueue.delete(e),writeQueue.delete(e)},raf.sync=e=>{sync=!0,raf.batchedUpdates(e),sync=!1},raf.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function s(...e){t=e,raf.onStart(r)}return s.handler=e,s.cancel=()=>{onStartQueue.delete(r),t=null},s};let nativeRaf="undefined"!=typeof window?window.requestAnimationFrame:()=>{};raf.use=e=>nativeRaf=e,raf.now="undefined"!=typeof performance?()=>performance.now():Date.now,raf.batchedUpdates=e=>e(),raf.catch=console.error,raf.frameLoop="always",raf.advance=()=>{"demand"!==raf.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):update()};let ts=-1,pendingCount=0,sync=!1;function schedule(e,t){sync?(t.delete(e),e(0)):(t.add(e),start())}function start(){ts<0&&(ts=0,"demand"!==raf.frameLoop&&nativeRaf(loop))}function stop(){ts=-1}function loop(){~ts&&(nativeRaf(loop),raf.batchedUpdates(update))}function update(){let e=ts;ts=raf.now();let t=findTimeout(ts);t&&(eachSafely(timeouts.splice(0,t),e=>e.handler()),pendingCount-=t),pendingCount?(onStartQueue.flush(),updateQueue.flush(e?Math.min(64,ts-e):16.667),onFrameQueue.flush(),writeQueue.flush(),onFinishQueue.flush()):stop()}function makeQueue(){let e=new Set,t=e;return{add(r){pendingCount+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(pendingCount-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,pendingCount-=t.size,eachSafely(t,t=>t(r)&&e.add(t)),pendingCount+=e.size,t=e)}}}function eachSafely(e,t){e.forEach(e=>{try{t(e)}catch(e2){raf.catch(e2)}})}function noop$1(){}const defineHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),is$1={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function isEqual(e,t){if(is$1.arr(e)){if(!is$1.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}const each=(e,t)=>e.forEach(t);function eachProp(e,t,r){if(is$1.arr(e))for(let s=0;s<e.length;s++)t.call(r,e[s],`${s}`);else for(const s in e)e.hasOwnProperty(s)&&t.call(r,e[s],s)}const toArray$2=e=>is$1.und(e)?[]:is$1.arr(e)?e:[e];function flush(e,t){if(e.size){const r=Array.from(e);e.clear(),each(r,t)}}const flushCalls=(e,...t)=>flush(e,e=>e(...t)),isSSR=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let createStringInterpolator$1,to,colors$1=null,skipAnimation=!1,willAdvance=noop$1;const assign=e=>{e.to&&(to=e.to),e.now&&(raf.now=e.now),void 0!==e.colors&&(colors$1=e.colors),null!=e.skipAnimation&&(skipAnimation=e.skipAnimation),e.createStringInterpolator&&(createStringInterpolator$1=e.createStringInterpolator),e.requestAnimationFrame&&raf.use(e.requestAnimationFrame),e.batchedUpdates&&(raf.batchedUpdates=e.batchedUpdates),e.willAdvance&&(willAdvance=e.willAdvance),e.frameLoop&&(raf.frameLoop=e.frameLoop)};var globals=Object.freeze({__proto__:null,get createStringInterpolator(){return createStringInterpolator$1},get to(){return to},get colors(){return colors$1},get skipAnimation(){return skipAnimation},get willAdvance(){return willAdvance},assign:assign});const startQueue=new Set;let currentFrame=[],prevFrame=[],priority=0;const frameLoop={get idle(){return!startQueue.size&&!currentFrame.length},start(e){priority>e.priority?(startQueue.add(e),raf.onStart(flushStartQueue)):(startSafely(e),raf(advance))},advance:advance,sort(e){if(priority)raf.onFrame(()=>frameLoop.sort(e));else{const t=currentFrame.indexOf(e);~t&&(currentFrame.splice(t,1),startUnsafely(e))}},clear(){currentFrame=[],startQueue.clear()}};function flushStartQueue(){startQueue.forEach(startSafely),startQueue.clear(),raf(advance)}function startSafely(e){currentFrame.includes(e)||startUnsafely(e)}function startUnsafely(e){currentFrame.splice(findIndex(currentFrame,t=>t.priority>e.priority),0,e)}function advance(e){const t=prevFrame;for(let r=0;r<currentFrame.length;r++){const s=currentFrame[r];priority=s.priority,s.idle||(willAdvance(s),s.advance(e),s.idle||t.push(s))}return priority=0,prevFrame=currentFrame,prevFrame.length=0,currentFrame=t,currentFrame.length>0}function findIndex(e,t){const r=e.findIndex(t);return r<0?e.length:r}const colors={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},NUMBER="[-+]?\\d*\\.?\\d+",PERCENTAGE=NUMBER+"%";function call$2(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const rgb=new RegExp("rgb"+call$2(NUMBER,NUMBER,NUMBER)),rgba=new RegExp("rgba"+call$2(NUMBER,NUMBER,NUMBER,NUMBER)),hsl=new RegExp("hsl"+call$2(NUMBER,PERCENTAGE,PERCENTAGE)),hsla=new RegExp("hsla"+call$2(NUMBER,PERCENTAGE,PERCENTAGE,NUMBER)),hex3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6=/^#([0-9a-fA-F]{6})$/,hex8=/^#([0-9a-fA-F]{8})$/;function normalizeColor(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=hex6.exec(e))?parseInt(t[1]+"ff",16)>>>0:colors$1&&void 0!==colors$1[e]?colors$1[e]:(t=rgb.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|255)>>>0:(t=rgba.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|parse1(t[4]))>>>0:(t=hex3.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=hex8.exec(e))?parseInt(t[1],16)>>>0:(t=hex4.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=hsl.exec(e))?(255|hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3])))>>>0:(t=hsla.exec(e))?(hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3]))|parse1(t[4]))>>>0:null}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hslToRgb(e,t,r){const s=r<.5?r*(1+t):r+t-r*t,n=2*r-s,i=hue2rgb(n,s,e+1/3),o=hue2rgb(n,s,e),a=hue2rgb(n,s,e-1/3);return Math.round(255*i)<<24|Math.round(255*o)<<16|Math.round(255*a)<<8}function parse255(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function parse360(e){return(parseFloat(e)%360+360)%360/360}function parse1(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function parsePercentage(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function colorToRgba(e){let t=normalizeColor(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const createInterpolator=(e,t,r)=>{if(is$1.fun(e))return e;if(is$1.arr(e))return createInterpolator({range:e,output:t,extrapolate:r});if(is$1.str(e.output[0]))return createStringInterpolator$1(e);const s=e,n=s.output,i=s.range||[0,1],o=s.extrapolateLeft||s.extrapolate||"extend",a=s.extrapolateRight||s.extrapolate||"extend",l=s.easing||(e=>e);return e=>{const t=findRange(e,i);return interpolate(e,i[t],i[t+1],n[t],n[t+1],l,o,a,s.map)}};function interpolate(e,t,r,s,n,i,o,a,l){let c=l?l(e):e;if(c<t){if("identity"===o)return c;"clamp"===o&&(c=t)}if(c>r){if("identity"===a)return c;"clamp"===a&&(c=r)}return s===n?s:t===r?e<=t?s:n:(t===-1/0?c=-c:r===1/0?c-=t:c=(c-t)/(r-t),c=i(c),s===-1/0?c=-c:n===1/0?c+=s:c=c*(n-s)+s,c)}function findRange(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}const easings={linear:e=>e};function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_extends$3.apply(this,arguments)}const $get=Symbol.for("FluidValue.get"),$observers=Symbol.for("FluidValue.observers"),hasFluidValue=e=>Boolean(e&&e[$get]),getFluidValue=e=>e&&e[$get]?e[$get]():e,getFluidObservers=e=>e[$observers]||null;function callFluidObserver(e,t){e.eventObserved?e.eventObserved(t):e(t)}function callFluidObservers(e,t){let r=e[$observers];r&&r.forEach(e=>{callFluidObserver(e,t)})}class FluidValue{constructor(e){if(this[$get]=void 0,this[$observers]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");setFluidGetter(this,e)}}const setFluidGetter=(e,t)=>setHidden(e,$get,t);function addFluidObserver(e,t){if(e[$get]){let r=e[$observers];r||setHidden(e,$observers,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function removeFluidObserver(e,t){let r=e[$observers];if(r&&r.has(t)){const s=r.size-1;s?r.delete(t):e[$observers]=null,e.observerRemoved&&e.observerRemoved(s,t)}}const setHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),numberRegex=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,colorRegex=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,unitRegex=new RegExp(`(${numberRegex.source})(%|[a-z]+)`,"i"),rgbaRegex=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,cssVariableRegex=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,variableToRgba=e=>{const[t,r]=parseCSSVariable(e);if(!t||isSSR())return e;const s=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(s)return s.trim();if(r&&r.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(r);return t||e}return r&&cssVariableRegex.test(r)?variableToRgba(r):r||e},parseCSSVariable=e=>{const t=cssVariableRegex.exec(e);if(!t)return[,];const[,r,s]=t;return[r,s]};let namedColorRegex;const rgbaRound=(e,t,r,s,n)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(s)}, ${n})`,createStringInterpolator=e=>{namedColorRegex||(namedColorRegex=colors$1?new RegExp(`(${Object.keys(colors$1).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(e=>getFluidValue(e).replace(cssVariableRegex,variableToRgba).replace(colorRegex,colorToRgba).replace(namedColorRegex,colorToRgba)),r=t.map(e=>e.match(numberRegex).map(Number)),s=r[0].map((e,t)=>r.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})),n=s.map(t=>createInterpolator(_extends$3({},e,{output:t})));return e=>{var r;const s=!unitRegex.test(t[0])&&(null==(r=t.find(e=>unitRegex.test(e)))?void 0:r.replace(numberRegex,""));let i=0;return t[0].replace(numberRegex,()=>`${n[i++](e)}${s||""}`).replace(rgbaRegex,rgbaRound)}},prefix="react-spring: ",once=e=>{const t=e;let r=!1;if("function"!=typeof t)throw new TypeError(`${prefix}once requires a function parameter`);return(...e)=>{r||(t(...e),r=!0)}},warnInterpolate=once(console.warn);function deprecateInterpolate(){warnInterpolate(`${prefix}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const warnDirectCall=once(console.warn);function deprecateDirectCall(){warnDirectCall(`${prefix}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function isAnimatedString(e){return is$1.str(e)&&("#"==e[0]||/\d/.test(e)||!isSSR()&&cssVariableRegex.test(e)||e in(colors$1||{}))}const useIsomorphicLayoutEffect=isSSR()?reactExports.useEffect:reactExports.useLayoutEffect,useIsMounted=()=>{const e=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function useForceUpdate(){const e=reactExports.useState()[1],t=useIsMounted();return()=>{t.current&&e(Math.random())}}function useMemoOne(e,t){const[r]=reactExports.useState(()=>({inputs:t,result:e()})),s=reactExports.useRef(),n=s.current;let i=n;if(i){Boolean(t&&i.inputs&&areInputsEqual(t,i.inputs))||(i={inputs:t,result:e()})}else i=r;return reactExports.useEffect(()=>{s.current=i,n==r&&(r.inputs=r.result=void 0)},[i]),i.result}function areInputsEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const useOnce=e=>reactExports.useEffect(e,emptyDeps),emptyDeps=[];function usePrev(e){const t=reactExports.useRef();return reactExports.useEffect(()=>{t.current=e}),t.current}const $node=Symbol.for("Animated:node"),isAnimated=e=>!!e&&e[$node]===e,getAnimated=e=>e&&e[$node],setAnimated=(e,t)=>defineHidden(e,$node,t),getPayload=e=>e&&e[$node]&&e[$node].getPayload();class Animated{constructor(){this.payload=void 0,setAnimated(this,this)}getPayload(){return this.payload||[]}}class AnimatedValue extends Animated{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,is$1.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new AnimatedValue(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return is$1.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,is$1.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class AnimatedString extends AnimatedValue{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=createInterpolator({output:[e,e]})}static create(e){return new AnimatedString(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(is$1.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=createInterpolator({output:[this.getValue(),e]})),this._value=0,super.reset()}}const TreeContext={dependencies:null};class AnimatedObject extends Animated{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return eachProp(this.source,(r,s)=>{isAnimated(r)?t[s]=r.getValue(e):hasFluidValue(r)?t[s]=getFluidValue(r):e||(t[s]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&each(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return eachProp(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){TreeContext.dependencies&&hasFluidValue(e)&&TreeContext.dependencies.add(e);const t=getPayload(e);t&&each(t,e=>this.add(e))}}class AnimatedArray extends AnimatedObject{constructor(e){super(e)}static create(e){return new AnimatedArray(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((t,r)=>t.setValue(e[r])).some(Boolean):(super.setValue(e.map(makeAnimated)),!0)}}function makeAnimated(e){return(isAnimatedString(e)?AnimatedString:AnimatedValue).create(e)}function getAnimatedType(e){const t=getAnimated(e);return t?t.constructor:is$1.arr(e)?AnimatedArray:isAnimatedString(e)?AnimatedString:AnimatedValue}function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_extends$2.apply(this,arguments)}const withAnimated=(e,t)=>{const r=!is$1.fun(e)||e.prototype&&e.prototype.isReactComponent;return reactExports.forwardRef((s,n)=>{const i=reactExports.useRef(null),o=r&&reactExports.useCallback(e=>{i.current=updateRef(n,e)},[n]),[a,l]=getAnimatedState(s,t),c=useForceUpdate(),u=()=>{const e=i.current;if(r&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,a.getValue(!0)))&&c()},d=new PropsObserver(u,l),p=reactExports.useRef();useIsomorphicLayoutEffect(()=>(p.current=d,each(l,e=>addFluidObserver(e,d)),()=>{p.current&&(each(p.current.deps,e=>removeFluidObserver(e,p.current)),raf.cancel(p.current.update))})),reactExports.useEffect(u,[]),useOnce(()=>()=>{const e=p.current;each(e.deps,t=>removeFluidObserver(t,e))});const m=t.getComponentProps(a.getValue());return reactExports.createElement(e,_extends$2({},m,{ref:o}))})};class PropsObserver{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&raf.write(this.update)}}function getAnimatedState(e,t){const r=new Set;return TreeContext.dependencies=r,e.style&&(e=_extends$2({},e,{style:t.createAnimatedStyle(e.style)})),e=new AnimatedObject(e),TreeContext.dependencies=null,[e,r]}function updateRef(e,t){return e&&(is$1.fun(e)?e(t):e.current=t),t}const cacheKey=Symbol.for("AnimatedComponent"),createHost=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=e=>new AnimatedObject(e),getComponentProps:s=e=>e}={})=>{const n={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:s},i=e=>{const t=getDisplayName(e)||"Anonymous";return(e=is$1.str(e)?i[e]||(i[e]=withAnimated(e,n)):e[cacheKey]||(e[cacheKey]=withAnimated(e,n))).displayName=`Animated(${t})`,e};return eachProp(e,(t,r)=>{is$1.arr(e)&&(r=getDisplayName(t)),i[r]=i(t)}),{animated:i}},getDisplayName=e=>is$1.str(e)?e:e&&is$1.str(e.displayName)?e.displayName:is$1.fun(e)&&e.name||null;function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_extends$1.apply(this,arguments)}function callProp(e,...t){return is$1.fun(e)?e(...t):e}const matchProp=(e,t)=>!0===e||!!(t&&e&&(is$1.fun(e)?e(t):toArray$2(e).includes(t))),resolveProp=(e,t)=>is$1.obj(e)?t&&e[t]:e,getDefaultProp=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,noopTransform=e=>e,getDefaultProps=(e,t=noopTransform)=>{let r=DEFAULT_PROPS;e.default&&!0!==e.default&&(e=e.default,r=Object.keys(e));const s={};for(const n of r){const r=t(e[n],n);is$1.und(r)||(s[n]=r)}return s},DEFAULT_PROPS=["config","onProps","onStart","onChange","onPause","onResume","onRest"],RESERVED_PROPS={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function getForwardProps(e){const t={};let r=0;if(eachProp(e,(e,s)=>{RESERVED_PROPS[s]||(t[s]=e,r++)}),r)return t}function inferTo(e){const t=getForwardProps(e);if(t){const r={to:t};return eachProp(e,(e,s)=>s in t||(r[s]=e)),r}return _extends$1({},e)}function computeGoal(e){return e=getFluidValue(e),is$1.arr(e)?e.map(computeGoal):isAnimatedString(e)?globals.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function hasProps(e){for(const t in e)return!0;return!1}function isAsyncTo(e){return is$1.fun(e)||is$1.arr(e)&&is$1.obj(e[0])}function detachRefs(e,t){var r;null==(r=e.ref)||r.delete(e),null==t||t.delete(e)}function replaceRef(e,t){var r;t&&e.ref!==t&&(null==(r=e.ref)||r.delete(e),t.add(e),e.ref=t)}const config$1={default:{tension:170,friction:26}},defaults=_extends$1({},config$1.default,{mass:1,damping:1,easing:easings.linear,clamp:!1});class AnimationConfig{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,defaults)}}function mergeConfig(e,t,r){r&&(sanitizeConfig(r=_extends$1({},r),t),t=_extends$1({},r,t)),sanitizeConfig(e,t),Object.assign(e,t);for(const o in defaults)null==e[o]&&(e[o]=defaults[o]);let{mass:s,frequency:n,damping:i}=e;return is$1.und(n)||(n<.01&&(n=.01),i<0&&(i=0),e.tension=Math.pow(2*Math.PI/n,2)*s,e.friction=4*Math.PI*i*s/n),e}function sanitizeConfig(e,t){if(is$1.und(t.decay)){const r=!is$1.und(t.tension)||!is$1.und(t.friction);!r&&is$1.und(t.frequency)&&is$1.und(t.damping)&&is$1.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}const emptyArray=[];class Animation{constructor(){this.changed=!1,this.values=emptyArray,this.toValues=null,this.fromValues=emptyArray,this.to=void 0,this.from=void 0,this.config=new AnimationConfig,this.immediate=!1}}function scheduleProps(e,{key:t,props:r,defaultProps:s,state:n,actions:i}){return new Promise((o,a)=>{var l;let c,u,d=matchProp(null!=(l=r.cancel)?l:null==s?void 0:s.cancel,t);if(d)h();else{is$1.und(r.pause)||(n.paused=matchProp(r.pause,t));let e=null==s?void 0:s.pause;!0!==e&&(e=n.paused||matchProp(e,t)),c=callProp(r.delay||0,t),e?(n.resumeQueue.add(m),i.pause()):(i.resume(),m())}function p(){n.resumeQueue.add(m),n.timeouts.delete(u),u.cancel(),c=u.time-raf.now()}function m(){c>0&&!globals.skipAnimation?(n.delayed=!0,u=raf.setTimeout(h,c),n.pauseQueue.add(p),n.timeouts.add(u)):h()}function h(){n.delayed&&(n.delayed=!1),n.pauseQueue.delete(p),n.timeouts.delete(u),e<=(n.cancelId||0)&&(d=!0);try{i.start(_extends$1({},r,{callId:e,cancel:d}),o)}catch(t){a(t)}}})}const getCombinedResult=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?getCancelledResult(e.get()):t.every(e=>e.noop)?getNoopResult(e.get()):getFinishedResult(e.get(),t.every(e=>e.finished)),getNoopResult=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),getFinishedResult=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),getCancelledResult=e=>({value:e,cancelled:!0,finished:!1});function runAsync(e,t,r,s){const{callId:n,parentId:i,onRest:o}=t,{asyncTo:a,promise:l}=r;return i||e!==a||t.reset?r.promise=(async()=>{r.asyncId=n,r.asyncTo=e;const c=getDefaultProps(t,(e,t)=>"onRest"===t?void 0:e);let u,d;const p=new Promise((e,t)=>(u=e,d=t)),m=e=>{const t=n<=(r.cancelId||0)&&getCancelledResult(s)||n!==r.asyncId&&getFinishedResult(s,!1);if(t)throw e.result=t,d(e),e},h=(e,t)=>{const i=new BailSignal,o=new SkipAnimationSignal;return(async()=>{if(globals.skipAnimation)throw stopAsync(r),o.result=getFinishedResult(s,!1),d(o),o;m(i);const a=is$1.obj(e)?_extends$1({},e):_extends$1({},t,{to:e});a.parentId=n,eachProp(c,(e,t)=>{is$1.und(a[t])&&(a[t]=e)});const l=await s.start(a);return m(i),r.paused&&await new Promise(e=>{r.resumeQueue.add(e)}),l})()};let x;if(globals.skipAnimation)return stopAsync(r),getFinishedResult(s,!1);try{let t;t=is$1.arr(e)?(async e=>{for(const t of e)await h(t)})(e):Promise.resolve(e(h,s.stop.bind(s))),await Promise.all([t.then(u),p]),x=getFinishedResult(s.get(),!0,!1)}catch(f){if(f instanceof BailSignal)x=f.result;else{if(!(f instanceof SkipAnimationSignal))throw f;x=f.result}}finally{n==r.asyncId&&(r.asyncId=i,r.asyncTo=i?a:void 0,r.promise=i?l:void 0)}return is$1.fun(o)&&raf.batchedUpdates(()=>{o(x,s,s.item)}),x})():l}function stopAsync(e,t){flush(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class BailSignal extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class SkipAnimationSignal extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const isFrameValue=e=>e instanceof FrameValue;let nextId$1=1;class FrameValue extends FluidValue{constructor(...e){super(...e),this.id=nextId$1++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=getAnimated(this);return e&&e.getValue()}to(...e){return globals.to(this,e)}interpolate(...e){return deprecateInterpolate(),globals.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){callFluidObservers(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||frameLoop.sort(this),callFluidObservers(this,{type:"priority",parent:this,priority:e})}}const $P=Symbol.for("SpringPhase"),HAS_ANIMATED=1,IS_ANIMATING=2,IS_PAUSED=4,hasAnimated=e=>(e[$P]&HAS_ANIMATED)>0,isAnimating=e=>(e[$P]&IS_ANIMATING)>0,isPaused=e=>(e[$P]&IS_PAUSED)>0,setActiveBit=(e,t)=>t?e[$P]|=IS_ANIMATING|HAS_ANIMATED:e[$P]&=~IS_ANIMATING,setPausedBit=(e,t)=>t?e[$P]|=IS_PAUSED:e[$P]&=~IS_PAUSED;class SpringValue extends FrameValue{constructor(e,t){if(super(),this.key=void 0,this.animation=new Animation,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!is$1.und(e)||!is$1.und(t)){const r=is$1.obj(e)?_extends$1({},e):_extends$1({},t,{from:e});is$1.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(isAnimating(this)||this._state.asyncTo)||isPaused(this)}get goal(){return getFluidValue(this.animation.to)}get velocity(){const e=getAnimated(this);return e instanceof AnimatedValue?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return hasAnimated(this)}get isAnimating(){return isAnimating(this)}get isPaused(){return isPaused(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const s=this.animation;let{config:n,toValues:i}=s;const o=getPayload(s.to);!o&&hasFluidValue(s.to)&&(i=toArray$2(getFluidValue(s.to))),s.values.forEach((a,l)=>{if(a.done)return;const c=a.constructor==AnimatedString?1:o?o[l].lastPosition:i[l];let u=s.immediate,d=c;if(!u){if(d=a.lastPosition,n.tension<=0)return void(a.done=!0);let t=a.elapsedTime+=e;const r=s.fromValues[l],i=null!=a.v0?a.v0:a.v0=is$1.arr(n.velocity)?n.velocity[l]:n.velocity;let o;const p=n.precision||(r==c?.005:Math.min(1,.001*Math.abs(c-r)));if(is$1.und(n.duration))if(n.decay){const e=!0===n.decay?.998:n.decay,s=Math.exp(-(1-e)*t);d=r+i/(1-e)*(1-s),u=Math.abs(a.lastPosition-d)<=p,o=i*s}else{o=null==a.lastVelocity?i:a.lastVelocity;const t=n.restVelocity||p/10,s=n.clamp?0:n.bounce,l=!is$1.und(s),m=r==c?a.v0>0:r<c;let h,x=!1;const f=1,g=Math.ceil(e/f);for(let e=0;e<g&&(h=Math.abs(o)>t,h||(u=Math.abs(c-d)<=p,!u));++e){l&&(x=d==c||d>c==m,x&&(o=-o*s,d=c));o+=(1e-6*-n.tension*(d-c)+.001*-n.friction*o)/n.mass*f,d+=o*f}}else{let s=1;n.duration>0&&(this._memoizedDuration!==n.duration&&(this._memoizedDuration=n.duration,a.durationProgress>0&&(a.elapsedTime=n.duration*a.durationProgress,t=a.elapsedTime+=e)),s=(n.progress||0)+t/this._memoizedDuration,s=s>1?1:s<0?0:s,a.durationProgress=s),d=r+n.easing(s)*(c-r),o=(d-a.lastPosition)/e,u=1==s}a.lastVelocity=o,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),u=!0)}o&&!o[l].done&&(u=!1),u?a.done=!0:t=!1,a.setValue(d,n.round)&&(r=!0)});const a=getAnimated(this),l=a.getValue();if(t){const e=getFluidValue(s.to);l===e&&!r||n.decay?r&&n.decay&&this._onChange(l):(a.setValue(e),this._onChange(e)),this._stop()}else r&&this._onChange(l)}set(e){return raf.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(isAnimating(this)){const{to:e,config:t}=this.animation;raf.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return is$1.und(e)?(r=this.queue||[],this.queue=[]):r=[is$1.obj(e)?e:_extends$1({},t,{to:e})],Promise.all(r.map(e=>this._update(e))).then(e=>getCombinedResult(this,e))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),stopAsync(this._state,e&&this._lastCallId),raf.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:s}=e;r=is$1.obj(r)?r[t]:r,(null==r||isAsyncTo(r))&&(r=void 0),s=is$1.obj(s)?s[t]:s,null==s&&(s=void 0);const n={to:r,from:s};return hasAnimated(this)||(e.reverse&&([r,s]=[s,r]),s=getFluidValue(s),is$1.und(s)?getAnimated(this)||this._set(r):this._set(s)),n}_update(e,t){let r=_extends$1({},e);const{key:s,defaultProps:n}=this;r.default&&Object.assign(n,getDefaultProps(r,(e,t)=>/^on/.test(t)?resolveProp(e,s):e)),mergeActiveFn(this,r,"onProps"),sendEvent(this,"onProps",r,this);const i=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const o=this._state;return scheduleProps(++this._lastCallId,{key:s,props:r,defaultProps:n,state:o,actions:{pause:()=>{isPaused(this)||(setPausedBit(this,!0),flushCalls(o.pauseQueue),sendEvent(this,"onPause",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},resume:()=>{isPaused(this)&&(setPausedBit(this,!1),isAnimating(this)&&this._resume(),flushCalls(o.resumeQueue),sendEvent(this,"onResume",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(e=>{if(r.loop&&e.finished&&(!t||!e.noop)){const e=createLoopUpdate(r);if(e)return this._update(e,!0)}return e})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(getCancelledResult(this));const s=!is$1.und(e.to),n=!is$1.und(e.from);if(s||n){if(!(t.callId>this._lastToId))return r(getCancelledResult(this));this._lastToId=t.callId}const{key:i,defaultProps:o,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:d=c}=e;!n||s||t.default&&!is$1.und(u)||(u=d),t.reverse&&([u,d]=[d,u]);const p=!isEqual(d,c);p&&(a.from=d),d=getFluidValue(d);const m=!isEqual(u,l);m&&this._focus(u);const h=isAsyncTo(t.to),{config:x}=a,{decay:f,velocity:g}=x;(s||n)&&(x.velocity=0),t.config&&!h&&mergeConfig(x,callProp(t.config,i),t.config!==o.config?callProp(o.config,i):void 0);let y=getAnimated(this);if(!y||is$1.und(u))return r(getFinishedResult(this,!0));const v=is$1.und(t.reset)?n&&!t.default:!is$1.und(d)&&matchProp(t.reset,i),E=v?d:this.get(),j=computeGoal(u),b=is$1.num(j)||is$1.arr(j)||isAnimatedString(j),w=!h&&(!b||matchProp(o.immediate||t.immediate,i));if(m){const e=getAnimatedType(u);if(e!==y.constructor){if(!w)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(j)}}const R=y.constructor;let _=hasFluidValue(u),S=!1;if(!_){const e=v||!hasAnimated(this)&&p;(m||e)&&(S=isEqual(computeGoal(E),j),_=!S),(isEqual(a.immediate,w)||w)&&isEqual(x.decay,f)&&isEqual(x.velocity,g)||(_=!0)}if(S&&isAnimating(this)&&(a.changed&&!v?_=!0:_||this._stop(l)),!h&&((_||hasFluidValue(l))&&(a.values=y.getPayload(),a.toValues=hasFluidValue(u)?null:R==AnimatedString?[1]:toArray$2(j)),a.immediate!=w&&(a.immediate=w,w||v||this._set(l)),_)){const{onRest:e}=a;each(ACTIVE_EVENTS,e=>mergeActiveFn(this,t,e));const s=getFinishedResult(this,checkFinished(this,l));flushCalls(this._pendingCalls,s),this._pendingCalls.add(r),a.changed&&raf.batchedUpdates(()=>{a.changed=!v,null==e||e(s,this),v?callProp(o.onRest,s):null==a.onStart||a.onStart(s,this)})}v&&this._set(E),h?r(runAsync(t.to,t,this._state,this)):_?this._start():isAnimating(this)&&!m?this._pendingCalls.add(r):r(getNoopResult(E))}_focus(e){const t=this.animation;e!==t.to&&(getFluidObservers(this)&&this._detach(),t.to=e,getFluidObservers(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;hasFluidValue(t)&&(addFluidObserver(t,this),isFrameValue(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;hasFluidValue(e)&&removeFluidObserver(e,this)}_set(e,t=!0){const r=getFluidValue(e);if(!is$1.und(r)){const e=getAnimated(this);if(!e||!isEqual(r,e.getValue())){const s=getAnimatedType(r);e&&e.constructor==s?e.setValue(r):setAnimated(this,s.create(r)),e&&raf.batchedUpdates(()=>{this._onChange(r,t)})}}return getAnimated(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,sendEvent(this,"onStart",getFinishedResult(this,checkFinished(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),callProp(this.animation.onChange,e,this)),callProp(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;getAnimated(this).reset(getFluidValue(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),isAnimating(this)||(setActiveBit(this,!0),isPaused(this)||this._resume())}_resume(){globals.skipAnimation?this.finish():frameLoop.start(this)}_stop(e,t){if(isAnimating(this)){setActiveBit(this,!1);const r=this.animation;each(r.values,e=>{e.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),callFluidObservers(this,{type:"idle",parent:this});const s=t?getCancelledResult(this.get()):getFinishedResult(this.get(),checkFinished(this,null!=e?e:r.to));flushCalls(this._pendingCalls,s),r.changed&&(r.changed=!1,sendEvent(this,"onRest",s,this))}}}function checkFinished(e,t){const r=computeGoal(t);return isEqual(computeGoal(e.get()),r)}function createLoopUpdate(e,t=e.loop,r=e.to){let s=callProp(t);if(s){const n=!0!==s&&inferTo(s),i=(n||e).reverse,o=!n||n.reset;return createUpdate(_extends$1({},e,{loop:t,default:!1,pause:void 0,to:!i||isAsyncTo(r)?r:void 0,from:o?e.from:void 0,reset:o},n))}}function createUpdate(e){const{to:t,from:r}=e=inferTo(e),s=new Set;return is$1.obj(t)&&findDefined(t,s),is$1.obj(r)&&findDefined(r,s),e.keys=s.size?Array.from(s):null,e}function declareUpdate(e){const t=createUpdate(e);return is$1.und(t.default)&&(t.default=getDefaultProps(t)),t}function findDefined(e,t){eachProp(e,(e,r)=>null!=e&&t.add(r))}const ACTIVE_EVENTS=["onStart","onRest","onChange","onPause","onResume"];function mergeActiveFn(e,t,r){e.animation[r]=t[r]!==getDefaultProp(t,r)?resolveProp(t[r],e.key):void 0}function sendEvent(e,t,...r){var s,n,i,o;null==(s=(n=e.animation)[t])||s.call(n,...r),null==(i=(o=e.defaultProps)[t])||i.call(o,...r)}const BATCHED_EVENTS=["onStart","onChange","onRest"];let nextId=1,Controller$1=class{constructor(e,t){this.id=nextId++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(_extends$1({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(const t in e){const r=e[t];is$1.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(createUpdate(e)),this}start(e){let{queue:t}=this;return e?t=toArray$2(e).map(createUpdate):this.queue=[],this._flush?this._flush(this,t):(prepareKeys(this,t),flushUpdateQueue(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const r=this.springs;each(toArray$2(t),t=>r[t].stop(!!e))}else stopAsync(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(is$1.und(e))this.start({pause:!0});else{const t=this.springs;each(toArray$2(e),e=>t[e].pause())}return this}resume(e){if(is$1.und(e))this.start({pause:!1});else{const t=this.springs;each(toArray$2(e),e=>t[e].resume())}return this}each(e){eachProp(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:r}=this._events,s=this._active.size>0,n=this._changed.size>0;(s&&!this._started||n&&!this._started)&&(this._started=!0,flush(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));const i=!s&&this._started,o=n||i&&r.size?this.get():null;n&&t.size&&flush(t,([e,t])=>{t.value=o,e(t,this,this._item)}),i&&(this._started=!1,flush(r,([e,t])=>{t.value=o,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}raf.onFrame(this._onFrame)}};function flushUpdateQueue(e,t){return Promise.all(t.map(t=>flushUpdate(e,t))).then(t=>getCombinedResult(e,t))}async function flushUpdate(e,t,r){const{keys:s,to:n,from:i,loop:o,onRest:a,onResolve:l}=t,c=is$1.obj(t.default)&&t.default;o&&(t.loop=!1),!1===n&&(t.to=null),!1===i&&(t.from=null);const u=is$1.arr(n)||is$1.fun(n)?n:void 0;u?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):each(BATCHED_EVENTS,r=>{const s=t[r];if(is$1.fun(s)){const n=e._events[r];t[r]=({finished:e,cancelled:t})=>{const r=n.get(s);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(s,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[r]=t[r])}});const d=e._state;t.pause===!d.paused?(d.paused=t.pause,flushCalls(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const p=(s||Object.keys(e.springs)).map(r=>e.springs[r].start(t)),m=!0===t.cancel||!0===getDefaultProp(t,"cancel");(u||m&&d.asyncId)&&p.push(scheduleProps(++e._lastAsyncId,{props:t,state:d,actions:{pause:noop$1,resume:noop$1,start(t,r){m?(stopAsync(d,e._lastAsyncId),r(getCancelledResult(e))):(t.onRest=a,r(runAsync(u,t,d,e)))}}})),d.paused&&await new Promise(e=>{d.resumeQueue.add(e)});const h=getCombinedResult(e,await Promise.all(p));if(o&&h.finished&&(!r||!h.noop)){const r=createLoopUpdate(t,o,n);if(r)return prepareKeys(e,[r]),flushUpdate(e,r,!0)}return l&&raf.batchedUpdates(()=>l(h,e,e.item)),h}function getSprings(e,t){const r=_extends$1({},e.springs);return t&&each(toArray$2(t),e=>{is$1.und(e.keys)&&(e=createUpdate(e)),is$1.obj(e.to)||(e=_extends$1({},e,{to:void 0})),prepareSprings(r,e,e=>createSpring(e))}),setSprings(e,r),r}function setSprings(e,t){eachProp(t,(t,r)=>{e.springs[r]||(e.springs[r]=t,addFluidObserver(t,e))})}function createSpring(e,t){const r=new SpringValue;return r.key=e,t&&addFluidObserver(r,t),r}function prepareSprings(e,t,r){t.keys&&each(t.keys,s=>{(e[s]||(e[s]=r(s)))._prepareNode(t)})}function prepareKeys(e,t){each(t,t=>{prepareSprings(e.springs,t,t=>createSpring(t,e))})}function _objectWithoutPropertiesLoose$2(e,t){if(null==e)return{};var r,s,n={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}const _excluded$6=["children"],SpringContext=e=>{let{children:t}=e,r=_objectWithoutPropertiesLoose$2(e,_excluded$6);const s=reactExports.useContext(ctx),n=r.pause||!!s.pause,i=r.immediate||!!s.immediate;r=useMemoOne(()=>({pause:n,immediate:i}),[n,i]);const{Provider:o}=ctx;return reactExports.createElement(o,{value:r},t)},ctx=makeContext(SpringContext,{});function makeContext(e,t){return Object.assign(e,reactExports.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}SpringContext.Provider=ctx.Provider,SpringContext.Consumer=ctx.Consumer;const SpringRef=()=>{const e=[],t=function(t){deprecateDirectCall();const s=[];return each(e,(e,n)=>{if(is$1.und(t))s.push(e.start());else{const i=r(t,e,n);i&&s.push(e.start(i))}}),s};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return each(e,e=>e.pause(...arguments)),this},t.resume=function(){return each(e,e=>e.resume(...arguments)),this},t.set=function(t){each(e,e=>e.set(t))},t.start=function(t){const r=[];return each(e,(e,s)=>{if(is$1.und(t))r.push(e.start());else{const n=this._getProps(t,e,s);n&&r.push(e.start(n))}}),r},t.stop=function(){return each(e,e=>e.stop(...arguments)),this},t.update=function(t){return each(e,(e,r)=>e.update(this._getProps(t,e,r))),this};const r=function(e,t,r){return is$1.fun(e)?e(r,t):e};return t._getProps=r,t};function useSprings(e,t,r){const s=is$1.fun(t)&&t;s&&!r&&(r=[]);const n=reactExports.useMemo(()=>s||3==arguments.length?SpringRef():void 0,[]),i=reactExports.useRef(0),o=useForceUpdate(),a=reactExports.useMemo(()=>({ctrls:[],queue:[],flush(e,t){const r=getSprings(e,t);return i.current>0&&!a.queue.length&&!Object.keys(r).some(t=>!e.springs[t])?flushUpdateQueue(e,t):new Promise(s=>{setSprings(e,r),a.queue.push(()=>{s(flushUpdateQueue(e,t))}),o()})}}),[]),l=reactExports.useRef([...a.ctrls]),c=[],u=usePrev(e)||0;function d(e,r){for(let n=e;n<r;n++){const e=l.current[n]||(l.current[n]=new Controller$1(null,a.flush)),r=s?s(n,e):t[n];r&&(c[n]=declareUpdate(r))}}reactExports.useMemo(()=>{each(l.current.slice(e,u),e=>{detachRefs(e,n),e.stop(!0)}),l.current.length=e,d(u,e)},[e]),reactExports.useMemo(()=>{d(0,Math.min(u,e))},r);const p=l.current.map((e,t)=>getSprings(e,c[t])),m=reactExports.useContext(SpringContext),h=usePrev(m),x=m!==h&&hasProps(m);useIsomorphicLayoutEffect(()=>{i.current++,a.ctrls=l.current;const{queue:e}=a;e.length&&(a.queue=[],each(e,e=>e())),each(l.current,(e,t)=>{null==n||n.add(e),x&&e.start({default:m});const r=c[t];r&&(replaceRef(e,r.ref),e.ref?e.queue.push(r):e.start(r))})}),useOnce(()=>()=>{each(a.ctrls,e=>e.stop(!0))});const f=p.map(e=>_extends$1({},e));return n?[f,n]:f}function useSpring(e,t){const r=is$1.fun(e),[[s],n]=useSprings(1,r?e:[e],r?[]:t);return r||2==arguments.length?[s,n]:s}let TransitionPhase;var TransitionPhase2;TransitionPhase2=TransitionPhase||(TransitionPhase={}),TransitionPhase2.MOUNT="mount",TransitionPhase2.ENTER="enter",TransitionPhase2.UPDATE="update",TransitionPhase2.LEAVE="leave";class Interpolation extends FrameValue{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=createInterpolator(...t);const r=this._get(),s=getAnimatedType(r);setAnimated(this,s.create(r))}advance(e){const t=this._get();isEqual(t,this.get())||(getAnimated(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&checkIdle(this._active)&&becomeIdle(this)}_get(){const e=is$1.arr(this.source)?this.source.map(getFluidValue):toArray$2(getFluidValue(this.source));return this.calc(...e)}_start(){this.idle&&!checkIdle(this._active)&&(this.idle=!1,each(getPayload(this),e=>{e.done=!1}),globals.skipAnimation?(raf.batchedUpdates(()=>this.advance()),becomeIdle(this)):frameLoop.start(this))}_attach(){let e=1;each(toArray$2(this.source),t=>{hasFluidValue(t)&&addFluidObserver(t,this),isFrameValue(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){each(toArray$2(this.source),e=>{hasFluidValue(e)&&removeFluidObserver(e,this)}),this._active.clear(),becomeIdle(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=toArray$2(this.source).reduce((e,t)=>Math.max(e,(isFrameValue(t)?t.priority:0)+1),0))}}function isIdle(e){return!1!==e.idle}function checkIdle(e){return!e.size||Array.from(e).every(isIdle)}function becomeIdle(e){e.idle||(e.idle=!0,each(getPayload(e),e=>{e.done=!0}),callFluidObservers(e,{type:"idle",parent:e}))}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var r,s,n={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}globals.assign({createStringInterpolator:createStringInterpolator,to:(e,t)=>new Interpolation(e,t)});const _excluded$2$1=["style","children","scrollTop","scrollLeft","viewBox"],isCustomPropRE=/^--/;function dangerousStyleValue(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||isCustomPropRE.test(e)||isUnitlessNumber.hasOwnProperty(e)&&isUnitlessNumber[e]?(""+t).trim():t+"px"}const attributeCache={};function applyAnimatedValues(e,t){if(!e.nodeType||!e.setAttribute)return!1;const r="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,s=t,{style:n,children:i,scrollTop:o,scrollLeft:a,viewBox:l}=s,c=_objectWithoutPropertiesLoose$1(s,_excluded$2$1),u=Object.values(c),d=Object.keys(c).map(t=>r||e.hasAttribute(t)?t:attributeCache[t]||(attributeCache[t]=t.replace(/([A-Z])/g,e=>"-"+e.toLowerCase())));void 0!==i&&(e.textContent=i);for(let p in n)if(n.hasOwnProperty(p)){const t=dangerousStyleValue(p,n[p]);isCustomPropRE.test(p)?e.style.setProperty(p,t):e.style[p]=t}d.forEach((t,r)=>{e.setAttribute(t,u[r])}),void 0!==o&&(e.scrollTop=o),void 0!==a&&(e.scrollLeft=a),void 0!==l&&e.setAttribute("viewBox",l)}let isUnitlessNumber={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const prefixKey=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),prefixes=["Webkit","Ms","Moz","O"];isUnitlessNumber=Object.keys(isUnitlessNumber).reduce((e,t)=>(prefixes.forEach(r=>e[prefixKey(r,t)]=e[t]),e),isUnitlessNumber);const _excluded$1$1=["x","y","z"],domTransforms=/^(matrix|translate|scale|rotate|skew)/,pxTransforms=/^(translate)/,degTransforms=/^(rotate|skew)/,addUnit=(e,t)=>is$1.num(e)&&0!==e?e+t:e,isValueIdentity=(e,t)=>is$1.arr(e)?e.every(e=>isValueIdentity(e,t)):is$1.num(e)?e===t:parseFloat(e)===t;class AnimatedStyle extends AnimatedObject{constructor(e){let{x:t,y:r,z:s}=e,n=_objectWithoutPropertiesLoose$1(e,_excluded$1$1);const i=[],o=[];(t||r||s)&&(i.push([t||0,r||0,s||0]),o.push(e=>[`translate3d(${e.map(e=>addUnit(e,"px")).join(",")})`,isValueIdentity(e,0)])),eachProp(n,(e,t)=>{if("transform"===t)i.push([e||""]),o.push(e=>[e,""===e]);else if(domTransforms.test(t)){if(delete n[t],is$1.und(e))return;const r=pxTransforms.test(t)?"px":degTransforms.test(t)?"deg":"";i.push(toArray$2(e)),o.push("rotate3d"===t?([e,t,s,n])=>[`rotate3d(${e},${t},${s},${addUnit(n,r)})`,isValueIdentity(n,0)]:e=>[`${t}(${e.map(e=>addUnit(e,r)).join(",")})`,isValueIdentity(e,t.startsWith("scale")?1:0)])}}),i.length&&(n.transform=new FluidTransform(i,o)),super(n)}}class FluidTransform extends FluidValue{constructor(e,t){super(),this._value=null,this.inputs=e,this.transforms=t}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return each(this.inputs,(r,s)=>{const n=getFluidValue(r[0]),[i,o]=this.transforms[s](is$1.arr(n)?n:r.map(getFluidValue));e+=" "+i,t=t&&o}),t?"none":e}observerAdded(e){1==e&&each(this.inputs,e=>each(e,e=>hasFluidValue(e)&&addFluidObserver(e,this)))}observerRemoved(e){0==e&&each(this.inputs,e=>each(e,e=>hasFluidValue(e)&&removeFluidObserver(e,this)))}eventObserved(e){"change"==e.type&&(this._value=null),callFluidObservers(this,e)}}const primitives=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],_excluded$4=["scrollTop","scrollLeft"];globals.assign({batchedUpdates:reactDomExports.unstable_batchedUpdates,createStringInterpolator:createStringInterpolator,colors:colors});const host=createHost(primitives,{applyAnimatedValues:applyAnimatedValues,createAnimatedStyle:e=>new AnimatedStyle(e),getComponentProps:e=>_objectWithoutPropertiesLoose$1(e,_excluded$4)}),animated=host.animated;function resolveContainer(e){return("function"==typeof e?e():e)||document.body}function renderToContainer(e,t){if(canUseDom&&e){const r=resolveContainer(e);return reactDomExports.createPortal(t,r)}return t}function useInitialized(e){const t=reactExports.useRef(e);return e&&(t.current=!0),!!t.current}const ShouldRender=e=>useShouldRender(e.active,e.forceRender,e.destroyOnClose)?e.children:null;function useShouldRender(e,t,r){const s=useInitialized(e);return!!t||(!!e||!!s&&!r)}const eventToPropRecord={click:"onClick",touchstart:"onTouchStart"};function withStopPropagation(e,t){const r=Object.assign({},t.props);for(const s of e){const e=eventToPropRecord[s];r[e]=function(r){var s,n;r.stopPropagation(),null===(n=(s=t.props)[e])||void 0===n||n.call(s,r)}}return React$2.cloneElement(t,r)}const classPrefix$H="adm-mask",opacityRecord={default:.55,thin:.35,thick:.75},colorRecord$3={black:"0, 0, 0",white:"255, 255, 255"},defaultProps$z={visible:!0,destroyOnClose:!1,forceRender:!1,color:"black",opacity:"default",disableBodyScroll:!0,getContainer:null,stopPropagation:["click"]},Mask=e=>{const t=mergeProps(defaultProps$z,e),{locale:r}=useConfig(),s=reactExports.useRef(null);useLockScroll(s,t.visible&&t.disableBodyScroll);const n=reactExports.useMemo(()=>{var e;const r=null!==(e=opacityRecord[t.opacity])&&void 0!==e?e:t.opacity,s=colorRecord$3[t.color];return s?`rgba(${s}, ${r})`:t.color},[t.color,t.opacity]),[i,o]=reactExports.useState(t.visible),a=useUnmountedRef(),{opacity:l}=useSpring({opacity:t.visible?1:0,config:{precision:.01,mass:1,tension:250,friction:30,clamp:!0},onStart:()=>{o(!0)},onRest:()=>{var e,r;a.current||(o(t.visible),t.visible?null===(e=t.afterShow)||void 0===e||e.call(t):null===(r=t.afterClose)||void 0===r||r.call(t))}}),c=withStopPropagation(t.stopPropagation,withNativeProps(t,React$2.createElement(animated.div,{className:classPrefix$H,ref:s,"aria-hidden":!0,style:Object.assign(Object.assign({},t.style),{background:n,opacity:l,display:i?void 0:"none"}),onClick:e=>{var r;e.target===e.currentTarget&&(null===(r=t.onMaskClick)||void 0===r||r.call(t,e))}},t.onMaskClick&&React$2.createElement("div",{className:`${classPrefix$H}-aria-button`,role:"button","aria-label":r.Mask.name,onClick:t.onMaskClick}),React$2.createElement("div",{className:`${classPrefix$H}-content`},t.children))));return React$2.createElement(ShouldRender,{active:i,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose},renderToContainer(t.getContainer,c))};function AddOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"AddOutline-AddOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"AddOutline-add"},reactExports.createElement("rect",{id:"AddOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z",id:"AddOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function CheckOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"CheckOutline-CheckOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"CheckOutline-编组"},reactExports.createElement("rect",{id:"CheckOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M44.309608,12.6841286 L21.2180499,35.5661955 L21.2180499,35.5661955 C20.6343343,36.1446015 19.6879443,36.1446015 19.1042286,35.5661955 C19.0538201,35.5162456 19.0077648,35.4636155 18.9660627,35.4087682 C18.9113105,35.368106 18.8584669,35.3226694 18.808302,35.2729607 L3.6903839,20.2920499 C3.53346476,20.1365529 3.53231192,19.8832895 3.68780898,19.7263704 C3.7629255,19.6505669 3.86521855,19.6079227 3.97193622,19.6079227 L7.06238923,19.6079227 C7.16784214,19.6079227 7.26902895,19.6495648 7.34393561,19.7237896 L20.160443,32.4236157 L20.160443,32.4236157 L40.656066,12.115858 C40.7309719,12.0416387 40.8321549,12 40.9376034,12 L44.0280571,12 C44.248971,12 44.4280571,12.1790861 44.4280571,12.4 C44.4280571,12.5067183 44.3854124,12.609012 44.309608,12.6841286 Z",id:"CheckOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function ClockCircleOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"ClockCircleOutline-ClockCircleOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"ClockCircleOutline-编组"},reactExports.createElement("rect",{id:"ClockCircleOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M24,5 C13.5065898,5 5,13.5065898 5,24 C5,34.4934102 13.5065898,43 24,43 C34.4934102,43 43,34.4934102 43,24 C43,13.5065898 34.4934102,5 24,5 Z M24.6,14 C24.8209139,14 25,14.1790861 25,14.4 L25,23.1715729 C25,23.2776595 25.0337142,23.38027 25.0952092,23.4650801 L25.1464466,23.5251263 L33.2778175,31.6564971 C33.4340272,31.8127068 33.4340272,32.0659728 33.2778175,32.2221825 L31.7221825,33.7778175 C31.5659728,33.9340272 31.3127068,33.9340272 31.1564971,33.7778175 L23.0251263,25.6464466 C22.4192395,25.0405598 22.0584325,24.2354066 22.0065089,23.3850222 L22,23.1715729 L22,14.4 C22,14.1790861 22.1790861,14 22.4,14 L24.6,14 Z",id:"ClockCircleOutline-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}function CloseCircleFill(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"CloseCircleFill-CloseCircleFill",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"CloseCircleFill-编组"},reactExports.createElement("rect",{id:"CloseCircleFill-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M18.6753876,16 L15.5637812,16 C15.4576916,16 15.3559474,16.0421451 15.2809323,16.1171635 C15.124726,16.2733766 15.1247316,16.5266426 15.2809447,16.6828489 L15.2809447,16.6828489 L22.299066,23.7006641 L14.6828159,31.3171619 C14.6078042,31.3921761 14.5656632,31.4939157 14.5656632,31.6 C14.5656632,31.8209139 14.7447493,32 14.9656632,32 L14.9656632,32 L18.0753284,32 C18.1814068,32 18.2831412,31.9578638 18.3581544,31.8828594 L18.3581544,31.8828594 L24.420066,25.8216641 L30.4818451,31.8828564 C30.5568585,31.9578626 30.6585942,32 30.7646741,32 L30.7646741,32 L33.8763476,32 C33.9824309,32 34.0841695,31.9578599 34.1591835,31.8828496 C34.315397,31.7266436 34.3154031,31.4733776 34.1591972,31.3171641 L34.1591972,31.3171641 L26.542066,23.6996641 L33.5591874,16.6828489 C33.6342057,16.6078338 33.6763508,16.5060896 33.6763508,16.4 C33.6763508,16.1790861 33.4972647,16 33.2763508,16 L33.2763508,16 L30.1637654,16 C30.0576705,16 29.9559218,16.0421493 29.8809058,16.1171741 L29.8809058,16.1171741 L24.420066,21.5786641 L18.9582218,16.1171488 C18.883208,16.0421394 18.7814701,16 18.6753876,16 L18.6753876,16 Z",id:"CloseCircleFill-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}function CloseOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"CloseOutline-CloseOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"CloseOutline-编组"},reactExports.createElement("rect",{id:"CloseOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M10.6085104,8.11754663 L24.1768397,21.8195031 L24.1768397,21.8195031 L37.7443031,8.1175556 C37.8194278,8.04168616 37.9217669,7.999 38.0285372,7.999 L41.1040268,7.999 C41.3249407,7.999 41.5040268,8.1780861 41.5040268,8.399 C41.5040268,8.50440471 41.4624226,8.60554929 41.3882578,8.68044752 L26.2773302,23.9408235 L26.2773302,23.9408235 L41.5021975,39.3175645 C41.65763,39.4745475 41.6563731,39.7278104 41.4993901,39.8832429 C41.4244929,39.9574004 41.3233534,39.999 41.2179546,39.999 L38.1434012,39.999 C38.0366291,39.999 37.9342885,39.9563124 37.8591634,39.8804408 L24.1768397,26.0621438 L24.1768397,26.0621438 L10.4936501,39.8804497 C10.4185257,39.9563159 10.3161889,39.999 10.2094212,39.999 L7.13584526,39.999 C6.91493136,39.999 6.73584526,39.8199139 6.73584526,39.599 C6.73584526,39.4936017 6.77744443,39.3924627 6.85160121,39.3175656 L22.0763492,23.9408235 L22.0763492,23.9408235 L6.96554081,8.68044639 C6.81010226,8.52346929 6.81134951,8.27020637 6.9683266,8.11476782 C7.04322474,8.04060377 7.14436883,7.999 7.24977299,7.999 L10.3242852,7.999 C10.4310511,7.999 10.5333863,8.04168267 10.6085104,8.11754663 Z",id:"CloseOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function DownOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"DownOutline-DownOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",null,reactExports.createElement("rect",{id:"DownOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M5.11219264,16.3947957 L22.6612572,34.5767382 L22.6612572,34.5767382 C23.2125856,35.1304785 24.0863155,35.1630514 24.6755735,34.6744571 L24.7825775,34.5767382 L42.8834676,16.3956061 C42.9580998,16.320643 43,16.2191697 43,16.1133896 L43,12.9866673 C43,12.7657534 42.8209139,12.5866673 42.6,12.5866673 C42.4936115,12.5866673 42.391606,12.6290496 42.316542,12.7044413 L23.7816937,31.3201933 L23.7816937,31.3201933 L5.6866816,12.7237117 C5.53262122,12.5653818 5.27937888,12.5619207 5.121049,12.7159811 C5.04365775,12.7912854 5,12.8946805 5,13.0026627 L5,16.1170064 C5,16.2206403 5.04022164,16.3202292 5.11219264,16.3947957 Z",id:"DownOutline-down",fill:"currentColor",fillRule:"nonzero"}))))}function KeyOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"KeyOutline-KeyOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"KeyOutline-编组"},reactExports.createElement("rect",{id:"KeyOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M29.2560785,4 C37.175035,4 43.5946176,10.4195826 43.5946176,18.3385391 C43.5946176,26.2574956 37.175035,32.6770783 29.2560785,32.6770783 C25.8305509,32.6770783 22.6855854,31.4758493 20.2194378,29.471647 L16.0256176,33.6650213 L20.0588981,37.6984676 C20.2151078,37.8546773 20.2151078,38.1079433 20.0588981,38.2641531 L18.5268846,39.7961666 C18.3706749,39.9523763 18.1174089,39.9523763 17.9611992,39.7961666 L13.9276176,35.7630213 L9.8113188,39.8809978 C9.65510908,40.0372075 9.40184309,40.0372075 9.24563337,39.8809978 L7.71361985,38.3489842 C7.55741013,38.1927745 7.55741013,37.9395085 7.71361985,37.7832988 L18.1229706,27.3751798 C16.1187684,24.9090322 14.9175393,21.7640667 14.9175393,18.3385391 C14.9175393,10.4195826 21.337122,4 29.2560785,4 Z M29.2560785,6.9665943 C22.9755268,6.9665943 17.8841337,12.0579874 17.8841337,18.3385391 C17.8841337,24.6190908 22.9755268,29.710484 29.2560785,29.710484 C35.5366302,29.710484 40.6280233,24.6190908 40.6280233,18.3385391 C40.6280233,12.0579874 35.5366302,6.9665943 29.2560785,6.9665943 Z",id:"KeyOutline-形状结合",fill:"currentColor"}))))}function LeftOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"LeftOutline-LeftOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"LeftOutline-编组"},reactExports.createElement("rect",{id:"LeftOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M31.7053818,5.11219264 L13.5234393,22.6612572 L13.5234393,22.6612572 C12.969699,23.2125856 12.9371261,24.0863155 13.4257204,24.6755735 L13.5234393,24.7825775 L31.7045714,42.8834676 C31.7795345,42.9580998 31.8810078,43 31.9867879,43 L35.1135102,43 C35.3344241,43 35.5135102,42.8209139 35.5135102,42.6 C35.5135102,42.4936115 35.4711279,42.391606 35.3957362,42.316542 L16.7799842,23.7816937 L16.7799842,23.7816937 L35.3764658,5.6866816 C35.5347957,5.53262122 35.5382568,5.27937888 35.3841964,5.121049 C35.3088921,5.04365775 35.205497,5 35.0975148,5 L31.9831711,5 C31.8795372,5 31.7799483,5.04022164 31.7053818,5.11219264 Z",id:"LeftOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function QuestionCircleOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"QuestionCircleOutline-QuestionCircleOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"QuestionCircleOutline-编组"},reactExports.createElement("rect",{id:"QuestionCircleOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M24,5 C13.5065898,5 5,13.5065898 5,24 C5,34.4934102 13.5065898,43 24,43 C34.4934102,43 43,34.4934102 43,24 C43,13.5065898 34.4934102,5 24,5 Z M26,32.4 L26,34.6 C26,34.8209139 25.8209139,35 25.6,35 L23.4,35 C23.1790861,35 23,34.8209139 23,34.6 L23,32.4 C23,32.1790861 23.1790861,32 23.4,32 L25.6,32 C25.8209139,32 26,32.1790861 26,32.4 Z M24,12 C27.8659932,12 31,15.1340068 31,19 C31,22.1706393 28.8919961,24.8489278 26.0010432,25.7098107 L26.0001268,28.6 C25.9999299,28.8208643 25.8208644,28.9998731 25.6,29 L23.4,29 C23.1790861,29 23,28.8209139 23,28.6 L23,23.4 C23,23.1790861 23.1790861,23 23.4,23 L24,23 L24,23 C26.209139,23 28,21.209139 28,19 C28,16.790861 26.209139,15 24,15 C21.790861,15 20,16.790861 20,19 L17,19 C17,15.1340068 20.1340068,12 24,12 Z",id:"QuestionCircleOutline-形状",fill:"currentColor",fillRule:"nonzero"}))))}function RightOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"RightOutline-RightOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"RightOutline-RightOutlined"},reactExports.createElement("rect",{id:"RightOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M17.3947957,5.11219264 L35.5767382,22.6612572 L35.5767382,22.6612572 C36.1304785,23.2125856 36.1630514,24.0863155 35.6744571,24.6755735 L35.5767382,24.7825775 L17.3956061,42.8834676 C17.320643,42.9580998 17.2191697,43 17.1133896,43 L13.9866673,43 C13.7657534,43 13.5866673,42.8209139 13.5866673,42.6 C13.5866673,42.4936115 13.6290496,42.391606 13.7044413,42.316542 L32.3201933,23.7816937 L32.3201933,23.7816937 L13.7237117,5.6866816 C13.5653818,5.53262122 13.5619207,5.27937888 13.7159811,5.121049 C13.7912854,5.04365775 13.8946805,5 14.0026627,5 L17.1170064,5 C17.2206403,5 17.3202292,5.04022164 17.3947957,5.11219264 Z",id:"RightOutline-right",fill:"currentColor",fillRule:"nonzero"}))))}function SearchOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"SearchOutline-SearchOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"SearchOutline-编组"},reactExports.createElement("rect",{id:"SearchOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M10.2434135,10.1505371 C17.2346315,3.28315429 28.5696354,3.28315429 35.5608534,10.1505371 C42.3159331,16.7859644 42.5440954,27.4048667 36.2453405,34.3093889 L43.7095294,41.6422249 C43.8671196,41.7970419 43.8693677,42.0502979 43.7145508,42.2078881 C43.7128864,42.2095822 43.7112069,42.2112616 43.7095126,42.2129259 L42.1705322,43.7246464 C42.014915,43.8775072 41.7655181,43.8775006 41.6099089,43.7246316 L34.0775268,36.3248916 L34.0775268,36.3248916 C27.0485579,41.8551751 16.7593545,41.4200547 10.2434135,35.0195303 C3.25219551,28.1521474 3.25219551,17.0179199 10.2434135,10.1505371 Z M12.3532001,12.2229532 C6.52718516,17.9457722 6.52718516,27.2242951 12.3532001,32.9471142 C18.1792151,38.6699332 27.6250517,38.6699332 33.4510667,32.9471142 C39.2770817,27.2242951 39.2770817,17.9457722 33.4510667,12.2229532 C27.6250517,6.50013419 18.1792151,6.50013419 12.3532001,12.2229532 Z",id:"SearchOutline-形状",fill:"currentColor",fillRule:"nonzero"}))))}function TextDeletionOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"TextDeletionOutline-TextDeletionOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"TextDeletionOutline-编组"},reactExports.createElement("rect",{id:"TextDeletionOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M38.5492302,6 C41.5596051,6 44,8.46240906 44,11.499981 L44,35.5 C44,38.5375742 41.5596051,41.000013 38.54923,41.000013 L17.3058462,41.000013 C14.6665152,41.000013 12.2347138,39.555982 10.9529738,37.2279238 L4.91451284,27.0612608 C3.6951623,24.8464932 3.6951623,22.1535354 4.91451335,19.9387516 L10.9529743,9.77208856 C12.234697,7.44403098 14.6665154,6 17.3058464,6 L38.5492302,6 Z M38.5492273,8.74994707 L17.3058465,8.74994707 C15.7329163,8.74994707 14.2719651,9.57120176 13.4439762,10.9206455 L13.3349608,11.1076457 L7.29739408,21.2743087 C6.57566975,22.5850072 6.53495505,24.1690434 7.18837846,25.5157286 L7.29739386,25.7265623 L13.3349605,35.8932253 C14.0992225,37.2803788 15.5202936,38.1698544 17.0914483,38.2444783 L17.3058454,38.2499783 L38.5492292,38.2499783 C39.9923716,38.2499783 41.1854088,37.114979 41.2700704,35.6613101 L41.2746127,35.4999769 L41.2746127,11.4999513 C41.2746127,10.0436198 40.1496291,8.83987037 38.7089651,8.75452144 L38.5492273,8.74994707 Z M22.3492842,17 C22.4547968,17 22.556036,17.0416892 22.6309531,17.1159883 L26.757,21.208 L30.8830469,17.1159883 C30.957964,17.0416892 31.0592032,17 31.1647158,17 L34.2719196,17 C34.4928335,17 34.6719196,17.1790861 34.6719196,17.4 C34.6719196,17.5067321 34.6292639,17.6090378 34.5534423,17.6841566 L28.879,23.306 L34.8245071,29.1968543 C34.9814364,29.3523411 34.9826059,29.6056044 34.8271191,29.7625337 C34.7520011,29.8383486 34.6497001,29.881 34.5429734,29.881 L31.4366959,29.881 C31.331195,29.881 31.2299662,29.8393201 31.1550512,29.7650357 L26.758,25.405 L22.3599432,29.7650669 C22.2850309,29.8393322 22.1838155,29.881 22.07833,29.881 L18.9720266,29.881 C18.7511127,29.881 18.5720266,29.7019139 18.5720266,29.481 C18.5720266,29.3742733 18.614678,29.2719723 18.6904929,29.1968543 L24.636,23.306 L18.9624269,17.6841345 C18.8055037,17.5286415 18.8043444,17.2753782 18.9598374,17.118455 C19.0349545,17.042647 19.1372506,17 19.2439719,17 L22.3492842,17 Z",id:"TextDeletionOutline-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}function UserOutline(e){return reactExports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),reactExports.createElement("g",{id:"UserOutline-UserOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},reactExports.createElement("g",{id:"UserOutline-编组"},reactExports.createElement("rect",{id:"UserOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),reactExports.createElement("path",{d:"M24.5,4 C30.0112644,4 34.479027,8.46775399 34.479027,13.9790078 L34.479027,18.0209922 C34.479027,21.7144498 32.4724515,24.9392476 29.4899594,26.6647285 L29.4895135,27 L40.4649873,32.8658886 C42.8766161,34.1547938 44.2604463,36.7822067 43.9591026,39.5 C43.6750656,42.0617054 41.5099747,44 38.9325658,44 L10.0674342,44 C7.49002529,44 5.32493441,42.0617054 5.04089744,39.5 C4.73955374,36.7822067 6.12338392,34.1547938 8.53501271,32.8658886 L19.5104865,27 L19.5100406,26.6647285 C16.5275485,24.9392476 14.520973,21.7144498 14.520973,18.0209922 L14.520973,13.9790078 C14.520973,8.46775399 18.9887356,4 24.5,4 Z M24.5,7 C20.7258932,7 17.6514878,9.9957724 17.5250256,13.7390798 L17.5209788,13.9790078 L17.5209788,18.0209922 C17.5209788,20.4528116 18.7728519,22.6635411 20.7856095,23.9310701 L21.0123556,24.0679885 L22.3083607,24.817775 C22.4317831,24.8891793 22.5078628,25.0208861 22.5080524,25.1634751 L22.5125654,28.5568164 C22.512762,28.7046068 22.4314515,28.8404631 22.3011089,28.9101252 L9.94909066,35.5117138 L9.94909066,35.5117138 C8.6194532,36.2223442 7.85648652,37.670953 8.0226306,39.1693924 C8.13239999,40.1593932 8.93277672,40.9205158 9.91149276,40.9941531 L10.0674342,41 L38.9325658,41 C39.9810601,41 40.8618227,40.2114985 40.9773694,39.1693924 C41.1359615,37.7390639 40.4479878,36.3541389 39.2286771,35.6131276 L39.0509093,35.5117138 L26.6988911,28.9101252 C26.5685485,28.8404631 26.487238,28.7046068 26.4874346,28.5568164 L26.4919476,25.1634751 C26.4921372,25.0208861 26.5682169,24.8891793 26.6916393,24.817775 L27.9876444,24.0679885 L27.9876444,24.0679885 C30.0560904,22.8713167 31.3818366,20.7046996 31.4738944,18.2902478 L31.4790212,18.0209922 L31.4790212,13.9790078 C31.4790212,10.1246082 28.354407,7 24.5,7 Z",id:"UserOutline-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}const defaultPopupBaseProps={closeOnMaskClick:!1,closeIcon:React$2.createElement(CloseOutline,null),destroyOnClose:!1,disableBodyScroll:!0,forceRender:!1,getContainer:()=>document.body,mask:!0,showCloseButton:!1,stopPropagation:["click"],visible:!1};function useInnerVisible(e){const[t,r]=reactExports.useState(e);return useIsomorphicLayoutEffect$1(()=>{r(e)},[e]),t}function clamp$1(e,t,r){return Math.max(t,Math.min(e,r))}const V={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function rubberband$1(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function rubberbandIfOutOfBounds$1(e,t,r,s=.15){return 0===s?clamp$1(e,t,r):e<t?-rubberband$1(t-e,r-t,s)+t:e>r?+rubberband$1(e-r,r-t,s)+r:e}function computeRubberband(e,[t,r],[s,n]){const[[i,o],[a,l]]=e;return[rubberbandIfOutOfBounds$1(t,i,o,s),rubberbandIfOutOfBounds$1(r,a,l,n)]}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(e){return e?e[0].toUpperCase()+e.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function hasCapture(e=!1,t){return e&&!actionsWithoutCaptureSupported.includes(t)}function toHandlerProp(e,t="",r=!1){const s=EVENT_TYPE_MAP[e],n=s&&s[t]||t;return"on"+capitalize(e)+capitalize(n)+(hasCapture(r,n)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(e){let t=e.substring(2).toLowerCase();const r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));const s=pointerCaptureEvents.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(s);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:r}}function toDomEventType(e,t=""){const r=EVENT_TYPE_MAP[e];return e+(r&&r[t]||t)}function isTouch(e){return"touches"in e}function getPointerType(e){return isTouch(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function getCurrentTargetTouchList(e){return Array.from(e.touches).filter(t=>{var r,s;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(s=r.contains)||void 0===s?void 0:s.call(r,t.target))})}function getTouchList(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}function getValueEvent(e){return isTouch(e)?getTouchList(e)[0]:e}function distanceAngle(e,t){try{const r=t.clientX-e.clientX,s=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,i=(t.clientY+e.clientY)/2,o=Math.hypot(r,s),a=-180*Math.atan2(r,s)/Math.PI;return{angle:a,distance:o,origin:[n,i]}}catch(r){}return null}function touchIds(e){return getCurrentTargetTouchList(e).map(e=>e.identifier)}function touchDistanceAngle(e,t){const[r,s]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return distanceAngle(r,s)}function pointerId(e){const t=getValueEvent(e);return isTouch(e)?t.identifier:t.pointerId}function pointerValues(e){const t=getValueEvent(e);return[t.clientX,t.clientY]}const LINE_HEIGHT=40,PAGE_HEIGHT=800;function wheelValues(e){let{deltaX:t,deltaY:r,deltaMode:s}=e;return 1===s?(t*=LINE_HEIGHT,r*=LINE_HEIGHT):2===s&&(t*=PAGE_HEIGHT,r*=PAGE_HEIGHT),[t,r]}function getEventDetails(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:r,altKey:s,metaKey:n,ctrlKey:i}=e;Object.assign(t,{shiftKey:r,altKey:s,metaKey:n,ctrlKey:i})}return t}function call$1(e,...t){return"function"==typeof e?e(...t):e}function noop(){}function chain(...e){return 0===e.length?noop:1===e.length?e[0]:function(){let t;for(const r of e)t=r.apply(this,arguments)||t;return t}}function assignDefault(e,t){return Object.assign({},t,e||{})}const BEFORE_LAST_KINEMATICS_DELAY=32;class Engine{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:s}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?call$1(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:s}=this;t.args=this.args;let n=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,getEventDetails(e)),s.down=s.pressed=s.buttons%2==1||s.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);V.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[i,o]=t._movement,[a,l]=r.threshold,{_step:c,values:u}=t;if(r.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(i)>=a&&u[0]),!1===c[1]&&(c[1]=Math.abs(o)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(i)>=a&&Math.sign(i)*a),!1===c[1]&&(c[1]=Math.abs(o)>=l&&Math.sign(o)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const d=[0,0];if(r.hasCustomTransform){const[e,t]=u;d[0]=!1!==c[0]?e-c[0]:0,d[1]=!1!==c[1]?t-c[1]:0}else d[0]=!1!==c[0]?i-c[0]:0,d[1]=!1!==c[1]?o-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const p=t.offset,m=t._active&&!t._blocked||t.active;m&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=s[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=call$1(r.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[h,x]=t.offset,[[f,g],[y,v]]=t._bounds;t.overflow=[h<f?-1:h>g?1:0,x<y?-1:x>v?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const E=t._active&&r.rubberband||[0,0];if(t.offset=computeRubberband(t._bounds,t.offset,E),t.delta=V.sub(t.offset,p),this.computeMovement(),m&&(!t.last||n>BEFORE_LAST_KINEMATICS_DELAY)){t.delta=V.sub(t.offset,p);const e=t.delta.map(Math.abs);V.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const s=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},t),e),{},{[this.aliasKey]:e.values}));void 0!==s&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function selectAxis([e,t],r){const s=Math.abs(e),n=Math.abs(t);return s>n&&s>r?"x":n>s&&n>r?"y":void 0}class CoordinatesEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const s="object"==typeof r.axisThreshold?r.axisThreshold[getPointerType(e)]:r.axisThreshold;t.axis=selectAxis(t._movement,s)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const identity=e=>e,DEFAULT_RUBBERBAND=.15,commonConfigResolver={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>_objectSpread2(_objectSpread2({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[DEFAULT_RUBBERBAND,DEFAULT_RUBBERBAND];case!1:return[0,0];default:return V.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?V.toVector(e):void 0,transform(e,t,r){const s=e||r.shared.transform;return this.hasCustomTransform=!!s,s||identity},threshold:e=>V.toVector(e,0)},DEFAULT_AXIS_THRESHOLD=0,coordinatesConfigResolver=_objectSpread2(_objectSpread2({},commonConfigResolver),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=DEFAULT_AXIS_THRESHOLD)=>e,bounds(e={}){if("function"==typeof e)return t=>coordinatesConfigResolver.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:r=1/0,top:s=-1/0,bottom:n=1/0}=e;return[[t,r],[s,n]]}}),KEYS_DELTA_MAP={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class DragEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),s={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=coordinatesConfigResolver.bounds(s)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const s=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),s&&s.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=pointerId(e),r._pointerActive=!0,this.computeValues(pointerValues(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==getPointerType(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,r=this.config;if(!t._pointerActive)return;const s=pointerId(e);if(void 0!==t._pointerId&&s!==t._pointerId)return;const n=pointerValues(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=V.sub(n,t._values),this.computeValues(n)),V.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):r.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(o){}const t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;const s=pointerId(e);if(void 0!==t._pointerId&&s!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[n,i]=t._distance;if(t.tap=n<=r.tapsThreshold&&i<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{const[e,s]=t._delta,[n,i]=t._movement,[o,a]=r.swipe.velocity,[l,c]=r.swipe.distance,u=r.swipe.duration;if(t.elapsedTime<u){const r=Math.abs(e/t.timeDelta),u=Math.abs(s/t.timeDelta);r>o&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),u>a&&Math.abs(i)>c&&(t.swipe[1]=Math.sign(s))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,persistEvent(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=KEYS_DELTA_MAP[e.key];if(t){const r=this.state,s=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,s),r._keyboardActive=!0,V.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in KEYS_DELTA_MAP&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function persistEvent(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}const isBrowser="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch(e2){return!1}}const SUPPORT={isBrowser:isBrowser,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},DEFAULT_PREVENT_SCROLL_DELAY=250,DEFAULT_DRAG_DELAY=180,DEFAULT_SWIPE_VELOCITY=.5,DEFAULT_SWIPE_DISTANCE=50,DEFAULT_SWIPE_DURATION=250,DEFAULT_KEYBOARD_DISPLACEMENT=10,DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8},dragConfigResolver=_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{device(e,t,{pointer:{touch:r=!1,lock:s=!1,mouse:n=!1}={}}){return this.pointerLock=s&&SUPPORT.pointerLock,SUPPORT.touch&&r?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!n?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?DEFAULT_PREVENT_SCROLL_DELAY:void 0,SUPPORT.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:s=1,keys:n=!0}={}}){return this.pointerButtons=s,this.keys=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:s=3,axis:n}){const i=V.toVector(e,r?s:n?1:0);return this.filterTaps=r,this.tapsThreshold=s,i},swipe({velocity:e=DEFAULT_SWIPE_VELOCITY,distance:t=DEFAULT_SWIPE_DISTANCE,duration:r=DEFAULT_SWIPE_DURATION}={}){return{velocity:this.transform(V.toVector(e)),distance:this.transform(V.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return DEFAULT_DRAG_DELAY;case!1:return 0;default:return e}},axisThreshold:e=>e?_objectSpread2(_objectSpread2({},DEFAULT_DRAG_AXIS_THRESHOLD),e):DEFAULT_DRAG_AXIS_THRESHOLD,keyboardDisplacement:(e=DEFAULT_KEYBOARD_DISPLACEMENT)=>e});function clampStateInternalMovementToBounds(e){const[t,r]=e.overflow,[s,n]=e._delta,[i,o]=e._direction;(t<0&&s>0&&i<0||t>0&&s<0&&i>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&n>0&&o<0||r>0&&n<0&&o>0)&&(e._movement[1]=e._movementBound[1])}const SCALE_ANGLE_RATIO_INTENT_DEG=30,PINCH_WHEEL_RATIO=100;class PinchEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"ingKey","pinching"),_defineProperty(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;this.state.offset="wheel"===e?V.add(t,r):[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const s=Math.abs(t)*SCALE_ANGLE_RATIO_INTENT_DEG-Math.abs(r);s<0?e.axis="angle":s>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e)))return;if(r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const s=touchDistanceAngle(e,t._touchIds);s&&this.pinchStart(e,s)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,s=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>s.has(e)))return;if(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const n=distanceAngle(...Array.from(r.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=touchDistanceAngle(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=distanceAngle(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,s=r._values[1],n=t.angle-s;let i=0;Math.abs(n)>270&&(i+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*i]),r.origin=t.origin,r.turns=i,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(r){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=V.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find(t=>e[t]):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-wheelValues(e)[1]/PINCH_WHEEL_RATIO*t.offset[0],0],V.addTo(t._movement,t._delta),clampStateInternalMovementToBounds(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const pinchConfigResolver=_objectSpread2(_objectSpread2({},commonConfigResolver),{},{device(e,t,{shared:r,pointer:{touch:s=!1}={}}){if(r.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&s)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:s={}}){const n=e=>{const t=assignDefault(call$1(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},i=e=>{const t=assignDefault(call$1(s,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof s?[n(),i()]:e=>[n(e),i(e)]},threshold(e,t,r){this.lockDirection="lock"===r.axis;return V.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(e=!0)=>e});class WheelEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=wheelValues(e),V.addTo(t._movement,t._delta),clampStateInternalMovementToBounds(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const wheelConfigResolver=coordinatesConfigResolver;_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(e=!0)=>e});const EngineMap=new Map,ConfigResolverMap=new Map;function registerAction(e){EngineMap.set(e.key,e.engine),ConfigResolverMap.set(e.key,e.resolver)}const dragAction={key:"drag",engine:DragEngine,resolver:dragConfigResolver},pinchAction={key:"pinch",engine:PinchEngine,resolver:pinchConfigResolver},wheelAction={key:"wheel",engine:WheelEngine,resolver:wheelConfigResolver};function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,s,n={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var r,s,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const sharedConfigResolver={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(SUPPORT.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},_excluded$3=["target","eventOptions","window","enabled","transform"];function resolveWith(e={},t){const r={};for(const[s,n]of Object.entries(t))switch(typeof n){case"function":r[s]=n.call(r,e[s],s,e);break;case"object":r[s]=resolveWith(e[s],n);break;case"boolean":n&&(r[s]=e[s])}return r}function parse(e,t,r={}){const s=e,{target:n,eventOptions:i,window:o,enabled:a,transform:l}=s,c=_objectWithoutProperties(s,_excluded$3);if(r.shared=resolveWith({target:n,eventOptions:i,window:o,enabled:a,transform:l},sharedConfigResolver),t){const e=ConfigResolverMap.get(t);r[t]=resolveWith(_objectSpread2({shared:r.shared},c),e)}else for(const u in c){const e=ConfigResolverMap.get(u);e&&(r[u]=resolveWith(_objectSpread2({shared:r.shared},c[u]),e))}return r}class EventStore{constructor(e,t){_defineProperty(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,s,n){const i=this._listeners,o=toDomEventType(t,r),a=_objectSpread2(_objectSpread2({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),n);e.addEventListener(o,s,a);const l=()=>{e.removeEventListener(o,s,a),i.delete(l)};return i.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty(this,"_timeouts",new Map)}add(e,t,r=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...s))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>{window.clearTimeout(e)}),this._timeouts.clear()}}class Controller{constructor(e){_defineProperty(this,"gestures",new Set),_defineProperty(this,"_targetEventStore",new EventStore(this)),_defineProperty(this,"gestureEventStores",{}),_defineProperty(this,"gestureTimeoutStores",{}),_defineProperty(this,"handlers",{}),_defineProperty(this,"config",{}),_defineProperty(this,"pointerIds",new Set),_defineProperty(this,"touchIds",new Set),_defineProperty(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,e)}setEventIds(e){return isTouch(e)?(this.touchIds=new Set(touchIds(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=parse(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let s;if(!t.target||(s=t.target(),s)){if(t.enabled){for(const t of this.gestures){const n=this.config[t],i=bindToProps(r,n.eventOptions,!!s);if(n.enabled){new(EngineMap.get(t))(this,e,t).bind(i)}}const n=bindToProps(r,t.eventOptions,!!s);for(const t in this.nativeHandlers)n(t,"",r=>this.nativeHandlers[t](_objectSpread2(_objectSpread2({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(const e in r)r[e]=chain(...r[e]);if(!s)return r;for(const e in r){const{device:t,capture:n,passive:i}=parseProp(e);this._targetEventStore.add(s,t,"",r[e],{capture:n,passive:i})}}}}function setupGesture(e,t){e.gestures.add(t),e.gestureEventStores[t]=new EventStore(e,t),e.gestureTimeoutStores[t]=new TimeoutStore}function resolveGestures(e,t){t.drag&&setupGesture(e,"drag"),t.wheel&&setupGesture(e,"wheel"),t.scroll&&setupGesture(e,"scroll"),t.move&&setupGesture(e,"move"),t.pinch&&setupGesture(e,"pinch"),t.hover&&setupGesture(e,"hover")}const bindToProps=(e,t,r)=>(s,n,i,o={},a=!1)=>{var l,c;const u=null!==(l=o.capture)&&void 0!==l?l:t.capture,d=null!==(c=o.passive)&&void 0!==c?c:t.passive;let p=a?s:toHandlerProp(s,n,u);r&&d&&(p+="Passive"),e[p]=e[p]||[],e[p].push(i)},RE_NOT_NATIVE=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sortHandlers(e){const t={},r={},s=new Set;for(let n in e)RE_NOT_NATIVE.test(n)?(s.add(RegExp.lastMatch),r[n]=e[n]):t[n]=e[n];return[r,t,s]}function registerGesture(e,t,r,s,n,i){if(!e.has(r))return;if(!EngineMap.has(s))return;const o=r+"Start",a=r+"End";n[s]=e=>{let s;return e.first&&o in t&&t[o](e),r in t&&(s=t[r](e)),e.last&&a in t&&t[a](e),s},i[s]=i[s]||{}}function parseMergedHandlers(e,t){const[r,s,n]=sortHandlers(e),i={};return registerGesture(n,r,"onDrag","drag",i,t),registerGesture(n,r,"onWheel","wheel",i,t),registerGesture(n,r,"onScroll","scroll",i,t),registerGesture(n,r,"onPinch","pinch",i,t),registerGesture(n,r,"onMove","move",i,t),registerGesture(n,r,"onHover","hover",i,t),{handlers:i,config:t,nativeHandlers:s}}function useRecognizers(e,t={},r,s){const n=React$2.useMemo(()=>new Controller(e),[]);if(n.applyHandlers(e,s),n.applyConfig(t,r),React$2.useEffect(n.effect.bind(n)),React$2.useEffect(()=>n.clean.bind(n),[]),void 0===t.target)return n.bind.bind(n)}function useDrag(e,t){return registerAction(dragAction),useRecognizers({drag:e},t||{},"drag")}function useWheel(e,t){return registerAction(wheelAction),useRecognizers({wheel:e},t||{},"wheel")}function createUseGesture(e){return e.forEach(registerAction),function(e,t){const{handlers:r,nativeHandlers:s,config:n}=parseMergedHandlers(e,t||{});return useRecognizers(r,n,void 0,s)}}const classPrefix$G="adm-popup",defaultProps$y=Object.assign(Object.assign({},defaultPopupBaseProps),{closeOnSwipe:!1,position:"bottom"}),Popup=e=>{const{locale:t,popup:r={}}=useConfig(),s=mergeProps(defaultProps$y,r,e),n=classNames$1(`${classPrefix$G}-body`,s.bodyClassName,`${classPrefix$G}-body-position-${s.position}`),[i,o]=reactExports.useState(s.visible),a=reactExports.useRef(null);useLockScroll(a,!(!s.disableBodyScroll||!i)&&"strict"),useIsomorphicLayoutEffect$1(()=>{s.visible&&o(!0)},[s.visible]);const l=useUnmountedRef(),{percent:c}=useSpring({percent:s.visible?0:100,config:{precision:.1,mass:.4,tension:300,friction:30},onRest:()=>{var e,t;l.current||(o(s.visible),s.visible?null===(e=s.afterShow)||void 0===e||e.call(s):null===(t=s.afterClose)||void 0===t||t.call(s))}}),u=useDrag(({swipe:[,e]})=>{var t;s.closeOnSwipe&&(1===e&&"bottom"===s.position||-1===e&&"top"===s.position)&&(null===(t=s.onClose)||void 0===t||t.call(s))},{axis:"y",enabled:["top","bottom"].includes(s.position)}),d=useInnerVisible(i&&s.visible),p=withStopPropagation(s.stopPropagation,withNativeProps(s,React$2.createElement("div",Object.assign({className:classPrefix$G,onClick:s.onClick,style:{display:i?void 0:"none",touchAction:["top","bottom"].includes(s.position)?"none":"auto"}},u()),s.mask&&React$2.createElement(Mask,{visible:d,forceRender:s.forceRender,destroyOnClose:s.destroyOnClose,onMaskClick:e=>{var t,r;null===(t=s.onMaskClick)||void 0===t||t.call(s,e),s.closeOnMaskClick&&(null===(r=s.onClose)||void 0===r||r.call(s))},className:s.maskClassName,style:s.maskStyle,disableBodyScroll:!1,stopPropagation:s.stopPropagation}),React$2.createElement(animated.div,{className:n,style:Object.assign(Object.assign({},s.bodyStyle),{pointerEvents:c.to(e=>0===e?"unset":"none"),transform:c.to(e=>"bottom"===s.position?`translate(0, ${e}%)`:"top"===s.position?`translate(0, -${e}%)`:"left"===s.position?`translate(-${e}%, 0)`:"right"===s.position?`translate(${e}%, 0)`:"none")}),ref:a},s.showCloseButton&&React$2.createElement("a",{className:classNames$1(`${classPrefix$G}-close-icon`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=s.onClose)||void 0===e||e.call(s)},role:"button","aria-label":t.common.close},s.closeIcon),s.children))));return React$2.createElement(ShouldRender,{active:i,forceRender:s.forceRender,destroyOnClose:s.destroyOnClose},renderToContainer(s.getContainer,p))},classPrefix$F="adm-safe-area",SafeArea=e=>withNativeProps(e,React$2.createElement("div",{className:classNames$1(classPrefix$F,`${classPrefix$F}-position-${e.position}`)})),fullClone=Object.assign({},ReactDOM),{version:version,render:reactRender,unmountComponentAtNode:unmountComponentAtNode}=fullClone;let createRoot;try{const e=Number((version||"").split(".")[0]);e>=18&&fullClone.createRoot&&(createRoot=fullClone.createRoot)}catch(e2){}function toggleWarning(e){const{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:t}=fullClone;t&&"object"==typeof t&&(t.usingClientEntryPoint=e)}const MARK="__antd_mobile_root__";function legacyRender(e,t){reactRender(e,t)}function concurrentRender(e,t){toggleWarning(!0);const r=t[MARK]||createRoot(t);toggleWarning(!1),r.render(e),t[MARK]=r}function render(e,t){createRoot?concurrentRender(e,t):legacyRender(e,t)}function legacyUnmount(e){return unmountComponentAtNode(e)}function concurrentUnmount(e){return __awaiter$1(this,void 0,void 0,function*(){return Promise.resolve().then(()=>{var t;null===(t=e[MARK])||void 0===t||t.unmount(),delete e[MARK]})})}function unmount(e){return createRoot?concurrentUnmount(e):legacyUnmount(e)}function renderToBody(e){const t=document.createElement("div");return document.body.appendChild(t),render(e,t),function(){unmount(t)&&t.parentNode&&t.parentNode.removeChild(t)}}function renderImperatively(e){const t=React$2.forwardRef((t,r)=>{const[n,i]=reactExports.useState(!1),o=reactExports.useRef(!1),[a,l]=reactExports.useState(e),c=reactExports.useRef(0);function u(){var e,t;o.current=!0,i(!1),null===(t=(e=a.props).onClose)||void 0===t||t.call(e)}function d(){var e,t;s(),null===(t=(e=a.props).afterClose)||void 0===t||t.call(e)}return reactExports.useEffect(()=>{o.current?d():i(!0)},[]),reactExports.useImperativeHandle(r,()=>({close:u,replace:e=>{var t,r;c.current++,null===(r=(t=a.props).afterClose)||void 0===r||r.call(t),l(e)}})),React$2.cloneElement(a,Object.assign(Object.assign({},a.props),{key:c.current,visible:n,onClose:u,afterClose:d}))}),r=React$2.createRef(),s=renderToBody(React$2.createElement(t,{ref:r}));return{close:()=>__awaiter$1(this,void 0,void 0,function*(){var t,n,i;r.current?null===(i=r.current)||void 0===i||i.close():(s(),null===(n=(t=e.props).afterClose)||void 0===n||n.call(t))}),replace:e=>{var t;null===(t=r.current)||void 0===t||t.replace(e)},isRendered:()=>!!r.current}}const classPrefix$E="adm-auto-center",AutoCenter=e=>withNativeProps(e,React$2.createElement("div",{className:classPrefix$E},React$2.createElement("div",{className:`${classPrefix$E}-content`},e.children))),Fallback=reactExports.memo(()=>React$2.createElement("svg",{className:"adm-avatar-fallback",width:"88px",height:"88px",viewBox:"0 0 88 88",version:"1.1"},React$2.createElement("title",null,"编组 3"),React$2.createElement("defs",null,React$2.createElement("polygon",{id:"path-1",points:"0 0 88 0 88 88 0 88"})),React$2.createElement("g",{id:"页面-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},React$2.createElement("g",{id:"语雀",transform:"translate(-495.000000, -71.000000)"},React$2.createElement("g",{id:"编组-3",transform:"translate(495.000000, 71.000000)"},React$2.createElement("mask",{id:"mask-2",fill:"white"},React$2.createElement("use",{xlinkHref:"#path-1"})),React$2.createElement("use",{id:"Mask",fill:"#EEEEEE",fillRule:"nonzero",xlinkHref:"#path-1"}),React$2.createElement("path",{d:"M44.5707528,16 L43.4292117,16 L42.9575197,16.0086403 L42.9575195,16.0086403 C36.5215787,16.2615464 31.4341803,21.5678078 31.4344832,28.0273864 L31.4344832,34.7776551 L31.4495601,35.3716788 L31.4495593,35.3716628 C31.599687,38.5368723 32.9422041,41.5269327 35.2058513,43.7376716 L38.2147759,46.6775505 L38.4086219,46.8913989 C38.7747759,47.3385365 38.9750835,47.9001589 38.9750835,48.4833848 L38.9750835,48.8938006 L38.9556989,49.1897326 L38.9556989,49.1897325 C38.8577746,49.9812662 38.3754713,50.67284 37.667703,51.036605 L18.7375269,60.7440265 L18.4101421,60.9276334 L18.4101423,60.9276333 C16.9141658,61.8418636 16.0009389,63.4714674 16,65.2283758 L16,66.070809 L16.0129231,66.3948217 C16.1766149,68.4123376 17.860922,70 19.91569,70 L68.0843101,70 L68.08431,70 C70.2460467,70 71.9988087,68.243122 72,66.0751224 L72,65.2326893 C72,63.3382982 70.9446194,61.6037466 69.2624598,60.7440295 L50.3322837,51.036608 L50.3322835,51.0366079 C49.5291218,50.6249082 49.0240448,49.7962466 49.024903,48.8916436 L49.024903,48.4812278 C49.024903,47.8029608 49.3005955,47.1527756 49.7852106,46.6775603 L52.7941352,43.7376813 L52.7941354,43.7376811 C55.204308,41.3832325 56.5636029,38.151975 56.5633606,34.7776456 L56.5633606,28.0273769 L56.5633606,28.0273774 C56.5633606,21.3848531 51.1940878,16 44.5707524,16 L44.5707528,16 Z",id:"形状",fill:"#CCCCCC",fillRule:"nonzero",mask:"url(#mask-2)"}))))));var stagedComponents={},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(stagedComponents,"__esModule",{value:!0});var staged_1=stagedComponents.staged=void 0;const react_1=__importDefault(reactExports);function processNext(e){return"function"==typeof e?react_1.default.createElement(Stage,{stage:e}):e}function Stage(e){return processNext(e.stage())}function staged(e){return function(t,r){return processNext(e(t,r))}}function toCSSLength(e){return"number"==typeof e?`${e}px`:e}staged_1=stagedComponents.staged=staged;const LazyDetector=e=>{const t=reactExports.useRef(null),[r]=useInViewport(t);return reactExports.useEffect(()=>{r&&e.onActive()},[r]),React$2.createElement("div",{ref:t})},useIsomorphicUpdateLayoutEffect=createUpdateEffect(useIsomorphicLayoutEffect$1),ImageIcon=()=>React$2.createElement("svg",{viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},React$2.createElement("path",{d:"M41.396 6.234c1.923 0 3.487 1.574 3.487 3.505v29.14c0 1.937-1.568 3.51-3.491 3.51H6.604c-1.923 0-3.487-1.573-3.487-3.51V9.745c0-1.936 1.564-3.51 3.487-3.51Zm0 2.847H6.604c-.355 0-.654.3-.654.658V34.9l5.989-8.707a2.373 2.373 0 0 1 1.801-1.005 2.405 2.405 0 0 1 1.933.752l4.182 4.525 7.58-11.005a2.374 2.374 0 0 1 1.96-1.01c.79 0 1.532.38 1.966 1.01L42.05 34.89V9.74a.664.664 0 0 0-.654-.658Zm-28.305 2.763a3.119 3.119 0 0 1 3.117 3.117 3.119 3.119 0 0 1-3.117 3.117 3.122 3.122 0 0 1-3.117-3.117 3.119 3.119 0 0 1 3.117-3.117Z",fill:"#DBDBDB",fillRule:"nonzero"})),BrokenImageIcon=()=>React$2.createElement("svg",{viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},React$2.createElement("path",{d:"M19.233 6.233 17.42 9.08l-10.817.001a.665.665 0 0 0-.647.562l-.007.096V34.9l5.989-8.707a2.373 2.373 0 0 1 1.801-1.005 2.415 2.415 0 0 1 1.807.625l.126.127 4.182 4.525 2.267-3.292 5.461 7.841-4.065 7.375H6.604c-1.86 0-3.382-1.47-3.482-3.317l-.005-.192V9.744c0-1.872 1.461-3.405 3.296-3.505l.19-.005h12.63Zm22.163 0c1.86 0 3.382 1.472 3.482 3.314l.005.192v29.14a3.507 3.507 0 0 1-3.3 3.505l-.191.006H27.789l3.63-6.587.06-.119a1.87 1.87 0 0 0-.163-1.853l-6.928-9.949 3.047-4.422a2.374 2.374 0 0 1 1.96-1.01 2.4 2.4 0 0 1 1.86.87l.106.14L42.05 34.89V9.74a.664.664 0 0 0-.654-.658H21.855l1.812-2.848h17.73Zm-28.305 5.611c.794 0 1.52.298 2.07.788l-.843 1.325-.067.114a1.87 1.87 0 0 0 .11 1.959l.848 1.217c-.556.515-1.3.83-2.118.83a3.122 3.122 0 0 1-3.117-3.116 3.119 3.119 0 0 1 3.117-3.117Z",fill:"#DBDBDB",fillRule:"nonzero"})),classPrefix$D="adm-image",defaultProps$x={fit:"fill",placeholder:React$2.createElement("div",{className:`${classPrefix$D}-tip`},React$2.createElement(ImageIcon,null)),fallback:React$2.createElement("div",{className:`${classPrefix$D}-tip`},React$2.createElement(BrokenImageIcon,null)),lazy:!1,draggable:!1},Image$1=staged_1(e=>{const t=mergeProps(defaultProps$x,e),[r,s]=reactExports.useState(!1),[n,i]=reactExports.useState(!1),o=reactExports.useRef(null),a=reactExports.useRef(null);let l=t.src,c=t.srcSet;const[u,d]=reactExports.useState(!t.lazy);l=u?t.src:void 0,c=u?t.srcSet:void 0,useIsomorphicUpdateLayoutEffect(()=>{s(!1),i(!1)},[l]),reactExports.useEffect(()=>{var e;(null===(e=a.current)||void 0===e?void 0:e.complete)&&s(!0)},[]);const p={};return t.width&&(p["--width"]=toCSSLength(t.width),p.width=toCSSLength(t.width)),t.height&&(p["--height"]=toCSSLength(t.height),p.height=toCSSLength(t.height)),withNativeProps(t,React$2.createElement("div",{ref:o,className:classPrefix$D,style:p,onClick:t.onContainerClick},t.lazy&&!u&&React$2.createElement(LazyDetector,{onActive:()=>{d(!0)}}),function(){if(n)return React$2.createElement(React$2.Fragment,null,t.fallback);const e=React$2.createElement("img",{ref:a,id:t.id,className:`${classPrefix$D}-img`,src:l,alt:t.alt,onClick:t.onClick,onLoad:e=>{var r;s(!0),null===(r=t.onLoad)||void 0===r||r.call(t,e)},onError:e=>{var r;i(!0),null===(r=t.onError)||void 0===r||r.call(t,e)},style:{objectFit:t.fit,display:r?"block":"none"},crossOrigin:t.crossOrigin,decoding:t.decoding,loading:t.loading,referrerPolicy:t.referrerPolicy,sizes:t.sizes,srcSet:c,useMap:t.useMap,draggable:t.draggable});return React$2.createElement(React$2.Fragment,null,!r&&t.placeholder,e)}()))}),classPrefix$C="adm-avatar",defaultProps$w={fallback:React$2.createElement(Fallback,null),fit:"cover"},Avatar=e=>{const t=mergeProps(defaultProps$w,e);return withNativeProps(t,React$2.createElement(Image$1,{className:classPrefix$C,src:t.src,fallback:t.fallback,placeholder:t.fallback,alt:t.alt,lazy:t.lazy,fit:t.fit,onClick:t.onClick,onError:t.onError,onLoad:t.onLoad}))},classPrefix$B="adm-badge",dot=React$2.createElement(React$2.Fragment,null),Badge$1=e=>{const{content:t,color:r,children:s}=e,n=t===dot,i=classNames$1(classPrefix$B,{[`${classPrefix$B}-fixed`]:!!s,[`${classPrefix$B}-dot`]:n,[`${classPrefix$B}-bordered`]:e.bordered}),o=t||0===t?withNativeProps(e,React$2.createElement("div",{className:i,style:{"--color":r}},!n&&React$2.createElement("div",{className:`${classPrefix$B}-content`},t))):null;return s?React$2.createElement("div",{className:classNames$1(`${classPrefix$B}-wrapper`,e.wrapperClassName),style:e.wrapperStyle},s,o):o},Badge=attachPropertiesToComponent(Badge$1,{dot:dot}),classPrefix$A="adm-dot-loading",colorRecord$2={default:"var(--adm-color-weak)",primary:"var(--adm-color-primary)",white:"var(--adm-color-white)"},defaultProps$v={color:"default"},DotLoading=reactExports.memo(e=>{var t;const r=mergeProps(defaultProps$v,e);return withNativeProps(r,React$2.createElement("div",{style:{color:null!==(t=colorRecord$2[r.color])&&void 0!==t?t:r.color},className:classNames$1("adm-loading",classPrefix$A)},React$2.createElement("svg",{height:"1em",viewBox:"0 0 100 40",style:{verticalAlign:"-0.125em"}},React$2.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},React$2.createElement("g",{transform:"translate(-100.000000, -71.000000)"},React$2.createElement("g",{transform:"translate(95.000000, 71.000000)"},React$2.createElement("g",{transform:"translate(5.000000, 0.000000)"},[0,1,2].map(e=>React$2.createElement("rect",{key:e,fill:"currentColor",x:20+26*e,y:"16",width:"8",height:"8",rx:"2"},React$2.createElement("animate",{attributeName:"y",from:"16",to:"16",dur:"2s",begin:.2*e+"s",repeatCount:"indefinite",values:"16; 6; 26; 16; 16",keyTimes:"0; 0.1; 0.3; 0.4; 1"}))))))))))});function isPromise(e){return!!e&&"object"==typeof e&&"function"==typeof e.then}function isIOS(){return!!canUseDom&&/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())}const classPrefix$z="adm-button",defaultProps$u={color:"default",fill:"solid",block:!1,loading:!1,loadingIcon:React$2.createElement(DotLoading,{color:"currentColor"}),type:"button",shape:"default",size:"middle"},Button=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$u,e),[s,n]=reactExports.useState(!1),i=reactExports.useRef(null),o="auto"===r.loading?s:r.loading,a=r.disabled||o;reactExports.useImperativeHandle(t,()=>({get nativeElement(){return i.current}}));return withNativeProps(r,React$2.createElement("button",{ref:i,type:r.type,onClick:e=>__awaiter$1(void 0,void 0,void 0,function*(){if(!r.onClick)return;const t=r.onClick(e);if(isPromise(t))try{n(!0),yield t,n(!1)}catch(s){throw n(!1),s}}),className:classNames$1(classPrefix$z,{[`${classPrefix$z}-${r.color}`]:r.color,[`${classPrefix$z}-block`]:r.block,[`${classPrefix$z}-disabled`]:a,[`${classPrefix$z}-fill-outline`]:"outline"===r.fill,[`${classPrefix$z}-fill-none`]:"none"===r.fill,[`${classPrefix$z}-mini`]:"mini"===r.size,[`${classPrefix$z}-small`]:"small"===r.size,[`${classPrefix$z}-large`]:"large"===r.size,[`${classPrefix$z}-loading`]:o},`${classPrefix$z}-shape-${r.shape}`),disabled:a,onMouseDown:r.onMouseDown,onMouseUp:r.onMouseUp,onTouchStart:r.onTouchStart,onTouchEnd:r.onTouchEnd},o?React$2.createElement("div",{className:`${classPrefix$z}-loading-wrapper`},r.loadingIcon,r.loadingText):React$2.createElement("span",null,r.children)))});var isoWeek$1={exports:{}};isoWeek$1.exports=function(){var e="day";return function(t,r,s){var n=function(t){return t.add(4-t.isoWeekday(),e)},i=r.prototype;i.isoWeekYear=function(){return n(this).year()},i.isoWeek=function(t){if(!this.$utils().u(t))return this.add(7*(t-this.isoWeek()),e);var r,i,o,a=n(this),l=(r=this.isoWeekYear(),o=4-(i=(this.$u?s.utc:s)().year(r).startOf("year")).isoWeekday(),i.isoWeekday()>4&&(o+=7),i.add(o,e));return a.diff(l,"week")+1},i.isoWeekday=function(e){return this.$utils().u(e)?this.day()||7:this.day(this.day()%7?e:e-7)};var o=i.startOf;i.startOf=function(e,t){var r=this.$utils(),s=!!r.u(t)||t;return"isoweek"===r.p(e)?s?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):o.bind(this)(e,t)}}}();var isoWeekExports=isoWeek$1.exports;const isoWeek=getDefaultExportFromCjs(isoWeekExports);function usePropsValue(e){const{value:t,defaultValue:r,onChange:s}=e,n=useUpdate(),i=reactExports.useRef(void 0!==t?t:r);void 0!==t&&(i.current=t);const o=useMemoizedFn((e,t=!1)=>{const r="function"==typeof e?e(i.current):e;if(t||r!==i.current)return i.current=r,n(),null==s?void 0:s(r)});return[i.current,o]}var isSameOrBefore$1={exports:{}};isSameOrBefore$1.exports=function(e,t){t.prototype.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)}};var isSameOrBeforeExports=isSameOrBefore$1.exports;const isSameOrBefore=getDefaultExportFromCjs(isSameOrBeforeExports);function convertValueToRange(e,t){return void 0===e||null===t?null:Array.isArray(t)?t:[t,t]}function convertPageToDayjs(e){return dayjs().year(e.year).month(e.month-1).date(1)}function useSyncScroll(e,t,r){const s=reactExports.useRef(),n=()=>{s.current&&cancelAnimationFrame(s.current)},i=useEvent(e=>{n(),s.current=requestAnimationFrame(()=>{if(r.current){const t=e.format("YYYY-M"),s=r.current.querySelector(`[data-year-month="${t}"]`);s&&s.scrollIntoView({block:"start",inline:"nearest"})}})});return reactExports.useEffect(()=>{if(t&&e)return i(e),n},[e,t]),i}dayjs.extend(isoWeek),dayjs.extend(isSameOrBefore);const classPrefix$y="adm-calendar-picker-view",Context$2=React$2.createContext({visible:!1}),defaultProps$t={weekStartsOn:"Sunday",defaultValue:null,allowClear:!0,usePopup:!0,selectionMode:"single"},CalendarPickerView=reactExports.forwardRef((e,t)=>{var r;const s=reactExports.useRef(null),n=dayjs(),i=mergeProps(defaultProps$t,e),{locale:o}=useConfig(),a=[...o.Calendar.markItems];if("Sunday"===i.weekStartsOn){const e=a.pop();e&&a.unshift(e)}const[l,c]=usePropsValue({value:void 0===i.value?void 0:convertValueToRange(i.selectionMode,i.value),defaultValue:convertValueToRange(i.selectionMode,i.defaultValue),onChange:e=>{var t,r;"single"===i.selectionMode?null===(t=i.onChange)||void 0===t||t.call(i,e?e[0]:null):"range"===i.selectionMode&&(null===(r=i.onChange)||void 0===r||r.call(i,e))}}),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(()=>dayjs(l?l[0]:n).date(1)),h=e=>{e&&m(dayjs(e[0]).date(1)),c(e)},x=!1!==i.title,f=reactExports.useContext(Context$2),g=useSyncScroll(p,f.visible,s),[y,v]=reactExports.useState(p),[E,j]=reactExports.useState(()=>p.add(6,"month"));reactExports.useEffect(()=>{if(l){const[e,t]=l;!i.min&&e&&dayjs(e).isBefore(y)&&v(dayjs(e).date(1)),!i.max&&t&&dayjs(t).isAfter(E)&&j(dayjs(t).endOf("month"))}},[l]);const b=reactExports.useMemo(()=>i.max?dayjs(i.max):E,[i.max,E]),w=reactExports.useMemo(()=>i.min?dayjs(i.min):y,[i.min,y]);reactExports.useImperativeHandle(t,()=>({jumpTo:e=>{let t;t="function"==typeof e?e({year:p.year(),month:p.month()+1}):e;const r=convertPageToDayjs(t);m(r),g(r)},jumpToToday:()=>{const e=dayjs().date(1);m(e),g(e)},getDateRange:()=>l}));const R=React$2.createElement("div",{className:`${classPrefix$y}-header`},React$2.createElement("div",{className:`${classPrefix$y}-title`},null!==(r=i.title)&&void 0!==r?r:o.Calendar.title));const _=React$2.createElement("div",{className:`${classPrefix$y}-body`,ref:s},function(){var e;const t=[];let r=w;for(;r.isSameOrBefore(b,"month");){const s=r.year(),a=r.month()+1,c={year:s,month:a},p=`${s}-${a}`,m="Monday"===i.weekStartsOn?r.date(1).isoWeekday()-1:r.date(1).isoWeekday(),x=7==m?null:Array(m).fill(null).map((e,t)=>React$2.createElement("div",{key:t,className:`${classPrefix$y}-cell`}));t.push(React$2.createElement("div",{key:p,"data-year-month":p},React$2.createElement("div",{className:`${classPrefix$y}-title`},null===(e=o.Calendar.yearAndMonth)||void 0===e?void 0:e.replace(/\${(.*?)}/g,(e,t)=>{var r;return null===(r=c[t])||void 0===r?void 0:r.toString()})),React$2.createElement("div",{className:`${classPrefix$y}-cells`},x,Array(r.daysInMonth()).fill(null).map((e,s)=>{const a=r.date(s+1);let c=!1,p=!1,m=!1,x=!1,f=!1;if(l){const[e,r]=l;p=a.isSame(e,"day"),m=a.isSame(r,"day"),c=p||m||a.isAfter(e,"day")&&a.isBefore(r,"day"),c&&(x=(t.length%7==0||a.isSame(a.startOf("month"),"day"))&&!p,f=(t.length%7==6||a.isSame(a.endOf("month"),"day"))&&!m)}const g=i.shouldDisableDate?i.shouldDisableDate(a.toDate()):b&&a.isAfter(b,"day")||w&&a.isBefore(w,"day");return React$2.createElement("div",{key:a.valueOf(),className:classNames$1(`${classPrefix$y}-cell`,{[`${classPrefix$y}-cell-today`]:a.isSame(n,"day"),[`${classPrefix$y}-cell-selected`]:c,[`${classPrefix$y}-cell-selected-begin`]:p,[`${classPrefix$y}-cell-selected-end`]:m,[`${classPrefix$y}-cell-selected-row-begin`]:x,[`${classPrefix$y}-cell-selected-row-end`]:f,[`${classPrefix$y}-cell-disabled`]:!!g}),onClick:()=>{if(!i.selectionMode)return;if(g)return;const e=a.toDate();function t(){if(!i.allowClear)return!1;if(!l)return!1;const[e,t]=l;return a.isSame(e,"date")&&a.isSame(t,"day")}if("single"===i.selectionMode){if(i.allowClear&&t())return void h(null);h([e,e])}else if("range"===i.selectionMode){if(!l)return h([e,e]),void d(!0);if(t())return h(null),void d(!1);if(u){const t=l[0];h(t>e?[e,t]:[t,e]),d(!1)}else h([e,e]),d(!0)}}},(()=>{var e;if(!1===i.renderTop)return null;const t=e=>React$2.createElement("div",{className:`${classPrefix$y}-cell-top`},e),r=null===(e=i.renderTop)||void 0===e?void 0:e.call(i,a.toDate());if(r)return t(r);if("range"===i.selectionMode){if(p)return t(o.Calendar.start);if(m)return t(o.Calendar.end)}return a.isSame(n,"day")&&!c?t(o.Calendar.today):t(null)})(),React$2.createElement("div",{className:`${classPrefix$y}-cell-date`},i.renderDate?i.renderDate(a.toDate()):a.date()),!1===i.renderBottom?null:React$2.createElement("div",{className:`${classPrefix$y}-cell-bottom`},null===(y=i.renderBottom)||void 0===y?void 0:y.call(i,a.toDate())));var y})))),r=r.add(1,"month")}return t}()),S=React$2.createElement("div",{className:`${classPrefix$y}-mark`},a.map((e,t)=>React$2.createElement("div",{key:t,className:`${classPrefix$y}-mark-cell`},e)));return withNativeProps(i,React$2.createElement("div",{className:classPrefix$y},x&&R,S,_))}),classPrefix$x="adm-divider",defaultProps$s={contentPosition:"center",direction:"horizontal"},Divider=e=>{const t=mergeProps(defaultProps$s,e);return withNativeProps(t,React$2.createElement("div",{className:classNames$1(classPrefix$x,`${classPrefix$x}-${t.direction}`,`${classPrefix$x}-${t.contentPosition}`)},t.children&&React$2.createElement("div",{className:`${classPrefix$x}-content`},t.children)))},classPrefix$w="adm-calendar-picker",defaultProps$r={weekStartsOn:"Sunday",defaultValue:null,allowClear:!0,usePopup:!0,selectionMode:"single"},CalendarPicker=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$r,e),{locale:s}=useConfig(),n=null!=t?t:reactExports.useRef(null),{visible:i,confirmText:o,popupClassName:a,popupStyle:l,popupBodyStyle:c,forceRender:u,closeOnMaskClick:d,onClose:p,onConfirm:m,onMaskClick:h,getContainer:x}=r,f=__rest$1(r,["visible","confirmText","popupClassName","popupStyle","popupBodyStyle","forceRender","closeOnMaskClick","onClose","onConfirm","onMaskClick","getContainer"]),g=React$2.useMemo(()=>({visible:!!i}),[i]),y=React$2.createElement("div",{className:`${classPrefix$w}-footer`},React$2.createElement(Divider,null),React$2.createElement("div",{className:`${classPrefix$w}-footer-bottom`},React$2.createElement(Button,{color:"primary",onClick:()=>{var e,t,s,i;const o=null!==(t=null===(e=n.current)||void 0===e?void 0:e.getDateRange())&&void 0!==t?t:null;"single"===r.selectionMode?null===(s=r.onConfirm)||void 0===s||s.call(r,o?o[0]:null):"range"===r.selectionMode&&(null===(i=r.onConfirm)||void 0===i||i.call(r,o)),null==p||p()}},null!=o?o:s.Calendar.confirm)));return withNativeProps(r,React$2.createElement("div",{className:classPrefix$w},React$2.createElement(Popup,{visible:i,className:classNames$1(`${classPrefix$w}-popup`,a),showCloseButton:!0,forceRender:!!t||u,style:l,bodyStyle:Object.assign({borderTopLeftRadius:"8px",borderTopRightRadius:"8px",minHeight:"80vh",overflow:"auto"},c),onClose:p,onMaskClick:()=>{null==h||h(),d&&(null==p||p())},getContainer:x},React$2.createElement(Context$2.Provider,{value:g},React$2.createElement(CalendarPickerView,Object.assign({ref:n},f))),y)))});function bound(e,t,r){let s=e;return void 0!==t&&(s=Math.max(e,t)),void 0!==r&&(s=Math.min(s,r)),s}function traverseReactNode(e,t){let r=0;!function e(s){React$2.Children.forEach(s,s=>{reactIsExports.isFragment(s)?e(s.props.children):(t(s,r),r+=1)})}(e)}const classPrefix$v="adm-card",Card=e=>withNativeProps(e,React$2.createElement("div",{className:classPrefix$v,onClick:e.onClick},e.title||e.extra?React$2.createElement("div",{className:classNames$1(`${classPrefix$v}-header`,e.headerClassName),style:e.headerStyle,onClick:e.onHeaderClick},e.icon&&React$2.createElement("div",{className:`${classPrefix$v}-header-icon`},e.icon),React$2.createElement("div",{className:`${classPrefix$v}-header-title`},e.title),e.extra&&React$2.createElement("div",{className:`${classPrefix$v}-header-extra`},e.extra)):null,e.children?React$2.createElement("div",{className:classNames$1(`${classPrefix$v}-body`,e.bodyClassName),style:e.bodyStyle,onClick:e.onBodyClick},e.children):null));function rubberband(e,t,r){return e*t*r/(t+r*e)}function rubberbandIfOutOfBounds(e,t,r,s,n=.15){return 0===n?bound(e,t,r):e<t?-rubberband(t-e,s,n)+t:e>r?+rubberband(e-r,s,n)+r:e}function measureCSSLength(e){if(null==e||""===e)return 0;const t=e.trim();return t.endsWith("px")?parseFloat(t):t.endsWith("rem")?parseFloat(t)*parseFloat(window.getComputedStyle(document.documentElement).fontSize):t.endsWith("vw")?parseFloat(t)*window.innerWidth/100:0}const classPrefix$u="adm-picker-view",Wheel=reactExports.memo(e=>{const{value:t,column:r,renderLabel:s}=e;function n(t){e.onSelect(t,e.index)}const[{y:i},o]=useSpring(()=>({from:{y:0},config:{tension:400,mass:.8}})),a=reactExports.useRef(!1),l=reactExports.useRef(null),c=reactExports.useRef(null),u=reactExports.useRef(34);function d(e){const t=e*-u.current;o.start({y:t});const s=r[e];s&&n(s.value)}useIsomorphicLayoutEffect$1(()=>{const e=c.current;e&&(u.current=measureCSSLength(window.getComputedStyle(e).getPropertyValue("height")))}),useIsomorphicLayoutEffect$1(()=>{if(a.current)return;if(null===t)return;const e=r.findIndex(e=>e.value===t);if(e<0)return;const s=e*-u.current;o.start({y:s,immediate:i.goal!==s})},[t,r]),useIsomorphicLayoutEffect$1(()=>{if(0===r.length)null!==t&&n(null);else if(!r.some(e=>e.value===t)){n(r[0].value)}},[r,t]);const p=e=>{const{direction:[,t],distance:[,r],velocity:[,s],offset:[,n],last:i}=e;return{direction:t,distance:r,velocity:s,offset:n,last:i}};useDrag(e=>{e.event.stopPropagation(),(e=>{a.current=!0;const t=-(r.length-1)*u.current,{direction:s,last:n,velocity:i,offset:l}=p(e);if(n){a.current=!1;const e=bound(l+i*s*50,t,0);d(-Math.round(e/u.current))}else{const e=l;o.start({y:rubberbandIfOutOfBounds(e,t,0,50*u.current,.2)})}})(e)},{axis:"y",from:()=>[0,i.get()],filterTaps:!0,pointer:{touch:!0},target:l}),useWheel(e=>{e.event.stopPropagation(),(e=>{a.current=!0;const t=-(r.length-1)*u.current,{direction:s,last:n,velocity:l,distance:c}=p(e),m=-s,h=i.get();if(n){a.current=!1;const e=bound(h+c*m+l*m*50,t,0);d(-Math.round(e/u.current))}else{const e=h+c*m;o.start({y:rubberbandIfOutOfBounds(e,t,0,50*u.current,.2)})}})(e)},{target:e.mouseWheel?l:void 0,axis:"y",from:()=>[0,i.get()],preventDefault:!0,eventOptions:supportsPassive?{passive:!1}:void 0});let m=null;return React$2.createElement("div",{className:`${classPrefix$u}-column`},React$2.createElement("div",{className:`${classPrefix$u}-item-height-measure`,ref:c}),React$2.createElement(animated.div,{ref:l,style:{translateY:i},className:`${classPrefix$u}-column-wheel`,"aria-hidden":!0},r.map((t,r)=>{var n;const i=e.value===t.value;return i&&(m=r),React$2.createElement("div",{key:null!==(n=t.key)&&void 0!==n?n:t.value,"data-selected":i,className:classNames$1(`${classPrefix$u}-column-item`,{[`${classPrefix$u}-column-item-active`]:i}),onClick:function(){a.current=!1,d(r)},"aria-hidden":!i,"aria-label":i?"active":""},React$2.createElement("div",{className:`${classPrefix$u}-column-item-label`},s(t)))})),function(){if(null===m)return null;const e=r[m],t=m-1,s=m+1,n=r[t],i=r[s];return React$2.createElement("div",{className:`${classPrefix$u}-column-accessible`},React$2.createElement("div",{className:`${classPrefix$u}-column-accessible-current`,role:"button","aria-label":e?`当前选择的是：${e.label}`:"当前未选择"},"-"),React$2.createElement("div",{className:`${classPrefix$u}-column-accessible-button`,onClick:()=>{n&&d(t)},role:n?"button":"text","aria-label":n?`选择上一项：${n.label}`:"没有上一项"},"-"),React$2.createElement("div",{className:`${classPrefix$u}-column-accessible-button`,onClick:()=>{i&&d(s)},role:i?"button":"text","aria-label":i?`选择下一项：${i.label}`:"没有下一项"},"-"))}())},(e,t)=>e.index===t.index&&(e.value===t.value&&(e.onSelect===t.onSelect&&(e.renderLabel===t.renderLabel&&(e.mouseWheel===t.mouseWheel&&!!isEqual$1(e.column,t.column))))));function withCache(e){let t=null;return()=>(null===t&&(t=e()),t)}function generateColumnsExtend(e,t){const r=withCache(()=>("function"==typeof e?e(t):e).map(e=>e.map(e=>"string"==typeof e?{label:e,value:e}:e))),s=withCache(()=>t.map((e,t)=>{var s;const n=r()[t];return n&&null!==(s=n.find(t=>t.value===e))&&void 0!==s?s:null}));return{get columns(){return r()},get items(){return s()}}}function useColumnsExtend(e,t){return reactExports.useMemo(()=>generateColumnsExtend(e,t),[e,t])}Wheel.displayName="Wheel";const defaultRenderLabel=e=>e.label;var shim$1={exports:{}},useSyncExternalStoreShim_production={},React$1=reactExports;function is(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var objectIs="function"==typeof Object.is?Object.is:is,useState=React$1.useState,useEffect=React$1.useEffect,useLayoutEffect=React$1.useLayoutEffect,useDebugValue=React$1.useDebugValue;function useSyncExternalStore$2(e,t){var r=t(),s=useState({inst:{value:r,getSnapshot:t}}),n=s[0].inst,i=s[1];return useLayoutEffect(function(){n.value=r,n.getSnapshot=t,checkIfSnapshotChanged(n)&&i({inst:n})},[e,r,t]),useEffect(function(){return checkIfSnapshotChanged(n)&&i({inst:n}),e(function(){checkIfSnapshotChanged(n)&&i({inst:n})})},[e]),useDebugValue(r),r}function checkIfSnapshotChanged(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!objectIs(e,r)}catch(s){return!0}}function useSyncExternalStore$1(e,t){return t()}var shim="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=void 0!==React$1.useSyncExternalStore?React$1.useSyncExternalStore:shim,shim$1.exports=useSyncExternalStoreShim_production;var shimExports=shim$1.exports;let reduced=!1;const subscribers=new Set;function isMotionReduced(){return reduced}function subscribe(e){return subscribers.add(e),()=>{subscribers.delete(e)}}function useMotionReduced(){return shimExports.useSyncExternalStore(subscribe,isMotionReduced,isMotionReduced)}const classPrefix$t="adm-spin-loading",colorRecord$1={default:"var(--adm-color-weak)",primary:"var(--adm-color-primary)",white:"var(--adm-color-white)"},defaultProps$q={color:"default"},circumference=94.2477796076937,SpinLoading=reactExports.memo(e=>{var t;const r=mergeProps(defaultProps$q,e),s=useMotionReduced(),{percent:n}=useSpring({cancel:s,loop:{reverse:!0},from:{percent:80},to:{percent:30},config:{duration:1200}});return withNativeProps(r,React$2.createElement(animated.div,{className:classPrefix$t,style:{"--color":null!==(t=colorRecord$1[r.color])&&void 0!==t?t:r.color,"--percent":n}},React$2.createElement("svg",{className:`${classPrefix$t}-svg`,viewBox:"0 0 32 32"},React$2.createElement(animated.circle,{className:`${classPrefix$t}-fill`,fill:"transparent",strokeWidth:"2",strokeDasharray:circumference,strokeDashoffset:n,strokeLinecap:"square",r:15,cx:16,cy:16}))))}),classPrefix$s="adm-picker-view",defaultProps$p={defaultValue:[],renderLabel:defaultRenderLabel,mouseWheel:!1,loadingContent:React$2.createElement("div",{className:`${classPrefix$s}-loading-content`},React$2.createElement(SpinLoading,null))},PickerView=reactExports.memo(e=>{const t=mergeProps(defaultProps$p,e),[r,s]=reactExports.useState(void 0===t.value?t.defaultValue:t.value);reactExports.useEffect(()=>{void 0!==t.value&&t.value!==r&&s(t.value)},[t.value]),reactExports.useEffect(()=>{if(t.value===r)return;const e=window.setTimeout(()=>{void 0!==t.value&&t.value!==r&&s(t.value)},1e3);return()=>{window.clearTimeout(e)}},[t.value,r]);const n=useColumnsExtend(t.columns,r),i=n.columns;useDebounceEffect(()=>{var e;t.value!==r&&(null===(e=t.onChange)||void 0===e||e.call(t,r,n))},[r],{wait:0,leading:!1,trailing:!0});const o=reactExports.useCallback((e,t)=>{s(r=>{const s=[...r];return s[t]=e,s})},[]);return withNativeProps(t,React$2.createElement("div",{className:`${classPrefix$s}`},t.loading?t.loadingContent:React$2.createElement(React$2.Fragment,null,i.map((e,s)=>React$2.createElement(Wheel,{key:s,index:s,column:e,value:r[s],onSelect:o,renderLabel:t.renderLabel,mouseWheel:t.mouseWheel})),React$2.createElement("div",{className:`${classPrefix$s}-mask`},React$2.createElement("div",{className:`${classPrefix$s}-mask-top`}),React$2.createElement("div",{className:`${classPrefix$s}-mask-middle`}),React$2.createElement("div",{className:`${classPrefix$s}-mask-bottom`})))))});PickerView.displayName="PickerView";const classPrefix$r="adm-picker",defaultProps$o={defaultValue:[],closeOnMaskClick:!0,renderLabel:defaultRenderLabel,destroyOnClose:!1,forceRender:!1},Picker$1=reactExports.memo(reactExports.forwardRef((e,t)=>{var r;const{locale:s}=useConfig(),n=mergeProps(defaultProps$o,{confirmText:s.common.confirm,cancelText:s.common.cancel},e),[i,o]=usePropsValue({value:n.visible,defaultValue:!1,onChange:e=>{var t;!1===e&&(null===(t=n.onClose)||void 0===t||t.call(n))}}),a={toggle:()=>{o(e=>!e)},open:()=>{o(!0)},close:()=>{o(!1)}};reactExports.useImperativeHandle(t,()=>a);const[l,c]=usePropsValue(Object.assign(Object.assign({},n),{onChange:e=>{var t;const r=generateColumnsExtend(n.columns,e);null===(t=n.onConfirm)||void 0===t||t.call(n,e,r)}})),u=useColumnsExtend(n.columns,l),[d,p]=reactExports.useState(l);reactExports.useEffect(()=>{d!==l&&p(l)},[i]),reactExports.useEffect(()=>{i||p(l)},[l]);const m=useMemoizedFn((e,t)=>{var r;p(e),i&&(null===(r=n.onSelect)||void 0===r||r.call(n,e,t))}),h=withNativeProps(n,React$2.createElement("div",{className:classPrefix$r},React$2.createElement("div",{className:`${classPrefix$r}-header`},React$2.createElement("a",{role:"button",className:`${classPrefix$r}-header-button`,onClick:()=>{var e;null===(e=n.onCancel)||void 0===e||e.call(n),o(!1)}},n.cancelText),React$2.createElement("div",{className:`${classPrefix$r}-header-title`},n.title),React$2.createElement("a",{role:"button",className:classNames$1(`${classPrefix$r}-header-button`,n.loading&&`${classPrefix$r}-header-button-disabled`),onClick:()=>{n.loading||(c(d,!0),o(!1))},"aria-disabled":n.loading},n.confirmText)),React$2.createElement("div",{className:`${classPrefix$r}-body`},React$2.createElement(PickerView,{loading:n.loading,loadingContent:n.loadingContent,columns:n.columns,renderLabel:n.renderLabel,value:d,mouseWheel:n.mouseWheel,onChange:m})))),x=React$2.createElement(Popup,{style:n.popupStyle,className:classNames$1(`${classPrefix$r}-popup`,n.popupClassName),visible:i,position:"bottom",onMaskClick:()=>{var e;n.closeOnMaskClick&&(null===(e=n.onCancel)||void 0===e||e.call(n),o(!1))},getContainer:n.getContainer,destroyOnClose:n.destroyOnClose,afterShow:n.afterShow,afterClose:n.afterClose,onClick:n.onClick,forceRender:n.forceRender,stopPropagation:n.stopPropagation},h,React$2.createElement(SafeArea,{position:"bottom"}));return React$2.createElement(React$2.Fragment,null,x,null===(r=n.children)||void 0===r?void 0:r.call(n,u.items,a))}));function prompt$2(e){return new Promise(t=>{const r=renderToBody(React$2.createElement(()=>{const[s,n]=reactExports.useState(!1);return reactExports.useEffect(()=>{n(!0)},[]),React$2.createElement(Picker$1,Object.assign({},e,{visible:s,onConfirm:(r,s)=>{var n;null===(n=e.onConfirm)||void 0===n||n.call(e,r,s),t(r)},onClose:()=>{var r;null===(r=e.onClose)||void 0===r||r.call(e),n(!1),t(null)},afterClose:()=>{var t;null===(t=e.afterClose)||void 0===t||t.call(e),r()}}))},null))})}Picker$1.displayName="Picker";const Picker=attachPropertiesToComponent(Picker$1,{prompt:prompt$2});function useColumnsFn(e){const t=reactExports.useMemo(()=>{let t=0;return function e(r,s){s>t&&(t=s);const n=s+1;r.forEach(t=>{t.children&&e(t.children,n)})}(e,1),t},[e]);return r=>{const s=[];let n=e,i=0;for(;;){s.push(n.map(e=>({label:e.label,value:e.value})));const e=r[i],t=n.find(t=>t.value===e);if(!t||!t.children)break;n=t.children,i++}for(;i<t-1;)s.push([]),i++;return s}}const CascadePicker$1=reactExports.forwardRef((e,t)=>{const{options:r}=e,s=__rest$1(e,["options"]),n=useColumnsFn(r);return React$2.createElement(Picker,Object.assign({},s,{ref:t,columns:n}))});function prompt$1(e){return new Promise(t=>{const r=renderToBody(React$2.createElement(()=>{const[s,n]=reactExports.useState(!1);return reactExports.useEffect(()=>{n(!0)},[]),React$2.createElement(CascadePicker$1,Object.assign({},e,{visible:s,onConfirm:(r,s)=>{var n;null===(n=e.onConfirm)||void 0===n||n.call(e,r,s),t(r)},onClose:()=>{var r;null===(r=e.onClose)||void 0===r||r.call(e),n(!1),t(null)},afterClose:()=>{var t;null===(t=e.afterClose)||void 0===t||t.call(e),r()}}))},null))})}const CascadePicker=attachPropertiesToComponent(CascadePicker$1,{prompt:prompt$1}),classPrefix$q="adm-list",defaultProps$n={mode:"default"},List$2=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$n,e),s=reactExports.useRef(null);return reactExports.useImperativeHandle(t,()=>({get nativeElement(){return s.current}})),withNativeProps(r,React$2.createElement("div",{className:classNames$1(classPrefix$q,`${classPrefix$q}-${r.mode}`),ref:s},r.header&&React$2.createElement("div",{className:`${classPrefix$q}-header`},r.header),React$2.createElement("div",{className:`${classPrefix$q}-body`},React$2.createElement("div",{className:`${classPrefix$q}-body-inner`},r.children))))});function isNodeWithContent(e){return null!=e&&!1!==e}const classPrefix$p="adm-list-item",ListItem=e=>{var t,r;const{arrow:s,arrowIcon:n}=e,{list:i={}}=useConfig(),o=null!==(t=e.clickable)&&void 0!==t?t:!!e.onClick,a=null!==(r=null!=s?s:n)&&void 0!==r?r:o,l=mergeProp(i.arrowIcon,!0!==s?s:null,!0!==n?n:null),c=React$2.createElement("div",{className:`${classPrefix$p}-content`},isNodeWithContent(e.prefix)&&React$2.createElement("div",{className:`${classPrefix$p}-content-prefix`},e.prefix),React$2.createElement("div",{className:`${classPrefix$p}-content-main`},isNodeWithContent(e.title)&&React$2.createElement("div",{className:`${classPrefix$p}-title`},e.title),e.children,isNodeWithContent(e.description)&&React$2.createElement("div",{className:`${classPrefix$p}-description`},e.description)),isNodeWithContent(e.extra)&&React$2.createElement("div",{className:`${classPrefix$p}-content-extra`},e.extra),a&&React$2.createElement("div",{className:`${classPrefix$p}-content-arrow`},l||React$2.createElement(RightOutline,null)));return withNativeProps(e,React$2.createElement(o?"a":"div",{className:classNames$1(`${classPrefix$p}`,o?["adm-plain-anchor"]:[],e.disabled&&`${classPrefix$p}-disabled`),onClick:e.disabled?void 0:e.onClick},c))},List$1=attachPropertiesToComponent(List$2,{Item:ListItem}),useFieldNames=(e={})=>reactExports.useMemo(()=>{const{label:t="label",value:r="value",disabled:s="disabled",children:n="children"}=e;return[t,r,n,s]},[JSON.stringify(e)]),classPrefix$o="adm-center-popup",defaultProps$m=Object.assign(Object.assign({},defaultPopupBaseProps),{getContainer:null}),CenterPopup=e=>{const{popup:t={}}=useConfig(),r=mergeProps(defaultProps$m,t,e),s=useUnmountedRef(),n=useSpring({scale:r.visible?1:.8,opacity:r.visible?1:0,config:{mass:1.2,tension:200,friction:25,clamp:!0},onRest:()=>{var e,t;s.current||(o(r.visible),r.visible?null===(e=r.afterShow)||void 0===e||e.call(r):null===(t=r.afterClose)||void 0===t||t.call(r))}}),[i,o]=reactExports.useState(r.visible);useIsomorphicLayoutEffect$1(()=>{r.visible&&o(!0)},[r.visible]);const a=reactExports.useRef(null);useLockScroll(a,r.disableBodyScroll&&i);const l=useInnerVisible(i&&r.visible),c=React$2.createElement("div",{className:classNames$1(`${classPrefix$o}-body`,r.bodyClassName),style:r.bodyStyle},r.children),u=withStopPropagation(r.stopPropagation,withNativeProps(r,React$2.createElement("div",{className:classPrefix$o,style:{display:i?void 0:"none",pointerEvents:i?void 0:"none"}},r.mask&&React$2.createElement(Mask,{visible:l,forceRender:r.forceRender,destroyOnClose:r.destroyOnClose,onMaskClick:e=>{var t,s;null===(t=r.onMaskClick)||void 0===t||t.call(r,e),r.closeOnMaskClick&&(null===(s=r.onClose)||void 0===s||s.call(r))},style:r.maskStyle,className:classNames$1(`${classPrefix$o}-mask`,r.maskClassName),disableBodyScroll:!1,stopPropagation:r.stopPropagation}),React$2.createElement("div",{className:`${classPrefix$o}-wrap`,role:r.role,"aria-label":r["aria-label"]},React$2.createElement(animated.div,{style:Object.assign(Object.assign({},n),{pointerEvents:n.opacity.to(e=>1===e?"unset":"none")}),ref:a},r.showCloseButton&&React$2.createElement("a",{className:classNames$1(`${classPrefix$o}-close`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=r.onClose)||void 0===e||e.call(r)}},r.closeIcon),c)))));return React$2.createElement(ShouldRender,{active:i,forceRender:r.forceRender,destroyOnClose:r.destroyOnClose},renderToContainer(r.getContainer,u))};var isoWeeksInYear$1={exports:{}};isoWeeksInYear$1.exports=function(e,t){t.prototype.isoWeeksInYear=function(){var e=this.isLeapYear(),t=this.endOf("y").day();return 4===t||e&&5===t?53:52}};var isoWeeksInYearExports=isoWeeksInYear$1.exports;const isoWeeksInYear=getDefaultExportFromCjs(isoWeeksInYearExports);var isLeapYear$1={exports:{}};isLeapYear$1.exports=function(e,t){t.prototype.isLeapYear=function(){return this.$y%4==0&&this.$y%100!=0||this.$y%400==0}};var isLeapYearExports=isLeapYear$1.exports;const isLeapYear=getDefaultExportFromCjs(isLeapYearExports),TILL_NOW="TILL_NOW";dayjs.extend(isoWeek),dayjs.extend(isoWeeksInYear),dayjs.extend(isLeapYear);const precisionRankRecord$2={year:0,month:1,day:2,hour:3,minute:4,second:5};function generateDatePickerColumns$3(e,t,r,s,n,i,o){const a=[],l=t.getFullYear(),c=t.getMonth()+1,u=t.getDate(),d=t.getHours(),p=t.getMinutes(),m=t.getSeconds(),h=r.getFullYear(),x=r.getMonth()+1,f=r.getDate(),g=r.getHours(),y=r.getMinutes(),v=r.getSeconds(),E=precisionRankRecord$2[s],j=parseInt(e[0]),b=dayjs(convertStringArrayToDate$3([e[0],e[1],"1"])),w=parseInt(e[1]),R=parseInt(e[2]),_=parseInt(e[3]),S=parseInt(e[4]),C=j===l,k=j===h,$=C&&w===c,T=k&&w===x,I=$&&R===u,P=T&&R===f,A=I&&_===d,F=P&&_===g,M=A&&S===p,D=F&&S===y,O=(t,r,s)=>{let n=[];for(let e=t;e<=r;e++)n.push(e);const o=e.slice(0,precisionRankRecord$2[s]),a=null==i?void 0:i[s];return a&&"function"==typeof a&&(n=n.filter(e=>a(e,{get date(){return convertStringArrayToDate$3([...o,e.toString()])}}))),n};if(E>=precisionRankRecord$2.year){const e=O(l,h,"year");a.push(e.map(e=>({label:n("year",e),value:e.toString()})))}if(E>=precisionRankRecord$2.month){const e=O(C?c:1,k?x:12,"month");a.push(e.map(e=>({label:n("month",e),value:e.toString()})))}if(E>=precisionRankRecord$2.day){const e=O($?u:1,T?f:b.daysInMonth(),"day");a.push(e.map(e=>({label:n("day",e),value:e.toString()})))}if(E>=precisionRankRecord$2.hour){const e=O(I?d:0,P?g:23,"hour");a.push(e.map(e=>({label:n("hour",e),value:e.toString()})))}if(E>=precisionRankRecord$2.minute){const e=O(A?p:0,F?y:59,"minute");a.push(e.map(e=>({label:n("minute",e),value:e.toString()})))}if(E>=precisionRankRecord$2.second){const e=O(M?m:0,D?v:59,"second");a.push(e.map(e=>({label:n("second",e),value:e.toString()})))}if(o&&(a[0].push({label:n("now",null),value:TILL_NOW}),TILL_NOW===(null==e?void 0:e[0])))for(let N=1;N<a.length;N+=1)a[N]=[];return a}function convertDateToStringArray$3(e){return e?[e.getFullYear().toString(),(e.getMonth()+1).toString(),e.getDate().toString(),e.getHours().toString(),e.getMinutes().toString(),e.getSeconds().toString()]:[]}function convertStringArrayToDate$3(e){var t,r,s,n,i,o;const a=null!==(t=e[0])&&void 0!==t?t:"1900",l=null!==(r=e[1])&&void 0!==r?r:"1",c=null!==(s=e[2])&&void 0!==s?s:"1",u=null!==(n=e[3])&&void 0!==n?n:"0",d=null!==(i=e[4])&&void 0!==i?i:"0",p=null!==(o=e[5])&&void 0!==o?o:"0";return new Date(parseInt(a),parseInt(l)-1,parseInt(c),parseInt(u),parseInt(d),parseInt(p))}var quarterOfYear$1={exports:{}};quarterOfYear$1.exports=function(){var e="month",t="quarter";return function(r,s){var n=s.prototype;n.quarter=function(e){return this.$utils().u(e)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(e-1))};var i=n.add;n.add=function(r,s){return r=Number(r),this.$utils().p(s)===t?this.add(3*r,e):i.bind(this)(r,s)};var o=n.startOf;n.startOf=function(r,s){var n=this.$utils(),i=!!n.u(s)||s;if(n.p(r)===t){var a=this.quarter()-1;return i?this.month(3*a).startOf(e).startOf("day"):this.month(3*a+2).endOf(e).endOf("day")}return o.bind(this)(r,s)}}}();var quarterOfYearExports=quarterOfYear$1.exports;const quarterOfYear=getDefaultExportFromCjs(quarterOfYearExports);dayjs.extend(quarterOfYear);const precisionRankRecord$1={year:0,quarter:1};function generateDatePickerColumns$2(e,t,r,s,n,i){const o=[],a=t.getFullYear(),l=r.getFullYear(),c=precisionRankRecord$1[s],u=parseInt(e[0]),d=u===a,p=u===l,m=dayjs(t),h=dayjs(r),x=m.quarter(),f=h.quarter(),g=(t,r,s)=>{let n=[];for(let e=t;e<=r;e++)n.push(e);const o=e.slice(0,precisionRankRecord$1[s]),a=null==i?void 0:i[s];return a&&"function"==typeof a&&(n=n.filter(e=>a(e,{get date(){return convertStringArrayToDate$2([...o,e.toString()])}}))),n};if(c>=precisionRankRecord$1.year){const e=g(a,l,"year");o.push(e.map(e=>({label:n("year",e),value:e.toString()})))}if(c>=precisionRankRecord$1.quarter){const e=g(d?x:1,p?f:4,"quarter");o.push(e.map(e=>({label:n("quarter",e),value:e.toString()})))}return o}function convertDateToStringArray$2(e){if(!e)return[];const t=dayjs(e);return[t.year().toString(),t.quarter().toString()]}function convertStringArrayToDate$2(e){var t,r;const s=null!==(t=e[0])&&void 0!==t?t:"1900",n=null!==(r=e[1])&&void 0!==r?r:"1";return dayjs().year(parseInt(s)).quarter(parseInt(n)).hour(0).minute(0).second(0).toDate()}dayjs.extend(isoWeek),dayjs.extend(isoWeeksInYear),dayjs.extend(isLeapYear);const precisionRankRecord={year:0,week:1,"week-day":2};function generateDatePickerColumns$1(e,t,r,s,n,i){const o=[],a=t.getFullYear(),l=r.getFullYear(),c=precisionRankRecord[s],u=parseInt(e[0]),d=u===a,p=u===l,m=dayjs(t),h=dayjs(r),x=m.isoWeek(),f=h.isoWeek(),g=m.isoWeekday(),y=h.isoWeekday(),v=parseInt(e[1]),E=d&&v===x,j=p&&v===f,b=dayjs(`${u}-01-01`).isoWeeksInYear(),w=(t,r,s)=>{let n=[];for(let e=t;e<=r;e++)n.push(e);const o=e.slice(0,precisionRankRecord[s]),a=null==i?void 0:i[s];return a&&"function"==typeof a&&(n=n.filter(e=>a(e,{get date(){return convertStringArrayToDate$1([...o,e.toString()])}}))),n};if(c>=precisionRankRecord.year){const e=w(a,l,"year");o.push(e.map(e=>({label:n("year",e),value:e.toString()})))}if(c>=precisionRankRecord.week){const e=w(d?x:1,p?f:b,"week");o.push(e.map(e=>({label:n("week",e),value:e.toString()})))}if(c>=precisionRankRecord["week-day"]){const e=w(E?g:1,j?y:7,"week-day");o.push(e.map(e=>({label:n("week-day",e),value:e.toString()})))}return o}function convertDateToStringArray$1(e){if(!e)return[];const t=dayjs(e);return[t.isoWeekYear().toString(),t.isoWeek().toString(),t.isoWeekday().toString()]}function convertStringArrayToDate$1(e){var t,r,s;const n=null!==(t=e[0])&&void 0!==t?t:"1900",i=null!==(r=e[1])&&void 0!==r?r:"1",o=null!==(s=e[2])&&void 0!==s?s:"1";return dayjs(`${parseInt(n)}-01-01`).isoWeek(parseInt(i)).isoWeekday(parseInt(o)).hour(0).minute(0).second(0).toDate()}const precisionLengthRecord={year:1,month:2,day:3,hour:4,minute:5,second:6},convertDateToStringArray=(e,t)=>{if(t.includes("week"))return convertDateToStringArray$1(e);if(t.includes("quarter"))return convertDateToStringArray$2(e);{const r=t;return convertDateToStringArray$3(e).slice(0,precisionLengthRecord[r])}},convertStringArrayToDate=(e,t)=>{if((null==e?void 0:e[0])===TILL_NOW){const e=new Date;return e.tillNow=!0,e}return t.includes("week")?convertStringArrayToDate$1(e):t.includes("quarter")?convertStringArrayToDate$2(e):convertStringArrayToDate$3(e)},generateDatePickerColumns=(e,t,r,s,n,i,o)=>s.startsWith("week")?generateDatePickerColumns$1(e,t,r,s,n,i):s.startsWith("quarter")?generateDatePickerColumns$2(e,t,r,s,n,i):generateDatePickerColumns$3(e,t,r,s,n,i,o);function useRenderLabel(e){const{locale:t}=useConfig();return reactExports.useCallback((r,s)=>{if(e)return e(r,s);switch(r){case"minute":case"second":case"hour":return("0"+s.toString()).slice(-2);case"now":return t.DatePicker.tillNow;default:return s.toString()}},[e])}const thisYear=(new Date).getFullYear(),defaultProps$l={min:new Date((new Date).setFullYear(thisYear-10)),max:new Date((new Date).setFullYear(thisYear+10)),precision:"day",defaultValue:null},DatePicker$1=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$l,e),{renderLabel:s}=r,[n,i]=usePropsValue({value:r.value,defaultValue:r.defaultValue,onChange:e=>{var t;null!==e&&(null===(t=r.onConfirm)||void 0===t||t.call(r,e))}}),o=reactExports.useMemo(()=>new Date,[]),a=useRenderLabel(s),l=reactExports.useMemo(()=>{let e=null!=n?n:o;return e.tillNow?[TILL_NOW]:(e=new Date(bound(e.getTime(),r.min.getTime(),r.max.getTime())),convertDateToStringArray(e,r.precision))},[n,r.precision,r.min,r.max]),c=reactExports.useCallback(e=>{const t=convertStringArrayToDate(e,r.precision);i(t,!0)},[i,r.precision]),u=useMemoizedFn(e=>{var t;const s=convertStringArrayToDate(e,r.precision);null===(t=r.onSelect)||void 0===t||t.call(r,s)}),d=reactExports.useCallback(e=>generateDatePickerColumns(e,r.min,r.max,r.precision,a,r.filter,r.tillNow),[r.min,r.max,r.precision,a,r.tillNow]);return withNativeProps(r,React$2.createElement(Picker,{ref:t,columns:d,value:l,onCancel:r.onCancel,onClose:r.onClose,closeOnMaskClick:r.closeOnMaskClick,visible:r.visible,confirmText:r.confirmText,cancelText:r.cancelText,onConfirm:c,onSelect:u,getContainer:r.getContainer,loading:r.loading,loadingContent:r.loadingContent,afterShow:r.afterShow,afterClose:r.afterClose,onClick:r.onClick,title:r.title,stopPropagation:r.stopPropagation,mouseWheel:r.mouseWheel,destroyOnClose:r.destroyOnClose,forceRender:r.forceRender},(e,t)=>{var s;return null===(s=r.children)||void 0===s?void 0:s.call(r,n,t)}))});function prompt(e){return new Promise(t=>{const r=renderToBody(React$2.createElement(()=>{const[s,n]=reactExports.useState(!1);return reactExports.useEffect(()=>{n(!0)},[]),React$2.createElement(DatePicker$1,Object.assign({},e,{visible:s,onConfirm:r=>{var s;null===(s=e.onConfirm)||void 0===s||s.call(e,r),t(r)},onClose:()=>{var r;null===(r=e.onClose)||void 0===r||r.call(e),n(!1),t(null)},afterClose:()=>{var t;null===(t=e.afterClose)||void 0===t||t.call(e),r()}}))},null))})}const DatePicker=attachPropertiesToComponent(DatePicker$1,{prompt:prompt,DATE_NOW:TILL_NOW}),DialogActionButton=e=>{const{action:t}=e;return withNativeProps(e.action,React$2.createElement(Button,{key:t.key,onClick:e.onAction,className:classNames$1("adm-dialog-button",{"adm-dialog-button-bold":t.bold}),fill:"none",shape:"rectangular",block:!0,color:t.danger?"danger":"primary",loading:"auto",disabled:t.disabled},t.text))},defaultProps$k={actions:[],closeOnAction:!1,closeOnMaskClick:!1,getContainer:null},Dialog$1=e=>{const t=mergeProps(defaultProps$k,e),r=React$2.createElement(React$2.Fragment,null,!!t.image&&React$2.createElement("div",{className:cls$1("image-container")},React$2.createElement(Image$1,{src:t.image,alt:"dialog header image",width:"100%"})),!!t.header&&React$2.createElement("div",{className:cls$1("header")},React$2.createElement(AutoCenter,null,t.header)),!!t.title&&React$2.createElement("div",{className:cls$1("title")},t.title),React$2.createElement("div",{className:classNames$1(cls$1("content"),!t.content&&cls$1("content-empty"))},"string"==typeof t.content?React$2.createElement(AutoCenter,null,t.content):t.content),React$2.createElement("div",{className:cls$1("footer")},t.actions.map((e,r)=>{const s=Array.isArray(e)?e:[e];return React$2.createElement("div",{className:cls$1("action-row"),key:r},s.map((e,r)=>React$2.createElement(DialogActionButton,{key:e.key,action:e,onAction:()=>__awaiter$1(void 0,void 0,void 0,function*(){var s,n,i;yield Promise.all([null===(s=e.onClick)||void 0===s?void 0:s.call(e),null===(n=t.onAction)||void 0===n?void 0:n.call(t,e,r)]),t.closeOnAction&&(null===(i=t.onClose)||void 0===i||i.call(t))})})))})));return React$2.createElement(CenterPopup,{className:classNames$1(cls$1(),t.className),style:t.style,afterClose:t.afterClose,afterShow:t.afterShow,onMaskClick:t.closeOnMaskClick?()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)}:void 0,visible:t.visible,getContainer:t.getContainer,bodyStyle:t.bodyStyle,bodyClassName:classNames$1(cls$1("body"),t.image&&cls$1("with-image"),t.bodyClassName),maskStyle:t.maskStyle,maskClassName:t.maskClassName,stopPropagation:t.stopPropagation,disableBodyScroll:t.disableBodyScroll,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender,role:"dialog","aria-label":t["aria-label"]},r)};function cls$1(e=""){return"adm-dialog"+(e&&"-")+e}const closeFnSet$1=new Set;function show$2(e){const t=renderImperatively(React$2.createElement(Dialog$1,Object.assign({},e,{afterClose:()=>{var r;closeFnSet$1.delete(t.close),null===(r=e.afterClose)||void 0===r||r.call(e)}})));return closeFnSet$1.add(t.close),t}function alert$2(e){const t=mergeProps({confirmText:getDefaultConfig().locale.Dialog.ok},e);return new Promise(e=>{show$2(Object.assign(Object.assign({},t),{closeOnAction:!0,actions:[{key:"confirm",text:t.confirmText}],onAction:t.onConfirm,onClose:()=>{var r;null===(r=t.onClose)||void 0===r||r.call(t),e()}}))})}const defaultProps$j={confirmText:"确认",cancelText:"取消"};function confirm$1(e){const{locale:t}=getDefaultConfig(),r=mergeProps(defaultProps$j,{confirmText:t.common.confirm,cancelText:t.common.cancel},e);return new Promise(e=>{show$2(Object.assign(Object.assign({},r),{closeOnAction:!0,onClose:()=>{var t;null===(t=r.onClose)||void 0===t||t.call(r),e(!1)},actions:[[{key:"cancel",text:r.cancelText,onClick:()=>__awaiter$1(this,void 0,void 0,function*(){var t;yield null===(t=r.onCancel)||void 0===t?void 0:t.call(r),e(!1)})},{key:"confirm",text:r.confirmText,bold:!0,onClick:()=>__awaiter$1(this,void 0,void 0,function*(){var t;yield null===(t=r.onConfirm)||void 0===t?void 0:t.call(r),e(!0)})}]]}))})}function clear$2(){closeFnSet$1.forEach(e=>{e()})}const Dialog=attachPropertiesToComponent(Dialog$1,{show:show$2,alert:alert$2,confirm:confirm$1,clear:clear$2});var i;!function(e){e[e.HIGH_SURROGATE_START=55296]="HIGH_SURROGATE_START",e[e.HIGH_SURROGATE_END=56319]="HIGH_SURROGATE_END",e[e.LOW_SURROGATE_START=56320]="LOW_SURROGATE_START",e[e.REGIONAL_INDICATOR_START=127462]="REGIONAL_INDICATOR_START",e[e.REGIONAL_INDICATOR_END=127487]="REGIONAL_INDICATOR_END",e[e.FITZPATRICK_MODIFIER_START=127995]="FITZPATRICK_MODIFIER_START",e[e.FITZPATRICK_MODIFIER_END=127999]="FITZPATRICK_MODIFIER_END",e[e.VARIATION_MODIFIER_START=65024]="VARIATION_MODIFIER_START",e[e.VARIATION_MODIFIER_END=65039]="VARIATION_MODIFIER_END",e[e.DIACRITICAL_MARKS_START=8400]="DIACRITICAL_MARKS_START",e[e.DIACRITICAL_MARKS_END=8447]="DIACRITICAL_MARKS_END",e[e.SUBDIVISION_INDICATOR_START=127988]="SUBDIVISION_INDICATOR_START",e[e.TAGS_START=917504]="TAGS_START",e[e.TAGS_END=917631]="TAGS_END",e[e.ZWJ=8205]="ZWJ"}(i||(i={}));const e=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);var n;function runes(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");const t=[];let r=0,s=0;for(;r<e.length;)s+=nextUnits(r+s,e),isGrapheme(e[r+s])&&s++,isVariationSelector(e[r+s])&&s++,isDiacriticalMark(e[r+s])&&s++,isZeroWidthJoiner(e[r+s])?s++:(t.push(e.substring(r,r+s)),r+=s,s=0);return t}function nextUnits(e,t){const r=t[e];if(!isFirstOfSurrogatePair(r)||e===t.length-1)return 1;const s=r+t[e+1];let n=t.substring(e+2,e+5);return isRegionalIndicator(s)&&isRegionalIndicator(n)?4:isSubdivisionFlag(s)&&isSupplementarySpecialpurposePlane(n)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:isFitzpatrickModifier(n)?4:2}function isFirstOfSurrogatePair(e){return e&&betweenInclusive(e[0].charCodeAt(0),55296,56319)}function isRegionalIndicator(e){return betweenInclusive(codePointFromSurrogatePair(e),127462,127487)}function isSubdivisionFlag(e){return betweenInclusive(codePointFromSurrogatePair(e),127988,127988)}function isFitzpatrickModifier(e){return betweenInclusive(codePointFromSurrogatePair(e),127995,127999)}function isVariationSelector(e){return"string"==typeof e&&betweenInclusive(e.charCodeAt(0),65024,65039)}function isDiacriticalMark(e){return"string"==typeof e&&betweenInclusive(e.charCodeAt(0),8400,8447)}function isSupplementarySpecialpurposePlane(e){const t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&betweenInclusive(t,917504,917631)}function isGrapheme(t){return"string"==typeof t&&e.includes(t.charCodeAt(0))}function isZeroWidthJoiner(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function codePointFromSurrogatePair(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function betweenInclusive(e,t,r){return e>=t&&e<=r}!function(e){e[e.unit_1=1]="unit_1",e[e.unit_2=2]="unit_2",e[e.unit_4=4]="unit_4"}(n||(n={}));const EmptyIcon=e=>withNativeProps(e,React$2.createElement("svg",{viewBox:"0 0 64 41"},React$2.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},React$2.createElement("ellipse",{fill:"#f5f5f5",cx:"32",cy:"33",rx:"32",ry:"7"}),React$2.createElement("g",{stroke:"#d9d9d9"},React$2.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),React$2.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:"#fafafa"}))))),classPrefix$n="adm-empty",Empty=e=>withNativeProps(e,React$2.createElement("div",{className:classPrefix$n},React$2.createElement("div",{className:`${classPrefix$n}-image-container`},function(){const{image:t}=e;return void 0===t?React$2.createElement(EmptyIcon,{className:`${classPrefix$n}-image`,style:e.imageStyle}):"string"==typeof t?React$2.createElement("img",{className:`${classPrefix$n}-image`,style:e.imageStyle,src:t,alt:"empty"}):t}()),e.description&&React$2.createElement("div",{className:classNames$1(`${classPrefix$n}-description`)},e.description)));var HOOK_MARK="RC_FORM_INTERNAL_HOOKS",warningFunc$1=function(){warningOnce$2(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},Context$1=reactExports.createContext({getFieldValue:warningFunc$1,getFieldsValue:warningFunc$1,getFieldError:warningFunc$1,getFieldWarning:warningFunc$1,getFieldsError:warningFunc$1,isFieldsTouched:warningFunc$1,isFieldTouched:warningFunc$1,isFieldValidating:warningFunc$1,isFieldsValidating:warningFunc$1,resetFields:warningFunc$1,setFields:warningFunc$1,setFieldValue:warningFunc$1,setFieldsValue:warningFunc$1,validateFields:warningFunc$1,submit:warningFunc$1,getInternalHooks:function(){return warningFunc$1(),{dispatch:warningFunc$1,initEntityValue:warningFunc$1,registerField:warningFunc$1,useSubscribe:warningFunc$1,setInitialValues:warningFunc$1,destroyForm:warningFunc$1,setCallbacks:warningFunc$1,registerWatch:warningFunc$1,getFields:warningFunc$1,setValidateMessages:warningFunc$1,setPreserve:warningFunc$1,getInitialValue:warningFunc$1}}}),ListContext=reactExports.createContext(null);function toArray$1(e){return null==e?[]:Array.isArray(e)?e:[e]}function isFormInstance(e){return e&&!!e._init}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_extends.apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e2){return!1}}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var s=[null];s.push.apply(s,t);var n=new(Function.bind.apply(e,s));return r&&_setPrototypeOf(n,r.prototype),n}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}var formatRegExp=/%[sdj%]/g,warning$2=function(){};function convertFieldsError(e){if(!e||!e.length)return null;var t={};return e.forEach(function(e){var r=e.field;t[r]=t[r]||[],t[r].push(e)}),t}function format(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];var n=0,i=r.length;return"function"==typeof e?e.apply(null,r):"string"==typeof e?e.replace(formatRegExp,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}break;default:return e}}):e}function isNativeStringType(e){return"string"===e||"url"===e||"hex"===e||"email"===e||"date"===e||"pattern"===e}function isEmptyValue(e,t){return null==e||(!("array"!==t||!Array.isArray(e)||e.length)||!(!isNativeStringType(t)||"string"!=typeof e||e))}function asyncParallelArray(e,t,r){var s=[],n=0,i=e.length;function o(e){s.push.apply(s,e||[]),++n===i&&r(s)}e.forEach(function(e){t(e,o)})}function asyncSerialArray(e,t,r){var s=0,n=e.length;!function i(o){if(o&&o.length)r(o);else{var a=s;s+=1,a<n?t(e[a],i):r([])}}([])}function flattenObjArr(e){var t=[];return Object.keys(e).forEach(function(r){t.push.apply(t,e[r]||[])}),t}var AsyncValidationError=function(e){function t(t,r){var s;return(s=e.call(this,"Async Validation Error")||this).errors=t,s.fields=r,s}return _inheritsLoose(t,e),t}(_wrapNativeSuper(Error));function asyncMap(e,t,r,s,n){if(t.first){var i=new Promise(function(t,i){asyncSerialArray(flattenObjArr(e),r,function(e){return s(e),e.length?i(new AsyncValidationError(e,convertFieldsError(e))):t(n)})});return i.catch(function(e){return e}),i}var o=!0===t.firstFields?Object.keys(e):t.firstFields||[],a=Object.keys(e),l=a.length,c=0,u=[],d=new Promise(function(t,i){var d=function(e){if(u.push.apply(u,e),++c===l)return s(u),u.length?i(new AsyncValidationError(u,convertFieldsError(u))):t(n)};a.length||(s(u),t(n)),a.forEach(function(t){var s=e[t];-1!==o.indexOf(t)?asyncSerialArray(s,r,d):asyncParallelArray(s,r,d)})});return d.catch(function(e){return e}),d}function isErrorObj(e){return!(!e||void 0===e.message)}function getValue(e,t){for(var r=e,s=0;s<t.length;s++){if(null==r)return r;r=r[t[s]]}return r}function complementError(e,t){return function(r){var s;return s=e.fullFields?getValue(t,e.fullFields):t[r.field||e.fullField],isErrorObj(r)?(r.field=r.field||e.fullField,r.fieldValue=s,r):{message:"function"==typeof r?r():r,fieldValue:s,field:r.field||e.fullField}}}function deepMerge(e,t){if(t)for(var r in t)if(t.hasOwnProperty(r)){var s=t[r];"object"==typeof s&&"object"==typeof e[r]?e[r]=_extends({},e[r],s):e[r]=s}return e}var required$1=function(e,t,r,s,n,i){!e.required||r.hasOwnProperty(e.field)&&!isEmptyValue(t,i||e.type)||s.push(format(n.messages.required,e.fullField))},whitespace=function(e,t,r,s,n){(/^\s+$/.test(t)||""===t)&&s.push(format(n.messages.whitespace,e.fullField))},urlReg,getUrlRegex=function(){if(urlReg)return urlReg;var e="[a-fA-F\\d:]",t=function(t){return t&&t.includeBoundaries?"(?:(?<=\\s|^)(?="+e+")|(?<="+e+")(?=\\s|$))":""},r="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",n=("\n(?:\n(?:"+s+":){7}(?:"+s+"|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:"+s+":){6}(?:"+r+"|:"+s+"|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:"+s+":){5}(?::"+r+"|(?::"+s+"){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:"+s+":){4}(?:(?::"+s+"){0,1}:"+r+"|(?::"+s+"){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:"+s+":){3}(?:(?::"+s+"){0,2}:"+r+"|(?::"+s+"){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:"+s+":){2}(?:(?::"+s+"){0,3}:"+r+"|(?::"+s+"){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:"+s+":){1}(?:(?::"+s+"){0,4}:"+r+"|(?::"+s+"){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::"+s+"){0,5}:"+r+"|(?::"+s+"){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),i=new RegExp("(?:^"+r+"$)|(?:^"+n+"$)"),o=new RegExp("^"+r+"$"),a=new RegExp("^"+n+"$"),l=function(e){return e&&e.exact?i:new RegExp("(?:"+t(e)+r+t(e)+")|(?:"+t(e)+n+t(e)+")","g")};l.v4=function(e){return e&&e.exact?o:new RegExp(""+t(e)+r+t(e),"g")},l.v6=function(e){return e&&e.exact?a:new RegExp(""+t(e)+n+t(e),"g")};var c=l.v4().source,u=l.v6().source;return urlReg=new RegExp("(?:^"+("(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|"+c+"|"+u+'|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?')+"$)","i")},pattern$2={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},types={integer:function(e){return types.number(e)&&parseInt(e,10)===e},float:function(e){return types.number(e)&&!types.integer(e)},array:function(e){return Array.isArray(e)},regexp:function(e){if(e instanceof RegExp)return!0;try{return!!new RegExp(e)}catch(e2){return!1}},date:function(e){return"function"==typeof e.getTime&&"function"==typeof e.getMonth&&"function"==typeof e.getYear&&!isNaN(e.getTime())},number:function(e){return!isNaN(e)&&"number"==typeof e},object:function(e){return"object"==typeof e&&!types.array(e)},method:function(e){return"function"==typeof e},email:function(e){return"string"==typeof e&&e.length<=320&&!!e.match(pattern$2.email)},url:function(e){return"string"==typeof e&&e.length<=2048&&!!e.match(getUrlRegex())},hex:function(e){return"string"==typeof e&&!!e.match(pattern$2.hex)}},type$1=function(e,t,r,s,n){if(e.required&&void 0===t)required$1(e,t,r,s,n);else{var i=e.type;["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(i)>-1?types[i](t)||s.push(format(n.messages.types[i],e.fullField,e.type)):i&&typeof t!==e.type&&s.push(format(n.messages.types[i],e.fullField,e.type))}},range=function(e,t,r,s,n){var i="number"==typeof e.len,o="number"==typeof e.min,a="number"==typeof e.max,l=t,c=null,u="number"==typeof t,d="string"==typeof t,p=Array.isArray(t);if(u?c="number":d?c="string":p&&(c="array"),!c)return!1;p&&(l=t.length),d&&(l=t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length),i?l!==e.len&&s.push(format(n.messages[c].len,e.fullField,e.len)):o&&!a&&l<e.min?s.push(format(n.messages[c].min,e.fullField,e.min)):a&&!o&&l>e.max?s.push(format(n.messages[c].max,e.fullField,e.max)):o&&a&&(l<e.min||l>e.max)&&s.push(format(n.messages[c].range,e.fullField,e.min,e.max))},ENUM$1="enum",enumerable$1=function(e,t,r,s,n){e[ENUM$1]=Array.isArray(e[ENUM$1])?e[ENUM$1]:[],-1===e[ENUM$1].indexOf(t)&&s.push(format(n.messages[ENUM$1],e.fullField,e[ENUM$1].join(", ")))},pattern$1=function(e,t,r,s,n){if(e.pattern)if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(t)||s.push(format(n.messages.pattern.mismatch,e.fullField,t,e.pattern));else if("string"==typeof e.pattern){new RegExp(e.pattern).test(t)||s.push(format(n.messages.pattern.mismatch,e.fullField,t,e.pattern))}},rules={required:required$1,whitespace:whitespace,type:type$1,range:range,enum:enumerable$1,pattern:pattern$1},string=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t,"string")&&!e.required)return r();rules.required(e,t,s,i,n,"string"),isEmptyValue(t,"string")||(rules.type(e,t,s,i,n),rules.range(e,t,s,i,n),rules.pattern(e,t,s,i,n),!0===e.whitespace&&rules.whitespace(e,t,s,i,n))}r(i)},method2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&rules.type(e,t,s,i,n)}r(i)},number2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(""===t&&(t=void 0),isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&(rules.type(e,t,s,i,n),rules.range(e,t,s,i,n))}r(i)},_boolean=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&rules.type(e,t,s,i,n)}r(i)},regexp2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),isEmptyValue(t)||rules.type(e,t,s,i,n)}r(i)},integer2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&(rules.type(e,t,s,i,n),rules.range(e,t,s,i,n))}r(i)},floatFn=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&(rules.type(e,t,s,i,n),rules.range(e,t,s,i,n))}r(i)},array2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(null==t&&!e.required)return r();rules.required(e,t,s,i,n,"array"),null!=t&&(rules.type(e,t,s,i,n),rules.range(e,t,s,i,n))}r(i)},object2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&rules.type(e,t,s,i,n)}r(i)},ENUM="enum",enumerable2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n),void 0!==t&&rules[ENUM](e,t,s,i,n)}r(i)},pattern2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t,"string")&&!e.required)return r();rules.required(e,t,s,i,n),isEmptyValue(t,"string")||rules.pattern(e,t,s,i,n)}r(i)},date2=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t,"date")&&!e.required)return r();var o;if(rules.required(e,t,s,i,n),!isEmptyValue(t,"date"))o=t instanceof Date?t:new Date(t),rules.type(e,o,s,i,n),o&&rules.range(e,o.getTime(),s,i,n)}r(i)},required2=function(e,t,r,s,n){var i=[],o=Array.isArray(t)?"array":typeof t;rules.required(e,t,s,i,n,o),r(i)},type2=function(e,t,r,s,n){var i=e.type,o=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t,i)&&!e.required)return r();rules.required(e,t,s,o,n,i),isEmptyValue(t,i)||rules.type(e,t,s,o,n)}r(o)},any=function(e,t,r,s,n){var i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(isEmptyValue(t)&&!e.required)return r();rules.required(e,t,s,i,n)}r(i)},validators={string:string,method:method2,number:number2,boolean:_boolean,regexp:regexp2,integer:integer2,float:floatFn,array:array2,object:object2,enum:enumerable2,pattern:pattern2,date:date2,url:type2,hex:type2,email:type2,required:required2,any:any};function newMessages(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}var messages=newMessages(),Schema=function(){function e(e){this.rules=null,this._messages=messages,this.define(e)}var t=e.prototype;return t.define=function(e){var t=this;if(!e)throw new Error("Cannot configure a schema with no rules");if("object"!=typeof e||Array.isArray(e))throw new Error("Rules must be an object");this.rules={},Object.keys(e).forEach(function(r){var s=e[r];t.rules[r]=Array.isArray(s)?s:[s]})},t.messages=function(e){return e&&(this._messages=deepMerge(newMessages(),e)),this._messages},t.validate=function(t,r,s){var n=this;void 0===r&&(r={}),void 0===s&&(s=function(){});var i=t,o=r,a=s;if("function"==typeof o&&(a=o,o={}),!this.rules||0===Object.keys(this.rules).length)return a&&a(null,i),Promise.resolve(i);if(o.messages){var l=this.messages();l===messages&&(l=newMessages()),deepMerge(l,o.messages),o.messages=l}else o.messages=this.messages();var c={};(o.keys||Object.keys(this.rules)).forEach(function(e){var r=n.rules[e],s=i[e];r.forEach(function(r){var o=r;"function"==typeof o.transform&&(i===t&&(i=_extends({},i)),s=i[e]=o.transform(s)),(o="function"==typeof o?{validator:o}:_extends({},o)).validator=n.getValidationMethod(o),o.validator&&(o.field=e,o.fullField=o.fullField||e,o.type=n.getType(o),c[e]=c[e]||[],c[e].push({rule:o,value:s,source:i,field:e}))})});var u={};return asyncMap(c,o,function(t,r){var s,n=t.rule,a=!("object"!==n.type&&"array"!==n.type||"object"!=typeof n.fields&&"object"!=typeof n.defaultField);function l(e,t){return _extends({},t,{fullField:n.fullField+"."+e,fullFields:n.fullFields?[].concat(n.fullFields,[e]):[e]})}function c(s){void 0===s&&(s=[]);var c=Array.isArray(s)?s:[s];!o.suppressWarning&&c.length&&e.warning("async-validator:",c),c.length&&void 0!==n.message&&(c=[].concat(n.message));var d=c.map(complementError(n,i));if(o.first&&d.length)return u[n.field]=1,r(d);if(a){if(n.required&&!t.value)return void 0!==n.message?d=[].concat(n.message).map(complementError(n,i)):o.error&&(d=[o.error(n,format(o.messages.required,n.field))]),r(d);var p={};n.defaultField&&Object.keys(t.value).map(function(e){p[e]=n.defaultField}),p=_extends({},p,t.rule.fields);var m={};Object.keys(p).forEach(function(e){var t=p[e],r=Array.isArray(t)?t:[t];m[e]=r.map(l.bind(null,e))});var h=new e(m);h.messages(o.messages),t.rule.options&&(t.rule.options.messages=o.messages,t.rule.options.error=o.error),h.validate(t.value,t.rule.options||o,function(e){var t=[];d&&d.length&&t.push.apply(t,d),e&&e.length&&t.push.apply(t,e),r(t.length?t:null)})}else r(d)}if(a=a&&(n.required||!n.required&&t.value),n.field=t.field,n.asyncValidator)s=n.asyncValidator(n,t.value,c,t.source,o);else if(n.validator){try{s=n.validator(n,t.value,c,t.source,o)}catch(d){null==console.error||console.error(d),o.suppressValidatorError||setTimeout(function(){throw d},0),c(d.message)}!0===s?c():!1===s?c("function"==typeof n.message?n.message(n.fullField||n.field):n.message||(n.fullField||n.field)+" fails"):s instanceof Array?c(s):s instanceof Error&&c(s.message)}s&&s.then&&s.then(function(){return c()},function(e){return c(e)})},function(e){!function(e){var t=[],r={};function s(e){var r;Array.isArray(e)?t=(r=t).concat.apply(r,e):t.push(e)}for(var n=0;n<e.length;n++)s(e[n]);t.length?(r=convertFieldsError(t),a(t,r)):a(null,i)}(e)},i)},t.getType=function(e){if(void 0===e.type&&e.pattern instanceof RegExp&&(e.type="pattern"),"function"!=typeof e.validator&&e.type&&!validators.hasOwnProperty(e.type))throw new Error(format("Unknown rule type %s",e.type));return e.type||"string"},t.getValidationMethod=function(e){if("function"==typeof e.validator)return e.validator;var t=Object.keys(e),r=t.indexOf("message");return-1!==r&&t.splice(r,1),1===t.length&&"required"===t[0]?validators.required:validators[this.getType(e)]||void 0},e}();Schema.register=function(e,t){if("function"!=typeof t)throw new Error("Cannot register a validator by type, validator is not a function");validators[e]=t},Schema.warning=warning$2,Schema.messages=messages,Schema.validators=validators;var typeTemplate="'${name}' is not a valid ${type}",defaultValidateMessages={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:typeTemplate,method:typeTemplate,array:typeTemplate,object:typeTemplate,number:typeTemplate,date:typeTemplate,boolean:typeTemplate,integer:typeTemplate,float:typeTemplate,regexp:typeTemplate,email:typeTemplate,url:typeTemplate,hex:typeTemplate},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},AsyncValidator=Schema;function replaceMessage(e,t){return e.replace(/\$\{\w+\}/g,function(e){var r=e.slice(2,-1);return t[r]})}var CODE_LOGIC_ERROR="CODE_LOGIC_ERROR";function validateRule(e,t,r,s,n){return _validateRule.apply(this,arguments)}function _validateRule(){return _validateRule=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,s,n,i){var o,a,l,c,u,d,p,m,h;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return delete(o=_objectSpread2$3({},s)).ruleIndex,AsyncValidator.warning=function(){},o.validator&&(a=o.validator,o.validator=function(){try{return a.apply(void 0,arguments)}catch(e){return console.error(e),Promise.reject(CODE_LOGIC_ERROR)}}),l=null,o&&"array"===o.type&&o.defaultField&&(l=o.defaultField,delete o.defaultField),c=new AsyncValidator(_defineProperty$2({},t,[o])),u=merge$1(defaultValidateMessages,n.validateMessages),c.messages(u),d=[],e.prev=10,e.next=13,Promise.resolve(c.validate(_defineProperty$2({},t,r),_objectSpread2$3({},n)));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),e.t0.errors&&(d=e.t0.errors.map(function(e,t){var r=e.message,s=r===CODE_LOGIC_ERROR?u.default:r;return reactExports.isValidElement(s)?reactExports.cloneElement(s,{key:"error_".concat(t)}):s}));case 18:if(d.length||!l){e.next=23;break}return e.next=21,Promise.all(r.map(function(e,r){return validateRule("".concat(t,".").concat(r),e,l,n,i)}));case 21:return p=e.sent,e.abrupt("return",p.reduce(function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t))},[]));case 23:return m=_objectSpread2$3(_objectSpread2$3({},s),{},{name:t,enum:(s.enum||[]).join(", ")},i),h=d.map(function(e){return"string"==typeof e?replaceMessage(e,m):e}),e.abrupt("return",h);case 26:case"end":return e.stop()}},e,null,[[10,15]])})),_validateRule.apply(this,arguments)}function validateRules(e,t,r,s,n,i){var o,a=e.join("."),l=r.map(function(e,t){var r=e.validator,s=_objectSpread2$3(_objectSpread2$3({},e),{},{ruleIndex:t});return r&&(s.validator=function(e,t,s){var n=!1,i=r(e,t,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Promise.resolve().then(function(){warningOnce$2(!n,"Your validator function has already return a promise. `callback` will be ignored."),n||s.apply(void 0,t)})});n=i&&"function"==typeof i.then&&"function"==typeof i.catch,warningOnce$2(n,"`callback` is deprecated. Please return a promise instead."),n&&i.then(function(){s()}).catch(function(e){s(e||" ")})}),s}).sort(function(e,t){var r=e.warningOnly,s=e.ruleIndex,n=t.warningOnly,i=t.ruleIndex;return!!r==!!n?s-i:r?1:-1});if(!0===n)o=new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark(function e(r,n){var o,c,u;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<l.length)){e.next=12;break}return c=l[o],e.next=5,validateRule(a,t,c,s,i);case 5:if(!(u=e.sent).length){e.next=9;break}return n([{errors:u,rule:c}]),e.abrupt("return");case 9:o+=1,e.next=1;break;case 12:r([]);case 13:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}());else{var c=l.map(function(e){return validateRule(a,t,e,s,i).then(function(t){return{errors:t,rule:e}})});o=(n?finishOnFirstFailed(c):finishOnAllFailed(c)).then(function(e){return Promise.reject(e)})}return o.catch(function(e){return e}),o}function finishOnAllFailed(e){return _finishOnAllFailed.apply(this,arguments)}function _finishOnAllFailed(){return(_finishOnAllFailed=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t).then(function(e){var t;return(t=[]).concat.apply(t,_toConsumableArray(e))}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function finishOnFirstFailed(e){return _finishOnFirstFailed.apply(this,arguments)}function _finishOnFirstFailed(){return(_finishOnFirstFailed=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.abrupt("return",new Promise(function(e){t.forEach(function(s){s.then(function(s){s.errors.length&&e([s]),(r+=1)===t.length&&e([])})})}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function getNamePath(e){return toArray$1(e)}function cloneByNamePathList(e,t){var r={};return t.forEach(function(t){var s=get(e,t);r=set(r,t,s)}),r}function containsNamePath(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&e.some(function(e){return matchNamePath(t,e,r)})}function matchNamePath(e,t){return!(!e||!t)&&(!(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e.length!==t.length)&&t.every(function(t,r){return e[r]===t}))}function isSimilar(e,t){if(e===t)return!0;if(!e&&t||e&&!t)return!1;if(!e||!t||"object"!==_typeof(e)||"object"!==_typeof(t))return!1;var r=Object.keys(e),s=Object.keys(t),n=new Set([].concat(r,s));return _toConsumableArray(n).every(function(r){var s=e[r],n=t[r];return"function"==typeof s&&"function"==typeof n||s===n})}function defaultGetValueFromEvent(e){var t=arguments.length<=1?void 0:arguments[1];return t&&t.target&&"object"===_typeof(t.target)&&e in t.target?t.target[e]:t}function move(e,t,r){var s=e.length;if(t<0||t>=s||r<0||r>=s)return e;var n=e[t],i=t-r;return i>0?[].concat(_toConsumableArray(e.slice(0,r)),[n],_toConsumableArray(e.slice(r,t)),_toConsumableArray(e.slice(t+1,s))):i<0?[].concat(_toConsumableArray(e.slice(0,t)),_toConsumableArray(e.slice(t+1,r+1)),[n],_toConsumableArray(e.slice(r+1,s))):e}var _excluded$2=["name"],EMPTY_ERRORS=[];function requireUpdate(e,t,r,s,n,i){return"function"==typeof e?e(t,r,"source"in i?{source:i.source}:{}):s!==n}var Field=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var s;(_classCallCheck(this,r),s=t.call(this,e),_defineProperty$2(_assertThisInitialized(s),"state",{resetCount:0}),_defineProperty$2(_assertThisInitialized(s),"cancelRegisterFunc",null),_defineProperty$2(_assertThisInitialized(s),"mounted",!1),_defineProperty$2(_assertThisInitialized(s),"touched",!1),_defineProperty$2(_assertThisInitialized(s),"dirty",!1),_defineProperty$2(_assertThisInitialized(s),"validatePromise",void 0),_defineProperty$2(_assertThisInitialized(s),"prevValidating",void 0),_defineProperty$2(_assertThisInitialized(s),"errors",EMPTY_ERRORS),_defineProperty$2(_assertThisInitialized(s),"warnings",EMPTY_ERRORS),_defineProperty$2(_assertThisInitialized(s),"cancelRegister",function(){var e=s.props,t=e.preserve,r=e.isListField,n=e.name;s.cancelRegisterFunc&&s.cancelRegisterFunc(r,t,getNamePath(n)),s.cancelRegisterFunc=null}),_defineProperty$2(_assertThisInitialized(s),"getNamePath",function(){var e=s.props,t=e.name,r=e.fieldContext.prefixName;return void 0!==t?[].concat(_toConsumableArray(void 0===r?[]:r),_toConsumableArray(t)):[]}),_defineProperty$2(_assertThisInitialized(s),"getRules",function(){var e=s.props,t=e.rules,r=void 0===t?[]:t,n=e.fieldContext;return r.map(function(e){return"function"==typeof e?e(n):e})}),_defineProperty$2(_assertThisInitialized(s),"refresh",function(){s.mounted&&s.setState(function(e){return{resetCount:e.resetCount+1}})}),_defineProperty$2(_assertThisInitialized(s),"metaCache",null),_defineProperty$2(_assertThisInitialized(s),"triggerMetaEvent",function(e){var t=s.props.onMetaChange;if(t){var r=_objectSpread2$3(_objectSpread2$3({},s.getMeta()),{},{destroy:e});isEqual$2(s.metaCache,r)||t(r),s.metaCache=r}else s.metaCache=null}),_defineProperty$2(_assertThisInitialized(s),"onStoreChange",function(e,t,r){var n=s.props,i=n.shouldUpdate,o=n.dependencies,a=void 0===o?[]:o,l=n.onReset,c=r.store,u=s.getNamePath(),d=s.getValue(e),p=s.getValue(c),m=t&&containsNamePath(t,u);switch("valueUpdate"!==r.type||"external"!==r.source||isEqual$2(d,p)||(s.touched=!0,s.dirty=!0,s.validatePromise=null,s.errors=EMPTY_ERRORS,s.warnings=EMPTY_ERRORS,s.triggerMetaEvent()),r.type){case"reset":if(!t||m)return s.touched=!1,s.dirty=!1,s.validatePromise=void 0,s.errors=EMPTY_ERRORS,s.warnings=EMPTY_ERRORS,s.triggerMetaEvent(),null==l||l(),void s.refresh();break;case"remove":if(i)return void s.reRender();break;case"setField":var h=r.data;if(m)return"touched"in h&&(s.touched=h.touched),"validating"in h&&!("originRCField"in h)&&(s.validatePromise=h.validating?Promise.resolve([]):null),"errors"in h&&(s.errors=h.errors||EMPTY_ERRORS),"warnings"in h&&(s.warnings=h.warnings||EMPTY_ERRORS),s.dirty=!0,s.triggerMetaEvent(),void s.reRender();if("value"in h&&containsNamePath(t,u,!0))return void s.reRender();if(i&&!u.length&&requireUpdate(i,e,c,d,p,r))return void s.reRender();break;case"dependenciesUpdate":if(a.map(getNamePath).some(function(e){return containsNamePath(r.relatedFields,e)}))return void s.reRender();break;default:if(m||(!a.length||u.length||i)&&requireUpdate(i,e,c,d,p,r))return void s.reRender()}!0===i&&s.reRender()}),_defineProperty$2(_assertThisInitialized(s),"validateRules",function(e){var t=s.getNamePath(),r=s.getValue(),n=e||{},i=n.triggerName,o=n.validateOnly,a=void 0!==o&&o,l=Promise.resolve().then(_asyncToGenerator(_regeneratorRuntime().mark(function n(){var o,a,c,u,d,p,m;return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s.mounted){n.next=2;break}return n.abrupt("return",[]);case 2:if(o=s.props,a=o.validateFirst,c=void 0!==a&&a,u=o.messageVariables,d=o.validateDebounce,p=s.getRules(),i&&(p=p.filter(function(e){return e}).filter(function(e){var t=e.validateTrigger;return!t||toArray$1(t).includes(i)})),!d||!i){n.next=10;break}return n.next=8,new Promise(function(e){setTimeout(e,d)});case 8:if(s.validatePromise===l){n.next=10;break}return n.abrupt("return",[]);case 10:return(m=validateRules(t,r,p,e,c,u)).catch(function(e){return e}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:EMPTY_ERRORS;if(s.validatePromise===l){var t;s.validatePromise=null;var r=[],n=[];null===(t=e.forEach)||void 0===t||t.call(e,function(e){var t=e.rule.warningOnly,s=e.errors,i=void 0===s?EMPTY_ERRORS:s;t?n.push.apply(n,_toConsumableArray(i)):r.push.apply(r,_toConsumableArray(i))}),s.errors=r,s.warnings=n,s.triggerMetaEvent(),s.reRender()}}),n.abrupt("return",m);case 13:case"end":return n.stop()}},n)})));return a||(s.validatePromise=l,s.dirty=!0,s.errors=EMPTY_ERRORS,s.warnings=EMPTY_ERRORS,s.triggerMetaEvent(),s.reRender()),l}),_defineProperty$2(_assertThisInitialized(s),"isFieldValidating",function(){return!!s.validatePromise}),_defineProperty$2(_assertThisInitialized(s),"isFieldTouched",function(){return s.touched}),_defineProperty$2(_assertThisInitialized(s),"isFieldDirty",function(){return!(!s.dirty&&void 0===s.props.initialValue)||void 0!==(0,s.props.fieldContext.getInternalHooks(HOOK_MARK).getInitialValue)(s.getNamePath())}),_defineProperty$2(_assertThisInitialized(s),"getErrors",function(){return s.errors}),_defineProperty$2(_assertThisInitialized(s),"getWarnings",function(){return s.warnings}),_defineProperty$2(_assertThisInitialized(s),"isListField",function(){return s.props.isListField}),_defineProperty$2(_assertThisInitialized(s),"isList",function(){return s.props.isList}),_defineProperty$2(_assertThisInitialized(s),"isPreserve",function(){return s.props.preserve}),_defineProperty$2(_assertThisInitialized(s),"getMeta",function(){return s.prevValidating=s.isFieldValidating(),{touched:s.isFieldTouched(),validating:s.prevValidating,errors:s.errors,warnings:s.warnings,name:s.getNamePath(),validated:null===s.validatePromise}}),_defineProperty$2(_assertThisInitialized(s),"getOnlyChild",function(e){if("function"==typeof e){var t=s.getMeta();return _objectSpread2$3(_objectSpread2$3({},s.getOnlyChild(e(s.getControlled(),t,s.props.fieldContext))),{},{isFunction:!0})}var r=toArray$3(e);return 1===r.length&&reactExports.isValidElement(r[0])?{child:r[0],isFunction:!1}:{child:r,isFunction:!1}}),_defineProperty$2(_assertThisInitialized(s),"getValue",function(e){var t=s.props.fieldContext.getFieldsValue,r=s.getNamePath();return get(e||t(!0),r)}),_defineProperty$2(_assertThisInitialized(s),"getControlled",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.props,r=t.name,n=t.trigger,i=t.validateTrigger,o=t.getValueFromEvent,a=t.normalize,l=t.valuePropName,c=t.getValueProps,u=t.fieldContext,d=void 0!==i?i:u.validateTrigger,p=s.getNamePath(),m=u.getInternalHooks,h=u.getFieldsValue,x=m(HOOK_MARK).dispatch,f=s.getValue(),g=c||function(e){return _defineProperty$2({},l,e)},y=e[n],v=void 0!==r?g(f):{},E=_objectSpread2$3(_objectSpread2$3({},e),v);return E[n]=function(){var e;s.touched=!0,s.dirty=!0,s.triggerMetaEvent();for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e=o?o.apply(void 0,r):defaultGetValueFromEvent.apply(void 0,[l].concat(r)),a&&(e=a(e,f,h(!0))),x({type:"updateValue",namePath:p,value:e}),y&&y.apply(void 0,r)},toArray$1(d||[]).forEach(function(e){var t=E[e];E[e]=function(){t&&t.apply(void 0,arguments);var r=s.props.rules;r&&r.length&&x({type:"validateField",namePath:p,triggerName:e})}}),E}),e.fieldContext)&&(0,(0,e.fieldContext.getInternalHooks)(HOOK_MARK).initEntityValue)(_assertThisInitialized(s));return s}return _createClass(r,[{key:"componentDidMount",value:function(){var e=this.props,t=e.shouldUpdate,r=e.fieldContext;if(this.mounted=!0,r){var s=(0,r.getInternalHooks)(HOOK_MARK).registerField;this.cancelRegisterFunc=s(this)}!0===t&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e,t=this.state.resetCount,r=this.props.children,s=this.getOnlyChild(r),n=s.child;return s.isFunction?e=n:reactExports.isValidElement(n)?e=reactExports.cloneElement(n,this.getControlled(n.props)):(warningOnce$2(!n,"`children` of Field is not validate ReactElement."),e=n),reactExports.createElement(reactExports.Fragment,{key:t},e)}}]),r}(reactExports.Component);function WrapperField(e){var t=e.name,r=_objectWithoutProperties$2(e,_excluded$2),s=reactExports.useContext(Context$1),n=reactExports.useContext(ListContext),i=void 0!==t?getNamePath(t):void 0,o="keep";return r.isListField||(o="_".concat((i||[]).join("_"))),reactExports.createElement(Field,_extends$4({key:o,name:i,isListField:!!n},r,{fieldContext:s}))}function List(e){var t=e.name,r=e.initialValue,s=e.children,n=e.rules,i=e.validateTrigger,o=e.isListField,a=reactExports.useContext(Context$1),l=reactExports.useContext(ListContext),c=reactExports.useRef({keys:[],id:0}).current,u=reactExports.useMemo(function(){var e=getNamePath(a.prefixName)||[];return[].concat(_toConsumableArray(e),_toConsumableArray(getNamePath(t)))},[a.prefixName,t]),d=reactExports.useMemo(function(){return _objectSpread2$3(_objectSpread2$3({},a),{},{prefixName:u})},[a,u]),p=reactExports.useMemo(function(){return{getKey:function(e){var t=u.length,r=e[t];return[c.keys[r],e.slice(t+1)]}}},[u]);if("function"!=typeof s)return warningOnce$2(!1,"Form.List only accepts function as children."),null;return reactExports.createElement(ListContext.Provider,{value:p},reactExports.createElement(Context$1.Provider,{value:d},reactExports.createElement(WrapperField,{name:[],shouldUpdate:function(e,t,r){return"internal"!==r.source&&e!==t},rules:n,validateTrigger:i,initialValue:r,isList:!0,isListField:null!=o?o:!!l},function(e,t){var r=e.value,n=void 0===r?[]:r,i=e.onChange,o=a.getFieldValue,l=function(){return o(u||[])||[]},d={add:function(e,t){var r=l();t>=0&&t<=r.length?(c.keys=[].concat(_toConsumableArray(c.keys.slice(0,t)),[c.id],_toConsumableArray(c.keys.slice(t))),i([].concat(_toConsumableArray(r.slice(0,t)),[e],_toConsumableArray(r.slice(t))))):(c.keys=[].concat(_toConsumableArray(c.keys),[c.id]),i([].concat(_toConsumableArray(r),[e]))),c.id+=1},remove:function(e){var t=l(),r=new Set(Array.isArray(e)?e:[e]);r.size<=0||(c.keys=c.keys.filter(function(e,t){return!r.has(t)}),i(t.filter(function(e,t){return!r.has(t)})))},move:function(e,t){if(e!==t){var r=l();e<0||e>=r.length||t<0||t>=r.length||(c.keys=move(c.keys,e,t),i(move(r,e,t)))}}},p=n||[];return Array.isArray(p)||(p=[]),s(p.map(function(e,t){var r=c.keys[t];return void 0===r&&(c.keys[t]=c.id,r=c.keys[t],c.id+=1),{name:t,key:r,isListField:!0}}),d,t)})))}function allPromiseFinish(e){var t=!1,r=e.length,s=[];return e.length?new Promise(function(n,i){e.forEach(function(e,o){e.catch(function(e){return t=!0,e}).then(function(e){r-=1,s[o]=e,r>0||(t&&i(s),n(s))})})}):Promise.resolve([])}_defineProperty$2(Field,"contextType",Context$1),_defineProperty$2(Field,"defaultProps",{trigger:"onChange",valuePropName:"value"});var SPLIT="__@field_split__";function normalize(e){return e.map(function(e){return"".concat(_typeof(e),":").concat(e)}).join(SPLIT)}var NameMap=function(){function e(){_classCallCheck(this,e),_defineProperty$2(this,"kvs",new Map)}return _createClass(e,[{key:"set",value:function(e,t){this.kvs.set(normalize(e),t)}},{key:"get",value:function(e){return this.kvs.get(normalize(e))}},{key:"update",value:function(e,t){var r=t(this.get(e));r?this.set(e,r):this.delete(e)}},{key:"delete",value:function(e){this.kvs.delete(normalize(e))}},{key:"map",value:function(e){return _toConsumableArray(this.kvs.entries()).map(function(t){var r=_slicedToArray$1(t,2),s=r[0],n=r[1],i=s.split(SPLIT);return e({key:i.map(function(e){var t=e.match(/^([^:]*):(.*)$/),r=_slicedToArray$1(t,3),s=r[1],n=r[2];return"number"===s?Number(n):n}),value:n})})}},{key:"toJSON",value:function(){var e={};return this.map(function(t){var r=t.key,s=t.value;return e[r.join(".")]=s,null}),e}}]),e}(),_excluded$1=["name"],FormStore=_createClass(function e(t){var r=this;_classCallCheck(this,e),_defineProperty$2(this,"formHooked",!1),_defineProperty$2(this,"forceRootUpdate",void 0),_defineProperty$2(this,"subscribable",!0),_defineProperty$2(this,"store",{}),_defineProperty$2(this,"fieldEntities",[]),_defineProperty$2(this,"initialValues",{}),_defineProperty$2(this,"callbacks",{}),_defineProperty$2(this,"validateMessages",null),_defineProperty$2(this,"preserve",null),_defineProperty$2(this,"lastValidatePromise",null),_defineProperty$2(this,"getForm",function(){return{getFieldValue:r.getFieldValue,getFieldsValue:r.getFieldsValue,getFieldError:r.getFieldError,getFieldWarning:r.getFieldWarning,getFieldsError:r.getFieldsError,isFieldsTouched:r.isFieldsTouched,isFieldTouched:r.isFieldTouched,isFieldValidating:r.isFieldValidating,isFieldsValidating:r.isFieldsValidating,resetFields:r.resetFields,setFields:r.setFields,setFieldValue:r.setFieldValue,setFieldsValue:r.setFieldsValue,validateFields:r.validateFields,submit:r.submit,_init:!0,getInternalHooks:r.getInternalHooks}}),_defineProperty$2(this,"getInternalHooks",function(e){return e===HOOK_MARK?(r.formHooked=!0,{dispatch:r.dispatch,initEntityValue:r.initEntityValue,registerField:r.registerField,useSubscribe:r.useSubscribe,setInitialValues:r.setInitialValues,destroyForm:r.destroyForm,setCallbacks:r.setCallbacks,setValidateMessages:r.setValidateMessages,getFields:r.getFields,setPreserve:r.setPreserve,getInitialValue:r.getInitialValue,registerWatch:r.registerWatch}):(warningOnce$2(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),_defineProperty$2(this,"useSubscribe",function(e){r.subscribable=e}),_defineProperty$2(this,"prevWithoutPreserves",null),_defineProperty$2(this,"setInitialValues",function(e,t){if(r.initialValues=e||{},t){var s,n=merge$1(e,r.store);null===(s=r.prevWithoutPreserves)||void 0===s||s.map(function(t){var r=t.key;n=set(n,r,get(e,r))}),r.prevWithoutPreserves=null,r.updateStore(n)}}),_defineProperty$2(this,"destroyForm",function(){var e=new NameMap;r.getFieldEntities(!0).forEach(function(t){r.isMergedPreserve(t.isPreserve())||e.set(t.getNamePath(),!0)}),r.prevWithoutPreserves=e}),_defineProperty$2(this,"getInitialValue",function(e){var t=get(r.initialValues,e);return e.length?merge$1(t):t}),_defineProperty$2(this,"setCallbacks",function(e){r.callbacks=e}),_defineProperty$2(this,"setValidateMessages",function(e){r.validateMessages=e}),_defineProperty$2(this,"setPreserve",function(e){r.preserve=e}),_defineProperty$2(this,"watchList",[]),_defineProperty$2(this,"registerWatch",function(e){return r.watchList.push(e),function(){r.watchList=r.watchList.filter(function(t){return t!==e})}}),_defineProperty$2(this,"notifyWatch",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(r.watchList.length){var t=r.getFieldsValue(),s=r.getFieldsValue(!0);r.watchList.forEach(function(r){r(t,s,e)})}}),_defineProperty$2(this,"timeoutId",null),_defineProperty$2(this,"warningUnhooked",function(){}),_defineProperty$2(this,"updateStore",function(e){r.store=e}),_defineProperty$2(this,"getFieldEntities",function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?r.fieldEntities.filter(function(e){return e.getNamePath().length}):r.fieldEntities}),_defineProperty$2(this,"getFieldsMap",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new NameMap;return r.getFieldEntities(e).forEach(function(e){var r=e.getNamePath();t.set(r,e)}),t}),_defineProperty$2(this,"getFieldEntitiesForNamePathList",function(e){if(!e)return r.getFieldEntities(!0);var t=r.getFieldsMap(!0);return e.map(function(e){var r=getNamePath(e);return t.get(r)||{INVALIDATE_NAME_PATH:getNamePath(e)}})}),_defineProperty$2(this,"getFieldsValue",function(e,t){var s,n,i;if(r.warningUnhooked(),!0===e||Array.isArray(e)?(s=e,n=t):e&&"object"===_typeof(e)&&(i=e.strict,n=e.filter),!0===s&&!n)return r.store;var o=r.getFieldEntitiesForNamePathList(Array.isArray(s)?s:null),a=[];return o.forEach(function(e){var t,r,o,l,c="INVALIDATE_NAME_PATH"in e?e.INVALIDATE_NAME_PATH:e.getNamePath();if(i){if(null!==(o=(l=e).isList)&&void 0!==o&&o.call(l))return}else if(!s&&null!==(t=(r=e).isListField)&&void 0!==t&&t.call(r))return;if(n){var u="getMeta"in e?e.getMeta():null;n(u)&&a.push(c)}else a.push(c)}),cloneByNamePathList(r.store,a.map(getNamePath))}),_defineProperty$2(this,"getFieldValue",function(e){r.warningUnhooked();var t=getNamePath(e);return get(r.store,t)}),_defineProperty$2(this,"getFieldsError",function(e){return r.warningUnhooked(),r.getFieldEntitiesForNamePathList(e).map(function(t,r){return t&&!("INVALIDATE_NAME_PATH"in t)?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:getNamePath(e[r]),errors:[],warnings:[]}})}),_defineProperty$2(this,"getFieldError",function(e){r.warningUnhooked();var t=getNamePath(e);return r.getFieldsError([t])[0].errors}),_defineProperty$2(this,"getFieldWarning",function(e){r.warningUnhooked();var t=getNamePath(e);return r.getFieldsError([t])[0].warnings}),_defineProperty$2(this,"isFieldsTouched",function(){r.warningUnhooked();for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var n,i=t[0],o=t[1],a=!1;0===t.length?n=null:1===t.length?Array.isArray(i)?(n=i.map(getNamePath),a=!1):(n=null,a=i):(n=i.map(getNamePath),a=o);var l=r.getFieldEntities(!0),c=function(e){return e.isFieldTouched()};if(!n)return a?l.every(function(e){return c(e)||e.isList()}):l.some(c);var u=new NameMap;n.forEach(function(e){u.set(e,[])}),l.forEach(function(e){var t=e.getNamePath();n.forEach(function(r){r.every(function(e,r){return t[r]===e})&&u.update(r,function(t){return[].concat(_toConsumableArray(t),[e])})})});var d=function(e){return e.some(c)},p=u.map(function(e){return e.value});return a?p.every(d):p.some(d)}),_defineProperty$2(this,"isFieldTouched",function(e){return r.warningUnhooked(),r.isFieldsTouched([e])}),_defineProperty$2(this,"isFieldsValidating",function(e){r.warningUnhooked();var t=r.getFieldEntities();if(!e)return t.some(function(e){return e.isFieldValidating()});var s=e.map(getNamePath);return t.some(function(e){var t=e.getNamePath();return containsNamePath(s,t)&&e.isFieldValidating()})}),_defineProperty$2(this,"isFieldValidating",function(e){return r.warningUnhooked(),r.isFieldsValidating([e])}),_defineProperty$2(this,"resetWithFieldInitialValue",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new NameMap,s=r.getFieldEntities(!0);s.forEach(function(e){var r=e.props.initialValue,s=e.getNamePath();if(void 0!==r){var n=t.get(s)||new Set;n.add({entity:e,value:r}),t.set(s,n)}});var n;e.entities?n=e.entities:e.namePathList?(n=[],e.namePathList.forEach(function(e){var r,s=t.get(e);s&&(r=n).push.apply(r,_toConsumableArray(_toConsumableArray(s).map(function(e){return e.entity})))})):n=s,n.forEach(function(s){if(void 0!==s.props.initialValue){var n=s.getNamePath();if(void 0!==r.getInitialValue(n))warningOnce$2(!1,"Form already set 'initialValues' with path '".concat(n.join("."),"'. Field can not overwrite it."));else{var i=t.get(n);if(i&&i.size>1)warningOnce$2(!1,"Multiple Field with path '".concat(n.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(i){var o=r.getFieldValue(n);s.isListField()||e.skipExist&&void 0!==o||r.updateStore(set(r.store,n,_toConsumableArray(i)[0].value))}}}})}),_defineProperty$2(this,"resetFields",function(e){r.warningUnhooked();var t=r.store;if(!e)return r.updateStore(merge$1(r.initialValues)),r.resetWithFieldInitialValue(),r.notifyObservers(t,null,{type:"reset"}),void r.notifyWatch();var s=e.map(getNamePath);s.forEach(function(e){var t=r.getInitialValue(e);r.updateStore(set(r.store,e,t))}),r.resetWithFieldInitialValue({namePathList:s}),r.notifyObservers(t,s,{type:"reset"}),r.notifyWatch(s)}),_defineProperty$2(this,"setFields",function(e){r.warningUnhooked();var t=r.store,s=[];e.forEach(function(e){var n=e.name,i=_objectWithoutProperties$2(e,_excluded$1),o=getNamePath(n);s.push(o),"value"in i&&r.updateStore(set(r.store,o,i.value)),r.notifyObservers(t,[o],{type:"setField",data:e})}),r.notifyWatch(s)}),_defineProperty$2(this,"getFields",function(){return r.getFieldEntities(!0).map(function(e){var t=e.getNamePath(),s=e.getMeta(),n=_objectSpread2$3(_objectSpread2$3({},s),{},{name:t,value:r.getFieldValue(t)});return Object.defineProperty(n,"originRCField",{value:!0}),n})}),_defineProperty$2(this,"initEntityValue",function(e){var t=e.props.initialValue;if(void 0!==t){var s=e.getNamePath();void 0===get(r.store,s)&&r.updateStore(set(r.store,s,t))}}),_defineProperty$2(this,"isMergedPreserve",function(e){var t=void 0!==e?e:r.preserve;return null==t||t}),_defineProperty$2(this,"registerField",function(e){r.fieldEntities.push(e);var t=e.getNamePath();if(r.notifyWatch([t]),void 0!==e.props.initialValue){var s=r.store;r.resetWithFieldInitialValue({entities:[e],skipExist:!0}),r.notifyObservers(s,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(s,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(r.fieldEntities=r.fieldEntities.filter(function(t){return t!==e}),!r.isMergedPreserve(n)&&(!s||i.length>1)){var o=s?void 0:r.getInitialValue(t);if(t.length&&r.getFieldValue(t)!==o&&r.fieldEntities.every(function(e){return!matchNamePath(e.getNamePath(),t)})){var a=r.store;r.updateStore(set(a,t,o,!0)),r.notifyObservers(a,[t],{type:"remove"}),r.triggerDependenciesUpdate(a,t)}}r.notifyWatch([t])}}),_defineProperty$2(this,"dispatch",function(e){switch(e.type){case"updateValue":var t=e.namePath,s=e.value;r.updateValue(t,s);break;case"validateField":var n=e.namePath,i=e.triggerName;r.validateFields([n],{triggerName:i})}}),_defineProperty$2(this,"notifyObservers",function(e,t,s){if(r.subscribable){var n=_objectSpread2$3(_objectSpread2$3({},s),{},{store:r.getFieldsValue(!0)});r.getFieldEntities().forEach(function(r){(0,r.onStoreChange)(e,t,n)})}else r.forceRootUpdate()}),_defineProperty$2(this,"triggerDependenciesUpdate",function(e,t){var s=r.getDependencyChildrenFields(t);return s.length&&r.validateFields(s),r.notifyObservers(e,s,{type:"dependenciesUpdate",relatedFields:[t].concat(_toConsumableArray(s))}),s}),_defineProperty$2(this,"updateValue",function(e,t){var s=getNamePath(e),n=r.store;r.updateStore(set(r.store,s,t)),r.notifyObservers(n,[s],{type:"valueUpdate",source:"internal"}),r.notifyWatch([s]);var i=r.triggerDependenciesUpdate(n,s),o=r.callbacks.onValuesChange;o&&o(cloneByNamePathList(r.store,[s]),r.getFieldsValue());r.triggerOnFieldsChange([s].concat(_toConsumableArray(i)))}),_defineProperty$2(this,"setFieldsValue",function(e){r.warningUnhooked();var t=r.store;if(e){var s=merge$1(r.store,e);r.updateStore(s)}r.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),r.notifyWatch()}),_defineProperty$2(this,"setFieldValue",function(e,t){r.setFields([{name:e,value:t}])}),_defineProperty$2(this,"getDependencyChildrenFields",function(e){var t=new Set,s=[],n=new NameMap;r.getFieldEntities().forEach(function(e){(e.props.dependencies||[]).forEach(function(t){var r=getNamePath(t);n.update(r,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return t.add(e),t})})});return function e(r){(n.get(r)||new Set).forEach(function(r){if(!t.has(r)){t.add(r);var n=r.getNamePath();r.isFieldDirty()&&n.length&&(s.push(n),e(n))}})}(e),s}),_defineProperty$2(this,"triggerOnFieldsChange",function(e,t){var s=r.callbacks.onFieldsChange;if(s){var n=r.getFields();if(t){var i=new NameMap;t.forEach(function(e){var t=e.name,r=e.errors;i.set(t,r)}),n.forEach(function(e){e.errors=i.get(e.name)||e.errors})}var o=n.filter(function(t){var r=t.name;return containsNamePath(e,r)});o.length&&s(o,n)}}),_defineProperty$2(this,"validateFields",function(e,t){var s,n;r.warningUnhooked(),Array.isArray(e)||"string"==typeof e||"string"==typeof t?(s=e,n=t):n=e;var i=!!s,o=i?s.map(getNamePath):[],a=[],l=String(Date.now()),c=new Set,u=n||{},d=u.recursive,p=u.dirty;r.getFieldEntities(!0).forEach(function(e){if(i||o.push(e.getNamePath()),e.props.rules&&e.props.rules.length&&(!p||e.isFieldDirty())){var t=e.getNamePath();if(c.add(t.join(l)),!i||containsNamePath(o,t,d)){var s=e.validateRules(_objectSpread2$3({validateMessages:_objectSpread2$3(_objectSpread2$3({},defaultValidateMessages),r.validateMessages)},n));a.push(s.then(function(){return{name:t,errors:[],warnings:[]}}).catch(function(e){var r,s=[],n=[];return null===(r=e.forEach)||void 0===r||r.call(e,function(e){var t=e.rule.warningOnly,r=e.errors;t?n.push.apply(n,_toConsumableArray(r)):s.push.apply(s,_toConsumableArray(r))}),s.length?Promise.reject({name:t,errors:s,warnings:n}):{name:t,errors:s,warnings:n}}))}}});var m=allPromiseFinish(a);r.lastValidatePromise=m,m.catch(function(e){return e}).then(function(e){var t=e.map(function(e){return e.name});r.notifyObservers(r.store,t,{type:"validateFinish"}),r.triggerOnFieldsChange(t,e)});var h=m.then(function(){return r.lastValidatePromise===m?Promise.resolve(r.getFieldsValue(o)):Promise.reject([])}).catch(function(e){var t=e.filter(function(e){return e&&e.errors.length});return Promise.reject({values:r.getFieldsValue(o),errorFields:t,outOfDate:r.lastValidatePromise!==m})});h.catch(function(e){return e});var x=o.filter(function(e){return c.has(e.join(l))});return r.triggerOnFieldsChange(x),h}),_defineProperty$2(this,"submit",function(){r.warningUnhooked(),r.validateFields().then(function(e){var t=r.callbacks.onFinish;if(t)try{t(e)}catch(s){console.error(s)}}).catch(function(e){var t=r.callbacks.onFinishFailed;t&&t(e)})}),this.forceRootUpdate=t});function useForm(e){var t=reactExports.useRef(),r=reactExports.useState({}),s=_slicedToArray$1(r,2)[1];if(!t.current)if(e)t.current=e;else{var n=new FormStore(function(){s({})});t.current=n.getForm()}return[t.current]}var FormContext$1=reactExports.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),FormProvider=function(e){var t=e.validateMessages,r=e.onFormChange,s=e.onFormFinish,n=e.children,i=reactExports.useContext(FormContext$1),o=reactExports.useRef({});return reactExports.createElement(FormContext$1.Provider,{value:_objectSpread2$3(_objectSpread2$3({},i),{},{validateMessages:_objectSpread2$3(_objectSpread2$3({},i.validateMessages),t),triggerFormChange:function(e,t){r&&r(e,{changedFields:t,forms:o.current}),i.triggerFormChange(e,t)},triggerFormFinish:function(e,t){s&&s(e,{values:t,forms:o.current}),i.triggerFormFinish(e,t)},registerForm:function(e,t){e&&(o.current=_objectSpread2$3(_objectSpread2$3({},o.current),{},_defineProperty$2({},e,t))),i.registerForm(e,t)},unregisterForm:function(e){var t=_objectSpread2$3({},o.current);delete t[e],o.current=t,i.unregisterForm(e)}})},n)},_excluded=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],Form$2=function(e,t){var r=e.name,s=e.initialValues,n=e.fields,i=e.form,o=e.preserve,a=e.children,l=e.component,c=void 0===l?"form":l,u=e.validateMessages,d=e.validateTrigger,p=void 0===d?"onChange":d,m=e.onValuesChange,h=e.onFieldsChange,x=e.onFinish,f=e.onFinishFailed,g=_objectWithoutProperties$2(e,_excluded),y=reactExports.useContext(FormContext$1),v=useForm(i),E=_slicedToArray$1(v,1)[0],j=E.getInternalHooks(HOOK_MARK),b=j.useSubscribe,w=j.setInitialValues,R=j.setCallbacks,_=j.setValidateMessages,S=j.setPreserve,C=j.destroyForm;reactExports.useImperativeHandle(t,function(){return E}),reactExports.useEffect(function(){return y.registerForm(r,E),function(){y.unregisterForm(r)}},[y,E,r]),_(_objectSpread2$3(_objectSpread2$3({},y.validateMessages),u)),R({onValuesChange:m,onFieldsChange:function(e){if(y.triggerFormChange(r,e),h){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];h.apply(void 0,[e].concat(s))}},onFinish:function(e){y.triggerFormFinish(r,e),x&&x(e)},onFinishFailed:f}),S(o);var k,$=reactExports.useRef(null);w(s,!$.current),$.current||($.current=!0),reactExports.useEffect(function(){return C},[]);var T="function"==typeof a;T?k=a(E.getFieldsValue(!0),E):k=a;b(!T);var I=reactExports.useRef();reactExports.useEffect(function(){isSimilar(I.current||[],n||[])||E.setFields(n||[]),I.current=n},[n,E]);var P=reactExports.useMemo(function(){return _objectSpread2$3(_objectSpread2$3({},E),{},{validateTrigger:p})},[E,p]),A=reactExports.createElement(ListContext.Provider,{value:null},reactExports.createElement(Context$1.Provider,{value:P},k));return!1===c?A:reactExports.createElement(c,_extends$4({},g,{onSubmit:function(e){e.preventDefault(),e.stopPropagation(),E.submit()},onReset:function(e){var t;e.preventDefault(),E.resetFields(),null===(t=g.onReset)||void 0===t||t.call(g,e)}}),A)};function stringify(e){try{return JSON.stringify(e)}catch(t){return Math.random()}}function useWatch(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var s=t[0],n=t[1],i=void 0===n?{}:n,o=isFormInstance(i)?{form:i}:i,a=o.form,l=reactExports.useState(),c=_slicedToArray$1(l,2),u=c[0],d=c[1],p=reactExports.useMemo(function(){return stringify(u)},[u]),m=reactExports.useRef(p);m.current=p;var h=reactExports.useContext(Context$1),x=a||h,f=x&&x._init,g=getNamePath(s),y=reactExports.useRef(g);return y.current=g,reactExports.useEffect(function(){if(f){var e=x.getFieldsValue,t=(0,x.getInternalHooks)(HOOK_MARK).registerWatch,r=function(e,t){var r=o.preserve?t:e;return"function"==typeof s?s(r):get(r,y.current)},n=t(function(e,t){var s=r(e,t),n=stringify(s);m.current!==n&&(m.current=n,d(s))}),i=r(e(),e(!0));return u!==i&&d(i),n}},[f]),u}var InternalForm=reactExports.forwardRef(Form$2),RefForm=InternalForm;RefForm.FormProvider=FormProvider,RefForm.Field=WrapperField,RefForm.List=List,RefForm.useForm=useForm,RefForm.useWatch=useWatch;const defaultFormContext={name:void 0,hasFeedback:!0,layout:"vertical",requiredMarkStyle:"asterisk",disabled:!1},FormContext=React$2.createContext(defaultFormContext),NoStyleItemContext=React$2.createContext(null),Header$1=()=>null;var isMergeableObject=function(e){return isNonNullObject(e)&&!isSpecial(e)};function isNonNullObject(e){return!!e&&"object"==typeof e}function isSpecial(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||isReactElement(e)}var canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(e){return e.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(e){return Array.isArray(e)?[]:{}}function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge(emptyTarget(e),e,t):e}function defaultArrayMerge(e,t,r){return e.concat(t).map(function(e){return cloneUnlessOtherwiseSpecified(e,r)})}function getMergeFunction(e,t){if(!t.customMerge)return deepmerge;var r=t.customMerge(e);return"function"==typeof r?r:deepmerge}function getEnumerableOwnPropertySymbols(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[]}function getKeys(e){return Object.keys(e).concat(getEnumerableOwnPropertySymbols(e))}function propertyIsOnObject(e,t){try{return t in e}catch(r){return!1}}function propertyIsUnsafe(e,t){return propertyIsOnObject(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function mergeObject(e,t,r){var s={};return r.isMergeableObject(e)&&getKeys(e).forEach(function(t){s[t]=cloneUnlessOtherwiseSpecified(e[t],r)}),getKeys(t).forEach(function(n){propertyIsUnsafe(e,n)||(propertyIsOnObject(e,n)&&r.isMergeableObject(t[n])?s[n]=getMergeFunction(n,r)(e[n],t[n],r):s[n]=cloneUnlessOtherwiseSpecified(t[n],r))}),s}function deepmerge(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||defaultArrayMerge,r.isMergeableObject=r.isMergeableObject||isMergeableObject,r.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var s=Array.isArray(t);return s===Array.isArray(e)?s?r.arrayMerge(e,t,r):mergeObject(e,t,r):cloneUnlessOtherwiseSpecified(t,r)}deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,r){return deepmerge(e,r,t)},{})};var deepmerge_1=deepmerge,cjs=deepmerge_1;const merge=getDefaultExportFromCjs(cjs),FormArray=e=>React$2.createElement(List,{name:e.name,initialValue:e.initialValue},(t,r)=>{const s=t.map(e=>({index:e.name,key:e.key})),n=e.children(s,r).map((t,n)=>{var i;return React$2.createElement(List$1,{key:s[n].key,mode:"card",header:null===(i=e.renderHeader)||void 0===i?void 0:i.call(e,s[n],r)},t)});return e.renderAdd&&n.push(React$2.createElement(List$1,{key:"add",mode:"card"},React$2.createElement(List$1.Item,{className:"adm-form-list-operation",onClick:()=>{e.onAdd?e.onAdd(r):r.add()},arrow:!1},e.renderAdd()))),React$2.createElement(React$2.Fragment,null,n)}),classPrefix$m="adm-form",defaultProps$i=defaultFormContext,Form$1=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$i,e),{className:s,style:n,hasFeedback:i,children:o,layout:a,footer:l,mode:c,disabled:u,requiredMarkStyle:d}=r,p=__rest$1(r,["className","style","hasFeedback","children","layout","footer","mode","disabled","requiredMarkStyle"]),{locale:m}=useConfig(),h=reactExports.useMemo(()=>merge(m.Form.defaultValidateMessages,p.validateMessages||{}),[m.Form.defaultValidateMessages,p.validateMessages]),x=[];let f=null,g=[],y=0;function v(){0!==g.length&&(y+=1,x.push(React$2.createElement(List$1,{header:f,key:y,mode:c},g)),g=[])}return traverseReactNode(r.children,e=>{if(React$2.isValidElement(e)){if(e.type===Header$1)return v(),void(f=e.props.children);if(e.type===FormArray)return v(),void x.push(e)}g.push(e)}),v(),React$2.createElement(RefForm,Object.assign({className:classNames$1(classPrefix$m,s),style:n,ref:t},p,{validateMessages:h}),React$2.createElement(FormContext.Provider,{value:{name:p.name,hasFeedback:i,layout:a,requiredMarkStyle:d,disabled:u}},x),l&&React$2.createElement("div",{className:`${classPrefix$m}-footer`},l))});var FieldContext={},interopRequireWildcard={exports:{}};!function(e){var t=_typeofExports.default;function r(s,n){if("function"==typeof WeakMap)var i=new WeakMap,o=new WeakMap;return(e.exports=r=function(e,r){if(!r&&e&&e.__esModule)return e;var s,n,a={__proto__:null,default:e};if(null===e||"object"!=t(e)&&"function"!=typeof e)return a;if(s=r?o:i){if(s.has(e))return s.get(e);s.set(e,a)}for(var l in e)"default"!==l&&{}.hasOwnProperty.call(e,l)&&((n=(s=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,l))&&(n.get||n.set)?s(a,l,n):a[l]=e[l]);return a},e.exports.__esModule=!0,e.exports.default=e.exports)(s,n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(interopRequireWildcard);var interopRequireWildcardExports=interopRequireWildcard.exports,warning$1={};Object.defineProperty(warning$1,"__esModule",{value:!0}),warning$1.call=call,warning$1.default=void 0,warning$1.note=note,warning$1.noteOnce=noteOnce,warning$1.preMessage=void 0,warning$1.resetWarned=resetWarned,warning$1.warning=warning,warning$1.warningOnce=warningOnce;var warned={},preMessage=warning$1.preMessage=function(e){};function warning(e,t){}function note(e,t){}function resetWarned(){warned={}}function call(e,t,r){t||warned[r]||(e(!1,r),warned[r]=!0)}function warningOnce(e,t){call(warning,e,t)}function noteOnce(e,t){call(note,e,t)}warningOnce.preMessage=preMessage,warningOnce.resetWarned=resetWarned,warningOnce.noteOnce=noteOnce,warning$1.default=warningOnce;var _interopRequireWildcard=interopRequireWildcardExports.default,_interopRequireDefault=interopRequireDefaultExports.default;Object.defineProperty(FieldContext,"__esModule",{value:!0});var default_1=FieldContext.default=FieldContext.HOOK_MARK=void 0,_warning=_interopRequireDefault(warning$1),React=_interopRequireWildcard(reactExports);FieldContext.HOOK_MARK="RC_FORM_INTERNAL_HOOKS";var warningFunc=function(){(0,_warning.default)(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},Context=React.createContext({getFieldValue:warningFunc,getFieldsValue:warningFunc,getFieldError:warningFunc,getFieldWarning:warningFunc,getFieldsError:warningFunc,isFieldsTouched:warningFunc,isFieldTouched:warningFunc,isFieldValidating:warningFunc,isFieldsValidating:warningFunc,resetFields:warningFunc,setFields:warningFunc,setFieldValue:warningFunc,setFieldsValue:warningFunc,validateFields:warningFunc,submit:warningFunc,getInternalHooks:function(){return warningFunc(),{dispatch:warningFunc,initEntityValue:warningFunc,registerField:warningFunc,useSubscribe:warningFunc,setInitialValues:warningFunc,destroyForm:warningFunc,setCallbacks:warningFunc,registerWatch:warningFunc,getFields:warningFunc,setValidateMessages:warningFunc,setPreserve:warningFunc,getInitialValue:warningFunc}}});function undefinedFallback(...e){let t;for(t=0;t<e.length&&void 0===e[t];t++);return e[t]}default_1=FieldContext.default=Context;const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=e=>({x:e,y:e}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(e,t,r){return max(e,min(t,r))}function evaluate(e,t){return"function"==typeof e?e(t):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return"x"===e?"y":"x"}function getAxisLength(e){return"y"===e?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(e){return yAxisSides.has(getSide(e))?"y":"x"}function getAlignmentAxis(e){return getOppositeAxis(getSideAxis(e))}function getAlignmentSides(e,t,r){void 0===r&&(r=!1);const s=getAlignment(e),n=getAlignmentAxis(e),i=getAxisLength(n);let o="x"===n?s===(r?"end":"start")?"right":"left":"start"===s?"bottom":"top";return t.reference[i]>t.floating[i]&&(o=getOppositePlacement(o)),[o,getOppositePlacement(o)]}function getExpandedPlacements(e){const t=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),t,getOppositeAlignmentPlacement(t)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,e=>oppositeAlignmentMap[e])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(e,t,r){switch(e){case"top":case"bottom":return r?t?rlPlacement:lrPlacement:t?lrPlacement:rlPlacement;case"left":case"right":return t?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(e,t,r,s){const n=getAlignment(e);let i=getSideList(getSide(e),"start"===r,s);return n&&(i=i.map(e=>e+"-"+n),t&&(i=i.concat(i.map(getOppositeAlignmentPlacement)))),i}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,e=>oppositeSideMap[e])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return"number"!=typeof e?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){const{x:t,y:r,width:s,height:n}=e;return{width:s,height:n,top:r,left:t,right:t+s,bottom:r+n,x:t,y:r}}function computeCoordsFromPlacement(e,t,r){let{reference:s,floating:n}=e;const i=getSideAxis(t),o=getAlignmentAxis(t),a=getAxisLength(o),l=getSide(t),c="y"===i,u=s.x+s.width/2-n.width/2,d=s.y+s.height/2-n.height/2,p=s[a]/2-n[a]/2;let m;switch(l){case"top":m={x:u,y:s.y-n.height};break;case"bottom":m={x:u,y:s.y+s.height};break;case"right":m={x:s.x+s.width,y:d};break;case"left":m={x:s.x-n.width,y:d};break;default:m={x:s.x,y:s.y}}switch(getAlignment(t)){case"start":m[o]-=p*(r&&c?-1:1);break;case"end":m[o]+=p*(r&&c?-1:1)}return m}const computePosition$1=async(e,t,r)=>{const{placement:s="bottom",strategy:n="absolute",middleware:i=[],platform:o}=r,a=i.filter(Boolean),l=await(null==o.isRTL?void 0:o.isRTL(t));let c=await o.getElementRects({reference:e,floating:t,strategy:n}),{x:u,y:d}=computeCoordsFromPlacement(c,s,l),p=s,m={},h=0;for(let x=0;x<a.length;x++){const{name:r,fn:i}=a[x],{x:f,y:g,data:y,reset:v}=await i({x:u,y:d,initialPlacement:s,placement:p,strategy:n,middlewareData:m,rects:c,platform:o,elements:{reference:e,floating:t}});u=null!=f?f:u,d=null!=g?g:d,m={...m,[r]:{...m[r],...y}},v&&h<=50&&(h++,"object"==typeof v&&(v.placement&&(p=v.placement),v.rects&&(c=!0===v.rects?await o.getElementRects({reference:e,floating:t,strategy:n}):v.rects),({x:u,y:d}=computeCoordsFromPlacement(c,p,l))),x=-1)}return{x:u,y:d,placement:p,strategy:n,middlewareData:m}};async function detectOverflow(e,t){var r;void 0===t&&(t={});const{x:s,y:n,platform:i,rects:o,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:p=!1,padding:m=0}=evaluate(t,e),h=getPaddingObject(m),x=a[p?"floating"===d?"reference":"floating":d],f=rectToClientRect(await i.getClippingRect({element:null==(r=await(null==i.isElement?void 0:i.isElement(x)))||r?x:x.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),g="floating"===d?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,y=await(null==i.getOffsetParent?void 0:i.getOffsetParent(a.floating)),v=await(null==i.isElement?void 0:i.isElement(y))&&await(null==i.getScale?void 0:i.getScale(y))||{x:1,y:1},E=rectToClientRect(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:y,strategy:l}):g);return{top:(f.top-E.top+h.top)/v.y,bottom:(E.bottom-f.bottom+h.bottom)/v.y,left:(f.left-E.left+h.left)/v.x,right:(E.right-f.right+h.right)/v.x}}const arrow$1=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:s,placement:n,rects:i,platform:o,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=evaluate(e,t)||{};if(null==c)return{};const d=getPaddingObject(u),p={x:r,y:s},m=getAlignmentAxis(n),h=getAxisLength(m),x=await o.getDimensions(c),f="y"===m,g=f?"top":"left",y=f?"bottom":"right",v=f?"clientHeight":"clientWidth",E=i.reference[h]+i.reference[m]-p[m]-i.floating[h],j=p[m]-i.reference[m],b=await(null==o.getOffsetParent?void 0:o.getOffsetParent(c));let w=b?b[v]:0;w&&await(null==o.isElement?void 0:o.isElement(b))||(w=a.floating[v]||i.floating[h]);const R=E/2-j/2,_=w/2-x[h]/2-1,S=min(d[g],_),C=min(d[y],_),k=S,$=w-x[h]-C,T=w/2-x[h]/2+R,I=clamp(k,T,$),P=!l.arrow&&null!=getAlignment(n)&&T!==I&&i.reference[h]/2-(T<k?S:C)-x[h]/2<0,A=P?T<k?T-k:T-$:0;return{[m]:p[m]+A,data:{[m]:I,centerOffset:T-I-A,...P&&{alignmentOffset:A}},reset:P}}}),flip$1=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,s;const{placement:n,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:h="none",flipAlignment:x=!0,...f}=evaluate(e,t);if(null!=(r=i.arrow)&&r.alignmentOffset)return{};const g=getSide(n),y=getSideAxis(a),v=getSide(a)===a,E=await(null==l.isRTL?void 0:l.isRTL(c.floating)),j=p||(v||!x?[getOppositePlacement(a)]:getExpandedPlacements(a)),b="none"!==h;!p&&b&&j.push(...getOppositeAxisPlacements(a,x,h,E));const w=[a,...j],R=await detectOverflow(t,f),_=[];let S=(null==(s=i.flip)?void 0:s.overflows)||[];if(u&&_.push(R[g]),d){const e=getAlignmentSides(n,o,E);_.push(R[e[0]],R[e[1]])}if(S=[...S,{placement:n,overflows:_}],!_.every(e=>e<=0)){var C,k;const e=((null==(C=i.flip)?void 0:C.index)||0)+1,t=w[e];if(t){if(!("alignment"===d&&y!==getSideAxis(t))||S.every(e=>getSideAxis(e.placement)!==y||e.overflows[0]>0))return{data:{index:e,overflows:S},reset:{placement:t}}}let r=null==(k=S.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:k.placement;if(!r)switch(m){case"bestFit":{var $;const e=null==($=S.filter(e=>{if(b){const t=getSideAxis(e.placement);return t===y||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:$[0];e&&(r=e);break}case"initialPlacement":r=a}if(n!==r)return{reset:{placement:r}}}return{}}}};function getSideOffsets(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function isAnySideFullyClipped(e){return sides.some(t=>e[t]>=0)}const hide$1=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:s="referenceHidden",...n}=evaluate(e,t);switch(s){case"referenceHidden":{const e=getSideOffsets(await detectOverflow(t,{...n,elementContext:"reference"}),r.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:isAnySideFullyClipped(e)}}}case"escaped":{const e=getSideOffsets(await detectOverflow(t,{...n,altBoundary:!0}),r.floating);return{data:{escapedOffsets:e,escaped:isAnySideFullyClipped(e)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(e,t){const{placement:r,platform:s,elements:n}=e,i=await(null==s.isRTL?void 0:s.isRTL(n.floating)),o=getSide(r),a=getAlignment(r),l="y"===getSideAxis(r),c=originSides.has(o)?-1:1,u=i&&l?-1:1,d=evaluate(t,e);let{mainAxis:p,crossAxis:m,alignmentAxis:h}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&"number"==typeof h&&(m="end"===a?-1*h:h),l?{x:m*u,y:p*c}:{x:p*c,y:m*u}}const offset$1=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var r,s;const{x:n,y:i,placement:o,middlewareData:a}=t,l=await convertValueToCoords(t,e);return o===(null==(r=a.offset)?void 0:r.placement)&&null!=(s=a.arrow)&&s.alignmentOffset?{}:{x:n+l.x,y:i+l.y,data:{...l,placement:o}}}}},shift$1=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:s,placement:n}=t,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=evaluate(e,t),c={x:r,y:s},u=await detectOverflow(t,l),d=getSideAxis(getSide(n)),p=getOppositeAxis(d);let m=c[p],h=c[d];if(i){const e="y"===p?"bottom":"right";m=clamp(m+u["y"===p?"top":"left"],m,m-u[e])}if(o){const e="y"===d?"bottom":"right";h=clamp(h+u["y"===d?"top":"left"],h,h-u[e])}const x=a.fn({...t,[p]:m,[d]:h});return{...x,data:{x:x.x-r,y:x.y-s,enabled:{[p]:i,[d]:o}}}}}},limitShift$1=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:r,y:s,placement:n,rects:i,middlewareData:o}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=evaluate(e,t),u={x:r,y:s},d=getSideAxis(n),p=getOppositeAxis(d);let m=u[p],h=u[d];const x=evaluate(a,t),f="number"==typeof x?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(l){const e="y"===p?"height":"width",t=i.reference[p]-i.floating[e]+f.mainAxis,r=i.reference[p]+i.reference[e]-f.mainAxis;m<t?m=t:m>r&&(m=r)}if(c){var g,y;const e="y"===p?"width":"height",t=originSides.has(getSide(n)),r=i.reference[d]-i.floating[e]+(t&&(null==(g=o.offset)?void 0:g[d])||0)+(t?0:f.crossAxis),s=i.reference[d]+i.reference[e]+(t?0:(null==(y=o.offset)?void 0:y[d])||0)-(t?f.crossAxis:0);h<r?h=r:h>s&&(h=s)}return{[p]:m,[d]:h}}}};function hasWindow(){return"undefined"!=typeof window}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function getDocumentElement(e){var t;return null==(t=(isNode(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function isNode(e){return!!hasWindow()&&(e instanceof Node||e instanceof getWindow(e).Node)}function isElement(e){return!!hasWindow()&&(e instanceof Element||e instanceof getWindow(e).Element)}function isHTMLElement(e){return!!hasWindow()&&(e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement)}function isShadowRoot(e){return!(!hasWindow()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot)}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(e){const{overflow:t,overflowX:r,overflowY:s,display:n}=getComputedStyle$1(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+r)&&!invalidOverflowDisplayValues.has(n)}const tableElements=new Set(["table","td","th"]);function isTableElement(e){return tableElements.has(getNodeName(e))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(e){return topLayerSelectors.some(t=>{try{return e.matches(t)}catch(r){return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(e){const t=isWebKit(),r=isElement(e)?getComputedStyle$1(e):e;return transformProperties.some(e=>!!r[e]&&"none"!==r[e])||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||willChangeValues.some(e=>(r.willChange||"").includes(e))||containValues.some(e=>(r.contain||"").includes(e))}function getContainingBlock(e){let t=getParentNode(e);for(;isHTMLElement(t)&&!isLastTraversableNode(t);){if(isContainingBlock(t))return t;if(isTopLayer(t))return null;t=getParentNode(t)}return null}function isWebKit(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(e){return lastTraversableNodeNames.has(getNodeName(e))}function getComputedStyle$1(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function getParentNode(e){if("html"===getNodeName(e))return e;const t=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(t)?t.host:t}function getNearestOverflowAncestor(e){const t=getParentNode(e);return isLastTraversableNode(t)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement(t)&&isOverflowElement(t)?t:getNearestOverflowAncestor(t)}function getOverflowAncestors(e,t,r){var s;void 0===t&&(t=[]),void 0===r&&(r=!0);const n=getNearestOverflowAncestor(e),i=n===(null==(s=e.ownerDocument)?void 0:s.body),o=getWindow(n);if(i){const e=getFrameElement(o);return t.concat(o,o.visualViewport||[],isOverflowElement(n)?n:[],e&&r?getOverflowAncestors(e):[])}return t.concat(n,getOverflowAncestors(n,[],r))}function getFrameElement(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function getCssDimensions(e){const t=getComputedStyle$1(e);let r=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=isHTMLElement(e),i=n?e.offsetWidth:r,o=n?e.offsetHeight:s,a=round(r)!==i||round(s)!==o;return a&&(r=i,s=o),{width:r,height:s,$:a}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){const t=unwrapElement(e);if(!isHTMLElement(t))return createCoords(1);const r=t.getBoundingClientRect(),{width:s,height:n,$:i}=getCssDimensions(t);let o=(i?round(r.width):r.width)/s,a=(i?round(r.height):r.height)/n;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}const noOffsets=createCoords(0);function getVisualOffsets(e){const t=getWindow(e);return isWebKit()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:noOffsets}function shouldAddVisualOffsets(e,t,r){return void 0===t&&(t=!1),!(!r||t&&r!==getWindow(e))&&t}function getBoundingClientRect(e,t,r,s){void 0===t&&(t=!1),void 0===r&&(r=!1);const n=e.getBoundingClientRect(),i=unwrapElement(e);let o=createCoords(1);t&&(s?isElement(s)&&(o=getScale(s)):o=getScale(e));const a=shouldAddVisualOffsets(i,r,s)?getVisualOffsets(i):createCoords(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,u=n.width/o.x,d=n.height/o.y;if(i){const e=getWindow(i),t=s&&isElement(s)?getWindow(s):s;let r=e,n=getFrameElement(r);for(;n&&s&&t!==r;){const e=getScale(n),t=n.getBoundingClientRect(),s=getComputedStyle$1(n),i=t.left+(n.clientLeft+parseFloat(s.paddingLeft))*e.x,o=t.top+(n.clientTop+parseFloat(s.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=i,c+=o,r=getWindow(n),n=getFrameElement(r)}}return rectToClientRect({width:u,height:d,x:l,y:c})}function getWindowScrollBarX(e,t){const r=getNodeScroll(e).scrollLeft;return t?t.left+r:getBoundingClientRect(getDocumentElement(e)).left+r}function getHTMLOffset(e,t){const r=e.getBoundingClientRect();return{x:r.left+t.scrollLeft-getWindowScrollBarX(e,r),y:r.top+t.scrollTop}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{elements:t,rect:r,offsetParent:s,strategy:n}=e;const i="fixed"===n,o=getDocumentElement(s),a=!!t&&isTopLayer(t.floating);if(s===o||a&&i)return r;let l={scrollLeft:0,scrollTop:0},c=createCoords(1);const u=createCoords(0),d=isHTMLElement(s);if((d||!d&&!i)&&(("body"!==getNodeName(s)||isOverflowElement(o))&&(l=getNodeScroll(s)),isHTMLElement(s))){const e=getBoundingClientRect(s);c=getScale(s),u.x=e.x+s.clientLeft,u.y=e.y+s.clientTop}const p=!o||d||i?createCoords(0):getHTMLOffset(o,l);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+p.x,y:r.y*c.y-l.scrollTop*c.y+u.y+p.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getDocumentRect(e){const t=getDocumentElement(e),r=getNodeScroll(e),s=e.ownerDocument.body,n=max(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),i=max(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-r.scrollLeft+getWindowScrollBarX(e);const a=-r.scrollTop;return"rtl"===getComputedStyle$1(s).direction&&(o+=max(t.clientWidth,s.clientWidth)-n),{width:n,height:i,x:o,y:a}}const SCROLLBAR_MAX=25;function getViewportRect(e,t){const r=getWindow(e),s=getDocumentElement(e),n=r.visualViewport;let i=s.clientWidth,o=s.clientHeight,a=0,l=0;if(n){i=n.width,o=n.height;const e=isWebKit();(!e||e&&"fixed"===t)&&(a=n.offsetLeft,l=n.offsetTop)}const c=getWindowScrollBarX(s);if(c<=0){const e=s.ownerDocument,t=e.body,r=getComputedStyle(t),n="CSS1Compat"===e.compatMode&&parseFloat(r.marginLeft)+parseFloat(r.marginRight)||0,o=Math.abs(s.clientWidth-t.clientWidth-n);o<=SCROLLBAR_MAX&&(i-=o)}else c<=SCROLLBAR_MAX&&(i+=c);return{width:i,height:o,x:a,y:l}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(e,t){const r=getBoundingClientRect(e,!0,"fixed"===t),s=r.top+e.clientTop,n=r.left+e.clientLeft,i=isHTMLElement(e)?getScale(e):createCoords(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:n*i.x,y:s*i.y}}function getClientRectFromClippingAncestor(e,t,r){let s;if("viewport"===t)s=getViewportRect(e,r);else if("document"===t)s=getDocumentRect(getDocumentElement(e));else if(isElement(t))s=getInnerBoundingClientRect(t,r);else{const r=getVisualOffsets(e);s={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return rectToClientRect(s)}function hasFixedPositionAncestor(e,t){const r=getParentNode(e);return!(r===t||!isElement(r)||isLastTraversableNode(r))&&("fixed"===getComputedStyle$1(r).position||hasFixedPositionAncestor(r,t))}function getClippingElementAncestors(e,t){const r=t.get(e);if(r)return r;let s=getOverflowAncestors(e,[],!1).filter(e=>isElement(e)&&"body"!==getNodeName(e)),n=null;const i="fixed"===getComputedStyle$1(e).position;let o=i?getParentNode(e):e;for(;isElement(o)&&!isLastTraversableNode(o);){const t=getComputedStyle$1(o),r=isContainingBlock(o);r||"fixed"!==t.position||(n=null);(i?!r&&!n:!r&&"static"===t.position&&!!n&&absoluteOrFixed.has(n.position)||isOverflowElement(o)&&!r&&hasFixedPositionAncestor(e,o))?s=s.filter(e=>e!==o):n=t,o=getParentNode(o)}return t.set(e,s),s}function getClippingRect(e){let{element:t,boundary:r,rootBoundary:s,strategy:n}=e;const i=[..."clippingAncestors"===r?isTopLayer(t)?[]:getClippingElementAncestors(t,this._c):[].concat(r),s],o=i[0],a=i.reduce((e,r)=>{const s=getClientRectFromClippingAncestor(t,r,n);return e.top=max(s.top,e.top),e.right=min(s.right,e.right),e.bottom=min(s.bottom,e.bottom),e.left=max(s.left,e.left),e},getClientRectFromClippingAncestor(t,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function getDimensions(e){const{width:t,height:r}=getCssDimensions(e);return{width:t,height:r}}function getRectRelativeToOffsetParent(e,t,r){const s=isHTMLElement(t),n=getDocumentElement(t),i="fixed"===r,o=getBoundingClientRect(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const l=createCoords(0);function c(){l.x=getWindowScrollBarX(n)}if(s||!s&&!i)if(("body"!==getNodeName(t)||isOverflowElement(n))&&(a=getNodeScroll(t)),s){const e=getBoundingClientRect(t,!0,i,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else n&&c();i&&!s&&n&&c();const u=!n||s||i?createCoords(0):getHTMLOffset(n,a);return{x:o.left+a.scrollLeft-l.x-u.x,y:o.top+a.scrollTop-l.y-u.y,width:o.width,height:o.height}}function isStaticPositioned(e){return"static"===getComputedStyle$1(e).position}function getTrueOffsetParent(e,t){if(!isHTMLElement(e)||"fixed"===getComputedStyle$1(e).position)return null;if(t)return t(e);let r=e.offsetParent;return getDocumentElement(e)===r&&(r=r.ownerDocument.body),r}function getOffsetParent(e,t){const r=getWindow(e);if(isTopLayer(e))return r;if(!isHTMLElement(e)){let t=getParentNode(e);for(;t&&!isLastTraversableNode(t);){if(isElement(t)&&!isStaticPositioned(t))return t;t=getParentNode(t)}return r}let s=getTrueOffsetParent(e,t);for(;s&&isTableElement(s)&&isStaticPositioned(s);)s=getTrueOffsetParent(s,t);return s&&isLastTraversableNode(s)&&isStaticPositioned(s)&&!isContainingBlock(s)?r:s||getContainingBlock(e)||r}const getElementRects=async function(e){const t=this.getOffsetParent||getOffsetParent,r=this.getDimensions,s=await r(e.floating);return{reference:getRectRelativeToOffsetParent(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function isRTL(e){return"rtl"===getComputedStyle$1(e).direction}const platform={convertOffsetParentRelativeRectToViewportRelativeRect:convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement:getDocumentElement,getClippingRect:getClippingRect,getOffsetParent:getOffsetParent,getElementRects:getElementRects,getClientRects:getClientRects,getDimensions:getDimensions,getScale:getScale,isElement:isElement,isRTL:isRTL};function rectsAreEqual(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function observeMove(e,t){let r,s=null;const n=getDocumentElement(e);function i(){var e;clearTimeout(r),null==(e=s)||e.disconnect(),s=null}return function o(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),i();const c=e.getBoundingClientRect(),{left:u,top:d,width:p,height:m}=c;if(a||t(),!p||!m)return;const h={rootMargin:-floor(d)+"px "+-floor(n.clientWidth-(u+p))+"px "+-floor(n.clientHeight-(d+m))+"px "+-floor(u)+"px",threshold:max(0,min(1,l))||1};let x=!0;function f(t){const s=t[0].intersectionRatio;if(s!==l){if(!x)return o();s?o(!1,s):r=setTimeout(()=>{o(!1,1e-7)},1e3)}1!==s||rectsAreEqual(c,e.getBoundingClientRect())||o(),x=!1}try{s=new IntersectionObserver(f,{...h,root:n.ownerDocument})}catch(g){s=new IntersectionObserver(f,h)}s.observe(e)}(!0),i}function autoUpdate(e,t,r,s){void 0===s&&(s={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:a="function"==typeof IntersectionObserver,animationFrame:l=!1}=s,c=unwrapElement(e),u=n||i?[...c?getOverflowAncestors(c):[],...getOverflowAncestors(t)]:[];u.forEach(e=>{n&&e.addEventListener("scroll",r,{passive:!0}),i&&e.addEventListener("resize",r)});const d=c&&a?observeMove(c,r):null;let p,m=-1,h=null;o&&(h=new ResizeObserver(e=>{let[s]=e;s&&s.target===c&&h&&(h.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var e;null==(e=h)||e.observe(t)})),r()}),c&&!l&&h.observe(c),h.observe(t));let x=l?getBoundingClientRect(e):null;return l&&function t(){const s=getBoundingClientRect(e);x&&!rectsAreEqual(x,s)&&r();x=s,p=requestAnimationFrame(t)}(),r(),()=>{var e;u.forEach(e=>{n&&e.removeEventListener("scroll",r),i&&e.removeEventListener("resize",r)}),null==d||d(),null==(e=h)||e.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const offset=offset$1,shift=shift$1,flip=flip$1,hide=hide$1,arrow=arrow$1,limitShift=limitShift$1,computePosition=(e,t,r)=>{const s=new Map,n={platform:platform,...r},i={...n.platform,_c:s};return computePosition$1(e,t,{...n,platform:i})};let tenPxTester=null,tester=null;function convertPx(e){return null===tenPxTester||null===tester||10===tenPxTester.getBoundingClientRect().height?e:(tester.style.setProperty("--size",e.toString()),tester.getBoundingClientRect().height)}canUseDom&&(tenPxTester=document.createElement("div"),tenPxTester.className="adm-px-tester",tenPxTester.style.setProperty("--size","10"),document.body.appendChild(tenPxTester),tester=document.createElement("div"),tester.className="adm-px-tester",document.body.appendChild(tester));const Arrow=reactExports.memo(e=>withNativeProps(e,React$2.createElement("svg",{viewBox:"0 0 30 16"},React$2.createElement("g",{fill:"currentColor"},React$2.createElement("path",{d:"M0,0 L30,0 L18.07289,14.312538 C16.65863,16.009645 14.13637,16.238942 12.43926,14.824685 C12.25341,14.669808 12.08199,14.49839 11.92711,14.312538 L0,0 L0,0 Z"}))))),record={topLeft:"top-start",topRight:"top-end",bottomLeft:"bottom-start",bottomRight:"bottom-end",leftTop:"left-start",leftBottom:"left-end",rightTop:"right-start",rightBottom:"right-end"};function normalizePlacement(e){var t;return null!==(t=record[e])&&void 0!==t?t:e}class Wrapper extends React$2.Component{constructor(){super(...arguments),this.element=null}componentDidMount(){this.componentDidUpdate()}componentDidUpdate(){const e=reactDomExports.findDOMNode(this);e instanceof Element?this.element=e:this.element=null}render(){return React$2.Children.only(this.props.children)}}const classPrefix$l="adm-popover",defaultProps$h={placement:"top",defaultVisible:!1,stopPropagation:["click"],getContainer:()=>document.body,mode:"light"},Popover$1=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$h,e),s=normalizePlacement(r.placement),[n,i]=usePropsValue({value:r.visible,defaultValue:r.defaultVisible,onChange:r.onVisibleChange});reactExports.useImperativeHandle(t,()=>({show:()=>i(!0),hide:()=>i(!1),visible:n}),[n]);const o=reactExports.useRef(null),a=reactExports.useRef(null),l=reactExports.useRef(null),c=withStopPropagation(r.stopPropagation,withNativeProps(r,React$2.createElement("div",{className:classNames$1(classPrefix$l,`${classPrefix$l}-${r.mode}`,{[`${classPrefix$l}-hidden`]:!n}),ref:a},React$2.createElement("div",{className:`${classPrefix$l}-arrow`,ref:l},React$2.createElement(Arrow,{className:`${classPrefix$l}-arrow-icon`})),React$2.createElement("div",{className:`${classPrefix$l}-inner`},React$2.createElement("div",{className:`${classPrefix$l}-inner-content`},r.content))))),[u,d]=reactExports.useState(null);function p(){var e,t,r;return __awaiter$1(this,void 0,void 0,function*(){const n=null!==(t=null===(e=o.current)||void 0===e?void 0:e.element)&&void 0!==t?t:null,i=a.current,c=l.current;if(d(n),!n||!i||!c)return;const{x:u,y:p,placement:m,middlewareData:h}=yield computePosition(n,i,{placement:s,middleware:[offset(convertPx(12)),shift({padding:convertPx(4),crossAxis:!1,limiter:limitShift()}),flip(),hide(),arrow({element:c,padding:convertPx(12)})]});Object.assign(i.style,{left:`${u}px`,top:`${p}px`});const x=m.split("-")[0],f={top:"bottom",right:"left",bottom:"top",left:"right"}[x],{x:g,y:y}=null!==(r=h.arrow)&&void 0!==r?r:{};Object.assign(c.style,{left:null!=g?`${g}px`:"",top:null!=y?`${y}px`:"",right:"",bottom:"",[f]:"calc(var(--arrow-size) * -1)"});const v={top:"0deg",bottom:"180deg",left:"270deg",right:"90deg"}[x];c.style.setProperty("--arrow-icon-rotate",v)})}useIsomorphicLayoutEffect$1(()=>{p()}),reactExports.useEffect(()=>{if(u&&r.trigger)return u.addEventListener("click",e),()=>{u.removeEventListener("click",e)};function e(){i(e=>!e)}},[u,r.trigger]),reactExports.useEffect(()=>{const e=a.current;if(u&&e&&n)return autoUpdate(u,e,p,{elementResize:"undefined"!=typeof ResizeObserver})},[u,n]),useClickAway(()=>{r.trigger&&i(!1)},[()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.element},a],["click","touchmove"]);const m=useShouldRender(n,!1,r.destroyOnHide);return React$2.createElement(React$2.Fragment,null,React$2.createElement(Wrapper,{ref:o},r.children),m&&renderToContainer(r.getContainer,c))}),classPrefix$k="adm-popover-menu",PopoverMenu=reactExports.forwardRef((e,t)=>{const r=reactExports.useRef(null);reactExports.useImperativeHandle(t,()=>r.current,[]);const s=reactExports.useCallback(t=>{var s;const{onAction:n}=e;n&&n(t),null===(s=r.current)||void 0===s||s.hide()},[e.onAction]),n=reactExports.useMemo(()=>{const t=(null==e?void 0:e.maxCount)&&e.actions.length>(null==e?void 0:e.maxCount),r=(null==e?void 0:e.maxCount)&&48*(null==e?void 0:e.maxCount);return React$2.createElement("div",{className:`${classPrefix$k}-list`},React$2.createElement("div",{className:classNames$1(`${classPrefix$k}-list-inner`,{[`${classPrefix$k}-list-scroll`]:t}),style:{height:r}},e.actions.map((e,t)=>{var r;return React$2.createElement("a",{key:null!==(r=e.key)&&void 0!==r?r:t,className:classNames$1(`${classPrefix$k}-item`,"adm-plain-anchor",{[`${classPrefix$k}-item-disabled`]:e.disabled}),onClick:()=>{var t;e.disabled||(s(e),null===(t=e.onClick)||void 0===t||t.call(e))}},e.icon&&React$2.createElement("div",{className:`${classPrefix$k}-item-icon`},e.icon),React$2.createElement("div",{className:`${classPrefix$k}-item-text`},e.text))})))},[e.actions,s]);return React$2.createElement(Popover$1,Object.assign({ref:r},e,{className:classNames$1(classPrefix$k,e.className),content:n}),e.children)}),Popover=attachPropertiesToComponent(Popover$1,{Menu:PopoverMenu});function toArray(e){return void 0===e||!1===e?[]:Array.isArray(e)?e:[e]}function shouldConstruct(e){const t=e.prototype;return!(!t||!t.isReactComponent)}function isSimpleFunctionComponent(e){return"function"==typeof e&&!shouldConstruct(e)&&void 0===e.defaultProps}function isSafeSetRefComponent(e){return!reactIsExports.isFragment(e)&&(reactIsExports.isMemo(e)?isSafeSetRefComponent(e.type):!isSimpleFunctionComponent(e.type))}const NAME_SPLIT="__SPLIT__",classPrefix$j="adm-form-item",MemoInput=React$2.memo(({children:e})=>e,(e,t)=>e.value===t.value&&e.update===t.update),FormItemLayout=e=>{var t;const{locale:r,form:s={}}=useConfig(),{style:n,extra:i,label:o,help:a,helpIcon:l,required:c,children:u,htmlFor:d,hidden:p,arrow:m,arrowIcon:h,childElementPosition:x="normal"}=mergeProps(s,e),f=reactExports.useContext(FormContext),g=void 0!==e.hasFeedback?e.hasFeedback:f.hasFeedback,y=e.layout||f.layout,v=null!==(t=e.disabled)&&void 0!==t?t:f.disabled,E=(()=>{const{requiredMarkStyle:e}=f;switch(e){case"asterisk":return c&&React$2.createElement("span",{className:`${classPrefix$j}-required-asterisk`},"*");case"text-required":return c&&React$2.createElement("span",{className:`${classPrefix$j}-required-text`},"(",r.Form.required,")");case"text-optional":return!c&&React$2.createElement("span",{className:`${classPrefix$j}-required-text`},"(",r.Form.optional,")");default:return null}})(),j=!!o&&React$2.createElement("label",{className:`${classPrefix$j}-label`,htmlFor:d},o,E,a&&React$2.createElement(Popover,{content:a,mode:"dark",trigger:"click"},React$2.createElement("span",{className:`${classPrefix$j}-label-help`,onClick:e=>{e.stopPropagation(),e.preventDefault()}},l||React$2.createElement(QuestionCircleOutline,null)))),b=(!!e.description||g)&&React$2.createElement(React$2.Fragment,null,e.description,g&&React$2.createElement(React$2.Fragment,null,e.errors.map((e,t)=>React$2.createElement("div",{key:`error-${t}`,className:`${classPrefix$j}-feedback-error`},e)),e.warnings.map((e,t)=>React$2.createElement("div",{key:`warning-${t}`,className:`${classPrefix$j}-feedback-warning`},e))));return withNativeProps(e,React$2.createElement(List$1.Item,{style:n,title:"vertical"===y&&j,prefix:"horizontal"===y&&j,extra:i,description:b,className:classNames$1(classPrefix$j,`${classPrefix$j}-${y}`,{[`${classPrefix$j}-hidden`]:p,[`${classPrefix$j}-has-error`]:e.errors.length}),disabled:v,onClick:e.onClick,clickable:e.clickable,arrowIcon:h||m},React$2.createElement("div",{className:classNames$1(`${classPrefix$j}-child`,`${classPrefix$j}-child-position-${x}`)},React$2.createElement("div",{className:classNames$1(`${classPrefix$j}-child-inner`)},u))))},FormItem=e=>{const{style:t,label:r,help:s,helpIcon:n,extra:i,hasFeedback:o,name:a,required:l,noStyle:c,hidden:u,layout:d,childElementPosition:p,description:m,disabled:h,rules:x,children:f,messageVariables:g,trigger:y="onChange",validateTrigger:v=y,onClick:E,shouldUpdate:j,dependencies:b,clickable:w,arrow:R,arrowIcon:_}=e,S=__rest$1(e,["style","label","help","helpIcon","extra","hasFeedback","name","required","noStyle","hidden","layout","childElementPosition","description","disabled","rules","children","messageVariables","trigger","validateTrigger","onClick","shouldUpdate","dependencies","clickable","arrow","arrowIcon"]),{name:C}=reactExports.useContext(FormContext),{validateTrigger:k}=reactExports.useContext(default_1),$=undefinedFallback(v,k,y),T=reactExports.useRef(null),I=reactExports.useRef(0);I.current+=1;const[P,A]=reactExports.useState({}),F=reactExports.useCallback((e,t)=>{A(r=>{const s=Object.assign({},r),n=t.join(NAME_SPLIT);return e.destroy?delete s[n]:s[n]=e,s})},[A]);function M(a,l,x,f){var g,y;if(c&&!u)return a;const v=null!==(g=null==x?void 0:x.errors)&&void 0!==g?g:[],j=Object.keys(P).reduce((e,t)=>{var r,s;const n=null!==(s=null===(r=P[t])||void 0===r?void 0:r.errors)&&void 0!==s?s:[];return n.length&&(e=[...e,...n]),e},v),b=null!==(y=null==x?void 0:x.warnings)&&void 0!==y?y:[],S=Object.keys(P).reduce((e,t)=>{var r,s;const n=null!==(s=null===(r=P[t])||void 0===r?void 0:r.warnings)&&void 0!==s?s:[];return n.length&&(e=[...e,...n]),e},b);return withNativeProps(e,React$2.createElement(FormItemLayout,{style:t,label:r,extra:i,help:s,helpIcon:n,description:m,required:f,disabled:h,hasFeedback:o,htmlFor:l,errors:j,warnings:S,onClick:E&&(e=>E(e,T)),hidden:u,layout:d,childElementPosition:p,clickable:w,arrow:R,arrowIcon:_},React$2.createElement(NoStyleItemContext.Provider,{value:F},a)))}const D="function"==typeof f;if(!a&&!D&&!e.dependencies)return M(f);let O={};O.label="string"==typeof r?r:"",g&&(O=Object.assign(Object.assign({},O),g));const N=reactExports.useContext(NoStyleItemContext);return React$2.createElement(WrapperField,Object.assign({},S,{name:a,shouldUpdate:j,dependencies:b,rules:x,trigger:y,validateTrigger:$,onMetaChange:e=>{if(c&&N){const t=e.name;N(e,t)}},messageVariables:O}),(t,r,s)=>{let n=null;const i=void 0!==l?l:x&&x.some(e=>!(!e||"object"!=typeof e||!e.required)),o=toArray(a).length&&r?r.name:[],c=(o.length>0&&C?[C,...o]:o).join("_");if(D)!j&&!b||a||(n=f(s));else if(b&&!a);else if(React$2.isValidElement(f)){f.props.defaultValue;const r=Object.assign(Object.assign({},f.props),t);isSafeSetRefComponent(f)&&(r.ref=e=>{const t=f.ref;t&&("function"==typeof t&&t(e),"current"in t&&(t.current=e)),T.current=e}),r.id||(r.id=c);new Set([...toArray(y),...toArray($)]).forEach(e=>{r[e]=(...r)=>{var s,n,i;null===(s=t[e])||void 0===s||s.call(t,...r),null===(i=(n=f.props)[e])||void 0===i||i.call(n,...r)}}),n=React$2.createElement(MemoInput,{value:t[e.valuePropName||"value"],update:I.current},React$2.cloneElement(f,r))}else n=f;return M(n,c,r,i)})},FormSubscribe=e=>{const t=useUpdate(),r=reactExports.useContext(Context$1),s=r.getFieldsValue(e.to),n=React$2.useMemo(()=>e.children(s,r),[JSON.stringify(s),e.children]);return React$2.createElement(React$2.Fragment,null,n,e.to.map(e=>React$2.createElement(Watcher,{key:e.toString(),form:r,namePath:e,onChange:t})))},Watcher=reactExports.memo(e=>{const t=useWatch(e.namePath,e.form);return useIsomorphicUpdateLayoutEffect(()=>{e.onChange()},[t]),null}),Form=attachPropertiesToComponent(Form$1,{Item:FormItem,Subscribe:FormSubscribe,Header:Header$1,Array:FormArray,useForm:useForm,useWatch:useWatch}),classPrefix$i="adm-grid",Grid$1=e=>{const t={"--columns":e.columns.toString()},{gap:r}=e;return void 0!==r&&(Array.isArray(r)?(t["--gap-horizontal"]=toCSSLength(r[0]),t["--gap-vertical"]=toCSSLength(r[1])):t["--gap"]=toCSSLength(r)),withNativeProps(e,React$2.createElement("div",{className:classPrefix$i,style:t},e.children))},GridItem=e=>{const t=mergeProps({span:1},e),r={"--item-span":t.span};return withNativeProps(t,React$2.createElement("div",{className:`${classPrefix$i}-item`,style:r,onClick:t.onClick},t.children))},Grid=attachPropertiesToComponent(Grid$1,{Item:GridItem}),create=()=>[1,0,0,1,0,0],getTranslateX=e=>e[4],getTranslateY=e=>e[5],getScaleX=e=>e[0],translate=(e,t,r)=>multiply([1,0,0,1,t,r],e),scale=(e,t,r=t)=>multiply([t,0,0,r,0,0],e),apply=(e,[t,r])=>[e[0]*t+e[2]*r+e[4],e[1]*t+e[3]*r+e[5]],multiply=(e,t)=>[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]],useDragAndPinch=createUseGesture([dragAction,pinchAction]),classPrefix$h="adm-image-viewer",Slide=e=>{const{dragLockRef:t,maxZoom:r,imageRender:s,index:n}=e,i=reactExports.useRef([]),o=reactExports.useRef(null),a=reactExports.useRef(null),[{matrix:l},c]=useSpring(()=>({matrix:create(),config:{tension:200}})),u=useSize(o),d=useSize(a),p=reactExports.useRef(!1),m=e=>{if(!u||!d)return{x:{position:0,minX:0,maxX:0},y:{position:0,minY:0,maxY:0}};const t=-u.width/2,r=-u.height/2,s=-d.width/2,n=-d.height/2,i=getScaleX(e),o=i*d.width,a=i*d.height,l=t-(o-u.width),c=t,p=r-(a-u.height),m=r,[h,x]=apply(e,[s,n]);return{x:{position:h,minX:l,maxX:c},y:{position:x,minY:p,maxY:m}}},h=(e,t,r,s=0)=>[e<=t-s,e>=r+s],x=(e,t,r=!1)=>{if(!u||!d)return e;const s=getScaleX(e),n=s*d.width,i=s*d.height,{x:{position:o,minX:a,maxX:l},y:{position:c,minY:p,maxY:h}}=m(e);if("translate"===t){let t=o,d=c;return t=n>u.width?r?bound(o,a,l):rubberbandIfOutOfBounds(o,a,l,50*s):-n/2,d=i>u.height?r?bound(c,p,h):rubberbandIfOutOfBounds(c,p,h,50*s):-i/2,translate(e,t-o,d-c)}if("scale"===t&&r){const[t,r]=[n>u.width?bound(o,a,l):-n/2,i>u.height?bound(c,p,h):-i/2];return translate(e,t-o,r-c)}return e};useDragAndPinch({onDrag:r=>{var s;if(r.first){const{x:{position:e,minX:t,maxX:r}}=m(l.get());return void(i.current=h(e,t,r))}if(r.pinching)return r.cancel();if(r.tap&&r.elapsedTime>0&&r.elapsedTime<1e3)return void(null===(s=e.onTap)||void 0===s||s.call(e));const n=getScaleX(l.get());if(t&&(t.current=1!==n),!p.current&&n<=1)c.start({matrix:create()});else{const e=l.get(),s=[r.offset[0]-getTranslateX(e),r.offset[1]-getTranslateY(e)],n=translate(e,...r.last?[s[0]+r.velocity[0]*r.direction[0]*200,s[1]+r.velocity[1]*r.direction[1]*200]:s);c.start({matrix:x(n,"translate",r.last),immediate:!r.last});const{x:{position:o,minX:a,maxX:u}}=m(n);r.last&&i.current.some(e=>e)&&h(o,a,u).some(e=>e)&&(t&&(t.current=!1),c.start({matrix:create()}))}},onPinch:s=>{var n;p.current=!s.last;const[i]=s.offset;if(i<0)return;let o;o="auto"===r?u&&d?Math.max(u.height/d.height,u.width/d.width):1:r;const a=s.last?bound(i,1,o):i;if(null===(n=e.onZoomChange)||void 0===n||n.call(e,a),s.last&&a<=1)c.start({matrix:create()}),t&&(t.current=!1);else{if(!u)return;const e=l.get(),r=getScaleX(e),n=s.origin[0]-u.width/2,i=s.origin[1]-u.height/2;let o=translate(e,-n,-i);o=scale(o,a/r),o=translate(o,n,i),c.start({matrix:x(o,"scale",s.last),immediate:!s.last}),t&&(t.current=!0)}}},{target:o,drag:{from:()=>[getTranslateX(l.get()),getTranslateY(l.get())],pointer:{touch:!0}},pinch:{from:()=>[getScaleX(l.get()),0],pointer:{touch:!0}}});const f="function"==typeof s&&s(e.image,{index:n});return React$2.createElement("div",{className:`${classPrefix$h}-slide`},React$2.createElement("div",{className:`${classPrefix$h}-control`,ref:o},React$2.createElement(animated.div,{className:`${classPrefix$h}-image-wrapper`,style:{matrix:l}},f||React$2.createElement("img",{ref:a,src:e.image,draggable:!1,alt:e.image}))))},classPrefix$g="adm-image-viewer",Slides=reactExports.forwardRef((e,t)=>{const r=window.innerWidth+convertPx(16),[{x:s},n]=useSpring(()=>({x:e.defaultIndex*r,config:{tension:250,clamp:!0}})),i=e.images.length;function o(t,s=!1){var o;const a=bound(t,0,i-1);null===(o=e.onIndexChange)||void 0===o||o.call(e,a),n.start({x:a*r,immediate:s})}reactExports.useImperativeHandle(t,()=>({swipeTo:o}));const a=reactExports.useRef(!1),l=useDrag(e=>{if(a.current)return;const[t]=e.offset;if(e.last){const s=Math.floor(t/r),n=s+1,i=Math.min(2e3*e.velocity[0],r)*e.direction[0];o(bound(Math.round((t+i)/r),s,n))}else n.start({x:t,immediate:!0})},{transform:([e,t])=>[-e,t],from:()=>[s.get(),0],bounds:()=>({left:0,right:(i-1)*r}),rubberband:!0,axis:"x",pointer:{touch:!0}});return React$2.createElement("div",Object.assign({className:`${classPrefix$g}-slides`},l()),React$2.createElement(animated.div,{className:`${classPrefix$g}-indicator`},s.to(e=>`${bound(Math.round(e/r),0,i-1)+1} / ${i}`)),React$2.createElement(animated.div,{className:`${classPrefix$g}-slides-inner`,style:{x:s.to(e=>-e)}},e.images.map((t,i)=>React$2.createElement(Slide,{key:i,image:t,onTap:e.onTap,maxZoom:e.maxZoom,imageRender:e.imageRender,index:i,onZoomChange:e=>{if(1!==e){const e=Math.round(s.get()/r);n.start({x:e*r})}},dragLockRef:a}))))}),classPrefix$f="adm-image-viewer",defaultProps$g={maxZoom:3,getContainer:null,visible:!1},ImageViewer$1=e=>{var t,r,s;const n=mergeProps(defaultProps$g,e),i=React$2.createElement(Mask,{visible:n.visible,disableBodyScroll:!1,opacity:"thick",afterClose:n.afterClose,destroyOnClose:!0,className:null===(t=null==n?void 0:n.classNames)||void 0===t?void 0:t.mask},React$2.createElement("div",{className:classNames$1(`${classPrefix$f}-content`,null===(r=null==n?void 0:n.classNames)||void 0===r?void 0:r.body)},(n.image||"function"==typeof n.imageRender)&&React$2.createElement(Slide,{image:n.image,onTap:n.onClose,maxZoom:n.maxZoom,imageRender:n.imageRender})),n.image&&React$2.createElement("div",{className:`${classPrefix$f}-footer`},null===(s=n.renderFooter)||void 0===s?void 0:s.call(n,n.image),React$2.createElement(SafeArea,{position:"bottom"})));return renderToContainer(n.getContainer,i)},multiDefaultProps=Object.assign(Object.assign({},defaultProps$g),{defaultIndex:0}),MultiImageViewer=reactExports.forwardRef((e,t)=>{var r,s,n;const i=mergeProps(multiDefaultProps,e),[o,a]=reactExports.useState(i.defaultIndex),l=reactExports.useRef(null);reactExports.useImperativeHandle(t,()=>({swipeTo:(e,t)=>{var r;a(e),null===(r=l.current)||void 0===r||r.swipeTo(e,t)}}));const c=reactExports.useCallback(e=>{var t;e!==o&&(a(e),null===(t=i.onIndexChange)||void 0===t||t.call(i,e))},[i.onIndexChange,o]),u=React$2.createElement(Mask,{visible:i.visible,disableBodyScroll:!1,opacity:"thick",afterClose:i.afterClose,destroyOnClose:!0,className:null===(r=null==i?void 0:i.classNames)||void 0===r?void 0:r.mask},React$2.createElement("div",{className:classNames$1(`${classPrefix$f}-content`,null===(s=null==i?void 0:i.classNames)||void 0===s?void 0:s.body)},i.images&&React$2.createElement(Slides,{ref:l,defaultIndex:o,onIndexChange:c,images:i.images,onTap:i.onClose,maxZoom:i.maxZoom,imageRender:i.imageRender})),i.images&&React$2.createElement("div",{className:`${classPrefix$f}-footer`},null===(n=i.renderFooter)||void 0===n?void 0:n.call(i,i.images[o],o),React$2.createElement(SafeArea,{position:"bottom"})));return renderToContainer(i.getContainer,u)}),handlerSet=new Set;function showImageViewer(e){clearImageViewer();const t=renderImperatively(React$2.createElement(ImageViewer$1,Object.assign({},e,{afterClose:()=>{var r;handlerSet.delete(t),null===(r=e.afterClose)||void 0===r||r.call(e)}})));return handlerSet.add(t),t}function showMultiImageViewer(e){clearImageViewer();const t=renderImperatively(React$2.createElement(MultiImageViewer,Object.assign({},e,{afterClose:()=>{var r;handlerSet.delete(t),null===(r=e.afterClose)||void 0===r||r.call(e)}})));return handlerSet.add(t),t}function clearImageViewer(){handlerSet.forEach(e=>{e.close()}),handlerSet.clear()}const Multi=attachPropertiesToComponent(MultiImageViewer,{show:showMultiImageViewer}),ImageViewer=attachPropertiesToComponent(ImageViewer$1,{Multi:Multi,show:showImageViewer,clear:clearImageViewer}),classPrefix$e="adm-space",defaultProps$f={direction:"horizontal"},Space=e=>{const t=mergeProps(defaultProps$f,e),{direction:r,onClick:s}=t;return withNativeProps(t,React$2.createElement("div",{className:classNames$1(classPrefix$e,{[`${classPrefix$e}-wrap`]:t.wrap,[`${classPrefix$e}-block`]:t.block,[`${classPrefix$e}-${r}`]:!0,[`${classPrefix$e}-align-${t.align}`]:!!t.align,[`${classPrefix$e}-justify-${t.justify}`]:!!t.justify}),onClick:s},React$2.Children.map(t.children,e=>null!=e&&React$2.createElement("div",{className:`${classPrefix$e}-item`},e))))},classPrefix$d="adm-image-uploader",PreviewItem=e=>{const{locale:t}=useConfig(),{url:r,file:s,deletable:n,deleteIcon:i,onDelete:o,imageFit:a}=e,l=reactExports.useMemo(()=>r||(s?URL.createObjectURL(s):""),[r,s]);return reactExports.useEffect(()=>()=>{s&&URL.revokeObjectURL(l)},[l,s]),React$2.createElement("div",{className:classNames$1(`${classPrefix$d}-cell`,"fail"===e.status&&`${classPrefix$d}-cell-fail`)},React$2.createElement(Image$1,{className:`${classPrefix$d}-cell-image`,src:l,fit:a,onClick:e.onClick}),"pending"===e.status&&React$2.createElement("div",{className:`${classPrefix$d}-cell-mask`},React$2.createElement("span",{className:`${classPrefix$d}-cell-loading`},React$2.createElement(SpinLoading,{color:"white"}),React$2.createElement("span",{className:`${classPrefix$d}-cell-mask-message`},t.ImageUploader.uploading))),n&&React$2.createElement("span",{className:`${classPrefix$d}-cell-delete`,onClick:o},i))},classPrefix$c="adm-image-uploader",defaultProps$e={disableUpload:!1,deletable:!0,deleteIcon:React$2.createElement(CloseOutline,{className:`${classPrefix$c}-cell-delete-icon`}),showUpload:!0,multiple:!1,maxCount:0,defaultValue:[],accept:"image/*",preview:!0,showFailed:!0,imageFit:"cover"},ImageUploader=reactExports.forwardRef((e,t)=>{const{locale:r}=useConfig(),s=mergeProps(defaultProps$e,e),{columns:n}=s,[i,o]=usePropsValue(s),[a,l]=reactExports.useState([]),c=reactExports.useRef(null),u=useSize(c),d=reactExports.useRef(null),[p,m]=reactExports.useState(80),h=reactExports.useRef(null);useIsomorphicLayoutEffect$1(()=>{const e=d.current;if(n&&u&&e){const t=u.width,r=measureCSSLength(window.getComputedStyle(e).getPropertyValue("height"));m((t-r*(n-1))/n)}},[null==u?void 0:u.width]);const x={"--cell-size":p+"px"};useIsomorphicLayoutEffect$1(()=>{l(e=>e.filter(e=>void 0===e.url||!i.some(t=>t.url===e.url)))},[i]),useIsomorphicLayoutEffect$1(()=>{var e;null===(e=s.onUploadQueueChange)||void 0===e||e.call(s,a.map(e=>({id:e.id,status:e.status})))},[a]);const f=reactExports.useRef(0),{maxCount:g,onPreview:y,renderItem:v}=s;function E(e){return s.showFailed?e:e.filter(e=>"fail"!==e.status)}const j=reactExports.useRef(null);useUnmount(()=>{var e;null===(e=j.current)||void 0===e||e.close()});const b=E(a),w=s.showUpload&&(0===g||i.length+b.length<g),R=React$2.createElement(React$2.Fragment,null,i.map((e,t)=>{var r,n;const a=React$2.createElement(PreviewItem,{key:null!==(r=e.key)&&void 0!==r?r:t,url:null!==(n=e.thumbnailUrl)&&void 0!==n?n:e.url,deletable:s.deletable,deleteIcon:s.deleteIcon,imageFit:s.imageFit,onClick:()=>{s.preview&&function(e){j.current=ImageViewer.Multi.show({images:i.map(e=>e.url),defaultIndex:e,onClose:()=>{j.current=null}})}(t),y&&y(t,e)},onDelete:()=>__awaiter$1(void 0,void 0,void 0,function*(){var r;!1!==(yield null===(r=s.onDelete)||void 0===r?void 0:r.call(s,e))&&o(i.filter((e,r)=>r!==t))})});return v?v(a,e,i):a}),a.map(e=>s.showFailed||"fail"!==e.status?React$2.createElement(PreviewItem,{key:e.id,file:e.file,deletable:"pending"!==e.status,deleteIcon:s.deleteIcon,status:e.status,imageFit:s.imageFit,onDelete:()=>{l(a.filter(t=>t.id!==e.id))}}):null),React$2.createElement("div",{className:`${classPrefix$c}-upload-button-wrap`,style:w?void 0:{display:"none"}},s.children||React$2.createElement("span",{className:`${classPrefix$c}-cell ${classPrefix$c}-upload-button`,role:"button","aria-label":r.ImageUploader.upload},React$2.createElement("span",{className:`${classPrefix$c}-upload-button-icon`},React$2.createElement(AddOutline,null))),!s.disableUpload&&React$2.createElement("input",{"aria-label":r.ImageUploader.upload,ref:h,capture:s.capture,accept:s.accept,multiple:s.multiple,type:"file",className:`${classPrefix$c}-input`,onChange:function(e){var t;return __awaiter$1(this,void 0,void 0,function*(){e.persist();const{files:r}=e.target;if(!r)return;let n=[].slice.call(r);if(e.target.value="",s.beforeUpload){const e=n.map(e=>function(e,t){return __awaiter$1(this,void 0,void 0,function*(){const{beforeUpload:r}=s;let n=e;return n=yield null==r?void 0:r(e,t),n})}(e,n));yield Promise.all(e).then(e=>{n=e.filter(Boolean)})}if(0===n.length)return;if(g>0){const e=i.length+n.length-g;e>0&&(n=n.slice(0,n.length-e),null===(t=s.onCountExceed)||void 0===t||t.call(s,e))}const a=n.map(e=>({id:f.current++,status:"pending",file:e}));l(e=>[...E(e),...a]);const c=[];yield Promise.all(a.map((e,t)=>__awaiter$1(this,void 0,void 0,function*(){try{const r=yield s.upload(e.file);c[t]=r,l(t=>t.map(t=>t.id===e.id?Object.assign(Object.assign({},t),{status:"success",url:r.url}):t))}catch(r){l(t=>t.map(t=>t.id===e.id?Object.assign(Object.assign({},t),{status:"fail"}):t)),console.error(r)}}))),o(e=>e.concat(c).filter(Boolean))})}})));return reactExports.useImperativeHandle(t,()=>({get nativeElement(){return h.current}})),withNativeProps(s,React$2.createElement("div",{className:classPrefix$c,ref:c},n?React$2.createElement(Grid,{className:`${classPrefix$c}-grid`,columns:n,style:x},React$2.createElement("div",{className:`${classPrefix$c}-gap-measure`,ref:d}),R.props.children):React$2.createElement(Space,{className:`${classPrefix$c}-space`,wrap:!0,block:!0},R.props.children)))});function isWindow(e){return e===window}const classPrefix$b="adm-infinite-scroll",defaultProps$d={threshold:250,children:(e,t,r)=>React$2.createElement(InfiniteScrollContent,{hasMore:e,failed:t,retry:r})},InfiniteScroll=e=>{const t=mergeProps(defaultProps$d,e),[r,s]=reactExports.useState(!1),n=useLockFn(e=>__awaiter$1(void 0,void 0,void 0,function*(){try{yield t.loadMore(e)}catch(e2){throw s(!0),e2}})),i=reactExports.useRef(null),[o,a]=reactExports.useState({}),l=reactExports.useRef(o),[c,u]=reactExports.useState(),{run:d}=useThrottleFn(()=>__awaiter$1(void 0,void 0,void 0,function*(){if(l.current!==o)return;if(!t.hasMore)return;const e=i.current;if(!e)return;if(!e.offsetParent)return;const r=getScrollParent(e);if(u(r),!r)return;const s=e.getBoundingClientRect().top;if((isWindow(r)?window.innerHeight:r.getBoundingClientRect().bottom)>=s-t.threshold){const e={};l.current=e;try{yield n(!1),a(e)}catch(e2){}}}),{wait:100,leading:!0,trailing:!0});return reactExports.useEffect(()=>{d()}),reactExports.useEffect(()=>{if(i.current&&c)return c.addEventListener("scroll",e),()=>{c.removeEventListener("scroll",e)};function e(){d()}},[c]),withNativeProps(t,React$2.createElement("div",{className:classPrefix$b,ref:i},"function"==typeof t.children?t.children(t.hasMore,r,function(){return __awaiter$1(this,void 0,void 0,function*(){s(!1);try{yield n(!0),a(l.current)}catch(e2){}})}):t.children))},InfiniteScrollContent=e=>{const{locale:t}=useConfig();return e.hasMore?e.failed?React$2.createElement("span",null,React$2.createElement("span",{className:`${classPrefix$b}-failed-text`},t.InfiniteScroll.failedToLoad),React$2.createElement("a",{onClick:()=>{e.retry()}},t.InfiniteScroll.retry)):React$2.createElement(React$2.Fragment,null,React$2.createElement("span",null,t.common.loading),React$2.createElement(DotLoading,null)):React$2.createElement("span",null,t.InfiniteScroll.noMore)};function useInputHandleKeyDown({onEnterPress:e,onKeyDown:t,nativeInputRef:r,enterKeyHint:s}){return useIsomorphicLayoutEffect$1(()=>{const e=r.current;if(s&&e)return e.setAttribute("enterkeyhint",s),()=>{e.removeAttribute("enterkeyhint")}},[s]),r=>{!e||"Enter"!==r.code&&13!==r.keyCode||e(r),null==t||t(r)}}const classPrefix$a="adm-input",defaultProps$c={defaultValue:"",clearIcon:React$2.createElement(CloseCircleFill,null),onlyShowClearWhenFocus:!0},Input=reactExports.forwardRef((e,t)=>{const{locale:r,input:s={}}=useConfig(),n=mergeProps(defaultProps$c,s,e),[i,o]=usePropsValue(n),[a,l]=reactExports.useState(!1),c=reactExports.useRef(!1),u=reactExports.useRef(null),d=useInputHandleKeyDown({onEnterPress:n.onEnterPress,onKeyDown:n.onKeyDown,nativeInputRef:u,enterKeyHint:n.enterKeyHint});reactExports.useImperativeHandle(t,()=>({clear:()=>{o("")},focus:()=>{var e;null===(e=u.current)||void 0===e||e.focus()},blur:()=>{var e;null===(e=u.current)||void 0===e||e.blur()},get nativeElement(){return u.current}}));const p=!(!n.clearable||!i||n.readOnly)&&(!n.onlyShowClearWhenFocus||a);return withNativeProps(n,React$2.createElement("div",{className:classNames$1(`${classPrefix$a}`,n.disabled&&`${classPrefix$a}-disabled`)},React$2.createElement("input",{ref:u,className:`${classPrefix$a}-element`,value:i,onChange:e=>{o(e.target.value)},onFocus:e=>{var t;l(!0),null===(t=n.onFocus)||void 0===t||t.call(n,e)},onBlur:e=>{var t;l(!1),function(){let e=i;if("number"===n.type){const t=e&&bound(parseFloat(e),n.min,n.max).toString();Number(e)!==Number(t)&&(e=t)}e!==i&&o(e)}(),null===(t=n.onBlur)||void 0===t||t.call(n,e)},onPaste:n.onPaste,id:n.id,placeholder:n.placeholder,disabled:n.disabled,readOnly:n.readOnly,maxLength:n.maxLength,minLength:n.minLength,max:n.max,min:n.min,autoComplete:n.autoComplete,enterKeyHint:n.enterKeyHint,autoFocus:n.autoFocus,pattern:n.pattern,inputMode:n.inputMode,type:n.type,name:n.name,autoCapitalize:n.autoCapitalize,autoCorrect:n.autoCorrect,onKeyDown:d,onKeyUp:n.onKeyUp,onCompositionStart:e=>{var t;c.current=!0,null===(t=n.onCompositionStart)||void 0===t||t.call(n,e)},onCompositionEnd:e=>{var t;c.current=!1,null===(t=n.onCompositionEnd)||void 0===t||t.call(n,e)},onClick:n.onClick,step:n.step,role:n.role,"aria-valuenow":n["aria-valuenow"],"aria-valuemax":n["aria-valuemax"],"aria-valuemin":n["aria-valuemin"],"aria-label":n["aria-label"]}),p&&React$2.createElement("div",{className:`${classPrefix$a}-clear`,onMouseDown:e=>{e.preventDefault()},onClick:()=>{var e,t;o(""),null===(e=n.onClear)||void 0===e||e.call(n),isIOS()&&c.current&&(c.current=!1,null===(t=u.current)||void 0===t||t.blur())},"aria-label":r.Input.clear},n.clearIcon)))}),ModalActionButton=e=>{const{action:t}=e;return withNativeProps(e.action,React$2.createElement(Button,{key:t.key,onClick:e.onAction,className:classNames$1("adm-modal-button",{"adm-modal-button-primary":e.action.primary}),fill:e.action.primary?"solid":"none",size:e.action.primary?"large":"middle",block:!0,color:t.danger?"danger":"primary",loading:"auto",disabled:t.disabled},t.text))},defaultProps$b={actions:[],closeOnAction:!1,closeOnMaskClick:!1,getContainer:null},Modal$1=e=>{const t=mergeProps(defaultProps$b,e),r=React$2.createElement(React$2.Fragment,null,!!t.image&&React$2.createElement("div",{className:cls("image-container")},React$2.createElement(Image$1,{src:t.image,alt:"modal header image",width:"100%"})),!!t.header&&React$2.createElement("div",{className:cls("header")},React$2.createElement(AutoCenter,null,t.header)),!!t.title&&React$2.createElement("div",{className:cls("title")},t.title),React$2.createElement("div",{className:cls("content")},"string"==typeof t.content?React$2.createElement(AutoCenter,null,t.content):t.content),React$2.createElement(Space,{direction:"vertical",block:!0,className:classNames$1(cls("footer"),0===t.actions.length&&cls("footer-empty"))},t.actions.map((e,r)=>React$2.createElement(ModalActionButton,{key:e.key,action:e,onAction:()=>__awaiter$1(void 0,void 0,void 0,function*(){var s,n,i;yield Promise.all([null===(s=e.onClick)||void 0===s?void 0:s.call(e),null===(n=t.onAction)||void 0===n?void 0:n.call(t,e,r)]),t.closeOnAction&&(null===(i=t.onClose)||void 0===i||i.call(t))})}))));return React$2.createElement(CenterPopup,{className:classNames$1(cls(),t.className),style:t.style,afterClose:t.afterClose,afterShow:t.afterShow,showCloseButton:t.showCloseButton,closeOnMaskClick:t.closeOnMaskClick,onClose:t.onClose,visible:t.visible,getContainer:t.getContainer,bodyStyle:t.bodyStyle,bodyClassName:classNames$1(cls("body"),t.image&&cls("with-image"),t.bodyClassName),maskStyle:t.maskStyle,maskClassName:t.maskClassName,stopPropagation:t.stopPropagation,disableBodyScroll:t.disableBodyScroll,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender},r)};function cls(e=""){return"adm-modal"+(e&&"-")+e}const closeFnSet=new Set;function show$1(e){const t=renderImperatively(React$2.createElement(Modal$1,Object.assign({},e,{afterClose:()=>{var r;closeFnSet.delete(t.close),null===(r=e.afterClose)||void 0===r||r.call(e)}})));return closeFnSet.add(t.close),t}function alert$1(e){const t=mergeProps({confirmText:getDefaultConfig().locale.Modal.ok},e);return new Promise(e=>{show$1(Object.assign(Object.assign({},t),{closeOnAction:!0,actions:[{key:"confirm",text:t.confirmText,primary:!0}],onAction:t.onConfirm,onClose:()=>{var r;null===(r=t.onClose)||void 0===r||r.call(t),e()}}))})}const defaultProps$a={confirmText:"确认",cancelText:"取消"};function confirm(e){const{locale:t}=getDefaultConfig(),r=mergeProps(defaultProps$a,{confirmText:t.common.confirm,cancelText:t.common.cancel},e);return new Promise(e=>{show$1(Object.assign(Object.assign({},r),{closeOnAction:!0,onClose:()=>{var t;null===(t=r.onClose)||void 0===t||t.call(r),e(!1)},actions:[{key:"confirm",text:r.confirmText,primary:!0,onClick:()=>__awaiter$1(this,void 0,void 0,function*(){var t;yield null===(t=r.onConfirm)||void 0===t?void 0:t.call(r),e(!0)})},{key:"cancel",text:r.cancelText,onClick:()=>__awaiter$1(this,void 0,void 0,function*(){var t;yield null===(t=r.onCancel)||void 0===t?void 0:t.call(r),e(!1)})}]}))})}function clear$1(){closeFnSet.forEach(e=>{e()})}const Modal=attachPropertiesToComponent(Modal$1,{show:show$1,alert:alert$1,confirm:confirm,clear:clear$1}),classPrefix$9="adm-nav-bar",defaultBackIcon=React$2.createElement(LeftOutline,null),NavBar=e=>{const{navBar:t={}}=useConfig(),r=mergeProps(t,e),{back:s,backIcon:n,backArrow:i}=r,o=t.backIcon||defaultBackIcon,a=mergeProp(defaultBackIcon,t.backIcon,!0===i?o:i,!0===n?o:n);return withNativeProps(r,React$2.createElement("div",{className:classNames$1(classPrefix$9)},React$2.createElement("div",{className:`${classPrefix$9}-left`,role:"button"},null!==s&&React$2.createElement("div",{className:`${classPrefix$9}-back`,onClick:r.onBack},a&&React$2.createElement("span",{className:`${classPrefix$9}-back-arrow`},a),React$2.createElement("span",{"aria-hidden":"true"},s)),r.left),React$2.createElement("div",{className:`${classPrefix$9}-title`},r.children),React$2.createElement("div",{className:`${classPrefix$9}-right`},r.right)))};function shuffle(e){const t=[...e];for(let r=t.length;r>0;r--){const e=Math.floor(Math.random()*r);[t[r-1],t[e]]=[t[e],t[r-1]]}return t}const classPrefix$8="adm-number-keyboard",defaultProps$9={defaultVisible:!1,randomOrder:!1,showCloseButton:!0,confirmText:null,closeOnConfirm:!0,safeArea:!0,destroyOnClose:!1,forceRender:!1},NumberKeyboard=e=>{const t=mergeProps(defaultProps$9,e),{visible:r,title:s,getContainer:n,confirmText:i,customKey:o,randomOrder:a,showCloseButton:l,onInput:c}=t,{locale:u}=useConfig(),d=reactExports.useRef(null),p=reactExports.useMemo(()=>{const e=["1","2","3","4","5","6","7","8","9"],t=a?shuffle(e):e,r=Array.isArray(o)?o:[o];return t.push("0"),i?(2===r.length&&t.splice(9,0,r.pop()),t.push(r[0]||"")):(t.splice(9,0,r[0]||""),t.push(r[1]||"BACKSPACE")),t},[o,i,a,a&&r]),m=reactExports.useRef(-1),h=reactExports.useRef(-1),x=useMemoizedFn(()=>{var e;null===(e=t.onDelete)||void 0===e||e.call(t)}),f=()=>{m.current=window.setTimeout(()=>{x(),h.current=window.setInterval(x,150)},700)},g=()=>{clearTimeout(m.current),clearInterval(h.current)},y=(e,r)=>{var s,n;switch(e.preventDefault(),r){case"BACKSPACE":null==x||x();break;case"OK":null===(s=t.onConfirm)||void 0===s||s.call(t),t.closeOnConfirm&&(null===(n=t.onClose)||void 0===n||n.call(t));break;default:""!==r&&(null==c||c(r))}};return React$2.createElement(Popup,{visible:r,getContainer:n,mask:!1,afterClose:t.afterClose,afterShow:t.afterShow,className:`${classPrefix$8}-popup`,stopPropagation:t.stopPropagation,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender},withNativeProps(t,React$2.createElement("div",{ref:d,className:classPrefix$8,onMouseDown:e=>{e.preventDefault()}},l||s?React$2.createElement("div",{className:classNames$1(`${classPrefix$8}-header`,{[`${classPrefix$8}-header-with-title`]:!!s})},!!s&&React$2.createElement("div",{className:`${classPrefix$8}-title`,"aria-label":s},s),l&&React$2.createElement("span",{className:`${classPrefix$8}-header-close-button`,onClick:()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)},role:"button",title:u.common.close,tabIndex:-1},React$2.createElement(DownOutline,null))):null,React$2.createElement("div",{className:`${classPrefix$8}-wrapper`},React$2.createElement("div",{className:classNames$1(`${classPrefix$8}-main`,{[`${classPrefix$8}-main-confirmed-style`]:!!i})},p.map((e,t)=>{const r=/^\d$/.test(e),s=classNames$1(`${classPrefix$8}-key`,{[`${classPrefix$8}-key-number`]:r,[`${classPrefix$8}-key-sign`]:!r&&e,[`${classPrefix$8}-key-mid`]:9===t&&!!i&&p.length<12}),n=e?{role:"button",title:e,tabIndex:-1}:void 0;return React$2.createElement("div",Object.assign({key:e,className:s,onTouchStart:()=>{g(),"BACKSPACE"===e&&f()},onTouchEnd:t=>{y(t,e),"BACKSPACE"===e&&g()}},n),"BACKSPACE"===e?React$2.createElement(TextDeletionOutline,null):e)})),!!i&&React$2.createElement("div",{className:`${classPrefix$8}-confirm`},React$2.createElement("div",{className:`${classPrefix$8}-key ${classPrefix$8}-key-extra ${classPrefix$8}-key-bs`,onTouchStart:()=>{f()},onTouchEnd:e=>{y(e,"BACKSPACE"),g()},onContextMenu:e=>{e.preventDefault()},title:u.Input.clear,role:"button",tabIndex:-1},React$2.createElement(TextDeletionOutline,null)),React$2.createElement("div",{className:`${classPrefix$8}-key ${classPrefix$8}-key-extra ${classPrefix$8}-key-ok`,onTouchEnd:e=>y(e,"OK"),role:"button",tabIndex:-1,"aria-label":i},i))),t.safeArea&&React$2.createElement("div",{className:`${classPrefix$8}-footer`},React$2.createElement(SafeArea,{position:"bottom"})))))},Star=()=>React$2.createElement("svg",{viewBox:"0 0 42 40",height:"1em",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"-0.125em"}},React$2.createElement("path",{d:"m21 34-10.52 5.53a2 2 0 0 1-2.902-2.108l2.01-11.714-8.511-8.296a2 2 0 0 1 1.108-3.411l11.762-1.71 5.26-10.657a2 2 0 0 1 3.586 0l5.26 10.658L39.815 14a2 2 0 0 1 1.108 3.411l-8.51 8.296 2.009 11.714a2 2 0 0 1-2.902 2.109L21 34Z",fill:"currentColor",fillRule:"evenodd"})),classPrefix$7="adm-rate",defaultProps$8={count:5,allowHalf:!1,character:React$2.createElement(Star,null),defaultValue:0,readOnly:!1,allowClear:!0},Rate=e=>{const t=mergeProps(defaultProps$8,e),[r,s]=usePropsValue(t),n=reactExports.useRef(null),i=Array(t.count).fill(null);function o(e,s){return React$2.createElement("div",{className:classNames$1(`${classPrefix$7}-star`,{[`${classPrefix$7}-star-active`]:r>=e,[`${classPrefix$7}-star-half`]:s,[`${classPrefix$7}-star-readonly`]:t.readOnly}),role:"radio","aria-checked":r>=e,"aria-label":""+e},t.character)}const a=useDrag(e=>{if(t.readOnly)return;const{xy:[i],tap:o}=e,a=n.current;if(!a)return;const l=a.getBoundingClientRect(),c=(i-l.left)/l.width*t.count,u=bound(t.allowHalf?Math.ceil(2*c)/2:Math.ceil(c),0,t.count);o&&t.allowClear&&u===r?s(0):s(u)},{axis:"x",pointer:{touch:!0},filterTaps:!0});return withNativeProps(t,React$2.createElement("div",Object.assign({className:classNames$1(classPrefix$7,{[`${classPrefix$7}-half`]:t.allowHalf}),role:"radiogroup","aria-readonly":t.readOnly,ref:n},a()),i.map((e,r)=>React$2.createElement("div",{key:r,className:classNames$1(`${classPrefix$7}-box`)},t.allowHalf&&o(r+.5,!0),o(r+1,!1)))))},classPrefix$6="adm-search-bar",defaultProps$7={clearable:!0,onlyShowClearWhenFocus:!1,showCancelButton:!1,defaultValue:"",clearOnCancel:!0},SearchBar=reactExports.forwardRef((e,t)=>{const{locale:r,searchBar:s={}}=useConfig(),n=mergeProps(defaultProps$7,s,{cancelText:r.common.cancel},e),i=mergeProp(React$2.createElement(SearchOutline,null),s.searchIcon,e.icon,e.searchIcon),[o,a]=usePropsValue(n),[l,c]=reactExports.useState(!1),u=reactExports.useRef(null),d=reactExports.useRef(!1);reactExports.useImperativeHandle(t,()=>({clear:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.clear()},focus:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.focus()},blur:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.blur()},get nativeElement(){var e,t;return null!==(t=null===(e=u.current)||void 0===e?void 0:e.nativeElement)&&void 0!==t?t:null}}));return withNativeProps(n,React$2.createElement("div",{className:classNames$1(classPrefix$6,{[`${classPrefix$6}-active`]:l})},React$2.createElement("div",{className:`${classPrefix$6}-input-box`},i&&React$2.createElement("div",{className:`${classPrefix$6}-input-box-icon`},i),React$2.createElement(Input,{ref:u,className:classNames$1(`${classPrefix$6}-input`,{[`${classPrefix$6}-input-without-icon`]:!i}),value:o,onChange:a,maxLength:n.maxLength,autoFocus:n.autoFocus,placeholder:n.placeholder,clearable:n.clearable,onlyShowClearWhenFocus:n.onlyShowClearWhenFocus,onFocus:e=>{var t;c(!0),null===(t=n.onFocus)||void 0===t||t.call(n,e)},onBlur:e=>{var t;c(!1),null===(t=n.onBlur)||void 0===t||t.call(n,e)},onClear:n.onClear,type:"search",enterKeyHint:"search",onEnterPress:()=>{var e,t;d.current||(null===(e=u.current)||void 0===e||e.blur(),null===(t=n.onSearch)||void 0===t||t.call(n,o))},"aria-label":r.SearchBar.name,onCompositionStart:e=>{var t;d.current=!0,null===(t=n.onCompositionStart)||void 0===t||t.call(n,e)},onCompositionEnd:e=>{var t;d.current=!1,null===(t=n.onCompositionEnd)||void 0===t||t.call(n,e)}})),(()=>{let e;return e="function"==typeof n.showCancelButton?n.showCancelButton(l,o):n.showCancelButton&&l,e&&React$2.createElement("div",{className:`${classPrefix$6}-suffix`},React$2.createElement(Button,{fill:"none",className:`${classPrefix$6}-cancel-button`,onClick:()=>{var e,t,r;n.clearOnCancel&&(null===(e=u.current)||void 0===e||e.clear()),null===(t=u.current)||void 0===t||t.blur(),null===(r=n.onCancel)||void 0===r||r.call(n)},onMouseDown:e=>{e.preventDefault()}},n.cancelText))})()))}),CheckMark=reactExports.memo(()=>React$2.createElement("svg",{width:"17px",height:"13px",viewBox:"0 0 17 13",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},React$2.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"},React$2.createElement("g",{transform:"translate(-2832.000000, -1103.000000)",stroke:"#FFFFFF",strokeWidth:"3"},React$2.createElement("g",{transform:"translate(2610.000000, 955.000000)"},React$2.createElement("g",{transform:"translate(24.000000, 91.000000)"},React$2.createElement("g",{transform:"translate(179.177408, 36.687816)"},React$2.createElement("polyline",{points:"34.2767388 22 24.797043 31.4796958 21 27.6826527"})))))))),classPrefix$5="adm-selector",defaultProps$6={multiple:!1,defaultValue:[],showCheckMark:!0},Selector=e=>{const t=mergeProps(defaultProps$6,e),[r,s,,n]=useFieldNames(t.fieldNames),[i,o]=usePropsValue({value:t.value,defaultValue:t.defaultValue,onChange:e=>{var r;const n={get items(){return t.options.filter(t=>e.includes(t[s]))}};null===(r=t.onChange)||void 0===r||r.call(t,e,n)}}),{locale:a}=useConfig(),l=t.options.map(e=>{const a=(i||[]).includes(e[s]),l=e[n]||t.disabled,c=classNames$1(`${classPrefix$5}-item`,{[`${classPrefix$5}-item-active`]:a&&!t.multiple,[`${classPrefix$5}-item-multiple-active`]:a&&t.multiple,[`${classPrefix$5}-item-disabled`]:l});return React$2.createElement("div",{key:e[s],className:c,onClick:()=>{if(!l)if(t.multiple){const t=a?i.filter(t=>t!==e[s]):[...i,e[s]];o(t)}else{const t=a?[]:[e[s]];o(t)}},role:"option","aria-selected":a&&!t.multiple||a&&t.multiple},e[r],e.description&&React$2.createElement("div",{className:`${classPrefix$5}-item-description`},e.description),a&&t.showCheckMark&&React$2.createElement("div",{className:`${classPrefix$5}-check-mark-wrapper`},React$2.createElement(CheckMark,null)))});return withNativeProps(t,React$2.createElement("div",{className:classPrefix$5,role:"listbox","aria-label":a.Selector.name},t.columns?React$2.createElement(Grid,{columns:t.columns},l):React$2.createElement(Space,{wrap:!0},l)))},SpinIcon=reactExports.memo(e=>withNativeProps(e,React$2.createElement("svg",{width:"28px",height:"28px",viewBox:"0 0 28 28"},React$2.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},React$2.createElement("g",{transform:"translate(-137.000000, -840.000000)",fill:"#1576FE"},React$2.createElement("g",{transform:"translate(80.000000, 823.000000)"},React$2.createElement("g",{transform:"translate(53.000000, 13.000000)"},React$2.createElement("path",{d:"M17.9996753,31.5 C10.5556724,31.5 4.5,25.4443275 4.5,18.0003247 C4.5,10.5563219 10.5556724,4.5 17.9996753,4.5 C18.5355492,4.5 18.9702974,4.93474816 18.9702974,5.47062208 C18.9702974,6.006496 18.5355492,6.44124416 17.9996753,6.44124416 C11.6261524,6.44124416 6.44124416,11.6267709 6.44124416,18.0002938 C6.44124416,24.3738167 11.6261524,29.5587249 17.9996753,29.5587249 C24.3731982,29.5587249 29.5587249,24.3738167 29.5587249,18.0002938 C29.5587249,14.7964616 28.2778291,11.8169616 25.9523687,9.61220279 C25.5637302,9.24317094 25.5473089,8.62893223 25.9157222,8.23967523 C26.2841356,7.84976878 26.8989928,7.83461537 27.2882498,8.20302872 C30.0042351,10.7787368 31.5,14.2580826 31.5,18.0002938 C31.5,25.4443275 25.4436781,31.5 17.9996753,31.5 Z"})))))))),classPrefix$4="adm-switch",defaultProps$5={defaultChecked:!1},Switch=e=>{const t=mergeProps(defaultProps$5,e),r=t.disabled||t.loading||!1,[s,n]=reactExports.useState(!1),{locale:i}=useConfig(),[o,a]=usePropsValue({value:t.checked,defaultValue:t.defaultChecked,onChange:t.onChange});return withNativeProps(t,React$2.createElement("div",{onClick:function(){return __awaiter$1(this,void 0,void 0,function*(){if(r||t.loading||s)return;const e=!o;if(t.beforeChange){n(!0);try{yield t.beforeChange(e),n(!1)}catch(e2){throw n(!1),e2}}const i=a(e);if(isPromise(i)){n(!0);try{yield i,n(!1)}catch(e2){throw n(!1),e2}}})},className:classNames$1(classPrefix$4,{[`${classPrefix$4}-checked`]:o,[`${classPrefix$4}-disabled`]:r||s}),role:"switch","aria-label":i.Switch.name,"aria-checked":o,"aria-disabled":r},React$2.createElement("div",{className:`${classPrefix$4}-checkbox`},React$2.createElement("div",{className:`${classPrefix$4}-handle`},(t.loading||s)&&React$2.createElement(SpinIcon,{className:`${classPrefix$4}-spin-icon`})),React$2.createElement("div",{className:`${classPrefix$4}-inner`},o?t.checkedText:t.uncheckedText))))},TabBarItem=()=>null,classPrefix$3="adm-tab-bar",defaultProps$4={safeArea:!1},TabBar$1=e=>{var t;const r=mergeProps(defaultProps$4,e);let s=null;const n=[];traverseReactNode(r.children,(e,t)=>{if(!reactExports.isValidElement(e))return;const r=e.key;"string"==typeof r&&(0===t&&(s=r),n.push(e))});const[i,o]=usePropsValue({value:r.activeKey,defaultValue:null!==(t=r.defaultActiveKey)&&void 0!==t?t:s,onChange:e=>{var t;null!==e&&(null===(t=r.onChange)||void 0===t||t.call(r,e))}});return withNativeProps(r,React$2.createElement("div",{className:classPrefix$3},React$2.createElement("div",{className:`${classPrefix$3}-wrap`},n.map(e=>{const t=e.key===i;return withNativeProps(e.props,React$2.createElement("div",{key:e.key,onClick:()=>{var t,r;const{key:s}=e;null!=s&&(o(s.toString()),null===(r=(t=e.props).onClick)||void 0===r||r.call(t))},className:classNames$1(`${classPrefix$3}-item`,{[`${classPrefix$3}-item-active`]:t})},function(){const r=e.props.icon&&React$2.createElement("div",{className:`${classPrefix$3}-item-icon`},"function"==typeof e.props.icon?e.props.icon(t):e.props.icon),s=e.props.title&&React$2.createElement("div",{className:classNames$1(`${classPrefix$3}-item-title`,Boolean(r)&&`${classPrefix$3}-item-title-with-icon`)},"function"==typeof e.props.title?e.props.title(t):e.props.title);return r?React$2.createElement(React$2.Fragment,null,React$2.createElement(Badge,{content:e.props.badge,className:`${classPrefix$3}-icon-badge`},r),s):s?React$2.createElement(Badge,{content:e.props.badge,className:`${classPrefix$3}-title-badge`},s):null}()))})),r.safeArea&&React$2.createElement(SafeArea,{position:"bottom"})))},TabBar=attachPropertiesToComponent(TabBar$1,{Item:TabBarItem}),classPrefix$2="adm-tag",colorRecord={default:"var(--adm-color-text-secondary, #666666)",primary:"var(--adm-color-primary, #1677ff)",success:"var(--adm-color-success, #00b578)",warning:"var(--adm-color-warning, #ff8f1f)",danger:"var(--adm-color-danger, #ff3141)"},defaultProps$3={color:"default",fill:"solid",round:!1},Tag=e=>{var t;const r=mergeProps(defaultProps$3,e),s=null!==(t=colorRecord[r.color])&&void 0!==t?t:r.color,n={"--border-color":s,"--text-color":"outline"===r.fill?s:"#ffffff","--background-color":"outline"===r.fill?"transparent":s};return withNativeProps(r,React$2.createElement("span",{style:n,onClick:r.onClick,className:classNames$1(classPrefix$2,{[`${classPrefix$2}-round`]:r.round})},r.children))},classPrefix$1="adm-text-area",defaultProps$2={rows:2,showCount:!1,autoSize:!1,defaultValue:""},TextArea=reactExports.forwardRef((e,t)=>{const r=mergeProps(defaultProps$2,e),{autoSize:s,showCount:n,maxLength:i}=r,[o,a]=usePropsValue(Object.assign(Object.assign({},r),{value:null===r.value?"":r.value}));r.value;const l=reactExports.useRef(null),c=reactExports.useRef("auto"),u=reactExports.useRef(null),d=useInputHandleKeyDown({onEnterPress:r.onEnterPress,onKeyDown:r.onKeyDown,nativeInputRef:l,enterKeyHint:r.enterKeyHint});reactExports.useImperativeHandle(t,()=>({clear:()=>{a("")},focus:()=>{var e;null===(e=l.current)||void 0===e||e.focus()},blur:()=>{var e;null===(e=l.current)||void 0===e||e.blur()},get nativeElement(){return l.current}})),useIsomorphicLayoutEffect$1(()=>{if(!s)return;const e=l.current,t=u.current;if(!e)return;if(e.style.height=c.current,!t)return;let r=t.scrollHeight;if("object"==typeof s){const t=window.getComputedStyle(e),n=parseFloat(t.lineHeight);s.minRows&&(r=Math.max(r,s.minRows*n)),s.maxRows&&(r=Math.min(r,s.maxRows*n))}c.current=`${r}px`,e.style.height=`${r}px`},[o,s]);const p=reactExports.useRef(!1);let m;const h=runes(o).length;"function"==typeof n?m=n(h,i):n&&(m=React$2.createElement("div",{className:`${classPrefix$1}-count`},void 0===i?h:h+"/"+i));let x=r.rows;return"object"==typeof s&&(s.maxRows&&x>s.maxRows&&(x=s.maxRows),s.minRows&&x<s.minRows&&(x=s.minRows)),withNativeProps(r,React$2.createElement("div",{className:classPrefix$1},React$2.createElement("textarea",{ref:l,className:`${classPrefix$1}-element`,rows:x,value:o,placeholder:r.placeholder,onChange:e=>{let t=e.target.value;i&&!p.current&&(t=runes(t).slice(0,i).join("")),a(t)},id:r.id,onCompositionStart:e=>{var t;p.current=!0,null===(t=r.onCompositionStart)||void 0===t||t.call(r,e)},onCompositionEnd:e=>{var t;if(p.current=!1,i){const t=e.target.value;a(runes(t).slice(0,i).join(""))}null===(t=r.onCompositionEnd)||void 0===t||t.call(r,e)},autoComplete:r.autoComplete,autoFocus:r.autoFocus,disabled:r.disabled,readOnly:r.readOnly,name:r.name,onFocus:r.onFocus,onBlur:r.onBlur,onClick:r.onClick,onKeyDown:d}),m,s&&React$2.createElement("textarea",{ref:u,className:`${classPrefix$1}-element ${classPrefix$1}-element-hidden`,value:o,rows:x,"aria-hidden":!0,readOnly:!0})))});TextArea.defaultProps=defaultProps$2;const classPrefix="adm-toast",defaultProps$1={maskClickable:!0,stopPropagation:["click"]},InternalToast=e=>{const t=mergeProps(defaultProps$1,e),{maskClickable:r,content:s,icon:n,position:i}=t,o=reactExports.useMemo(()=>{if(null==n)return null;switch(n){case"success":return React$2.createElement(CheckOutline,{className:`${classPrefix}-icon-success`});case"fail":return React$2.createElement(CloseOutline,{className:`${classPrefix}-icon-fail`});case"loading":return React$2.createElement(SpinLoading,{color:"white",className:`${classPrefix}-loading`});default:return n}},[n]),a=reactExports.useMemo(()=>{switch(i){case"top":return"20%";case"bottom":return"80%";default:return"50%"}},[i]);return React$2.createElement(Mask,{visible:t.visible,destroyOnClose:!0,opacity:0,disableBodyScroll:!r,getContainer:t.getContainer,afterClose:t.afterClose,style:Object.assign({pointerEvents:r?"none":"auto"},t.maskStyle),className:classNames$1(`${classPrefix}-mask`,t.maskClassName),stopPropagation:t.stopPropagation},React$2.createElement("div",{className:classNames$1(`${classPrefix}-wrap`)},React$2.createElement("div",{style:{top:a},className:classNames$1(`${classPrefix}-main`,n?`${classPrefix}-main-icon`:`${classPrefix}-main-text`)},o&&React$2.createElement("div",{className:`${classPrefix}-icon`},o),React$2.createElement(AutoCenter,null,s))))};let currentHandler=null,currentTimeout=null;const defaultProps={duration:2e3,position:"center",maskClickable:!0},ToastInner=e=>React$2.createElement(InternalToast,Object.assign({},e));function show(e){var t;const r=mergeProps(defaultProps,"string"==typeof e?{content:e}:e),s=React$2.createElement(ToastInner,Object.assign({},r,{onClose:()=>{currentHandler=null}}));return currentHandler?(null===(t=currentHandler.isRendered)||void 0===t?void 0:t.call(currentHandler))?currentHandler.replace(s):(currentHandler.close(),currentHandler=renderImperatively(s)):currentHandler=renderImperatively(s),currentTimeout&&window.clearTimeout(currentTimeout),0!==r.duration&&(currentTimeout=window.setTimeout(()=>{clear()},r.duration)),currentHandler}function clear(){null==currentHandler||currentHandler.close(),currentHandler=null}function config(e){void 0!==e.duration&&(defaultProps.duration=e.duration),void 0!==e.position&&(defaultProps.position=e.position),void 0!==e.maskClickable&&(defaultProps.maskClickable=e.maskClickable)}const Toast={show:show,clear:clear,config:config},MobileUserPicker=({value:e,onChange:t,placeholder:r="请选择成员",buttonText:s="选择成员",title:n="选择成员",multiple:i=!0,disabled:o=!1})=>{const[a,l]=reactExports.useState(!1),[c,u]=reactExports.useState([]),[d,p]=reactExports.useState({}),[m,h]=reactExports.useState(!1),[x,f]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{try{h(!0);const{data:e,error:t}=await supabase.from("organizations").select("id, name, parent_id");if(t)throw console.error("❌ 加载组织数据失败:",t),t;const{data:r,error:s}=await supabase.from("users_profile").select("id, nickname, organization_id, status").eq("status","active");if(s)throw console.error("❌ 加载用户数据失败:",s),s;if(r&&r.length>0){const e=r.reduce((e,t)=>({...e,[String(t.id)]:{id:String(t.id),nickname:t.nickname||`用户${t.id}`,status:t.status}}),{});p(t=>({...t,...e}))}const n=t=>(e||[]).filter(e=>e.parent_id===t).map(e=>{const t=(r||[]).filter(t=>!!t.organization_id&&t.organization_id===e.id),s=n(e.id),i=[...t.map(e=>({label:e.nickname||`用户${e.id}`,value:String(e.id)})).filter(e=>e.value&&"undefined"!==e.value&&"null"!==e.value),...s].filter(e=>e.value&&"undefined"!==e.value&&"null"!==e.value);return{label:`${e.name} (${t.length}人)`,value:`dept_${e.id}`,children:i.length>0?i:void 0}}),i=(r||[]).filter(e=>!e.organization_id).map(e=>({label:e.nickname||`用户${e.id}`,value:String(e.id)})).filter(e=>e.value&&"undefined"!==e.value&&"null"!==e.value),o=n(null);i.length>0&&o.push({label:`未分配部门 (${i.length}人)`,value:"dept_none",children:i}),u(o),f(!0)}catch(e){console.error("❌ 加载部门树数据失败:",e),u([]),f(!0)}finally{h(!1)}})()},[]);return x?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{onClick:()=>{o||l(!0)},disabled:o,fill:"outline",style:{color:o?"#999":"#1890ff",borderColor:o?"#d9d9d9":"#1890ff"},children:(()=>{if(!e||Array.isArray(e)&&0===e.length)return r;const t=(Array.isArray(e)?e:[String(e)]).filter(e=>e&&"undefined"!==e&&"null"!==e);if(0===t.length)return r;if(1===t.length){const e=d[t[0]];return(null==e?void 0:e.nickname)||`用户${t[0]}`}return`已选择 ${t.length} 人`})()}),jsxRuntimeExports.jsx(CascadePicker,{title:n,options:c,visible:a,onClose:()=>{l(!1)},onConfirm:(r,s)=>{console.log("选择结果:",r,s);const n=r.filter(e=>e&&!String(e).startsWith("dept_")).map(e=>String(e)).filter(e=>e&&"undefined"!==e&&"null"!==e);if(i){const r=Array.isArray(e)?e:[],s=[...new Set([...r,...n])];null==t||t(s)}else{const e=n[n.length-1];null==t||t(e?[e]:[])}l(!1)},onSelect:e=>{console.log("选择中:",e)}})]}):jsxRuntimeExports.jsx(Button,{disabled:!0,children:"正在加载用户数据..."})},getRatingValue=e=>{if("number"==typeof e)return e;switch(e){case"A":return 3;case"B+":return 2;case"B":return 1;default:return 0}},getRatingString=e=>{switch(e){case 3:return"A";case 2:return"B+";case 1:return"B";default:return"C"}},CommonSelector=({options:e,value:t,onChange:r,placeholder:s="请选择",loading:n=!1,disabled:i=!1})=>{const o=t&&""!==t?Array.isArray(t)?t.length>0?[t[0]]:[]:[t]:[];if(n||0===e.length)return jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#00000040"},children:"加载中..."});const a=e.map((e,t)=>({...e,key:`${e.value||e.label||t}-${t}`}));return jsxRuntimeExports.jsx(Selector,{options:a,value:o,multiple:!1,onChange:e=>{let t="";e&&Array.isArray(e)&&e.length>0?t=e[0]:e&&"string"==typeof e?t=e:e&&"number"==typeof e&&(t=String(e)),r(t)},disabled:i})},stageFields$1={"丢单":["majorcategory","followupresult"],"待接收":[],"确认需求":["userrating","customerprofile","worklocation","userbudget","moveintime","majorcategory","followupresult"],"邀约到店":["scheduletime","scheduledcommunity","assigned_showingsales"],"已到店":[],"赢单":[]},getFieldLabel=(e,t)=>"丢单"===t&&"followupresult"===e?"丢单原因":{customerprofile:"用户画像",worklocation:"工作地点",userbudget:"用户预算",moveintime:"入住时间",userrating:"来访意向",majorcategory:"跟进结果",followupresult:"跟进备注",scheduletime:"预约到店时间",scheduledcommunity:"预约社区",assigned_showingsales:"带看管家",followupstage:"跟进阶段",leadtype:"线索类型",invalid:"是否无效"}[e]||e,WorkLocationPicker=({options:e,value:t,onChange:r,placeholder:s,disabled:n=!1})=>{const[i,o]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:n?"#f5f5f5":"white",cursor:n?"not-allowed":"pointer",color:n?"#999":t?"inherit":"#999"},onClick:()=>!n&&o(!0),children:(()=>{if(!t)return s;const r=(e,t)=>{for(const s of e){if(s.value===t)return s.label;if(s.children){const e=r(s.children,t);if(e)return e}}return""};return r(e,t)||s})()}),jsxRuntimeExports.jsx(CascadePicker,{title:"选择工作地点",options:e,visible:i,onClose:()=>o(!1),onConfirm:(e,t)=>{try{if(e&&e.length>0){const t=e[e.length-1];t&&"string"==typeof t?r(t):console.warn("⚠️ [WorkLocationPicker] 选中的工作地点值无效:",t)}}catch(s){console.error("❌ [WorkLocationPicker] 工作地点选择确认失败:",s)}o(!1)}})]})},MajorCategoryPicker=({options:e,value:t,onChange:r,placeholder:s,disabled:n=!1})=>{const[i,o]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:n?"#f5f5f5":"white",cursor:n?"not-allowed":"pointer",color:n?"#999":t?"inherit":"#999"},onClick:()=>!n&&o(!0),children:(()=>{if(!t)return s;const r=(e,t)=>{for(const s of e){if(s.value===t)return s.label;if(s.children){const e=r(s.children,t);if(e)return e}}return""};return r(e,t)||s})()}),jsxRuntimeExports.jsx(CascadePicker,{title:"选择跟进结果",options:e,visible:i,onClose:()=>o(!1),onConfirm:(e,t)=>{try{if(e&&e.length>0){const t=e[e.length-1];r(t)}}catch(s){console.error("跟进结果选择确认失败:",s)}o(!1)}})]})},MoveInTimePicker=({value:e,onChange:t,placeholder:r,disabled:s=!1})=>{const[n,i]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:s?"#f5f5f5":"white",cursor:s?"not-allowed":"pointer",color:s?"#999":e?"inherit":"#999"},onClick:()=>!s&&i(!0),children:(()=>{if(!e)return r;try{if(dayjs.isDayjs(e))return e.format("YYYY-MM-DD");if(e instanceof Date)return dayjs(e).format("YYYY-MM-DD");if("string"==typeof e&&e.trim()){const t=dayjs(e);if(t.isValid())return t.format("YYYY-MM-DD")}}catch(e2){console.warn("入住时间值解析失败:",e2)}return r})()}),jsxRuntimeExports.jsx(DatePicker,{title:"选择入住时间",visible:n,precision:"day",defaultValue:(()=>{if(e)try{if(dayjs.isDayjs(e))return e.toDate();if(e instanceof Date)return e;if("string"==typeof e&&e.trim()){const t=dayjs(e);if(t.isValid())return t.toDate()}}catch(e2){console.warn("入住时间默认值解析失败:",e2)}return new Date})(),onClose:()=>i(!1),onConfirm:e=>{try{if(e){const r=dayjs(e);r.isValid()&&t(r)}}catch(r){console.error("❌ [MoveInTimePicker] 入住时间选择失败:",r)}i(!1)}})]})},ScheduleTimePickerWithDatePicker=({value:e,onChange:t,placeholder:r,disabled:s=!1})=>{const[n,i]=reactExports.useState(!1),o=reactExports.useCallback((e,t)=>{switch(e){case"year":return t+"年";case"month":return t+"月";case"day":return t+"日";case"hour":return t+"时";case"minute":return t+"分";default:return t}},[]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:s?"#f5f5f5":"white",cursor:s?"not-allowed":"pointer",color:s?"#999":e?"inherit":"#999"},onClick:()=>!s&&i(!0),children:(()=>{if(!e)return r;try{if(dayjs.isDayjs(e))return e.format("YYYY-MM-DD HH:mm");if(e instanceof Date)return dayjs(e).format("YYYY-MM-DD HH:mm");if("string"==typeof e&&e.trim()){const t=dayjs(e);if(t.isValid())return t.format("YYYY-MM-DD HH:mm")}}catch(e2){console.warn("预约时间值解析失败:",e2)}return r})()}),jsxRuntimeExports.jsx(DatePicker,{title:"选择预约到店时间",visible:n,precision:"minute",defaultValue:(()=>{if(e)try{if(dayjs.isDayjs(e))return e.toDate();if(e instanceof Date)return e;if("string"==typeof e&&e.trim()){const t=dayjs(e);if(t.isValid())return t.toDate()}}catch(e2){console.warn("预约时间默认值解析失败:",e2)}return new Date})(),onClose:()=>i(!1),renderLabel:o,onConfirm:e=>{try{if(e){const r=dayjs(e);r.isValid()&&t(r)}}catch(r){}i(!1)}})]})},MobileFollowupStageForm=({form:e,stage:t,record:r,isFieldDisabled:s=()=>!1,forceUpdate:n=0,communityEnum:i,followupstageEnum:o,customerprofileEnum:a,userratingEnum:l,majorCategoryOptions:c,metroStationOptions:u,onBudgetChange:d,enableManualAssign:p=!1,onAllocationModeChange:m})=>{const[h,x]=reactExports.useState(""),[f,g]=reactExports.useState(""),[y,v]=reactExports.useState(!1);reactExports.useEffect(()=>{if(r&&e&&!y){const t=r.userbudget,s=e.getFieldValue("userbudget")||t;s&&s!==f&&""===f&&g(String(s))}},[null==r?void 0:r.id,null==r?void 0:r.userbudget,e,f,y]),reactExports.useEffect(()=>{(null==r?void 0:r.id)&&v(!1)},[null==r?void 0:r.id,null==r?void 0:r.userbudget]),reactExports.useEffect(()=>{r&&e&&(r.userrating&&(e.setFieldValue("userrating",r.userrating),e.setFieldsValue({userrating:r.userrating})),r.customerprofile&&(e.setFieldValue("customerprofile",r.customerprofile),e.setFieldsValue({customerprofile:r.customerprofile})),r.worklocation&&(e.setFieldValue("worklocation",r.worklocation),e.setFieldsValue({worklocation:r.worklocation})),r.userbudget&&(e.setFieldValue("userbudget",r.userbudget),e.setFieldsValue({userbudget:r.userbudget})),r.moveintime&&(e.setFieldValue("moveintime",r.moveintime),e.setFieldsValue({moveintime:r.moveintime})),r.majorcategory&&(e.setFieldValue("majorcategory",r.majorcategory),e.setFieldsValue({majorcategory:r.majorcategory})),r.followupresult&&(e.setFieldValue("followupresult",r.followupresult),e.setFieldsValue({followupresult:r.followupresult})))},[r,e]);const E=reactExports.useMemo(()=>({community:i&&i.length>0,followupstage:o&&o.length>0,customerprofile:a&&a.length>0,userrating:l&&l.length>0,majorCategory:c&&c.length>0,metroStation:u&&u.length>0}),[i,o,a,l,c,u]),j=reactExports.useMemo(()=>{if(!o||0===o.length)return[];const e=new Set;return o.filter(t=>{const r=t.value||t.label;return!e.has(r)&&(e.add(r),!0)}).map((e,t)=>({label:e.label||String(e.value),value:e.value||`value_${t}`,key:`followupstage_${t}_${e.value||t}`}))},[o]),b=reactExports.useMemo(()=>{if(!a||0===a.length)return[];const e=new Set;return a.filter(t=>{const r=t.value||t.label;return!e.has(r)&&(e.add(r),!0)}).map((e,t)=>({label:e.label||String(e.value),value:e.value||`value_${t}`,key:`customerprofile_${t}_${e.value||t}`}))},[a]);reactExports.useMemo(()=>{if(!l||0===l.length)return[];const e=new Set;return l.filter(t=>{const r=t.value||t.label;return!e.has(r)&&(e.add(r),!0)}).map((e,t)=>({label:e.label||String(e.value),value:e.value||`value_${t}`,key:`userrating_${t}_${e.value||t}`}))},[l]);const w=reactExports.useMemo(()=>{if(!i||0===i.length)return[];const e=new Set;return i.filter(t=>{const r=t.value||t.label;return!e.has(r)&&(e.add(r),!0)}).map((e,t)=>({label:e.label||String(e.value),value:e.value||`value_${t}`,key:`community_${t}_${e.value||t}`}))},[i]),R=reactExports.useMemo(()=>u&&0!==u.length?u:[],[u]),_=reactExports.useMemo(()=>{if(!c||0===c.length)return[];const e=[];let t=0;const r=new Set;return c.forEach((s,n)=>{if(s.children)s.children.forEach((s,i)=>{const o=s.value||`value_${n}_${i}`;r.has(o)||(r.add(o),e.push({label:s.label||String(s.value),value:o,key:`majorcategory_${t++}_${o}`}))});else{const i=s.value||`value_${n}`;r.has(i)||(r.add(i),e.push({label:s.label||String(s.value),value:i,key:`majorcategory_${t++}_${i}`}))}}),e},[c]);if("已到店"===t||"赢单"===t)return null;if(!t||""===t)return null;if(!(E.followupstage&&E.customerprofile&&E.userrating&&E.community&&E.majorCategory&&E.metroStation))return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[jsxRuntimeExports.jsx("p",{children:"正在加载表单数据..."}),jsxRuntimeExports.jsx("p",{children:"请稍候"})]});const S=stageFields$1[t]||[];if(0===S.length)return jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[jsxRuntimeExports.jsx("p",{children:"当前阶段无需填写额外信息"}),jsxRuntimeExports.jsx("p",{children:'点击"下一步"继续推进'})]});const C=n=>{const i=getFieldLabel(n,t);let o=!1;return"确认需求"===t?o=!["moveintime","userrating"].includes(n):"邀约到店"===t?"scheduletime"===n||"assigned_showingsales"===n&&p?o=!0:"scheduledcommunity"!==n||p||(o=!0):o=["customerprofile","scheduledcommunity","majorcategory","followupresult"].includes(n),((t,n,i)=>{const o={name:t,label:n,rules:i?[{required:!0,message:`请填写${n}`}]:[],className:"border-b-0 border-t-0"};try{switch(t){case"followupstage":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(CommonSelector,{options:j,value:e.getFieldValue(t)||(null==r?void 0:r[t]),onChange:r=>{try{e.setFieldValue(t,r),e.setFieldsValue({[t]:r})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置跟进阶段失败:",s)}},loading:0===j.length,disabled:s()})});case"customerprofile":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(CommonSelector,{options:b,value:e.getFieldValue(t)||(null==r?void 0:r[t]),onChange:r=>{try{e.setFieldValue(t,r),e.setFieldsValue({[t]:r})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置用户画像失败:",s)}},loading:0===b.length,disabled:s()})});case"userrating":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(Rate,{value:getRatingValue(e.getFieldValue(t)||(null==r?void 0:r[t])||"C"),onChange:r=>{try{const s=getRatingString(r);e.setFieldValue(t,s),e.setFieldsValue({[t]:s})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置来访意向失败:",s)}},count:3,allowClear:!1,readOnly:s(),style:{fontSize:"20px",color:"#faad14"}})});case"scheduledcommunity":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(CommonSelector,{options:w,value:e.getFieldValue(t)||(null==r?void 0:r[t]),onChange:r=>{try{e.setFieldValue(t,r),e.setFieldsValue({[t]:r})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置预约社区失败:",s)}},loading:0===w.length,disabled:s()})});case"assigned_showingsales":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(MobileUserPicker,{value:e.getFieldValue(t)||(null==r?void 0:r[t]),onChange:r=>{try{const s=Array.isArray(r)&&r.length>0?r[0]:null;e.setFieldValue(t,s),e.setFieldsValue({[t]:s})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置带看管家失败:",s)}},placeholder:"请选择带看管家",buttonText:"选择带看管家",title:"选择带看管家",multiple:!1,disabled:s()})});case"worklocation":return jsxRuntimeExports.jsx(Form.Item,{...o,children:R.length>0?jsxRuntimeExports.jsx(WorkLocationPicker,{options:R,value:e.getFieldValue(t),onChange:r=>{try{e.setFieldValue(t,r),e.setFieldsValue({[t]:r})}catch(s){}},placeholder:"请选择工作地点",disabled:s()}):jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#00000040"},children:"加载中..."})});case"userbudget":const i=e=>""===e||null==e?"":String(e),a=e.getFieldValue(t),l=y||""!==f?f:a||(null==r?void 0:r.userbudget)||"",u=i(l);return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsxs("div",{style:{position:"relative"},children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1,cursor:"pointer"},onClick:r=>{if(s())return;r.preventDefault(),r.stopPropagation();const n=e.getFieldValue(t);n!==f&&g(String(n||"")),x("userbudget")}}),jsxRuntimeExports.jsx(Input,{placeholder:l?"":`点击输入${n}`,value:u,readOnly:!0,clearable:!0,onClear:()=>{g(""),v(!0),e.setFieldValue(t,""),e.setFieldsValue({[t]:""}),d&&d("")}}),l&&jsxRuntimeExports.jsx("span",{style:{position:"absolute",right:"40px",top:"50%",transform:"translateY(-50%)",color:"#999",fontSize:"12px",pointerEvents:"none"},children:"元"})]})});case"moveintime":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(MoveInTimePicker,{value:e.getFieldValue(t),onChange:r=>{try{let s=r;r&&dayjs.isDayjs(r)&&(s=r.format("YYYY-MM-DD")+" 00:00:00"),e.setFieldValue(t,s),e.setFieldsValue({[t]:s}),console.log("🔍 [MobileFollowupStageForm] 入住时间设置",{field:t,originalValue:r,formattedValue:s,formValue:e.getFieldValue(t)})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置入住时间失败:",s)}},placeholder:"请选择入住时间",disabled:s()})});case"scheduletime":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(ScheduleTimePickerWithDatePicker,{value:e.getFieldValue(t),onChange:r=>{try{let s=r;r&&dayjs.isDayjs(r)&&(s=r.format("YYYY-MM-DD HH:mm:ss")),e.setFieldValue(t,s),e.setFieldsValue({[t]:s}),console.log("🔍 [MobileFollowupStageForm] 预约时间设置",{field:t,originalValue:r,formattedValue:s,formValue:e.getFieldValue(t)})}catch(s){console.error("❌ [MobileFollowupStageForm] 设置预约时间失败:",s)}},placeholder:"请选择预约时间",disabled:s()})});case"majorcategory":return jsxRuntimeExports.jsx(Form.Item,{...o,children:_.length>0?jsxRuntimeExports.jsx(MajorCategoryPicker,{options:c,value:e.getFieldValue(t),onChange:r=>{try{e.setFieldValue(t,r),e.setFieldsValue({[t]:r})}catch(s){console.error("设置跟进结果失败:",s)}},placeholder:"请选择跟进结果",disabled:s()}):jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#00000040"},children:"加载中..."})});case"followupresult":return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(TextArea,{placeholder:`请输入${n}`,rows:4,maxLength:500,showCount:!0,disabled:s()})});default:return jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx(Input,{placeholder:`请输入${n}`,clearable:!0,disabled:s()})})}}catch(a){return console.error("渲染字段错误:",a,{field:t,label:n,isRequired:i}),jsxRuntimeExports.jsx(Form.Item,{...o,children:jsxRuntimeExports.jsx("div",{style:{padding:"12px",border:"1px solid #ff4d4f",borderRadius:"6px",backgroundColor:"#fff2f0",color:"#ff4d4f"},children:"字段渲染错误，请刷新页面重试"})})}})(n,i,o)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["邀约到店"===t&&jsxRuntimeExports.jsx("div",{className:"border-b-0 border-t-0",style:{padding:"12px 0"},children:jsxRuntimeExports.jsxs(Form.Item,{label:"分配模式",className:"border-b-0 border-t-0",children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",color:"#666"},children:p?"定向分配":"自动分配"}),jsxRuntimeExports.jsx(Switch,{checked:p,onChange:m||(()=>{}),disabled:s()})]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:p?"手动选择带看管家":"根据社区自动分配带看管家"})]})}),S.map((e,r)=>{if("邀约到店"===t){if("assigned_showingsales"===e&&!p)return null;if("scheduledcommunity"===e&&p)return null}return jsxRuntimeExports.jsx("div",{className:"border-b-0 border-t-0",children:C(e)},e)}),"userbudget"===h&&jsxRuntimeExports.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.45)",zIndex:1e3,cursor:"pointer",animation:"fadeIn 0.2s ease-out"},onClick:()=>{x(""),console.log("🔍 [MobileFollowupStageForm] 点击背景退出数字输入")}}),jsxRuntimeExports.jsx(NumberKeyboard,{visible:"userbudget"===h,onClose:()=>{x("")},onInput:t=>{if(f.length>=10)return;const r=f+t;g(r),e.setFieldValue("userbudget",r),e.setFieldsValue({userbudget:r}),v(!1),d&&d(r)},onDelete:()=>{const t=f.slice(0,f.length-1);g(t),e.setFieldValue("userbudget",t),e.setFieldsValue({userbudget:t}),""===t&&v(!0),d&&d(t)},onConfirm:()=>{const t=f||"";e.setFieldValue("userbudget",t),e.setFieldsValue({userbudget:t}),""===t&&v(!0),d&&d(t),x("")},showCloseButton:!1,confirmText:"确定",title:"输入预算金额",customKey:".",style:{zIndex:1001,borderRadius:"16px 16px 0 0",boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.15)"}})]})},followupStages=["丢单","待接收","确认需求","邀约到店","已到店","赢单"],stageFields={"丢单":["majorcategory","followupresult"],"待接收":[],"确认需求":["customerprofile","worklocation","userbudget","moveintime","userrating","majorcategory","followupresult"],"邀约到店":["scheduletime","scheduledcommunity"],"已到店":[],"赢单":[]},processCascaderValue=(e,t)=>{if(!e||!Array.isArray(e))return e;if("worklocation"===t||"majorcategory"===t){if(e.length>1)return e[1];if(1===e.length)return e[0]}return e},hasValueChanged=(e,t)=>{if(!e&&!t)return!1;if(!!e!=!!t)return!0;if(e&&t){if(e instanceof Date&&t instanceof Date)return e.getTime()!==t.getTime();if(e&&"function"==typeof e.format&&t&&"function"==typeof t.format)return e.format("YYYY-MM-DD HH:mm:ss")!==t.format("YYYY-MM-DD HH:mm:ss");if("number"==typeof e||"number"==typeof t){return Number(e)!==Number(t)}return e!==t}return!1},processFormValues=e=>{const t={...e};return["worklocation","majorcategory"].forEach(e=>{t[e]&&Array.isArray(t[e])&&(t[e]=processCascaderValue(t[e],e))}),void 0!==t.userbudget&&""!==t.userbudget&&(t.userbudget=String(t.userbudget)),t},MobileFollowupStageDrawer=({open:e,onClose:t,record:r,onSave:s,isFieldDisabled:n=()=>!1,forceUpdate:i=0,communityEnum:o,followupstageEnum:a,customerprofileEnum:l,userratingEnum:c,majorCategoryOptions:u,metroStationOptions:d,disableAutoSave:p=!1})=>{var m;const[h]=Form.useForm(),[x,f]=reactExports.useState(0),[g,y]=reactExports.useState(""),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState(!1),[w,R]=reactExports.useState(!1),[_,S]=reactExports.useState([]),[C,k]=reactExports.useState(!1),[$,T]=reactExports.useState(!1),[I,P]=reactExports.useState(null),[A]=Form.useForm(),F=reactExports.useRef(!1),M=reactExports.useRef(!1),D=reactExports.useRef(!1),[O,N]=reactExports.useState(!1),[B,L]=reactExports.useState(0),[z,V]=reactExports.useState(!1),[U,H]=reactExports.useState(!1),W=reactExports.useRef(null),q=reactExports.useRef(null),G=reactExports.useRef(null),Y=reactExports.useRef(null),K=reactExports.useCallback((e,t,r)=>{if(s){const n={...t,_optimisticUpdate:!0,_saveType:r};"auto"===r?n._autoSaveOnClose=!0:"manual"===r?n._manualSave=!0:"stage"===r&&(n._stageChange=!0),s(e,n)}},[s]),X=reactExports.useCallback(async()=>{if(null==r?void 0:r.leadid){k(!0);try{const{data:e,error:t}=await supabase.from("deals").select("*").eq("leadid",r.leadid).order("created_at",{ascending:!1});if(t)throw t;S((null==e?void 0:e.map(e=>({...e,isEditing:!1,isNew:!1})))||[])}catch(e){console.error("获取签约记录失败:",e),Toast.show({content:"获取签约记录失败: "+e.message,position:"center"})}finally{k(!1)}}},[null==r?void 0:r.leadid]),J=reactExports.useCallback(()=>{if(W.current){const e=W.current.scrollTop,t=e<=5;H(t),console.log("🔍 [MobileFollowupStageDrawer] 滚动位置检查:",{scrollTop:e,isTop:t,currentStage:g,timestamp:(new Date).toISOString()})}},[g]);reactExports.useEffect(()=>{if(!W.current||!e)return;const t=W.current;return t.addEventListener("scroll",J,{passive:!0}),J(),()=>{t.removeEventListener("scroll",J)}},[e,J]),reactExports.useEffect(()=>{if(!W.current||!e)return;const r=W.current,s=g&&"丢单"!==g&&"赢单"!==g,n=r.closest(".adm-popup")||r,i=e=>{if(!s)return;const t=e.touches[0];q.current={x:t.clientX,y:t.clientY,time:Date.now()},N(!0),L(0),V(!1),Y.current&&cancelAnimationFrame(Y.current)},o=e=>{if(!s||!q.current||!n)return;const t=e.touches[0],r=t.clientX-q.current.x,i=t.clientY-q.current.y;if(Math.sqrt(r*r+i*i)<10)return;const o=r>0&&Math.abs(r)>Math.abs(i),a=i>0&&Math.abs(i)>Math.abs(r);if(o){e.preventDefault(),e.stopPropagation();const t=r,s=Math.min(t,200);L(s),V(s>120)}else if(a&&U){e.preventDefault(),e.stopPropagation();const t=i,r=Math.min(t,150);L(r),V(r>100)}G.current={x:t.clientX,y:t.clientY,time:Date.now()}},a=e=>{if(!(s&&q.current&&G.current&&n))return void N(!1);const r=Date.now()-q.current.time,i=G.current.x-q.current.x,o=G.current.y-q.current.y,a=Math.abs(i),l=Math.abs(o);let c=!1;if(i>0&&a>l){c=i>120||i>50&&a/r>.5}if(!c&&o>0&&l>a&&U){c=o>100||o>50&&l/r>.5}c?(console.log("🔍 [MobileFollowupStageDrawer] 滑动关闭触发，直接关闭弹窗:",{timestamp:(new Date).toISOString(),currentStage:g,currentStep:x,dragDistance:B,shouldClose:z,isDragging:O}),t()):(N(!1),L(0),V(!1),q.current=null,G.current=null)},l=e=>{s&&(e.preventDefault(),e.stopPropagation(),N(!1),L(0),V(!1),q.current=null,G.current=null)};return s&&(n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("touchmove",o,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),n.addEventListener("touchcancel",l,{passive:!1})),()=>{if(s&&(n.removeEventListener("touchstart",i),n.removeEventListener("touchmove",o),n.removeEventListener("touchend",a),n.removeEventListener("touchcancel",l)),r&&(r.style.transition="",r.style.transform="",r.style.opacity=""),r){const e=r.closest(".adm-popup-body");e&&(e.style.transition="",e.style.transform="",e.style.opacity="")}}},[e,z,t,g]),reactExports.useEffect(()=>{e||(N(!1),L(0),V(!1),q.current=null,G.current=null,Y.current&&(cancelAnimationFrame(Y.current),Y.current=null),setTimeout(()=>{if(W.current&&(W.current.style.transition="",W.current.style.transform="",W.current.style.opacity=""),W.current){const e=W.current.closest(".adm-popup-body");e&&(e.style.transition="",e.style.transform="",e.style.opacity="")}},350))},[e]),reactExports.useEffect(()=>{if(r&&e){const e=followupStages.findIndex(e=>e===r.followupstage);f(Math.max(0,e)),y(r.followupstage||"待接收"),X(),F.current=!1,M.current=!1,D.current=!1,N(!1),L(0),V(!1)}},[r,e,X]),reactExports.useEffect(()=>{if(g){const e=`stage-${g.replace(/\s+/g,"-")}`;console.log("🔍 [MobileFollowupStageDrawer] Header类名生成:",{currentStage:g,className:e,currentStep:x,totalSteps:followupStages.length})}},[g,x]),reactExports.useEffect(()=>{if(h&&r&&e){const e=setTimeout(()=>{const e={id:r.id,leadid:r.leadid,followupstage:g||r.followupstage,phone:r.phone,wechat:r.wechat,source:r.source,created_at:r.created_at,customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};["moveintime","scheduletime"].forEach(t=>{e[t]&&(e[t]=dayjs(e[t]))});(stageFields[g||r.followupstage]||[]).forEach(t=>{e[t]||(e[t]="budget"===t||"renttime"===t?0:"viewresult"===t?"待填写":"")}),h.setFieldsValue(e),setTimeout(()=>{const t=h.getFieldsValue();console.log("🔍 [MobileFollowupStageDrawer] 表单值设置验证",{recordId:r.id,targetStage:g||r.followupstage,expected:{userrating:e.userrating,customerprofile:e.customerprofile,followupstage:e.followupstage},actual:{userrating:t.userrating,customerprofile:t.customerprofile,followupstage:t.followupstage},validationPassed:t.userrating===e.userrating&&t.customerprofile===e.customerprofile&&t.followupstage===e.followupstage})},100),F.current=!1,D.current=!1},300);return()=>clearTimeout(e)}},[h,r,e,g,X]);const Z=reactExports.useCallback(()=>{console.log("🔙 [MobileFollowupStageDrawer] 返回按钮被点击"),console.log("🔙 [MobileFollowupStageDrawer] 直接调用 onClose"),t()},[t]),Q=async()=>{if(!M.current){M.current=!0;try{let e=!1;if(r&&h&&!p){const t=h.getFieldsValue(),s=processFormValues(t),n={customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};Object.keys(s).forEach(t=>{const r=s[t],i=n[t];hasValueChanged(i,r)&&(e=!0)})}if(r&&h&&!p){h.validateFields().catch(()=>{}),await new Promise(e=>setTimeout(e,50));const e=h.getFieldsValue(),t=processFormValues(e);let s=!1;const n=[],i={customerprofile:r.customerprofile,worklocation:r.worklocation,userbudget:r.userbudget,moveintime:r.moveintime,userrating:r.userrating,majorcategory:r.majorcategory,followupresult:r.followupresult,scheduledcommunity:r.scheduledcommunity,scheduletime:r.scheduletime};if(Object.keys(t).forEach(e=>{const r=t[e],o=i[e];hasValueChanged(o,r)&&(s=!0,n.push(e))}),s){const e={};Object.keys(t).forEach(r=>{const s=t[r],n=i[r];hasValueChanged(n,s)&&(e[r]=s)}),["moveintime","scheduletime"].forEach(t=>{var r;e[t]&&"function"==typeof(null==(r=e[t])?void 0:r.format)&&(e[t]=e[t].format("YYYY-MM-DD HH:mm:ss"))});const{error:s}=await supabase.from("followups").update(e).eq("id",r.id);if(s)Toast.show({content:"数据保存失败，请检查网络连接",position:"center"});else{const t={...r,...e};K(t,e,"auto")}}}}catch(e){Toast.show({content:"自动保存失败，请检查网络连接",position:"center"})}finally{f(0),y(""),S([]),k(!1),b(!1),N(!1),L(0),V(!1),t(),setTimeout(()=>{M.current=!1},300)}}},ee=async(e={})=>{if(!r)return Toast.show({content:"无当前记录，无法保存",position:"center"}),{success:!1,error:"无当前记录"};try{E(!0),console.log("🔍 [MobileFollowupStageDrawer] 开始表单验证",{recordId:null==r?void 0:r.id,currentStage:g,currentStep:x,formInstance:!!h});const t=await h.validateFields();console.log("✅ [MobileFollowupStageDrawer] 表单验证通过",{recordId:null==r?void 0:r.id,validatedValues:t,fieldsCount:Object.keys(t).length}),await new Promise(e=>setTimeout(e,50));const s=processFormValues(t);["moveintime","scheduletime"].forEach(e=>{var t;s[e]&&"function"==typeof(null==(t=s[e])?void 0:t.format)&&(s[e]=s[e].format("YYYY-MM-DD HH:mm:ss"))});const{...n}=s,i={...n,...e},{error:o}=await supabase.from("followups").update(i).eq("id",r.id);if(o)throw o;D.current=!0;const a={...r,...i};return K(a,i,"manual"),Toast.show({content:"保存成功",position:"center"}),{success:!0}}catch(t){console.error("❌ [MobileFollowupStageDrawer] 保存失败:",t);let e="未知错误";if(t.errorFields&&Array.isArray(t.errorFields)){const s=t.errorFields.map(e=>e.name).join("、");e=`请完善以下必填字段：${s}`,console.warn("⚠️ [MobileFollowupStageDrawer] 表单验证失败字段:",{recordId:null==r?void 0:r.id,errorFields:t.errorFields,fieldNames:s})}else t.message?e=t.message:t.details&&(e=t.details);return Toast.show({content:"保存失败: "+e,position:"center"}),{success:!1,error:e}}finally{E(!1)}},te=e=>{R(e),h.setFieldsValue({assigned_showingsales:void 0})},[re,se]=reactExports.useState(!1),[ne,ie]=reactExports.useState(""),[oe,ae]=reactExports.useState(!1),le=()=>{T(!1),P(null),ie(""),A.resetFields()};return jsxRuntimeExports.jsxs(Popup,{visible:e,onMaskClick:Q,bodyStyle:{borderTopLeftRadius:"16px",borderTopRightRadius:"16px",minHeight:"80vh",maxHeight:"90vh",overflow:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",willChange:"transform"},destroyOnClose:!1,closeOnMaskClick:!1,className:"mobile-followup-drawer",maskStyle:{backgroundColor:"rgba(0, 0, 0, 0.45)",backdropFilter:"blur(2px)"},position:"bottom",showCloseButton:!1,children:[jsxRuntimeExports.jsxs("div",{ref:W,className:"border-0 divide-y-0",style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",touchAction:"pan-y"},children:[jsxRuntimeExports.jsx(NavBar,{onBack:Z,className:"border-b-0",style:{flexShrink:0,minHeight:"60px",background:"#ffffff",borderBottom:"1px solid #f0f0f0"},right:"丢单"!==g&&"赢单"!==g?jsxRuntimeExports.jsx(Button,{size:"small",color:"danger",fill:"none",onClick:()=>{try{if(!r)return void Toast.show({content:"无当前记录，无法操作",position:"center"});y("丢单"),f(followupStages.findIndex(e=>"丢单"===e)),Toast.show({content:"已切换到丢单阶段",position:"center"})}catch(e){console.error("❌ [MobileFollowupStageDrawer] 丢单按钮点击异常:",e),Toast.show({content:"操作失败: "+(e.message||"未知错误"),position:"center"})}},children:"丢单"}):null,children:jsxRuntimeExports.jsxs("div",{className:"simple-title-container",children:[jsxRuntimeExports.jsx("div",{className:"simple-title-main",children:"跟进阶段管理"}),jsxRuntimeExports.jsxs("div",{className:"simple-title-sub",children:[g||"待接收"," (",x+1,"/",followupStages.length,")"]})]})}),jsxRuntimeExports.jsxs("div",{className:"content-scroll-area border-0 divide-y-0",style:{flex:1,overflow:"auto",padding:"0 16px",WebkitOverflowScrolling:"touch",minHeight:0,paddingBottom:"20px"},children:[("已到店"===g||"赢单"===g)&&jsxRuntimeExports.jsx(ContractDealsTable,{dealsList:_,dealsLoading:C,onAdd:()=>{P(null),ie(""),T(!0),setTimeout(()=>{A.resetFields(),A.setFieldValue("contractdate",dayjs())},100)},onEdit:e=>{P(e),ie(e.community||""),T(!0),setTimeout(()=>{A.setFieldsValue({contractdate:e.contractdate?dayjs(e.contractdate):dayjs(),community:e.community||"",contractnumber:e.contractnumber||"",roomnumber:e.roomnumber||""})},100)},onDelete:e=>{e.isNew?S(t=>t.filter(t=>t.id!==e.id)):S(t=>t.map(t=>t.id===e.id?{...t,isEditing:!1}:t))},currentRecord:r,communityEnum:o,setDealsList:S}),(()=>{if("已到店"===g||"赢单"===g)return null;if(!g||""===g)return null;return 0===(stageFields[g]||[]).length?jsxRuntimeExports.jsxs("div",{className:"border-0 divide-y-0",style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[jsxRuntimeExports.jsx("p",{children:"当前阶段无需填写额外信息"}),jsxRuntimeExports.jsx("p",{children:'点击"下一步"继续推进'})]}):jsxRuntimeExports.jsx(Form,{form:h,layout:"vertical",preserve:!1,className:"border-0 divide-y-0",children:jsxRuntimeExports.jsx(MobileFollowupStageForm,{form:h,stage:g,record:r,isFieldDisabled:n,forceUpdate:i,communityEnum:o,followupstageEnum:a,customerprofileEnum:l,userratingEnum:c,majorCategoryOptions:u,metroStationOptions:d,enableManualAssign:w,onAllocationModeChange:te,onBudgetChange:e=>{h.setFieldValue("userbudget",e),h.setFieldsValue({userbudget:e}),setTimeout(()=>{h.setFieldsValue({userbudget:e})},0)}})})})()]}),jsxRuntimeExports.jsx("div",{className:"fixed-footer border-0 divide-y-0",style:{flexShrink:0,padding:"16px",borderTop:"1px solid #f0f0f0",backgroundColor:"white",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.1)"},children:jsxRuntimeExports.jsxs(Space,{direction:"vertical",block:!0,className:"button-group border-0 divide-y-0",children:["丢单"!==g&&x>0&&jsxRuntimeExports.jsx(Button,{block:!0,onClick:async()=>{try{if(!r)return void Toast.show({content:"无当前记录，无法保存",position:"center"});const e=followupStages[x-1],t=h.getFieldsValue(),{followupstage:s,...n}=t;if(Object.keys(n).length>0){const e=await ee(n);if(!e||!e.success)return console.warn("⚠️ [MobileFollowupStageDrawer] 其他字段保存失败 - 上一步",{recordId:null==r?void 0:r.id,saveResult:e,error:null==e?void 0:e.error}),void((null==e?void 0:e.error)&&Toast.show({content:"字段保存失败: "+e.error,position:"center"}))}f(x-1),y(e),Toast.show({content:"已回退到上一阶段",position:"center"})}catch(e){console.error("❌ [MobileFollowupStageDrawer] 上一步操作异常",{recordId:null==r?void 0:r.id,fromStage:g,error:e.message}),Toast.show({content:"操作失败: "+(e.message||"未知错误"),position:"center"})}},className:"touch-feedback border-0 divide-y-0",children:"上一步"}),"邀约到店"===g&&jsxRuntimeExports.jsx(Button,{block:!0,color:"primary",onClick:async()=>{if(r)try{b(!0);const s=await h.validateFields(),n=s.scheduletime,i=s.scheduledcommunity;if(!n)return void Toast.show({content:"请先选择预约到店时间",position:"center"});let o=null,a="系统自动分配";if(w){const t=s.assigned_showingsales;if(!t)return void Toast.show({content:"请选择带看人员",position:"center"});o=t;try{const{data:e}=await supabase.from("users_profile").select("nickname").eq("id",t).single();a=(null==e?void 0:e.nickname)||`用户${t}`}catch(e){console.warn("获取带看管家姓名失败:",e),a=`用户${t}`}}else{if(!i)return void Toast.show({content:"请先选择预约社区",position:"center"});const{data:e,error:r}=await supabase.rpc("assign_showings_user",{p_community:i});if(r||!e)return void Toast.show({content:"分配带看人员失败: "+((null==r?void 0:r.message)||"无可用人员"),position:"center"});o=e;try{const{data:t}=await supabase.from("users_profile").select("nickname").eq("id",e).single();a=(null==t?void 0:t.nickname)||String(e)}catch(t){console.warn("获取带看管家姓名失败:",t)}}const l={leadid:r.leadid,scheduletime:dayjs(n).toISOString(),community:i||null,showingsales:o,viewresult:"待填写",budget:0,moveintime:dayjs().add(1,"month").toISOString(),remark:"",renttime:12},{data:c,error:u}=await supabase.from("showings").insert([l]).select().single();if(u)return console.error("创建带看单失败:",u),void Toast.show({content:"创建带看单失败: "+u.message,position:"center"});const d={followupstage:"已到店"},p=await ee(d);if(p&&p.success){f(x+1),y("已到店");const e=o?`带看单已发放，已分配给：${a}`:"带看单已发放，系统将自动分配带看管家";Toast.show({content:e,position:"center",duration:3e3}),console.log("✅ [MobileFollowupStageDrawer] 带看单发放成功:",{recordId:r.id,showingId:null==c?void 0:c.id,assignedShowingsales:o,assignedShowingsalesName:a,scheduletime:dayjs(n).format("YYYY-MM-DD HH:mm:ss"),scheduledcommunity:i})}else console.warn("⚠️ [MobileFollowupStageDrawer] 阶段切换失败 - 发放带看单",{recordId:null==r?void 0:r.id,fromStage:g,toStage:"已到店",saveResult:p,error:null==p?void 0:p.error,timestamp:(new Date).toISOString()}),Toast.show({content:"阶段切换失败，请重试",position:"center"})}catch(e){console.error("❌ [MobileFollowupStageDrawer] 发放带看单异常:",{recordId:null==r?void 0:r.id,fromStage:g,error:e.message||e.toString(),stack:e.stack,timestamp:(new Date).toISOString()}),Toast.show({content:"操作失败: "+(e.message||"未知错误"),position:"center"})}finally{b(!1)}else Toast.show({content:"无当前记录，无法分配",position:"center"})},loading:j,disabled:j,className:"touch-feedback border-0 divide-y-0",children:j?"分配中...":"发放带看单"}),"丢单"===g&&jsxRuntimeExports.jsxs(Space,{direction:"vertical",block:!0,className:"border-0 divide-y-0",children:[jsxRuntimeExports.jsx(Button,{block:!0,color:"danger",onClick:async()=>{if(r)try{E(!0);const e="丢单",t=await ee({followupstage:e});t&&t.success?Toast.show({content:"已确认丢单",position:"center"}):(console.warn("⚠️ [MobileFollowupStageDrawer] 阶段切换失败 - 确认丢单",{recordId:null==r?void 0:r.id,fromStage:g,toStage:e,saveResult:t,error:null==t?void 0:t.error,currentStep:x,targetStep:"丢单"}),(null==t?void 0:t.error)&&Toast.show({content:"确认丢单失败: "+t.error,position:"center"}))}catch(e){console.error("❌ [MobileFollowupStageDrawer] 阶段切换异常 - 确认丢单",{recordId:null==r?void 0:r.id,fromStage:g,error:e.message}),Toast.show({content:"确认丢单失败: "+(e.message||"未知错误"),position:"center"})}finally{E(!1)}},disabled:n(),className:"touch-feedback border-0 divide-y-0",children:"确认丢单"}),jsxRuntimeExports.jsx(Button,{block:!0,onClick:async()=>{if(r)try{E(!0);const e="待接收",t=await ee({followupstage:e});t&&t.success?(f(0),y(e),Toast.show({content:"已恢复状态",position:"center"})):(console.warn("⚠️ [MobileFollowupStageDrawer] 阶段切换失败 - 恢复状态",{recordId:null==r?void 0:r.id,fromStage:g,toStage:e,saveResult:t,error:null==t?void 0:t.error,currentStep:x,targetStep:0}),(null==t?void 0:t.error)&&Toast.show({content:"恢复状态失败: "+t.error,position:"center"}))}catch(e){console.error("❌ [MobileFollowupStageDrawer] 阶段切换异常 - 恢复状态",{recordId:null==r?void 0:r.id,fromStage:g,error:e.message}),Toast.show({content:"恢复状态失败: "+(e.message||"未知错误"),position:"center"})}finally{E(!1)}},disabled:n(),className:"touch-feedback border-0 divide-y-0",children:"恢复状态"})]}),x<followupStages.length-1&&"已到店"!==g&&"丢单"!==g&&jsxRuntimeExports.jsx(Button,{block:!0,color:"primary",loading:v,onClick:async()=>{try{if(!r)return void Toast.show({content:"无当前记录，无法保存",position:"center"});const e=followupStages[x+1],t=await ee({followupstage:e});t&&t.success?(f(x+1),y(e),Toast.show({content:"已推进到下一阶段",position:"center"})):(console.warn("⚠️ [MobileFollowupStageDrawer] 阶段切换失败 - 下一步",{recordId:null==r?void 0:r.id,fromStage:g,toStage:e,saveResult:t,error:null==t?void 0:t.error,currentStep:x,targetStep:x+1}),(null==t?void 0:t.error)&&Toast.show({content:"阶段推进失败: "+t.error,position:"center"}))}catch(e){console.error("❌ [MobileFollowupStageDrawer] 阶段切换异常 - 下一步",{recordId:null==r?void 0:r.id,fromStage:g,error:e.message}),Toast.show({content:"推进失败: "+(e.message||"请完整填写所有必填项"),position:"center"})}},className:"touch-feedback border-0 divide-y-0",children:"下一步"}),x===followupStages.length-1&&jsxRuntimeExports.jsx(Button,{block:!0,color:"primary",onClick:()=>{Toast.show({content:"跟进阶段管理完成",position:"center"}),Q()},className:"touch-feedback border-0 divide-y-0",children:"完成"})]})})]}),jsxRuntimeExports.jsx(Modal,{visible:$,title:I?"编辑签约记录":"新增签约记录",onClose:le,closeOnMaskClick:!1,content:jsxRuntimeExports.jsxs(Form,{form:A,layout:"vertical",className:"deal-form",initialValues:I?{contractdate:I.contractdate?dayjs(I.contractdate):dayjs(),community:I.community||"",contractnumber:I.contractnumber||"",roomnumber:I.roomnumber||""}:{contractdate:dayjs(),community:"",contractnumber:"",roomnumber:""},children:[jsxRuntimeExports.jsx(Form.Item,{name:"contractdate",label:"签约日期",rules:[{required:!0,message:"请选择签约日期"}],children:jsxRuntimeExports.jsx(Form.Item,{shouldUpdate:(e,t)=>e.contractdate!==t.contractdate,noStyle:!0,children:({getFieldValue:e})=>{const t=e("contractdate");return jsxRuntimeExports.jsx("div",{className:"date-picker-trigger",style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"white",cursor:"pointer",color:t?"inherit":"#999",minHeight:"44px",display:"flex",alignItems:"center"},onClick:()=>ae(!0),children:t?t.format("YYYY-MM-DD"):"请选择签约日期"})}})}),jsxRuntimeExports.jsx(Form.Item,{name:"community",label:"签约社区",rules:[{required:!0,message:"请选择签约社区"}],children:jsxRuntimeExports.jsx("div",{className:"community-picker-trigger",style:{padding:"12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"white",cursor:"pointer",color:ne?"inherit":"#999",minHeight:"44px",display:"flex",alignItems:"center"},onClick:()=>se(!0),children:ne||"请选择签约社区"})}),jsxRuntimeExports.jsx(Form.Item,{name:"contractnumber",label:"合同编号",rules:[{required:!0,message:"请填写合同编号"}],children:jsxRuntimeExports.jsx(Input,{placeholder:"请填写合同编号"})}),jsxRuntimeExports.jsx(Form.Item,{name:"roomnumber",label:"房间号",rules:[{required:!0,message:"请填写房间号"}],children:jsxRuntimeExports.jsx(Input,{placeholder:"请填写房间号"})})]}),actions:[{key:"cancel",text:"取消",onClick:le},{key:"confirm",text:"确定",onClick:async()=>{try{const e=await A.validateFields();if(I)if(I.isNew){const t={leadid:null==r?void 0:r.leadid,contractdate:e.contractdate.format("YYYY-MM-DD"),community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber},{data:s,error:n}=await supabase.from("deals").insert([t]).select().single();if(n)return void Toast.show({content:"创建签约记录失败: "+n.message,position:"center"});S(e=>e.map(e=>e.id===I.id?{...s,isEditing:!1}:e)),Toast.show({content:"签约记录已保存",position:"center"});const i=await ee({followupstage:"赢单"});i&&i.success?(f(x+1),y("赢单"),Toast.show({content:"已推进到赢单阶段",position:"center"})):console.warn("⚠️ [MobileFollowupStageDrawer] 推进到赢单阶段失败",{recordId:null==r?void 0:r.id,saveResult:i})}else{const{error:t}=await supabase.from("deals").update({contractdate:e.contractdate.format("YYYY-MM-DD"),community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber}).eq("id",I.id);if(t)return void Toast.show({content:"更新签约记录失败: "+t.message,position:"center"});if(S(e=>e.map(e=>e.id===I.id?{...e,isEditing:!1}:e)),Toast.show({content:"签约记录已更新",position:"center"}),"赢单"!==g){console.log("🔍 [MobileFollowupStageDrawer] 编辑成交纪录后准备推进到赢单阶段",{recordId:null==r?void 0:r.id,currentStage:g,currentStep:x,editingDeal:I});const e=await ee({followupstage:"赢单"});e&&e.success?(console.log("✅ [MobileFollowupStageDrawer] 编辑成交纪录后成功推进到赢单阶段",{recordId:null==r?void 0:r.id,fromStage:g,toStage:"赢单",result:e}),f(x+1),y("赢单"),Toast.show({content:"已推进到赢单阶段",position:"center"})):console.warn("⚠️ [MobileFollowupStageDrawer] 编辑成交纪录后推进到赢单阶段失败",{recordId:null==r?void 0:r.id,currentStage:g,saveResult:e})}}else{const t={leadid:null==r?void 0:r.leadid,contractdate:e.contractdate.format("YYYY-MM-DD"),community:e.community,contractnumber:e.contractnumber,roomnumber:e.roomnumber},{data:s,error:n}=await supabase.from("deals").insert([t]).select().single();if(n)return void Toast.show({content:"创建签约记录失败: "+n.message,position:"center"});S(e=>[s,...e]),Toast.show({content:"签约记录已创建",position:"center"}),console.log("🔍 [MobileFollowupStageDrawer] 新增成交纪录后准备推进到赢单阶段",{recordId:null==r?void 0:r.id,currentStage:g,currentStep:x,newDeal:s});const i=await ee({followupstage:"赢单"});i&&i.success?(console.log("✅ [MobileFollowupStageDrawer] 新增成交纪录后成功推进到赢单阶段",{recordId:null==r?void 0:r.id,fromStage:g,toStage:"赢单",result:i}),f(x+1),y("赢单"),Toast.show({content:"已推进到赢单阶段",position:"center"})):console.warn("⚠️ [MobileFollowupStageDrawer] 新增成交纪录后推进到赢单阶段失败",{recordId:null==r?void 0:r.id,currentStage:g,saveResult:i})}T(!1),P(null),A.resetFields()}catch(e){console.error("签约记录保存失败:",e),Toast.show({content:"保存失败: "+(e.message||"未知错误"),position:"center"})}}}]}),jsxRuntimeExports.jsx(Picker,{title:"选择签约社区",columns:[o],visible:re,onClose:()=>se(!1),onConfirm:e=>{if(e&&e.length>0){const t=e[0];ie(t),A.setFieldValue("community",t)}se(!1)},value:ne?[ne]:[]}),jsxRuntimeExports.jsx(DatePicker,{title:"选择签约日期",visible:oe,onClose:()=>ae(!1),onConfirm:e=>{if(e){const t=dayjs(e);A.setFieldValue("contractdate",t)}ae(!1)},value:null==(m=A.getFieldValue("contractdate"))?void 0:m.toDate(),precision:"day"})]})},MobileHeader=({keywordSearch:e,onKeywordChange:t,onKeywordSearch:r,onKeywordClear:s,onFilterClick:n,onQuickFilter:i,showBackButton:o=!0})=>{const[a,l]=reactExports.useState(null),[c,u]=reactExports.useState(null),d=e=>{a===e?(l(null),null==i||i(null,c)):(l(e),null==i||i(e,c))},p=e=>{c===e?(u(null),null==i||i(a,null)):(u(e),null==i||i(a,e))};return jsxRuntimeExports.jsxs("div",{className:"mobile-header",children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"12px",flexWrap:"nowrap",width:"100%",marginBottom:"12px"},children:[jsxRuntimeExports.jsx("div",{className:"header-search",style:{flex:1,minWidth:"120px",margin:0,padding:0},children:jsxRuntimeExports.jsx(SearchBar,{placeholder:"编号、联系方式或管家...",value:e||"",onChange:e=>{t(e)},onSearch:e=>{r(e)},onClear:s,style:{"--background":"#ffffff","--border-radius":"12px","--height":"36px","--padding-left":"12px"}})}),jsxRuntimeExports.jsx("div",{className:"header-actions",style:{flexShrink:0,minWidth:"60px",margin:0,padding:0},children:jsxRuntimeExports.jsx(Button,{onClick:n,size:"small",fill:"outline",color:"default",style:{"--border-radius":"8px","--border-color":"#d1d5db","--height":"36px"},children:"筛选"})})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:"8px",padding:0,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Tag,{color:3===a?"primary":"default",fill:3===a?"solid":"outline",onClick:()=>d(3),style:{cursor:"pointer",padding:"1px 3px",margin:"0",fontSize:"7px",width:"fit-content",minWidth:"unset",maxWidth:"none",height:"22px","--border-radius":"6px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",border:3===a?"1px solid #1890ff":"none"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#faad14",lineHeight:"1",letterSpacing:"1px"},children:"★★★"})}),jsxRuntimeExports.jsx(Tag,{color:2===a?"primary":"default",fill:2===a?"solid":"outline",onClick:()=>d(2),style:{cursor:"pointer",padding:"1px 3px",margin:"0",fontSize:"7px",width:"fit-content",minWidth:"unset",maxWidth:"none",height:"22px","--border-radius":"6px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",border:2===a?"1px solid #1890ff":"none"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#faad14",lineHeight:"1",letterSpacing:"1px"},children:"★★☆"})}),jsxRuntimeExports.jsx(Tag,{color:1===a?"primary":"default",fill:1===a?"solid":"outline",onClick:()=>d(1),style:{cursor:"pointer",padding:"1px 3px",margin:"0",fontSize:"7px",width:"fit-content",minWidth:"unset",maxWidth:"none",height:"22px","--border-radius":"6px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",border:1===a?"1px solid #1890ff":"none"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"#faad14",lineHeight:"1",letterSpacing:"1px"},children:"★☆☆"})}),jsxRuntimeExports.jsx(Tag,{color:"current"===c?"primary":"default",fill:"current"===c?"solid":"outline",onClick:()=>p("current"),style:{cursor:"pointer",padding:"1px 3px",margin:"0",fontSize:"7px",width:"fit-content",minWidth:"unset",maxWidth:"none",height:"22px","--border-radius":"6px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",border:"current"===c?"1px solid #1890ff":"none"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"10px",color:"#666",lineHeight:"1"},children:"月内入住"})}),jsxRuntimeExports.jsx(Tag,{color:"next"===c?"primary":"default",fill:"next"===c?"solid":"outline",onClick:()=>p("next"),style:{cursor:"pointer",padding:"1px 3px",margin:"0",fontSize:"7px",width:"fit-content",minWidth:"unset",maxWidth:"none",height:"22px","--border-radius":"6px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",border:"next"===c?"1px solid #1890ff":"none"},children:jsxRuntimeExports.jsx("span",{style:{fontSize:"10px",color:"#666",lineHeight:"1"},children:"下月入住"})})]})]})},CardContextMenu=({visible:e,x:t,y:r,record:s,onClose:n})=>{const i=reactExports.useRef(null);reactExports.useEffect(()=>{const t=e=>{i.current&&!i.current.contains(e.target)&&n()};return e&&(document.addEventListener("mousedown",t),document.addEventListener("touchstart",t)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}},[e,n]);if(!e)return null;const o=jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{ref:i,className:"card-context-menu",style:{position:"fixed",zIndex:9999,left:Math.max(10,Math.min(window.innerWidth-180,t-90)),top:r>window.innerHeight/2?r-160:r+20},onClick:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"menu-item primary",onClick:e=>{e.stopPropagation(),e.preventDefault();try{s.phone?(navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(s.phone).catch(()=>{}),window.location.href=`tel:${s.phone}`,setTimeout(()=>{staticMethods.success(`正在拨打：${s.phone}`)},500),n()):staticMethods.warning("该记录没有电话信息")}catch(t){console.error("拨打电话失败:",t),staticMethods.error("拨打失败，请手动拨打")}},children:[jsxRuntimeExports.jsx(RefIcon$1,{className:"menu-icon"}),jsxRuntimeExports.jsx("span",{children:"拨打电话"})]}),jsxRuntimeExports.jsxs("div",{className:"menu-item",onClick:async e=>{e.stopPropagation(),e.preventDefault();try{if(s.phone){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(s.phone),staticMethods.success("电话已复制到剪贴板");else{const e=document.createElement("textarea");e.value=s.phone,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e),staticMethods.success("电话已复制到剪贴板")}setTimeout(()=>{n()},500)}else staticMethods.warning("该记录没有电话信息")}catch(t){console.error("复制电话失败:",t);try{const e=document.createElement("textarea");e.value=s.phone||"",e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e),staticMethods.success("电话已复制到剪贴板"),n()}catch(r){console.error("降级复制也失败:",r),staticMethods.error("复制失败，请手动复制")}}},children:[jsxRuntimeExports.jsx(RefIcon,{className:"menu-icon"}),jsxRuntimeExports.jsx("span",{children:"复制电话"})]}),jsxRuntimeExports.jsxs("div",{className:"menu-item",onClick:async e=>{e.stopPropagation(),e.preventDefault();try{let e="",t="";if(s.wechat)if(e=s.wechat,t="微信号",navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(s.wechat);else{const e=document.createElement("textarea");e.value=s.wechat,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}else{if(!s.phone)return void staticMethods.warning("该记录没有微信和电话信息");if(e=s.phone,t="手机号",navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(s.phone);else{const e=document.createElement("textarea");e.value=s.phone,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}}try{const r="weixin://";window.location.href=r,setTimeout(()=>{s.wechat?staticMethods.success(`${t}已复制：${e}，微信已打开，请按以下步骤添加好友：\n1. 点击微信底部的"通讯录"\n2. 点击右上角的"+"号\n3. 选择"添加朋友"\n4. 粘贴${t}搜索添加`):staticMethods.success(`${t}已复制：${e}，微信已打开，请按以下步骤添加好友：\n1. 点击微信底部的"通讯录"\n2. 点击右上角的"+"号\n3. 选择"添加朋友"\n4. 选择"手机号"或"搜索手机号"\n5. 粘贴手机号搜索添加`)},1e3)}catch{s.wechat?staticMethods.info(`${t}已复制：${e}，请手动打开微信添加好友`):staticMethods.info(`${t}已复制：${e}，请手动打开微信，通过手机号搜索添加好友`)}n()}catch(t){console.error("添加微信好友失败:",t),s.wechat?staticMethods.info(`微信号：${s.wechat}，请手动搜索添加`):s.phone&&staticMethods.info(`手机号：${s.phone}，请手动在微信中搜索添加`),n()}},children:[jsxRuntimeExports.jsx(RefIcon$2,{className:"menu-icon"}),jsxRuntimeExports.jsx("span",{children:"添加微信好友"})]}),jsxRuntimeExports.jsxs("div",{className:"menu-item",onClick:e=>{e.stopPropagation(),e.preventDefault();try{if(s.phone){const e="您好，我是微领地青年社区的专属管家！我已经添加您的微信了，辛苦通过一下。";navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(e).catch(()=>{});const t=encodeURIComponent(e);window.location.href=`sms:${s.phone}?body=${t}`,setTimeout(()=>{staticMethods.success(`正在发送短信提醒给：${s.phone}`)},500),n()}else staticMethods.warning("该记录没有电话信息")}catch(t){console.error("发送短信提醒失败:",t),staticMethods.error("发送短信提醒失败，请手动发送")}},children:[jsxRuntimeExports.jsx(RefIcon$1a,{className:"menu-icon"}),jsxRuntimeExports.jsx("span",{children:"发送短信提醒"})]})]})});return ReactDOM$1.createPortal(o,document.body)},SwipeMenu=({visible:e,closing:t,onRollback:r,onClose:s})=>{const[n,i]=reactExports.useState(!1),o=t||n,a=reactExports.useRef({x:0,y:0});reactExports.useEffect(()=>{e&&i(!1)},[e]);const l=reactExports.useMemo(()=>()=>{try{"function"==typeof s&&(i(!0),setTimeout(()=>{s(),i(!1)},300))}catch(e){console.warn("SwipeMenu onClose error:",e),i(!1)}},[s]),c=reactExports.useMemo(()=>()=>{try{"function"==typeof r&&(i(!0),setTimeout(()=>{r(),i(!1)},300))}catch(e){console.warn("SwipeMenu onRollback error:",e),i(!1)}},[r]),u=reactExports.useCallback(e=>{var t;(null==(t=e.touches)?void 0:t[0])&&(a.current={x:e.touches[0].clientX||0,y:e.touches[0].clientY||0})},[]),d=reactExports.useCallback(e=>{var t;if(!(null==(t=e.touches)?void 0:t[0]))return;const r=(e.touches[0].clientX||0)-a.current.x,s=(e.touches[0].clientY||0)-a.current.y;Math.abs(r)>30?(r>0||r<0)&&l():Math.abs(s)>10&&l()},[l]),p=reactExports.useCallback(e=>{e.preventDefault(),e.stopPropagation(),c()},[c]);return e?r&&s?jsxRuntimeExports.jsx("div",{className:"swipe-menu "+(o?"swipe-menu-closing":""),onTouchStart:u,onTouchMove:d,children:jsxRuntimeExports.jsxs("div",{className:"swipe-menu-item rollback-item",onClick:p,children:[jsxRuntimeExports.jsx(RefIcon$d,{className:"swipe-menu-icon"}),jsxRuntimeExports.jsx("span",{className:"swipe-menu-text",children:"回退"})]})}):(console.warn("SwipeMenu: Missing required props"),null):null},CustomerCard=React$2.memo(({record:e,onEdit:t,onRegister:r,onUnregister:s,onRollback:n})=>{const i=reactExports.useRef(null),[o,a]=reactExports.useState(!1),[l,c]=reactExports.useState({x:0,y:0}),u=reactExports.useRef(null),d=reactExports.useRef(0),p=reactExports.useRef(!1),[m,h]=reactExports.useState(!1),[x,f]=reactExports.useState(!1),g=reactExports.useRef(0),y=reactExports.useRef(0),v=reactExports.useRef(!1),E=e.followupstage||"未知",j=e.majorcategory,b=e.expectedmoveindate,w=e.moveintime,R=e.worklocation,_=e.userbudget,S=e.followupresult||"",C=e.wechat||"",k=j&&"未设置"!==j||R&&"未设置"!==R||b&&"未设置"!==b||w&&"未设置"!==w||_&&"未设置"!==_||S;reactExports.useEffect(()=>(i.current&&r&&r(e.leadid||e.id,i.current),()=>{s&&s(e.leadid||e.id)}),[e.leadid,e.id,r,s]),reactExports.useEffect(()=>{if(!m)return;let e,t=null,r=null;const s=()=>{clearTimeout(e),e=setTimeout(()=>{f(!0),setTimeout(()=>{h(!1),f(!1)},300)},100)};window.addEventListener("scroll",s,{passive:!0});const n=e=>{e.touches[0]&&(t=e.touches[0].clientX,r=e.touches[0].clientY)},i=s=>{if(!s.touches[0]||null===r||null===t)return;const n=s.touches[0].clientX,i=s.touches[0].clientY,o=Math.abs(i-r);o>Math.abs(n-t)&&o>10&&(clearTimeout(e),e=setTimeout(()=>{f(!0),setTimeout(()=>{h(!1),f(!1)},300)},50))};return document.addEventListener("touchstart",n,{passive:!0}),document.addEventListener("touchmove",i,{passive:!0}),()=>{window.removeEventListener("scroll",s),document.removeEventListener("touchstart",n),document.removeEventListener("touchmove",i),clearTimeout(e)}},[m]);const $=reactExports.useCallback(e=>{const t=e.touches[0];g.current=t.clientX,y.current=t.clientY,d.current=Date.now(),p.current=!1,v.current=!1,u.current=setTimeout(()=>{var e;if(!v.current){(null==(e=i.current)?void 0:e.getBoundingClientRect())&&(c({x:t.clientX,y:t.clientY}),a(!0),p.current=!0)}},500)},[]),T=reactExports.useCallback(e=>{if(o)return;const t=e.touches[0],r=t.clientX-g.current,s=t.clientY-y.current;Math.sqrt(r*r+s*s)>10&&(v.current=!0,u.current&&(clearTimeout(u.current),u.current=null),Math.abs(r)>Math.abs(s)?r<-20?m||h(!0):r>20&&m&&(f(!0),setTimeout(()=>{h(!1),f(!1)},300)):Math.abs(s)>Math.abs(r)&&Math.abs(s)>10&&m&&(f(!0),setTimeout(()=>{h(!1),f(!1)},300)))},[o,m]),I=reactExports.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null),v.current=!1},[]),P=reactExports.useCallback(e=>{2===e.button&&(e.preventDefault(),c({x:e.clientX,y:e.clientY}),a(!0))},[]),A=reactExports.useCallback(e=>{e.preventDefault(),c({x:e.clientX,y:e.clientY}),a(!0)},[]),F=reactExports.useCallback(()=>{setTimeout(()=>{a(!1)},100)},[]),M=reactExports.useCallback(e=>{n&&n(e),F()},[n,F]),D=reactExports.useCallback(()=>{n&&n(e),f(!0),setTimeout(()=>{h(!1),f(!1)},300)},[n,e]),O=reactExports.useCallback(()=>{f(!0),setTimeout(()=>{h(!1),f(!1)},300)},[]),N=reactExports.useCallback(r=>m?(f(!0),setTimeout(()=>{h(!1),f(!1)},300),r.preventDefault(),void r.stopPropagation()):p.current?(r.preventDefault(),r.stopPropagation(),void(p.current=!1)):void t(e),[m,t,e]);return jsxRuntimeExports.jsxs("div",{className:"customer-card-container",children:[jsxRuntimeExports.jsxs("div",{ref:i,className:"customer-card "+(m?"swiped":""),onClick:N,onTouchStart:$,onTouchEnd:I,onTouchMove:T,onTouchCancel:I,onMouseDown:P,onContextMenu:A,children:[jsxRuntimeExports.jsx("div",{className:`card-header ${z=E,{"待接收":"stage-pending","确认需求":"stage-confirm","邀约到店":"stage-invite","已到店":"stage-visited","赢单":"stage-win","丢单":"stage-lose"}[z]||""}`,children:jsxRuntimeExports.jsxs("div",{className:"customer-details",children:[jsxRuntimeExports.jsxs("div",{className:"lead-header-row",children:[jsxRuntimeExports.jsx("div",{className:"lead-id",children:e.leadid||"未知编号"}),jsxRuntimeExports.jsx("div",{className:"stage-tag",children:E})]}),jsxRuntimeExports.jsxs("div",{className:"rating-contact-row",children:[jsxRuntimeExports.jsx("div",{className:"contact-info",children:jsxRuntimeExports.jsxs("div",{className:"contact-column",children:[jsxRuntimeExports.jsxs("span",{className:"customer-phone",style:{fontSize:"12px"},children:[jsxRuntimeExports.jsx(RefIcon$1,{className:"contact-icon"}),e.phone?(L=e.phone,!L||L.length<7?L:L.substring(0,4)+"****"+L.substring(L.length-3)):"无电话"]}),C&&jsxRuntimeExports.jsxs("span",{className:"customer-wechat",style:{fontSize:"12px"},children:[jsxRuntimeExports.jsx(RefIcon$2,{className:"contact-icon"}),(B=C,!B||B.length<4?B:B.substring(0,2)+"****"+B.substring(B.length-2))]})]})}),e.userrating&&jsxRuntimeExports.jsx("div",{className:"rating-info",children:jsxRuntimeExports.jsx(Rate$1,{disabled:!0,value:(e=>{switch(e){case"A":return 3;case"B+":return 2;case"B":return 1;default:return 0}})(e.userrating),count:3,style:{color:"#faad14",fontSize:"14px"},className:"compact-rating"})})]})]})}),jsxRuntimeExports.jsx("div",{className:"card-content "+(k?"":"empty-content"),children:jsxRuntimeExports.jsxs("div",{className:"info-columns",children:[j&&"未设置"!==j&&jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$7,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value",children:j})]}),R&&"未设置"!==R&&jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$3,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value",children:R})]}),b&&"未设置"!==b&&jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$4,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value",children:(()=>{try{const e=new Date(b);return isNaN(e.getTime())?null:e.toLocaleDateString()}catch{return null}})()})]}),w&&"未设置"!==w&&jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$4,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value",children:(()=>{try{const e=new Date(w);return isNaN(e.getTime())?null:e.toLocaleDateString()}catch{return null}})()})]}),_&&"未设置"!==_&&jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$1b,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value",children:_})]}),S&&jsxRuntimeExports.jsxs("div",{className:"info-row remark-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:jsxRuntimeExports.jsx(RefIcon$v,{className:"info-icon"})}),jsxRuntimeExports.jsx("span",{className:"info-value remark-value",children:S})]})]})}),jsxRuntimeExports.jsx(CardContextMenu,{visible:o,x:l.x,y:l.y,record:e,onClose:F,onRollback:M})]}),jsxRuntimeExports.jsx(SwipeMenu,{visible:m,closing:x,onRollback:D,onClose:O})]});var B,L,z},(e,t)=>e.record.id===t.record.id&&e.record.customername===t.record.customername&&e.record.phone===t.record.phone&&e.record.followupstage===t.record.followupstage&&e.record.majorcategory===t.record.majorcategory&&e.record.followupresult===t.record.followupresult);CustomerCard.displayName="CustomerCard";const useInfiniteScroll=({onLoadMore:e,hasMore:t,loading:r,rootMargin:s="0px"})=>{const[n,i]=reactExports.useState(!1),o=reactExports.useRef(null),a=reactExports.useRef(null),l=reactExports.useCallback(()=>"undefined"==typeof IntersectionObserver?null:new IntersectionObserver(s=>{const[n]=s;i(n.isIntersecting),n.isIntersecting&&t&&!r&&e()},{root:null,rootMargin:s,threshold:.1}),[e,s]);reactExports.useEffect(()=>(a.current&&(o.current=l(),o.current&&o.current.observe(a.current)),()=>{o.current&&o.current.disconnect()}),[l]);const c=reactExports.useCallback(()=>{t&&!r&&e()},[e,t,r]);return{sentinelRef:a,isIntersecting:n,triggerLoadMore:c}},MobileFollowups=()=>{var e,t,r,s;const{profile:n}=useUser();reactExports.useEffect(()=>{(async()=>{if(null==n?void 0:n.id){const e=getServiceManager();await e.initialize(Number(n.id)),e.setUserId(Number(n.id))}})()},[n]),reactExports.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await supabase.from("Selection").select("selection").eq("id",3).single();!t&&e&&e.selection&&F(e.selection.map(e=>({value:e.value,label:e.label})))}catch(e){console.error("获取回退理由选项失败:",e)}})()},[]);const i=useFollowupsData(),o=useFilterManager(),a=useEnumData(),l=useFrequencyControl();reactExports.useEffect(()=>{if(a.majorCategoryOptions&&a.majorCategoryOptions.length>0){const e=a.majorCategoryOptions.map(e=>e.value),t=[];a.majorCategoryOptions.forEach(e=>{e.children?e.children.forEach(e=>{t.push(e.value)}):t.push(e.value)});const r=[...new Set(t)];console.log("🔍 [MobileFollowups] 默认一级分类全部选中:",{allPrimaryCategories:e,allMappedSubcategories:t,uniqueSubcategories:r,totalCount:r.length}),b(t=>({...t,majorcategory:r,majorcategory_primary:e}))}},[a.majorCategoryOptions]),reactExports.useEffect(()=>{if((null==i?void 0:i.data)&&i.data.length>0){console.log("📊 [MobileFollowups] 数据加载完成，开始分析数据分布");const e=i.data.reduce((e,t)=>{const r=t.followupstage||"未知阶段";return e[r]=(e[r]||0)+1,e},{}),t=i.data.reduce((e,t)=>{const r=t.source||"未知来源";return e[r]=(e[r]||0)+1,e},{}),r=i.data.reduce((e,t)=>{const r=t.customerprofile||"未知画像";return e[r]=(e[r]||0)+1,e},{});console.log("📊 [MobileFollowups] 数据分布分析结果:",{totalRecords:i.data.length,stageDistribution:e,sourceDistribution:t,profileDistribution:r,pagination:i.pagination,hasMore:i.hasMore,loading:i.loading,loadingMore:i.loadingMore,timestamp:toBeijingDateTimeStr(new Date)})}},[null==i?void 0:i.data,null==i?void 0:i.forceUpdate,null==i?void 0:i.pagination,null==i?void 0:i.hasMore,null==i?void 0:i.loading,null==i?void 0:i.loadingMore]);const c=reactExports.useMemo(()=>({maxSizeMB:.5,maxWidthOrHeight:1280,useWebWorker:!0}),[]),u=reactExports.useCallback(async()=>{var e,t,r,s,n,o,a,l,c,u,d,p,m;if(console.log("📄 [MobileFollowups] 触发加载更多，当前状态:",{hasMore:null==i?void 0:i.hasMore,loadingMore:null==i?void 0:i.loadingMore,currentDataLength:(null==(e=null==i?void 0:i.data)?void 0:e.length)||0,currentPage:(null==(t=null==i?void 0:i.pagination)?void 0:t.current)||1,total:(null==(r=null==i?void 0:i.pagination)?void 0:r.total)||0,pageSize:(null==(s=null==i?void 0:i.pagination)?void 0:s.pageSize)||20}),0===(null==(n=null==i?void 0:i.data)?void 0:n.length)&&(null==(o=null==i?void 0:i.pagination)?void 0:o.total)>0)return void console.warn("⚠️ [MobileFollowups] 检测到数据状态异常，跳过加载更多");if((null==(a=null==i?void 0:i.data)?void 0:a.length)>0&&0===(null==(l=null==i?void 0:i.pagination)?void 0:l.total))return console.error("❌ [MobileFollowups] 检测到数据不一致：有数据但总数为0，停止加载更多"),void console.error("❌ [MobileFollowups] 数据不一致详情:",{currentDataLength:(null==(c=null==i?void 0:i.data)?void 0:c.length)||0,total:(null==(u=null==i?void 0:i.pagination)?void 0:u.total)||0,hasMore:null==i?void 0:i.hasMore,loadingMore:null==i?void 0:i.loadingMore});const h=(null==(d=null==i?void 0:i.pagination)?void 0:d.current)||1,x=(null==(p=null==i?void 0:i.pagination)?void 0:p.total)||0,f=(null==(m=null==i?void 0:i.pagination)?void 0:m.pageSize)||20,g=Math.ceil(x/f);if(h>=g&&x>0)console.warn("⚠️ [MobileFollowups] 已达到最大页数，停止加载更多:",{currentPage:h,maxPage:g,total:x,pageSize:f});else if((null==i?void 0:i.hasMore)&&!(null==i?void 0:i.loadingMore))try{console.log("🔄 [MobileFollowups] 开始加载更多数据，当前页:",h);const e=toBeijingTime(new Date).valueOf();await i.loadMore();const t=toBeijingTime(new Date).valueOf();console.log("✅ [MobileFollowups] 加载更多完成，耗时:",t-e,"ms")}catch(y){console.error("⚠️ [MobileFollowups] 加载更多失败:",y),staticMethods.error("加载更多失败，请重试")}else console.log("📄 [MobileFollowups] 跳过加载更多:",{hasMore:null==i?void 0:i.hasMore,loadingMore:null==i?void 0:i.loadingMore})},[null==i?void 0:i.hasMore,null==i?void 0:i.loadingMore,null==i?void 0:i.loadMore,null==(e=null==i?void 0:i.data)?void 0:e.length,null==(t=null==i?void 0:i.pagination)?void 0:t.total,null==(r=null==i?void 0:i.pagination)?void 0:r.current,null==(s=null==i?void 0:i.pagination)?void 0:s.pageSize]),d=reactExports.useCallback(e=>{if(!e||0===e.length)return{leftColumn:[],rightColumn:[]};const t=[],r=[];return e.forEach(e=>{t.length<=r.length?t.push(e):r.push(e)}),{leftColumn:t,rightColumn:r}},[]),{sentinelRef:p}=useInfiniteScroll({onLoadMore:u,hasMore:(null==i?void 0:i.hasMore)||!1,loading:(null==i?void 0:i.loadingMore)||!1,rootMargin:"200px"}),[m,h]=reactExports.useState(!1),[x,f]=reactExports.useState(null),[g,y]=reactExports.useState(!1),[v,E]=reactExports.useState(""),[j,b]=reactExports.useState({followupstage:[],customerprofile:[],interviewsales_user_id:"",userbudget_min:"",userbudget_max:"",moveintime_start:"",moveintime_end:"",userrating:[],majorcategory:[],scheduledcommunity:[],showingsales_user:"",source:[],created_at_start:"",created_at_end:"",worklocation:[],majorcategory_primary:[]}),[w,R]=reactExports.useState(!1),[_,S]=reactExports.useState(null),[C,k]=reactExports.useState(),[$,T]=reactExports.useState([]),[I,P]=reactExports.useState(!1),[A,F]=reactExports.useState([]),[M,D]=reactExports.useState(!1),[O,N]=reactExports.useState(!1),[B,L]=reactExports.useState(null),[z,V]=reactExports.useState(null),[U,H]=reactExports.useState(!1),[W,q]=reactExports.useState(!1),G=reactExports.useCallback(async e=>{var t,r,s;try{console.log("🔍 [MobileFollowups] 开始关键词搜索:",{value:e,trimmed:e.trim()}),null==(t=null==o?void 0:o.setKeywordSearch)||t.call(o,e);const a=(null==(r=null==o?void 0:o.getCurrentFiltersFn)?void 0:r.call(o))||{},l=e.trim()?{...a,p_keyword:e.trim()}:{...a};e.trim()?console.log("🔍 [MobileFollowups] 添加关键词搜索:",e.trim()):(delete l.p_keyword,console.log("🔍 [MobileFollowups] 清除关键词搜索")),console.log("🔍 [MobileFollowups] 关键词搜索筛选条件:",{currentFilters:Object.keys(a),filtersWithKeyword:Object.keys(l),keyword:e.trim()||"无"});("p_followupstage"in a||"p_followupstage"in l)&&console.log("🎯 [MobileFollowups] 关键词搜索影响线索阶段筛选");try{console.log("🔄 [MobileFollowups] 开始关键词搜索数据刷新");const e=toBeijingTime(new Date).valueOf();await(null==(s=null==i?void 0:i.refreshData)?void 0:s.call(i,l));const t=toBeijingTime(new Date).valueOf();console.log("✅ [MobileFollowups] 关键词搜索数据刷新完成，耗时:",t-e,"ms")}catch(n){console.error("⚠️ [MobileFollowups] 关键词搜索刷新数据失败:",n)}}catch(n){console.error("⚠️ [MobileFollowups] 关键词搜索错误:",n),staticMethods.error("搜索失败，请重试")}},[o,i]),Y=reactExports.useCallback(e=>{var t;null==(t=null==o?void 0:o.setKeywordSearch)||t.call(o,e)},[o]),K=reactExports.useCallback(async()=>{var e,t,r;try{null==(e=null==o?void 0:o.setKeywordSearch)||e.call(o,"");const n=(null==(t=null==o?void 0:o.getCurrentFiltersFn)?void 0:t.call(o))||{},a={...n};delete a.p_keyword;try{await(null==(r=null==i?void 0:i.refreshData)?void 0:r.call(i,a))}catch(s){console.error("⚠️ [MobileFollowups] 清除关键词刷新数据失败:",s)}staticMethods.success("搜索已清除")}catch(s){console.error("⚠️ [MobileFollowups] 关键词清除错误:",s),staticMethods.error("清除搜索失败，请重试")}},[o,i]),X=reactExports.useCallback(async(e,t)=>{var r,s,n,a,l,c,u,d,p;try{console.log("⭐ [MobileFollowups] 开始快速筛选:",{rating:e,moveInFilter:t});let h={};if(null!==e){let t;switch(e){case 3:t="A";break;case 2:t="B+";break;case 1:t="B";break;default:t="C"}h.p_userrating=[t],console.log("⭐ [MobileFollowups] 来访意向筛选:",{rating:e,ratingString:t})}if(null!==t){const e=getCurrentBeijingTime().toDate(),i=e.getFullYear(),o=e.getMonth()+1;if("current"===t){const e=new Date(i,o-1,1),t=new Date(i,o,0);h.p_moveintime_start=[toBeijingDateStr(e)],h.p_moveintime_end=[toBeijingDateStr(t)],console.log("⭐ [MobileFollowups] 本月入住筛选:",{startDate:toBeijingDateStr(e),endDate:toBeijingDateStr(t)})}else if("next"===t){const e=new Date(i,o,1),t=new Date(i,o+1,0);h.p_moveintime_start=[toBeijingDateStr(e)],h.p_moveintime_end=[toBeijingDateStr(t)],console.log("⭐ [MobileFollowups] 下月入住筛选:",{startDate:toBeijingDateStr(e),endDate:toBeijingDateStr(t)})}null!==t&&(h.p_moveintime_not_null=[!0],console.log("⭐ [MobileFollowups] 快速筛选中添加入住时间非空条件:",h.p_moveintime_not_null),console.log("⭐ [MobileFollowups] 快速筛选完整参数详情:",{moveInFilter:t,startDate:null==(r=h.p_moveintime_start)?void 0:r[0],endDate:null==(s=h.p_moveintime_end)?void 0:s[0],notNull:null==(n=h.p_moveintime_not_null)?void 0:n[0],allParams:h}))}console.log("⭐ [MobileFollowups] 快速筛选RPC参数:",h),null==(a=null==o?void 0:o.setFilters)||a.call(o,h);try{console.log("🔄 [MobileFollowups] 开始快速筛选数据刷新");const e=toBeijingTime(new Date).valueOf();await(null==(l=null==i?void 0:i.refreshData)?void 0:l.call(i,h));const t=toBeijingTime(new Date).valueOf();console.log("✅ [MobileFollowups] 快速筛选数据刷新完成，耗时:",t-e,"ms"),console.log("🔍 [MobileFollowups] 快速筛选数据刷新后立即检查:",{dataLength:(null==(c=null==i?void 0:i.data)?void 0:c.length)||0,total:(null==(u=null==i?void 0:i.pagination)?void 0:u.total)||0,currentPage:(null==(d=null==i?void 0:i.pagination)?void 0:d.current)||1,pageSize:(null==(p=null==i?void 0:i.pagination)?void 0:p.pageSize)||20,hasMore:null==i?void 0:i.hasMore,loading:null==i?void 0:i.loading,loadingMore:null==i?void 0:i.loadingMore,appliedFilters:h})}catch(m){console.error("⚠️ [MobileFollowups] 快速筛选刷新数据失败:",m)}let x="";null!==e&&(x+=`已筛选${3===e?"高":2===e?"中":"低"}意向客户`),null!==t&&(x&&(x+="，"),x+="入住时间："+("current"===t?"本月":"下月")),null!==e||null!==t?staticMethods.success(x):staticMethods.success("已取消快速筛选")}catch(m){console.error("⚠️ [MobileFollowups] 快速筛选错误:",m),staticMethods.error("快速筛选失败，请重试")}},[o,i]);reactExports.useEffect(()=>{var e,t,r,s,n,a;if((null==i?void 0:i.data)&&i.data.length>0){if((null==(t=null==(e=null==o?void 0:o.getCurrentFiltersFn)?void 0:e.call(o))?void 0:t.p_moveintime_start)||(null==(s=null==(r=null==o?void 0:o.getCurrentFiltersFn)?void 0:r.call(o))?void 0:s.p_moveintime_end)){console.log("🔍 [MobileFollowups] 检测到入住时间筛选条件，检查数据状态");const e=i.data.reduce((e,t)=>{const r=t.moveintime&&""!==t.moveintime,s=t.moveintime||"NULL/EMPTY",n=t.leadid||t.id||"UNKNOWN";return e.hasMoveintime||(e.hasMoveintime=[]),e.noMoveintime||(e.noMoveintime=[]),r?e.hasMoveintime.push({id:n,moveintime:s}):e.noMoveintime.push({id:n,moveintime:s}),e},{});console.log("🔍 [MobileFollowups] 入住时间筛选后数据状态检查:",{totalRecords:i.data.length,hasMoveintime:(null==(n=e.hasMoveintime)?void 0:n.length)||0,noMoveintime:(null==(a=e.noMoveintime)?void 0:a.length)||0,hasMoveintimeRecords:e.hasMoveintime||[],noMoveintimeRecords:e.noMoveintime||[]});const t=i.data.filter(e=>{const t=e.leadid||e.id||"UNKNOWN";return"25Y00042"===t||"25Y00041"===t});t.length>0&&console.log("⚠️ [MobileFollowups] 入住时间筛选后发现异常记录:",t.map(e=>({id:e.leadid||e.id,moveintime:e.moveintime||"NULL/EMPTY",moveintimeType:typeof e.moveintime,moveintimeLength:e.moveintime?e.moveintime.length:"N/A"})))}}},[null==i?void 0:i.data,o]);const J=reactExports.useCallback(async e=>{var t,r,s,n,a,l,c,u,d,p,m,h,x,f,g,v,E,j;try{console.log("🔍 [MobileFollowups] 开始处理筛选条件变更:",e);const w={};Object.entries(e).forEach(([e,t])=>{if(null!=t&&""!==t){if("userbudget_min"===e||"userbudget_max"===e){const r=`p_${e}`;return w[r]=Number(t),void console.log(`🔍 [MobileFollowups] 预算参数转换: ${e} = ${t} -> ${r} = ${Number(t)}`)}if("worklocation"===e){const r=`p_${e}`;if(Array.isArray(t)){const s=t.filter(e=>e&&""!==e.trim());w[r]=s,console.log(`🔍 [MobileFollowups] 工作地点参数转换: ${e} = ${t} -> ${r} = ${s}`)}else w[r]=[t],console.log(`🔍 [MobileFollowups] 工作地点参数转换: ${e} = ${t} -> ${r} = [${t}]`);return}w[`p_${e}`]=Array.isArray(t)?t:[t]}}),console.log("🔍 [MobileFollowups] 转换后的RPC筛选参数:",w),console.log("🔍 [MobileFollowups] 筛选条件统计:",{totalFilters:Object.keys(e).length,appliedFilters:Object.keys(w).length,filterDetails:Object.entries(w).map(([e,t])=>({key:e,value:t,type:Array.isArray(t)?"array":typeof t,count:Array.isArray(t)?t.length:1}))}),w.p_worklocation&&console.log("🎯 [MobileFollowups] 工作地点筛选条件详情:",{worklocation:w.p_worklocation,worklocationType:typeof w.p_worklocation,worklocationLength:Array.isArray(w.p_worklocation)?w.p_worklocation.length:"N/A",worklocationValues:w.p_worklocation}),(w.p_created_at_start||w.p_created_at_end)&&(console.log("🔍 [MobileFollowups] 创建时间筛选条件详情:",{start:w.p_created_at_start,end:w.p_created_at_end,startType:typeof(null==(t=w.p_created_at_start)?void 0:t[0]),endType:typeof(null==(r=w.p_created_at_start)?void 0:r[0]),startValue:null==(s=w.p_created_at_start)?void 0:s[0],endValue:null==(n=w.p_created_at_end)?void 0:n[0],startArrayLength:null==(a=w.p_created_at_start)?void 0:a.length,endArrayLength:null==(l=w.p_created_at_end)?void 0:l.length}),w.p_created_at_not_null=[!0],console.log("🔍 [MobileFollowups] 添加创建时间非空筛选条件:",w.p_created_at_not_null)),(w.p_moveintime_start||w.p_moveintime_end)&&(console.log("🔍 [MobileFollowups] 入住时间筛选条件详情:",{start:w.p_moveintime_start,end:w.p_moveintime_end,startType:typeof(null==(c=w.p_moveintime_start)?void 0:c[0]),endType:typeof(null==(u=w.p_moveintime_end)?void 0:u[0]),startValue:null==(d=w.p_moveintime_start)?void 0:d[0],endValue:null==(p=w.p_moveintime_end)?void 0:p[0],startArrayLength:null==(m=w.p_moveintime_start)?void 0:m.length,endArrayLength:null==(h=w.p_moveintime_end)?void 0:h.length}),w.p_moveintime_not_null=[!0],console.log("🔍 [MobileFollowups] 添加入住时间非空筛选条件:",w.p_moveintime_not_null),console.log("🔍 [MobileFollowups] 手动筛选完整参数详情:",{startDate:null==(x=w.p_moveintime_start)?void 0:x[0],endDate:null==(f=w.p_moveintime_end)?void 0:f[0],notNull:null==(g=w.p_moveintime_not_null)?void 0:g[0],allParams:w}));const R=(null==(v=null==o?void 0:o.getCurrentFiltersFn)?void 0:v.call(o))||{},_=JSON.stringify(R.p_followupstage)!==JSON.stringify(w.p_followupstage);_&&console.log("🎯 [MobileFollowups] 线索阶段筛选条件变化:",{oldStageFilter:R.p_followupstage,newStageFilter:w.p_followupstage,stageFilterChanged:_}),null==(E=null==o?void 0:o.setFilters)||E.call(o,w);try{0,await(null==(j=null==i?void 0:i.refreshData)?void 0:j.call(i,w))}catch(b){console.error("⚠️ [MobileFollowups] 筛选条件变更刷新数据失败:",b)}y(!1),staticMethods.success("筛选条件已应用")}catch(b){console.error("⚠️ [MobileFollowups] 筛选条件变更错误:",b),staticMethods.error("筛选失败，请重试")}},[o,i]),Z=reactExports.useCallback(e=>{f(e),h(!0)},[]),Q=reactExports.useCallback(async(e,t)=>{var r;try{if(t._autoSaveOnClose){const{_autoSaveOnClose:s,...n}=t;null==(r=null==i?void 0:i.data)||r.find(t=>t.id===e.id);Object.entries(n).forEach(([t,r])=>{var s;null!=r&&t in e&&(null==(s=null==i?void 0:i.updateLocalData)||s.call(i,e.id,t,r))}),setTimeout(()=>{},200),staticMethods.success("数据已自动保存")}else t._manualSave?staticMethods.success("保存成功"):t._stageChange?staticMethods.success("阶段推进成功"):staticMethods.success("保存成功")}catch(s){staticMethods.error("保存失败，请重试"),console.error("保存失败:",s)}},[i]),ee=reactExports.useCallback(e=>{S(e),R(!0)},[]),te=reactExports.useCallback(()=>{h(!1),f(null)},[]),re=reactExports.useCallback(async e=>(T(t=>[...t,{file:e,preview:URL.createObjectURL(e),name:e.name}]),!1),[]),se=reactExports.useCallback(e=>{e.forEach(e=>{e.preview&&e.preview.startsWith("blob:")&&URL.revokeObjectURL(e.preview)})},[]),ne=reactExports.useCallback(e=>{T(t=>{const r=t.find(t=>t.name===e.name);return(null==r?void 0:r.preview)&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview),t.filter(t=>t.name!==e.name)})},[]),ie=reactExports.useCallback(async()=>{var e;if(C)if(0!==$.length){P(!0);try{const{data:t,error:r}=await supabase.from("approval_instances").select("id, status").eq("type","lead_rollback").eq("target_id",null==_?void 0:_.leadid).in("status",["pending","processing"]);if(r)return P(!1),void staticMethods.error("回退检查失败，请重试");if(t&&t.length>0)return P(!1),void staticMethods.error("该线索已提交回退申请，请勿重复提交");const s=[];for(const e of $){if(e.url){s.push(e.url);continue}const t=await imageCompression(e.file,c),r=t.name.split(".").pop(),n=`rollback/${`rollback-${toBeijingTime(new Date).valueOf()}-${Math.floor(1e4*Math.random())}.${r}`}`,{error:i}=await supabase.storage.from("rollback").upload(n,t);if(i)throw i;const{data:o}=supabase.storage.from("rollback").getPublicUrl(n);s.push(o.publicUrl)}const{data:o,error:a}=await supabase.from("approval_flows").select("id").eq("type","lead_rollback").maybeSingle();if(a||!o)return staticMethods.error("未找到回退审批流模板，请联系管理员配置"),void P(!1);const{error:l}=await supabase.from("approval_instances").insert({flow_id:o.id,type:"lead_rollback",target_table:"leads",target_id:null==_?void 0:_.leadid,status:"pending",created_by:null==n?void 0:n.id,config:{reason:C,evidence:s,leadid:null==_?void 0:_.leadid}});if(l)throw l;staticMethods.success("回退申请已提交，等待审批"),R(!1),se($),S(null),k(void 0),T([]),null==(e=null==i?void 0:i.refreshData)||e.call(i)}catch(e2){staticMethods.error("回退提交失败: "+(e2.message||e2.toString()))}P(!1)}else staticMethods.error("请上传回退证据");else staticMethods.error("请选择回退理由")},[C,$,_,n,se,i,c]),oe=reactExports.useCallback(()=>{R(!1),se($),S(null),k(void 0),T([]),P(!1)},[$,se]),ae=reactExports.useMemo(()=>$.map((e,t)=>({uid:t+"",name:e.name,status:"done",url:e.url||e.preview,thumbUrl:e.preview})),[$]),le=reactExports.useMemo(()=>$.length>=5||I,[$.length,I]),ce=reactExports.useMemo(()=>$.length<5&&!I,[$.length,I]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col p-0 m-0",children:[jsxRuntimeExports.jsx(MobileHeader,{keywordSearch:null==o?void 0:o.keywordSearch,onKeywordChange:Y,onKeywordSearch:G,onKeywordClear:K,onFilterClick:()=>y(!0),onQuickFilter:X}),jsxRuntimeExports.jsx(Card,{className:"flex-1 flex flex-col p-0 m-0 border-0",style:{padding:0,background:"transparent"},children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-row w-full gap-4 items-start justify-center",children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col w-[calc(50%-8px)]",id:"column-1",children:d((null==i?void 0:i.data)||[]).leftColumn.map(e=>jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx(CustomerCard,{record:e,onEdit:Z,onRollback:ee})},`${e.id}-${(null==i?void 0:i.forceUpdate)||0}`))}),jsxRuntimeExports.jsx("div",{className:"flex flex-col w-[calc(50%-8px)]",id:"column-2",children:d((null==i?void 0:i.data)||[]).rightColumn.map(e=>jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx(CustomerCard,{record:e,onEdit:Z,onRollback:ee})},`${e.id}-${(null==i?void 0:i.forceUpdate)||0}`))})]}),(null==i?void 0:i.data)&&i.data.length>0&&jsxRuntimeExports.jsx("div",{className:"hidden"}),(!(null==i?void 0:i.data)||0===i.data.length)&&!(null==i?void 0:i.loading)&&jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center h-50 text-center text-gray-500 text-sm p-0 m-0",children:jsxRuntimeExports.jsx("p",{className:"p-0 m-0",children:"暂无跟进记录"})}),(null==i?void 0:i.data)&&i.data.length>0&&jsxRuntimeExports.jsx("div",{ref:p,className:"w-full h-5 opacity-0 pointer-events-none"}),(null==i?void 0:i.loadingMore)&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center p-0 m-0 text-gray-500 text-sm bg-gray-50 rounded-lg shadow-sm w-full text-center",children:[jsxRuntimeExports.jsx(Spin,{size:"small"}),jsxRuntimeExports.jsx("span",{className:"p-0 m-0",children:"加载更多..."})]}),(null==i?void 0:i.data)&&i.data.length>0&&!(null==i?void 0:i.hasMore)&&!(null==i?void 0:i.loadingMore)&&jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center h-50 text-center text-gray-500 text-sm p-0 m-0",children:jsxRuntimeExports.jsx("p",{className:"p-0 m-0",children:"— 已显示全部记录 —"})})]})}),jsxRuntimeExports.jsx(Popup,{visible:g,onMaskClick:()=>y(!1),position:"right",bodyStyle:{width:"80vw",height:"100vh"},children:jsxRuntimeExports.jsxs("div",{className:"p-4 h-full flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-medium",children:"筛选条件"}),jsxRuntimeExports.jsx(Button,{fill:"none",size:"small",onClick:()=>y(!1),children:"关闭"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:jsxRuntimeExports.jsxs(Form,{layout:"vertical",children:[jsxRuntimeExports.jsx(Form.Item,{label:"跟进阶段",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(ue=a.followupstageEnum)?void 0:ue.map((e,t)=>({label:e.label,value:e.value,key:`followupstage-${e.value}-${t}`})))||[],onChange:e=>b(t=>({...t,followupstage:e}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"约访管家",children:jsxRuntimeExports.jsx(Input,{placeholder:"输入管家姓名",clearable:!0,onChange:e=>b(t=>({...t,interviewsales_user_id:e||""}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"用户画像",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(de=a.customerprofileEnum)?void 0:de.map((e,t)=>({label:e.label,value:e.value,key:`customerprofile-${e.value}-${t}`})))||[],onChange:e=>b(t=>({...t,customerprofile:e}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"工作地点",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(pe=a.metroStationOptions)?void 0:pe.map((e,t)=>({label:e.label,value:e.value,key:`metroStation-${e.value}-${t}`})))||[],onChange:e=>{console.log("🔍 [MobileFollowups] 工作地点筛选选择变化:",{value:e,selectedValues:e});const t=e||[],r=[];t.forEach(e=>{var t;const s=null==(t=a.metroStationOptions)?void 0:t.find(t=>t.value===e);if(s&&s.children){const t=s.children.map(e=>e.value);r.push(...t),console.log(`🔍 [MobileFollowups] 线路 ${e} 下的站点:`,t)}else{const t=e;r.push(t),console.log("🔍 [MobileFollowups] 单独站点值:",t)}});const s=[...new Set(r)];console.log("🔍 [MobileFollowups] 最终工作地点筛选值:",{selectedLines:t,allStationValues:r,uniqueStationValues:s}),console.log("🔍 [MobileFollowups] 工作地点筛选详情:",{originalSelection:e,processedStations:s,stationCount:s.length,timestamp:(new Date).toISOString()}),b(e=>({...e,worklocation:s})),E(t.join(","))}})}),jsxRuntimeExports.jsx(Form.Item,{label:"用户预算范围",children:jsxRuntimeExports.jsxs("div",{className:"flex w-full items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx(Input,{placeholder:"最小预算",type:"number",onChange:e=>b(t=>({...t,userbudget_min:e||""}))})}),jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 px-2",children:jsxRuntimeExports.jsx("span",{className:"text-gray-400",children:"至"})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx(Input,{placeholder:"最大预算",type:"number",onChange:e=>b(t=>({...t,userbudget_max:e||""}))})})]})}),jsxRuntimeExports.jsxs(Form.Item,{label:"入住时间",children:[jsxRuntimeExports.jsxs("div",{className:"flex w-full items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("div",{onClick:()=>{console.log("点击入住时间开始时间容器"),D(!0)},style:{cursor:"pointer"},children:jsxRuntimeExports.jsx(Input,{placeholder:"开始时间",value:B?dayjs(B[0]).format("YYYY-MM-DD"):"",type:"text",readOnly:!0,style:{"--adm-font-size-main":"14px","--adm-color-text":B?"#333333":"#999999"}})})}),jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 px-2",children:jsxRuntimeExports.jsx("span",{className:B?"text-gray-600":"text-gray-400",children:"至"})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("div",{onClick:()=>{console.log("点击入住时间结束时间容器"),D(!0)},style:{cursor:"pointer"},children:jsxRuntimeExports.jsx(Input,{placeholder:"结束时间",value:B?dayjs(B[1]).format("YYYY-MM-DD"):"",type:"text",readOnly:!0,style:{"--adm-font-size-main":"14px","--adm-color-text":B?"#333333":"#999999"}})})})]}),jsxRuntimeExports.jsx(CalendarPicker,{visible:M,selectionMode:"range",value:B,min:toBeijingTime(new Date("2020-01-01")).toDate(),max:toBeijingTime(new Date("2030-12-31")).toDate(),onClose:()=>{D(!1)},onMaskClick:()=>{D(!1)},onConfirm:e=>{if(console.log("用户通过内置确认按钮确认入住时间范围:",e),e&&Array.isArray(e)&&2===e.length){const t=getDayStart(e[0]).toISOString(),r=getDayEnd(e[1]).toISOString();console.log("入住时间范围（北京时间）:",{startDate:t,endDate:r});const s=dayjs(e[0]),n=dayjs(e[1]),i=getDayStart(e[0]),o=getDayEnd(e[1]);console.log("入住时间时区转换详情:",{originalStart:s.format("YYYY-MM-DD HH:mm:ss"),originalEnd:n.format("YYYY-MM-DD HH:mm:ss"),beijingStart:i.format("YYYY-MM-DD HH:mm:ss"),beijingEnd:o.format("YYYY-MM-DD HH:mm:ss"),startDate:t,endDate:r,startISO:i.toISOString(),endISO:o.toISOString()}),b(e=>({...e,moveintime_start:t,moveintime_end:r})),D(!1),H(!1)}},onChange:e=>{if(console.log("入住时间选择器值变化:",e),e&&Array.isArray(e)&&2===e.length){const[t,r]=e,s=dayjs(t).isSame(r,"day");s&&!U?(console.log("第一次选择日期，等待选择第二个日期"),H(!0),L([t,t])):s&&U?(console.log("用户确认单日选择"),L(e)):s||(console.log("完成范围选择"),L(e))}}})]}),jsxRuntimeExports.jsx(Form.Item,{label:"来访意向",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(me=a.userratingEnum)?void 0:me.map((e,t)=>({label:e.label,value:e.value,key:`userrating-${e.value}-${t}`})))||[],onChange:e=>b(t=>({...t,userrating:e}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"跟进结果",children:jsxRuntimeExports.jsx("div",{className:"space-y-3",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"选择一级分类"}),jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(he=a.majorCategoryOptions)?void 0:he.map((e,t)=>({label:e.label,value:e.value,key:`majorCategory-${e.value}-${t}`})))||[],value:j.majorcategory_primary||[],onChange:e=>{if(console.log("🔍 [MobileFollowups] 一级分类选择变化:",e),e&&e.length>0){const t=e,r=[];t.forEach(e=>{var t;const s=null==(t=a.majorCategoryOptions)?void 0:t.find(t=>t.value===e);if(s&&s.children){const t=s.children.map(e=>e.value);r.push(...t),console.log("🔍 [MobileFollowups] 一级分类自动映射:",{selectedCategory:e,mappedSubcategories:t,count:t.length})}else r.push(e)});const s=[...new Set(r)];console.log("🔍 [MobileFollowups] 所有一级分类映射结果:",{selectedCategories:t,allMappedSubcategories:r,uniqueSubcategories:s,totalCount:s.length}),b(e=>({...e,majorcategory:s,majorcategory_primary:t}))}else b(e=>({...e,majorcategory:[],majorcategory_primary:[]}))}}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"选择一级分类将自动包含该分类下的所有二级分类"})]})})}),jsxRuntimeExports.jsx(Form.Item,{label:"预约社区",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(xe=a.communityEnum)?void 0:xe.map((e,t)=>({label:e.label,value:e.value,key:`scheduledcommunity-${e.value}-${t}`})))||[],onChange:e=>b(t=>({...t,scheduledcommunity:e}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"带看管家",children:jsxRuntimeExports.jsx(Input,{placeholder:"输入带看管家姓名",clearable:!0,onChange:e=>b(t=>({...t,showingsales_user:e||""}))})}),jsxRuntimeExports.jsx(Form.Item,{label:"来源",children:jsxRuntimeExports.jsx(Selector,{multiple:!0,options:(null==(fe=a.sourceEnum)?void 0:fe.map((e,t)=>({label:e.label,value:e.value,key:`source-${e.value}-${t}`})))||[],onChange:e=>b(t=>({...t,source:e}))})}),jsxRuntimeExports.jsxs(Form.Item,{label:"创建时间",children:[jsxRuntimeExports.jsxs("div",{className:"flex w-full items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("div",{onClick:()=>{console.log("点击创建时间开始时间容器"),N(!0)},style:{cursor:"pointer"},children:jsxRuntimeExports.jsx(Input,{placeholder:"开始时间",value:z?dayjs(z[0]).format("YYYY-MM-DD"):"",type:"text",readOnly:!0,style:{"--adm-font-size-main":"14px","--adm-color-text":z?"#333333":"#999999"}})})}),jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 px-2",children:jsxRuntimeExports.jsx("span",{className:z?"text-gray-600":"text-gray-400",children:"至"})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("div",{onClick:()=>{console.log("点击创建时间结束时间容器"),N(!0)},style:{cursor:"pointer"},children:jsxRuntimeExports.jsx(Input,{placeholder:"结束时间",value:z?dayjs(z[1]).format("YYYY-MM-DD"):"",type:"text",readOnly:!0,style:{"--adm-font-size-main":"14px","--adm-color-text":z?"#333333":"#999999"}})})})]}),jsxRuntimeExports.jsx(CalendarPicker,{visible:O,selectionMode:"range",value:z,min:toBeijingTime(new Date("2020-01-01")).toDate(),max:toBeijingTime(new Date("2030-12-31")).toDate(),onClose:()=>{N(!1)},onMaskClick:()=>{N(!1)},onConfirm:e=>{if(console.log("用户通过内置确认按钮确认创建时间范围:",e),e&&Array.isArray(e)&&2===e.length){const t=getDayStart(e[0]).toISOString(),r=getDayEnd(e[1]).toISOString();console.log("创建时间范围（北京时间）:",{startDate:t,endDate:r});const s=dayjs(e[0]);dayjs(e[1]);const n=getDayStart(e[0]),i=getDayEnd(e[1]);console.log("创建时间时区转换详情:",{originalStart:s.format("YYYY-MM-DD HH:mm:ss"),beijingStart:n.format("YYYY-MM-DD HH:mm:ss"),beijingEnd:i.format("YYYY-MM-DD HH:mm:ss"),startDate:t,endDate:r,startISO:n.toISOString(),endISO:i.toISOString()}),b(e=>({...e,created_at_start:t,created_at_end:r})),N(!1),q(!1)}},onChange:e=>{if(console.log("创建时间选择器值变化:",e),e&&Array.isArray(e)&&2===e.length){const[t,r]=e,s=dayjs(t).isSame(r,"day");s&&!W?(console.log("创建时间：第一次选择日期，等待选择第二个日期"),q(!0),V([t,t])):s&&W?(console.log("创建时间：用户确认单日选择"),V(e)):s||(console.log("创建时间：完成范围选择"),V(e))}}})]})]})}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-gray-200",children:jsxRuntimeExports.jsxs(Space,{className:"w-full",children:[jsxRuntimeExports.jsx(Button,{block:!0,color:"default",onClick:async()=>{var e,t,r,s;console.log("🧹 [MobileFollowups] 开始清除所有筛选条件"),b({followupstage:[],customerprofile:[],interviewsales_user_id:"",userbudget_min:"",userbudget_max:"",moveintime_start:"",moveintime_end:"",userrating:[],majorcategory:[],scheduledcommunity:[],showingsales_user:"",source:[],created_at_start:"",created_at_end:"",worklocation:[],majorcategory_primary:[]}),E(""),null==(e=null==o?void 0:o.setFilters)||e.call(o,{}),null==(t=null==o?void 0:o.setKeywordSearch)||t.call(o,""),null==(r=null==o?void 0:o.setColumnFilters)||r.call(o,{}),L(null),V(null),H(!1),q(!1),console.log("🧹 [MobileFollowups] 已清空所有筛选状态:",{filterValues:"已清空",workLocation:"已清空",filterManager:"已清空",dateRanges:"已清空",timestamp:(new Date).toISOString()});try{console.log("🔄 [MobileFollowups] 开始清除筛选后的数据刷新");const e=toBeijingTime(new Date).valueOf();await(null==(s=null==i?void 0:i.refreshData)?void 0:s.call(i,{}));const t=toBeijingTime(new Date).valueOf();console.log("✅ [MobileFollowups] 清除筛选后数据刷新完成，耗时:",t-e,"ms"),setTimeout(()=>{var e,t,r,s;console.log("📊 [MobileFollowups] 清除筛选后数据状态检查:",{dataLength:(null==(e=null==i?void 0:i.data)?void 0:e.length)||0,total:(null==(t=null==i?void 0:i.pagination)?void 0:t.total)||0,currentPage:(null==(r=null==i?void 0:i.pagination)?void 0:r.current)||1,pageSize:(null==(s=null==i?void 0:i.pagination)?void 0:s.pageSize)||20,hasMore:null==i?void 0:i.hasMore,loading:null==i?void 0:i.loading,loadingMore:null==i?void 0:i.loadingMore})},100)}catch(n){console.error("⚠️ [MobileFollowups] 清除筛选后数据刷新失败:",n)}y(!1),staticMethods.success("已清除所有筛选条件"),console.log("🧹 [MobileFollowups] 所有筛选条件清除完成")},children:"清除全部"}),jsxRuntimeExports.jsx(Button,{block:!0,color:"primary",onClick:()=>{const e={};Object.entries(j).forEach(([t,r])=>{Array.isArray(r)?r.length>0&&(e[t]=r):""!==r&&null!=r&&(e[t]=r)}),Object.keys(e).length>0&&J(e),y(!1)},children:"确定"})]})})]})}),jsxRuntimeExports.jsx(MobileFollowupStageDrawer,{open:m,onClose:te,record:x,onSave:Q,isFieldDisabled:l.isFieldDisabled,forceUpdate:null==i?void 0:i.forceUpdate,communityEnum:a.communityEnum,followupstageEnum:a.followupstageEnum,customerprofileEnum:a.customerprofileEnum,userratingEnum:a.userratingEnum,majorCategoryOptions:a.majorCategoryOptions,metroStationOptions:a.metroStationOptions,disableAutoSave:!1}),jsxRuntimeExports.jsx(Modal$2,{open:w,title:"回退操作",onCancel:oe,destroyOnHidden:!0,centered:!0,width:340,footer:jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:12,padding:"0 4px"},children:[jsxRuntimeExports.jsx(Button$1,{size:"large",style:{flex:1,height:"44px",fontSize:"16px",borderRadius:"8px"},onClick:oe,children:"取消"}),jsxRuntimeExports.jsx(Button$1,{type:"primary",size:"large",style:{flex:1,height:"44px",fontSize:"16px",borderRadius:"8px"},loading:I,onClick:ie,children:"确认回退"})]}),children:jsxRuntimeExports.jsxs(Form,{layout:"vertical",children:[jsxRuntimeExports.jsx(Form.Item,{label:"回退理由",required:!0,children:jsxRuntimeExports.jsx(Select,{placeholder:"请选择回退理由",options:A,value:C,onChange:k,allowClear:!0})}),jsxRuntimeExports.jsx(Form.Item,{label:"回退证据（图片，最多5张）",required:!0,children:jsxRuntimeExports.jsx(Upload,{listType:"picture-card",fileList:ae,customRequest:()=>{},beforeUpload:re,onRemove:ne,showUploadList:{showRemoveIcon:!0},multiple:!0,accept:"image/*",disabled:le,children:ce&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(RefIcon$f,{}),jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:"上传"})]})})})]})})]});var ue,de,pe,me,he,xe,fe},MobileTabBar=()=>{const e=useNavigate(),t=useLocation(),{pathname:r}=t,s=[{key:"/dashboard",title:"首页",icon:jsxRuntimeExports.jsx(RefIcon$u,{className:"text-lg"})},{key:"/followups",title:"跟进",icon:jsxRuntimeExports.jsx(RefIcon$5,{className:"text-lg"})},{key:"/showings",title:"带看",icon:jsxRuntimeExports.jsx(RefIcon$6,{className:"text-lg"})},{key:"/deals",title:"成交",icon:jsxRuntimeExports.jsx(RefIcon$7,{className:"text-lg"})},{key:"/mobile-profile",title:"个人",icon:jsxRuntimeExports.jsx(RefIcon$5,{className:"text-lg"})}];return jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 shadow-lg",children:jsxRuntimeExports.jsx(TabBar,{activeKey:r,onChange:t=>(t=>{e(t)})(t),className:"bg-white",children:s.map(e=>jsxRuntimeExports.jsx(TabBar.Item,{icon:e.icon,title:e.title,className:"text-gray-600"},e.key))})})},MobileProfile=()=>{const e=useNavigate(),[t]=Form.useForm(),[r]=Form.useForm(),[s,n]=reactExports.useState(""),[i]=reactExports.useState(""),[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(Date.now()),[h,x]=reactExports.useState(!0),[f,g]=reactExports.useState(!1),[y,v]=reactExports.useState(!1),{user:E}=useUser(),{logout:j}=useAuth(),{userRoles:b,userPermissions:w,isSuperAdmin:R,isSystemAdmin:_,getPermissionsByCategory:S,getExpiringRoles:C}=useRolePermissions(),{avatarFrames:k,getEquippedAvatarFrame:$,equipAvatarFrame:T}=useAchievements(),I=$()||null,P=async()=>{if(x(!0),!E)return void x(!1);const{data:e}=await supabase.from("users_profile").select("avatar_url, updated_at").eq("user_id",E.id).single();a((null==e?void 0:e.avatar_url)||null),m((null==e?void 0:e.updated_at)?toBeijingTime(e.updated_at).valueOf():Date.now()),x(!1)};reactExports.useEffect(()=>{E&&P()},[E]),reactExports.useEffect(()=>{(null==E?void 0:E.email)&&n(E.email)},[E]),reactExports.useEffect(()=>{s&&r.setFieldsValue({email:s})},[s,r]);const A=C(7),F=S(),M=async e=>{try{await T(e??""),Toast.show(e?"头像框已装备":"已恢复默认头像框"),await P(),localStorage.setItem("avatar_refresh_token",Date.now().toString()),window.dispatchEvent(new Event("avatar_refresh_token"))}catch(e2){Toast.show("头像框装备失败")}};return h||!E?jsxRuntimeExports.jsx(LoadingScreen,{type:"profile"}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx(NavBar,{onBack:()=>e(-1),backArrow:jsxRuntimeExports.jsx(LeftOutline,{}),className:"bg-white border-b border-gray-200",children:"个人中心"}),jsxRuntimeExports.jsxs("div",{className:"px-4 pb-20",children:[jsxRuntimeExports.jsx(Card,{className:"mb-4 bg-white rounded-lg shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Avatar,{src:o?`${o}?t=${p}`:"",className:"w-16 h-16",onClick:()=>d(!0),fallback:jsxRuntimeExports.jsx(UserOutline,{})}),I&&jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -left-1 -right-1 -bottom-1 rounded-full border-2 border-blue-500 pointer-events-none"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold mb-1 text-gray-900",children:E.email||"用户"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-600",children:i||"部门信息"})]}),jsxRuntimeExports.jsx(Button,{size:"small",fill:"outline",onClick:()=>d(!0),className:"text-blue-600 border-blue-600",children:"更换头像"})]})}),jsxRuntimeExports.jsx(Card,{title:"我的头像框",className:"mb-4 bg-white rounded-lg shadow-sm",children:jsxRuntimeExports.jsxs(Grid,{columns:3,gap:8,children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl p-3 flex flex-col items-center cursor-pointer transition-all duration-200 "+(I?"bg-gray-100 border border-gray-300":"bg-gradient-to-br from-blue-500 to-purple-600 border-2 border-blue-500"),onClick:()=>M(null),children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-white flex items-center justify-center mb-2 text-base text-gray-500",children:"无"}),jsxRuntimeExports.jsx("div",{className:"text-center font-semibold text-xs "+(I?"text-gray-600":"text-white"),children:"默认"})]}),k.map(e=>jsxRuntimeExports.jsxs("div",{className:`rounded-xl p-3 flex flex-col items-center cursor-pointer transition-all duration-200 ${((e,t)=>{if(!t)return"bg-gray-100 border border-gray-300";switch(e){case"legendary":return"bg-gradient-to-br from-purple-500 to-indigo-600 border-2 border-purple-600";case"epic":return"bg-gradient-to-br from-pink-500 to-red-500 border-2 border-pink-600";case"rare":return"bg-gradient-to-br from-blue-500 to-cyan-500 border-2 border-blue-600";default:return"bg-gradient-to-br from-gray-500 to-gray-600 border-2 border-gray-600"}})(e.rarity,e.is_equipped)}`,onClick:()=>M(e.frame_id),children:[jsxRuntimeExports.jsx("img",{src:e.icon_url,alt:e.name,className:"w-10 h-10 rounded-full mb-2"}),jsxRuntimeExports.jsx("div",{className:"text-center font-semibold text-xs "+(e.is_equipped?"text-white":"text-gray-600"),children:e.name})]},e.frame_id))]})}),jsxRuntimeExports.jsx(Card,{title:"基本信息",className:"mb-4 bg-white rounded-lg shadow-sm",children:jsxRuntimeExports.jsxs(List$1,{className:"bg-transparent",children:[jsxRuntimeExports.jsx(List$1.Item,{extra:jsxRuntimeExports.jsx(Button,{size:"small",fill:"outline",onClick:()=>g(!0),className:"text-blue-600 border-blue-600",children:"修改"}),className:"border-b border-gray-100",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"邮箱"}),jsxRuntimeExports.jsx("div",{className:"text-gray-900",children:s})]})}),jsxRuntimeExports.jsx(List$1.Item,{className:"border-b border-gray-100",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"部门"}),jsxRuntimeExports.jsx("div",{className:"text-gray-900",children:i||"暂无部门信息"})]})}),jsxRuntimeExports.jsx(List$1.Item,{extra:jsxRuntimeExports.jsx(Button,{size:"small",fill:"outline",onClick:()=>v(!0),className:"text-blue-600 border-blue-600",children:"修改"}),children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"密码"}),jsxRuntimeExports.jsx("div",{className:"text-gray-900",children:"••••••••"})]})})]})}),jsxRuntimeExports.jsxs(Card,{title:"角色权限",className:"mb-4 bg-white rounded-lg shadow-sm",children:[(R||_)&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx(Tag,{color:"red",fill:"outline",className:"text-red-600 border-red-600",children:R?"超级管理员":"系统管理员"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"拥有系统最高权限"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-base font-bold mb-2 text-gray-900",children:[jsxRuntimeExports.jsx(UserOutline,{className:"mr-2"}),"我的角色"]}),jsxRuntimeExports.jsxs(Space,{wrap:!0,children:[b.map(e=>jsxRuntimeExports.jsxs(Tag,{color:e.is_active?"primary":"default",fill:"outline",className:e.is_active?"text-blue-600 border-blue-600":"text-gray-500 border-gray-400",children:[e.role_display_name,e.expires_at&&jsxRuntimeExports.jsxs("span",{className:"ml-1 text-xs",children:["(到期: ",toBeijingDateTimeStr(e.expires_at),")"]})]},e.role_id)),0===b.length&&jsxRuntimeExports.jsx("div",{className:"text-gray-500 text-sm",children:"暂无角色"})]}),A.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsxs(Tag,{color:"warning",fill:"outline",className:"text-orange-600 border-orange-600",children:[jsxRuntimeExports.jsx(ClockCircleOutline,{className:"mr-1"}),"即将过期的角色 (",A.length,")"]}),jsxRuntimeExports.jsx(List$1,{className:"mt-2 bg-transparent",children:A.map(e=>jsxRuntimeExports.jsxs(List$1.Item,{className:"border-b border-gray-100",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-900",children:e.role_display_name}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-600",children:["到期时间: ",toBeijingDateTimeStr(e.expires_at)]})]},e.role_id))})]})]}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"8px"},children:[jsxRuntimeExports.jsx(KeyOutline,{style:{marginRight:"8px"}}),"我的权限"]}),Object.keys(F).length>0?Object.entries(F).map(([e,t])=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"12px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"6px"},children:"leads"===e?"线索管理":"followups"===e?"跟进管理":"deals"===e?"成交管理":"dashboard"===e?"仪表盘":"departments"===e?"部门管理":"system"===e?"系统管理":e}),jsxRuntimeExports.jsx(Space,{wrap:!0,children:t.map(e=>jsxRuntimeExports.jsx(Tag,{color:"success",fill:"outline",children:e.permission_display_name},e.permission_name))})]},e)):jsxRuntimeExports.jsx("div",{style:{color:"#999",fontSize:"14px"},children:"暂无权限"})]}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",color:"#999",fontSize:"12px"},children:["总计: ",b.length," 个角色, ",w.length," 个权限"]})]}),jsxRuntimeExports.jsx(Card,{style:{marginBottom:"16px"},children:jsxRuntimeExports.jsxs(Button,{block:!0,color:"danger",fill:"outline",onClick:()=>{Dialog.confirm({content:"确定要退出登录吗？",onConfirm:()=>{j(e)}})},style:{height:"44px"},children:[jsxRuntimeExports.jsx(CloseOutline,{style:{marginRight:"8px"}}),"退出登录"]})})]}),jsxRuntimeExports.jsx(Popup,{visible:u,onMaskClick:()=>d(!1),position:"bottom",bodyStyle:{height:"300px"},children:jsxRuntimeExports.jsxs("div",{style:{padding:"16px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px",textAlign:"center"},children:"更换头像"}),jsxRuntimeExports.jsx(ImageUploader,{value:[],onChange:async e=>{if(e.length>0){const t=e[0].file;if(t)try{const e={maxSizeMB:1,maxWidthOrHeight:1024,useWebWorker:!0},r=await imageCompression(t,e);await(async e=>{if(E){c(!0);try{const t=e.name.split(".").pop(),r=`user_${E.id}_${Date.now()}.${t}`,{data:s}=await supabase.from("users_profile").select("avatar_url").eq("user_id",E.id).single(),n=null==s?void 0:s.avatar_url,{error:i}=await supabase.storage.from("avatars").upload(r,e,{upsert:!0});if(i)return void Toast.show("头像上传失败");const{data:o}=supabase.storage.from("avatars").getPublicUrl(r),a=null==o?void 0:o.publicUrl,{error:l}=await supabase.from("users_profile").update({avatar_url:a}).eq("user_id",E.id);if(l)return void Toast.show("头像保存失败");if(n&&n.includes("/avatars/")){const e=n.split("/"),t=e[e.length-1];if(t){const{error:e}=await supabase.storage.from("avatars").remove([t]);e&&console.error("删除旧头像失败:",e)}}await P(),Toast.show("头像上传成功"),localStorage.setItem("avatar_refresh_token",Date.now().toString()),window.dispatchEvent(new Event("avatar_refresh_token"))}catch(t){Toast.show("头像上传失败")}finally{c(!1)}}else Toast.show("用户信息获取失败")})(r),d(!1)}catch(e2){Toast.show("图片压缩失败")}}},maxCount:1,showUpload:!1,upload:async e=>({url:URL.createObjectURL(e)})}),jsxRuntimeExports.jsx("div",{style:{marginTop:"16px",textAlign:"center"},children:jsxRuntimeExports.jsx(Button,{block:!0,onClick:()=>d(!1),children:"取消"})})]})}),jsxRuntimeExports.jsx(Popup,{visible:f,onMaskClick:()=>g(!1),position:"bottom",bodyStyle:{height:"300px"},children:jsxRuntimeExports.jsxs("div",{style:{padding:"16px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px",textAlign:"center"},children:"修改邮箱"}),jsxRuntimeExports.jsxs(Form,{form:r,onFinish:async e=>{const{email:t}=e,{data:r}=await supabase.from("users_profile").select("user_id").eq("email",t).limit(1);if(r&&r.length>0)return void Toast.show("该邮箱已被注册");const{error:s}=await tokenManager.updateUser({email:t});s?Toast.show(s instanceof Error?s.message:"邮箱更新失败"):(E&&await supabase.from("users_profile").update({email:t}).eq("user_id",E.id),Toast.show("邮箱修改成功，请前往新邮箱查收验证邮件"),n(t),g(!1))},layout:"vertical",children:[jsxRuntimeExports.jsx(Form.Item,{name:"email",label:"新邮箱",rules:[{required:!0,type:"email",message:"请输入有效邮箱"}],children:jsxRuntimeExports.jsx(Input,{placeholder:"请输入新邮箱"})}),jsxRuntimeExports.jsx(Form.Item,{children:jsxRuntimeExports.jsx(Button,{block:!0,type:"submit",color:"primary",children:"确认修改"})})]})]})}),jsxRuntimeExports.jsx(Popup,{visible:y,onMaskClick:()=>v(!1),position:"bottom",bodyStyle:{height:"400px"},children:jsxRuntimeExports.jsxs("div",{style:{padding:"16px"},children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px",textAlign:"center"},children:"修改密码"}),jsxRuntimeExports.jsxs(Form,{form:t,onFinish:async t=>{const{oldPassword:r,password:n}=t,{error:i}=await tokenManager.signInWithPassword(s,r);if(i)return void Toast.show("旧密码错误，请重新输入");const{error:o}=await tokenManager.updateUser({password:n});o?Toast.show(o instanceof Error?o.message:"密码更新失败"):(Toast.show("密码修改成功，请重新登录"),await j(e))},layout:"vertical",children:[jsxRuntimeExports.jsx(Form.Item,{name:"oldPassword",label:"旧密码",rules:[{required:!0,message:"请输入旧密码"}],children:jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"请输入旧密码"})}),jsxRuntimeExports.jsx(Form.Item,{name:"password",label:"新密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],children:jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"请输入新密码"})}),jsxRuntimeExports.jsx(Form.Item,{children:jsxRuntimeExports.jsx(Button,{block:!0,type:"submit",color:"primary",children:"确认修改"})})]})]})}),o&&jsxRuntimeExports.jsx(ImageViewer,{image:o?`${o}?t=${p}`:"",visible:!1})]})},{Title:Title,Text:Text}=Typography,Profile=()=>{const e=useNavigate(),[t]=Form$4.useForm(),[r]=Form$4.useForm(),[s,n]=reactExports.useState(""),[i]=reactExports.useState(""),[o,a]=reactExports.useState(null),[l,c]=reactExports.useState(!1),[u,d]=reactExports.useState(!1),[p,m]=reactExports.useState(Date.now()),[h,x]=reactExports.useState(!0),{user:f}=useUser(),{logout:g}=useAuth();reactExports.useEffect(()=>{(null==f?void 0:f.email)&&n(f.email)},[f]);const{userRoles:y,userPermissions:v,loading:E,isSuperAdmin:j,isSystemAdmin:b,getPermissionsByCategory:w,getExpiringRoles:R}=useRolePermissions(),{avatarFrames:_,getEquippedAvatarFrame:S,equipAvatarFrame:C}=useAchievements(),k=S(),$=async()=>{if(x(!0),!f)return void x(!1);const{data:e}=await supabase.from("users_profile").select("avatar_url, updated_at").eq("user_id",f.id).single();a((null==e?void 0:e.avatar_url)||null),m((null==e?void 0:e.updated_at)?toBeijingTime(e.updated_at).valueOf():Date.now()),x(!1)};reactExports.useEffect(()=>{f&&$()},[f]),reactExports.useEffect(()=>{s&&r.setFieldsValue({email:s})},[s,r]);const T=R(7),I=w(),P=async e=>{try{await C(e??""),staticMethods.success(e?"头像框已装备":"已恢复默认头像框"),await $(),localStorage.setItem("avatar_refresh_token",Date.now().toString()),window.dispatchEvent(new Event("avatar_refresh_token"))}catch(e2){staticMethods.error("头像框装备失败")}};return jsxRuntimeExports.jsxs("div",{style:{maxWidth:800,margin:"40px auto",padding:"0 20px"},children:[jsxRuntimeExports.jsxs(Card$1,{title:"我的头像",style:{marginBottom:24},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:32},children:[jsxRuntimeExports.jsx("div",{style:{width:80,height:80,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(Avatar$1,{size:80,src:!h&&o?`${o}?t=${p}`:void 0,style:{backgroundColor:"#1890ff",border:"2px solid #fff",objectFit:"cover"},icon:jsxRuntimeExports.jsx(RefIcon$5,{}),onClick:async()=>{if(supabase&&f){const{data:e}=await supabase.from("users_profile").select("avatar_url").eq("user_id",f.id).single();(null==e?void 0:e.avatar_url)&&a(e.avatar_url)}d(!0)}})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(ImgCrop,{cropShape:"round",aspect:1,quality:1,showGrid:!1,showReset:!0,modalTitle:"裁剪头像",children:jsxRuntimeExports.jsx(Upload,{showUploadList:!1,accept:"image/png,image/jpeg,image/jpg",disabled:l,beforeUpload:async e=>{const t={maxSizeMB:1,maxWidthOrHeight:1024,useWebWorker:!0};try{const r=await imageCompression(e,t);return await(async e=>{if(f)if("uploading"!==e.file.status){if("done"===e.file.status){const t=e.file.originFileObj,r=t.name.split(".").pop(),s=`user_${f.id}_${Date.now()}.${r}`,{data:n}=await supabase.from("users_profile").select("avatar_url").eq("user_id",f.id).single(),i=null==n?void 0:n.avatar_url,{error:o}=await supabase.storage.from("avatars").upload(s,t,{upsert:!0});if(o)return staticMethods.error("头像上传失败"),void c(!1);const{data:a}=supabase.storage.from("avatars").getPublicUrl(s),l=null==a?void 0:a.publicUrl,{error:u}=await supabase.from("users_profile").update({avatar_url:l}).eq("user_id",f.id);if(u)return staticMethods.error("头像保存失败"),void c(!1);if(i&&i.includes("/avatars/")){const e=i.split("/"),t=e[e.length-1];if(t){const{error:e}=await supabase.storage.from("avatars").remove([t]);e&&console.error("删除旧头像失败:",e)}else console.warn("无法解析旧头像路径")}await $(),c(!1),staticMethods.success("头像上传成功"),localStorage.setItem("avatar_refresh_token",Date.now().toString()),window.dispatchEvent(new Event("avatar_refresh_token"))}}else c(!0);else staticMethods.error("用户信息获取失败")})({file:{status:"done",originFileObj:r}}),!1}catch(e2){const t=e2&&"object"==typeof e2&&"message"in e2?e2.message:String(e2);return staticMethods.error("图片压缩失败: "+t),!1}},children:jsxRuntimeExports.jsx(Button$1,{icon:jsxRuntimeExports.jsx(RefIcon$f,{}),loading:l,children:"更换头像"})})})})]}),jsxRuntimeExports.jsx(Modal$2,{open:u,onCancel:()=>d(!1),footer:null,children:jsxRuntimeExports.jsx("img",{src:o?`${o}?t=${p}`:"",alt:"头像预览",style:{width:"100%"}})})]}),jsxRuntimeExports.jsx(Card$1,{title:"我的头像框",style:{marginBottom:24},children:h||!f?jsxRuntimeExports.jsx(LoadingScreen,{type:"profile"}):jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:24,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Tooltip,{title:"默认头像框",children:jsxRuntimeExports.jsxs("div",{style:{borderRadius:18,background:"linear-gradient(180deg, #f5f5f5 0%, #fff 100%)",minWidth:110,minHeight:140,padding:"18px 8px 18px 8px",display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden",boxShadow:k?"0 2px 8px rgba(0,0,0,0.08)":"0 0 16px 2px #bfbfbf",margin:"8px 0",cursor:"pointer",transition:"transform 0.18s, box-shadow 0.18s",transform:k?void 0:"scale(1.06)"},onClick:async()=>{await P(null)},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.08)",onMouseLeave:e=>e.currentTarget.style.transform=k?"scale(1)":"scale(1.06)",children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:2,left:"50%",transform:"translateX(-50%)",fontSize:44,fontWeight:900,color:"#bfbfbf",opacity:.1,pointerEvents:"none",userSelect:"none",letterSpacing:2,zIndex:1,whiteSpace:"nowrap"},children:"默认"}),jsxRuntimeExports.jsx("div",{style:{width:56,height:56,borderRadius:"50%",background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,color:"#bbb",marginBottom:10,zIndex:2},children:"无"}),jsxRuntimeExports.jsx("div",{style:{textAlign:"center",fontWeight:600,fontSize:15,marginBottom:2,zIndex:2},children:"默认"})]})}),0===_.length,_.map(e=>{let t="#fff",r="基础",s="#bfbfbf";return"legendary"===e.rarity?(t="linear-gradient(180deg, #ede7f6 0%, #fff 100%)",r="传说",s="#722ed1"):"epic"===e.rarity?(t="linear-gradient(180deg, #fff7e6 0%, #fff 100%)",r="史诗",s="#fa8c16"):"rare"===e.rarity&&(t="linear-gradient(180deg, #e6f7ff 0%, #fff 100%)",r="稀有",s="#1890ff"),jsxRuntimeExports.jsx(Tooltip,{title:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.name}),e.description&&jsxRuntimeExports.jsx("div",{style:{fontSize:12,color:"#ccc",marginBottom:4},children:e.description}),jsxRuntimeExports.jsxs("div",{style:{fontSize:11,color:"#999"},children:["稀有度: ",r]})]}),children:jsxRuntimeExports.jsxs("div",{style:{position:"relative",borderRadius:18,background:t,minWidth:110,minHeight:140,padding:"18px 8px 18px 8px",display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden",boxShadow:e.is_equipped?`0 0 16px 2px ${s}`:"0 2px 8px rgba(0,0,0,0.08)",margin:"8px 0",cursor:"pointer",transition:"transform 0.18s, box-shadow 0.18s",transform:e.is_equipped?"scale(1.06)":void 0},onClick:()=>P(e.frame_id),onMouseEnter:e=>e.currentTarget.style.transform="scale(1.08)",onMouseLeave:t=>t.currentTarget.style.transform=e.is_equipped?"scale(1.06)":"scale(1)",children:[jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:2,left:"50%",transform:"translateX(-50%)",fontSize:44,fontWeight:900,color:s,opacity:.1,pointerEvents:"none",userSelect:"none",letterSpacing:2,zIndex:1,whiteSpace:"nowrap"},children:r}),jsxRuntimeExports.jsx("img",{src:e.icon_url,alt:e.name,style:{width:56,height:56,borderRadius:"50%",boxShadow:"0 0 0 1px #fff",marginBottom:10,zIndex:2}}),jsxRuntimeExports.jsx("div",{style:{textAlign:"center",fontWeight:600,fontSize:15,marginBottom:2,zIndex:2},children:e.name}),e.description&&jsxRuntimeExports.jsx("div",{style:{textAlign:"center",fontSize:11,color:"#888",minHeight:16,maxWidth:80,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",zIndex:2},children:e.description})]})},e.frame_id)})]})})}),jsxRuntimeExports.jsxs(Card$1,{title:"基本信息",style:{marginBottom:24},children:[jsxRuntimeExports.jsx("div",{style:{marginBottom:40},children:jsxRuntimeExports.jsxs(Form$4,{form:r,onFinish:async e=>{const{email:t}=e,{data:r}=await supabase.from("users_profile").select("user_id").eq("email",t).limit(1);if(r&&r.length>0)return void staticMethods.error("该邮箱已被注册");const{error:s}=await tokenManager.updateUser({email:t});s?staticMethods.error(s instanceof Error?s.message:"邮箱更新失败"):(f&&await supabase.from("users_profile").update({email:t}).eq("user_id",f.id),staticMethods.success("邮箱修改成功，请前往新邮箱查收验证邮件"),n(t))},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"email",label:"邮箱",rules:[{required:!0,type:"email",message:"请输入有效邮箱"}],children:jsxRuntimeExports.jsx(Input$1,{})}),jsxRuntimeExports.jsx(Form$4.Item,{label:"部门",children:jsxRuntimeExports.jsx(Input$1,{value:i,disabled:!0})}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",block:!0,children:"修改邮箱"})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs(Form$4,{form:t,onFinish:async t=>{const{oldPassword:r,password:n}=t,{error:i}=await tokenManager.signInWithPassword(s,r);if(i)return void staticMethods.error("旧密码错误，请重新输入");const{error:o}=await tokenManager.updateUser({password:n});o?staticMethods.error(o instanceof Error?o.message:"密码更新失败"):(staticMethods.success("密码修改成功，请重新登录"),await g(e))},layout:"vertical",children:[jsxRuntimeExports.jsx(Form$4.Item,{name:"oldPassword",label:"旧密码",rules:[{required:!0,message:"请输入旧密码"}],children:jsxRuntimeExports.jsx(Input$1.Password,{})}),jsxRuntimeExports.jsx(Form$4.Item,{name:"password",label:"新密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,message:"密码必须包含大小写字母和数字"}],children:jsxRuntimeExports.jsx(Input$1.Password,{})}),jsxRuntimeExports.jsx(Button$1,{type:"primary",htmlType:"submit",block:!0,children:"修改密码"})]})})]}),jsxRuntimeExports.jsxs(Card$1,{title:jsxRuntimeExports.jsxs(Space$1,{children:[jsxRuntimeExports.jsx(RefIcon$M,{}),"角色权限",E&&jsxRuntimeExports.jsx(Badge$2,{status:"processing",text:"加载中..."})]}),style:{marginBottom:24},children:[(j||b)&&jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Tag$1,{color:"red",icon:jsxRuntimeExports.jsx(RefIcon$F,{}),children:j?"超级管理员":"系统管理员"}),jsxRuntimeExports.jsx(Text,{type:"secondary",children:"拥有系统最高权限"})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:24},children:[jsxRuntimeExports.jsxs(Title,{level:5,children:[jsxRuntimeExports.jsx(RefIcon$5,{})," 我的角色"]}),jsxRuntimeExports.jsxs(Space$1,{wrap:!0,children:[y.map(e=>jsxRuntimeExports.jsxs(Tag$1,{color:e.is_active?"blue":"default",icon:e.is_active?jsxRuntimeExports.jsx(RefIcon$7,{}):jsxRuntimeExports.jsx(RefIcon$b,{}),children:[e.role_display_name,e.expires_at&&jsxRuntimeExports.jsxs(Text,{type:"secondary",style:{marginLeft:8},children:["(到期: ",toBeijingDateTimeStr(e.expires_at),")"]})]},e.role_id)),0===y.length&&jsxRuntimeExports.jsx(Text,{type:"secondary",children:"暂无角色"})]}),T.length>0&&jsxRuntimeExports.jsxs("div",{style:{marginTop:12},children:[jsxRuntimeExports.jsxs(Tag$1,{color:"orange",icon:jsxRuntimeExports.jsx(RefIcon$R,{}),children:["即将过期的角色 (",T.length,")"]}),jsxRuntimeExports.jsx(List$3,{size:"small",dataSource:T,renderItem:e=>jsxRuntimeExports.jsxs(List$3.Item,{children:[jsxRuntimeExports.jsx(Text,{children:e.role_display_name}),jsxRuntimeExports.jsxs(Text,{type:"secondary",children:["到期时间: ",toBeijingDateTimeStr(e.expires_at)]})]})})]})]}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs(Title,{level:5,children:[jsxRuntimeExports.jsx(RefIcon$F,{})," 我的权限"]}),Object.keys(I).length>0?Object.entries(I).map(([e,t])=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[jsxRuntimeExports.jsx(Text,{strong:!0,style:{display:"block",marginBottom:8},children:"leads"===e?"线索管理":"followups"===e?"跟进管理":"deals"===e?"成交管理":"dashboard"===e?"仪表盘":"departments"===e?"部门管理":"system"===e?"系统管理":e}),jsxRuntimeExports.jsx(Space$1,{wrap:!0,children:t.map(e=>jsxRuntimeExports.jsx(Tag$1,{color:"green",children:e.permission_display_name},e.permission_name))})]},e)):jsxRuntimeExports.jsx(Text,{type:"secondary",children:"暂无权限"})]}),jsxRuntimeExports.jsx(Divider$1,{}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs(Text,{type:"secondary",children:["总计: ",y.length," 个角色, ",v.length," 个权限"]})})]})]})},ResponsiveProfile=()=>{const[e,t]=reactExports.useState(!1);return reactExports.useEffect(()=>{const e=()=>{t(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e?jsxRuntimeExports.jsx(MobileProfile,{}):jsxRuntimeExports.jsx(Profile,{})},MobileModal=({visible:e,onClose:t,title:r,children:s,height:n="80vh"})=>{const i=reactExports.useRef(null),o=reactExports.useRef(null),[a,l]=reactExports.useState(0),[c,u]=reactExports.useState(0),[d,p]=reactExports.useState(0),[m,h]=reactExports.useState(0),[x,f]=reactExports.useState(0),[g,y]=reactExports.useState(!1),[v,E]=reactExports.useState(!1);reactExports.useEffect(()=>(document.body.style.overflow=e?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[e]),reactExports.useEffect(()=>{e||(h(0),f(0),y(!1),E(!1))},[e]);const j=reactExports.useCallback(()=>{if(o.current){const e=o.current.scrollTop;E(e<=0)}},[]),b=reactExports.useCallback(e=>{const t=e.touches[0];l(t.clientX),u(t.clientY),p(Date.now()),y(!0)},[]),w=reactExports.useCallback(e=>{if(!g)return;const t=e.touches[0],r=t.clientX-a,s=t.clientY-c;if(j(),v&&s>0){e.preventDefault();const t=.5*window.innerHeight,r=Math.min(s,t);f(r)}else if(r>0){e.preventDefault();const t=.8*window.innerWidth,s=Math.min(r,t);h(s)}},[g,a,c,v,j]),R=reactExports.useCallback(e=>{if(!g)return;const r=Date.now()-d,s=Math.abs(m),n=Math.abs(x);if(v&&n>0){n>100||n>50&&r<300?(f(window.innerHeight),setTimeout(()=>{t(),f(0)},200)):f(0)}else if(s>0){s>100||s>50&&r<300?(h(window.innerWidth),setTimeout(()=>{t(),h(0)},200)):h(0)}y(!1)},[g,d,m,x,v,t]);return reactExports.useEffect(()=>{const t=i.current;if(t&&e)return t.addEventListener("touchstart",b,{passive:!1}),t.addEventListener("touchmove",w,{passive:!1}),t.addEventListener("touchend",R,{passive:!1}),()=>{t.removeEventListener("touchstart",b),t.removeEventListener("touchmove",w),t.removeEventListener("touchend",R)}},[e,b,w,R]),jsxRuntimeExports.jsx(Popup,{visible:e,onMaskClick:t,position:"bottom",bodyStyle:{height:n,borderTopLeftRadius:"16px",borderTopRightRadius:"16px",transform:`translate(${m}px, ${x}px)`,transition:g?"none":"transform 0.2s ease-out"},maskStyle:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:jsxRuntimeExports.jsxs("div",{ref:i,className:"h-full flex flex-col",style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},children:[jsxRuntimeExports.jsxs("div",{className:"relative flex items-center p-4 border-b border-gray-200 bg-white rounded-t-2xl",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"absolute left-4 p-2 rounded-full transition-colors bg-transparent border-none z-10",children:jsxRuntimeExports.jsx(LeftOutline,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex justify-center",children:"string"==typeof r?jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:r}):r})]}),jsxRuntimeExports.jsx("div",{ref:o,className:"flex-1 overflow-y-auto",onScroll:j,children:s})]})})},MobileInput=({label:e,value:t,onChange:r,placeholder:s,type:n="text",required:i=!1,disabled:o=!1})=>jsxRuntimeExports.jsx(Form.Item,{label:e,rules:i?[{required:!0,message:`请输入${e}`}]:[],children:jsxRuntimeExports.jsx(Input,{type:n,value:(null==t?void 0:t.toString())||"",onChange:r,placeholder:s,disabled:o})}),MobileSelect=({label:e,value:t,onChange:r,options:s,required:n=!1,disabled:i=!1})=>{const[o,a]=reactExports.useState(!1),l=reactExports.useMemo(()=>s.map((e,t)=>({label:e.label,value:e.value,key:`${e.value}-${t}`})),[s]);return jsxRuntimeExports.jsxs(Form.Item,{label:e,rules:n?[{required:!0,message:`请选择${e}`}]:[],children:[jsxRuntimeExports.jsx(Button,{onClick:()=>{i||a(!0)},disabled:i,fill:"outline",style:{color:i?"#999":"#1890ff",borderColor:i?"#d9d9d9":"#1890ff",textAlign:"left",justifyContent:"flex-start"},children:(()=>{if(!t)return`请选择${e}`;const r=s.find(e=>e.value===t);return r?r.label:`请选择${e}`})()}),jsxRuntimeExports.jsx(Picker,{title:e,columns:[l],visible:o,onClose:()=>a(!1),onConfirm:e=>{e&&e.length>0&&r(e[0]),a(!1)},value:t?[t]:[]})]})},MobileDateInput=({label:e,value:t,onChange:r,required:s=!1,disabled:n=!1,type:i="datetime-local"})=>{const o=e=>{if(null==e||""===e)return"";try{if(e&&"function"==typeof e.format)return e.isValid()?"date"===i?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm"):"";const t=dayjs(e);return t.isValid()?"date"===i?t.format("YYYY-MM-DD"):t.format("YYYY-MM-DD HH:mm"):""}catch(t){return""}};return jsxRuntimeExports.jsx(Form.Item,{label:e,rules:s?[{required:!0,message:`请选择${e}`}]:[],children:jsxRuntimeExports.jsx(DatePicker,{value:void 0,onConfirm:e=>{e&&"function"==typeof e.toISOString?r(e.toISOString()):e&&"function"==typeof e.format&&r(e.format("YYYY-MM-DD"))},children:(r,s)=>jsxRuntimeExports.jsx(Button,{className:"w-full h-10 text-left justify-start border border-gray-300 rounded-lg bg-white text-gray-700 hover:border-blue-500",onClick:()=>s.open(),disabled:n,children:t?o(t):`请选择${e}`})})})},MobileButton=({children:e,onClick:t,type:r="primary",size:s="medium",disabled:n=!1,loading:i=!1,fullWidth:o=!1})=>jsxRuntimeExports.jsx(Button,{onClick:t,disabled:n||i,color:"primary"===r?"primary":"default",size:{small:"mini",medium:"small",large:"large"}[s],loading:i,block:o,className:o?"w-full":"",children:e}),maskPhone=e=>e?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"-",maskWechat=e=>e?e.length<4?e:e.substring(0,2)+"****"+e.substring(e.length-2):"-",stageStyles={"stage-win":"linear-gradient(135deg, #f6ffed 0%, #b7eb8f 100%)","stage-invite":"linear-gradient(135deg, #fff7e6 0%, #ffd591 100%)","stage-confirm":"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)","stage-pending":"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)","stage-lose":"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)","stage-unfilled":"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)"},ShowingCard=React$2.memo(({showing:e,salesOptions:t,onEdit:r})=>{var s,n;return jsxRuntimeExports.jsx("div",{className:"showing-card-container",children:jsxRuntimeExports.jsxs("div",{className:"showing-card",onClick:()=>r(e),children:[jsxRuntimeExports.jsxs("div",{className:"card-header",style:{background:stageStyles[(e=>{if(!e||""===e.trim())return"stage-unfilled";return{"直签":"stage-win","预定":"stage-invite","意向金":"stage-confirm","考虑中":"stage-pending","已流失":"stage-lose"}[e]||"stage-unfilled"})(e.viewresult)]},children:[jsxRuntimeExports.jsxs("div",{className:"lead-header-row",children:[jsxRuntimeExports.jsxs("div",{className:"lead-id-section",children:[jsxRuntimeExports.jsx("div",{className:"lead-id",children:e.leadid}),jsxRuntimeExports.jsxs("div",{className:"create-time-inline",children:["创建时间：",e.created_at?dayjs(e.created_at).format("MM-DD HH:mm"):"未填写"]})]}),jsxRuntimeExports.jsx("div",{className:"view-result-tag",children:e.viewresult||"待填写"})]}),jsxRuntimeExports.jsxs("div",{className:"contact-row",children:[e.lead_phone&&jsxRuntimeExports.jsxs("div",{className:"contact-item",children:[jsxRuntimeExports.jsx(RefIcon$1,{className:"contact-icon"}),jsxRuntimeExports.jsx("span",{className:"contact-text",children:maskPhone(e.lead_phone)})]}),e.lead_wechat&&jsxRuntimeExports.jsxs("div",{className:"contact-item",children:[jsxRuntimeExports.jsx(RefIcon$2,{className:"contact-icon"}),jsxRuntimeExports.jsx("span",{className:"contact-text",children:maskWechat(e.lead_wechat)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"card-content",children:[jsxRuntimeExports.jsxs("div",{className:"info-columns",children:[jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"到达时间"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:e.arrivaltime?dayjs(e.arrivaltime).isValid()?dayjs(e.arrivaltime).format("MM-DD HH:mm"):"时间格式错误":"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"社区"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:e.community||"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"入住时间"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:e.moveintime?dayjs(e.moveintime).isValid()?dayjs(e.moveintime).format("MM-DD"):"时间格式错误":"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"约访管家"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:e.interviewsales_nickname||"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"分配管家"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:(null==(s=t.find(t=>t.id===e.showingsales))?void 0:s.nickname)||"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"实际带看管家"}),jsxRuntimeExports.jsx("div",{className:"info-value",children:e.trueshowingsales_nickname||"未填写"})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"预算"}),jsxRuntimeExports.jsxs("div",{className:"info-value",children:["¥",(null==(n=e.budget)?void 0:n.toLocaleString())||"未填写"]})]}),jsxRuntimeExports.jsxs("div",{className:"info-row",children:[jsxRuntimeExports.jsx("span",{className:"info-label",children:"租期"}),jsxRuntimeExports.jsxs("div",{className:"info-value",children:[e.renttime||"未填写","个月"]})]})]}),e.remark&&jsxRuntimeExports.jsx("div",{className:"remark-section",children:jsxRuntimeExports.jsx("div",{className:"remark-content",children:e.remark})})]})]})})},(e,t)=>e.showing.id===t.showing.id&&e.showing.leadid===t.showing.leadid&&e.showing.viewresult===t.showing.viewresult&&e.showing.scheduletime===t.showing.scheduletime&&e.showing.community===t.showing.community&&e.showing.budget===t.showing.budget&&e.showing.interviewsales_nickname===t.showing.interviewsales_nickname);ShowingCard.displayName="ShowingCard";const titleStyles="\n  .simple-title-container {\n    display: flex !important;\n    flex-direction: column !important;\n    align-items: center !important;\n    justify-content: center !important;\n    width: 100% !important;\n    min-height: 36px !important;\n  }\n\n  .simple-title-main {\n    font-size: 16px !important;\n    font-weight: 600 !important;\n    color: #262626 !important;\n    line-height: 1.4 !important;\n    margin: 0 !important;\n    text-align: center !important;\n  }\n\n  .simple-title-sub {\n    font-size: 14px !important;\n    font-weight: 500 !important;\n    color: #666 !important;\n    line-height: 1.3 !important;\n    margin: 2px 0 0 0 !important;\n    text-align: center !important;\n  }\n";if("undefined"!=typeof document){const e=document.createElement("style");e.textContent=titleStyles,document.head.appendChild(e)}const MobileShowingsList=()=>{var e,t;const[r,s]=reactExports.useState([]),[n,i]=reactExports.useState(!1),[o,a]=reactExports.useState(!0),[l,c]=reactExports.useState(1),[u]=reactExports.useState(20),[d,p]=reactExports.useState({}),[m,h]=reactExports.useState(!1),[x,f]=reactExports.useState(!1),[g,y]=reactExports.useState(null),[v,E]=reactExports.useState(!1),[j,b]=reactExports.useState([]),[w,R]=reactExports.useState([]),[_,S]=reactExports.useState([]),[C,k]=reactExports.useState([]),[$,T]=reactExports.useState({leadid:"",scheduletime:"",community:"",arrivaltime:"",showingsales:"",trueshowingsales:"",viewresult:"",budget:"",moveintime:"",renttime:"",remark:"",interviewsales_user_id:"",interviewsales_nickname:""});reactExports.useEffect(()=>{I(),P(!0)},[]);const I=async()=>{try{const[e,t,r,s]=await Promise.all([ShowingsService.getCommunityOptions(),ShowingsService.getViewResultOptions(),ShowingsService.getSalesOptions(),getUsersProfile()]);b(e.map(e=>e.value)),R(t||[]),S(r.map(e=>({id:e.value,nickname:e.label}))),k(s||[])}catch(e){console.error("🔄 移动端获取选项数据错误:",e),Toast.show({content:"获取选项数据失败",position:"center"})}},P=async(e=!1)=>{if(e&&(c(1),s([]),a(!0)),o||e){i(!0);try{const t=e?1:l,r=(t-1)*u,[n,i]=await Promise.all([ShowingsService.getShowings({...d,limit:u,offset:r,orderBy:"created_at",ascending:!1}),ShowingsService.getShowingsCount(d)]);s(e?n||[]:e=>[...e,...n||[]]),a(((null==n?void 0:n.length)||0)===u),c(t+1)}catch(t){Toast.show({content:"获取数据失败",position:"center"})}finally{i(!1)}}},A=e=>{var t,r,s,n,i;y(e);const o={leadid:e.leadid||"",scheduletime:e.scheduletime||"",community:e.community||"",arrivaltime:e.arrivaltime||"",showingsales:(null==(t=e.showingsales)?void 0:t.toString())||"",trueshowingsales:(null==(r=e.trueshowingsales)?void 0:r.toString())||"",viewresult:e.viewresult||"",budget:(null==(s=e.budget)?void 0:s.toString())||"",moveintime:e.moveintime||"",renttime:(null==(n=e.renttime)?void 0:n.toString())||"",remark:e.remark||"",interviewsales_user_id:(null==(i=e.interviewsales_user_id)?void 0:i.toString())||"",interviewsales_nickname:e.interviewsales_nickname||""};0===w.length&&(console.warn("⚠️ [MobileShowingsList] 看房结果选项数据未加载，尝试重新获取"),I()),T(o),f(!0)},F=reactExports.useMemo(()=>_.map(e=>({label:e.nickname,value:e.id})),[_]),M=reactExports.useMemo(()=>w.map(e=>({label:e.label,value:e.value})),[w]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen",children:[jsxRuntimeExports.jsx("div",{style:{background:"transparent",padding:"0 20px",zIndex:90},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"12px",flexWrap:"nowrap",width:"100%"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1,minWidth:"120px",margin:0,padding:0},children:jsxRuntimeExports.jsx(SearchBar,{placeholder:"搜索线索编号",onSearch:e=>{e&&(p({...d,leadid:e}),P(!0))},onClear:()=>{p({...d,leadid:void 0}),P(!0)},style:{"--background":"#ffffff","--border-radius":"12px","--height":"36px","--padding-left":"12px"}})}),jsxRuntimeExports.jsx("div",{style:{flexShrink:0,minWidth:"60px",margin:0,padding:0},children:jsxRuntimeExports.jsx(Button,{onClick:()=>h(!0),size:"small",fill:"outline",color:"default",style:{"--border-radius":"8px","--border-color":"#d1d5db","--height":"36px"},children:"筛选"})})]})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[r.length>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[r.map(e=>jsxRuntimeExports.jsx(ShowingCard,{showing:e,salesOptions:_,onEdit:A},e.id)),jsxRuntimeExports.jsx(InfiniteScroll,{loadMore:()=>P(),hasMore:o})]}):n?null:jsxRuntimeExports.jsx(Empty,{description:"暂无带看记录",image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",className:"py-12"}),n&&jsxRuntimeExports.jsx(DotLoading,{})]}),jsxRuntimeExports.jsx(MobileModal,{visible:x,onClose:()=>{f(!1),T({leadid:"",scheduletime:"",community:"",arrivaltime:"",showingsales:"",trueshowingsales:"",viewresult:"",budget:"",moveintime:"",renttime:"",remark:"",interviewsales_user_id:"",interviewsales_nickname:""}),y(null)},title:jsxRuntimeExports.jsxs("div",{className:"simple-title-container",children:[jsxRuntimeExports.jsx("div",{className:"simple-title-main",children:"编辑带看记录"}),jsxRuntimeExports.jsx("div",{className:"simple-title-sub",children:(null==g?void 0:g.leadid)||"带看记录"})]}),height:"90vh",children:jsxRuntimeExports.jsx("div",{className:"p-4 space-y-4",style:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",WebkitOverflowScrolling:"touch"},children:jsxRuntimeExports.jsxs(Form,{layout:"vertical",className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"adm-list-item",children:jsxRuntimeExports.jsx("div",{className:"adm-list-item-content",children:jsxRuntimeExports.jsxs("div",{className:"adm-list-item-content-main",children:[jsxRuntimeExports.jsxs("div",{className:"adm-list-item-content-main-title",children:["约访管家",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsx("div",{className:"adm-list-item-content-main-content",children:$.interviewsales_nickname||"未设置"})]})})}),jsxRuntimeExports.jsx(MobileDateInput,{label:"到达时间",value:$.arrivaltime,onChange:e=>T({...$,arrivaltime:e}),type:"datetime-local",required:!0}),jsxRuntimeExports.jsx(MobileSelect,{label:"实际带看管家",value:$.trueshowingsales,onChange:e=>T({...$,trueshowingsales:e}),options:F,required:!0}),jsxRuntimeExports.jsx(Form.Item,{label:"看房结果",rules:[{required:!0,message:"请选择看房结果"}],children:jsxRuntimeExports.jsx(Selector,{options:M.map((e,t)=>({...e,key:`viewresult-edit-${e.value}-${t}`})),value:$.viewresult?[$.viewresult]:[],onChange:e=>{T({...$,viewresult:e.length>0?e[0]:""})},multiple:!1})}),jsxRuntimeExports.jsx(MobileInput,{label:"预算",value:$.budget,onChange:e=>T({...$,budget:e}),placeholder:"请输入预算金额",type:"number",required:!0}),jsxRuntimeExports.jsx(MobileInput,{label:"租期(月)",value:$.renttime,onChange:e=>T({...$,renttime:e}),placeholder:"请输入租期月数",type:"number",required:!0}),jsxRuntimeExports.jsx(MobileDateInput,{label:"入住时间",value:$.moveintime,onChange:e=>T({...$,moveintime:e}),type:"date",required:!0}),jsxRuntimeExports.jsx(MobileInput,{label:"备注",value:$.remark,onChange:e=>T({...$,remark:e}),placeholder:"请输入备注信息",required:!0}),jsxRuntimeExports.jsx("div",{className:"pt-4 pb-4",children:jsxRuntimeExports.jsx(MobileButton,{onClick:()=>(async e=>{E(!0);try{const{interviewsales_user_id:t,interviewsales_nickname:r,...s}=e,n={...s,scheduletime:s.scheduletime||null,arrivaltime:s.arrivaltime||null,moveintime:s.moveintime||null,budget:s.budget?Number(s.budget):null,renttime:s.renttime?Number(s.renttime):null,showingsales:s.showingsales?Number(s.showingsales):null,trueshowingsales:s.trueshowingsales?Number(s.trueshowingsales):null};await ShowingsService.updateShowing(g.id,n),Toast.show({content:"更新成功",position:"center"}),f(!1),y(null),T({leadid:"",scheduletime:"",community:"",arrivaltime:"",showingsales:"",trueshowingsales:"",viewresult:"",budget:"",moveintime:"",renttime:"",remark:"",interviewsales_user_id:"",interviewsales_nickname:""}),P(!0)}catch(t){Toast.show({content:"操作失败",position:"center"})}finally{E(!1)}})($),type:"primary",size:"large",loading:v,fullWidth:!0,children:"更新"})})]})})}),jsxRuntimeExports.jsx(MobileModal,{visible:m,onClose:()=>h(!1),title:"筛选条件",height:"60vh",children:jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"社区"}),jsxRuntimeExports.jsx(Selector,{options:j.map((e,t)=>({label:e,value:e,key:`community-${e}-${t}`})),value:d.community||[],onChange:e=>p({...d,community:e}),multiple:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"带看结果"}),jsxRuntimeExports.jsx(Selector,{options:w.map((e,t)=>({...e,key:`viewresult-${e.value}-${t}`})),value:d.viewresult||[],onChange:e=>p({...d,viewresult:e}),multiple:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"带看销售"}),jsxRuntimeExports.jsx(Selector,{options:_.map((e,t)=>({label:e.nickname,value:e.id,key:`sales-${e.id}-${t}`})),value:d.showingsales||[],onChange:e=>p({...d,showingsales:e}),multiple:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"预算范围"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"最低预算",value:(null==(e=d.budget_min)?void 0:e.toString())||"",onChange:e=>p({...d,budget_min:Number(e)||void 0}),className:"flex-1"}),jsxRuntimeExports.jsx("span",{className:"text-gray-500",children:"-"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"最高预算",value:(null==(t=d.budget_max)?void 0:t.toString())||"",onChange:e=>p({...d,budget_max:Number(e)||void 0}),className:"flex-1"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 pt-4",children:[jsxRuntimeExports.jsx(MobileButton,{onClick:()=>(p(d),h(!1),void P(!0)),type:"primary",size:"large",fullWidth:!0,children:"应用筛选"}),jsxRuntimeExports.jsx(MobileButton,{onClick:()=>{p({}),h(!1),P(!0)},type:"secondary",size:"large",fullWidth:!0,children:"重置筛选"})]})]})})]})},{Sider:Sider,Content:Content,Header:Header}=Layout,ResponsiveFollowups=()=>{const[e,t]=React$2.useState(!1);return React$2.useEffect(()=>{const e=()=>{t(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e?jsxRuntimeExports.jsx(MobileFollowups,{}):jsxRuntimeExports.jsx(Followups,{})},ResponsiveShowings=()=>{const[e,t]=React$2.useState(!1);return React$2.useEffect(()=>{const e=()=>{t(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e?jsxRuntimeExports.jsx(MobileShowingsList,{}):jsxRuntimeExports.jsx(ShowingsList,{})};class ErrorBoundary extends React$2.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){}render(){return this.state.hasError?jsxRuntimeExports.jsx(Error500,{}):this.props.children}}const App=()=>jsxRuntimeExports.jsx(UserProvider,{children:jsxRuntimeExports.jsx(AppContent,{})}),AppContent=()=>{var e;const t=useNavigate(),r=useLocation(),{profile:s}=useUser(),{logout:n}=useAuth(),{hasRole:i,isSuperAdmin:o}=useRolePermissions(),[a,l]=React$2.useState(!1),[c]=React$2.useState(220),{versionInfo:u,showUpdateModal:d,forceRefresh:p,ignoreUpdate:m,setShowUpdateModal:h}=useVersionCheck(),x=[...i("admin")||i("super_admin")||i("system_admin")||o?[{label:"跟进记录",key:"followups"}]:[],{label:"新手入门",key:"onboarding"}],[f,g]=React$2.useState(!1);React$2.useEffect(()=>{const e=()=>{g(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);const y={index:"/dashboard",leads:"/leads",followups:"/followups","metro-calculator":"/metro-calculator",showings:"/showings",deals:"/deals",allocation:"/allocation","showings-queue":"/showings-queue","points-summary":"/points-summary","points-exchange":"/points/exchange","honor-management":"/honor","achievement-management":"/achievement",departments:"/departments",roles:"/roles",announcements:"/announcements","banner-management":"/banner-management","load-demo":"/loading-demo","notification-templates":"/notification-templates","approval-flows-list":"/approval-flows","approval-details":"/approval-details","approval-performance":"/approval-performance","data-analysis":"/data-analysis","live-stream-registration":"/live-stream-registration","live-stream-management":"/live-stream-management"},v={};Object.entries(y).forEach(([e,t])=>{v[t]=e});const E="/"===r.pathname?"live-stream-registration":v[r.pathname]||"",[j,b]=React$2.useState(void 0),[w,R]=React$2.useState(!0),[_,S]=React$2.useState(0),[C,k]=React$2.useState(null),{notifications:$,unreadCount:T,markAsRead:I,markAsHandled:P,deleteNotification:A,loading:F}=useRealtimeNotifications(),M=React$2.useRef(T);React$2.useEffect(()=>{if(T>(M.current||0)){new Audio("/notification.mp3").play().catch(()=>{})}M.current=T},[T]);const[D,O]=React$2.useState(!1),{getEquippedAvatarFrame:N}=useAchievements(),B=N(),L=B&&B.icon_url||(null==(e=null==B?void 0:B.frame_data)?void 0:e.icon_url),z=React$2.useCallback(async()=>{R(!0),(null==s?void 0:s.avatar_url)?b(s.avatar_url):b(void 0),R(!1)},[s]),V=React$2.useCallback(async e=>{try{const t=await getUserPointsInfo(e);S(t.wallet.total_points||0)}catch(t){console.error("获取用户积分失败:",t)}},[]);React$2.useEffect(()=>{z();const e=e=>{"avatar_refresh_token"===e.key&&z()},t=()=>{z()};return window.addEventListener("storage",e),window.addEventListener("avatar_refresh_token",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("avatar_refresh_token",t)}},[z]),React$2.useEffect(()=>{(null==s?void 0:s.id)&&k(s.id)},[s]),React$2.useEffect(()=>{C&&V(C)},[C,V]),React$2.useEffect(()=>{const e=()=>{const t=new Audio("/notification.wav");t.volume=0,t.play().catch(()=>{}),window.removeEventListener("click",e)};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]);if("/login"===r.pathname||"/set-password"===r.pathname||"/auth/wecom/callback"===r.pathname)return jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(Login,{})}),jsxRuntimeExports.jsx(Route,{path:"/set-password",element:jsxRuntimeExports.jsx(SetPassword,{})}),jsxRuntimeExports.jsx(Route,{path:"/auth/wecom/callback",element:jsxRuntimeExports.jsx(WecomCallback,{})})]});const U=jsxRuntimeExports.jsxs("div",{style:{minWidth:320,padding:"0",borderRadius:"12px",overflow:"hidden"},children:[jsxRuntimeExports.jsxs("div",{style:{padding:"10px 0px 20px 20px",background:"\n            radial-gradient(ellipse at top left, rgba(255, 215, 0, 0.9) 0%, transparent 50%),\n            radial-gradient(ellipse at top right, rgba(255, 193, 7, 0.7) 0%, transparent 50%),\n            radial-gradient(ellipse at center top, rgba(255, 152, 0, 0.5) 0%, transparent 60%),\n            radial-gradient(ellipse at 30% 40%, rgba(255, 193, 7, 0.4) 0%, transparent 60%),\n            radial-gradient(ellipse at 70% 60%, rgba(255, 215, 0, 0.3) 0%, transparent 60%),\n            linear-gradient(135deg, \n              rgba(255, 215, 0, 0.8) 0%, \n              rgba(255, 193, 7, 0.6) 25%, \n              rgba(255, 152, 0, 0.4) 50%, \n              rgba(255, 193, 7, 0.3) 75%, \n              rgba(255, 215, 0, 0.2) 100%)\n          ",borderRadius:"12px 12px 12px 12px",color:"#382a04",position:"relative",overflow:"hidden",marginBottom:"0px",cursor:"pointer",transition:"box-shadow 0.2s, filter 0.18s",boxShadow:"none",userSelect:"none"},onClick:()=>t("/points/exchange"),onMouseEnter:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.filter="brightness(1.03)";const t=document.createElement("div");t.className="points-shine-effect",t.style.position="absolute",t.style.top="0",t.style.left="-60%",t.style.width="60%",t.style.height="100%",t.style.background="linear-gradient(120deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0.0) 100%)",t.style.pointerEvents="none",t.style.zIndex="10",t.style.transform="skewX(-20deg)",t.style.animation="shine-move 0.9s linear 1",t.style.borderRadius="0",e.currentTarget.appendChild(t),t.addEventListener("animationend",()=>{t.parentNode&&t.parentNode.removeChild(t)})},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.filter="none"},title:"点击兑换积分",children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0px",zIndex:2,position:"relative"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:42,fontWeight:700,letterSpacing:"0.5px",color:"#382a04",fontFamily:'"Micro 5", "Micro 5", monospace',lineHeight:1},children:_.toLocaleString()}),jsxRuntimeExports.jsx("span",{style:{fontSize:12,fontWeight:500,opacity:.7,color:"#382a04"},children:"剩余积分"})]}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",right:"-10px",top:"5px",width:"120px",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",opacity:.6},children:jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("img",{src:"/coin2.svg",alt:"coin",style:{width:"180px",height:"180px"},onError:e=>{e.currentTarget.style.display="none"}})})})]}),jsxRuntimeExports.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #f0f0f0",background:"#fff"},children:jsxRuntimeExports.jsx("div",{style:{maxHeight:280,overflowY:"auto"},children:jsxRuntimeExports.jsx(NotificationCenter,{simple:!0,notifications:$,unreadCount:T,markAsRead:I,markAsHandled:P,deleteNotification:A,loading:F,onViewAll:()=>O(!0)})})}),jsxRuntimeExports.jsxs("div",{style:{padding:"16px 16px 8px 16px",display:"flex",gap:"8px",background:"#fff",borderRadius:0},children:[jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$5,{}),onClick:()=>{t("/profile")},style:{flex:1,height:"32px",fontSize:"14px",borderRadius:8},children:"个人中心"}),jsxRuntimeExports.jsx(Button$1,{size:"small",icon:jsxRuntimeExports.jsx(RefIcon$s,{}),onClick:async()=>{await n(t)},style:{flex:1,height:"32px",fontSize:"14px",borderRadius:8,color:"#ff4d4f",borderColor:"#ff4d4f"},children:"退出登录"})]})]}),H=jsxRuntimeExports.jsx(Drawer,{title:"通知中心",placement:"right",width:400,open:D,onClose:()=>O(!1),styles:{body:{padding:0}},children:jsxRuntimeExports.jsx(NotificationCenter,{simple:!1,notifications:$,unreadCount:T,markAsRead:I,markAsHandled:P,deleteNotification:A,loading:F})});return jsxRuntimeExports.jsx(ConfigProvider,{locale:zhCN$1,children:jsxRuntimeExports.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsxs(Header,{className:"app-header",style:{height:60,padding:"0 16px",display:"flex",alignItems:"center",position:"fixed",top:0,left:0,right:0,width:"100%",zIndex:1e3,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.03)"},children:[jsxRuntimeExports.jsx(Menu,{onClick:e=>{"followups"===e.key&&t("/followups"),"onboarding"===e.key&&t("/onboarding")},selectedKeys:"/followups"===r.pathname?["followups"]:"/onboarding"===r.pathname?["onboarding"]:[],mode:"horizontal",items:x,style:{minWidth:240,borderBottom:"none",background:"transparent",marginRight:24,fontSize:16},className:"custom-followup-menu"}),jsxRuntimeExports.jsxs("div",{className:"app-title",style:{position:"absolute",left:0,right:0,top:0,bottom:0,margin:"auto",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2,transform:"scale(1.5)",pointerEvents:"none"},children:[jsxRuntimeExports.jsx(LottieLogo,{width:40,height:40}),jsxRuntimeExports.jsx("img",{src:"/VLINKER.svg",alt:"VLINKER",style:{height:36,marginLeft:4,verticalAlign:"middle"},onError:e=>{e.currentTarget.style.display="none"}})]}),jsxRuntimeExports.jsx("div",{className:"app-header-user",style:{display:"flex",alignItems:"center",gap:24},children:jsxRuntimeExports.jsx(UserMenu,{})}),!f&&jsxRuntimeExports.jsx(Popover$2,{content:U,title:null,placement:"bottomRight",trigger:"hover",styles:{root:{maxWidth:340,borderRadius:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}},children:jsxRuntimeExports.jsx("span",{style:{position:"absolute",top:2,right:48,zIndex:10},children:jsxRuntimeExports.jsxs("div",{style:{width:90,height:90,borderRadius:"50%",background:"#fff",overflow:"visible",cursor:"pointer",transition:"all 0.3s ease",transform:"scale(0.8)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 0 0 #fff",position:"relative"},title:"点击进入个人中心",onClick:()=>t("/profile"),onMouseEnter:e=>{e.currentTarget.style.transform="scale(0.84)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(0.8)",e.currentTarget.style.boxShadow="none"},children:[w?jsxRuntimeExports.jsx("div",{style:{width:58.5,height:58.5,borderRadius:"50%",background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:jsxRuntimeExports.jsx("div",{style:{width:20,height:20,border:"2px solid #e0e0e0",borderTop:"2px solid #1890ff",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):j?jsxRuntimeExports.jsx(Badge$2,{count:T,size:"small",showZero:!1,overflowCount:99,style:{"--antd-badge-dot-size":"8px","--antd-badge-size":"16px"},styles:{indicator:{top:"0px",right:"0px",transform:"scale(1.3)",zIndex:999,transition:"none",animation:"none"}},children:jsxRuntimeExports.jsx("img",{src:j,alt:"头像",style:{width:58.5,height:58.5,borderRadius:"50%",objectFit:"cover",background:"#fff",zIndex:1},onLoad:()=>R(!1),onError:()=>R(!1)})}):jsxRuntimeExports.jsx("div",{style:{width:58.5,height:58.5,borderRadius:"50%",background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:jsxRuntimeExports.jsx("span",{style:{fontSize:24,color:"#999"},children:"👤"})}),L&&jsxRuntimeExports.jsx("img",{src:L,alt:"头像框",style:{width:117,height:117,borderRadius:"50%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:2}})]})})})]}),jsxRuntimeExports.jsxs(Layout,{style:{marginTop:60},children:[jsxRuntimeExports.jsx(Sider,{width:c,collapsed:a,collapsible:!0,onCollapse:l,trigger:null,className:"sider-main",children:jsxRuntimeExports.jsx(NavigationMenu,{selectedKey:E,onMenuClick:e=>{const r=y[e];r&&t(r)},collapsed:a,onCollapse:l})}),jsxRuntimeExports.jsx(Layout,{style:{marginLeft:a?56:c,background:"transparent",transition:"margin-left 0.2s",borderRadius:"12px 0 0 12px"},children:jsxRuntimeExports.jsx(Content,{className:"content-main",children:jsxRuntimeExports.jsx(PrivateRoute,{children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(Navigate,{to:"/live-stream-registration",replace:!0})}),jsxRuntimeExports.jsx(Route,{path:"/dashboard",element:jsxRuntimeExports.jsx(Index,{})}),jsxRuntimeExports.jsx(Route,{path:"/leads",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"lead_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(LeadsList,{})})}),jsxRuntimeExports.jsx(Route,{path:"/followups",element:jsxRuntimeExports.jsx(ResponsiveFollowups,{})}),jsxRuntimeExports.jsx(Route,{path:"/mobile-profile",element:jsxRuntimeExports.jsx(MobileProfile,{})}),jsxRuntimeExports.jsx(Route,{path:"/showings",element:jsxRuntimeExports.jsx(ResponsiveShowings,{})}),jsxRuntimeExports.jsx(Route,{path:"/deals",element:jsxRuntimeExports.jsx(DealsList,{})}),jsxRuntimeExports.jsx(Route,{path:"/allocation",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"allocation_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(AllocationManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/allocation-management",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"allocation_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(AllocationManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/showings-queue",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"allocation_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(ShowingsQueueManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/points-summary",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"points_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(PointsSummary,{})})}),jsxRuntimeExports.jsx(Route,{path:"/points/exchange",element:jsxRuntimeExports.jsx(PointsExchange,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(ResponsiveProfile,{})}),jsxRuntimeExports.jsx(Route,{path:"/403",element:jsxRuntimeExports.jsx(Error403,{})}),jsxRuntimeExports.jsx(Route,{path:"/departments",element:jsxRuntimeExports.jsx(DepartmentPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/roles",element:jsxRuntimeExports.jsx(PermissionGate,{roles:["admin","super_admin","system_admin"],fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(RolePermissionManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/announcements",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"manage_announcements",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(AnnouncementManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/honor",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"user_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(HonorManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/achievement",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"user_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(AchievementManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/reset-password",element:jsxRuntimeExports.jsx(ResetPassword,{})}),jsxRuntimeExports.jsx(Route,{path:"/banner-management",element:jsxRuntimeExports.jsx(PermissionGate,{role:"admin",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(BannerManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/notification-templates",element:jsxRuntimeExports.jsx(PermissionGate,{role:"admin",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(NotificationTemplateManager,{})})}),jsxRuntimeExports.jsx(Route,{path:"/approval-flows",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"approval_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(ApprovalFlowManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"/approval-details",element:jsxRuntimeExports.jsx(ApprovalDetails,{})}),jsxRuntimeExports.jsx(Route,{path:"/approval-performance",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"approval_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(ApprovalPerformance,{})})}),jsxRuntimeExports.jsx(Route,{path:"/data-analysis",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"data_analysis",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(DataAnalysis,{})})}),jsxRuntimeExports.jsx(Route,{path:"/onboarding",element:jsxRuntimeExports.jsx(OnboardingPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/metro-calculator",element:jsxRuntimeExports.jsx(MetroDistanceCalculatorPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/live-stream-registration",element:jsxRuntimeExports.jsx(LiveStreamRegistration,{})}),jsxRuntimeExports.jsx(Route,{path:"/live-stream-management",element:jsxRuntimeExports.jsx(PermissionGate,{permission:"live_stream_manage",fallback:jsxRuntimeExports.jsx(Error403,{}),children:jsxRuntimeExports.jsx(LiveStreamManagement,{})})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(Error404,{})})]})})})})]}),H,f&&jsxRuntimeExports.jsx(MobileTabBar,{}),jsxRuntimeExports.jsx(VersionUpdateModal,{visible:d,versionInfo:u,onRefresh:p,onIgnore:m,onCancel:()=>h(!1)})]})})};function AppWithBoundary(){return jsxRuntimeExports.jsxs(ErrorBoundary,{children:[jsxRuntimeExports.jsx(App,{}),jsxRuntimeExports.jsx("style",{children:"\n        @keyframes shine-move {\n          0% { left: -60%; opacity: 0; }\n          10% { opacity: 0.2; }\n          50% { left: 100%; opacity: 0.35; }\n          100% { left: 120%; opacity: 0; }\n        }\n      "})]})}dayjs.extend(utc),dayjs.extend(timezone),dayjs.extend(weekday),dayjs.extend(updateLocale),dayjs.locale("zh-cn"),dayjs.tz.setDefault("Asia/Shanghai"),dayjs.updateLocale("en",{weekStart:1}),cacheManager.checkForUpdates(),createRoot$1(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(AppWithBoundary,{})})}));
