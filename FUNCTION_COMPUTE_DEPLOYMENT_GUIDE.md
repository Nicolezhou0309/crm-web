# 阿里云函数计算部署指南

## 🎯 为什么选择函数计算？

### ✅ 优势
1. **环境变量管理更灵活** - 无需重新构建，直接在控制台修改
2. **调试更方便** - 可以查看函数执行日志，快速定位问题
3. **配置更新简单** - 修改环境变量后立即生效
4. **服务端功能** - 可以添加API代理、数据处理等功能
5. **按量计费** - 只为实际使用付费

### 📊 成本对比
- **OSS静态托管**: ~几元/月（固定成本）
- **函数计算**: 按请求量计费，通常更便宜

## 🚀 部署步骤

### 1. 运行自动部署脚本

```bash
./deploy-to-function-compute.sh
```

### 2. 提供配置信息

脚本会提示您输入：
- **Access Key ID** - 您的阿里云访问密钥ID
- **Access Key Secret** - 您的阿里云访问密钥Secret
- **函数计算区域** - 如：`cn-shanghai`

### 3. 自动完成的工作

脚本会自动：
- ✅ 创建函数计算项目结构
- ✅ 配置Express服务器
- ✅ 设置环境变量
- ✅ 安装依赖
- ✅ 部署到函数计算

## 🔧 项目结构

部署后的项目结构：
```
aliyun-fc-frontend/
├── package.json          # 项目配置
├── index.js             # 函数入口文件
├── template.yml         # 函数计算配置
├── dist/                # 构建文件
│   ├── index.html
│   ├── assets/
│   └── ...
└── node_modules/        # 依赖包
```

## 🌐 环境变量配置

函数计算中的环境变量：
```yaml
EnvironmentVariables:
  VITE_SUPABASE_URL: 'http://47.123.26.25:8000'
  VITE_SUPABASE_ANON_KEY: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...'
  VITE_APP_ENV: 'production'
  VITE_APP_VERSION: '1.0.0'
```

## 📱 访问应用

部署完成后，您会获得一个HTTP触发器地址，格式如：
```
https://your-service-name.your-region.fc.aliyuncs.com/2016-08-15/proxy/your-function-name/
```

## 🔧 管理功能

### 1. 更新环境变量
- 登录阿里云控制台
- 进入函数计算服务
- 选择您的函数
- 在"环境变量"中修改配置
- 保存后立即生效

### 2. 查看日志
- 在函数计算控制台
- 选择"执行日志"
- 查看实时日志和错误信息

### 3. 监控性能
- 查看函数调用次数
- 监控响应时间
- 查看错误率

## 🚨 故障排除

### 1. 部署失败
**可能原因：**
- Access Key权限不足
- 区域配置错误
- 网络连接问题

**解决方案：**
- 检查Access Key权限
- 确认区域配置正确
- 检查网络连接

### 2. 应用无法访问
**可能原因：**
- HTTP触发器未正确配置
- 函数代码错误
- 环境变量配置错误

**解决方案：**
- 检查HTTP触发器配置
- 查看函数执行日志
- 验证环境变量

### 3. 登录仍然报错
**可能原因：**
- 环境变量未正确设置
- Supabase配置错误
- 网络连接问题

**解决方案：**
- 检查环境变量配置
- 验证Supabase连接
- 查看浏览器控制台错误

## 🔄 更新部署

### 1. 代码更新
```bash
# 重新构建
npm run build

# 重新部署
cd aliyun-fc-frontend
fun deploy --use-ros
```

### 2. 环境变量更新
- 在函数计算控制台直接修改
- 无需重新部署

## 📊 性能优化

### 1. 内存配置
- 默认512MB，可根据需要调整
- 更多内存 = 更快响应，但成本更高

### 2. 超时设置
- 默认30秒，可根据需要调整
- 建议设置为60秒以内

### 3. 并发配置
- 函数计算自动处理并发
- 无需手动配置

## 🎯 推荐配置

对于您的CRM系统，推荐配置：
- **内存**: 512MB
- **超时**: 30秒
- **并发**: 自动
- **触发器**: HTTP触发器

## 📞 技术支持

如果遇到问题：
1. 查看函数执行日志
2. 检查环境变量配置
3. 验证Supabase连接
4. 联系技术支持

---

## 🎉 部署完成

恭喜！您的CRM系统已成功部署到阿里云函数计算。现在可以：

- ✅ 灵活管理环境变量
- ✅ 方便调试和监控
- ✅ 按需付费
- ✅ 自动扩展
- ✅ 高可用性

享受函数计算带来的便利吧！
