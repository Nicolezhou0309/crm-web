ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  crm-web-service:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: 'CRM Web Application Service'
      Policies:
        - Version: '1'
          Statement:
            - Effect: Allow
              Action:
                - 'oss:GetObject'
                - 'oss:PutObject'
                - 'oss:DeleteObject'
                - 'oss:ListObjects'
              Resource: '*'
  web-function:
    Type: 'Aliyun::Serverless::Function'
    Properties:
      CodeUri: './'
      Description: 'CRM Web Application Function'
      Handler: 'index.handler'
      Runtime: 'custom'
      Timeout: 60
      MemorySize: 2048
      EnvironmentVariables:
        NODE_ENV: 'production'
        PORT: '9000'
      Events:
        httpTrigger:
          Type: 'HTTP'
          Properties:
            AuthType: 'ANONYMOUS'
            Methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS']
            InvocationRole: ''
      CustomContainerConfig:
        Image: 'registry.cn-shanghai.aliyuncs.com/fc-demo/nodejs20:latest'
        Command: '["node"]'
        Args: '["index.js"]'
Outputs:
  WebUrl:
    Description: 'Web application URL'
    Value:
      Fn::Sub: 'https://${web-function}.${crm-web-service}.${Aliyun::AccountId}.${Aliyun::Region}.fc.aliyuncs.com'
